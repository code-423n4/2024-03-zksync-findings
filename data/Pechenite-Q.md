### Low

|Number|Issue|Instances|
|-|:-|:-:|
| [L&#x2011;1](#L1-avoid-shadowing-state-variables) | Avoid shadowing state variables | 1 |
| [L&#x2011;2](#L2-avoid-using-txorigin) | Avoid using `tx.origin` | 3 |
| [L&#x2011;3](#L3-calling-bytesconcat-with-final-arguments-that-may-differ-in-length-may-cause-hash-collisions) | Calling `bytes.concat()` with final arguments that may differ in length, may cause hash collisions | 19 |
| [L&#x2011;4](#L4-consider-bounding-input-array-length) | Consider bounding input array length | 8 |
| [L&#x2011;5](#L5-consider-disabling-renounceownership) | Consider disabling `renounceOwnership()` | 5 |
| [L&#x2011;6](#L6-consider-implementing-two-step-procedure-for-updating-protocol-addresses) | Consider implementing two-step procedure for updating protocol addresses | 6 |
| [L&#x2011;7](#L7-constructor/initialize-function-lacks-parameter-validation) | `constructor`/`initialize` function lacks parameter validation | 11 |
| [L&#x2011;8](#L8-contracts-are-not-using-their-oz-upgradeable-counterparts) | Contracts are not using their OZ Upgradeable counterparts | 1 |
| [L&#x2011;9](#L9-critical-functions-should-be-controlled-by-time-locks) | Critical functions should be controlled by time locks | 22 |
| [L&#x2011;10](#L10-deleting-mapping-in-struct-will-not-delete-the-mapping) | Deleting mapping in struct will not delete the mapping | 2 |
| [L&#x2011;11](#L11-division-by-zero-not-prevented) | Division by zero not prevented | 1 |
| [L&#x2011;12](#L12-do-not-use-deprecated-library-functions) | Do not use deprecated library functions | 2 |
| [L&#x2011;13](#L13-draft-imports-may-break-in-new-minor-versions) | Draft imports may break in new minor versions | 1 |
| [L&#x2011;14](#L14-external-calls-in-an-un-bounded-for-loop-may-result-in-a-dos) | External calls in an un-bounded `for`-loop may result in a DOS | 1 |
| [L&#x2011;15](#L15-file-allows-a-version-of-solidity-that-is-susceptible-to-selector-related-optimizer-bug) | File allows a version of solidity that is susceptible to `.selector`-related optimizer bug | 9 |
| [L&#x2011;16](#L16-functions-calling-contracts/addresses-with-transfer-hooks-are-missing-reentrancy-guards) | Functions calling contracts/addresses with transfer hooks are missing reentrancy guards | 1 |
| [L&#x2011;17](#L17-initialization-can-be-front-run) | Initialization can be front-run | 8 |
| [L&#x2011;18](#L18-int-casting-blocktimestamp-can-reduce-the-lifespan-of-a-contract) | Int casting `block.timestamp` can reduce the lifespan of a contract | 2 |
| [L&#x2011;19](#L19-loss-of-precision) | Loss of precision | 9 |
| [L&#x2011;20](#L20-low-level-calls-to-custom-addresses) | Low level calls to custom `address`es | 1 |
| [L&#x2011;21](#L21-missing-checks-for-address0-when-assigning-values-to-address-state-variables) | Missing checks for `address(0)` when assigning values to address state variables | 6 |
| [L&#x2011;22](#L22-missing-contract-existence-checks-before-low-level-calls) | Missing contract-existence checks before low-level calls | 1 |
| [L&#x2011;23](#L23-missing-contract-existence-checks-before-yul-call) | Missing contract-existence checks before yul `call()` | 15 |
| [L&#x2011;24](#L24-missing-zero-address-check-in-functions-with-address-parameters) | Missing zero address check in functions with address parameters | 40 |
| [L&#x2011;25](#L25-multiplication-on-the-result-of-a-division) | Multiplication on the result of a division | 2 |
| [L&#x2011;26](#L26-name-is-not-a-part-of-the-erc-20-standard) | `name()` is not a part of the ERC-20 standard | 1 |
| [L&#x2011;27](#L27-numbers-downcast-to-addresses-may-result-in-collisions) | Numbers downcast to `address`es may result in collisions | 16 |
| [L&#x2011;28](#L28-onlyowner-functions-not-accessible-if-owner-renounces-ownership) | `onlyOwner` functions not accessible if `owner` renounces ownership | 23 |
| [L&#x2011;29](#L29-pure-function-accesses-storage) | `pure` function accesses storage | 1 |
| [L&#x2011;30](#L30-require-should-be-used-instead-of-assert) | `require()` should be used instead of `assert()` | 5 |
| [L&#x2011;31](#L31-return-variable-can-remain-unassigned-in-the-function) | Return variable can remain unassigned in the function | 1 |
| [L&#x2011;32](#L32-setters-should-prevent-re-setting-of-the-same-value) | Setters should prevent re-setting of the same value | 19 |
| [L&#x2011;33](#L33-state-variables-not-capped-at-reasonable-values) | State variables not capped at reasonable values | 15 |
| [L&#x2011;34](#L34-symbol-is-not-a-part-of-the-erc-20-standard) | `symbol()` is not a part of the ERC-20 standard | 1 |
| [L&#x2011;35](#L35-transferownership-should-be-two-step) | TransferOwnership should be two step | 1 |
| [L&#x2011;36](#L36-unchecked-blocks-with-additions/multiplications-may-overflow) | `unchecked` blocks with additions/multiplications may overflow | 40 |
| [L&#x2011;37](#L37-unchecked-blocks-with-subtractions-may-underflow) | `unchecked` blocks with subtractions may underflow | 11 |
| [L&#x2011;38](#L38-unsafe-downcast) | Unsafe downcast | 40 |
| [L&#x2011;39](#L39-unused/empty-receive/fallback-function) | Unused/empty `receive()/fallback()` function | 4 |
| [L&#x2011;40](#L40-upgradeable-contract-is-missing-a-__gap[50]-storage-variable-at-the-end-to-allow-for-new-storage-variables-in-later-versions) | Upgradeable contract is missing a `__gap[50]` storage variable at the end to allow for new storage variables in later versions | 1 |

👉 Total: 356 instances over 40 issues


### NonCritical

|Number|Issue|Instances|
|-|:-|:-:|
| [NC&#x2011;1](#NC1-2**<n>---1-should-be-re-written-as-typeuint<n>max) | `2**<n> - 1` should be re-written as `type(uint<n>).max` | 5 |
| [NC&#x2011;2](#NC2-add-inline-comments-for-unnamed-variables) | Add inline comments for unnamed variables | 8 |
| [NC&#x2011;3](#NC3-adding-a-return-statement-when-the-function-defines-a-named-return-variable-is-redundant) | Adding a `return` statement when the function defines a named return variable, is redundant | 1 |
| [NC&#x2011;4](#NC4-assembly-block-creates-dirty-bits) | Assembly block creates dirty bits | 1 |
| [NC&#x2011;5](#NC5-assembly-blocks-should-have-extensive-comments) | Assembly blocks should have extensive comments | 40 |
| [NC&#x2011;6](#NC6-avoid-external-calls-in-modifiers) | Avoid external calls in modifiers | 1 |
| [NC&#x2011;7](#NC7-avoid-mutating-function/modifier-parameters) | Avoid mutating `function`/`modifier` parameters | 8 |
| [NC&#x2011;8](#NC8-avoid-the-use-of-sensitive-terms) | Avoid the use of sensitive terms | 40 |
| [NC&#x2011;9](#NC9-codebase-should-implement-formal-verification-testing) | Codebase should implement formal verification testing | 1 |
| [NC&#x2011;10](#NC10-common-functions-should-be-refactored-to-a-common-base-contract) | Common functions should be refactored to a common base contract | 1 |
| [NC&#x2011;11](#NC11-complicated-functions-should-have-explicit-comments) | Complicated functions should have explicit comments | 9 |
| [NC&#x2011;12](#NC12-consider-adding-a-block/deny-list) | Consider adding a block/deny-list | 34 |
| [NC&#x2011;13](#NC13-consider-disallowing-transfers-to-addressthis) | Consider disallowing transfers to `address(this)` | 5 |
| [NC&#x2011;14](#NC14-consider-making-contracts-upgradeable) | Consider making contracts `Upgradeable` | 37 |
| [NC&#x2011;15](#NC15-consider-moving-duplicated-strings-to-constants) | Consider moving duplicated strings to constants | 31 |
| [NC&#x2011;16](#NC16-consider-providing-a-ranged-getter-for-array-state-variables) | Consider providing a ranged getter for array state variables | 9 |
| [NC&#x2011;17](#NC17-consider-using-delete-rather-than-assigning-zero-to-clear-values) | Consider using `delete` rather than assigning zero to clear values | 3 |
| [NC&#x2011;18](#NC18-consider-using-named-function-arguments) | Consider using named function arguments | 14 |
| [NC&#x2011;19](#NC19-consider-using-named-mappings) | Consider using named mappings | 9 |
| [NC&#x2011;20](#NC20-constants-in-comparisons-should-appear-on-the-left-side) | Constants in comparisons should appear on the left side | 40 |
| [NC&#x2011;21](#NC21-constants-should-be-defined-rather-than-using-magic-numbers) | `constant`s should be defined rather than using magic numbers | 40 |
| [NC&#x2011;22](#NC22-constants/immutables-redefined-elsewhere) | `constant`s/`immutable`s redefined elsewhere | 36 |
| [NC&#x2011;23](#NC23-constructor-should-emit-an-event) | `constructor` should emit an event | 7 |
| [NC&#x2011;24](#NC24-contract-implements-interface-without-extending-the-interface) | Contract implements interface without extending the interface | 8 |
| [NC&#x2011;25](#NC25-contract-timekeeping-will-break-earlier-than-the-ethereum-network-itself-will-stop-working) | Contract timekeeping will break earlier than the Ethereum network itself will stop working | 3 |
| [NC&#x2011;26](#NC26-contract-uses-both-require/revert-as-well-as-custom-errors) | Contract uses both `require()`/`revert()` as well as custom errors | 1 |
| [NC&#x2011;27](#NC27-contract/library-definition-inside-interface-folder) | `contract`/`library` definition inside interface folder | 1 |
| [NC&#x2011;28](#NC28-contract/library/interface-definitions-should-be-defined-in-separate-files) | `contract`/`library`/`interface` definitions should be defined in separate files | 6 |
| [NC&#x2011;29](#NC29-contracts-containing-only-utility-functions-should-be-made-into-libraries) | Contracts containing only utility functions should be made into libraries | 2 |
| [NC&#x2011;30](#NC30-contracts-should-have-all-public/external-functions-exposed-by-interfaces) | Contracts should have all `public`/`external` functions exposed by `interface`s | 29 |
| [NC&#x2011;31](#NC31-contracts-should-have-full-test-coverage) | Contracts should have full test coverage | 1 |
| [NC&#x2011;32](#NC32-control-structures-do-not-follow-the-solidity-style-guide) | Control structures do not follow the Solidity Style Guide | 1 |
| [NC&#x2011;33](#NC33-custom-errors-should-be-used-rather-than-revert/require) | Custom errors should be used rather than `revert()`/`require()` | 40 |
| [NC&#x2011;34](#NC34-do-not-cache-constants) | Do not cache constants | 21 |
| [NC&#x2011;35](#NC35-do-not-use-underscore-at-the-end-of-variable-name) | Do not use underscore at the end of variable name | 1 |
| [NC&#x2011;36](#NC36-do-not-use-underscore-in-struct-elements-names) | Do not use UNDERSCORE in `struct` elements names | 1 |
| [NC&#x2011;37](#NC37-else-block-not-required) | `else`-block not required | 1 |
| [NC&#x2011;38](#NC38-empty-bytes-check-is-missing) | Empty bytes check is missing | 40 |
| [NC&#x2011;39](#NC39-empty-function-body) | Empty function body | 8 |
| [NC&#x2011;40](#NC40-enum-values-should-be-used-instead-of-constant-array-indexes) | Enum values should be used instead of constant array indexes | 40 |
| [NC&#x2011;41](#NC41-error-messages-should-be-descriptive-rather-than-cryptic) | Error messages should be descriptive rather than cryptic | 40 |
| [NC&#x2011;42](#NC42-event-emit-should-emit-a-parameter) | Event emit should emit a parameter | 2 |
| [NC&#x2011;43](#NC43-event-is-missing-indexed-fields) | Event is missing `indexed` fields | 27 |
| [NC&#x2011;44](#NC44-events-are-missing-sender-information) | Events are missing sender information | 40 |
| [NC&#x2011;45](#NC45-events-may-be-emitted-out-of-order-due-to-reentrancy) | Events may be emitted out of order due to reentrancy | 6 |
| [NC&#x2011;46](#NC46-events-should-be-emitted-before-external-calls) | Events should be emitted before external calls | 33 |
| [NC&#x2011;47](#NC47-events-should-use-parameters-to-convey-information) | Events should use parameters to convey information | 2 |
| [NC&#x2011;48](#NC48-events-that-mark-critical-parameter-changes-should-contain-both-the-old-and-the-new-value) | Events that mark critical parameter changes should contain both the old and the new value | 13 |
| [NC&#x2011;49](#NC49-expressions-for-constant-values-should-use-immutable-rather-than-constant) | Expressions for `constant` values should use `immutable` rather than constant | 9 |
| [NC&#x2011;50](#NC50-extraneous-whitespace) | Extraneous whitespace | 6 |
| [NC&#x2011;51](#NC51-for-loops-in-public-or-external-functions-should-be-avoided-due-to-high-gas-costs-and-possible-dos) | For loops in `public` or `external` functions should be avoided due to high gas costs and possible DOS | 10 |
| [NC&#x2011;52](#NC52-function-called-does-not-exist-in-the-contract-interface) | Function called does not exist in the contract interface | 17 |
| [NC&#x2011;53](#NC53-function-ordering-in-the-contract-does-not-follow-the-solidity-style-guide) | Function ordering in the contract does not follow the Solidity style guide | 40 |
| [NC&#x2011;54](#NC54-functions-contain-the-same-code) | Functions contain the same code | 38 |
| [NC&#x2011;55](#NC55-functions-not-used-internally-could-be-marked-external) | Functions not used internally could be marked external | 15 |
| [NC&#x2011;56](#NC56-functions-should-be-named-in-mixedcase-style) | Functions should be named in mixedCase style | 13 |
| [NC&#x2011;57](#NC57-high-cyclomatic-complexity) | High cyclomatic complexity | 7 |
| [NC&#x2011;58](#NC58-if-statement-can-be-converted-to-a-ternary) | `if`-statement can be converted to a ternary | 4 |
| [NC&#x2011;59](#NC59-import-declarations-should-import-specific-identifiers-rather-than-the-whole-file) | Import declarations should import specific identifiers, rather than the whole file | 40 |
| [NC&#x2011;60](#NC60-imports-could-be-organized-more-systematically) | Imports could be organized more systematically | 22 |
| [NC&#x2011;61](#NC61-inconsistent-spacing-in-comments) | Inconsistent spacing in comments | 40 |
| [NC&#x2011;62](#NC62-initialisms-should-be-capitalized) | Initialisms should be capitalized | 2 |
| [NC&#x2011;63](#NC63-large-multiples-of-ten-should-use-scientific-notation) | Large multiples of ten should use scientific notation | 6 |
| [NC&#x2011;64](#NC64-large-numeric-literals-should-use-underscores-for-readability) | Large numeric literals should use underscores for readability | 7 |
| [NC&#x2011;65](#NC65-large-or-complicated-code-bases-should-implement-invariant-tests) | Large or complicated code bases should implement invariant tests | 1 |
| [NC&#x2011;66](#NC66-layout-order-does-not-comply-with-best-practices) | Layout order does not comply with best practices | 40 |
| [NC&#x2011;67](#NC67-libraries-should-be-defined-in-separate-files-from-their-usage) | Libraries should be defined in separate files from their usage | 2 |
| [NC&#x2011;68](#NC68-lines-are-too-long) | Lines are too long | 40 |
| [NC&#x2011;69](#NC69-long-functions-should-be-refactored-into-multiple-smaller-functions) | Long functions should be refactored into multiple, smaller, functions | 16 |
| [NC&#x2011;70](#NC70-make-use-of-soliditys-using-keyword) | Make use of Solidity's `using` keyword | 40 |
| [NC&#x2011;71](#NC71-minting-to-the-zero-address-should-be-avoided) | Minting to the zero address should be avoided | 2 |
| [NC&#x2011;72](#NC72-missing-checks-for-address0x0-in-the-constructor) | Missing checks for `address(0x0)` in the constructor | 4 |
| [NC&#x2011;73](#NC73-missing-checks-for-uint-state-variable-assignments) | Missing checks for uint state variable assignments | 27 |
| [NC&#x2011;74](#NC74-missing-events-in-initializers) | Missing events in initializers | 6 |
| [NC&#x2011;75](#NC75-mixed-usage-of-int/uint-with-int256/uint256) | Mixed usage of `int/uint` with `int256/uint256` | 1 |
| [NC&#x2011;76](#NC76-multiple-mappings-with-same-keys-can-be-combined-into-a-single-struct-mapping-for-readability) | Multiple mappings with same keys can be combined into a single struct mapping for readability | 19 |
| [NC&#x2011;77](#NC77-multiple-type-casts-create-complexity-within-the-code) | Multiple type casts create complexity within the code | 40 |
| [NC&#x2011;78](#NC78-named-imports-of-parent-contracts-are-missing) | Named imports of parent contracts are missing | 4 |
| [NC&#x2011;79](#NC79-names-of-private/internal-state-variables-should-be-prefixed-with-an-underscore) | Names of private/internal state variables should be prefixed with an underscore | 28 |
| [NC&#x2011;80](#NC80-natspec-contract-declarations-should-have-@author-tags) | NatSpec: Contract declarations should have `@author` tags | 25 |
| [NC&#x2011;81](#NC81-natspec-contract-declarations-should-have-@dev-tags) | NatSpec: Contract declarations should have `@dev` tags | 40 |
| [NC&#x2011;82](#NC82-natspec-contract-declarations-should-have-@notice-tags) | NatSpec: Contract declarations should have `@notice` tags | 40 |
| [NC&#x2011;83](#NC83-natspec-contract-declarations-should-have-@title-tags) | NatSpec: Contract declarations should have `@title` tags | 40 |
| [NC&#x2011;84](#NC84-natspec-contract-declarations-should-have-natspec-descriptions) | NatSpec: Contract declarations should have NatSpec descriptions | 22 |
| [NC&#x2011;85](#NC85-natspec-error-missing-natspec-@dev-tag) | NatSpec: Error missing NatSpec `@dev` tag | 2 |
| [NC&#x2011;86](#NC86-natspec-error-missing-natspec-@param-tag) | NatSpec: Error missing NatSpec `@param` tag | 2 |
| [NC&#x2011;87](#NC87-natspec-event-declarations-should-have-@notice-tags) | NatSpec: Event declarations should have `@notice` tags | 34 |
| [NC&#x2011;88](#NC88-natspec-event-declarations-should-have-natspec-descriptions) | NatSpec: Event declarations should have NatSpec descriptions | 33 |
| [NC&#x2011;89](#NC89-natspec-event-missing-natspec-@dev-tag) | NatSpec: Event missing NatSpec `@dev` tag | 40 |
| [NC&#x2011;90](#NC90-natspec-event-missing-natspec-@param-tag) | NatSpec: Event missing NatSpec `@param` tag | 40 |
| [NC&#x2011;91](#NC91-natspec-file-is-missing-natspec-documentation) | NatSpec: File is missing NatSpec Documentation | 21 |
| [NC&#x2011;92](#NC92-natspec-function-declarations-should-have-@notice-tags) | NatSpec: Function declarations should have `@notice` tags | 40 |
| [NC&#x2011;93](#NC93-natspec-function-declarations-should-have-natspec-descriptions) | NatSpec: Function declarations should have NatSpec descriptions | 40 |
| [NC&#x2011;94](#NC94-natspec-functions-missing-natspec-@dev-tag) | NatSpec: Functions missing NatSpec `@dev` tag | 40 |
| [NC&#x2011;95](#NC95-natspec-functions-missing-natspec-@param-tag) | NatSpec: Functions missing NatSpec `@param` tag | 40 |
| [NC&#x2011;96](#NC96-natspec-functions-missing-natspec-@return-tag) | NatSpec: Functions missing NatSpec `@return` tag | 40 |
| [NC&#x2011;97](#NC97-natspec-modifier-declarations-should-have-natspec-descriptions) | NatSpec: Modifier declarations should have NatSpec descriptions | 12 |
| [NC&#x2011;98](#NC98-natspec-modifier-missing-natspec-@dev-tag) | NatSpec: Modifier missing NatSpec `@dev` tag | 29 |
| [NC&#x2011;99](#NC99-natspec-modifier-missing-natspec-@param-tag) | NatSpec: Modifier missing NatSpec `@param` tag | 5 |
| [NC&#x2011;100](#NC100-non-assembly-method-available) | Non-assembly method available | 2 |
| [NC&#x2011;101](#NC101-non-external/public-function-names-should-begin-with-an-underscore) | Non-`external`/`public` function names should begin with an underscore | 40 |
| [NC&#x2011;102](#NC102-not-using-the-latest-versions-of-project-dependencies) | Not using the latest versions of project dependencies | 1 |
| [NC&#x2011;103](#NC103-not-using-the-named-return-variables-anywhere-in-the-function-is-confusing) | Not using the named return variables anywhere in the function is confusing | 4 |
| [NC&#x2011;104](#NC104-outdated-solidity-version) | Outdated Solidity version | 40 |
| [NC&#x2011;105](#NC105-overly-complicated-arithmetic) | Overly complicated arithmetic | 2 |
| [NC&#x2011;106](#NC106-overridden-function-has-no-body) | Overridden function has no body | 3 |
| [NC&#x2011;107](#NC107-override-function-arguments-that-are-unused-should-have-the-variable-name-removed-or-commented-out-to-avoid-compiler-warnings) | `override` function arguments that are unused should have the variable name removed or commented out to avoid compiler warnings | 2 |
| [NC&#x2011;108](#NC108-parameter-change-does-not-emit-event) | Parameter change does not emit event | 10 |
| [NC&#x2011;109](#NC109-place-interface-files-into-a-dedicated-folder) | Place `interface` files into a dedicated folder | 8 |
| [NC&#x2011;110](#NC110-polymorphic-functions-make-security-audits-more-time-consuming-and-error-prone) | Polymorphic functions make security audits more time-consuming and error-prone | 4 |
| [NC&#x2011;111](#NC111-prefer-skip-over-revert-model-in-iteration) | Prefer skip over revert model in iteration | 14 |
| [NC&#x2011;112](#NC112-public-functions-not-called-by-the-contract-should-be-declared-external-instead) | `public` functions not called by the contract should be declared `external` instead | 17 |
| [NC&#x2011;113](#NC113-receive/payable-fallback-function-does-not-authorize-requests) | `receive()`/`payable fallback()` function does not authorize requests | 7 |
| [NC&#x2011;114](#NC114-redundant-ierc20-import) | Redundant IERC20 import | 6 |
| [NC&#x2011;115](#NC115-require-/-revert-statements-should-have-descriptive-reason-strings) | `require()` / `revert()` statements should have descriptive reason strings | 2 |
| [NC&#x2011;116](#NC116-returning-a-struct-instead-of-a-bunch-of-variables-is-better) | Returning a struct instead of a bunch of variables is better | 6 |
| [NC&#x2011;117](#NC117-simplify-complex-require-statements) | Simplify complex require statements | 3 |
| [NC&#x2011;118](#NC118-some-contracts-can-be-abstract) | Some contracts can be abstract | 2 |
| [NC&#x2011;119](#NC119-some-events-are-never-emitted) | Some events are never emitted | 5 |
| [NC&#x2011;120](#NC120-some-variables-have-a-implicit-default-visibility) | Some variables have a implicit default visibility | 11 |
| [NC&#x2011;121](#NC121-state-variables-should-include-comments) | State variables should include comments | 40 |
| [NC&#x2011;122](#NC122-the-nonreentrant-modifier-should-occur-before-all-other-modifiers) | The `nonReentrant` `modifier` should occur before all other modifiers | 2 |
| [NC&#x2011;123](#NC123-todo-left-in-the-code) | TODO Left in the code | 2 |
| [NC&#x2011;124](#NC124-top-level-declarations-should-be-separated-by-at-least-two-lines) | Top-level declarations should be separated by at least two lines | 40 |
| [NC&#x2011;125](#NC125-unnecessary-cast) | Unnecessary cast | 17 |
| [NC&#x2011;126](#NC126-unspecific-compiler-version-pragma) | Unspecific compiler version pragma | 1 |
| [NC&#x2011;127](#NC127-unused-contract-variables) | Unused contract variables | 3 |
| [NC&#x2011;128](#NC128-unused-event-definition) | Unused `event` definition | 5 |
| [NC&#x2011;129](#NC129-unused-function-parameter) | Unused function parameter | 1 |
| [NC&#x2011;130](#NC130-unused-modifier-definition) | Unused `modifier` definition | 14 |
| [NC&#x2011;131](#NC131-unusual-loop-variable) | Unusual loop variable | 1 |
| [NC&#x2011;132](#NC132-use-@inheritdoc-for-overridden-functions) | Use `@inheritdoc` for overridden functions | 40 |
| [NC&#x2011;133](#NC133-use-a-single-file-for-system-wide-constants) | Use a single file for system wide constants | 31 |
| [NC&#x2011;134](#NC134-use-a-struct-to-encapsulate-multiple-function-parameters) | Use a struct to encapsulate multiple function parameters | 40 |
| [NC&#x2011;135](#NC135-use-bit-shifts-in-an-imutable-variable-rather-than-long-bit-masks-of-a-single-bit-for-readability) | Use bit shifts in an imutable variable rather than long bit masks of a single bit, for readability | 3 |
| [NC&#x2011;136](#NC136-use-bytesconcat-on-bytes-instead-of-abiencodepacked-for-clearer-semantic-meaning) | Use `bytes.concat()` on bytes instead of `abi.encodePacked()` for clearer semantic meaning | 6 |
| [NC&#x2011;137](#NC137-use-camelcase-for-contract-and-library-names) | Use CamelCase for contract and library names | 1 |
| [NC&#x2011;138](#NC138-use-delete-instead-of-assigning-values-to-false) | Use delete instead of assigning values to `false` | 3 |
| [NC&#x2011;139](#NC139-use-eip-5627-to-describe-eip-712-domains) | Use EIP-5627 to describe EIP-712 domains | 1 |
| [NC&#x2011;140](#NC140-use-of-override-is-unnecessary) | Use of `override` is unnecessary | 40 |
| [NC&#x2011;141](#NC141-use-openzeppelins-merkleproof-rather-than-rolling-your-own) | Use OpenZeppelin's `MerkleProof` rather than rolling your own | 2 |
| [NC&#x2011;142](#NC142-use-openzeppelins-reentrancyguard/reentrancyguardupgradeable-rather-than-writing-your-own) | Use OpenZeppelin's `ReentrancyGuard`/`ReentrancyGuardUpgradeable` rather than writing your own | 2 |
| [NC&#x2011;143](#NC143-use-stringconcat-on-strings-instead-of-abiencodepacked-for-clearer-semantic-meaning) | Use `string.concat()` on strings instead of `abi.encodePacked()` for clearer semantic meaning | 6 |
| [NC&#x2011;144](#NC144-use-upper_case-for-constant) | Use UPPER_CASE for `constant` | 7 |
| [NC&#x2011;145](#NC145-use-upper_case-for-immutable) | Use UPPER_CASE for `immutable` | 5 |
| [NC&#x2011;146](#NC146-variable/struct/contract-names-should-be-descriptive-rather-than-cryptic) | `variable`/`struct`/`contract` names should be descriptive rather than cryptic | 25 |
| [NC&#x2011;147](#NC147-variables-need-not-be-initialized-to-zero) | Variables need not be initialized to zero | 38 |
| [NC&#x2011;148](#NC148-variables-should-be-named-in-mixedcase-style) | Variables should be named in mixedCase style | 40 |
| [NC&#x2011;149](#NC149-zero-as-a-function-argument-should-have-a-descriptive-meaning) | Zero as a function argument should have a descriptive meaning | 23 |

👉 Total: 2503 instances over 149 issues

## Low


---
### [L&#x2011;1] Avoid shadowing state variables
Some state variables are shadowed by local variables/function parameters, this might result in the use of the wrong variable, in some scenarios. Consider renaming these variables with a different name.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

/// @audit Shadowing _version from EIP712Upgradeable
115:         uint8 _version 
```
[115](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L115)


---
### [L&#x2011;2] Avoid using `tx.origin`
`tx.origin` is a global variable in Solidity that returns the address of the account that sent the transaction.
Using the variable could make a contract vulnerable if an authorized account calls a malicious contract. You can impersonate a user using a third party contract.
This can make it easier to create a vault on behalf of another user with an external administrator (by receiving it as an argument).

<details>
<summary><i>There are 3 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

579:                 refundRecipient = _prevMsgSender != tx.origin 
```
[579](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L579)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

328:             _recipient = msg.sender == tx.origin ? msg.sender : AddressAliasHelper.applyL1ToL2Alias(msg.sender); 
```
[328](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L328)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

234:         if (l2Sender != tx.origin) { 
```
[234](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L234)

</details>


---
### [L&#x2011;3] Calling `bytes.concat()` with final arguments that may differ in length, may cause hash collisions
`bytes3(bytes2(uint16(1)))` and `bytes3(bytes3(uint24(256)))` both are equal to `0x000100`, and if they each were passed to a function used them as the last argument to `bytes.concat()`, which is the case below, the resulting bytes would be equivalent. When this sort of function is a part of a general-purpose library, or is a part of a standard, and is used for e.g. indexing storage slots, it's possible for two byte values to map to the same location. There is no safe way to ensure the caller hasn't cast bytes from a smaller size. The suggested fix is to require that the input be the result of a call to `keccak256(abi.encode(<value>))`, and truncate the extra bytes of entropy if a specific size is absolutely needed.

<details>
<summary><i>There are 19 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

68:             bytes.concat(CREATE2_PREFIX, senderBytes, _salt, _bytecodeHash, _constructorInputHash) 
```
[68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L68)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

261:         initData = bytes.concat( 
262:             IDiamondInit.initialize.selector,
263:             bytes32(_chainId),
264:             bytes32(uint256(uint160(bridgehub))),
265:             bytes32(uint256(uint160(address(this)))),
266:             bytes32(uint256(protocolVersion)),
267:             bytes32(uint256(uint160(_admin))),
268:             bytes32(uint256(uint160(validatorTimelock))),
269:             bytes32(uint256(uint160(_baseToken))),
270:             bytes32(uint256(uint160(_sharedBridge))),
271:             bytes32(storedBatchZero),
272:             diamondCut.initCalldata
273:         );
```
[261](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L261-L273)

```solidity
📁 File: contracts/zksync/contracts/L2ContractHelper.sol

109:             bytes.concat(CREATE2_PREFIX, senderBytes, _salt, _bytecodeHash, _constructorInputHash) 
```
[109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L109)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

29:             txHash = keccak256(bytes.concat(signedTxHash, EfficientCall.keccak(_transaction.signature))); 

58:             encodedGasParam = bytes.concat(encodedGasPrice, encodedGasLimit); 

121:                 bytes.concat( 
122:                     encodedListLength,
123:                     encodedNonce,
124:                     encodedGasParam,
125:                     encodedTo,
126:                     encodedValue,
127:                     encodedDataLength,
128:                     _transaction.data,
129:                     vEncoded,
130:                     rEncoded,
131:                     sEncoded
132:                 )

149:             encodedFixedLengthParams = bytes.concat( 
150:                 encodedChainId,
151:                 encodedNonce,
152:                 encodedGasPrice,
153:                 encodedGasLimit,
154:                 encodedTo,
155:                 encodedValue
156:             );

212:                 bytes.concat( 
213:                     "\x01",
214:                     encodedListLength,
215:                     encodedFixedLengthParams,
216:                     encodedDataLength,
217:                     _transaction.data,
218:                     encodedAccessListLength,
219:                     vEncoded,
220:                     rEncoded,
221:                     sEncoded
222:                 )

243:             encodedFixedLengthParams = bytes.concat( 
244:                 encodedChainId,
245:                 encodedNonce,
246:                 encodedMaxPriorityFeePerGas,
247:                 encodedMaxFeePerGas,
248:                 encodedGasLimit,
249:                 encodedTo,
250:                 encodedValue
251:             );

307:                 bytes.concat( 
308:                     "\x02",
309:                     encodedListLength,
310:                     encodedFixedLengthParams,
311:                     encodedDataLength,
312:                     _transaction.data,
313:                     encodedAccessListLength,
314:                     vEncoded,
315:                     rEncoded,
316:                     sEncoded
317:                 )
```
[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L29), [58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L58), [121](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L121-L132), [149](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L149-L156), [212](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L212-L222), [243](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L243-L251), [307](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L307-L317)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

106:             bytes.concat(CREATE2_PREFIX, bytes32(uint256(uint160(_sender))), _salt, _bytecodeHash, constructorInputHash) 

122:             bytes.concat(CREATE_PREFIX, bytes32(uint256(uint160(_sender))), bytes32(_senderNonce)) 
```
[106](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L106), [122](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L122)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

161:             encodedGasParam = bytes.concat(encodedGasPrice, encodedGasLimit); 

185:             encodedChainId = bytes.concat(RLPEncoder.encodeUint256(block.chainid), hex"80_80"); 

204:                 bytes.concat( 
205:                     encodedListLength,
206:                     encodedNonce,
207:                     encodedGasParam,
208:                     encodedTo,
209:                     encodedValue,
210:                     encodedDataLength,
211:                     _transaction.data,
212:                     encodedChainId
213:                 )

234:             encodedFixedLengthParams = bytes.concat( 
235:                 encodedChainId,
236:                 encodedNonce,
237:                 encodedGasPrice,
238:                 encodedGasLimit,
239:                 encodedTo,
240:                 encodedValue
241:             );

276:                 bytes.concat( 
277:                     "\x01",
278:                     encodedListLength,
279:                     encodedFixedLengthParams,
280:                     encodedDataLength,
281:                     _transaction.data,
282:                     encodedAccessListLength
283:                 )

305:             encodedFixedLengthParams = bytes.concat( 
306:                 encodedChainId,
307:                 encodedNonce,
308:                 encodedMaxPriorityFeePerGas,
309:                 encodedMaxFeePerGas,
310:                 encodedGasLimit,
311:                 encodedTo,
312:                 encodedValue
313:             );

348:                 bytes.concat( 
349:                     "\x02",
350:                     encodedListLength,
351:                     encodedFixedLengthParams,
352:                     encodedDataLength,
353:                     _transaction.data,
354:                     encodedAccessListLength
355:                 )
```
[161](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L161), [185](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L185), [204](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L204-L213), [234](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L234-L241), [276](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L276-L283), [305](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L305-L313), [348](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L348-L355)

</details>


---
### [L&#x2011;4] Consider bounding input array length
The functions below take in an unbounded array, and make function calls for entries in the array. While the function will revert if it eventually runs out of gas, it may be a nicer user experience to `require()` that the length of the array is below some reasonable maximum, so that the user doesn't have to use up a full transaction's gas only to see that the transaction reverts.

<details>
<summary><i>There are 8 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit _newBatchesData.length not bounded
116:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { 
117:                 committedBatchTimestamp[ERA_CHAIN_ID].set(_newBatchesData[i].batchNumber, timestamp);
118:             }

/// @audit _newBatchesData.length not bounded
135:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { 
136:                 committedBatchTimestamp[_chainId].set(_newBatchesData[i].batchNumber, timestamp);
137:             }

/// @audit _newBatchesData.length not bounded
185:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { 
186:                 uint256 commitBatchTimestamp = committedBatchTimestamp[ERA_CHAIN_ID].get(
187:                     _newBatchesData[i].batchNumber
188:                 );
189: 
190:                 // Note: if the `commitBatchTimestamp` is zero, that means either:
191:                 // * The batch was committed, but not through this contract.
192:                 // * The batch wasn't committed at all, so execution will fail in the zkSync contract.
193:                 // We allow executing such batches.
194: 
195:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c"); // The delay is not passed
196:             }

/// @audit _newBatchesData.length not bounded
209:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { 
210:                 uint256 commitBatchTimestamp = committedBatchTimestamp[_chainId].get(_newBatchesData[i].batchNumber);
211: 
212:                 // Note: if the `commitBatchTimestamp` is zero, that means either:
213:                 // * The batch was committed, but not through this contract.
214:                 // * The batch wasn't committed at all, so execution will fail in the zkSync contract.
215:                 // We allow executing such batches.
216: 
217:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c"); // The delay is not passed
218:             }
```
[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L116-L118), [135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L135-L137), [185](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L185-L196), [209](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L209-L218)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

/// @audit _deployments.length not bounded
248:         for (uint256 i = 0; i < deploymentsLength; ++i) { 
249:             sumOfValues += _deployments[i].value;
250:         }

/// @audit _deployments.length not bounded
253:         for (uint256 i = 0; i < deploymentsLength; ++i) { 
254:             this.forceDeployOnAddress{value: _deployments[i].value}(_deployments[i], msg.sender);
255:         }
```
[248](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L248-L250), [253](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L253-L255)

```solidity
📁 File: system-contracts/contracts/ImmutableSimulator.sol

/// @audit _immutables.length not bounded
38:             for (uint256 i = 0; i < immutablesLength; ++i) { 
39:                 uint256 index = _immutables[i].index;
40:                 bytes32 value = _immutables[i].value;
41:                 immutableDataStorage[uint256(uint160(_dest))][index] = value;
42:             }
```
[38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L38-L42)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

/// @audit _hashes.length not bounded
30:             for (uint256 i = 0; i < hashesLen; ++i) { 
31:                 _markBytecodeAsPublished(_hashes[i], _shouldSendToL1);
32:             }
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L30-L32)

</details>


---
### [L&#x2011;5] Consider disabling `renounceOwnership()`
Typically, the contract's owner is the account that deploys the contract. As a result, the owner is able to perform certain privileged activities. The OpenZeppelin's `Ownable` is used in this project contract implements `renounceOwnership`. This can represent a certain risk if the ownership is renounced for any other reason than by design. Renouncing ownership will leave the contract without an owner, thereby removing any functionality that is only available to the owner.

<details>
<summary><i>There are 5 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step { 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step { 
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

20: contract Governance is IGovernance, Ownable2Step { 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L20)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step { 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L25)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

22: contract ValidatorTimelock is IExecutor, Ownable2Step { 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L22)

</details>


---
### [L&#x2011;6] Consider implementing two-step procedure for updating protocol addresses
A copy-paste error or a typo may end up bricking protocol functionality, or sending tokens to an address with no known private key. Consider implementing a two-step procedure for updating protocol addresses, where the recipient is set as pending, and must 'accept' the assignment by making an affirmative call. A straight forward way of doing this would be to have the target contracts implement [EIP-165](https://eips.ethereum.org/EIPS/eip-165), and to have the 'set' functions ensure that the recipient is of the right interface type.

<details>
<summary><i>There are 6 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit line 55
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 
52:         // Save previous value into the stack to put it into the event later
53:         address oldPendingAdmin = pendingAdmin;
54:         // Change pending admin
55:         pendingAdmin = _newPendingAdmin;
56:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
57:     }
```
[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L57)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

/// @audit line 258
256:     function updateSecurityCouncil(address _newSecurityCouncil) external onlySelf { 
257:         emit ChangeSecurityCouncil(securityCouncil, _newSecurityCouncil);
258:         securityCouncil = _newSecurityCouncil;
259:     }
```
[256](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L256-L259)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit line 114
110:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 
111:         // Save previous value into the stack to put it into the event later
112:         address oldPendingAdmin = pendingAdmin;
113:         // Change pending admin
114:         pendingAdmin = _newPendingAdmin;
115:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
116:     }

/// @audit line 133
132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin { 
133:         validatorTimelock = _validatorTimelock;
134:     }
```
[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L110-L116), [132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132-L134)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

/// @audit line 27
23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin { 
24:         // Save previous value into the stack to put it into the event later
25:         address oldPendingAdmin = s.pendingAdmin;
26:         // Change pending admin
27:         s.pendingAdmin = _newPendingAdmin;
28:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
29:     }
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L23-L29)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

/// @audit line 100
99:     function setTxOrigin(address _newOrigin) external onlyCallFromBootloader { 
100:         origin = _newOrigin;
101:     }
```
[99](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L99-L101)

</details>


---
### [L&#x2011;7] `constructor`/`initialize` function lacks parameter validation
Constructors and initialization functions play a critical role in contracts by setting important initial states when the contract is first deployed before the system starts. The parameters passed to the constructor and initialization functions directly affect the behavior of the contract / protocol. If incorrect parameters are provided, the system may fail to run, behave abnormally, be unstable, or lack security. Therefore, it's crucial to carefully check each parameter in the constructor and initialization functions. If an exception is found, the transaction should be rolled back.

<details>
<summary><i>There are 11 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit _sharedBridge 
55:     constructor(IL1SharedBridge _sharedBridge) reentrancyGuardInitializer { 
```
[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L55)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit _l1WethAddress , _bridgehub , _legacyBridge 
90:     constructor( 
91:         address _l1WethAddress,
92:         IBridgehub _bridgehub,
93:         IL1ERC20Bridge _legacyBridge
94:     ) reentrancyGuardInitializer {

/// @audit _owner , _eraFirstPostUpgradeBatch 
104:     function initialize( 
105:         address _owner,
106:         uint256 _eraFirstPostUpgradeBatch
107:     ) external reentrancyGuardInitializer initializer {
```
[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L90-L94), [104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L104-L107)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit _owner 
41:     function initialize(address _owner) external reentrancyGuardInitializer { 
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L41)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

/// @audit _admin , _securityCouncil , _minDelay 
41:     constructor(address _admin, address _securityCouncil, uint256 _minDelay) { 
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L41)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit _bridgehub 
58:     constructor(address _bridgehub) reentrancyGuardInitializer { 

/// @audit _initializeData 
79:     function initialize( 
80:         StateTransitionManagerInitializeData calldata _initializeData
81:     ) external reentrancyGuardInitializer {
```
[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L58), [79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L79-L81)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit _initialOwner , _executionDelay 
55:     constructor(address _initialOwner, uint32 _executionDelay) { 
```
[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L55)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

/// @audit _initializeData 
24:     function initialize(InitializeData calldata _initializeData) external reentrancyGuardInitializer returns (bytes32) { 
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L24)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

/// @audit _chainId , _diamondCut 
11:     constructor(uint256 _chainId, Diamond.DiamondCutData memory _diamondCut) { 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L11)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

/// @audit _l1LegecyBridge , _aliasedOwner 
49:     function initialize( 
50:         address _l1Bridge,
51:         address _l1LegecyBridge,
52:         bytes32 _l2TokenProxyBytecodeHash,
53:         address _aliasedOwner
54:     ) external reinitializer(2) {
```
[49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L49-L54)

</details>


---
### [L&#x2011;8] Contracts are not using their OZ Upgradeable counterparts
The non-upgradeable standard version of OpenZeppelin’s library, such as `Ownable`, `Pausable`, `Address`, `Context`, `SafeERC20`, `ERC1967Upgrade` etc, are inherited / used by both the proxy and the implementation contracts.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

6: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol"; 
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L6)


---
### [L&#x2011;9] Critical functions should be controlled by time locks
It is a good practice to give time for users to react and adjust to critical changes. A timelock provides more guarantees and reduces the level of trust required, thus decreasing risk for users. It also indicates that the project is legitimate (less risk of a malicious owner making a sandwich attack on a user).

<details>
<summary><i>There are 22 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 
52:         // Save previous value into the stack to put it into the event later
53:         address oldPendingAdmin = pendingAdmin;
54:         // Change pending admin
55:         pendingAdmin = _newPendingAdmin;
56:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
57:     }

82:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner { 
83:         require(
84:             !stateTransitionManagerIsRegistered[_stateTransitionManager],
85:             "Bridgehub: state transition already registered"
86:         );
87:         stateTransitionManagerIsRegistered[_stateTransitionManager] = true;
88:     }

92:     function removeStateTransitionManager(address _stateTransitionManager) external onlyOwner { 
93:         require(
94:             stateTransitionManagerIsRegistered[_stateTransitionManager],
95:             "Bridgehub: state transition not registered yet"
96:         );
97:         stateTransitionManagerIsRegistered[_stateTransitionManager] = false;
98:     }

101:     function addToken(address _token) external onlyOwner { 
102:         require(!tokenIsRegistered[_token], "Bridgehub: token already registered");
103:         tokenIsRegistered[_token] = true;
104:     }

108:     function setSharedBridge(address _sharedBridge) external onlyOwner { 
109:         sharedBridge = IL1SharedBridge(_sharedBridge);
110:     }
```
[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L57), [82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L82-L88), [92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L92-L98), [101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L101-L104), [108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108-L110)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

249:     function updateDelay(uint256 _newDelay) external onlySelf { 
250:         emit ChangeMinDelay(minDelay, _newDelay);
251:         minDelay = _newDelay;
252:     }

256:     function updateSecurityCouncil(address _newSecurityCouncil) external onlySelf { 
257:         emit ChangeSecurityCouncil(securityCouncil, _newSecurityCouncil);
258:         securityCouncil = _newSecurityCouncil;
259:     }
```
[249](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L249-L252), [256](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L256-L259)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

110:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 
111:         // Save previous value into the stack to put it into the event later
112:         address oldPendingAdmin = pendingAdmin;
113:         // Change pending admin
114:         pendingAdmin = _newPendingAdmin;
115:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
116:     }

132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin { 
133:         validatorTimelock = _validatorTimelock;
134:     }
```
[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L110-L116), [132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132-L134)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

96:     function setExecutionDelay(uint32 _executionDelay) external onlyOwner { 
97:         executionDelay = _executionDelay;
98:         emit NewExecutionDelay(_executionDelay);
99:     }
```
[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L96-L99)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin { 
24:         // Save previous value into the stack to put it into the event later
25:         address oldPendingAdmin = s.pendingAdmin;
26:         // Change pending admin
27:         s.pendingAdmin = _newPendingAdmin;
28:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
29:     }

51:     function setPorterAvailability(bool _zkPorterIsAvailable) external onlyStateTransitionManager { 
52:         // Change the porter availability
53:         s.zkPorterIsAvailable = _zkPorterIsAvailable;
54:         emit IsPorterAvailableStatusUpdate(_zkPorterIsAvailable);
55:     }

58:     function setPriorityTxMaxGasLimit(uint256 _newPriorityTxMaxGasLimit) external onlyStateTransitionManager { 
59:         require(_newPriorityTxMaxGasLimit <= MAX_GAS_PER_TRANSACTION, "n5");
60: 
61:         uint256 oldPriorityTxMaxGasLimit = s.priorityTxMaxGasLimit;
62:         s.priorityTxMaxGasLimit = _newPriorityTxMaxGasLimit;
63:         emit NewPriorityTxMaxGasLimit(oldPriorityTxMaxGasLimit, _newPriorityTxMaxGasLimit);
64:     }
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L23-L29), [51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L51-L55), [58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L58-L64)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

92:     function _setL2DefaultAccountBytecodeHash(bytes32 _l2DefaultAccountBytecodeHash) private { 
93:         if (_l2DefaultAccountBytecodeHash == bytes32(0)) {
94:             return;
95:         }
96: 
97:         L2ContractHelper.validateBytecodeHash(_l2DefaultAccountBytecodeHash);
98: 
99:         // Save previous value into the stack to put it into the event later
100:         bytes32 previousDefaultAccountBytecodeHash = s.l2DefaultAccountBytecodeHash;
101: 
102:         // Change the default account bytecode hash
103:         s.l2DefaultAccountBytecodeHash = _l2DefaultAccountBytecodeHash;
104:         emit NewL2DefaultAccountBytecodeHash(previousDefaultAccountBytecodeHash, _l2DefaultAccountBytecodeHash);
105:     }

109:     function _setL2BootloaderBytecodeHash(bytes32 _l2BootloaderBytecodeHash) private { 
110:         if (_l2BootloaderBytecodeHash == bytes32(0)) {
111:             return;
112:         }
113: 
114:         L2ContractHelper.validateBytecodeHash(_l2BootloaderBytecodeHash);
115: 
116:         // Save previous value into the stack to put it into the event later
117:         bytes32 previousBootloaderBytecodeHash = s.l2BootloaderBytecodeHash;
118: 
119:         // Change the bootloader bytecode hash
120:         s.l2BootloaderBytecodeHash = _l2BootloaderBytecodeHash;
121:         emit NewL2BootloaderBytecodeHash(previousBootloaderBytecodeHash, _l2BootloaderBytecodeHash);
122:     }

236:     function _setNewProtocolVersion(uint256 _newProtocolVersion) internal virtual { 
237:         uint256 previousProtocolVersion = s.protocolVersion;
238:         require(
239:             _newProtocolVersion > previousProtocolVersion,
240:             "New protocol version is not greater than the current one"
241:         );
242:         require(
243:             _newProtocolVersion - previousProtocolVersion <= MAX_ALLOWED_PROTOCOL_VERSION_DELTA,
244:             "Too big protocol version difference"
245:         );
246: 
247:         // If the previous upgrade had an L2 system upgrade transaction, we require that it is finalized.
248:         // Note it is important to keep this check, as otherwise hyperchains might skip upgrades by overwriting
249:         require(s.l2SystemContractsUpgradeTxHash == bytes32(0), "Previous upgrade has not been finalized");
250:         require(
251:             s.l2SystemContractsUpgradeBatchNumber == 0,
252:             "The batch number of the previous upgrade has not been cleaned"
253:         );
254: 
255:         s.protocolVersion = _newProtocolVersion;
256:         emit NewProtocolVersion(previousProtocolVersion, _newProtocolVersion);
257:     }

263:     function _upgradeL1Contract(bytes calldata _customCallDataForUpgrade) internal virtual {} 

269:     function _postUpgrade(bytes calldata _customCallDataForUpgrade) internal virtual {} 
```
[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L92-L105), [109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L109-L122), [236](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L236-L257), [263](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L263), [269](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L269)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

20:     function _setNewProtocolVersion(uint256 _newProtocolVersion) internal override { 
21:         uint256 previousProtocolVersion = s.protocolVersion;
22:         require(
23:             // Genesis Upgrade difference: Note this is the only thing change > to >=
24:             _newProtocolVersion >= previousProtocolVersion,
25:             "New protocol version is not greater than the current one"
26:         );
27:         require(
28:             _newProtocolVersion - previousProtocolVersion <= MAX_ALLOWED_PROTOCOL_VERSION_DELTA,
29:             "Too big protocol version difference"
30:         );
31: 
32:         // If the previous upgrade had an L2 system upgrade transaction, we require that it is finalized.
33:         require(s.l2SystemContractsUpgradeTxHash == bytes32(0), "Previous upgrade has not been finalized");
34:         require(
35:             s.l2SystemContractsUpgradeBatchNumber == 0,
36:             "The batch number of the previous upgrade has not been cleaned"
37:         );
38: 
39:         s.protocolVersion = _newProtocolVersion;
40:         emit NewProtocolVersion(previousProtocolVersion, _newProtocolVersion);
41:     }
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L20-L41)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

84:     function setChainId(uint256 _newChainId) external onlyCallFromForceDeployer { 
85:         chainId = _newChainId;
86:     }

99:     function setTxOrigin(address _newOrigin) external onlyCallFromBootloader { 
100:         origin = _newOrigin;
101:     }

105:     function setGasPrice(uint256 _gasPrice) external onlyCallFromBootloader { 
106:         gasPrice = _gasPrice;
107:     }
```
[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L84-L86), [99](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L99-L101), [105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L105-L107)

</details>


---
### [L&#x2011;10] Deleting mapping in struct will not delete the mapping
<details>
<summary><i>There are 2 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

247:         delete ds.selectorToFacet[_selector]; 
```
[247](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L247)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol

79:         delete _queue.data[head]; 
```
[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L79)

</details>


---
### [L&#x2011;11] Division by zero not prevented
The divisions below take an input parameter which does not have any zero-value checks, which may lead to the functions reverting when zero is passed.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

172:         uint256 minL2GasPriceBaseToken = (fullPubdataPriceBaseToken + _gasPerPubdata - 1) / _gasPerPubdata; 
```
[172](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L172)


---
### [L&#x2011;12] Do not use deprecated library functions
`safeApprove()` is deprecated in favor of `safeIncreaseAllowance()` and `safeDecreaseAllowance()`.


<i>There are 2 instaces of this issue:</i>

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

382:                 IERC20(token).safeApprove(paymaster, 0); 
383:                 IERC20(token).safeApprove(paymaster, minAllowance);
```
[382](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L382-L383)


---
### [L&#x2011;13] Draft imports may break in new minor versions
While OpenZeppelin draft contracts are safe to use and have been audited, their 'draft' status means that the EIPs they're based on are not finalized, and thus there may be breaking changes in even minor releases. If a bug is found in this version of OpenZeppelin, and the version that you're forced to upgrade to has breaking changes in the new version, you'll encounter unnecessary delays in porting and testing replacement contracts. Ensure that you have extensive test coverage of this area so that differences can be automatically detected, and have a plan in place for how you would fully test a new version of these contracts if they do indeed change unexpectedly. Consider creating a forked version of the file rather than importing it from the package, and manually patch your fork as changes are made.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

5: import {ERC20PermitUpgradeable} from "@openzeppelin/contracts-upgradeable/token/ERC20/extensions/draft-ERC20PermitUpgradeable.sol"; 
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L5)


---
### [L&#x2011;14] External calls in an un-bounded `for`-loop may result in a DOS
Consider limiting the number of iterations in `for`-loops that make external calls


<i>There is one instance of this issue:</i>

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

/// @audit line 254
253:         for (uint256 i = 0; i < deploymentsLength; ++i) { 
254:             this.forceDeployOnAddress{value: _deployments[i].value}(_deployments[i], msg.sender);
255:         }
```
[253](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L253-L255)


---
### [L&#x2011;15] File allows a version of solidity that is susceptible to `.selector`-related optimizer bug
In solidity versions prior to 0.8.21, there is a legacy code generation [bug](https://soliditylang.org/blog/2023/07/19/missing-side-effects-on-selector-access-bug/) where if `foo().selector` is called, `foo()` doesn't actually get evaluated. It is listed as low-severity, because projects usually use the contract name rather than a function call to look up the selector. I've flagged all files using `.selector` where the version is vulnerable.

<details>
<summary><i>There are 9 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L3)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L3)

```solidity
📁 File: contracts/zksync/contracts/interfaces/IPaymaster.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L3)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L3)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L3)

```solidity
📁 File: system-contracts/contracts/interfaces/IAccount.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IAccount.sol#L3)

```solidity
📁 File: system-contracts/contracts/interfaces/IPaymaster.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IPaymaster.sol#L3)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L3)

</details>


---
### [L&#x2011;16] Functions calling contracts/addresses with transfer hooks are missing reentrancy guards
Adherence to the check-effects-interaction pattern is commendable, but without a reentrancy guard in functions, especially with transfer hooks, users are exposed to read-only reentrancy risks. This can lead to malicious actions without altering the contract state. Adding a reentrancy guard is vital for security, protecting against both traditional and read-only reentrancy attacks, ensuring a robust and safe protocol.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit safeTransfer() on line 67
63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external { 
```
[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63)


---
### [L&#x2011;17] Initialization can be front-run
The `initialize()` functions below are not called by another contract atomically after the contract is deployed, so it's possible for a malicious user to call `initialize()` which, if it's noticed in time, would require the project to re-deploy the contract in order to properly initialize. Consider creating a factory contract, which will `new` and `initialize()` each contract atomically.

<details>
<summary><i>There are 8 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

60:     function initialize() external reentrancyGuardInitializer {} 
```
[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L60)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

104:     function initialize( 
105:         address _owner,
106:         uint256 _eraFirstPostUpgradeBatch
107:     ) external reentrancyGuardInitializer initializer {
```
[104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L104-L107)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

41:     function initialize(address _owner) external reentrancyGuardInitializer { 
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L41)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

65:     function initialize(StateTransitionManagerInitializeData calldata _initalizeData) external; 
```
[65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L65)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

79:     function initialize( 
80:         StateTransitionManagerInitializeData calldata _initializeData
81:     ) external reentrancyGuardInitializer {
```
[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L79-L81)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

24:     function initialize(InitializeData calldata _initializeData) external reentrancyGuardInitializer returns (bytes32) { 
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L24)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol

62:     function initialize(InitializeData calldata _initData) external returns (bytes32); 
```
[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L62)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

49:     function initialize( 
50:         address _l1Bridge,
51:         address _l1LegecyBridge,
52:         bytes32 _l2TokenProxyBytecodeHash,
53:         address _aliasedOwner
54:     ) external reinitializer(2) {
```
[49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L49-L54)

</details>


---
### [L&#x2011;18] Int casting `block.timestamp` can reduce the lifespan of a contract

<i>There are 2 instaces of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

115:             uint32 timestamp = uint32(block.timestamp); 

134:             uint32 timestamp = uint32(block.timestamp); 
```
[115](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L115), [134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L134)


---
### [L&#x2011;19] Loss of precision
Division by large numbers may result in the result being zero, due to solidity not supporting fractions. Consider requiring a minimum amount for the numerator to ensure that it is always larger than the denominator

<details>
<summary><i>There are 9 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

159:         uint256 l1GasPriceConverted = (_l1GasPrice * s.baseTokenGasPriceMultiplierNominator) / 
160:             s.baseTokenGasPriceMultiplierDenominator;

168:             batchOverheadBaseToken / 
169:             uint256(feeParams.maxPubdataPerBatch);

171:         uint256 l2GasPrice = feeParams.minimalL2GasPrice + batchOverheadBaseToken / uint256(feeParams.maxL2GasPerBatch); 
172:         uint256 minL2GasPriceBaseToken = (fullPubdataPriceBaseToken + _gasPerPubdata - 1) / _gasPerPubdata;
```
[159](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L159-L160), [168](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L168-L169), [171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L171-L172)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/LibMap.sol

23:             uint256 mapValue = _map.map[_index / 8]; 

43:             uint256 mapIndex = _index / 8; 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L23), [43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L43)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

51:         return KECCAK_ROUND_GAS_COST * (_length / KECCAK_ROUND_NUMBER_OF_BYTES + 1); 

62:         return SHA256_ROUND_GAS_COST * ((_length + 8) / SHA256_ROUND_NUMBER_OF_BYTES + 1); 
```
[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L51), [62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L62)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

180:         deploymentNonce = _rawMinNonce / DEPLOY_NONCE_MULTIPLIER; 
```
[180](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L180)

</details>


---
### [L&#x2011;20] Low level calls to custom `address`es
Low-level calls (such as `.call()`, `.delegatecall()`, or `.callcode()`) in Solidity provide a way to interact with other contracts or addresses. However, when these calls are made to addresses that are provided as parameters or are not well-validated, they pose a significant security risk. Untrusted addresses might contain malicious code leading to unexpected behavior, loss of funds, or vulnerabilities.

**Resolution**: Prefer using high-level Solidity function calls or interface-based interactions with known contracts to ensure security. If low-level calls are necessary, rigorously validate the addresses and test all possible interactions. Implementing additional checks and fail-safes can help mitigate potential risks associated with low-level calls.


<i>There is one instance of this issue:</i>

```solidity
📁 File: system-contracts/contracts/ComplexUpgrader.sol

/// @audit low level call to '_delegateTo' on line 25
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable { 
22:         require(msg.sender == FORCE_DEPLOYER, "Can only be called by FORCE_DEPLOYER");
23: 
24:         require(_delegateTo.code.length > 0, "Delegatee is an EOA");
25:         (bool success, bytes memory returnData) = _delegateTo.delegatecall(_calldata);
26:         assembly {
27:             if iszero(success) {
28:                 revert(add(returnData, 0x20), mload(returnData))
29:             }
30:         }
31:     }
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L21-L31)


---
### [L&#x2011;21] Missing checks for `address(0)` when assigning values to address state variables
<details>
<summary><i>There are 6 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

55:         pendingAdmin = _newPendingAdmin; 
```
[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L55)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

46:         securityCouncil = _securityCouncil; 

258:         securityCouncil = _newSecurityCouncil; 
```
[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L46), [258](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L258)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

114:         pendingAdmin = _newPendingAdmin; 

133:         validatorTimelock = _validatorTimelock; 
```
[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L114), [133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L133)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

100:         origin = _newOrigin; 
```
[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L100)

</details>


---
### [L&#x2011;22] Missing contract-existence checks before low-level calls
Low-level calls return success if there is no code present at the specified address.


<i>There is one instance of this issue:</i>

```solidity
📁 File: system-contracts/contracts/GasBoundCaller.sol

/// @audit line 57
35:     function gasBoundCall(address _to, uint256 _maxTotalGas, bytes calldata _data) external payable { 
36:         // At the start of the execution we deduce how much gas be spent on things that will be
37:         // paid for later on by the transaction.
38:         // The `expectedForCompute` variable is an upper bound of how much this contract can spend on compute and
39:         // MUST be higher or equal to the `gas` passed into the call.
40:         uint256 expectedForCompute = gasleft() + CALL_ENTRY_OVERHEAD;
41: 
42:         // We expect that the `_maxTotalGas` at least includes the `gas` required for the call.
43:         // This require is more of a safety protection for the users that call this function with incorrect parameters.
44:         //
45:         // Ultimately, the entire `gas` sent to this call can be spent on compute regardless of the `_maxTotalGas` parameter.
46:         require(_maxTotalGas >= gasleft(), "Gas limit is too low");
47: 
48:         // This is the amount of gas that can be spent *exclusively* on pubdata in addition to the `gas` provided to this function.
49:         uint256 pubdataAllowance = _maxTotalGas > expectedForCompute ? _maxTotalGas - expectedForCompute : 0;
50: 
51:         uint256 pubdataPublishedBefore = REAL_SYSTEM_CONTEXT_CONTRACT.getCurrentPubdataSpent();
52: 
53:         // We never permit system contract calls.
54:         // If the call fails, the `EfficientCall.call` will propagate the revert.
55:         // Since the revert is propagated, the pubdata published wouldn't change and so no
56:         // other checks are needed.
57:         bytes memory returnData = EfficientCall.call(gasleft(), _to, msg.value, _data, false);
58: 
59:         uint256 pubdataPublishedAfter = REAL_SYSTEM_CONTEXT_CONTRACT.getCurrentPubdataSpent();
60: 
61:         // It is possible that pubdataPublishedAfter < pubdataPublishedBefore if the call, e.g. removes
62:         // some of the previously created state diffs
63:         uint256 pubdataSpent = pubdataPublishedAfter > pubdataPublishedBefore
64:             ? pubdataPublishedAfter - pubdataPublishedBefore
65:             : 0;
66: 
67:         uint256 pubdataPrice = REAL_SYSTEM_CONTEXT_CONTRACT.gasPerPubdataByte();
68: 
69:         // In case there is an overflow here, the `_maxTotalGas` wouldbn't be able to cover it anyway, so
70:         // we don't mind the contract panicking here in case of it.
71:         uint256 pubdataCost = pubdataPrice * pubdataSpent;
72: 
73:         if (pubdataCost != 0) {
74:             // Here we double check that the additional cost is not higher than the maximum allowed.
75:             // Note, that the `gasleft()` can be spent on pubdata too.
76:             require(pubdataAllowance + gasleft() >= pubdataCost + CALL_RETURN_OVERHEAD, "Not enough gas for pubdata");
77:         }
78: 
79:         assembly {
80:             // We just relay the return data from the call.
81:             return(add(returnData, 0x20), mload(returnData))
82:         }
83:     }
```
[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L35-L83)


---
### [L&#x2011;23] Missing contract-existence checks before yul `call()`
Low-level calls return success if there is no code present at the specified address. In addition to the zero-address checks, add a check to verify that `extcodesize()` is non-zero.

<details>
<summary><i>There are 15 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit call() on line 358
357:             assembly { 
358:                 callSuccess := call(gas(), _depositSender, _amount, 0, 0, 0, 0)
359:             }

/// @audit call() on line 447
446:             assembly { 
447:                 callSuccess := call(gas(), l1Receiver, amount, 0, 0, 0, 0)
448:             }
```
[357](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L357-L359), [446](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L446-L448)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit call() on line 231
227:         assembly { 
228:             // Copy function signature and arguments from calldata at zero position into memory at pointer position
229:             calldatacopy(0, 0, calldatasize())
230:             // Call method of the hyperchain diamond contract returns 0 on error
231:             let result := call(gas(), contractAddress, 0, 0, calldatasize(), 0, 0)
232:             // Get the size of the last return data
233:             let size := returndatasize()
234:             // Copy the size length of bytes from return data at zero position to pointer position
235:             returndatacopy(0, 0, size)
236:             // Depending on the result value
237:             switch result
238:             case 0 {
239:                 // End execution and revert state changes
240:                 revert(0, size)
241:             }
242:             default {
243:                 // Return data with length of size at pointers position
244:                 return(0, size)
245:             }
246:         }
```
[227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L227-L246)

```solidity
📁 File: contracts/zksync/contracts/SystemContractsCaller.sol

/// @audit call() on line 62
61:             assembly { 
62:                 success := call(to, callAddr, 0, 0, farCallAbi, 0, 0)
63:             }

/// @audit call() on line 71
70:             assembly { 
71:                 success := call(msgValueSimulator, callAddr, value, to, farCallAbi, forwardMask, 0)
72:             }
```
[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L61-L63), [70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L70-L72)

```solidity
📁 File: system-contracts/contracts/libraries/EfficientCall.sol

/// @audit call() on line 136
135:             assembly { 
136:                 success := call(_address, callAddr, 0, 0, 0xFFFF, 0, 0)
137:             }

/// @audit call() on line 149
148:             assembly { 
149:                 success := call(msgValueSimulator, callAddr, _value, _address, 0xFFFF, forwardMask, 0)
150:             }

/// @audit call() on line 208
203:         assembly { 
204:             // Clearing values before usage in assembly, since Solidity
205:             // doesn't do it by default
206:             _whoToMimic := and(_whoToMimic, cleanupMask)
207: 
208:             success := call(_address, callAddr, 0, 0, _whoToMimic, 0, 0)
209:         }
```
[135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L135-L137), [148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L148-L150), [203](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L203-L209)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractHelper.sol

/// @audit call() on line 55
50:         assembly { 
51:             // Ensuring that the type is bool
52:             _isService := and(_isService, 1)
53:             // This `success` is always 0, but the method always succeeds
54:             // (except for the cases when there is not enough gas)
55:             let success := call(_isService, callAddr, _key, _value, 0xFFFF, 0, 0)
56:         }

/// @audit call() on line 174
171:         assembly { 
172:             // Clearing input params as they are not cleaned by Solidity by default
173:             _value := and(_value, cleanupMask)
174:             success := call(0, callAddr, _value, 0, 0xFFFF, 0, 0)
175:         }

/// @audit call() on line 184
183:         assembly { 
184:             pop(call(initializer, callAddr, value1, 0, 0xFFFF, 0, 0))
185:         }

/// @audit call() on line 194
193:         assembly { 
194:             pop(call(value1, callAddr, value2, 0, 0xFFFF, 0, 0))
195:         }
```
[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L50-L56), [171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L171-L175), [183](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L183-L185), [193](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L193-L195)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractsCaller.sol

/// @audit call() on line 101
100:             assembly { 
101:                 success := call(to, callAddr, 0, 0, farCallAbi, 0, 0)
102:             }

/// @audit call() on line 110
109:             assembly { 
110:                 success := call(msgValueSimulator, callAddr, value, to, farCallAbi, forwardMask, 0)
111:             }
```
[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L100-L102), [109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L109-L111)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

/// @audit call() on line 400
399:         assembly { 
400:             success := call(gas(), bootloaderAddr, amount, 0, 0, 0, 0)
401:         }
```
[399](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L399-L401)

</details>


---
### [L&#x2011;24] Missing zero address check in functions with address parameters
Adding a zero address check for each address type parameter can prevent errors.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit _token
63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external { 

/// @audit _l1Token
75:     function l2TokenAddress(address _l1Token) external view returns (address) { 

/// @audit _l2Receiver, _l1Token
98:     function deposit( 
99:         address _l2Receiver,
100:         address _l1Token,
101:         uint256 _amount,
102:         uint256 _l2TxGasLimit,
103:         uint256 _l2TxGasPerPubdataByte
104:     ) external payable returns (bytes32 l2TxHash) {

/// @audit _l2Receiver, _l1Token, _refundRecipient
133:     function deposit( 
134:         address _l2Receiver,
135:         address _l1Token,
136:         uint256 _amount,
137:         uint256 _l2TxGasLimit,
138:         uint256 _l2TxGasPerPubdataByte,
139:         address _refundRecipient
140:     ) public payable nonReentrant returns (bytes32 l2TxHash) {

/// @audit _from
160:     function _depositFundsToSharedBridge(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) { 

/// @audit _depositSender, _l1Token
176:     function claimFailedDeposit( 
177:         address _depositSender,
178:         address _l1Token,
179:         bytes32 _l2TxHash,
180:         uint256 _l2BatchNumber,
181:         uint256 _l2MessageIndex,
182:         uint16 _l2TxNumberInBatch,
183:         bytes32[] calldata _merkleProof
184:     ) external nonReentrant {
```
[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63), [75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L75), [98](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L98-L104), [133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L133-L140), [160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L160), [176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L176-L184)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit _target
116:     function transferFundsFromLegacy(address _token, address _target, uint256 _targetChainId) external onlyOwner { 

/// @audit _l2BridgeAddress
142:     function initializeChainGovernance(uint256 _chainId, address _l2BridgeAddress) external onlyOwner { 

/// @audit _prevMsgSender, _l1Token
148:     function bridgehubDepositBaseToken( 
149:         uint256 _chainId,
150:         address _prevMsgSender,
151:         address _l1Token,
152:         uint256 _amount
153:     ) external payable virtual onlyBridgehubOrEra(_chainId) {

/// @audit _from
173:     function _depositFunds(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) { 

/// @audit _prevMsgSender
182:     function bridgehubDeposit( 
183:         uint256 _chainId,
184:         address _prevMsgSender,
185:         uint256, // l2Value, needed for Weth deposits in the future
186:         bytes calldata _data
187:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) {

/// @audit _l1Sender, _l2Receiver, _l1Token
243:     function _getDepositL2Calldata( 
244:         address _l1Sender,
245:         address _l2Receiver,
246:         address _l1Token,
247:         uint256 _amount
248:     ) internal view returns (bytes memory) {

/// @audit _token
254:     function _getERC20Getters(address _token) internal view returns (bytes memory) { 

/// @audit _depositSender, _l1Token
277:     function claimFailedDeposit( 
278:         uint256 _chainId,
279:         address _depositSender,
280:         address _l1Token,
281:         uint256 _amount,
282:         bytes32 _l2TxHash,
283:         uint256 _l2BatchNumber,
284:         uint256 _l2MessageIndex,
285:         uint16 _l2TxNumberInBatch,
286:         bytes32[] calldata _merkleProof
287:     ) external override {

/// @audit _depositSender, _l1Token
303:     function _claimFailedDeposit( 
304:         bool _checkedInLegacyBridge,
305:         uint256 _chainId,
306:         address _depositSender,
307:         address _l1Token,
308:         uint256 _amount,
309:         bytes32 _l2TxHash,
310:         uint256 _l2BatchNumber,
311:         uint256 _l2MessageIndex,
312:         uint16 _l2TxNumberInBatch,
313:         bytes32[] calldata _merkleProof
314:     ) internal nonReentrant {

/// @audit _l2Receiver, _l1Token, _refundRecipient
554:     function depositLegacyErc20Bridge( 
555:         address _prevMsgSender,
556:         address _l2Receiver,
557:         address _l1Token,
558:         uint256 _amount,
559:         uint256 _l2TxGasLimit,
560:         uint256 _l2TxGasPerPubdataByte,
561:         address _refundRecipient
562:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) {

/// @audit _depositSender, _l1Token
644:     function claimFailedDepositLegacyErc20Bridge( 
645:         address _depositSender,
646:         address _l1Token,
647:         uint256 _amount,
648:         bytes32 _l2TxHash,
649:         uint256 _l2BatchNumber,
650:         uint256 _l2MessageIndex,
651:         uint16 _l2TxNumberInBatch,
652:         bytes32[] calldata _merkleProof
653:     ) external override onlyLegacyBridge {
```
[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L116), [142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L142), [148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L148-L153), [173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L173), [182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L182-L187), [243](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L243-L248), [254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L254), [277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L277-L287), [303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L303-L314), [554](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L554-L562), [644](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L644-L653)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit _newPendingAdmin
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 

/// @audit _stateTransitionManager
82:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner { 

/// @audit _stateTransitionManager
92:     function removeStateTransitionManager(address _stateTransitionManager) external onlyOwner { 

/// @audit _token
101:     function addToken(address _token) external onlyOwner { 

/// @audit _sharedBridge
108:     function setSharedBridge(address _sharedBridge) external onlyOwner { 

/// @audit _stateTransitionManager, _baseToken, _admin
114:     function createNewChain( 
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, //_salt
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {
```
[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51), [82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L82), [92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L92), [101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L101), [108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108), [114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L121)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

/// @audit _sender
60:     function computeCreate2Address( 
61:         address _sender,
62:         bytes32 _salt,
63:         bytes32 _bytecodeHash,
64:         bytes32 _constructorInputHash
65:     ) internal pure returns (address) {
```
[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L60-L65)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

/// @audit _newSecurityCouncil
256:     function updateSecurityCouncil(address _newSecurityCouncil) external onlySelf { 
```
[256](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L256)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit _newPendingAdmin
110:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 

/// @audit _validatorTimelock
132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin { 

/// @audit _chainContract
177:     function _setChainIdUpgrade(uint256 _chainId, address _chainContract) internal { 

/// @audit _stateTransitionContract
230:     function registerAlreadyDeployedStateTransition( 
231:         uint256 _chainId,
232:         address _stateTransitionContract
233:     ) external onlyOwner {

/// @audit _baseToken, _sharedBridge, _admin
239:     function createNewChain( 
240:         uint256 _chainId,
241:         address _baseToken,
242:         address _sharedBridge,
243:         address _admin,
244:         bytes calldata _diamondCut
245:     ) external onlyBridgehub {
```
[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L110), [132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132), [177](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L177), [230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L230-L233), [239](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L239-L245)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit _newValidator
78:     function addValidator(uint256 _chainId, address _newValidator) external onlyChainAdmin(_chainId) { 

/// @audit _validator
87:     function removeValidator(uint256 _chainId, address _validator) external onlyChainAdmin(_chainId) { 
```
[78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L78), [87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L87)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

/// @audit _newPendingAdmin
23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin { 

/// @audit _validator
45:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager { 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L23), [45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L45)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

/// @audit _address
112:     function isValidator(address _address) external view returns (bool) { 

/// @audit _facet
163:     function isFacetFreezable(address _facet) external view returns (bool isFreezable) { 

/// @audit _facet
217:     function facetFunctionSelectors(address _facet) external view returns (bytes4[] memory) { 
```
[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L112), [163](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L163), [217](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L217)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

/// @audit _contractL2, _refundRecipient
197:     function requestL2Transaction( 
198:         address _contractL2,
199:         uint256 _l2Value,
200:         bytes calldata _calldata,
201:         uint256 _l2GasLimit,
202:         uint256 _l2GasPerPubdataByteLimit,
203:         bytes[] calldata _factoryDeps,
204:         address _refundRecipient
205:     ) external payable returns (bytes32 canonicalTxHash) {
```
[197](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L197-L205)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

/// @audit _facet
126:     function _addFunctions(address _facet, bytes4[] memory _selectors, bool _isFacetFreezable) private { 
```
[126](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L126)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

/// @audit _newVerifier
163:     function _upgradeVerifier(address _newVerifier, VerifierParams calldata _verifierParams) internal { 
```
[163](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L163)

</details>


---
### [L&#x2011;25] Multiplication on the result of a division
Dividing an integer by another integer will often result in loss of precision.
When the result is multiplied by another number, the loss of precision is magni'fied, often to material magnitudes. `(X / Z) * Y` should be re-written as `(X * Y) / Z`

Example:
```solidity
contract A {
  function f(uint n) public {
       coins = (oldSupply / n) * interest;
   }
}
```

If `n` is greater than `oldSupply`, coins will be zero. For example, with `oldSupply = 5; n = 10, interest = 2`, coins will be zero.
If `(oldSupply * interest / n)` was used, coins would have been 1. In general, it's usually a good idea to re-arrange arithmetic to perform `multiplication before division`, unless the limit of a smaller type makes this dangerous.



<i>There are 2 instaces of this issue:</i>

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

51:         return KECCAK_ROUND_GAS_COST * (_length / KECCAK_ROUND_NUMBER_OF_BYTES + 1); 

62:         return SHA256_ROUND_GAS_COST * ((_length + 8) / SHA256_ROUND_NUMBER_OF_BYTES + 1); 
```
[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L51), [62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L62)


---
### [L&#x2011;26] `name()` is not a part of the ERC-20 standard
The `name()` function is not a part of the [ERC-20 standard](https://eips.ethereum.org/EIPS/eip-20), and was added later as an [optional extension](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/extensions/IERC20Metadata.sol). As such, some valid ERC20 tokens do not support this interface, so it is unsafe to blindly cast all tokens to this interface, and then call this function.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

162:         return super.name(); 
```
[162](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L162)


---
### [L&#x2011;27] Numbers downcast to `address`es may result in collisions
If a number is downcast to an `address` the upper bytes are truncated, which may mean that more than one value will map to the `address`

<details>
<summary><i>There are 16 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

71:         return address(uint160(uint256(data))); 
```
[71](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L71)

```solidity
📁 File: contracts/zksync/contracts/L2ContractHelper.sol

112:         return address(uint160(uint256(data))); 
```
[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L112)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

92:         address account = address(uint160(_input)); 

120:         address account = address(uint160(_input)); 
```
[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L92), [120](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L120)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

61:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); 

147:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); 

241:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); 
```
[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L61), [147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L147), [241](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L241)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

109:         newAddress = address(uint160(uint256(hash))); 

125:         newAddress = address(uint160(uint256(hash))); 
```
[109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L109), [125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L125)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

132:         address to = address(uint160(_transaction.to)); 
```
[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L132)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

57:         return balance[address(uint160(_account))]; 
```
[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L57)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

32:         to = address(uint160(addressAsUint)); 
```
[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L32)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

164:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); 

232:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); 

303:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); 

375:             address paymaster = address(uint160(_transaction.paymaster)); 
```
[164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L164), [232](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L232), [303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L303), [375](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L375)

</details>


---
### [L&#x2011;28] `onlyOwner` functions not accessible if `owner` renounces ownership
The `owner` is able to perform certain privileged activities, but it's possible to set the owner to `address(0)`. This can represent a certain risk if the ownership is renounced for any other reason than by design.

Renouncing ownership will leave the contract without an `owner`, therefore limiting any functionality that needs authority.

<details>
<summary><i>There are 23 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

116:     function transferFundsFromLegacy(address _token, address _target, uint256 _targetChainId) external onlyOwner { 

142:     function initializeChainGovernance(uint256 _chainId, address _l2BridgeAddress) external onlyOwner { 
```
[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L116), [142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L142)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 

82:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner { 

92:     function removeStateTransitionManager(address _stateTransitionManager) external onlyOwner { 

101:     function addToken(address _token) external onlyOwner { 

108:     function setSharedBridge(address _sharedBridge) external onlyOwner { 

114:     function createNewChain( 
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, //_salt
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {
```
[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51), [82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L82), [92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L92), [101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L101), [108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108), [114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L121)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

129:     function scheduleTransparent(Operation calldata _operation, uint256 _delay) external onlyOwner { 

142:     function scheduleShadow(bytes32 _id, uint256 _delay) external onlyOwner { 

154:     function cancel(bytes32 _id) external onlyOwner { 

167:     function execute(Operation calldata _operation) external payable onlyOwnerOrSecurityCouncil { 
```
[129](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L129), [142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L142), [154](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L154), [167](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L167)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

110:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 

132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin { 

137:     function setInitialCutHash(Diamond.DiamondCutData calldata _diamondCut) external onlyOwner { 

142:     function setNewVersionUpgrade( 
143:         Diamond.DiamondCutData calldata _cutData,
144:         uint256 _oldProtocolVersion,
145:         uint256 _newProtocolVersion
146:     ) external onlyOwner {

152:     function setUpgradeDiamondCut( 
153:         Diamond.DiamondCutData calldata _cutData,
154:         uint256 _oldProtocolVersion
155:     ) external onlyOwner {

160:     function freezeChain(uint256 _chainId) external onlyOwner { 

165:     function unfreezeChain(uint256 _chainId) external onlyOwner { 

170:     function revertBatches(uint256 _chainId, uint256 _newLastBatch) external onlyOwnerOrAdmin { 

230:     function registerAlreadyDeployedStateTransition( 
231:         uint256 _chainId,
232:         address _stateTransitionContract
233:     ) external onlyOwner {
```
[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L110), [132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132), [137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L137), [142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L142-L146), [152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L152-L155), [160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L160), [165](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L165), [170](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L170), [230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L230-L233)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

73:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner { 

96:     function setExecutionDelay(uint32 _executionDelay) external onlyOwner { 
```
[73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L73), [96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L96)

</details>


---
### [L&#x2011;29] `pure` function accesses storage
While the compiler currently flags functions like these as being `pure`, this is a [bug](https://github.com/ethereum/solidity/issues/11573) which will be fixed in a future version, so it's best to not use `pure` visibility, in order to not break when this bug is fixed.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

87:     function getDiamondStorage() internal pure returns (DiamondStorage storage diamondStorage) { 
88:         bytes32 position = DIAMOND_STORAGE_POSITION;
89:         assembly {
90:             diamondStorage.slot := position
91:         }
92:     }
```
[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L87-L92)


---
### [L&#x2011;30] `require()` should be used instead of `assert()`
Prior to solidity version 0.8.0, hitting an assert consumes the **remainder of the transaction's available gas** rather than returning it, as `require()`/`revert()` do. `assert()` should be avoided even past solidity version 0.8.0 as its [documentation](https://docs.soliditylang.org/en/v0.8.14/control-structures.html#panic-via-assert-and-error-via-require) states that "The assert function creates an error of type Panic(uint256). ... Properly functioning code should never create a Panic, not even on invalid external input. If this happens, then there is a bug in your contract which you should fix".

<details>
<summary><i>There are 5 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

106:         assert(L2_TO_L1_LOG_SERIALIZE_SIZE != 2 * 32); 
```
[106](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L106)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

51:         assert(L2_TO_L1_LOG_SERIALIZE_SIZE != 2 * 32); 
```
[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L51)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

426:         assert(block.chainid != 1); 
```
[426](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L426)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

222:         assert(msg.sender != BOOTLOADER_FORMAL_ADDRESS); 
```
[222](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L222)

```solidity
📁 File: system-contracts/contracts/libraries/RLPEncoder.sol

50:         assert(_len != 1); 
```
[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L50)

</details>


---
### [L&#x2011;31] Return variable can remain unassigned in the function
Verify that functions with a return value do actually return a value in all cases. The function below revert if the two specific cases is not found. The problem is that when the function is called from another contract he can unexpect that the function can revert.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

47:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual override returns (bytes32) { 
48:         // Note that due to commitment delay, the timestamp of the L2 upgrade batch may be earlier than the timestamp
49:         // of the L1 block at which the upgrade occurred. This means that using timestamp as a signifier of "upgraded"
50:         // on the L2 side would be inaccurate. The effects of this "back-dating" of L2 upgrade batches will be reduced
51:         // as the permitted delay window is reduced in the future.
52:         require(block.timestamp >= _proposedUpgrade.upgradeTimestamp, "Upgrade is not ready yet");
53: 
54:         _setNewProtocolVersion(_proposedUpgrade.newProtocolVersion);
55:         _upgradeL1Contract(_proposedUpgrade.l1ContractsUpgradeCalldata);
56:         _upgradeVerifier(_proposedUpgrade.verifier, _proposedUpgrade.verifierParams);
57:         _setBaseSystemContracts(_proposedUpgrade.bootloaderHash, _proposedUpgrade.defaultAccountHash);
58: 
59:         bytes32 txHash = _setL2SystemContractUpgrade(
60:             _proposedUpgrade.l2ProtocolUpgradeTx,
61:             _proposedUpgrade.factoryDeps,
62:             _proposedUpgrade.newProtocolVersion
63:         );
64: 
65:         _postUpgrade(_proposedUpgrade.postUpgradeCalldata);
66: 
67:         emit UpgradeComplete(_proposedUpgrade.newProtocolVersion, txHash, _proposedUpgrade);
68:     }
```
[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L47-L68)


---
### [L&#x2011;32] Setters should prevent re-setting of the same value
This especially problematic when the setter also emits the same value, which may be confusing to offline parsers

<details>
<summary><i>There are 19 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 
52:         // Save previous value into the stack to put it into the event later
53:         address oldPendingAdmin = pendingAdmin;
54:         // Change pending admin
55:         pendingAdmin = _newPendingAdmin;
56:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
57:     }

108:     function setSharedBridge(address _sharedBridge) external onlyOwner { 
109:         sharedBridge = IL1SharedBridge(_sharedBridge);
110:     }
```
[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L57), [108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108-L110)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

249:     function updateDelay(uint256 _newDelay) external onlySelf { 
250:         emit ChangeMinDelay(minDelay, _newDelay);
251:         minDelay = _newDelay;
252:     }

256:     function updateSecurityCouncil(address _newSecurityCouncil) external onlySelf { 
257:         emit ChangeSecurityCouncil(securityCouncil, _newSecurityCouncil);
258:         securityCouncil = _newSecurityCouncil;
259:     }
```
[249](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L249-L252), [256](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L256-L259)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

110:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 
111:         // Save previous value into the stack to put it into the event later
112:         address oldPendingAdmin = pendingAdmin;
113:         // Change pending admin
114:         pendingAdmin = _newPendingAdmin;
115:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
116:     }

132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin { 
133:         validatorTimelock = _validatorTimelock;
134:     }
```
[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L110-L116), [132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132-L134)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

96:     function setExecutionDelay(uint32 _executionDelay) external onlyOwner { 
97:         executionDelay = _executionDelay;
98:         emit NewExecutionDelay(_executionDelay);
99:     }
```
[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L96-L99)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin { 
24:         // Save previous value into the stack to put it into the event later
25:         address oldPendingAdmin = s.pendingAdmin;
26:         // Change pending admin
27:         s.pendingAdmin = _newPendingAdmin;
28:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
29:     }

45:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager { 
46:         s.validators[_validator] = _active;
47:         emit ValidatorStatusUpdate(_validator, _active);
48:     }

51:     function setPorterAvailability(bool _zkPorterIsAvailable) external onlyStateTransitionManager { 
52:         // Change the porter availability
53:         s.zkPorterIsAvailable = _zkPorterIsAvailable;
54:         emit IsPorterAvailableStatusUpdate(_zkPorterIsAvailable);
55:     }

79:     function setTokenMultiplier(uint128 _nominator, uint128 _denominator) external onlyAdminOrStateTransitionManager { 
80:         uint128 oldNominator = s.baseTokenGasPriceMultiplierNominator;
81:         uint128 oldDenominator = s.baseTokenGasPriceMultiplierDenominator;
82: 
83:         s.baseTokenGasPriceMultiplierNominator = _nominator;
84:         s.baseTokenGasPriceMultiplierDenominator = _denominator;
85: 
86:         emit NewBaseTokenMultiplier(oldNominator, oldDenominator, _nominator, _denominator);
87:     }
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L23-L29), [45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L45-L48), [51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L51-L55), [79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L79-L87)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

84:     function setChainId(uint256 _newChainId) external onlyCallFromForceDeployer { 
85:         chainId = _newChainId;
86:     }

99:     function setTxOrigin(address _newOrigin) external onlyCallFromBootloader { 
100:         origin = _newOrigin;
101:     }

105:     function setGasPrice(uint256 _gasPrice) external onlyCallFromBootloader { 
106:         gasPrice = _gasPrice;
107:     }

112:     function setPubdataInfo(uint256 _gasPerPubdataByte, uint256 _basePubdataSpent) external onlyCallFromBootloader { 
113:         basePubdataSpent = _basePubdataSpent;
114:         gasPerPubdataByte = _gasPerPubdataByte;
115:     }

212:     function _setL2BlockHash(uint256 _block, bytes32 _hash) internal { 
213:         l2BlockHash[_block % MINIBLOCK_HASHES_TO_STORE] = _hash;
214:     }

263:     function _setVirtualBlock( 
264:         uint128 _l2BlockNumber,
265:         uint128 _maxVirtualBlocksToCreate,
266:         uint128 _newTimestamp
267:     ) internal {
268:         if (virtualBlockUpgradeInfo.virtualBlockFinishL2Block != 0) {
269:             // No need to to do anything about virtual blocks anymore
270:             // All the info is the same as for L2 blocks.
271:             currentVirtualL2BlockInfo = currentL2BlockInfo;
272:             return;
273:         }
274: 
275:         BlockInfo memory virtualBlockInfo = currentVirtualL2BlockInfo;
276: 
277:         if (currentVirtualL2BlockInfo.number == 0 && virtualBlockInfo.timestamp == 0) {
278:             uint128 currentBatchNumber = currentBatchInfo.number;
279: 
280:             // The virtual block is set for the first time. We can count it as 1 creation of a virtual block.
281:             // Note, that when setting the virtual block number we use the batch number to make a smoother upgrade from batch number to
282:             // the L2 block number.
283:             virtualBlockInfo.number = currentBatchNumber;
284:             // Remembering the batch number on which the upgrade to the virtual blocks has been done.
285:             virtualBlockUpgradeInfo.virtualBlockStartBatch = currentBatchNumber;
286: 
287:             require(_maxVirtualBlocksToCreate > 0, "Can't initialize the first virtual block");
288:             _maxVirtualBlocksToCreate -= 1;
289:         } else if (_maxVirtualBlocksToCreate == 0) {
290:             // The virtual blocks have been already initialized, but the operator didn't ask to create
291:             // any new virtual blocks. So we can just return.
292:             return;
293:         }
294: 
295:         virtualBlockInfo.number += _maxVirtualBlocksToCreate;
296:         virtualBlockInfo.timestamp = _newTimestamp;
297: 
298:         // The virtual block number must never exceed the L2 block number.
299:         // We do not use a `require` here, since the virtual blocks are a temporary solution to let the Solidity's `block.number`
300:         // catch up with the L2 block number and so the situation where virtualBlockInfo.number starts getting larger
301:         // than _l2BlockNumber is expected once virtual blocks have caught up the L2 blocks.
302:         if (virtualBlockInfo.number >= _l2BlockNumber) {
303:             virtualBlockUpgradeInfo.virtualBlockFinishL2Block = _l2BlockNumber;
304:             virtualBlockInfo.number = _l2BlockNumber;
305:         }
306: 
307:         currentVirtualL2BlockInfo = virtualBlockInfo;
308:     }

314:     function _setNewL2BlockData(uint128 _l2BlockNumber, uint128 _l2BlockTimestamp, bytes32 _prevL2BlockHash) internal { 
315:         // In the unsafe version we do not check that the block data is correct
316:         currentL2BlockInfo = BlockInfo({number: _l2BlockNumber, timestamp: _l2BlockTimestamp});
317: 
318:         // It is always assumed in production that _l2BlockNumber > 0
319:         _setL2BlockHash(_l2BlockNumber - 1, _prevL2BlockHash);
320: 
321:         // Reseting the rolling hash
322:         currentL2BlockTxsRollingHash = bytes32(0);
323:     }

444:     function setNewBatch( 
445:         bytes32 _prevBatchHash,
446:         uint128 _newTimestamp,
447:         uint128 _expectedNewNumber,
448:         uint256 _baseFee
449:     ) external onlyCallFromBootloader {
450:         (uint128 previousBatchNumber, uint128 previousBatchTimestamp) = getBatchNumberAndTimestamp();
451:         require(_newTimestamp > previousBatchTimestamp, "Timestamps should be incremental");
452:         require(previousBatchNumber + 1 == _expectedNewNumber, "The provided block number is not correct");
453: 
454:         _ensureBatchConsistentWithL2Block(_newTimestamp);
455: 
456:         batchHashes[previousBatchNumber] = _prevBatchHash;
457: 
458:         // Setting new block number and timestamp
459:         BlockInfo memory newBlockInfo = BlockInfo({number: previousBatchNumber + 1, timestamp: _newTimestamp});
460: 
461:         currentBatchInfo = newBlockInfo;
462: 
463:         baseFee = _baseFee;
464: 
465:         // The correctness of this block hash:
466:         SystemContractHelper.toL1(false, bytes32(uint256(SystemLogKey.PREV_BATCH_HASH_KEY)), _prevBatchHash);
467:     }
```
[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L84-L86), [99](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L99-L101), [105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L105-L107), [112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L112-L115), [212](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L212-L214), [263](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L263-L308), [314](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L314-L323), [444](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L444-L467)

</details>


---
### [L&#x2011;33] State variables not capped at reasonable values
Consider adding minimum/maximum value checks to ensure that the state variables below can never be used to excessively harm users, including via griefing

<details>
<summary><i>There are 15 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit eraFirstPostUpgradeBatch on line 111
104:     function initialize( 
105:         address _owner,
106:         uint256 _eraFirstPostUpgradeBatch
107:     ) external reentrancyGuardInitializer initializer {
108:         require(_owner != address(0), "ShB owner 0");
109:         _transferOwnership(_owner);
110: 
111:         eraFirstPostUpgradeBatch = _eraFirstPostUpgradeBatch;
112:         l2BridgeAddress[ERA_CHAIN_ID] = ERA_ERC20_BRIDGE_ADDRESS;
113:     }
```
[104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L104-L113)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

/// @audit securityCouncil on line 46
/// @audit minDelay on line 49
41:     constructor(address _admin, address _securityCouncil, uint256 _minDelay) { 
42:         require(_admin != address(0), "Admin should be non zero address");
43: 
44:         _transferOwnership(_admin);
45: 
46:         securityCouncil = _securityCouncil;
47:         emit ChangeSecurityCouncil(address(0), _securityCouncil);
48: 
49:         minDelay = _minDelay;
50:         emit ChangeMinDelay(0, _minDelay);
51:     }

/// @audit minDelay on line 251
249:     function updateDelay(uint256 _newDelay) external onlySelf { 
250:         emit ChangeMinDelay(minDelay, _newDelay);
251:         minDelay = _newDelay;
252:     }
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L41-L51), [249](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L249-L252)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit protocolVersion on line 148
142:     function setNewVersionUpgrade( 
143:         Diamond.DiamondCutData calldata _cutData,
144:         uint256 _oldProtocolVersion,
145:         uint256 _newProtocolVersion
146:     ) external onlyOwner {
147:         upgradeCutHash[_oldProtocolVersion] = keccak256(abi.encode(_cutData));
148:         protocolVersion = _newProtocolVersion;
149:     }
```
[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L142-L149)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit executionDelay on line 57
55:     constructor(address _initialOwner, uint32 _executionDelay) { 
56:         _transferOwnership(_initialOwner);
57:         executionDelay = _executionDelay;
58:     }

/// @audit executionDelay on line 97
96:     function setExecutionDelay(uint32 _executionDelay) external onlyOwner { 
97:         executionDelay = _executionDelay;
98:         emit NewExecutionDelay(_executionDelay);
99:     }
```
[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L55-L58), [96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L96-L99)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

/// @audit availableGetters on line 124
111:     function reinitializeToken( 
112:         ERC20Getters calldata _availableGetters,
113:         string memory _newName,
114:         string memory _newSymbol,
115:         uint8 _version
116:     ) external onlyNextVersion(_version) reinitializer(_version) {
117:         // It is expected that this token is deployed as a beacon proxy, so we'll
118:         // allow the governor of the beacon to reinitialize the token.
119:         address beaconAddress = _getBeacon();
120:         require(msg.sender == UpgradeableBeacon(beaconAddress).owner(), "tt");
121: 
122:         __ERC20_init_unchained(_newName, _newSymbol);
123:         __ERC20Permit_init(_newName);
124:         availableGetters = _availableGetters;
125: 
126:         emit BridgeInitialize(l1Address, _newName, _newSymbol, decimals_);
127:     }
```
[111](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L111-L127)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

/// @audit totalSupply on line 65
64:     function mint(address _account, uint256 _amount) external override onlyCallFromBootloader { 
65:         totalSupply += _amount;
66:         balance[_account] += _amount;
67:         emit Mint(_account, _amount);
68:     }
```
[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L64-L68)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

/// @audit chainId on line 85
84:     function setChainId(uint256 _newChainId) external onlyCallFromForceDeployer { 
85:         chainId = _newChainId;
86:     }

/// @audit gasPrice on line 106
105:     function setGasPrice(uint256 _gasPrice) external onlyCallFromBootloader { 
106:         gasPrice = _gasPrice;
107:     }

/// @audit basePubdataSpent on line 113
/// @audit gasPerPubdataByte on line 114
112:     function setPubdataInfo(uint256 _gasPerPubdataByte, uint256 _basePubdataSpent) external onlyCallFromBootloader { 
113:         basePubdataSpent = _basePubdataSpent;
114:         gasPerPubdataByte = _gasPerPubdataByte;
115:     }

/// @audit baseFee on line 463
444:     function setNewBatch( 
445:         bytes32 _prevBatchHash,
446:         uint128 _newTimestamp,
447:         uint128 _expectedNewNumber,
448:         uint256 _baseFee
449:     ) external onlyCallFromBootloader {
450:         (uint128 previousBatchNumber, uint128 previousBatchTimestamp) = getBatchNumberAndTimestamp();
451:         require(_newTimestamp > previousBatchTimestamp, "Timestamps should be incremental");
452:         require(previousBatchNumber + 1 == _expectedNewNumber, "The provided block number is not correct");
453: 
454:         _ensureBatchConsistentWithL2Block(_newTimestamp);
455: 
456:         batchHashes[previousBatchNumber] = _prevBatchHash;
457: 
458:         // Setting new block number and timestamp
459:         BlockInfo memory newBlockInfo = BlockInfo({number: previousBatchNumber + 1, timestamp: _newTimestamp});
460: 
461:         currentBatchInfo = newBlockInfo;
462: 
463:         baseFee = _baseFee;
464: 
465:         // The correctness of this block hash:
466:         SystemContractHelper.toL1(false, bytes32(uint256(SystemLogKey.PREV_BATCH_HASH_KEY)), _prevBatchHash);
467:     }

/// @audit baseFee on line 479
471:     function unsafeOverrideBatch( 
472:         uint256 _newTimestamp,
473:         uint256 _number,
474:         uint256 _baseFee
475:     ) external onlyCallFromBootloader {
476:         BlockInfo memory newBlockInfo = BlockInfo({number: uint128(_number), timestamp: uint128(_newTimestamp)});
477:         currentBatchInfo = newBlockInfo;
478: 
479:         baseFee = _baseFee;
480:     }
```
[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L84-L86), [105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L105-L107), [112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L112-L115), [444](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L444-L467), [471](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L471-L480)

</details>


---
### [L&#x2011;34] `symbol()` is not a part of the ERC-20 standard
The `symbol()` function is not a part of the [ERC-20 standard](https://eips.ethereum.org/EIPS/eip-20), and was added later as an [optional extension](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/extensions/IERC20Metadata.sol). As such, some valid ERC20 tokens do not support this interface, so it is unsafe to blindly cast all tokens to this interface, and then call this function.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

168:         return super.symbol(); 
```
[168](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L168)


---
### [L&#x2011;35] TransferOwnership should be two step
Recommend considering implementing a two step process where the owner or admin nominates an account and the nominated account needs to call an acceptOwnership() function for the transfer of ownership to fully succeed. This ensures the nominated EOA account is a valid and active account.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

66:             l2TokenBeacon.transferOwnership(_aliasedOwner); 
```
[66](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L66)


---
### [L&#x2011;36] `unchecked` blocks with additions/multiplications may overflow
There aren't any checks to avoid an overflow which can happen inside an unchecked block, so the following expressions may overflow silently.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/UncheckedMath.sol

/// @audit unchecked block 12-14
13:             return _number + 1; 

/// @audit unchecked block 18-20
19:             return _lhs + _rhs; 
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L13), [19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L19)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit unchecked block 184-197
195:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c"); // The delay is not passed 

/// @audit unchecked block 208-219
217:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c"); // The delay is not passed 
```
[195](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L195), [217](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L217)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/LibMap.sol

/// @audit unchecked block 19-31
27:             uint256 bitOffset = (_index & 7) * 32; 

/// @audit unchecked block 39-62
48:             uint256 bitOffset = (_index & 7) * 32; 
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L27), [48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L48)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

/// @audit unchecked block 29-31
30:             l2Address = address(uint160(l1Address) + offset); 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L30)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

/// @audit unchecked block 104-117
/// @audit unchecked block 104-117
/// @audit unchecked block 104-117
/// @audit unchecked block 104-117
/// @audit unchecked block 104-117
/// @audit unchecked block 104-117
/// @audit unchecked block 104-117
/// @audit unchecked block 104-117
105:             uint256 listLength = encodedNonce.length + 
106:                 encodedGasParam.length +
107:                 encodedTo.length +
108:                 encodedValue.length +
109:                 encodedDataLength.length +
110:                 _transaction.data.length +
111:                 rEncoded.length +
112:                 sEncoded.length +
113:                 vEncoded.length;

/// @audit unchecked block 197-208
/// @audit unchecked block 197-208
/// @audit unchecked block 197-208
/// @audit unchecked block 197-208
/// @audit unchecked block 197-208
/// @audit unchecked block 197-208
198:             uint256 listLength = encodedFixedLengthParams.length + 
199:                 encodedDataLength.length +
200:                 _transaction.data.length +
201:                 encodedAccessListLength.length +
202:                 rEncoded.length +
203:                 sEncoded.length +
204:                 vEncoded.length;

/// @audit unchecked block 292-303
/// @audit unchecked block 292-303
/// @audit unchecked block 292-303
/// @audit unchecked block 292-303
/// @audit unchecked block 292-303
/// @audit unchecked block 292-303
293:             uint256 listLength = encodedFixedLengthParams.length + 
294:                 encodedDataLength.length +
295:                 _transaction.data.length +
296:                 encodedAccessListLength.length +
297:                 rEncoded.length +
298:                 sEncoded.length +
299:                 vEncoded.length;
```
[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L105-L113), [198](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L198-L204), [293](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L293-L299)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

/// @audit unchecked block 48-70
52:                 encodedData.length * 4 == _bytecode.length, 

/// @audit unchecked block 48-70
62:                 uint256 indexOfEncodedChunk = uint256(encodedData.readUint16(encodedDataPointer)) * 8; 

/// @audit unchecked block 48-70
66:                 uint64 realChunk = _bytecode.readUint64(encodedDataPointer * 4); 

/// @audit unchecked block 200-205
/// @audit unchecked block 200-205
203:             dictionary = _rawCompressedData[2:2 + dictionaryLen * 8]; 
/// @audit unchecked block 200-205
/// @audit unchecked block 200-205
204:             encodedData = _rawCompressedData[2 + dictionaryLen * 8:];

/// @audit unchecked block 228-244
233:                     _initialValue + convertedValue == _finalValue, 
```
[52](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L52), [62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L62), [66](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L66), [203](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L203-L204), [233](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L233)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

/// @audit unchecked block 137-141
/// @audit unchecked block 137-141
140:             pubdataLen = 4 + _message.length + L2_TO_L1_LOG_SERIALIZE_SIZE; 

/// @audit unchecked block 169-172
171:             pubdataLen = 4 + bytecodeLen; 
```
[140](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L140), [171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L171)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

/// @audit unchecked block 71-73
72:             rawNonces[addressAsKey] = (oldRawNonce + _value); 

/// @audit unchecked block 117-119
118:             rawNonces[addressAsKey] = oldRawNonce + 1; 
```
[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L72), [118](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L118)

</details>


---
### [L&#x2011;37] `unchecked` blocks with subtractions may underflow
There aren't any checks to avoid an underflow which can happen inside an `unchecked` block, so the following subtractions may underflow silently.

<details>
<summary><i>There are 11 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol

118:             txBodyGasLimit = _totalGasLimit - overhead; 
```
[118](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L118)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

40:             l1Address = address(uint160(l2Address) - offset); 
```
[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L40)

```solidity
📁 File: contracts/zksync/contracts/vendor/AddressAliasHelper.sol

40:             l1Address = address(uint160(l2Address) - offset); 
```
[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L40)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

238:                     _initialValue - convertedValue == _finalValue, 
```
[238](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L238)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

43:             balance[_from] = fromBalance - _amount; 

106:             balance[address(this)] -= amount; 
107:             totalSupply -= amount;
```
[43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L43), [106](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L106-L107)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

248:             bytes32 correctPrevBlockHash = _calculateLegacyL2BlockHash(_l2BlockNumber - 1); 

255:             _setL2BlockHash(_l2BlockNumber - 1, correctPrevBlockHash); 
```
[248](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L248), [255](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L255)

```solidity
📁 File: system-contracts/contracts/libraries/RLPEncoder.sol

36:                 uint256 lbs = 31 - hbs; 

71:                 uint256 lbs = 31 - hbs; 
```
[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L36), [71](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L71)

</details>


---
### [L&#x2011;38] Unsafe downcast
When a type is downcast to a smaller type, the higher order bits are discarded, resulting in the application of a modulo operation to the original value.

If the downcasted value is large enough, this may result in an overflow that will not revert.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

/// @audit uint256 -> uint160
71:         return address(uint160(uint256(data))); 
```
[71](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L71)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit uint256 -> uint8
149:             require(!_checkBit(processedLogs, uint8(logKey)), "kp"); 
/// @audit uint256 -> uint8
150:             processedLogs = _setBit(processedLogs, uint8(logKey));
```
[149](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L149-L150)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

/// @audit uint256 -> uint64
283:         _params.expirationTimestamp = uint64(block.timestamp + PRIORITY_EXPIRATION); // Safe to cast 
```
[283](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L283)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/LibMap.sol

/// @audit uint256 -> uint32
30:             result = uint32(mapValue >> bitOffset); 

/// @audit uint256 -> uint32
54:             uint32 oldValue = uint32(mapValue >> bitOffset); 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L30), [54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L54)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

/// @audit uint256 -> uint160
92:         address account = address(uint160(_input)); 

/// @audit uint256 -> uint160
120:         address account = address(uint160(_input)); 
```
[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L92), [120](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L120)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

/// @audit uint256 -> uint160
61:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); 

/// @audit uint256 -> uint64
68:             uint64 txDataLen = uint64(_transaction.data.length); 

/// @audit uint256 -> uint64
116:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength)); 

/// @audit uint256 -> uint160
147:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); 

/// @audit uint256 -> uint64
164:             uint64 txDataLen = uint64(_transaction.data.length); 

/// @audit uint256 -> uint64
207:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength)); 

/// @audit uint256 -> uint160
241:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); 

/// @audit uint256 -> uint64
259:             uint64 txDataLen = uint64(_transaction.data.length); 

/// @audit uint256 -> uint64
302:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength)); 
```
[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L61), [68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L68), [116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L116), [147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L147), [164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L164), [207](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L207), [241](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L241), [259](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L259), [302](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L302)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

/// @audit uint256 -> uint160
109:         newAddress = address(uint160(uint256(hash))); 

/// @audit uint256 -> uint160
125:         newAddress = address(uint160(uint256(hash))); 

/// @audit uint256 -> uint128
341:                 SystemContractHelper.setValueForNextFarCall(uint128(value)); 
```
[109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L109), [125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L125), [341](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L341)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

/// @audit uint256 -> uint32
84:             uint32(gasleft()), 

/// @audit uint256 -> uint160
132:         address to = address(uint160(_transaction.to)); 
```
[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L84), [132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L132)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

/// @audit uint256 -> uint32
154:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), uint32(pubdataLen)); 

/// @audit uint256 -> uint32
179:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), uint32(pubdataLen)); 
```
[154](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L154), [179](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L179)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

/// @audit uint256 -> uint160
57:         return balance[address(uint160(_account))]; 
```
[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L57)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

/// @audit uint256 -> uint160
32:         to = address(uint160(addressAsUint)); 
```
[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L32)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

/// @audit uint128 -> uint32
234:         return keccak256(abi.encodePacked(uint32(_blockNumber))); 

/// @audit uint256 -> uint128
/// @audit uint256 -> uint128
476:         BlockInfo memory newBlockInfo = BlockInfo({number: uint128(_number), timestamp: uint128(_newTimestamp)}); 
```
[234](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L234), [476](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L476)

```solidity
📁 File: system-contracts/contracts/libraries/EfficientCall.sol

/// @audit uint256 -> uint32
259:         SystemContractHelper.ptrAddIntoActive(uint32(dataOffset)); 

/// @audit uint256 -> uint32
261:         uint32 shrinkTo = uint32(msg.data.length - (_data.length + dataOffset)); 
```
[259](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L259), [261](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L261)

```solidity
📁 File: system-contracts/contracts/libraries/RLPEncoder.sol

/// @audit uint256 -> uint8
29:                 encoded[0] = (_val == 0) ? bytes1(uint8(128)) : bytes1(uint8(_val)); 

/// @audit uint256 -> uint8
34:                 encoded[0] = bytes1(uint8(hbs + 0x81)); 

/// @audit uint256 -> uint8
64:                 encoded[0] = bytes1(uint8(_len + _offset)); 

/// @audit uint256 -> uint8
69:                 encoded[0] = bytes1(uint8(_offset + hbs + 56)); 
```
[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L29), [34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L34), [64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L64), [69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L69)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractHelper.sol

/// @audit uint256 -> uint32
228:         pubdataPublished = uint32(extractNumberFromMeta(meta, META_GAS_PER_PUBDATA_BYTE_OFFSET, 32)); 

/// @audit uint256 -> uint32
238:         heapSize = uint32(extractNumberFromMeta(meta, META_HEAP_SIZE_OFFSET, 32)); 

/// @audit uint256 -> uint32
247:         auxHeapSize = uint32(extractNumberFromMeta(meta, META_AUX_HEAP_SIZE_OFFSET, 32)); 

/// @audit uint256 -> uint8
255:         shardId = uint8(extractNumberFromMeta(meta, META_SHARD_ID_OFFSET, 8)); 

/// @audit uint256 -> uint8
264:         callerShardId = uint8(extractNumberFromMeta(meta, META_CALLER_SHARD_ID_OFFSET, 8)); 
```
[228](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L228), [238](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L238), [247](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L247), [255](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L255), [264](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L264)

</details>


---
### [L&#x2011;39] Unused/empty `receive()/fallback()` function
If the intention is for the Ether to be used, the function should call another function or emit an event, otherwise it should revert.

<details>
<summary><i>There are 4 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

262:     receive() external payable {} 
```
[262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L262)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

227:     receive() external payable { 
228:         // If the contract is called directly, behave like an EOA
229:     }
```
[227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L227-L229)

```solidity
📁 File: system-contracts/contracts/EmptyContract.sol

11:     fallback() external payable {} 

13:     receive() external payable {} 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L11), [13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L13)

</details>


---
### [L&#x2011;40] Upgradeable contract is missing a `__gap[50]` storage variable at the end to allow for new storage variables in later versions
See [this](https://docs.openzeppelin.com/contracts/4.x/upgradeable#storage_gaps) link for a description of this storage variable. While some contracts may not currently be sub-classed, adding the variable now protects against forgetting to add it in the future.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

15: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade { 
16:     /// @dev Describes whether there is a specific getter in the token.
17:     /// @notice Used to explicitly separate which getters the token has and which it does not.
18:     /// @notice Different tokens in L1 can implement or not implement getter function as `name`/`symbol`/`decimals`,
19:     /// @notice Our goal is to store all the getters that L1 token implements, and for others, we keep it as an unimplemented method.
20:     struct ERC20Getters {
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L15-L20)


## NonCritical


---
### [NC&#x2011;1] `2**<n> - 1` should be re-written as `type(uint<n>).max`
Earlier versions of solidity can use `uint<n>(-1)` instead. Expressions `2**<n> - 1` can often be rewritten to accommodate the change.

<details>
<summary><i>There are 5 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

26:         require(bytecodeLenInWords < 2 ** 16, "pp"); // bytecode length must be less than 2^16 words 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L26)

```solidity
📁 File: system-contracts/contracts/Constants.sol

94: uint256 constant MAX_MSG_VALUE = 2 ** 128 - 1; 
```
[94](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L94)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

28:     uint256 private constant DEPLOY_NONCE_MULTIPLIER = 2 ** 128; 

31:     uint256 private constant MAXIMAL_MIN_NONCE_INCREMENT = 2 ** 32; 
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L28), [31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L31)

```solidity
📁 File: system-contracts/contracts/libraries/Utils.sol

87:         require(lengthInWords < 2 ** 16, "pp"); // bytecode length must be less than 2^16 words 
```
[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L87)

</details>


---
### [NC&#x2011;2] Add inline comments for unnamed variables
`function foo(address x, address)` -> `function foo(address x, address /* y */)`

<details>
<summary><i>There are 8 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

108:     function commitBatches( 
109:         StoredBatchInfo calldata,
110:         CommitBatchInfo[] calldata _newBatchesData
111:     ) external onlyValidator(ERA_CHAIN_ID) {

126:     function commitBatchesSharedBridge( 
127:         uint256 _chainId,
128:         StoredBatchInfo calldata,
129:         CommitBatchInfo[] calldata _newBatchesData
130:     ) external onlyValidator(_chainId) {

146:     function revertBatches(uint256) external onlyValidator(ERA_CHAIN_ID) { 

153:     function revertBatchesSharedBridge(uint256 _chainId, uint256) external onlyValidator(_chainId) { 

160:     function proveBatches( 
161:         StoredBatchInfo calldata,
162:         StoredBatchInfo[] calldata,
163:         ProofInput calldata
164:     ) external onlyValidator(ERA_CHAIN_ID) {

171:     function proveBatchesSharedBridge( 
172:         uint256 _chainId,
173:         StoredBatchInfo calldata,
174:         StoredBatchInfo[] calldata,
175:         ProofInput calldata
176:     ) external onlyValidator(_chainId) {
```
[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L108-L111), [126](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L126-L130), [146](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L146), [153](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L153), [160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L160-L164), [171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L171-L176)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

337:     function executeBatchesSharedBridge( 
338:         uint256,
339:         StoredBatchInfo[] calldata _batchesData
340:     ) external nonReentrant onlyValidator {

477:     function revertBatchesSharedBridge(uint256, uint256 _newLastBatch) external nonReentrant onlyValidator { 
```
[337](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L337-L340), [477](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L477)

</details>


---
### [NC&#x2011;3] Adding a `return` statement when the function defines a named return variable, is redundant
Once the return variable has been assigned (or has its default value), there is no need to explicitly return it at the end of the function, since it's returned automatically.


<i>There is one instance of this issue:</i>

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

/// @audit return statement on line 129
125:     function getDeploymentNonce(address _address) external view returns (uint256 deploymentNonce) { 
```
[125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L125)


---
### [NC&#x2011;4] Assembly block creates dirty bits
Writing data to the free memory pointer without later updating the free memory pointer will cause there to be dirty bits at that memory location. Not updating the free memory pointer will make it [harder](https://docs.soliditylang.org/en/latest/ir-breaking-changes.html#cleanup) for the optimizer to reason about whether the memory needs to be cleaned before use, which will lead to worse optimizations.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

33:         assembly { 
34:             // The pointer to the free memory slot
35:             let ptr := mload(0x40)
36:             // Copy function signature and arguments from calldata at zero position into memory at pointer position
37:             calldatacopy(ptr, 0, calldatasize())
38:             // Delegatecall method of the implementation contract returns 0 on error
39:             let result := delegatecall(gas(), facetAddress, ptr, calldatasize(), 0, 0)
40:             // Get the size of the last return data
41:             let size := returndatasize()
42:             // Copy the size length of bytes from return data at zero position to pointer position
43:             returndatacopy(ptr, 0, size)
44:             // Depending on the result value
45:             switch result
46:             case 0 {
47:                 // End execution and revert state changes
48:                 revert(ptr, size)
49:             }
50:             default {
51:                 // Return data with length of size at pointers position
52:                 return(ptr, size)
53:             }
54:         }
```
[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L33-L54)


---
### [NC&#x2011;5] Assembly blocks should have extensive comments
Assembly blocks take a lot more time to audit than normal Solidity code, and often have gotchas and side-effects that the Solidity versions of the same code do not. Consider adding more comments explaining what is being done in every step of the assembly code, and describe why assembly is being used instead of Solidity.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

357:             assembly { 
358:                 callSuccess := call(gas(), _depositSender, _amount, 0, 0, 0, 0)
359:             }

446:             assembly { 
447:                 callSuccess := call(gas(), l1Receiver, amount, 0, 0, 0, 0)
448:             }
```
[357](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L357-L359), [446](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L446-L448)

```solidity
📁 File: contracts/ethereum/contracts/common/ReentrancyGuard.sol

52:         assembly { 
53:             lockSlotOldValue := sload(LOCK_FLAG_ADDRESS)
54:             sstore(LOCK_FLAG_ADDRESS, _NOT_ENTERED)
55:         }

70:         assembly { 
71:             _status := sload(LOCK_FLAG_ADDRESS)
72:         }

78:         assembly { 
79:             sstore(LOCK_FLAG_ADDRESS, _ENTERED)
80:         }

86:         assembly { 
87:             sstore(LOCK_FLAG_ADDRESS, _NOT_ENTERED)
88:         }
```
[52](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L52-L55), [70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L70-L72), [78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L78-L80), [86](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L86-L88)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol

20:         assembly { 
21:             offset := add(_start, 4)
22:             result := mload(add(_bytes, offset))
23:         }

27:         assembly { 
28:             offset := add(_start, 20)
29:             result := mload(add(_bytes, offset))
30:         }

34:         assembly { 
35:             offset := add(_start, 32)
36:             result := mload(add(_bytes, offset))
37:         }

41:         assembly { 
42:             offset := add(_start, 32)
43:             result := mload(add(_bytes, offset))
44:         }
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L20-L23), [27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L27-L30), [34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L34-L37), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L41-L44)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

229:                 assembly { 
230:                     revert(add(returnData, 0x20), mload(returnData))
231:                 }
```
[229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L229-L231)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

227:         assembly { 
228:             // Copy function signature and arguments from calldata at zero position into memory at pointer position
229:             calldatacopy(0, 0, calldatasize())
230:             // Call method of the hyperchain diamond contract returns 0 on error
231:             let result := call(gas(), contractAddress, 0, 0, calldatasize(), 0, 0)
232:             // Get the size of the last return data
233:             let size := returndatasize()
234:             // Copy the size length of bytes from return data at zero position to pointer position
235:             returndatacopy(0, 0, size)
236:             // Depending on the result value
237:             switch result
238:             case 0 {
239:                 // End execution and revert state changes
240:                 revert(0, size)
241:             }
242:             default {
243:                 // Return data with length of size at pointers position
244:                 return(0, size)
245:             }
246:         }
```
[227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L227-L246)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

33:         assembly { 
34:             // The pointer to the free memory slot
35:             let ptr := mload(0x40)
36:             // Copy function signature and arguments from calldata at zero position into memory at pointer position
37:             calldatacopy(ptr, 0, calldatasize())
38:             // Delegatecall method of the implementation contract returns 0 on error
39:             let result := delegatecall(gas(), facetAddress, ptr, calldatasize(), 0, 0)
40:             // Get the size of the last return data
41:             let size := returndatasize()
42:             // Copy the size length of bytes from return data at zero position to pointer position
43:             returndatacopy(ptr, 0, size)
44:             // Depending on the result value
45:             switch result
46:             case 0 {
47:                 // End execution and revert state changes
48:                 revert(ptr, size)
49:             }
50:             default {
51:                 // Return data with length of size at pointers position
52:                 return(ptr, size)
53:             }
54:         }
```
[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L33-L54)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

360:             assembly { 
361:                 mstore(add(hashedFactoryDeps, mul(add(i, 1), 32)), hashedBytecode)
362:             }
```
[360](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L360-L362)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

89:         assembly { 
90:             diamondStorage.slot := position
91:         }

290:                 assembly { 
291:                     revert(add(data, 0x20), mload(data))
292:                 }
```
[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L89-L91), [290](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L290-L292)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Merkle.sol

41:         assembly { 
42:             mstore(0x00, _lhs)
43:             mstore(0x20, _rhs)
44:             result := keccak256(0x00, 0x40)
45:         }
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L41-L45)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

70:         assembly { 
71:             sstore(addressAsKey, _hash)
72:         }

81:         assembly { 
82:             codeHash := sload(addressAsKey)
83:         }
```
[70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L70-L72), [81](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L81-L83)

```solidity
📁 File: system-contracts/contracts/ComplexUpgrader.sol

26:         assembly { 
27:             if iszero(success) {
28:                 revert(add(returnData, 0x20), mload(returnData))
29:             }
30:         }
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L26-L30)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

31:             assembly { 
32:                 return(0, 0)
33:             }

49:             assembly { 
50:                 return(0, 0)
51:             }

168:         assembly { 
169:             r := mload(add(_signature, 0x20))
170:             s := mload(add(_signature, 0x40))
171:             v := and(mload(add(_signature, 0x41)), 0xff)
172:         }
```
[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L31-L33), [49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L49-L51), [168](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L168-L172)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

55:             assembly { 
56:                 sstore(_bytecodeHash, 1)
57:             }

66:         assembly { 
67:             marker := sload(_hash)
68:         }
```
[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L55-L57), [66](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L66-L68)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

69:                 assembly { 
70:                     revert(0, 0)
71:                 }
```
[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L69-L71)

```solidity
📁 File: system-contracts/contracts/PubdataChunkPublisher.sol

30:         assembly { 
31:             // The pointer to the allocated memory above. We skip 32 bytes to avoid overwriting the length.
32:             let ptr := add(totalBlobs, 0x20)
33:             calldatacopy(ptr, _pubdata.offset, _pubdata.length)
34:         }

46:             assembly { 
47:                 // The pointer to the allocated memory above skipping the length.
48:                 let ptr := add(totalBlobs, 0x20)
49:                 blobHash := keccak256(add(ptr, start), BLOB_SIZE_BYTES)
50:             }
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L30-L34), [46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L46-L50)

```solidity
📁 File: system-contracts/contracts/libraries/EfficientCall.sol

135:             assembly { 
136:                 success := call(_address, callAddr, 0, 0, 0xFFFF, 0, 0)
137:             }

148:             assembly { 
149:                 success := call(msgValueSimulator, callAddr, _value, _address, 0xFFFF, forwardMask, 0)
150:             }

163:         assembly { 
164:             success := staticcall(_address, callAddr, 0, 0xFFFF, 0, 0)
165:         }

177:         assembly { 
178:             success := delegatecall(_address, callAddr, 0, 0xFFFF, 0, 0)
179:         }

203:         assembly { 
204:             // Clearing values before usage in assembly, since Solidity
205:             // doesn't do it by default
206:             _whoToMimic := and(_whoToMimic, cleanupMask)
207: 
208:             success := call(_address, callAddr, 0, 0, _whoToMimic, 0, 0)
209:         }

218:             assembly { 
219:                 size := returndatasize()
220:             }

223:             assembly { 
224:                 returndatacopy(add(returnData, 0x20), 0, size)
225:             }

233:         assembly { 
234:             let size := returndatasize()
235:             returndatacopy(0, 0, size)
236:             revert(0, size)
237:         }

254:         assembly { 
255:             dataOffset := _data.offset
256:         }
```
[135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L135-L137), [148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L148-L150), [163](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L163-L165), [177](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L177-L179), [203](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L203-L209), [218](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L218-L220), [223](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L223-L225), [233](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L233-L237), [254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L254-L256)

```solidity
📁 File: system-contracts/contracts/libraries/RLPEncoder.sol

39:                 assembly { 
40:                     mstore(add(encoded, 0x21), shiftedVal)
41:                 }

74:                 assembly { 
75:                     mstore(add(encoded, 0x21), shiftedVal)
76:                 }
```
[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L39-L41), [74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L74-L76)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractHelper.sol

65:         assembly { 
66:             addr := staticcall(0, callAddr, 0, 0xFFFF, 0, 0)
67:         }
```
[65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L65-L67)

</details>


---
### [NC&#x2011;6] Avoid external calls in modifiers
It is unusual to have external calls in modifiers, and doing so will make reviewers more likely to miss important external interactions. Consider moving the external call to an internal function, and calling that function from the modifier.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit stateTransitionManager.getChainAdmin()
61:     modifier onlyChainAdmin(uint256 _chainId) { 
62:         require(msg.sender == stateTransitionManager.getChainAdmin(_chainId), "ValidatorTimelock: only chain admin");
63:         _;
64:     }
```
[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L61-L64)


---
### [NC&#x2011;7] Avoid mutating `function`/`modifier` parameters
Use a local variable instead

<details>
<summary><i>There are 8 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit _lastCommittedBatchData
258:             _lastCommittedBatchData = _commitOneBatch(_lastCommittedBatchData, _newBatchesData[i], bytes32(0)); 

/// @audit _lastCommittedBatchData
292:             _lastCommittedBatchData = _commitOneBatch( 
293:                 _lastCommittedBatchData,
294:                 _newBatchesData[i],
295:                 expectedUpgradeTxHash
296:             );
```
[258](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L258), [292](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L292-L296)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Merkle.sol

/// @audit _index
33:             _index /= 2; 
```
[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L33)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

/// @audit _maxVirtualBlocksToCreate
288:             _maxVirtualBlocksToCreate -= 1; 
```
[288](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L288)

```solidity
📁 File: system-contracts/contracts/libraries/RLPEncoder.sol

/// @audit _number
87:                 _number >>= 128; 

/// @audit _number
91:                 _number >>= 64; 

/// @audit _number
95:                 _number >>= 32; 

/// @audit _number
99:                 _number >>= 16; 
```
[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L87), [91](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L91), [95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L95), [99](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L99)

</details>


---
### [NC&#x2011;8] Avoid the use of sensitive terms
Use [alternative variants](https://www.zdnet.com/article/mysql-drops-master-slave-and-blacklist-whitelist-terminology/), e.g. allowlist/denylist instead of whitelist/blacklist

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/Messaging.sol

86: /// @param paymaster The address of the EIP-4337 paymaster, that will pay fees for the 

96: /// @param paymasterInput The arbitrary-length data that is used as a calldata to the paymaster pre-call 

106:     uint256 paymaster; 

121:     bytes paymasterInput; 
```
[86](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Messaging.sol#L86), [96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Messaging.sol#L96), [106](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Messaging.sol#L106), [121](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Messaging.sol#L121)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

190:             paymaster: uint256(0), 

198:             paymasterInput: new bytes(0), 
```
[190](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L190), [198](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L198)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

302:             paymaster: uint256(0), 

310:             paymasterInput: new bytes(0), 
```
[302](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L302), [310](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L310)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol

50:         require(_transaction.paymaster == 0, "uc"); 

59:         require(_transaction.paymasterInput.length == 0, "ul1"); 
```
[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L50), [59](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L59)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

231:         // https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1559.md 
```
[231](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L231)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

206:     /// paid for by a paymaster. 

212:     function prepareForPaymaster( 

217:         _transaction.processPaymasterInput(); 
```
[206](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L206), [212](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L212), [217](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L217)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

8: import "../interfaces/IPaymasterFlow.sol"; 

43:     // The transaction's paymaster. If there is no paymaster, it is equal to 0. 
44:     uint256 paymaster;

66:     // The input to the paymaster. 
67:     bytes paymasterInput;

86:             "Transaction(uint256 txType,uint256 from,uint256 to,uint256 gasLimit,uint256 gasPerPubdataByteLimit,uint256 maxFeePerGas,uint256 maxPriorityFeePerGas,uint256 paymaster,uint256 nonce,uint256 value,bytes data,bytes32[] factoryDeps,bytes paymasterInput)" 

129:                 _transaction.paymaster, 

134:                 EfficientCall.keccak(_transaction.paymasterInput) 

359:     /// @notice Processes the common paymaster flows, e.g. setting proper allowance 

361:     /// the "Paymaster flows" section in the documentation. 
362:     function processPaymasterInput(Transaction calldata _transaction) internal {
363:         require(_transaction.paymasterInput.length >= 4, "The standard paymaster input must be at least 4 bytes long");

365:         bytes4 paymasterInputSelector = bytes4(_transaction.paymasterInput[0:4]); 
366:         if (paymasterInputSelector == IPaymasterFlow.approvalBased.selector) {

368:                 _transaction.paymasterInput.length >= 68, 
369:                 "The approvalBased paymaster input must be at least 68 bytes long"

373:             // the data is needed only for the paymaster, so we ignore it here for the sake of optimization 
374:             (address token, uint256 minAllowance) = abi.decode(_transaction.paymasterInput[4:68], (address, uint256));
375:             address paymaster = address(uint160(_transaction.paymaster));
```
[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L8), [43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L43-L44), [66](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L66-L67), [86](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L86), [129](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L129), [134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L134), [359](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L359), [361](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L361-L363), [365](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L365-L366), [368](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L368-L369), [373](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L373-L375)

</details>


---
### [NC&#x2011;9] Codebase should implement formal verification testing
Formal verification is the act of proving or disproving the correctness of intended algorithms underlying a system with respect to a certain formal specification/property/invariant, using formal methods of mathematics.

Some tools that are currently available to perform these tests on smart contracts are [SMTChecker](https://docs.soliditylang.org/en/latest/smtchecker.html) and [Certora Prover](https://www.certora.com/).


---
### [NC&#x2011;10] Common functions should be refactored to a common base contract
The functions below have the same implementation as is seen in other files. The functions should be refactored into functions of a common base contract


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

/// @audit also seen in contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol
47:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual override returns (bytes32) { 
```
[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L47)


---
### [NC&#x2011;11] Complicated functions should have explicit comments
Large and/or complex functions should have more comments to better explain the purpose of each logic step.

<details>
<summary><i>There are 9 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit function is 66 lines long
130:     function _processL2Logs( 
131:         CommitBatchInfo calldata _newBatch,
132:         bytes32 _expectedSystemContractUpgradeTxHash
133:     ) internal pure returns (LogProcessingOutput memory logOutput) {
```
[130](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L130-L133)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

/// @audit function is 90 lines long
44:     function encodeLegacyTransactionHash(Transaction calldata _transaction) internal view returns (bytes32 txHash) { 

/// @audit function is 85 lines long
139:     function encodeEIP2930TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) { 

/// @audit function is 90 lines long
229:     function encodeEIP1559TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) { 
```
[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L44), [139](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L139), [229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L229)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

/// @audit function is 80 lines long
110:     function verifyCompressedStateDiffs( 
111:         uint256 _numberOfStateDiffs,
112:         uint256 _enumerationIndexSize,
113:         bytes calldata _stateDiffs,
114:         bytes calldata _compressedStateDiffs
115:     ) external payable onlyCallFrom(address(L1_MESSENGER_CONTRACT)) returns (bytes32 stateDiffHash) {
```
[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L110-L115)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

/// @audit function is 139 lines long
194:     function publishPubdataAndClearState( 
195:         bytes calldata _totalL2ToL1PubdataAndStateDiffs
196:     ) external onlyCallFromBootloader {
```
[194](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L194-L196)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

/// @audit function is 68 lines long
147:     function _encodeHashLegacyTransaction(Transaction calldata _transaction) private view returns (bytes32) { 

/// @audit function is 66 lines long
219:     function _encodeHashEIP2930Transaction(Transaction calldata _transaction) private view returns (bytes32) { 

/// @audit function is 68 lines long
289:     function _encodeHashEIP1559Transaction(Transaction calldata _transaction) private view returns (bytes32) { 
```
[147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L147), [219](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L219), [289](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L289)

</details>


---
### [NC&#x2011;12] Consider adding a block/deny-list
Doing so will significantly increase centralization, but will help to prevent hackers from using stolen tokens

<details>
<summary><i>There are 34 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

19: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard { 
20:     using SafeERC20 for IERC20;
21: 
22:     /// @dev The shared bridge that is now used for all bridging, replacing the legacy contract.
23:     IL1SharedBridge public immutable override sharedBridge;
24: 
25:     /// @dev A mapping L2 batch number => message number => flag.
26:     /// @dev Used to indicate that L2 -> L1 message was already processed for zkSync Era withdrawals.
27:     mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized))
28:         public isWithdrawalFinalized;
29: 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L19-L29)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step { 
31:     using SafeERC20 for IERC20;
32: 
33:     /// @dev The address of the WETH token on L1.
34:     address public immutable override l1WethAddress;
35: 
36:     /// @dev Bridgehub smart contract that is used to operate with L2 via asynchronous L2 <-> L1 communication.
37:     IBridgehub public immutable override bridgehub;
38: 
39:     /// @dev Legacy bridge smart contract that used to hold ERC20 tokens.
40:     IL1ERC20Bridge public immutable override legacyBridge;
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30-L40)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step { 
17:     /// @notice all the ether is held by the weth bridge
18:     IL1SharedBridge public sharedBridge;
19: 
20:     /// @notice we store registered stateTransitionManagers
21:     mapping(address _stateTransitionManager => bool) public stateTransitionManagerIsRegistered;
22:     /// @notice we store registered tokens (for arbitrary base token)
23:     mapping(address _token => bool) public tokenIsRegistered;
24: 
25:     /// @notice chainID => StateTransitionManager contract address, storing StateTransitionManager
26:     mapping(uint256 _chainId => address) public stateTransitionManager;
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16-L26)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

20: contract Governance is IGovernance, Ownable2Step { 
21:     /// @notice A constant representing the timestamp for completed operations.
22:     uint256 internal constant EXECUTED_PROPOSAL_TIMESTAMP = uint256(1);
23: 
24:     /// @notice The address of the security council.
25:     /// @dev It is supposed to be multisig contract.
26:     address public securityCouncil;
27: 
28:     /// @notice A mapping to store timestamps when each operation will be ready for execution.
29:     /// @dev - 0 means the operation is not created.
30:     /// @dev - 1 (EXECUTED_PROPOSAL_TIMESTAMP) means the operation is already executed.
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L20-L30)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step { 
26:     /// @notice Address of the bridgehub
27:     address public immutable bridgehub;
28: 
29:     /// @notice chainId => chainContract
30:     mapping(uint256 => address) public stateTransition;
31: 
32:     /// @dev Batch hash zero, calculated at initialization
33:     bytes32 public storedBatchZero;
34: 
35:     /// @dev Stored cutData for diamond cut
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L25-L35)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

22: contract ValidatorTimelock is IExecutor, Ownable2Step { 
23:     using LibMap for LibMap.Uint32Map;
24: 
25:     /// @dev Part of the IBase interface. Not used in this contract.
26:     string public constant override getName = "ValidatorTimelock";
27: 
28:     /// @notice The delay between committing and executing batches is changed.
29:     event NewExecutionDelay(uint256 _newExecutionDelay);
30: 
31:     /// @notice A new validator has been added.
32:     event ValidatorAdded(uint256 _chainId, address _addedValidator);
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L22-L32)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

17: contract DiamondInit is ZkSyncStateTransitionBase, IDiamondInit { 
18:     /// @dev Initialize the implementation to prevent any possibility of a Parity hack.
19:     constructor() reentrancyGuardInitializer {}
20: 
21:     /// @notice hyperchain diamond contract initialization
22:     /// @return Magic 32 bytes, which indicates that the contract logic is expected to be used as a diamond proxy
23:     /// initializer
24:     function initialize(InitializeData calldata _initializeData) external reentrancyGuardInitializer returns (bytes32) {
25:         require(address(_initializeData.verifier) != address(0), "vt");
26:         require(_initializeData.admin != address(0), "vy");
27:         require(_initializeData.validatorTimelock != address(0), "hc");
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L17-L27)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

10: contract DiamondProxy { 
11:     constructor(uint256 _chainId, Diamond.DiamondCutData memory _diamondCut) {
12:         // Check that the contract is deployed on the expected chain.
13:         // Thus, the contract deployed by the same Create2 factory on the different chain will have different addresses!
14:         require(_chainId == block.chainid, "pr");
15:         Diamond.diamondCut(_diamondCut);
16:     }
17: 
18:     /// @dev 1. Find the facet for the function that is called.
19:     /// @dev 2. Delegate the execution to the found facet via `delegatecall`.
20:     fallback() external payable {
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L10-L20)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

18: contract AdminFacet is ZkSyncStateTransitionBase, IAdmin { 
19:     /// @inheritdoc IZkSyncStateTransitionBase
20:     string public constant override getName = "AdminFacet";
21: 
22:     /// @inheritdoc IAdmin
23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin {
24:         // Save previous value into the stack to put it into the event later
25:         address oldPendingAdmin = s.pendingAdmin;
26:         // Change pending admin
27:         s.pendingAdmin = _newPendingAdmin;
28:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L18-L28)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

22: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor { 
23:     using UncheckedMath for uint256;
24:     using PriorityQueue for PriorityQueue.Queue;
25: 
26:     /// @inheritdoc IZkSyncStateTransitionBase
27:     string public constant override getName = "ExecutorFacet";
28: 
29:     /// @dev Process one batch commit using the previous batch StoredBatchInfo
30:     /// @dev returns new batch StoredBatchInfo
31:     /// @notice Does not change storage
32:     function _commitOneBatch(
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L22-L32)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

20: contract GettersFacet is ZkSyncStateTransitionBase, IGetters, ILegacyGetters { 
21:     using UncheckedMath for uint256;
22:     using PriorityQueue for PriorityQueue.Queue;
23: 
24:     /// @inheritdoc IZkSyncStateTransitionBase
25:     string public constant override getName = "GettersFacet";
26: 
27:     /*//////////////////////////////////////////////////////////////
28:                             CUSTOM GETTERS
29:     //////////////////////////////////////////////////////////////*/
30: 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L20-L30)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

30: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox { 
31:     using UncheckedMath for uint256;
32:     using PriorityQueue for PriorityQueue.Queue;
33: 
34:     /// @inheritdoc IZkSyncStateTransitionBase
35:     string public constant override getName = "MailboxFacet";
36: 
37:     /// @inheritdoc IMailbox
38:     function transferEthToSharedBridge() external onlyBaseTokenBridge {
39:         require(s.chainId == ERA_CHAIN_ID, "transferEthToSharedBridge only available for Era on mailbox");
40: 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L30-L40)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol

11: contract ZkSyncStateTransitionBase is ReentrancyGuard { 
12:     ZkSyncStateTransitionStorage internal s;
13: 
14:     /// @notice Checks that the message sender is an active admin
15:     modifier onlyAdmin() {
16:         require(msg.sender == s.admin, "StateTransition Chain: not admin");
17:         _;
18:     }
19: 
20:     /// @notice Checks if validator is active
21:     modifier onlyValidator() {
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L11-L21)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

10: contract DefaultUpgrade is BaseZkSyncUpgrade { 
11:     /// @notice The main function that will be called by the upgrade proxy.
12:     /// @param _proposedUpgrade The upgrade to be executed.
13:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
14:         super.upgrade(_proposedUpgrade);
15:         return Diamond.DIAMOND_INIT_SUCCESS_RETURN_VALUE;
16:     }
17: }
18: 
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L10-L18)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

11: contract GenesisUpgrade is BaseZkSyncUpgradeGenesis { 
12:     /// @notice The main function that will be called by the upgrade proxy.
13:     /// @param _proposedUpgrade The upgrade to be executed.
14:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
15:         super.upgrade(_proposedUpgrade);
16:         return Diamond.DIAMOND_INIT_SUCCESS_RETURN_VALUE;
17:     }
18: }
19: 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L11-L19)

```solidity
📁 File: contracts/zksync/contracts/ForceDeployUpgrader.sol

10: contract ForceDeployUpgrader { 
11:     /// @notice A function that performs force deploy
12:     /// @param _forceDeployments The force deployments to perform.
13:     function forceDeploy(IContractDeployer.ForceDeployment[] calldata _forceDeployments) external payable {
14:         IContractDeployer(DEPLOYER_SYSTEM_CONTRACT).forceDeployOnAddresses{value: msg.value}(_forceDeployments);
15:     }
16: }
17: 
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L10-L17)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

23: contract L2SharedBridge is IL2SharedBridge, Initializable { 
24:     /// @dev The address of the L1 bridge counterpart.
25:     address public override l1Bridge;
26: 
27:     /// @dev Contract that stores the implementation address for token.
28:     /// @dev For more details see https://docs.openzeppelin.com/contracts/3.x/api/proxy#UpgradeableBeacon.
29:     UpgradeableBeacon public l2TokenBeacon;
30: 
31:     /// @dev Bytecode hash of the proxy for tokens deployed by the bridge.
32:     bytes32 internal l2TokenProxyBytecodeHash;
33: 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L23-L33)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

15: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade { 
16:     /// @dev Describes whether there is a specific getter in the token.
17:     /// @notice Used to explicitly separate which getters the token has and which it does not.
18:     /// @notice Different tokens in L1 can implement or not implement getter function as `name`/`symbol`/`decimals`,
19:     /// @notice Our goal is to store all the getters that L1 token implements, and for others, we keep it as an unimplemented method.
20:     struct ERC20Getters {
21:         bool ignoreName;
22:         bool ignoreSymbol;
23:         bool ignoreDecimals;
24:     }
25: 
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L15-L25)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

22: contract AccountCodeStorage is IAccountCodeStorage { 
23:     bytes32 constant EMPTY_STRING_KECCAK = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470;
24: 
25:     modifier onlyDeployer() {
26:         require(msg.sender == address(DEPLOYER_SYSTEM_CONTRACT), "Callable only by the deployer system contract");
27:         _;
28:     }
29: 
30:     /// @notice Stores the bytecodeHash of constructing contract.
31:     /// @param _address The address of the account to set the codehash to.
32:     /// @param _hash The new bytecode hash of the constructing account.
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L22-L32)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

16: contract BootloaderUtilities is IBootloaderUtilities { 
17:     using TransactionHelper for *;
18: 
19:     /// @notice Calculates the canonical transaction hash and the recommended transaction hash.
20:     /// @param _transaction The transaction.
21:     /// @return txHash and signedTxHash of the transaction, i.e. the transaction hash to be used in the explorer and commits to all
22:     /// the fields of the transaction and the recommended hash to be signed for this transaction.
23:     /// @dev txHash must be unique for all transactions.
24:     function getTransactionHashes(
25:         Transaction calldata _transaction
26:     ) external view override returns (bytes32 txHash, bytes32 signedTxHash) {
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L16-L26)

```solidity
📁 File: system-contracts/contracts/ComplexUpgrader.sol

14: contract ComplexUpgrader is IComplexUpgrader { 
15:     /// @notice Executes an upgrade process by delegating calls to another contract.
16:     /// @dev This function allows only the `FORCE_DEPLOYER` to initiate the upgrade.
17:     /// If the delegate call fails, the function will revert the transaction, returning the error message
18:     /// provided by the delegated contract.
19:     /// @param _delegateTo the address of the contract to which the calls will be delegated
20:     /// @param _calldata the calldata to be delegate called in the `_delegateTo` contract
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable {
22:         require(msg.sender == FORCE_DEPLOYER, "Can only be called by FORCE_DEPLOYER");
23: 
24:         require(_delegateTo.code.length > 0, "Delegatee is an EOA");
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L14-L24)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

22: contract Compressor is ICompressor, ISystemContract { 
23:     using UnsafeBytesCalldata for bytes;
24: 
25:     /// @notice Verify the compressed bytecode and publish it on the L1.
26:     /// @param _bytecode The original bytecode to be verified against.
27:     /// @param _rawCompressedData The compressed bytecode in a format of:
28:     ///    - 2 bytes: the length of the dictionary
29:     ///    - N bytes: the dictionary
30:     ///    - M bytes: the encoded data
31:     /// @return bytecodeHash The hash of the original bytecode.
32:     /// @dev The dictionary is a sequence of 8-byte chunks, each of them has the associated index.
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L22-L32)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

23: contract ContractDeployer is IContractDeployer, ISystemContract { 
24:     /// @notice Information about an account contract.
25:     /// @dev For EOA and simple contracts (i.e. not accounts) this value is 0.
26:     mapping(address => AccountInfo) internal accountInfo;
27: 
28:     modifier onlySelf() {
29:         require(msg.sender == address(this), "Callable only by self");
30:         _;
31:     }
32: 
33:     /// @notice Returns information about a certain account.
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L23-L33)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

19: contract DefaultAccount is IAccount { 
20:     using TransactionHelper for *;
21: 
22:     /**
23:      * @dev Simulate the behavior of the EOA if the caller is not the bootloader.
24:      * Essentially, for all non-bootloader callers halt the execution with empty return data.
25:      * If all functions will use this modifier AND the contract will implement an empty payable fallback()
26:      * then the contract will be indistinguishable from the EOA when called.
27:      */
28:     modifier ignoreNonBootloader() {
29:         if (msg.sender != BOOTLOADER_FORMAL_ADDRESS) {
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L19-L29)

```solidity
📁 File: system-contracts/contracts/EmptyContract.sol

10: contract EmptyContract { 
11:     fallback() external payable {}
12: 
13:     receive() external payable {}
14: }
15: 
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L10-L15)

```solidity
📁 File: system-contracts/contracts/GasBoundCaller.sol

15: contract GasBoundCaller { 
16:     /// @notice We assume that no more than `CALL_ENTRY_OVERHEAD` ergs are used for the O(1) operations at the start
17:     /// of execution of the contract, such as abi decoding the parameters, jumping to the correct function, etc.
18:     uint256 constant CALL_ENTRY_OVERHEAD = 800;
19:     /// @notice We assume that no more than `CALL_RETURN_OVERHEAD` ergs are used for the O(1) operations at the end of the execution,
20:     /// as such relaying the return.
21:     uint256 constant CALL_RETURN_OVERHEAD = 200;
22: 
23:     /// @notice The function that implements limiting of the total gas expenditure of the call.
24:     /// @dev On Era, the gas for pubdata is charged at the end of the execution of the entire transaction, meaning
25:     /// that if a subcall is not trusted, it can consume lots of pubdata in the process. This function ensures that
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L15-L25)

```solidity
📁 File: system-contracts/contracts/ImmutableSimulator.sol

18: contract ImmutableSimulator is IImmutableSimulator { 
19:     /// @dev mapping (contract address) => (index of immutable variable) => value
20:     /// @notice that address uses `uint256` type to leave the option to introduce 32-byte address space in future.
21:     mapping(uint256 contractAddress => mapping(uint256 index => bytes32 value)) internal immutableDataStorage;
22: 
23:     /// @notice Method that returns the immutable with a certain index for a user.
24:     /// @param _dest The address which the immutable belongs to.
25:     /// @param _index The index of the immutable.
26:     /// @return The value of the immutables.
27:     function getImmutable(address _dest, uint256 _index) external view override returns (bytes32) {
28:         return immutableDataStorage[uint256(uint160(_dest))][_index];
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L18-L28)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

18: contract KnownCodesStorage is IKnownCodesStorage, ISystemContract { 
19:     modifier onlyCompressor() {
20:         require(msg.sender == address(COMPRESSOR_CONTRACT), "Callable only by the compressor");
21:         _;
22:     }
23: 
24:     /// @notice The method that is used by the bootloader to mark several bytecode hashes as known.
25:     /// @param _shouldSendToL1 Whether the bytecode should be sent on L1.
26:     /// @param _hashes Hashes of the bytecodes to be marked as known.
27:     function markFactoryDeps(bool _shouldSendToL1, bytes32[] calldata _hashes) external onlyCallFromBootloader {
28:         unchecked {
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L18-L28)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

25: contract L1Messenger is IL1Messenger, ISystemContract { 
26:     /// @notice Sequential hash of logs sent in the current block.
27:     /// @dev Will be reset at the end of the block to zero value.
28:     bytes32 internal chainedLogsHash;
29: 
30:     /// @notice Number of logs sent in the current block.
31:     /// @dev Will be reset at the end of the block to zero value.
32:     uint256 internal numberOfLogsToProcess;
33: 
34:     /// @notice Sequential hash of hashes of the messages sent in the current block.
35:     /// @dev Will be reset at the end of the block to zero value.
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L25-L35)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

18: contract L2BaseToken is IBaseToken, ISystemContract { 
19:     /// @notice The balances of the users.
20:     mapping(address account => uint256 balance) internal balance;
21: 
22:     /// @notice The total amount of tokens that have been minted.
23:     uint256 public override totalSupply;
24: 
25:     /// @notice Transfer tokens from one address to another.
26:     /// @param _from The address to transfer the ETH from.
27:     /// @param _to The address to transfer the ETH to.
28:     /// @param _amount The amount of ETH in wei being transferred.
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L18-L28)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

19: contract MsgValueSimulator is ISystemContract { 
20:     /// @notice Extract value, isSystemCall and to from the extraAbi params.
21:     /// @dev The contract accepts value, the callee and whether the call should be a system one via its ABI params.
22:     /// @dev The first ABI param contains the value in the [0..127] bits. The 128th contains
23:     /// the flag whether or not the call should be a system one.
24:     /// The second ABI params contains the callee.
25:     function _getAbiParams() internal view returns (uint256 value, bool isSystemCall, address to) {
26:         value = SystemContractHelper.getExtraAbiData(0);
27:         uint256 addressAsUint = SystemContractHelper.getExtraAbiData(1);
28:         uint256 mask = SystemContractHelper.getExtraAbiData(2);
29: 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L19-L29)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

27: contract NonceHolder is INonceHolder, ISystemContract { 
28:     uint256 private constant DEPLOY_NONCE_MULTIPLIER = 2 ** 128;
29:     /// The minNonce can be increased by 2^32 at a time to prevent it from
30:     /// overflowing beyond 2**128.
31:     uint256 private constant MAXIMAL_MIN_NONCE_INCREMENT = 2 ** 32;
32: 
33:     /// RawNonces for accounts are stored in format
34:     /// minNonce + 2^128 * deploymentNonce, where deploymentNonce
35:     /// is the nonce used for deploying smart contracts.
36:     mapping(uint256 account => uint256 packedMinAndDeploymentNonce) internal rawNonces;
37: 
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L27-L37)

```solidity
📁 File: system-contracts/contracts/PubdataChunkPublisher.sol

16: contract PubdataChunkPublisher is IPubdataChunkPublisher, ISystemContract { 
17:     /// @notice Chunks pubdata into pieces that can fit into blobs.
18:     /// @param _pubdata The total l2 to l1 pubdata that will be sent via L1 blobs.
19:     /// @dev Note: This is an early implementation, in the future we plan to support up to 16 blobs per l1 batch.
20:     /// @dev We always publish 2 system logs even if our pubdata fits into a single blob. This makes processing logs on L1 easier.
21:     function chunkAndPublishPubdata(bytes calldata _pubdata) external onlyCallFrom(address(L1_MESSENGER_CONTRACT)) {
22:         require(_pubdata.length <= BLOB_SIZE_BYTES * MAX_NUMBER_OF_BLOBS, "pubdata should fit in 2 blobs");
23: 
24:         bytes32[] memory blobHashes = new bytes32[](MAX_NUMBER_OF_BLOBS);
25: 
26:         // We allocate to the full size of MAX_NUMBER_OF_BLOBS * BLOB_SIZE_BYTES because we need to pad
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L16-L26)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

17: contract SystemContext is ISystemContext, ISystemContextDeprecated, ISystemContract { 
18:     /// @notice The number of latest L2 blocks to store.
19:     /// @dev EVM requires us to be able to query the hashes of previous 256 blocks.
20:     /// We could either:
21:     /// - Store the latest 256 hashes (and strictly rely that we do not accidentally override the hash of the block 256 blocks ago)
22:     /// - Store the latest 257 blocks' hashes.
23:     uint256 internal constant MINIBLOCK_HASHES_TO_STORE = 257;
24: 
25:     /// @notice The chainId of the network. It is set at the genesis.
26:     uint256 public chainId;
27: 
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L17-L27)

</details>


---
### [NC&#x2011;13] Consider disallowing transfers to `address(this)`
<details>
<summary><i>There are 5 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

116:     function transferFundsFromLegacy(address _token, address _target, uint256 _targetChainId) external onlyOwner { 
```
[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L116)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

123:     function withdraw(address _l1Receiver, address _l2Token, uint256 _amount) external override { 
```
[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L123)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

32:     function transferFromTo(address _from, address _to, uint256 _amount) external override { 

72:     function withdraw(address _l1Receiver) external payable override { 

85:     function withdrawWithMessage(address _l1Receiver, bytes memory _additionalData) external payable override { 
```
[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L32), [72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L72), [85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L85)

</details>


---
### [NC&#x2011;14] Consider making contracts `Upgradeable`
This allows for bugs to be fixed in production, at the expense of *significantly* increasing centralization.

<details>
<summary><i>There are 37 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit contract L1ERC20Bridge is not upgradeable
19: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard { 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L19)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit contract L1SharedBridge is not upgradeable
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step { 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit contract Bridgehub is not upgradeable
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step { 
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16)

```solidity
📁 File: contracts/ethereum/contracts/common/ReentrancyGuard.sol

/// @audit contract ReentrancyGuard is not upgradeable
25: abstract contract ReentrancyGuard { 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L25)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

/// @audit contract Governance is not upgradeable
20: contract Governance is IGovernance, Ownable2Step { 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L20)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit contract StateTransitionManager is not upgradeable
25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step { 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L25)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit contract ValidatorTimelock is not upgradeable
22: contract ValidatorTimelock is IExecutor, Ownable2Step { 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L22)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

/// @audit contract DiamondInit is not upgradeable
17: contract DiamondInit is ZkSyncStateTransitionBase, IDiamondInit { 
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L17)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

/// @audit contract DiamondProxy is not upgradeable
10: contract DiamondProxy { 
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L10)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

/// @audit contract AdminFacet is not upgradeable
18: contract AdminFacet is ZkSyncStateTransitionBase, IAdmin { 
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L18)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit contract ExecutorFacet is not upgradeable
22: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor { 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L22)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

/// @audit contract GettersFacet is not upgradeable
20: contract GettersFacet is ZkSyncStateTransitionBase, IGetters, ILegacyGetters { 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L20)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

/// @audit contract MailboxFacet is not upgradeable
30: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox { 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L30)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol

/// @audit contract ZkSyncStateTransitionBase is not upgradeable
11: contract ZkSyncStateTransitionBase is ReentrancyGuard { 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L11)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

/// @audit contract BaseZkSyncUpgrade is not upgradeable
44: abstract contract BaseZkSyncUpgrade is ZkSyncStateTransitionBase { 
```
[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L44)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

/// @audit contract BaseZkSyncUpgradeGenesis is not upgradeable
17: abstract contract BaseZkSyncUpgradeGenesis is BaseZkSyncUpgrade { 
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L17)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

/// @audit contract DefaultUpgrade is not upgradeable
10: contract DefaultUpgrade is BaseZkSyncUpgrade { 
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L10)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

/// @audit contract GenesisUpgrade is not upgradeable
11: contract GenesisUpgrade is BaseZkSyncUpgradeGenesis { 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L11)

```solidity
📁 File: contracts/zksync/contracts/ForceDeployUpgrader.sol

/// @audit contract ForceDeployUpgrader is not upgradeable
10: contract ForceDeployUpgrader { 
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L10)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

/// @audit contract L2SharedBridge is not upgradeable
23: contract L2SharedBridge is IL2SharedBridge, Initializable { 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L23)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

/// @audit contract AccountCodeStorage is not upgradeable
22: contract AccountCodeStorage is IAccountCodeStorage { 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L22)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

/// @audit contract BootloaderUtilities is not upgradeable
16: contract BootloaderUtilities is IBootloaderUtilities { 
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L16)

```solidity
📁 File: system-contracts/contracts/ComplexUpgrader.sol

/// @audit contract ComplexUpgrader is not upgradeable
14: contract ComplexUpgrader is IComplexUpgrader { 
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L14)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

/// @audit contract Compressor is not upgradeable
22: contract Compressor is ICompressor, ISystemContract { 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L22)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

/// @audit contract ContractDeployer is not upgradeable
23: contract ContractDeployer is IContractDeployer, ISystemContract { 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L23)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

/// @audit contract DefaultAccount is not upgradeable
19: contract DefaultAccount is IAccount { 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L19)

```solidity
📁 File: system-contracts/contracts/EmptyContract.sol

/// @audit contract EmptyContract is not upgradeable
10: contract EmptyContract { 
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L10)

```solidity
📁 File: system-contracts/contracts/GasBoundCaller.sol

/// @audit contract GasBoundCaller is not upgradeable
15: contract GasBoundCaller { 
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L15)

```solidity
📁 File: system-contracts/contracts/ImmutableSimulator.sol

/// @audit contract ImmutableSimulator is not upgradeable
18: contract ImmutableSimulator is IImmutableSimulator { 
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L18)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

/// @audit contract KnownCodesStorage is not upgradeable
18: contract KnownCodesStorage is IKnownCodesStorage, ISystemContract { 
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L18)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

/// @audit contract L1Messenger is not upgradeable
25: contract L1Messenger is IL1Messenger, ISystemContract { 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L25)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

/// @audit contract L2BaseToken is not upgradeable
18: contract L2BaseToken is IBaseToken, ISystemContract { 
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L18)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

/// @audit contract MsgValueSimulator is not upgradeable
19: contract MsgValueSimulator is ISystemContract { 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L19)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

/// @audit contract NonceHolder is not upgradeable
27: contract NonceHolder is INonceHolder, ISystemContract { 
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L27)

```solidity
📁 File: system-contracts/contracts/PubdataChunkPublisher.sol

/// @audit contract PubdataChunkPublisher is not upgradeable
16: contract PubdataChunkPublisher is IPubdataChunkPublisher, ISystemContract { 
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L16)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

/// @audit contract SystemContext is not upgradeable
17: contract SystemContext is ISystemContext, ISystemContextDeprecated, ISystemContract { 
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L17)

```solidity
📁 File: system-contracts/contracts/interfaces/ISystemContract.sol

/// @audit contract ISystemContract is not upgradeable
17: abstract contract ISystemContract { 
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L17)

</details>


---
### [NC&#x2011;15] Consider moving duplicated strings to constants
<details>
<summary><i>There are 31 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit 'Ether' is seen 2 times
256:             bytes memory name = bytes("Ether"); 
/// @audit 'ETH' is seen 2 times
257:             bytes memory symbol = bytes("ETH");
```
[256](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L256-L257)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit 'Bridgehub: not owner or admin' is seen 2 times
46:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin"); 

/// @audit 'n42' is seen 2 times
62:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights 
```
[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L46), [62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L62)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

/// @audit 'zksyncCreate2' is seen 2 times
12:     bytes32 private constant CREATE2_PREFIX = keccak256("zksyncCreate2"); 
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L12)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit 'Bridgehub: not owner or admin' is seen 2 times
70:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin"); 

/// @audit 'n42' is seen 2 times
121:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights 
```
[70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L70), [121](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L121)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

/// @audit 'Upgrade is not ready yet' is seen 2 times
72:         require(block.timestamp >= _proposedUpgrade.upgradeTimestamp, "Upgrade is not ready yet"); 

/// @audit 'New protocol version is not greater than the current one' is seen 2 times
240:             "New protocol version is not greater than the current one" 

/// @audit 'Too big protocol version difference' is seen 2 times
244:             "Too big protocol version difference" 

/// @audit 'Previous upgrade has not been finalized' is seen 2 times
249:         require(s.l2SystemContractsUpgradeTxHash == bytes32(0), "Previous upgrade has not been finalized"); 

/// @audit 'The batch number of the previous upgrade has not been cleaned' is seen 2 times
252:             "The batch number of the previous upgrade has not been cleaned" 
```
[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L72), [240](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L240), [244](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L244), [249](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L249), [252](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L252)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

/// @audit 'New protocol version is not greater than the current one' is seen 2 times
25:             "New protocol version is not greater than the current one" 

/// @audit 'Too big protocol version difference' is seen 2 times
29:             "Too big protocol version difference" 

/// @audit 'Previous upgrade has not been finalized' is seen 2 times
33:         require(s.l2SystemContractsUpgradeTxHash == bytes32(0), "Previous upgrade has not been finalized"); 

/// @audit 'The batch number of the previous upgrade has not been cleaned' is seen 2 times
36:             "The batch number of the previous upgrade has not been cleaned" 

/// @audit 'Upgrade is not ready yet' is seen 2 times
52:         require(block.timestamp >= _proposedUpgrade.upgradeTimestamp, "Upgrade is not ready yet"); 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L25), [29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L29), [33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L33), [36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L36), [52](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L52)

```solidity
📁 File: contracts/zksync/contracts/L2ContractHelper.sol

/// @audit 'zksyncCreate2' is seen 2 times
85:     bytes32 private constant CREATE2_PREFIX = keccak256("zksyncCreate2"); 
```
[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L85)

```solidity
📁 File: contracts/zksync/contracts/SystemContractsCaller.sol

/// @audit 'Overflow' is seen 4 times
28:         require(_x <= type(uint32).max, "Overflow"); 
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L28)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

/// @audit 'Callable only by the deployer system contract' is seen 2 times
26:         require(msg.sender == address(DEPLOYER_SYSTEM_CONTRACT), "Callable only by the deployer system contract"); 

/// @audit 'Code hash is not for a contract on constructor' is seen 2 times
37:         require(Utils.isContractConstructing(_hash), "Code hash is not for a contract on constructor"); 

/// @audit 'Code hash is not for a contract on constructor' is seen 2 times
57:         require(Utils.isContractConstructing(codeHash), "Code hash is not for a contract on constructor"); 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L26), [37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L37), [57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L57)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

/// @audit 'Invalid v value' is seen 3 times
92:             require(vInt == 27 || vInt == 28, "Invalid v value"); 

/// @audit 'Invalid v value' is seen 3 times
191:             require(vInt == 27 || vInt == 28, "Invalid v value"); 

/// @audit 'Invalid v value' is seen 3 times
286:             require(vInt == 27 || vInt == 28, "Invalid v value"); 
```
[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L92), [191](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L191), [286](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L286)

```solidity
📁 File: system-contracts/contracts/ImmutableSimulator.sol

/// @audit 'Callable only by the deployer system contract' is seen 2 times
35:         require(msg.sender == address(DEPLOYER_SYSTEM_CONTRACT), "Callable only by the deployer system contract"); 
```
[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L35)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

/// @audit 'Ether' is seen 2 times
129:         return "Ether"; 

/// @audit 'ETH' is seen 2 times
135:         return "ETH"; 
```
[129](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L129), [135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L135)

```solidity
📁 File: system-contracts/contracts/libraries/Utils.sol

/// @audit 'Overflow' is seen 4 times
21:         require(_x <= type(uint128).max, "Overflow"); 

/// @audit 'Overflow' is seen 4 times
27:         require(_x <= type(uint32).max, "Overflow"); 

/// @audit 'Overflow' is seen 4 times
33:         require(_x <= type(uint24).max, "Overflow"); 
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L21), [27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L27), [33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L33)

</details>


---
### [NC&#x2011;16] Consider providing a ranged getter for array state variables
While the compiler automatically provides a getter for accessing single elements within a public state variable array, it doesn't provide a way to fetch the whole array, or subsets thereof. Consider adding a function to allow the fetching of slices of the array, especially if the contract doesn't already have multicall functionality.

<details>
<summary><i>There are 9 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/governance/IGovernance.sol

36:         Call[] calls; 
```
[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L36)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol

127:         uint256[] recursiveAggregationInput; 
128:         uint256[] serializedProof;
```
[127](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L127-L128)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol

126:         bytes4[] selectors; 
```
[126](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L126)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

40:         bytes4[] selectors; 

53:         address[] facets; 

66:         bytes4[] selectors; 

74:         FacetCut[] facetCuts; 
```
[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L40), [53](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L53), [66](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L66), [74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L74)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

70:     bytes32[MINIBLOCK_HASHES_TO_STORE] internal l2BlockHash; 
```
[70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L70)

</details>


---
### [NC&#x2011;17] Consider using `delete` rather than assigning zero to clear values
The `delete` keyword more closely matches the semantics of what is being done, and draws more attention to the changing of state, which may lead to a more thorough audit of its associated logic.

<details>
<summary><i>There are 3 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

276:                 baseTokenMsgValue = 0; 
```
[276](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L276)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

330:         numberOfLogsToProcess = 0; 
```
[330](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L330)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

487:         txNumberInBlock = 0; 
```
[487](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L487)

</details>


---
### [NC&#x2011;18] Consider using named function arguments
When calling functions in external contracts with multiple arguments, consider using [named](https://docs.soliditylang.org/en/latest/control-structures.html#function-calls-with-named-parameters) function parameters, rather than positional ones.

<details>
<summary><i>There are 14 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

189:         sharedBridge.claimFailedDepositLegacyErc20Bridge( 
190:             _depositSender,
191:             _l1Token,
192:             amount,
193:             _l2TxHash,
194:             _l2BatchNumber,
195:             _l2MessageIndex,
196:             _l2TxNumberInBatch,
197:             _merkleProof
198:         );

218:         (address l1Receiver, address l1Token, uint256 amount) = sharedBridge.finalizeWithdrawalLegacyErc20Bridge( 
219:             _l2BatchNumber,
220:             _l2MessageIndex,
221:             _l2TxNumberInBatch,
222:             _message,
223:             _merkleProof
224:         );
```
[189](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L189-L198), [218](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L218-L224)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

316:             bool proofValid = bridgehub.proveL1ToL2TransactionStatus( 
317:                 _chainId,
318:                 _l2TxHash,
319:                 _l2BatchNumber,
320:                 _l2MessageIndex,
321:                 _l2TxNumberInBatch,
322:                 _merkleProof,
323:                 TxStatus.Failure
324:             );

477:         bool success = bridgehub.proveL2MessageInclusion( 
478:             _chainId,
479:             _messageParams.l2BatchNumber,
480:             _messageParams.l2MessageIndex,
481:             l2ToL1Message,
482:             _merkleProof
483:         );
```
[316](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L316-L324), [477](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L477-L483)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

137:         IStateTransitionManager(_stateTransitionManager).createNewChain( 
138:             _chainId,
139:             _baseToken,
140:             address(sharedBridge),
141:             _admin,
142:             _initData
143:         );

160:         return IZkSyncStateTransition(stateTransition).proveL2MessageInclusion(_batchNumber, _index, _message, _proof); 

172:         return IZkSyncStateTransition(stateTransition).proveL2LogInclusion(_batchNumber, _index, _log, _proof); 

187:             IZkSyncStateTransition(stateTransition).proveL1ToL2TransactionStatus( 
188:                 _l2TxHash,
189:                 _l2BatchNumber,
190:                 _l2MessageIndex,
191:                 _l2TxNumberInBatch,
192:                 _merkleProof,
193:                 _status
194:             );

206:             IZkSyncStateTransition(stateTransition).l2TransactionBaseCost( 
207:                 _gasPrice,
208:                 _l2GasLimit,
209:                 _l2GasPerPubdataByteLimit
210:             );

318:         IL1SharedBridge(_request.secondBridgeAddress).bridgehubConfirmL2Transaction( 
319:             _request.chainId,
320:             outputRequest.txDataHash,
321:             canonicalTxHash
322:         );
```
[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L137-L143), [160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L160), [172](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L172), [187](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L187-L194), [206](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L206-L210), [318](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L318-L322)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

444:         bool successVerifyProof = s.verifier.verify( 
445:             proofPublicInput,
446:             _proof.serializedProof,
447:             _proof.recursiveAggregationInput
448:         );
```
[444](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L444-L448)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

186:         IL1SharedBridge(s.baseTokenBridge).finalizeWithdrawal( 
187:             ERA_CHAIN_ID,
188:             _l2BatchNumber,
189:             _l2MessageIndex,
190:             _l2TxNumberInBatch,
191:             _message,
192:             _merkleProof
193:         );
```
[186](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L186-L193)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

333:                 BASE_TOKEN_SYSTEM_CONTRACT.transferFromTo(address(this), _newAddress, value); 
```
[333](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L333)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

307:         bytes32 stateDiffHash = COMPRESSOR_CONTRACT.verifyCompressedStateDiffs( 
308:             numberOfStateDiffs,
309:             enumerationIndexSize,
310:             stateDiffs,
311:             compressedStateDiffs
312:         );
```
[307](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L307-L312)

</details>


---
### [NC&#x2011;19] Consider using named mappings
Consider moving to solidity version 0.8.18 or later, and using [named mappings](https://ethereum.stackexchange.com/a/145555) to make it easier to understand the purpose of each mapping

<details>
<summary><i>There are 9 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

45:     mapping(address => uint256) private __DEPRECATED_lastWithdrawalLimitReset; 

48:     mapping(address => uint256) private __DEPRECATED_withdrawnAmountInWindow; 

51:     mapping(address => mapping(address => uint256)) private __DEPRECATED_totalDepositedAmountPerUser; 
```
[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L45), [48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L48), [51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L51)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

30:     mapping(uint256 => address) public stateTransition; 

48:     mapping(uint256 => bytes32) public upgradeCutHash; 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L30), [48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L48)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

47:     mapping(uint256 => LibMap.Uint32Map) internal committedBatchTimestamp; 
```
[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L47)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol

120:     mapping(address => uint256) __DEPRECATED_totalDepositedAmountPerUser; 
```
[120](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L120)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

26:     mapping(address => AccountInfo) internal accountInfo; 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L26)

</details>


---
### [NC&#x2011;20] Constants in comparisons should appear on the left side
Putting constants on the left side of comparison statements is a best practice known as [Yoda conditions](https://en.wikipedia.org/wiki/Yoda_conditions). Although solidity's static typing system prevents accidental assignments within conditionals, adopting this practice can improve code readability and consistency, especially when working across multiple languages.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit move 0 to the left
141:         require(_amount != 0, "0T"); // empty deposit 

/// @audit move 0 to the left
186:         require(amount != 0, "2T"); // empty deposit 
```
[141](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L141), [186](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L186)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit move msg.sender to the left
138:         require(bridgehub.getStateTransition(_chainId) == msg.sender, "receiveEth not state transition"); 

/// @audit move 0 to the left
158:             require(msg.value == 0, "ShB m.v > 0 b d.it"); 

/// @audit move 0 to the left
200:             require(_depositAmount == 0, "ShB wrong withdraw amount"); 

/// @audit move 0 to the left
202:             require(msg.value == 0, "ShB m.v > 0 for BH d.it 2"); 

/// @audit move 0 to the left
208:         require(amount != 0, "6T"); // empty deposit amount 

/// @audit move 0x00 to the left
237:         require(depositHappened[_chainId][_txHash] == 0x00, "ShB tx hap"); 

/// @audit move 76 to the left
517:             require(_l2ToL1message.length == 76, "ShB wrong msg len 2"); 

/// @audit move tx.origin to the left
579:                 refundRecipient = _prevMsgSender != tx.origin 
580:                     ? AddressAliasHelper.applyL1ToL2Alias(_prevMsgSender)
581:                     : _prevMsgSender;
```
[138](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L138), [158](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L158), [200](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L200), [202](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L202), [208](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L208), [237](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L237), [517](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L517), [579](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L579-L581)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit move 0 to the left
122:         require(_chainId != 0, "Bridgehub: chainId cannot be 0"); 

/// @audit move 0 to the left
225:                 require(msg.value == 0, "Bridgehub: non-eth bridge with msg.value"); 

/// @audit move tx.origin to the left
328:             _recipient = msg.sender == tx.origin ? msg.sender : AddressAliasHelper.applyL1ToL2Alias(msg.sender); 
```
[122](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L122), [225](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L225), [328](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L328)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

/// @audit move 0 to the left
23:         require(_bytecode.length % 32 == 0, "pq"); 

/// @audit move 1 to the left
27:         require(bytecodeLenInWords % 2 == 1, "ps"); // bytecode length in words must be odd 

/// @audit move 1 to the left
41:         require(version == 1 && _bytecodeHash[1] == bytes1(0), "zf"); // Incorrectly formatted bytecodeHash 

/// @audit move 1 to the left
43:         require(bytecodeLen(_bytecodeHash) % 2 == 1, "uy"); // Code length in words must be odd 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L23), [27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L27), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L41), [43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L43)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

/// @audit move 0 to the left
107:         if (timestamp == 0) { 
```
[107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L107)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

/// @audit move block.chainid to the left
14:         require(_chainId == block.chainid, "pr"); 

/// @audit move 0 to the left
25:         require(msg.data.length >= 4 || msg.data.length == 0, "Ut"); 
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L14), [25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L25)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

/// @audit move 0 to the left
90:         require(s.totalBatchesCommitted == 0, "AdminFacet: set validium only after genesis"); // Validium mode can be set only before the first batch is committed 
```
[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L90)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit move 0x00 to the left
50:             require(logOutput.pubdataHash == 0x00, "v0h"); 
/// @audit move 1 to the left
51:             require(_newBatch.pubdataCommitments.length == 1);

/// @audit move 511 to the left
192:             require(processedLogs == 511, "b7"); 

/// @audit move 1023 to the left
194:             require(processedLogs == 1023, "b8"); 

/// @audit move 1 to the left
231:         require(_newBatchesData.length == 1, "e4"); 

/// @audit move 0 to the left
237:         if (systemContractsUpgradeTxHash == bytes32(0) || s.l2SystemContractsUpgradeBatchNumber != 0) { 

/// @audit move 0 to the left
284:         require(s.l2SystemContractsUpgradeBatchNumber == 0, "ik"); 

/// @audit move 0 to the left
291:             bytes32 expectedUpgradeTxHash = i == 0 ? _systemContractUpgradeTxHash : bytes32(0); 

/// @audit move 0 to the left
361:         if (batchWhenUpgradeHappened != 0 && batchWhenUpgradeHappened <= newTotalBatchesExecuted) { 

/// @audit move 1 to the left
442:         require(proofPublicInput.length == 1, "t4"); 

/// @audit move 0 to the left
633:         require(_pubdataCommitments.length % PUBDATA_COMMITMENT_SIZE == 0, "bs"); 
```
[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L50-L51), [192](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L192), [194](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L194), [231](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L231), [237](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L237), [284](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L284), [291](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L291), [361](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L361), [442](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L442), [633](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L633)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

/// @audit move 0 to the left
169:         if (selectorsArrayLen != 0) { 
```
[169](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L169)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

/// @audit move tx.origin to the left
234:         if (l2Sender != tx.origin) { 
```
[234](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L234)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

/// @audit move 0 to the left
194:         if (selectorsLength == 0) { 

/// @audit move 0 to the left
213:         if (selectorPosition != 0) { 

/// @audit move 0 to the left
250:         if (lastSelectorPosition == 0) { 
```
[194](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L194), [213](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L213), [250](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L250)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

/// @audit move 0 to the left
186:         if (_l2ProtocolUpgradeTx.txType == 0) { 

/// @audit move 0 to the left
250:         require( 
251:             s.l2SystemContractsUpgradeBatchNumber == 0,
252:             "The batch number of the previous upgrade has not been cleaned"
253:         );
```
[186](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L186), [250](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L250-L253)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

/// @audit move 0 to the left
34:         require( 
35:             s.l2SystemContractsUpgradeBatchNumber == 0,
36:             "The batch number of the previous upgrade has not been cleaned"
37:         );
```
[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L34-L37)

</details>


---
### [NC&#x2011;21] `constant`s should be defined rather than using magic numbers
Even [assembly](https://github.com/code-423n4/2022-05-opensea-seaport/blob/9d7ce4d08bf3c3010304a0476a785c70c0e90ae7/contracts/lib/TokenTransferrer.sol#L35-L39) can benefit from using readable constants instead of hex/numeric literals

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

237:         require(depositHappened[_chainId][_txHash] == 0x00, "ShB tx hap"); 

258:             bytes memory decimals = abi.encode(uint8(18)); 

501:         require(_l2ToL1message.length >= 56, "ShB wrong msg len"); // wrong messsage length 

517:             require(_l2ToL1message.length == 76, "ShB wrong msg len 2"); 
```
[237](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L237), [258](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L258), [501](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L501), [517](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L517)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

23:         require(_bytecode.length % 32 == 0, "pq"); 

25:         uint256 bytecodeLenInWords = _bytecode.length / 32; 
26:         require(bytecodeLenInWords < 2 ** 16, "pp"); // bytecode length must be less than 2^16 words

28:         hashedBytecode = sha256(_bytecode) & 0x00000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF; 

30:         hashedBytecode = (hashedBytecode | bytes32(uint256(1 << 248))); 

32:         hashedBytecode = hashedBytecode | bytes32(bytecodeLenInWords << 224); 

50:         codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3])); 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L23), [25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L25-L26), [28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L28), [30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L30), [32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L32), [50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L50)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

106:         assert(L2_TO_L1_LOG_SERIALIZE_SIZE != 2 * 32); 

186:             gasLimit: 5, 
```
[106](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L106), [186](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L186)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

51:         assert(L2_TO_L1_LOG_SERIALIZE_SIZE != 2 * 32); 
```
[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L51)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

25:         require(msg.data.length >= 4 || msg.data.length == 0, "Ut"); 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L25)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

50:             require(logOutput.pubdataHash == 0x00, "v0h"); 

63:                     keccak256(_newBatch.pubdataCommitments[1:_newBatch.pubdataCommitments.length - 32]), 

68:                 _newBatch.pubdataCommitments[_newBatch.pubdataCommitments.length - 32:_newBatch 

109:         uint256 batchTimestamp = _packedBatchAndL2BlockTimestamp >> 128; 

192:             require(processedLogs == 511, "b7"); 

194:             require(processedLogs == 1023, "b8"); 
```
[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L50), [63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L63), [68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L68), [109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L109), [192](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L192), [194](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L194)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

286:                 if (data.length <= 4) { 

297:             require(data.length == 32, "lp"); 
```
[286](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L286), [297](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L297)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/LibMap.sol

23:             uint256 mapValue = _map.map[_index / 8]; 

27:             uint256 bitOffset = (_index & 7) * 32; 

43:             uint256 mapIndex = _index / 8; 

48:             uint256 bitOffset = (_index & 7) * 32; 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L23), [27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L27), [43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L43), [48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L48)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Merkle.sol

25:         require(pathLength < 256, "bt"); 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L25)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol

57:         require(_transaction.reserved[3] == 0, "uo"); 

83:             costForComputation += Math.ceilDiv(_encodingLength * L1_TX_DELTA_544_ENCODING_BYTES, 544); 
```
[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L57), [83](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L83)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

102:         if (codeHash == 0x00 && NONCE_HOLDER_SYSTEM_CONTRACT.getRawNonce(account) > 0) { 

133:             codeHash != 0x00 && 
```
[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L102), [133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L133)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

72:             } else if (_transaction.data[0] >= 0x80) { 

81:             uint256 rInt = uint256(bytes32(_transaction.signature[0:32])); 

86:             uint256 sInt = uint256(bytes32(_transaction.signature[32:64])); 

91:             uint256 vInt = uint256(uint8(_transaction.signature[64])); 
```
[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L72), [81](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L81), [86](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L86), [91](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L91)

</details>


---
### [NC&#x2011;22] `constant`s/`immutable`s redefined elsewhere
Consider defining each of these in only one contract so that values cannot become out of sync when only one location is updated (i.e. having `ContA.X`,`ContB.Y` is fine since they're different constant names in different files, but `ContA.X`, `ContB.X` is not since it's the same constant defined in multiple files with the same value). Even things like `decimals` and `VERSION` can employ file-level constants such as `PREFERRED_DECIMALS = 18` and `INITIAL_VERSION = "1.0.0"`

<details>
<summary><i>There are 36 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

23:     IL1SharedBridge public immutable override sharedBridge; 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L23)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

34:     address public immutable override l1WethAddress; 

37:     IBridgehub public immutable override bridgehub; 

40:     IL1ERC20Bridge public immutable override legacyBridge; 
```
[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L34), [37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L37), [40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L40)

```solidity
📁 File: contracts/ethereum/contracts/common/ReentrancyGuard.sol

29:     uint256 private constant LOCK_FLAG_ADDRESS = 0x8e94fed44239eb2314ab7a406345e6c5a8f0ccedf3b600de3d004e672c33abf4; 

38:     uint256 private constant _NOT_ENTERED = 1; 
39:     uint256 private constant _ENTERED = 2;
```
[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L29), [38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L38-L39)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

12:     bytes32 private constant CREATE2_PREFIX = keccak256("zksyncCreate2"); 
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L12)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

22:     uint256 internal constant EXECUTED_PROPOSAL_TIMESTAMP = uint256(1); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L22)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

27:     address public immutable bridgehub; 
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L27)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

26:     string public constant override getName = "ValidatorTimelock"; 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L26)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

20:     string public constant override getName = "AdminFacet"; 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L20)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

27:     string public constant override getName = "ExecutorFacet"; 
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L27)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

25:     string public constant override getName = "GettersFacet"; 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L25)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

35:     string public constant override getName = "MailboxFacet"; 
```
[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L35)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

17:     bytes32 internal constant DIAMOND_INIT_SUCCESS_RETURN_VALUE = 
18:         0x33774e659306e47509050e97cb651e731180a42d458212294d30751925c551a2; // keccak256("diamond.zksync.init") - 1

21:     bytes32 private constant DIAMOND_STORAGE_POSITION = 
22:         0xc8fcad8db84d3cc18b4c41d551ea0ee66dd599cde068d998e57d5e09332c131b; // keccak256("diamond.standard.diamond.storage") - 1;
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L17-L18), [21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L21-L22)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L22)

```solidity
📁 File: contracts/zksync/contracts/L2ContractHelper.sol

85:     bytes32 private constant CREATE2_PREFIX = keccak256("zksyncCreate2"); 
```
[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L85)

```solidity
📁 File: contracts/zksync/contracts/vendor/AddressAliasHelper.sol

22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L22)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

23:     bytes32 constant EMPTY_STRING_KECCAK = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470; 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L23)

```solidity
📁 File: system-contracts/contracts/GasBoundCaller.sol

18:     uint256 constant CALL_ENTRY_OVERHEAD = 800; 

21:     uint256 constant CALL_RETURN_OVERHEAD = 200; 
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L18), [21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L21)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

44:     uint256 internal constant KECCAK_ROUND_GAS_COST = 40; 

47:     uint256 internal constant KECCAK_ROUND_NUMBER_OF_BYTES = 136; 

55:     uint256 internal constant SHA256_ROUND_GAS_COST = 7; 

58:     uint256 internal constant SHA256_ROUND_NUMBER_OF_BYTES = 64; 
```
[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L44), [47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L47), [55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L55), [58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L58)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

36:     uint256 constant GAS_TO_PASS = 2300; 

41:     uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000; 
```
[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L36), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L41)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

28:     uint256 private constant DEPLOY_NONCE_MULTIPLIER = 2 ** 128; 

31:     uint256 private constant MAXIMAL_MIN_NONCE_INCREMENT = 2 ** 32; 
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L28), [31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L31)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

23:     uint256 internal constant MINIBLOCK_HASHES_TO_STORE = 257; 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L23)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

82:     bytes32 constant EIP712_DOMAIN_TYPEHASH = keccak256("EIP712Domain(string name,string version,uint256 chainId)"); 

84:     bytes32 constant EIP712_TRANSACTION_TYPE_HASH = 
85:         keccak256(
86:             "Transaction(uint256 txType,uint256 from,uint256 to,uint256 gasLimit,uint256 gasPerPubdataByteLimit,uint256 maxFeePerGas,uint256 maxPriorityFeePerGas,uint256 paymaster,uint256 nonce,uint256 value,bytes data,bytes32[] factoryDeps,bytes paymasterInput)"
87:         );
```
[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L82), [84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L84-L87)

```solidity
📁 File: system-contracts/contracts/libraries/Utils.sol

13:     bytes32 constant IS_CONSTRUCTOR_BYTECODE_HASH_BIT_MASK = 
14:         0x00ff000000000000000000000000000000000000000000000000000000000000;

17:     bytes32 constant SET_IS_CONSTRUCTOR_MARKER_BIT_MASK = 
18:         0x0001000000000000000000000000000000000000000000000000000000000000;
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L13-L14), [17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L17-L18)

</details>


---
### [NC&#x2011;23] `constructor` should emit an event
Use events to signal significant changes to off-chain monitoring tools.

<details>
<summary><i>There are 7 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

55:     constructor(IL1SharedBridge _sharedBridge) reentrancyGuardInitializer { 
```
[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L55)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

90:     constructor( 
91:         address _l1WethAddress,
92:         IBridgehub _bridgehub,
93:         IL1ERC20Bridge _legacyBridge
94:     ) reentrancyGuardInitializer {
```
[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L90-L94)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

58:     constructor(address _bridgehub) reentrancyGuardInitializer { 
```
[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L58)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

55:     constructor(address _initialOwner, uint32 _executionDelay) { 
```
[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L55)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

11:     constructor(uint256 _chainId, Diamond.DiamondCutData memory _diamondCut) { 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L11)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

41:     constructor() { 
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L41)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

40:     constructor() { 
```
[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L40)

</details>


---
### [NC&#x2011;24] Contract implements interface without extending the interface
Not extending the interface may lead to the wrong function signature being used, leading to unexpected behavior. If the interface is in fact being implemented, use the `override` keyword to indicate that fact.

<details>
<summary><i>There are 8 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit IL1ERC20Bridge.isWithdrawalFinalized()
/// @audit IL1ERC20Bridge.sharedBridge()
/// @audit IL1ERC20Bridge.l2TokenBeacon()
/// @audit IL1ERC20Bridge.l2Bridge()
/// @audit IL1ERC20Bridge.depositAmount()
19: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard { 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L19)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit IL1SharedBridge.isWithdrawalFinalized()
/// @audit IL1SharedBridge.l1WethAddress()
/// @audit IL1SharedBridge.bridgehub()
/// @audit IL1SharedBridge.legacyBridge()
/// @audit IL1SharedBridge.l2BridgeAddress()
/// @audit IL1SharedBridge.depositHappened()
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step { 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit IBridgehub.stateTransitionManagerIsRegistered()
/// @audit IBridgehub.stateTransitionManager()
/// @audit IBridgehub.tokenIsRegistered()
/// @audit IBridgehub.baseToken()
/// @audit IBridgehub.sharedBridge()
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step { 
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit IStateTransitionManager.bridgehub()
/// @audit IStateTransitionManager.stateTransition()
/// @audit IStateTransitionManager.storedBatchZero()
/// @audit IStateTransitionManager.initialCutHash()
/// @audit IStateTransitionManager.genesisUpgrade()
/// @audit IStateTransitionManager.upgradeCutHash()
/// @audit IStateTransitionManager.protocolVersion()
25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step { 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L25)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

/// @audit IL2SharedBridge.l1TokenAddress()
/// @audit IL2SharedBridge.l1Bridge()
23: contract L2SharedBridge is IL2SharedBridge, Initializable { 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L23)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

/// @audit IL2StandardToken.l1Address()
/// @audit IL2StandardToken.l2Bridge()
15: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade { 
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L15)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

/// @audit IBaseToken.totalSupply()
18: contract L2BaseToken is IBaseToken, ISystemContract { 
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L18)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

/// @audit ISystemContext.chainId()
/// @audit ISystemContext.origin()
/// @audit ISystemContext.gasPrice()
/// @audit ISystemContext.blockGasLimit()
/// @audit ISystemContext.coinbase()
/// @audit ISystemContext.difficulty()
/// @audit ISystemContext.baseFee()
/// @audit ISystemContext.txNumberInBlock()
/// @audit ISystemContext.gasPerPubdataByte()
17: contract SystemContext is ISystemContext, ISystemContextDeprecated, ISystemContract { 
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L17)

</details>


---
### [NC&#x2011;25] Contract timekeeping will break earlier than the Ethereum network itself will stop working
When a timestamp is downcast from `uint256` to `uint32`, the value will wrap in the year 2106, and the contracts will break. Other downcasts will have different endpoints. Consider whether your contract is intended to live past the size of the type being used.

<details>
<summary><i>There are 3 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

115:             uint32 timestamp = uint32(block.timestamp); 

134:             uint32 timestamp = uint32(block.timestamp); 
```
[115](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L115), [134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L134)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

283:         _params.expirationTimestamp = uint64(block.timestamp + PRIORITY_EXPIRATION); // Safe to cast 
```
[283](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L283)

</details>


---
### [NC&#x2011;26] Contract uses both `require()`/`revert()` as well as custom errors
Consider using just one method in a single file


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

22: contract ValidatorTimelock is IExecutor, Ownable2Step { 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L22)


---
### [NC&#x2011;27] `contract`/`library` definition inside interface folder

<i>There is one instance of this issue:</i>

```solidity
📁 File: system-contracts/contracts/interfaces/ISystemContract.sol

17: abstract contract ISystemContract { 
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L17)


---
### [NC&#x2011;28] `contract`/`library`/`interface` definitions should be defined in separate files
This helps to make tracking changes across commits easier, among other reasons. They can be combined into a single file later by importing multiple contracts, and using that file as the common import.

<details>
<summary><i>There are 6 instances of this issue:</i></summary>

```solidity
📁 File: contracts/zksync/contracts/L2ContractHelper.sol

/// @audit IL2Messenger, IContractDeployer, IBaseToken, L2ContractHelper
18: interface IL2Messenger { 

/// @audit IL2Messenger, IContractDeployer, IBaseToken, L2ContractHelper
30: interface IContractDeployer { 

/// @audit IL2Messenger, IContractDeployer, IBaseToken, L2ContractHelper
61: interface IBaseToken { 

/// @audit IL2Messenger, IContractDeployer, IBaseToken, L2ContractHelper
83: library L2ContractHelper { 
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L18), [30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L30), [61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L61), [83](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L83)

```solidity
📁 File: contracts/zksync/contracts/SystemContractsCaller.sol

/// @audit Utils, SystemContractsCaller
26: library Utils { 

/// @audit Utils, SystemContractsCaller
36: library SystemContractsCaller { 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L26), [36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L36)

</details>


---
### [NC&#x2011;29] Contracts containing only utility functions should be made into libraries
<details>
<summary><i>There are 2 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

20: contract GettersFacet is ZkSyncStateTransitionBase, IGetters, ILegacyGetters { 
21:     using UncheckedMath for uint256;
22:     using PriorityQueue for PriorityQueue.Queue;
23: 
24:     /// @inheritdoc IZkSyncStateTransitionBase
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L20-L24)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

16: contract BootloaderUtilities is IBootloaderUtilities { 
17:     using TransactionHelper for *;
18: 
19:     /// @notice Calculates the canonical transaction hash and the recommended transaction hash.
20:     /// @param _transaction The transaction.
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L16-L20)

</details>


---
### [NC&#x2011;30] Contracts should have all `public`/`external` functions exposed by `interface`s
The `contract`s should expose an `interface` so that other projects can more easily integrate with it, without having to develop their own non-standard variants.

<details>
<summary><i>There are 29 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit tranferTokenToSharedBridge, l2TokenAddress, deposit, deposit, claimFailedDeposit, finalizeWithdrawal
19: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard { 
20:     using SafeERC20 for IERC20;
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L19-L20)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit transferFundsFromLegacy, receiveEth, initializeChainGovernance, bridgehubDeposit, bridgehubConfirmL2Transaction, claimFailedDeposit, finalizeWithdrawal, depositLegacyErc20Bridge, finalizeWithdrawalLegacyErc20Bridge, claimFailedDepositLegacyErc20Bridge
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step { 
31:     using SafeERC20 for IERC20;
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30-L31)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit setPendingAdmin, acceptAdmin, getStateTransition, addStateTransitionManager, removeStateTransitionManager, addToken, setSharedBridge, createNewChain, proveL2MessageInclusion, proveL2LogInclusion, proveL1ToL2TransactionStatus, l2TransactionBaseCost, requestL2TransactionDirect, requestL2TransactionTwoBridges
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step { 
17:     /// @notice all the ether is held by the weth bridge
18:     IL1SharedBridge public sharedBridge;
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16-L18)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

/// @audit isOperation, isOperationPending, isOperationReady, isOperationDone, getOperationState, scheduleTransparent, scheduleShadow, cancel, execute, executeInstant, hashOperation, updateDelay, updateSecurityCouncil
20: contract Governance is IGovernance, Ownable2Step { 
21:     /// @notice A constant representing the timestamp for completed operations.
22:     uint256 internal constant EXECUTED_PROPOSAL_TIMESTAMP = uint256(1);
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L20-L22)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit getChainAdmin, setPendingAdmin, acceptAdmin, setValidatorTimelock, setInitialCutHash, setNewVersionUpgrade, setUpgradeDiamondCut, freezeChain, unfreezeChain, revertBatches, registerAlreadyDeployedStateTransition, createNewChain
25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step { 
26:     /// @notice Address of the bridgehub
27:     address public immutable bridgehub;
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L25-L27)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit setStateTransitionManager, addValidator, removeValidator, setExecutionDelay, getCommittedBatchTimestamp, commitBatches, commitBatchesSharedBridge, revertBatches, revertBatchesSharedBridge, proveBatches, proveBatchesSharedBridge, executeBatches, executeBatchesSharedBridge
22: contract ValidatorTimelock is IExecutor, Ownable2Step { 
23:     using LibMap for LibMap.Uint32Map;
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L22-L23)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

/// @audit setPendingAdmin, acceptAdmin, setValidator, setPorterAvailability, setPriorityTxMaxGasLimit, changeFeeParams, setTokenMultiplier, setValidiumMode, upgradeChainFromVersion, executeUpgrade, freezeDiamond, unfreezeDiamond
18: contract AdminFacet is ZkSyncStateTransitionBase, IAdmin { 
19:     /// @inheritdoc IZkSyncStateTransitionBase
20:     string public constant override getName = "AdminFacet";
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L18-L20)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit commitBatches, commitBatchesSharedBridge, executeBatchesSharedBridge, executeBatches, proveBatches, proveBatchesSharedBridge, revertBatches, revertBatchesSharedBridge
22: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor { 
23:     using UncheckedMath for uint256;
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L22-L23)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

/// @audit getVerifier, getAdmin, getPendingAdmin, getBridgehub, getStateTransitionManager, getBaseToken, getBaseTokenBridge, baseTokenGasPriceMultiplierNominator, baseTokenGasPriceMultiplierDenominator, getTotalBatchesCommitted, getTotalBatchesVerified, getTotalBatchesExecuted, getTotalPriorityTxs, getFirstUnprocessedPriorityTx, getPriorityQueueSize, priorityQueueFrontOperation, isValidator, l2LogsRootHash, storedBatchHash, getL2BootloaderBytecodeHash, getL2DefaultAccountBytecodeHash, getVerifierParams, getProtocolVersion, getL2SystemContractsUpgradeTxHash, getL2SystemContractsUpgradeBatchNumber, isDiamondStorageFrozen, isFacetFreezable, getPriorityTxMaxGasLimit, isFunctionFreezable, isEthWithdrawalFinalized, getPubdataPricingMode, facets, facetFunctionSelectors, facetAddresses, facetAddress, getTotalBlocksCommitted, getTotalBlocksVerified, getTotalBlocksExecuted, storedBlockHash, getL2SystemContractsUpgradeBlockNumber
20: contract GettersFacet is ZkSyncStateTransitionBase, IGetters, ILegacyGetters { 
21:     using UncheckedMath for uint256;
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L20-L21)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

/// @audit transferEthToSharedBridge, bridgehubRequestL2Transaction, proveL2MessageInclusion, proveL2LogInclusion, proveL1ToL2TransactionStatus, l2TransactionBaseCost, finalizeEthWithdrawal, requestL2Transaction
30: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox { 
31:     using UncheckedMath for uint256;
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L30-L31)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

/// @audit upgrade
10: contract DefaultUpgrade is BaseZkSyncUpgrade { 
11:     /// @notice The main function that will be called by the upgrade proxy.
12:     /// @param _proposedUpgrade The upgrade to be executed.
13:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L10-L13)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

/// @audit upgrade
11: contract GenesisUpgrade is BaseZkSyncUpgradeGenesis { 
12:     /// @notice The main function that will be called by the upgrade proxy.
13:     /// @param _proposedUpgrade The upgrade to be executed.
14:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L11-L14)

```solidity
📁 File: contracts/zksync/contracts/ForceDeployUpgrader.sol

/// @audit forceDeploy
10: contract ForceDeployUpgrader { 
11:     /// @notice A function that performs force deploy
12:     /// @param _forceDeployments The force deployments to perform.
13:     function forceDeploy(IContractDeployer.ForceDeployment[] calldata _forceDeployments) external payable {
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L10-L13)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

/// @audit finalizeDeposit, withdraw, l2TokenAddress
23: contract L2SharedBridge is IL2SharedBridge, Initializable { 
24:     /// @dev The address of the L1 bridge counterpart.
25:     address public override l1Bridge;
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L23-L25)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

/// @audit bridgeInitialize, reinitializeToken, bridgeMint, bridgeBurn, name, symbol, decimals, decodeString, decodeUint8
15: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade { 
16:     /// @dev Describes whether there is a specific getter in the token.
17:     /// @notice Used to explicitly separate which getters the token has and which it does not.
18:     /// @notice Different tokens in L1 can implement or not implement getter function as `name`/`symbol`/`decimals`,
19:     /// @notice Our goal is to store all the getters that L1 token implements, and for others, we keep it as an unimplemented method.
20:     struct ERC20Getters {
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L15-L20)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

/// @audit storeAccountConstructingCodeHash, storeAccountConstructedCodeHash, markAccountCodeHashAsConstructed, getRawCodeHash, getCodeHash, getCodeSize
22: contract AccountCodeStorage is IAccountCodeStorage { 
23:     bytes32 constant EMPTY_STRING_KECCAK = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470;
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L22-L23)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

/// @audit getTransactionHashes
16: contract BootloaderUtilities is IBootloaderUtilities { 
17:     using TransactionHelper for *;
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L16-L17)

```solidity
📁 File: system-contracts/contracts/ComplexUpgrader.sol

/// @audit upgrade
14: contract ComplexUpgrader is IComplexUpgrader { 
15:     /// @notice Executes an upgrade process by delegating calls to another contract.
16:     /// @dev This function allows only the `FORCE_DEPLOYER` to initiate the upgrade.
17:     /// If the delegate call fails, the function will revert the transaction, returning the error message
18:     /// provided by the delegated contract.
19:     /// @param _delegateTo the address of the contract to which the calls will be delegated
20:     /// @param _calldata the calldata to be delegate called in the `_delegateTo` contract
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable {
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L14-L21)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

/// @audit publishCompressedBytecode, verifyCompressedStateDiffs
22: contract Compressor is ICompressor, ISystemContract { 
23:     using UnsafeBytesCalldata for bytes;
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L22-L23)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

/// @audit getAccountInfo, extendedAccountVersion, updateAccountVersion, updateNonceOrdering, getNewAddressCreate2, getNewAddressCreate, create2, create, create2Account, createAccount, forceDeployOnAddress, forceDeployOnAddresses
23: contract ContractDeployer is IContractDeployer, ISystemContract { 
24:     /// @notice Information about an account contract.
25:     /// @dev For EOA and simple contracts (i.e. not accounts) this value is 0.
26:     mapping(address => AccountInfo) internal accountInfo;
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L23-L26)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

/// @audit validateTransaction, executeTransaction, executeTransactionFromOutside, payForTransaction, prepareForPaymaster
19: contract DefaultAccount is IAccount { 
20:     using TransactionHelper for *;
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L19-L20)

```solidity
📁 File: system-contracts/contracts/GasBoundCaller.sol

/// @audit gasBoundCall
15: contract GasBoundCaller { 
16:     /// @notice We assume that no more than `CALL_ENTRY_OVERHEAD` ergs are used for the O(1) operations at the start
17:     /// of execution of the contract, such as abi decoding the parameters, jumping to the correct function, etc.
18:     uint256 constant CALL_ENTRY_OVERHEAD = 800;
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L15-L18)

```solidity
📁 File: system-contracts/contracts/ImmutableSimulator.sol

/// @audit getImmutable, setImmutables
18: contract ImmutableSimulator is IImmutableSimulator { 
19:     /// @dev mapping (contract address) => (index of immutable variable) => value
20:     /// @notice that address uses `uint256` type to leave the option to introduce 32-byte address space in future.
21:     mapping(uint256 contractAddress => mapping(uint256 index => bytes32 value)) internal immutableDataStorage;
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L18-L21)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

/// @audit markFactoryDeps, markBytecodeAsPublished, getMarker
18: contract KnownCodesStorage is IKnownCodesStorage, ISystemContract { 
19:     modifier onlyCompressor() {
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L18-L19)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

/// @audit sendL2ToL1Log, sendToL1, requestBytecodeL1Publication, publishPubdataAndClearState
25: contract L1Messenger is IL1Messenger, ISystemContract { 
26:     /// @notice Sequential hash of logs sent in the current block.
27:     /// @dev Will be reset at the end of the block to zero value.
28:     bytes32 internal chainedLogsHash;
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L25-L28)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

/// @audit transferFromTo, balanceOf, mint, withdraw, withdrawWithMessage, name, symbol, decimals
18: contract L2BaseToken is IBaseToken, ISystemContract { 
19:     /// @notice The balances of the users.
20:     mapping(address account => uint256 balance) internal balance;
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L18-L20)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

/// @audit getMinNonce, getRawNonce, increaseMinNonce, setValueUnderNonce, getValueUnderNonce, incrementMinNonceIfEquals, getDeploymentNonce, incrementDeploymentNonce, isNonceUsed, validateNonceUsage
27: contract NonceHolder is INonceHolder, ISystemContract { 
28:     uint256 private constant DEPLOY_NONCE_MULTIPLIER = 2 ** 128;
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L27-L28)

```solidity
📁 File: system-contracts/contracts/PubdataChunkPublisher.sol

/// @audit chunkAndPublishPubdata
16: contract PubdataChunkPublisher is IPubdataChunkPublisher, ISystemContract { 
17:     /// @notice Chunks pubdata into pieces that can fit into blobs.
18:     /// @param _pubdata The total l2 to l1 pubdata that will be sent via L1 blobs.
19:     /// @dev Note: This is an early implementation, in the future we plan to support up to 16 blobs per l1 batch.
20:     /// @dev We always publish 2 system logs even if our pubdata fits into a single blob. This makes processing logs on L1 easier.
21:     function chunkAndPublishPubdata(bytes calldata _pubdata) external onlyCallFrom(address(L1_MESSENGER_CONTRACT)) {
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L16-L21)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

/// @audit setChainId, setTxOrigin, setGasPrice, setPubdataInfo, getCurrentPubdataSpent, getCurrentPubdataCost, getBlockHashEVM, getBatchHash, getBatchNumberAndTimestamp, getL2BlockNumberAndTimestamp, getBlockNumber, getBlockTimestamp, setL2Block, appendTransactionToCurrentL2Block, publishTimestampDataToL1, setNewBatch, unsafeOverrideBatch, incrementTxNumberInBatch, resetTxNumberInBatch, currentBlockInfo, getBlockNumberAndTimestamp, blockHash
17: contract SystemContext is ISystemContext, ISystemContextDeprecated, ISystemContract { 
18:     /// @notice The number of latest L2 blocks to store.
19:     /// @dev EVM requires us to be able to query the hashes of previous 256 blocks.
20:     /// We could either:
21:     /// - Store the latest 256 hashes (and strictly rely that we do not accidentally override the hash of the block 256 blocks ago)
22:     /// - Store the latest 257 blocks' hashes.
23:     uint256 internal constant MINIBLOCK_HASHES_TO_STORE = 257;
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L17-L23)

</details>


---
### [NC&#x2011;31] Contracts should have full test coverage
A 100% test coverage is not foolproof, but it helps immensely in reducing the amount of bugs that may occur.


---
### [NC&#x2011;32] Control structures do not follow the Solidity Style Guide
See the [control structures](https://docs.soliditylang.org/en/latest/style-guide.html#control-structures) section of the Solidity Style Guide


<i>There is one instance of this issue:</i>

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

/// @audit 'else' should be placed on the same line as the 'if'’s closing brace with one space between } and 'else'
106:         // so set `keccak256("")` as a code hash. The EVM has the same behavior. 
107:         else if (Utils.isContractConstructing(codeHash)) {
108:             codeHash = EMPTY_STRING_KECCAK;
109:         }
```
[106](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L106-L109)


---
### [NC&#x2011;33] Custom errors should be used rather than `revert()`/`require()`
Custom errors are available from solidity version 0.8.4. Custom errors are more easily processed in try-catch blocks, and are easier to re-use and maintain.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

64:         require(msg.sender == address(sharedBridge), "Not shared bridge"); 

66:         require(amount == _amount, "Incorrect amount"); 

141:         require(_amount != 0, "0T"); // empty deposit 

143:         require(amount == _amount, "3T"); // The token has non-standard transfer logic 

186:         require(amount != 0, "2T"); // empty deposit 

215:         require(!isWithdrawalFinalized[_l2BatchNumber][_l2MessageIndex], "pw"); 
```
[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L64), [66](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L66), [141](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L141), [143](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L143), [186](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L186), [215](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L215)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

69:         require(msg.sender == address(bridgehub), "ShB not BH"); 

75:         require( 
76:             msg.sender == address(bridgehub) || (_chainId == ERA_CHAIN_ID && msg.sender == ERA_DIAMOND_PROXY),
77:             "L1SharedBridge: not bridgehub or era chain"
78:         );

84:         require(msg.sender == address(legacyBridge), "ShB not legacy bridge"); 

108:         require(_owner != address(0), "ShB owner 0"); 

121:             require(balanceAfter > balanceBefore, "ShB: 0 eth transferred"); 

129:             require(amount > 0, "ShB: 0 amount to transfer"); 

132:             require(balanceAfter - balanceBefore == amount, "ShB: wrong amount transferred"); 

138:         require(bridgehub.getStateTransition(_chainId) == msg.sender, "receiveEth not state transition"); 

155:             require(msg.value == _amount, "L1SharedBridge: msg.value not equal to amount"); 

158:             require(msg.value == 0, "ShB m.v > 0 b d.it"); 

161:             require(amount == _amount, "3T"); // The token has non-standard transfer logic 

188:         require(l2BridgeAddress[_chainId] != address(0), "ShB l2 bridge not deployed"); 

194:         require(_l1Token != l1WethAddress, "ShB: WETH deposit not supported"); 
195:         require(bridgehub.baseToken(_chainId) != _l1Token, "ShB: baseToken deposit not supported");

200:             require(_depositAmount == 0, "ShB wrong withdraw amount"); 

202:             require(msg.value == 0, "ShB m.v > 0 for BH d.it 2"); 

206:             require(withdrawAmount == _depositAmount, "5T"); // The token has non-standard transfer logic 

208:         require(amount != 0, "6T"); // empty deposit amount 

237:         require(depositHappened[_chainId][_txHash] == 0x00, "ShB tx hap"); 

325:             require(proofValid, "yn"); 

327:         require(_amount > 0, "y1"); 

342:                 require(dataHash == txDataHash, "ShB: d.it not hap"); 

349:             require(chainBalance[_chainId][_l1Token] >= _amount, "ShB n funds"); 

360:             require(callSuccess, "ShB: claimFailedDeposit failed"); 

396:             require(!legacyBridge.isWithdrawalFinalized(_l2BatchNumber, _l2MessageIndex), "ShB: legacy withdrawal"); 

417:         require(!isWithdrawalFinalized[_chainId][_l2BatchNumber][_l2MessageIndex], "Withdrawal is already finalized"); 

427:             require(!alreadyFinalized, "Withdrawal is already finalized 2"); 

439:             require(chainBalance[_chainId][l1Token] >= amount, "ShB not enough funds 2"); // not enought funds 

449:             require(callSuccess, "ShB: withdraw failed"); 

484:         require(success, "ShB withd w proof"); // withdrawal wrong proof 

501:         require(_l2ToL1message.length >= 56, "ShB wrong msg len"); // wrong messsage length 

522:             revert("ShB Incorrect message function selector"); 

563:         require(l2BridgeAddress[ERA_CHAIN_ID] != address(0), "ShB b. n dep"); 
564:         require(_l1Token != l1WethAddress, "ShB: WETH deposit not supported 2");
```
[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L69), [75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L75-L78), [84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L84), [108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L108), [121](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L121), [129](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L129), [132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L132), [138](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L138), [155](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L155), [158](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L158), [161](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L161), [188](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L188), [194](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L194-L195), [200](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L200), [202](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L202), [206](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L206), [208](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L208), [237](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L237), [325](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L325), [327](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L327), [342](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L342), [349](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L349), [360](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L360), [396](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L396), [417](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L417), [427](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L427), [439](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L439), [449](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L449), [484](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L484), [501](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L501), [522](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L522), [563](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L563-L564)

</details>


---
### [NC&#x2011;34] Do not cache constants
<details>
<summary><i>There are 21 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

88:         bytes32 position = DIAMOND_STORAGE_POSITION; 
```
[88](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L88)

```solidity
📁 File: contracts/zksync/contracts/SystemContractsCaller.sol

65:             address msgValueSimulator = MSG_VALUE_SYSTEM_CONTRACT; 
```
[65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L65)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

221:         uint256 nodesOnCurrentLevel = L2_TO_L1_LOGS_MERKLE_TREE_LEAVES; 
```
[221](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L221)

```solidity
📁 File: system-contracts/contracts/libraries/EfficientCall.sol

142:             address msgValueSimulator = MSG_VALUE_SYSTEM_CONTRACT; 
```
[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L142)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractHelper.sol

49:         address callAddr = TO_L1_CALL_ADDRESS; 

64:         address callAddr = CODE_ADDRESS_CALL_ADDRESS; 

75:         address callAddr = LOAD_CALLDATA_INTO_ACTIVE_PTR_CALL_ADDRESS; 

86:         address callAddr = PTR_PACK_INTO_ACTIVE_CALL_ADDRESS; 

95:         address callAddr = PTR_ADD_INTO_ACTIVE_CALL_ADDRESS; 

107:         address callAddr = PTR_SHRINK_INTO_ACTIVE_CALL_ADDRESS; 

153:         address callAddr = PRECOMPILE_CALL_ADDRESS; 

170:         address callAddr = SET_CONTEXT_VALUE_CALL_ADDRESS; 

182:         address callAddr = EVENT_INITIALIZE_ADDRESS; 

192:         address callAddr = EVENT_WRITE_ADDRESS; 

204:         address callAddr = META_CALL_ADDRESS; 

297:         address callAddr = CALLFLAGS_CALL_ADDRESS; 

308:         address callAddr = PTR_CALLDATA_CALL_ADDRESS; 

321:         address callAddr = GET_EXTRA_ABI_DATA_ADDRESS; 
```
[49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L49), [64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L64), [75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L75), [86](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L86), [95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L95), [107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L107), [153](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L153), [170](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L170), [182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L182), [192](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L192), [204](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L204), [297](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L297), [308](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L308), [321](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L321)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractsCaller.sol

104:             address msgValueSimulator = MSG_VALUE_SYSTEM_CONTRACT; 

107:             uint256 forwardMask = MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT; 
```
[104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L104), [107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L107)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

396:         address bootloaderAddr = BOOTLOADER_FORMAL_ADDRESS; 
```
[396](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L396)

</details>


---
### [NC&#x2011;35] Do not use underscore at the end of variable name
The style guide says to add a trailing underscore to a variable name in order to prevent the shadowing of [another variable](https://docs.soliditylang.org/en/latest/style-guide.html#avoiding-naming-collisions) or function name, the examples below do not shadow variables.


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

/// @audit decimals_
31:     uint8 private decimals_; 
```
[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L31)


---
### [NC&#x2011;36] Do not use UNDERSCORE in `struct` elements names

<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol

/// @audit __DEPRECATED_diamondCutStorage, __DEPRECATED_governor, __DEPRECATED_pendingGovernor, __DEPRECATED_allowList, __DEPRECATED_upgrades, __DEPRECATED_lastWithdrawalLimitReset, __DEPRECATED_withdrawnAmountInWindow, __DEPRECATED_totalDepositedAmountPerUser
66: struct ZkSyncStateTransitionStorage { 
67:     /// @dev Storage of variables needed for deprecated diamond cut facet
68:     uint256[7] __DEPRECATED_diamondCutStorage;
69:     /// @notice Address which will exercise critical changes to the Diamond Proxy (upgrades, freezing & unfreezing). Replaced by STM
70:     address __DEPRECATED_governor;
71:     /// @notice Address that the governor proposed as one that will replace it
72:     address __DEPRECATED_pendingGovernor;
73:     /// @notice List of permitted validators
74:     mapping(address validatorAddress => bool isValidator) validators;
75:     /// @dev Verifier contract. Used to verify aggregated proof for batches
76:     IVerifier verifier;
77:     /// @notice Total number of executed batches i.e. batches[totalBatchesExecuted] points at the latest executed batch
78:     /// (batch 0 is genesis)
79:     uint256 totalBatchesExecuted;
80:     /// @notice Total number of proved batches i.e. batches[totalBatchesProved] points at the latest proved batch
81:     uint256 totalBatchesVerified;
82:     /// @notice Total number of committed batches i.e. batches[totalBatchesCommitted] points at the latest committed
83:     /// batch
84:     uint256 totalBatchesCommitted;
85:     /// @dev Stored hashed StoredBatch for batch number
86:     mapping(uint256 batchNumber => bytes32 batchHash) storedBatchHashes;
87:     /// @dev Stored root hashes of L2 -> L1 logs
88:     mapping(uint256 batchNumber => bytes32 l2LogsRootHash) l2LogsRootHashes;
89:     /// @dev Container that stores transactions requested from L1
90:     PriorityQueue.Queue priorityQueue;
91:     /// @dev The smart contract that manages the list with permission to call contract functions
92:     address __DEPRECATED_allowList;
93:     /// @notice Part of the configuration parameters of ZKP circuits. Used as an input for the verifier smart contract
94:     VerifierParams verifierParams;
95:     /// @notice Bytecode hash of bootloader program.
96:     /// @dev Used as an input to zkp-circuit.
97:     bytes32 l2BootloaderBytecodeHash;
98:     /// @notice Bytecode hash of default account (bytecode for EOA).
99:     /// @dev Used as an input to zkp-circuit.
100:     bytes32 l2DefaultAccountBytecodeHash;
101:     /// @dev Indicates that the porter may be touched on L2 transactions.
102:     /// @dev Used as an input to zkp-circuit.
103:     bool zkPorterIsAvailable;
104:     /// @dev The maximum number of the L2 gas that a user can request for L1 -> L2 transactions
105:     /// @dev This is the maximum number of L2 gas that is available for the "body" of the transaction, i.e.
106:     /// without overhead for proving the batch.
107:     uint256 priorityTxMaxGasLimit;
108:     /// @dev Storage of variables needed for upgrade facet
109:     UpgradeStorage __DEPRECATED_upgrades;
110:     /// @dev A mapping L2 batch number => message number => flag.
111:     /// @dev The L2 -> L1 log is sent for every withdrawal, so this mapping is serving as
112:     /// a flag to indicate that the message was already processed.
113:     /// @dev Used to indicate that eth withdrawal was already processed
114:     mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized)) isEthWithdrawalFinalized;
115:     /// @dev The most recent withdrawal time and amount reset
116:     uint256 __DEPRECATED_lastWithdrawalLimitReset;
117:     /// @dev The accumulated withdrawn amount during the withdrawal limit window
118:     uint256 __DEPRECATED_withdrawnAmountInWindow;
119:     /// @dev A mapping user address => the total deposited amount by the user
120:     mapping(address => uint256) __DEPRECATED_totalDepositedAmountPerUser;
121:     /// @dev Stores the protocol version. Note, that the protocol version may not only encompass changes to the
122:     /// smart contracts, but also to the node behavior.
123:     uint256 protocolVersion;
124:     /// @dev Hash of the system contract upgrade transaction. If 0, then no upgrade transaction needs to be done.
125:     bytes32 l2SystemContractsUpgradeTxHash;
126:     /// @dev Batch number where the upgrade transaction has happened. If 0, then no upgrade transaction has happened
127:     /// yet.
128:     uint256 l2SystemContractsUpgradeBatchNumber;
129:     /// @dev Address which will exercise non-critical changes to the Diamond Proxy (changing validator set & unfreezing)
130:     address admin;
131:     /// @notice Address that the admin proposed as one that will replace admin role
132:     address pendingAdmin;
133:     /// @dev Fee params used to derive gasPrice for the L1->L2 transactions. For L2 transactions,
134:     /// the bootloader gives enough freedom to the operator.
135:     FeeParams feeParams;
136:     /// @dev Address of the blob versioned hash getter smart contract used for EIP-4844 versioned hashes.
137:     address blobVersionedHashRetriever;
138:     /// new fields
139:     /// @dev The chainId of the chain
140:     uint256 chainId;
141:     /// @dev The address of the bridgehub
142:     address bridgehub;
143:     /// @dev The address of the StateTransitionManager
144:     address stateTransitionManager;
145:     /// @dev The address of the baseToken contract. Eth is address(1)
146:     address baseToken;
147:     /// @dev The address of the baseTokenbridge. Eth also uses the shared bridge
148:     address baseTokenBridge;
149:     /// @notice gasPriceMultiplier for each baseToken, so that each L1->L2 transaction pays for its transaction on the destination
150:     /// we multiply by the nominator, and divide by the denominator
151:     uint128 baseTokenGasPriceMultiplierNominator;
152:     uint128 baseTokenGasPriceMultiplierDenominator;
153: }
```
[66](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L66-L153)


---
### [NC&#x2011;37] `else`-block not required
One level of nesting can be removed by not having an `else` block when the `if`-block returns, and `if (foo) { return 1; } else { return 2; }` becomes `if (foo) { return 1; } return 2;`


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

111:         } else if (timestamp > block.timestamp) { 
112:             return OperationState.Waiting;
113:         } else {
114:             return OperationState.Ready;
115:         }
```
[111](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L111-L115)


---
### [NC&#x2011;38] Empty bytes check is missing
Passing empty bytes to a function can cause unexpected behavior, such as certain operations failing, producing incorrect results, or wasting gas. It is recommended to check that all byte parameters are not empty.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit _l2TxHash
176:     function claimFailedDeposit( 
177:         address _depositSender,
178:         address _l1Token,
179:         bytes32 _l2TxHash,
180:         uint256 _l2BatchNumber,
181:         uint256 _l2MessageIndex,
182:         uint16 _l2TxNumberInBatch,
183:         bytes32[] calldata _merkleProof
184:     ) external nonReentrant {

/// @audit _message
208:     function finalizeWithdrawal( 
209:         uint256 _l2BatchNumber,
210:         uint256 _l2MessageIndex,
211:         uint16 _l2TxNumberInBatch,
212:         bytes calldata _message,
213:         bytes32[] calldata _merkleProof
214:     ) external nonReentrant {
```
[176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L176-L184), [208](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L208-L214)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit _data
182:     function bridgehubDeposit( 
183:         uint256 _chainId,
184:         address _prevMsgSender,
185:         uint256, // l2Value, needed for Weth deposits in the future
186:         bytes calldata _data
187:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) {

/// @audit _txDataHash
/// @audit _txHash
232:     function bridgehubConfirmL2Transaction( 
233:         uint256 _chainId,
234:         bytes32 _txDataHash,
235:         bytes32 _txHash
236:     ) external override onlyBridgehub {

/// @audit _l2TxHash
277:     function claimFailedDeposit( 
278:         uint256 _chainId,
279:         address _depositSender,
280:         address _l1Token,
281:         uint256 _amount,
282:         bytes32 _l2TxHash,
283:         uint256 _l2BatchNumber,
284:         uint256 _l2MessageIndex,
285:         uint16 _l2TxNumberInBatch,
286:         bytes32[] calldata _merkleProof
287:     ) external override {

/// @audit _l2TxHash
303:     function _claimFailedDeposit( 
304:         bool _checkedInLegacyBridge,
305:         uint256 _chainId,
306:         address _depositSender,
307:         address _l1Token,
308:         uint256 _amount,
309:         bytes32 _l2TxHash,
310:         uint256 _l2BatchNumber,
311:         uint256 _l2MessageIndex,
312:         uint16 _l2TxNumberInBatch,
313:         bytes32[] calldata _merkleProof
314:     ) internal nonReentrant {

/// @audit _message
385:     function finalizeWithdrawal( 
386:         uint256 _chainId,
387:         uint256 _l2BatchNumber,
388:         uint256 _l2MessageIndex,
389:         uint16 _l2TxNumberInBatch,
390:         bytes calldata _message,
391:         bytes32[] calldata _merkleProof
392:     ) external override {

/// @audit _message
409:     function _finalizeWithdrawal( 
410:         uint256 _chainId,
411:         uint256 _l2BatchNumber,
412:         uint256 _l2MessageIndex,
413:         uint16 _l2TxNumberInBatch,
414:         bytes calldata _message,
415:         bytes32[] calldata _merkleProof
416:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount) {

/// @audit _message
615:     function finalizeWithdrawalLegacyErc20Bridge( 
616:         uint256 _l2BatchNumber,
617:         uint256 _l2MessageIndex,
618:         uint16 _l2TxNumberInBatch,
619:         bytes calldata _message,
620:         bytes32[] calldata _merkleProof
621:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount) {

/// @audit _l2TxHash
644:     function claimFailedDepositLegacyErc20Bridge( 
645:         address _depositSender,
646:         address _l1Token,
647:         uint256 _amount,
648:         bytes32 _l2TxHash,
649:         uint256 _l2BatchNumber,
650:         uint256 _l2MessageIndex,
651:         uint16 _l2TxNumberInBatch,
652:         bytes32[] calldata _merkleProof
653:     ) external override onlyLegacyBridge {
```
[182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L182-L187), [232](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L232-L236), [277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L277-L287), [303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L303-L314), [385](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L385-L392), [409](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L409-L416), [615](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L615-L621), [644](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L644-L653)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit _initData
114:     function createNewChain( 
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, //_salt
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {
```
[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L121)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

/// @audit _id
142:     function scheduleShadow(bytes32 _id, uint256 _delay) external onlyOwner { 

/// @audit _id
154:     function cancel(bytes32 _id) external onlyOwner { 

/// @audit _id
215:     function _schedule(bytes32 _id, uint256 _delay) internal { 
```
[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L142), [154](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L154), [215](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L215)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit _diamondCut
239:     function createNewChain( 
240:         uint256 _chainId,
241:         address _baseToken,
242:         address _sharedBridge,
243:         address _admin,
244:         bytes calldata _diamondCut
245:     ) external onlyBridgehub {
```
[239](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L239-L245)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit _systemContractUpgradeTxHash
273:     function _commitBatchesWithSystemContractsUpgrade( 
274:         StoredBatchInfo memory _lastCommittedBatchData,
275:         CommitBatchInfo[] calldata _newBatchesData,
276:         bytes32 _systemContractUpgradeTxHash
277:     ) internal {
```
[273](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L273-L277)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

/// @audit _message
178:     function finalizeEthWithdrawal( 
179:         uint256 _l2BatchNumber,
180:         uint256 _l2MessageIndex,
181:         uint16 _l2TxNumberInBatch,
182:         bytes calldata _message,
183:         bytes32[] calldata _merkleProof
184:     ) external nonReentrant {

/// @audit _calldata
197:     function requestL2Transaction( 
198:         address _contractL2,
199:         uint256 _l2Value,
200:         bytes calldata _calldata,
201:         uint256 _l2GasLimit,
202:         uint256 _l2GasPerPubdataByteLimit,
203:         bytes[] calldata _factoryDeps,
204:         address _refundRecipient
205:     ) external payable returns (bytes32 canonicalTxHash) {

/// @audit _calldata
258:     function _requestL2Transaction( 
259:         uint256 _mintValue,
260:         WritePriorityOpParams memory _params,
261:         bytes memory _calldata,
262:         bytes[] memory _factoryDeps
263:     ) internal returns (bytes32 canonicalTxHash) {

/// @audit _calldata
316:     function _writePriorityOp( 
317:         WritePriorityOpParams memory _priorityOpParams,
318:         bytes memory _calldata,
319:         bytes[] memory _factoryDeps
320:     ) internal returns (bytes32 canonicalTxHash) {
```
[178](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L178-L184), [197](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L197-L205), [258](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L258-L263), [316](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L316-L320)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

/// @audit _selector
205:     function _addOneFunction(address _facet, bytes4 _selector, bool _isSelectorFreezable) private { 

/// @audit _selector
228:     function _removeOneFunction(address _facet, bytes4 _selector) private { 

/// @audit _calldata
278:     function _initializeDiamondCut(address _init, bytes memory _calldata) private { 
```
[205](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L205), [228](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L228), [278](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L278)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

/// @audit _l2DefaultAccountBytecodeHash
92:     function _setL2DefaultAccountBytecodeHash(bytes32 _l2DefaultAccountBytecodeHash) private { 

/// @audit _l2BootloaderBytecodeHash
109:     function _setL2BootloaderBytecodeHash(bytes32 _l2BootloaderBytecodeHash) private { 

/// @audit _bootloaderHash
/// @audit _defaultAccountHash
171:     function _setBaseSystemContracts(bytes32 _bootloaderHash, bytes32 _defaultAccountHash) internal { 

/// @audit _customCallDataForUpgrade
263:     function _upgradeL1Contract(bytes calldata _customCallDataForUpgrade) internal virtual {} 

/// @audit _customCallDataForUpgrade
269:     function _postUpgrade(bytes calldata _customCallDataForUpgrade) internal virtual {} 
```
[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L92), [109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L109), [171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L171), [263](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L263), [269](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L269)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

/// @audit _hash
35:     function storeAccountConstructingCodeHash(address _address, bytes32 _hash) external override onlyDeployer { 

/// @audit _hash
46:     function storeAccountConstructedCodeHash(address _address, bytes32 _hash) external override onlyDeployer { 

/// @audit _hash
68:     function _storeCodeHash(address _address, bytes32 _hash) internal { 
```
[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L35), [46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L46), [68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L68)

```solidity
📁 File: system-contracts/contracts/ComplexUpgrader.sol

/// @audit _calldata
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable { 
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L21)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

/// @audit _bytecode
/// @audit _rawCompressedData
44:     function publishCompressedBytecode( 
45:         bytes calldata _bytecode,
46:         bytes calldata _rawCompressedData
47:     ) external payable onlyCallFromBootloader returns (bytes32 bytecodeHash) {

/// @audit _stateDiffs
/// @audit _compressedStateDiffs
110:     function verifyCompressedStateDiffs( 
111:         uint256 _numberOfStateDiffs,
112:         uint256 _enumerationIndexSize,
113:         bytes calldata _stateDiffs,
114:         bytes calldata _compressedStateDiffs
115:     ) external payable onlyCallFrom(address(L1_MESSENGER_CONTRACT)) returns (bytes32 stateDiffHash) {
```
[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L44-L47), [110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L110-L115)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

/// @audit _salt
/// @audit _bytecodeHash
147:     function create( 
148:         bytes32 _salt,
149:         bytes32 _bytecodeHash,
150:         bytes calldata _input
151:     ) external payable override returns (address) {
```
[147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L147-L151)

</details>


---
### [NC&#x2011;39] Empty function body
Empty function body in solidity is not recommended, consider adding some comments to the body.

<details>
<summary><i>There are 8 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

60:     function initialize() external reentrancyGuardInitializer {} 
```
[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L60)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

38:     constructor() reentrancyGuardInitializer {} 
```
[38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L38)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

262:     receive() external payable {} 
```
[262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L262)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

19:     constructor() reentrancyGuardInitializer {} 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L19)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

125:     function executeTransactionFromOutside(Transaction calldata _transaction) external payable override { 
126:         // Behave the same as for fallback/receive, just execute nothing, returns nothing
127:     }

227:     receive() external payable { 
228:         // If the contract is called directly, behave like an EOA
229:     }
```
[125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L125-L127), [227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L227-L229)

```solidity
📁 File: system-contracts/contracts/EmptyContract.sol

11:     fallback() external payable {} 

13:     receive() external payable {} 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L11), [13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L13)

</details>


---
### [NC&#x2011;40] Enum values should be used instead of constant array indexes
Create a commented enum value to use instead of constant array indexes, this makes the code far easier to understand.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

/// @audit 0
40:         uint8 version = uint8(_bytecodeHash[0]); 
/// @audit 1
41:         require(version == 1 && _bytecodeHash[1] == bytes1(0), "zf"); // Incorrectly formatted bytecodeHash

/// @audit 3
/// @audit 2
50:         codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3])); 
```
[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L40-L41), [50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L50)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

/// @audit 0
41:         s.storedBatchHashes[0] = _initializeData.storedBatchZero; 
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L41)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit 0
39:         uint8 pubdataSource = uint8(bytes1(_newBatch.pubdataCommitments[0])); 

/// @audit 0
55:             blobHashes[0] = logOutput.blob1Hash; 
/// @audit 1
56:             blobHashes[1] = logOutput.blob2Hash;

/// @audit 0
66:             blobHashes[0] = logOutput.blob1Hash; 
/// @audit 0
67:             blobCommitments[0] = bytes32(

/// @audit 0
287:         s.l2SystemContractsUpgradeBatchNumber = _newBatchesData[0].batchNumber; 
```
[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L39), [55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L55-L56), [66](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L66-L67), [287](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L287)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

/// @audit 0
170:             bytes4 selector0 = ds.facetToSelectors[_facet].selectors[0]; 
```
[170](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L170)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

/// @audit 0
214:             bytes4 selector0 = ds.facetToSelectors[_facet].selectors[0]; 
```
[214](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L214)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol

/// @audit 0
54:         require(_transaction.reserved[0] == 0, "ue"); 
/// @audit 1
55:         require(_transaction.reserved[1] <= type(uint160).max, "uf");
/// @audit 2
56:         require(_transaction.reserved[2] == 0, "ug");
/// @audit 3
57:         require(_transaction.reserved[3] == 0, "uo");
```
[54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L54-L57)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

/// @audit 0
72:             } else if (_transaction.data[0] >= 0x80) { 

/// @audit 64
91:             uint256 vInt = uint256(uint8(_transaction.signature[64])); 

/// @audit 0
96:             if (_transaction.reserved[0] != 0) { 

/// @audit 0
168:             } else if (_transaction.data[0] >= 0x80) { 

/// @audit 64
190:             uint256 vInt = uint256(uint8(_transaction.signature[64])); 

/// @audit 0
263:             } else if (_transaction.data[0] >= 0x80) { 

/// @audit 64
285:             uint256 vInt = uint256(uint8(_transaction.signature[64])); 
```
[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L72), [91](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L91), [96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L96), [168](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L168), [190](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L190), [263](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L263), [285](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L285)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

/// @audit 0
75:         uint8 version = uint8(_bytecodeHash[0]); 
/// @audit 1
76:         require(version == 1 && _bytecodeHash[1] == bytes1(0), "Incorrectly formatted bytecodeHash");
```
[75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L75-L76)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

/// @audit 0
230:         bytes32 l2ToL1LogsTreeRoot = l2ToL1LogsTreeArray[0]; 
```
[230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L230)

```solidity
📁 File: system-contracts/contracts/PubdataChunkPublisher.sol

/// @audit 0
55:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_ONE_HASH_KEY)), blobHashes[0]); 
/// @audit 1
56:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_TWO_HASH_KEY)), blobHashes[1]);
```
[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L55-L56)

```solidity
📁 File: system-contracts/contracts/libraries/RLPEncoder.sol

/// @audit 0
29:                 encoded[0] = (_val == 0) ? bytes1(uint8(128)) : bytes1(uint8(_val)); 

/// @audit 0
34:                 encoded[0] = bytes1(uint8(hbs + 0x81)); 

/// @audit 0
64:                 encoded[0] = bytes1(uint8(_len + _offset)); 

/// @audit 0
69:                 encoded[0] = bytes1(uint8(_offset + hbs + 56)); 
```
[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L29), [34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L34), [64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L64), [69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L69)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

/// @audit 0
175:             } else if (_transaction.data[0] >= 0x80) { 

/// @audit 0
184:         if (_transaction.reserved[0] != 0) { 

/// @audit 0
253:             } else if (_transaction.data[0] >= 0x80) { 

/// @audit 0
325:             } else if (_transaction.data[0] >= 0x80) { 
```
[175](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L175), [184](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L184), [253](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L253), [325](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L325)

```solidity
📁 File: system-contracts/contracts/libraries/Utils.sol

/// @audit 3
46:             codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3])); 

/// @audit 1
52:         return _bytecodeHash[1] == 0x00; 

/// @audit 1
57:         return _bytecodeHash[1] == 0x01; 
```
[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L46), [52](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L52), [57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L57)

</details>


---
### [NC&#x2011;41] Error messages should be descriptive rather than cryptic
<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

141:         require(_amount != 0, "0T"); // empty deposit 

143:         require(amount == _amount, "3T"); // The token has non-standard transfer logic 

186:         require(amount != 0, "2T"); // empty deposit 

215:         require(!isWithdrawalFinalized[_l2BatchNumber][_l2MessageIndex], "pw"); 
```
[141](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L141), [143](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L143), [186](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L186), [215](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L215)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

69:         require(msg.sender == address(bridgehub), "ShB not BH"); 

108:         require(_owner != address(0), "ShB owner 0"); 

161:             require(amount == _amount, "3T"); // The token has non-standard transfer logic 

206:             require(withdrawAmount == _depositAmount, "5T"); // The token has non-standard transfer logic 

208:         require(amount != 0, "6T"); // empty deposit amount 

237:         require(depositHappened[_chainId][_txHash] == 0x00, "ShB tx hap"); 

325:             require(proofValid, "yn"); 

327:         require(_amount > 0, "y1"); 

349:             require(chainBalance[_chainId][_l1Token] >= _amount, "ShB n funds"); 

563:         require(l2BridgeAddress[ERA_CHAIN_ID] != address(0), "ShB b. n dep"); 
```
[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L69), [108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L108), [161](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L161), [206](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L206), [208](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L208), [237](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L237), [325](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L325), [327](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L327), [349](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L349), [563](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L563)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

62:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights 
```
[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L62)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

121:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights 
```
[121](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L121)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

195:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c"); // The delay is not passed 

217:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c"); // The delay is not passed 
```
[195](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L195), [217](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L217)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

25:         require(address(_initializeData.verifier) != address(0), "vt"); 
26:         require(_initializeData.admin != address(0), "vy");
27:         require(_initializeData.validatorTimelock != address(0), "hc");
28:         require(_initializeData.priorityTxMaxGasLimit <= MAX_GAS_PER_TRANSACTION, "vu");
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L25-L28)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

14:         require(_chainId == block.chainid, "pr"); 

25:         require(msg.data.length >= 4 || msg.data.length == 0, "Ut"); 

30:         require(facetAddress != address(0), "F"); // Proxy has no facet for this selector 
31:         require(!diamondStorage.isFrozen || !facet.isFreezable, "q1"); // Facet is frozen
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L14), [25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L25), [30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L30-L31)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

34:         require(msg.sender == pendingAdmin, "n4"); // Only proposed by current admin address can claim the admin rights 

59:         require(_newPriorityTxMaxGasLimit <= MAX_GAS_PER_TRANSACTION, "n5"); 

70:         require(_newFeeParams.maxPubdataPerBatch >= _newFeeParams.priorityTxMaxPubdata, "n6"); 

136:         require(!diamondStorage.isFrozen, "a9"); // diamond proxy is frozen already 

146:         require(diamondStorage.isFrozen, "a7"); // diamond proxy is not frozen 
```
[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L34), [59](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L59), [70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L70), [136](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L136), [146](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L146)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

37:         require(_newBatch.batchNumber == _previousBatch.batchNumber + 1, "f"); // only commit next batch 

40:         require(pubdataSource == uint8(PubdataSource.Calldata) || pubdataSource == uint8(PubdataSource.Blob), "us"); 

74:         require(_previousBatch.batchHash == logOutput.previousBatchHash, "l"); 

76:         require(logOutput.chainedPriorityTxsHash == _newBatch.priorityOperationsHash, "t"); 

78:         require(logOutput.numberOfLayer1Txs == _newBatch.numberOfLayer1Txs, "ta"); 

110:         require(batchTimestamp == _expectedBatchTimestamp, "tb"); 

114:         require(_previousBatchTimestamp < batchTimestamp, "h3"); 

122:         require(block.timestamp - COMMIT_TIMESTAMP_NOT_OLDER <= batchTimestamp, "h1"); // New batch timestamp is too small 
123:         require(lastL2BlockTimestamp <= block.timestamp + COMMIT_TIMESTAMP_APPROXIMATION_DELTA, "h2"); // The last L2 block timestamp is too big
```
[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L37), [40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L40), [74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L74), [76](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L76), [78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L78), [110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L110), [114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L114), [122](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L122-L123)

</details>


---
### [NC&#x2011;42] Event emit should emit a parameter
Some emitted events do not have any emitted parameters. It is recommended to add some parameter such as state changes or value changes when events are emitted


<i>There are 2 instaces of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

139:         emit Freeze(); 

149:         emit Unfreeze(); 
```
[139](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L139), [149](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L149)


---
### [NC&#x2011;43] Event is missing `indexed` fields
Index event fields make the field more quickly accessible to off-chain tools that parse events. However, note that each index field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

<details>
<summary><i>There are 27 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol

20:     event WithdrawalFinalized(address indexed to, address indexed l1Token, uint256 amount); 

22:     event ClaimedFailedDeposit(address indexed to, address indexed l1Token, uint256 amount); 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L20), [22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L22)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol

31:     event BridgehubDepositBaseTokenInitiated( 
32:         uint256 indexed chainId,
33:         address indexed from,
34:         address l1Token,
35:         uint256 amount
36:     );
```
[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L31-L36)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

133:     event NewChain(uint256 indexed chainId, address stateTransitionManager, address indexed chainGovernance); 
```
[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L133)

```solidity
📁 File: contracts/ethereum/contracts/governance/IGovernance.sol

68:     event TransparentOperationScheduled(bytes32 indexed _id, uint256 delay, Operation _operation); 

71:     event ShadowOperationScheduled(bytes32 indexed _id, uint256 delay); 
```
[68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L68), [71](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L71)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol

61:     event IsPorterAvailableStatusUpdate(bool isPorterAvailable); 

64:     event ValidatorStatusUpdate(address indexed validatorAddress, bool isActive); 

74:     event NewPriorityTxMaxGasLimit(uint256 oldPriorityTxMaxGasLimit, uint256 newPriorityTxMaxGasLimit); 

77:     event NewFeeParams(FeeParams oldFeeParams, FeeParams newFeeParams); 

80:     event ValidiumModeStatusUpdate(PubdataPricingMode validiumMode); 

83:     event NewBaseTokenMultiplier( 
84:         uint128 oldNominator,
85:         uint128 oldDenominator,
86:         uint128 newNominator,
87:         uint128 newDenominator
88:     );

91:     event ExecuteUpgrade(Diamond.DiamondCutData diamondCut); 
```
[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L61), [64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L64), [74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L74), [77](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L77), [80](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L80), [83](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L83-L88), [91](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L91)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol

211:     event BlocksRevert(uint256 totalBatchesCommitted, uint256 totalBatchesVerified, uint256 totalBatchesExecuted); 
```
[211](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L211)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol

123:     event NewPriorityRequest( 
124:         uint256 txId,
125:         bytes32 txHash,
126:         uint64 expirationTimestamp,
127:         L2CanonicalTransaction transaction,
128:         bytes[] factoryDeps
129:     );

134:     event EthWithdrawalFinalized(address indexed to, uint256 amount); 
```
[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L123-L129), [134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L134)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol

17:     event ProposeTransparentUpgrade( 
18:         Diamond.DiamondCutData diamondCut,
19:         uint256 indexed proposalId,
20:         bytes32 proposalSalt
21:     );
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L17-L21)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

24:     event DiamondCut(FacetCut[] facetCuts, address initAddress, bytes initCalldata); 
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L24)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

58:     event NewVerifierParams(VerifierParams oldVerifierParams, VerifierParams newVerifierParams); 

61:     event UpgradeComplete(uint256 indexed newProtocolVersion, bytes32 indexed l2UpgradeTxHash, ProposedUpgrade upgrade); 
```
[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L58), [61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L61)

```solidity
📁 File: contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol

22:     event BaseTokenReceived(uint256 amount); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L22)

```solidity
📁 File: contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol

6:     event BridgeInitialize(address indexed l1Token, string name, string symbol, uint8 decimals); 
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L6)

```solidity
📁 File: system-contracts/contracts/interfaces/IBaseToken.sol

24:     event Mint(address indexed account, uint256 amount); 

26:     event Transfer(address indexed from, address indexed to, uint256 value); 
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L24), [26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L26)

```solidity
📁 File: system-contracts/contracts/interfaces/IContractDeployer.sol

39:     event AccountNonceOrderingUpdated(address indexed accountAddress, AccountNonceOrdering nonceOrdering); 

41:     event AccountVersionUpdated(address indexed accountAddress, AccountAbstractionVersion aaVersion); 
```
[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L39), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L41)

```solidity
📁 File: system-contracts/contracts/interfaces/INonceHolder.sol

14:     event ValueSetUnderNonce(address indexed accountAddress, uint256 indexed key, uint256 value); 
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/INonceHolder.sol#L14)

</details>


---
### [NC&#x2011;44] Events are missing sender information
When an action is triggered based on a user's action, not being able to filter based on who triggered the action makes event processing a lot more cumbersome. Including the msg.sender the events of these types of action will make events much more useful to end users, especially when `msg.sender` is not `tx.origin`.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

225:         emit WithdrawalFinalized(l1Receiver, l1Token, amount); 
```
[225](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L225)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

168:         emit BridgehubDepositBaseTokenInitiated(_chainId, _prevMsgSender, _l1Token, _amount); 

454:         emit WithdrawalFinalizedSharedBridge(_chainId, l1Receiver, l1Token, amount); 
```
[168](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L168), [454](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L454)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

56:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin); 

68:         emit NewPendingAdmin(currentPendingAdmin, address(0)); 
69:         emit NewAdmin(previousAdmin, pendingAdmin);

145:         emit NewChain(_chainId, _stateTransitionManager, _admin); 
```
[56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L56), [68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L68-L69), [145](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L145)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

47:         emit ChangeSecurityCouncil(address(0), _securityCouncil); 

50:         emit ChangeMinDelay(0, _minDelay); 

132:         emit TransparentOperationScheduled(id, _delay, _operation); 

144:         emit ShadowOperationScheduled(_id, _delay); 

157:         emit OperationCancelled(_id); 

180:         emit OperationExecuted(id); 

199:         emit OperationExecuted(id); 

250:         emit ChangeMinDelay(minDelay, _newDelay); 

257:         emit ChangeSecurityCouncil(securityCouncil, _newSecurityCouncil); 
```
[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L47), [50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L50), [132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L132), [144](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L144), [157](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L157), [180](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L180), [199](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L199), [250](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L250), [257](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L257)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

115:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin); 

127:         emit NewPendingAdmin(currentPendingAdmin, address(0)); 
128:         emit NewAdmin(previousAdmin, pendingAdmin);

227:         emit SetChainIdUpgrade(_chainContract, l2ProtocolUpgradeTx, protocolVersion); 

235:         emit StateTransitionNewChain(_chainId, _stateTransitionContract); 

287:         emit StateTransitionNewChain(_chainId, stateTransitionAddress); 
```
[115](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L115), [127](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L127-L128), [227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L227), [235](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L235), [287](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L287)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

83:         emit ValidatorAdded(_chainId, _newValidator); 

92:         emit ValidatorRemoved(_chainId, _validator); 

98:         emit NewExecutionDelay(_executionDelay); 
```
[83](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L83), [92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L92), [98](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L98)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

28:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin); 

40:         emit NewPendingAdmin(pendingAdmin, address(0)); 
41:         emit NewAdmin(previousAdmin, pendingAdmin);

47:         emit ValidatorStatusUpdate(_validator, _active); 

54:         emit IsPorterAvailableStatusUpdate(_zkPorterIsAvailable); 

63:         emit NewPriorityTxMaxGasLimit(oldPriorityTxMaxGasLimit, _newPriorityTxMaxGasLimit); 

75:         emit NewFeeParams(oldFeeParams, _newFeeParams); 

86:         emit NewBaseTokenMultiplier(oldNominator, oldDenominator, _nominator, _denominator); 

92:         emit ValidiumModeStatusUpdate(_validiumMode); 

115:         emit ExecuteUpgrade(_diamondCut); 

125:         emit ExecuteUpgrade(_diamondCut); 

139:         emit Freeze(); 

149:         emit Unfreeze(); 
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L28), [40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L40-L41), [47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L47), [54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L54), [63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L63), [75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L75), [86](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L86), [92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L92), [115](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L115), [125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L125), [139](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L139), [149](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L149)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

261:             emit BlockCommit( 
262:                 _lastCommittedBatchData.batchNumber,
263:                 _lastCommittedBatchData.batchHash,
264:                 _lastCommittedBatchData.commitment
265:             );

299:             emit BlockCommit( 
300:                 _lastCommittedBatchData.batchNumber,
301:                 _lastCommittedBatchData.batchHash,
302:                 _lastCommittedBatchData.commitment
303:             );
```
[261](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L261-L265), [299](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L299-L303)

</details>


---
### [NC&#x2011;45] Events may be emitted out of order due to reentrancy
If a reentrancy occurs, some events may be emitted in an unexpected order, and this may be a problem if a third party expects a specific order for these events. Ensure that events follow the best practice of CEI.

<details>
<summary><i>There are 6 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

155:         emit DepositInitiated(l2TxHash, msg.sender, _l2Receiver, _l1Token, _amount); 
```
[155](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L155)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

168:         emit BridgehubDepositBaseTokenInitiated(_chainId, _prevMsgSender, _l1Token, _amount); 

227:         emit BridgehubDepositInitiated(_chainId, txDataHash, _prevMsgSender, _l2Receiver, _l1Token, amount); 
```
[168](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L168), [227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L227)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

47:         emit ChangeSecurityCouncil(address(0), _securityCouncil); 

50:         emit ChangeMinDelay(0, _minDelay); 
```
[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L47), [50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L50)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

147:         emit BridgeMint(_to, _amount); 
```
[147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L147)

</details>


---
### [NC&#x2011;46] Events should be emitted before external calls
Ensure that events follow the best practice of check-effects-interaction, and are emitted before external calls.

<details>
<summary><i>There are 33 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit depositLegacyErc20Bridge() on line 145
155:         emit DepositInitiated(l2TxHash, msg.sender, _l2Receiver, _l1Token, _amount); 

/// @audit claimFailedDepositLegacyErc20Bridge() on line 189
199:         emit ClaimedFailedDeposit(_depositSender, _l1Token, amount); 

/// @audit finalizeWithdrawalLegacyErc20Bridge() on line 218
225:         emit WithdrawalFinalized(l1Receiver, l1Token, amount); 
```
[155](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L155), [199](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L199), [225](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L225)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit encode() on line 210
227:         emit BridgehubDepositInitiated(_chainId, txDataHash, _prevMsgSender, _l2Receiver, _l1Token, amount); 

/// @audit safeTransfer() on line 362
367:         emit ClaimedFailedDepositSharedBridge(_chainId, _depositSender, _l1Token, _amount); 

/// @audit safeTransfer() on line 452
454:         emit WithdrawalFinalizedSharedBridge(_chainId, l1Receiver, l1Token, amount); 

/// @audit encode() on line 598
602:         emit LegacyDepositInitiated(ERA_CHAIN_ID, l2TxHash, _prevMsgSender, _l2Receiver, _l1Token, _amount); 
```
[227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L227), [367](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L367), [454](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L454), [602](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L602)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit createNewChain() on line 137
145:         emit NewChain(_chainId, _stateTransitionManager, _admin); 
```
[145](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L145)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

/// @audit _execute() on line 174, triggering call()
180:         emit OperationExecuted(id); 

/// @audit _execute() on line 193, triggering call()
199:         emit OperationExecuted(id); 
```
[180](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L180), [199](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L199)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit executeUpgrade() on line 226
227:         emit SetChainIdUpgrade(_chainContract, l2ProtocolUpgradeTx, protocolVersion); 

/// @audit initialize() on line 262
287:         emit StateTransitionNewChain(_chainId, stateTransitionAddress); 
```
[227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L227), [287](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L287)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

/// @audit diamondCut() on line 114
115:         emit ExecuteUpgrade(_diamondCut); 

/// @audit diamondCut() on line 124
125:         emit ExecuteUpgrade(_diamondCut); 
```
[115](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L115), [125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L125)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit uncheckedInc() on line 257
261:             emit BlockCommit( 
262:                 _lastCommittedBatchData.batchNumber,
263:                 _lastCommittedBatchData.batchHash,
264:                 _lastCommittedBatchData.commitment
265:             );

/// @audit uncheckedInc() on line 289
299:             emit BlockCommit( 
300:                 _lastCommittedBatchData.batchNumber,
301:                 _lastCommittedBatchData.batchHash,
302:                 _lastCommittedBatchData.commitment
303:             );

/// @audit uncheckedInc() on line 351
353:             emit BlockExecution(_batchesData[i].batchNumber, _batchesData[i].batchHash, _batchesData[i].commitment); 

/// @audit uncheckedInc() on line 406
436:         emit BlocksVerification(s.totalBatchesVerified, currentTotalBatchesVerified); 
```
[261](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L261-L265), [299](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L299-L303), [353](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L353), [436](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L436)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

/// @audit pushBack() on line 334
343:         emit NewPriorityRequest( 
344:             _priorityOpParams.txId,
345:             canonicalTxHash,
346:             _priorityOpParams.expirationTimestamp,
347:             transaction,
348:             _factoryDeps
349:         );
```
[343](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L343-L349)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

/// @audit _initializeDiamondCut() on line 120, triggering call()
121:         emit DiamondCut(facetCuts, initAddress, initCalldata); 
```
[121](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L121)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

/// @audit validateBytecodeHash() on line 97
104:         emit NewL2DefaultAccountBytecodeHash(previousDefaultAccountBytecodeHash, _l2DefaultAccountBytecodeHash); 

/// @audit validateBytecodeHash() on line 114
121:         emit NewL2BootloaderBytecodeHash(previousBootloaderBytecodeHash, _l2BootloaderBytecodeHash); 
```
[104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L104), [121](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L121)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

/// @audit bridgeMint() on line 104
105:         emit FinalizeDeposit(_l1Sender, _l2Receiver, expectedL2Token, _amount); 

/// @audit sendMessageToL1() on line 132
134:         emit WithdrawalInitiated(msg.sender, _l1Receiver, _l2Token, _amount); 
```
[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L105), [134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L134)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

/// @audit decodeUint8() on line 93
101:         emit BridgeInitialize(_l1Address, decodedName, decodedSymbol, decimals_); 

/// @audit owner() on line 120
126:         emit BridgeInitialize(l1Address, _newName, _newSymbol, decimals_); 
```
[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L101), [126](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L126)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

/// @audit storeAccountConstructedCodeHash() on line 352
355:         emit ContractDeployed(_sender, _bytecodeHash, _newAddress); 
```
[355](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L355)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

/// @audit requestBytecodeL1Publication() on line 51
59:             emit MarkedAsKnown(_bytecodeHash, _shouldSendToL1); 
```
[59](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L59)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

/// @audit encode() on line 106
111:         emit L2ToL1LogSent(_l2ToL1Log); 

/// @audit burnGas() on line 154
156:         emit L1MessageSent(msg.sender, hash, _message); 

/// @audit burnGas() on line 179
181:         emit BytecodeL1PublicationRequested(_bytecodeHash); 
```
[111](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L111), [156](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L156), [181](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L181)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

/// @audit sendToL1() on line 77
79:         emit Withdrawal(msg.sender, _l1Receiver, amount); 

/// @audit sendToL1() on line 90
92:         emit WithdrawalWithMessage(msg.sender, _l1Receiver, amount, _additionalData); 
```
[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L79), [92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L92)

</details>


---
### [NC&#x2011;47] Events should use parameters to convey information
For example, rather than using `event Paused()` and `event Unpaused()`, use `event PauseState(address indexed whoChangedIt, bool wasPaused, bool isNowPaused)`


<i>There are 2 instaces of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol

94:     event Freeze(); 

97:     event Unfreeze(); 
```
[94](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L94), [97](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L97)


---
### [NC&#x2011;48] Events that mark critical parameter changes should contain both the old and the new value
This should especially be done if the new value is not required to be different from the old value

<details>
<summary><i>There are 13 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 
52:         // Save previous value into the stack to put it into the event later
53:         address oldPendingAdmin = pendingAdmin;
54:         // Change pending admin
55:         pendingAdmin = _newPendingAdmin;
56:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
57:     }
```
[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L57)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

110:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 
111:         // Save previous value into the stack to put it into the event later
112:         address oldPendingAdmin = pendingAdmin;
113:         // Change pending admin
114:         pendingAdmin = _newPendingAdmin;
115:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
116:     }
```
[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L110-L116)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

96:     function setExecutionDelay(uint32 _executionDelay) external onlyOwner { 
97:         executionDelay = _executionDelay;
98:         emit NewExecutionDelay(_executionDelay);
99:     }
```
[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L96-L99)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin { 
24:         // Save previous value into the stack to put it into the event later
25:         address oldPendingAdmin = s.pendingAdmin;
26:         // Change pending admin
27:         s.pendingAdmin = _newPendingAdmin;
28:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
29:     }

51:     function setPorterAvailability(bool _zkPorterIsAvailable) external onlyStateTransitionManager { 
52:         // Change the porter availability
53:         s.zkPorterIsAvailable = _zkPorterIsAvailable;
54:         emit IsPorterAvailableStatusUpdate(_zkPorterIsAvailable);
55:     }

58:     function setPriorityTxMaxGasLimit(uint256 _newPriorityTxMaxGasLimit) external onlyStateTransitionManager { 
59:         require(_newPriorityTxMaxGasLimit <= MAX_GAS_PER_TRANSACTION, "n5");
60: 
61:         uint256 oldPriorityTxMaxGasLimit = s.priorityTxMaxGasLimit;
62:         s.priorityTxMaxGasLimit = _newPriorityTxMaxGasLimit;
63:         emit NewPriorityTxMaxGasLimit(oldPriorityTxMaxGasLimit, _newPriorityTxMaxGasLimit);
64:     }

89:     function setValidiumMode(PubdataPricingMode _validiumMode) external onlyAdmin { 
90:         require(s.totalBatchesCommitted == 0, "AdminFacet: set validium only after genesis"); // Validium mode can be set only before the first batch is committed
91:         s.feeParams.pubdataPricingMode = _validiumMode;
92:         emit ValidiumModeStatusUpdate(_validiumMode);
93:     }
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L23-L29), [51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L51-L55), [58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L58-L64), [89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L89-L93)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

92:     function _setL2DefaultAccountBytecodeHash(bytes32 _l2DefaultAccountBytecodeHash) private { 
93:         if (_l2DefaultAccountBytecodeHash == bytes32(0)) {
94:             return;
95:         }
96: 
97:         L2ContractHelper.validateBytecodeHash(_l2DefaultAccountBytecodeHash);
98: 
99:         // Save previous value into the stack to put it into the event later
100:         bytes32 previousDefaultAccountBytecodeHash = s.l2DefaultAccountBytecodeHash;
101: 
102:         // Change the default account bytecode hash
103:         s.l2DefaultAccountBytecodeHash = _l2DefaultAccountBytecodeHash;
104:         emit NewL2DefaultAccountBytecodeHash(previousDefaultAccountBytecodeHash, _l2DefaultAccountBytecodeHash);
105:     }

109:     function _setL2BootloaderBytecodeHash(bytes32 _l2BootloaderBytecodeHash) private { 
110:         if (_l2BootloaderBytecodeHash == bytes32(0)) {
111:             return;
112:         }
113: 
114:         L2ContractHelper.validateBytecodeHash(_l2BootloaderBytecodeHash);
115: 
116:         // Save previous value into the stack to put it into the event later
117:         bytes32 previousBootloaderBytecodeHash = s.l2BootloaderBytecodeHash;
118: 
119:         // Change the bootloader bytecode hash
120:         s.l2BootloaderBytecodeHash = _l2BootloaderBytecodeHash;
121:         emit NewL2BootloaderBytecodeHash(previousBootloaderBytecodeHash, _l2BootloaderBytecodeHash);
122:     }

126:     function _setVerifier(IVerifier _newVerifier) private { 
127:         // An upgrade to the verifier must be done carefully to ensure there aren't batches in the committed state
128:         // during the transition. If verifier is upgraded, it will immediately be used to prove all committed batches.
129:         // Batches committed expecting the old verifier will fail. Ensure all commited batches are finalized before the
130:         // verifier is upgraded.
131:         if (_newVerifier == IVerifier(address(0))) {
132:             return;
133:         }
134: 
135:         IVerifier oldVerifier = s.verifier;
136:         s.verifier = _newVerifier;
137:         emit NewVerifier(address(oldVerifier), address(_newVerifier));
138:     }

142:     function _setVerifierParams(VerifierParams calldata _newVerifierParams) private { 
143:         // An upgrade to the verifier params must be done carefully to ensure there aren't batches in the committed state
144:         // during the transition. If verifier is upgraded, it will immediately be used to prove all committed batches.
145:         // Batches committed expecting the old verifier params will fail. Ensure all commited batches are finalized before the
146:         // verifier is upgraded.
147:         if (
148:             _newVerifierParams.recursionNodeLevelVkHash == bytes32(0) &&
149:             _newVerifierParams.recursionLeafLevelVkHash == bytes32(0) &&
150:             _newVerifierParams.recursionCircuitsSetVksHash == bytes32(0)
151:         ) {
152:             return;
153:         }
154: 
155:         VerifierParams memory oldVerifierParams = s.verifierParams;
156:         s.verifierParams = _newVerifierParams;
157:         emit NewVerifierParams(oldVerifierParams, _newVerifierParams);
158:     }

236:     function _setNewProtocolVersion(uint256 _newProtocolVersion) internal virtual { 
237:         uint256 previousProtocolVersion = s.protocolVersion;
238:         require(
239:             _newProtocolVersion > previousProtocolVersion,
240:             "New protocol version is not greater than the current one"
241:         );
242:         require(
243:             _newProtocolVersion - previousProtocolVersion <= MAX_ALLOWED_PROTOCOL_VERSION_DELTA,
244:             "Too big protocol version difference"
245:         );
246: 
247:         // If the previous upgrade had an L2 system upgrade transaction, we require that it is finalized.
248:         // Note it is important to keep this check, as otherwise hyperchains might skip upgrades by overwriting
249:         require(s.l2SystemContractsUpgradeTxHash == bytes32(0), "Previous upgrade has not been finalized");
250:         require(
251:             s.l2SystemContractsUpgradeBatchNumber == 0,
252:             "The batch number of the previous upgrade has not been cleaned"
253:         );
254: 
255:         s.protocolVersion = _newProtocolVersion;
256:         emit NewProtocolVersion(previousProtocolVersion, _newProtocolVersion);
257:     }
```
[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L92-L105), [109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L109-L122), [126](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L126-L138), [142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L142-L158), [236](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L236-L257)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

20:     function _setNewProtocolVersion(uint256 _newProtocolVersion) internal override { 
21:         uint256 previousProtocolVersion = s.protocolVersion;
22:         require(
23:             // Genesis Upgrade difference: Note this is the only thing change > to >=
24:             _newProtocolVersion >= previousProtocolVersion,
25:             "New protocol version is not greater than the current one"
26:         );
27:         require(
28:             _newProtocolVersion - previousProtocolVersion <= MAX_ALLOWED_PROTOCOL_VERSION_DELTA,
29:             "Too big protocol version difference"
30:         );
31: 
32:         // If the previous upgrade had an L2 system upgrade transaction, we require that it is finalized.
33:         require(s.l2SystemContractsUpgradeTxHash == bytes32(0), "Previous upgrade has not been finalized");
34:         require(
35:             s.l2SystemContractsUpgradeBatchNumber == 0,
36:             "The batch number of the previous upgrade has not been cleaned"
37:         );
38: 
39:         s.protocolVersion = _newProtocolVersion;
40:         emit NewProtocolVersion(previousProtocolVersion, _newProtocolVersion);
41:     }
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L20-L41)

</details>


---
### [NC&#x2011;49] Expressions for `constant` values should use `immutable` rather than constant
While it does not save gas for some simple binary expressions because the compiler knows that developers often make this mistake, it's still best to use the right tool for the task at hand. There is a difference between `constant` variables and `immutable` variables, and they should each be used in their appropriate contexts. `constants` should be used for literal values written into the code, and `immutable` variables should be used for expressions, or values calculated in, or passed into the constructor.

<details>
<summary><i>There are 9 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

12:     bytes32 private constant CREATE2_PREFIX = keccak256("zksyncCreate2"); 
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L12)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

22:     uint256 internal constant EXECUTED_PROPOSAL_TIMESTAMP = uint256(1); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L22)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L22)

```solidity
📁 File: contracts/zksync/contracts/L2ContractHelper.sol

85:     bytes32 private constant CREATE2_PREFIX = keccak256("zksyncCreate2"); 
```
[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L85)

```solidity
📁 File: contracts/zksync/contracts/vendor/AddressAliasHelper.sol

22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L22)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

28:     uint256 private constant DEPLOY_NONCE_MULTIPLIER = 2 ** 128; 

31:     uint256 private constant MAXIMAL_MIN_NONCE_INCREMENT = 2 ** 32; 
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L28), [31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L31)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

82:     bytes32 constant EIP712_DOMAIN_TYPEHASH = keccak256("EIP712Domain(string name,string version,uint256 chainId)"); 

84:     bytes32 constant EIP712_TRANSACTION_TYPE_HASH = 
85:         keccak256(
86:             "Transaction(uint256 txType,uint256 from,uint256 to,uint256 gasLimit,uint256 gasPerPubdataByteLimit,uint256 maxFeePerGas,uint256 maxPriorityFeePerGas,uint256 paymaster,uint256 nonce,uint256 value,bytes data,bytes32[] factoryDeps,bytes paymasterInput)"
87:         );
```
[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L82), [84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L84-L87)

</details>


---
### [NC&#x2011;50] Extraneous whitespace
See the [whitespace](https://docs.soliditylang.org/en/v0.8.16/style-guide.html#whitespace-in-expressions) section of the Solidity Style Guide

<details>
<summary><i>There are 6 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

144:             (address logSender, ) = UnsafeBytes.readAddress(emittedL2Logs, i + L2_LOG_ADDRESS_OFFSET); 
145:             (uint256 logKey, ) = UnsafeBytes.readUint256(emittedL2Logs, i + L2_LOG_KEY_OFFSET);
146:             (bytes32 logValue, ) = UnsafeBytes.readBytes32(emittedL2Logs, i + L2_LOG_VALUE_OFFSET);
```
[144](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L144-L146)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

63:             (bool success, ) = address(REAL_BASE_TOKEN_SYSTEM_CONTRACT).call( 
64:                 abi.encodeCall(REAL_BASE_TOKEN_SYSTEM_CONTRACT.transferFromTo, (msg.sender, to, value))
65:             );
```
[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L63-L65)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

127:         (deploymentNonce, ) = _splitRawNonce(rawNonces[addressAsKey]); 

147:         (prevDeploymentNonce, ) = _splitRawNonce(oldRawNonce); 
```
[127](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L127), [147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L147)

</details>


---
### [NC&#x2011;51] For loops in `public` or `external` functions should be avoided due to high gas costs and possible DOS
In Solidity, for loops can potentially cause Denial of Service (DoS) attacks if not handled carefully. DoS attacks can occur when an attacker intentionally exploits the gas cost of a function, causing it to run out of gas or making it too expensive for other users to call. Below are some scenarios where for loops can lead to DoS attacks: Nested for loops can become exceptionally gas expensive and should be used sparingly.

<details>
<summary><i>There are 10 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

/// @audit line 208
202:     function facets() external view returns (Facet[] memory result) { 
203:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage();
204: 
205:         uint256 facetsLen = ds.facets.length;
206:         result = new Facet[](facetsLen);
207: 
208:         for (uint256 i = 0; i < facetsLen; i = i.uncheckedInc()) {
209:             address facetAddr = ds.facets[i];
210:             Diamond.FacetToSelectors memory facetToSelectors = ds.facetToSelectors[facetAddr];
211: 
212:             result[i] = Facet(facetAddr, facetToSelectors.selectors);
213:         }
214:     }
```
[202](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L202-L214)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

/// @audit line 127
/// @audit line 159
110:     function verifyCompressedStateDiffs( 
111:         uint256 _numberOfStateDiffs,
112:         uint256 _enumerationIndexSize,
113:         bytes calldata _stateDiffs,
114:         bytes calldata _compressedStateDiffs
115:     ) external payable onlyCallFrom(address(L1_MESSENGER_CONTRACT)) returns (bytes32 stateDiffHash) {
116:         // We do not enforce the operator to use the optimal, i.e. the minimally possible _enumerationIndexSize.
117:         // We do enforce however, that the _enumerationIndexSize is not larger than 8 bytes long, which is the
118:         // maximal ever possible size for enumeration index.
119:         require(_enumerationIndexSize <= MAX_ENUMERATION_INDEX_SIZE, "enumeration index size is too large");
120: 
121:         uint256 numberOfInitialWrites = uint256(_compressedStateDiffs.readUint16(0));
122: 
123:         uint256 stateDiffPtr = 2;
124:         uint256 numInitialWritesProcessed = 0;
125: 
126:         // Process initial writes
127:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) {
128:             bytes calldata stateDiff = _stateDiffs[i:i + STATE_DIFF_ENTRY_SIZE];
129:             uint64 enumIndex = stateDiff.readUint64(84);
130:             if (enumIndex != 0) {
131:                 // It is a repeated write, so we skip it.
132:                 continue;
133:             }
134: 
135:             numInitialWritesProcessed++;
136: 
137:             bytes32 derivedKey = stateDiff.readBytes32(52);
138:             uint256 initValue = stateDiff.readUint256(92);
139:             uint256 finalValue = stateDiff.readUint256(124);
140:             require(derivedKey == _compressedStateDiffs.readBytes32(stateDiffPtr), "iw: initial key mismatch");
141:             stateDiffPtr += 32;
142: 
143:             uint8 metadata = uint8(bytes1(_compressedStateDiffs[stateDiffPtr]));
144:             stateDiffPtr++;
145:             uint8 operation = metadata & OPERATION_BITMASK;
146:             uint8 len = operation == 0 ? 32 : metadata >> LENGTH_BITS_OFFSET;
147:             _verifyValueCompression(
148:                 initValue,
149:                 finalValue,
150:                 operation,
151:                 _compressedStateDiffs[stateDiffPtr:stateDiffPtr + len]
152:             );
153:             stateDiffPtr += len;
154:         }
155: 
156:         require(numInitialWritesProcessed == numberOfInitialWrites, "Incorrect number of initial storage diffs");
157: 
158:         // Process repeated writes
159:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) {
160:             bytes calldata stateDiff = _stateDiffs[i:i + STATE_DIFF_ENTRY_SIZE];
161:             uint64 enumIndex = stateDiff.readUint64(84);
162:             if (enumIndex == 0) {
163:                 continue;
164:             }
165: 
166:             uint256 initValue = stateDiff.readUint256(92);
167:             uint256 finalValue = stateDiff.readUint256(124);
168:             uint256 compressedEnumIndex = _sliceToUint256(
169:                 _compressedStateDiffs[stateDiffPtr:stateDiffPtr + _enumerationIndexSize]
170:             );
171:             require(enumIndex == compressedEnumIndex, "rw: enum key mismatch");
172:             stateDiffPtr += _enumerationIndexSize;
173: 
174:             uint8 metadata = uint8(bytes1(_compressedStateDiffs[stateDiffPtr]));
175:             stateDiffPtr += 1;
176:             uint8 operation = metadata & OPERATION_BITMASK;
177:             uint8 len = operation == 0 ? 32 : metadata >> LENGTH_BITS_OFFSET;
178:             _verifyValueCompression(
179:                 initValue,
180:                 finalValue,
181:                 operation,
182:                 _compressedStateDiffs[stateDiffPtr:stateDiffPtr + len]
183:             );
184:             stateDiffPtr += len;
185:         }
186: 
187:         require(stateDiffPtr == _compressedStateDiffs.length, "Extra data in _compressedStateDiffs");
188: 
189:         stateDiffHash = EfficientCall.keccak(_stateDiffs);
190:     }
```
[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L110-L190)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

/// @audit line 248
/// @audit line 253
238:     function forceDeployOnAddresses(ForceDeployment[] calldata _deployments) external payable { 
239:         require(
240:             msg.sender == FORCE_DEPLOYER || msg.sender == address(COMPLEX_UPGRADER_CONTRACT),
241:             "Can only be called by FORCE_DEPLOYER or COMPLEX_UPGRADER_CONTRACT"
242:         );
243: 
244:         uint256 deploymentsLength = _deployments.length;
245:         // We need to ensure that the `value` provided by the call is enough to provide `value`
246:         // for all of the deployments
247:         uint256 sumOfValues = 0;
248:         for (uint256 i = 0; i < deploymentsLength; ++i) {
249:             sumOfValues += _deployments[i].value;
250:         }
251:         require(msg.value == sumOfValues, "`value` provided is not equal to the combined `value`s of deployments");
252: 
253:         for (uint256 i = 0; i < deploymentsLength; ++i) {
254:             this.forceDeployOnAddress{value: _deployments[i].value}(_deployments[i], msg.sender);
255:         }
256:     }
```
[238](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L238-L256)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

/// @audit line 206
/// @audit line 218
/// @audit line 236
/// @audit line 254
194:     function publishPubdataAndClearState( 
195:         bytes calldata _totalL2ToL1PubdataAndStateDiffs
196:     ) external onlyCallFromBootloader {
197:         uint256 calldataPtr = 0;
198: 
199:         /// Check logs
200:         uint32 numberOfL2ToL1Logs = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));
201:         require(numberOfL2ToL1Logs <= L2_TO_L1_LOGS_MERKLE_TREE_LEAVES, "Too many L2->L1 logs");
202:         calldataPtr += 4;
203: 
204:         bytes32[] memory l2ToL1LogsTreeArray = new bytes32[](L2_TO_L1_LOGS_MERKLE_TREE_LEAVES);
205:         bytes32 reconstructedChainedLogsHash;
206:         for (uint256 i = 0; i < numberOfL2ToL1Logs; ++i) {
207:             bytes32 hashedLog = EfficientCall.keccak(
208:                 _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + L2_TO_L1_LOG_SERIALIZE_SIZE]
209:             );
210:             calldataPtr += L2_TO_L1_LOG_SERIALIZE_SIZE;
211:             l2ToL1LogsTreeArray[i] = hashedLog;
212:             reconstructedChainedLogsHash = keccak256(abi.encode(reconstructedChainedLogsHash, hashedLog));
213:         }
214:         require(
215:             reconstructedChainedLogsHash == chainedLogsHash,
216:             "reconstructedChainedLogsHash is not equal to chainedLogsHash"
217:         );
218:         for (uint256 i = numberOfL2ToL1Logs; i < L2_TO_L1_LOGS_MERKLE_TREE_LEAVES; ++i) {
219:             l2ToL1LogsTreeArray[i] = L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH;
220:         }
221:         uint256 nodesOnCurrentLevel = L2_TO_L1_LOGS_MERKLE_TREE_LEAVES;
222:         while (nodesOnCurrentLevel > 1) {
223:             nodesOnCurrentLevel /= 2;
224:             for (uint256 i = 0; i < nodesOnCurrentLevel; ++i) {
225:                 l2ToL1LogsTreeArray[i] = keccak256(
226:                     abi.encode(l2ToL1LogsTreeArray[2 * i], l2ToL1LogsTreeArray[2 * i + 1])
227:                 );
228:             }
229:         }
230:         bytes32 l2ToL1LogsTreeRoot = l2ToL1LogsTreeArray[0];
231: 
232:         /// Check messages
233:         uint32 numberOfMessages = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));
234:         calldataPtr += 4;
235:         bytes32 reconstructedChainedMessagesHash;
236:         for (uint256 i = 0; i < numberOfMessages; ++i) {
237:             uint32 currentMessageLength = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));
238:             calldataPtr += 4;
239:             bytes32 hashedMessage = EfficientCall.keccak(
240:                 _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + currentMessageLength]
241:             );
242:             calldataPtr += currentMessageLength;
243:             reconstructedChainedMessagesHash = keccak256(abi.encode(reconstructedChainedMessagesHash, hashedMessage));
244:         }
245:         require(
246:             reconstructedChainedMessagesHash == chainedMessagesHash,
247:             "reconstructedChainedMessagesHash is not equal to chainedMessagesHash"
248:         );
249: 
250:         /// Check bytecodes
251:         uint32 numberOfBytecodes = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));
252:         calldataPtr += 4;
253:         bytes32 reconstructedChainedL1BytecodesRevealDataHash;
254:         for (uint256 i = 0; i < numberOfBytecodes; ++i) {
255:             uint32 currentBytecodeLength = uint32(
256:                 bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4])
257:             );
258:             calldataPtr += 4;
259:             reconstructedChainedL1BytecodesRevealDataHash = keccak256(
260:                 abi.encode(
261:                     reconstructedChainedL1BytecodesRevealDataHash,
262:                     Utils.hashL2Bytecode(
263:                         _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + currentBytecodeLength]
264:                     )
265:                 )
266:             );
267:             calldataPtr += currentBytecodeLength;
268:         }
269:         require(
270:             reconstructedChainedL1BytecodesRevealDataHash == chainedL1BytecodesRevealDataHash,
271:             "reconstructedChainedL1BytecodesRevealDataHash is not equal to chainedL1BytecodesRevealDataHash"
272:         );
273: 
274:         /// Check State Diffs
275:         /// encoding is as follows:
276:         /// header (1 byte version, 3 bytes total len of compressed, 1 byte enumeration index size)
277:         /// body (`compressedStateDiffSize` bytes, 4 bytes number of state diffs, `numberOfStateDiffs` * `STATE_DIFF_ENTRY_SIZE` bytes for the uncompressed state diffs)
278:         /// encoded state diffs: [20bytes address][32bytes key][32bytes derived key][8bytes enum index][32bytes initial value][32bytes final value]
279:         require(
280:             uint256(uint8(bytes1(_totalL2ToL1PubdataAndStateDiffs[calldataPtr]))) ==
281:                 STATE_DIFF_COMPRESSION_VERSION_NUMBER,
282:             "state diff compression version mismatch"
283:         );
284:         calldataPtr++;
285: 
286:         uint24 compressedStateDiffSize = uint24(bytes3(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 3]));
287:         calldataPtr += 3;
288: 
289:         uint8 enumerationIndexSize = uint8(bytes1(_totalL2ToL1PubdataAndStateDiffs[calldataPtr]));
290:         calldataPtr++;
291: 
292:         bytes calldata compressedStateDiffs = _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr +
293:             compressedStateDiffSize];
294:         calldataPtr += compressedStateDiffSize;
295: 
296:         bytes calldata totalL2ToL1Pubdata = _totalL2ToL1PubdataAndStateDiffs[:calldataPtr];
297: 
298:         require(calldataPtr <= MAX_ALLOWED_PUBDATA_PER_BATCH, "L1 Messenger pubdata is too long");
299: 
300:         uint32 numberOfStateDiffs = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));
301:         calldataPtr += 4;
302: 
303:         bytes calldata stateDiffs = _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr +
304:             (numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE)];
305:         calldataPtr += numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE;
306: 
307:         bytes32 stateDiffHash = COMPRESSOR_CONTRACT.verifyCompressedStateDiffs(
308:             numberOfStateDiffs,
309:             enumerationIndexSize,
310:             stateDiffs,
311:             compressedStateDiffs
312:         );
313: 
314:         /// Check for calldata strict format
315:         require(calldataPtr == _totalL2ToL1PubdataAndStateDiffs.length, "Extra data in the totalL2ToL1Pubdata array");
316: 
317:         PUBDATA_CHUNK_PUBLISHER.chunkAndPublishPubdata(totalL2ToL1Pubdata);
318: 
319:         /// Native (VM) L2 to L1 log
320:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.L2_TO_L1_LOGS_TREE_ROOT_KEY)), l2ToL1LogsTreeRoot);
321:         SystemContractHelper.toL1(
322:             true,
323:             bytes32(uint256(SystemLogKey.TOTAL_L2_TO_L1_PUBDATA_KEY)),
324:             EfficientCall.keccak(totalL2ToL1Pubdata)
325:         );
326:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.STATE_DIFF_HASH_KEY)), stateDiffHash);
327: 
328:         /// Clear logs state
329:         chainedLogsHash = bytes32(0);
330:         numberOfLogsToProcess = 0;
331:         chainedMessagesHash = bytes32(0);
332:         chainedL1BytecodesRevealDataHash = bytes32(0);
333:     }
```
[194](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L194-L333)

```solidity
📁 File: system-contracts/contracts/PubdataChunkPublisher.sol

/// @audit line 36
21:     function chunkAndPublishPubdata(bytes calldata _pubdata) external onlyCallFrom(address(L1_MESSENGER_CONTRACT)) { 
22:         require(_pubdata.length <= BLOB_SIZE_BYTES * MAX_NUMBER_OF_BLOBS, "pubdata should fit in 2 blobs");
23: 
24:         bytes32[] memory blobHashes = new bytes32[](MAX_NUMBER_OF_BLOBS);
25: 
26:         // We allocate to the full size of MAX_NUMBER_OF_BLOBS * BLOB_SIZE_BYTES because we need to pad
27:         // the data on the right with 0s if it doesn't take up the full blob
28:         bytes memory totalBlobs = new bytes(BLOB_SIZE_BYTES * MAX_NUMBER_OF_BLOBS);
29: 
30:         assembly {
31:             // The pointer to the allocated memory above. We skip 32 bytes to avoid overwriting the length.
32:             let ptr := add(totalBlobs, 0x20)
33:             calldatacopy(ptr, _pubdata.offset, _pubdata.length)
34:         }
35: 
36:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) {
37:             uint256 start = BLOB_SIZE_BYTES * i;
38: 
39:             // We break if the pubdata isn't enough to cover 2 blobs. On L1 it is expected that the hash
40:             // will be bytes32(0) if a blob isn't going to be used.
41:             if (start >= _pubdata.length) {
42:                 break;
43:             }
44: 
45:             bytes32 blobHash;
46:             assembly {
47:                 // The pointer to the allocated memory above skipping the length.
48:                 let ptr := add(totalBlobs, 0x20)
49:                 blobHash := keccak256(add(ptr, start), BLOB_SIZE_BYTES)
50:             }
51: 
52:             blobHashes[i] = blobHash;
53:         }
54: 
55:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_ONE_HASH_KEY)), blobHashes[0]);
56:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_TWO_HASH_KEY)), blobHashes[1]);
57:     }
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L21-L57)

</details>


---
### [NC&#x2011;52] Function called does not exist in the contract interface
<details>
<summary><i>There are 17 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

67:         IERC20(_token).safeTransfer(address(sharedBridge), amount); 

162:         _token.safeTransferFrom(_from, address(sharedBridge), _amount); 
```
[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L67), [162](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L162)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

175:         _token.safeTransferFrom(_from, address(this), _amount); 

362:             IERC20(_l1Token).safeTransfer(_depositSender, _amount); 

452:             IERC20(l1Token).safeTransfer(l1Receiver, amount); 
```
[175](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L175), [362](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L362), [452](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L452)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

160:         return IZkSyncStateTransition(stateTransition).proveL2MessageInclusion(_batchNumber, _index, _message, _proof); 

172:         return IZkSyncStateTransition(stateTransition).proveL2LogInclusion(_batchNumber, _index, _log, _proof); 

187:             IZkSyncStateTransition(stateTransition).proveL1ToL2TransactionStatus( 

206:             IZkSyncStateTransition(stateTransition).l2TransactionBaseCost( 

238:         canonicalTxHash = IZkSyncStateTransition(stateTransition).bridgehubRequestL2Transaction( 

304:         canonicalTxHash = IZkSyncStateTransition(stateTransition).bridgehubRequestL2Transaction( 
```
[160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L160), [172](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L172), [187](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L187), [206](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L206), [238](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L238), [304](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L304)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

75:         return IZkSyncStateTransition(stateTransition[_chainId]).getAdmin(); 

161:         IZkSyncStateTransition(stateTransition[_chainId]).freezeDiamond(); 

166:         IZkSyncStateTransition(stateTransition[_chainId]).freezeDiamond(); 

171:         IZkSyncStateTransition(stateTransition[_chainId]).revertBatches(_newLastBatch); 
```
[75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L75), [161](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L161), [166](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L166), [171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L171)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

382:                 IERC20(token).safeApprove(paymaster, 0); 
383:                 IERC20(token).safeApprove(paymaster, minAllowance);
```
[382](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L382-L383)

</details>


---
### [NC&#x2011;53] Function ordering in the contract does not follow the Solidity style guide
Source: [https://docs.soliditylang.org/en/v0.8.17/style-guide.html#order-of-layout](https://docs.soliditylang.org/en/v0.8.17/style-guide.html#order-of-layout)

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

60:     function initialize() external reentrancyGuardInitializer {} 

63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external { 

75:     function l2TokenAddress(address _l1Token) external view returns (address) { 

98:     function deposit( 

176:     function claimFailedDeposit( 

208:     function finalizeWithdrawal( 
```
[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L60), [63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63), [75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L75), [98](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L98), [176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L176), [208](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L208)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

104:     function initialize( 

116:     function transferFundsFromLegacy(address _token, address _target, uint256 _targetChainId) external onlyOwner { 

137:     function receiveEth(uint256 _chainId) external payable { 

142:     function initializeChainGovernance(uint256 _chainId, address _l2BridgeAddress) external onlyOwner { 

148:     function bridgehubDepositBaseToken( 

182:     function bridgehubDeposit( 

232:     function bridgehubConfirmL2Transaction( 

277:     function claimFailedDeposit( 

303:     function _claimFailedDeposit( 

385:     function finalizeWithdrawal( 

409:     function _finalizeWithdrawal( 

554:     function depositLegacyErc20Bridge( 

615:     function finalizeWithdrawalLegacyErc20Bridge( 

644:     function claimFailedDepositLegacyErc20Bridge( 
```
[104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L104), [116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L116), [137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L137), [142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L142), [148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L148), [182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L182), [232](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L232), [277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L277), [303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L303), [385](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L385), [409](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L409), [554](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L554), [615](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L615), [644](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L644)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

41:     function initialize(address _owner) external reentrancyGuardInitializer { 

51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 

60:     function acceptAdmin() external { 

82:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner { 

92:     function removeStateTransitionManager(address _stateTransitionManager) external onlyOwner { 

101:     function addToken(address _token) external onlyOwner { 

108:     function setSharedBridge(address _sharedBridge) external onlyOwner { 

114:     function createNewChain( 

152:     function proveL2MessageInclusion( 

164:     function proveL2LogInclusion( 

176:     function proveL1ToL2TransactionStatus( 

198:     function l2TransactionBaseCost( 

217:     function requestL2TransactionDirect( 

262:     function requestL2TransactionTwoBridges( 
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L41), [51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51), [60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L60), [82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L82), [92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L92), [101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L101), [108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108), [114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114), [152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L152), [164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L164), [176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L176), [198](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L198), [217](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L217), [262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L262)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

129:     function scheduleTransparent(Operation calldata _operation, uint256 _delay) external onlyOwner { 

142:     function scheduleShadow(bytes32 _id, uint256 _delay) external onlyOwner { 

154:     function cancel(bytes32 _id) external onlyOwner { 

167:     function execute(Operation calldata _operation) external payable onlyOwnerOrSecurityCouncil { 

186:     function executeInstant(Operation calldata _operation) external payable onlySecurityCouncil { 

249:     function updateDelay(uint256 _newDelay) external onlySelf { 
```
[129](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L129), [142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L142), [154](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L154), [167](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L167), [186](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L186), [249](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L249)

</details>


---
### [NC&#x2011;54] Functions contain the same code
The functions below have the same implementation as is seen in other files. The functions should be refactored into functions of a common base contract.

<details>
<summary><i>There are 38 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 
52:         // Save previous value into the stack to put it into the event later
53:         address oldPendingAdmin = pendingAdmin;
54:         // Change pending admin
55:         pendingAdmin = _newPendingAdmin;
56:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
57:     }

60:     function acceptAdmin() external { 
61:         address currentPendingAdmin = pendingAdmin;
62:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights
63: 
64:         address previousAdmin = admin;
65:         admin = currentPendingAdmin;
66:         delete pendingAdmin;
67: 
68:         emit NewPendingAdmin(currentPendingAdmin, address(0));
69:         emit NewAdmin(previousAdmin, pendingAdmin);
70:     }
```
[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L57), [60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L60-L70)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

60:     function computeCreate2Address( 
61:         address _sender,
62:         bytes32 _salt,
63:         bytes32 _bytecodeHash,
64:         bytes32 _constructorInputHash
65:     ) internal pure returns (address) {
66:         bytes32 senderBytes = bytes32(uint256(uint160(_sender)));
67:         bytes32 data = keccak256(
68:             bytes.concat(CREATE2_PREFIX, senderBytes, _salt, _bytecodeHash, _constructorInputHash)
69:         );
70: 
71:         return address(uint160(uint256(data)));
72:     }
```
[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L60-L72)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol

33:     function readUint256(bytes memory _bytes, uint256 _start) internal pure returns (uint256 result, uint256 offset) { 
34:         assembly {
35:             offset := add(_start, 32)
36:             result := mload(add(_bytes, offset))
37:         }
38:     }

40:     function readBytes32(bytes memory _bytes, uint256 _start) internal pure returns (bytes32 result, uint256 offset) { 
41:         assembly {
42:             offset := add(_start, 32)
43:             result := mload(add(_bytes, offset))
44:         }
45:     }
```
[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L33-L38), [40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L40-L45)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

110:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { 
111:         // Save previous value into the stack to put it into the event later
112:         address oldPendingAdmin = pendingAdmin;
113:         // Change pending admin
114:         pendingAdmin = _newPendingAdmin;
115:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
116:     }

119:     function acceptAdmin() external { 
120:         address currentPendingAdmin = pendingAdmin;
121:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights
122: 
123:         address previousAdmin = admin;
124:         admin = currentPendingAdmin;
125:         delete pendingAdmin;
126: 
127:         emit NewPendingAdmin(currentPendingAdmin, address(0));
128:         emit NewAdmin(previousAdmin, pendingAdmin);
129:     }

160:     function freezeChain(uint256 _chainId) external onlyOwner { 
161:         IZkSyncStateTransition(stateTransition[_chainId]).freezeDiamond();
162:     }

165:     function unfreezeChain(uint256 _chainId) external onlyOwner { 
166:         IZkSyncStateTransition(stateTransition[_chainId]).freezeDiamond();
167:     }
```
[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L110-L116), [119](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L119-L129), [160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L160-L162), [165](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L165-L167)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

146:     function revertBatches(uint256) external onlyValidator(ERA_CHAIN_ID) { 
147:         _propagateToZkSyncStateTransition(ERA_CHAIN_ID);
148:     }

153:     function revertBatchesSharedBridge(uint256 _chainId, uint256) external onlyValidator(_chainId) { 
154:         _propagateToZkSyncStateTransition(_chainId);
155:     }

160:     function proveBatches( 
161:         StoredBatchInfo calldata,
162:         StoredBatchInfo[] calldata,
163:         ProofInput calldata
164:     ) external onlyValidator(ERA_CHAIN_ID) {
165:         _propagateToZkSyncStateTransition(ERA_CHAIN_ID);
166:     }

171:     function proveBatchesSharedBridge( 
172:         uint256 _chainId,
173:         StoredBatchInfo calldata,
174:         StoredBatchInfo[] calldata,
175:         ProofInput calldata
176:     ) external onlyValidator(_chainId) {
177:         _propagateToZkSyncStateTransition(_chainId);
178:     }
```
[146](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L146-L148), [153](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L153-L155), [160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L160-L166), [171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L171-L178)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

199:     function commitBatches( 
200:         StoredBatchInfo memory _lastCommittedBatchData,
201:         CommitBatchInfo[] calldata _newBatchesData
202:     ) external nonReentrant onlyValidator {
203:         _commitBatches(_lastCommittedBatchData, _newBatchesData);
204:     }

207:     function commitBatchesSharedBridge( 
208:         uint256, // _chainId
209:         StoredBatchInfo memory _lastCommittedBatchData,
210:         CommitBatchInfo[] calldata _newBatchesData
211:     ) external nonReentrant onlyValidator {
212:         _commitBatches(_lastCommittedBatchData, _newBatchesData);
213:     }

337:     function executeBatchesSharedBridge( 
338:         uint256,
339:         StoredBatchInfo[] calldata _batchesData
340:     ) external nonReentrant onlyValidator {
341:         _executeBatches(_batchesData);
342:     }

345:     function executeBatches(StoredBatchInfo[] calldata _batchesData) external nonReentrant onlyValidator { 
346:         _executeBatches(_batchesData);
347:     }

368:     function proveBatches( 
369:         StoredBatchInfo calldata _prevBatch,
370:         StoredBatchInfo[] calldata _committedBatches,
371:         ProofInput calldata _proof
372:     ) external nonReentrant onlyValidator {
373:         _proveBatches(_prevBatch, _committedBatches, _proof);
374:     }

377:     function proveBatchesSharedBridge( 
378:         uint256, // _chainId
379:         StoredBatchInfo calldata _prevBatch,
380:         StoredBatchInfo[] calldata _committedBatches,
381:         ProofInput calldata _proof
382:     ) external nonReentrant onlyValidator {
383:         _proveBatches(_prevBatch, _committedBatches, _proof);
384:     }

472:     function revertBatches(uint256 _newLastBatch) external nonReentrant onlyValidatorOrStateTransitionManager { 
473:         _revertBatches(_newLastBatch);
474:     }

477:     function revertBatchesSharedBridge(uint256, uint256 _newLastBatch) external nonReentrant onlyValidator { 
478:         _revertBatches(_newLastBatch);
479:     }
```
[199](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L199-L204), [207](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L207-L213), [337](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L337-L342), [345](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L345-L347), [368](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L368-L374), [377](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L377-L384), [472](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L472-L474), [477](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L477-L479)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

13:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) { 
14:         super.upgrade(_proposedUpgrade);
15:         return Diamond.DIAMOND_INIT_SUCCESS_RETURN_VALUE;
16:     }
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L13-L16)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

14:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) { 
15:         super.upgrade(_proposedUpgrade);
16:         return Diamond.DIAMOND_INIT_SUCCESS_RETURN_VALUE;
17:     }
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L14-L17)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

28:     function applyL1ToL2Alias(address l1Address) internal pure returns (address l2Address) { 
29:         unchecked {
30:             l2Address = address(uint160(l1Address) + offset);
31:         }
32:     }

38:     function undoL1ToL2Alias(address l2Address) internal pure returns (address l1Address) { 
39:         unchecked {
40:             l1Address = address(uint160(l2Address) - offset);
41:         }
42:     }
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L28-L32), [38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L38-L42)

```solidity
📁 File: contracts/zksync/contracts/L2ContractHelper.sol

101:     function computeCreate2Address( 
102:         address _sender,
103:         bytes32 _salt,
104:         bytes32 _bytecodeHash,
105:         bytes32 _constructorInputHash
106:     ) internal pure returns (address) {
107:         bytes32 senderBytes = bytes32(uint256(uint160(_sender)));
108:         bytes32 data = keccak256(
109:             bytes.concat(CREATE2_PREFIX, senderBytes, _salt, _bytecodeHash, _constructorInputHash)
110:         );
111: 
112:         return address(uint160(uint256(data)));
113:     }
```
[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L101-L113)

```solidity
📁 File: contracts/zksync/contracts/SystemContractsCaller.sol

27:     function safeCastToU32(uint256 _x) internal pure returns (uint32) { 
28:         require(_x <= type(uint32).max, "Overflow");
29: 
30:         return uint32(_x);
31:     }

76:     function systemCallWithReturndata( 
77:         uint32 gasLimit,
78:         address to,
79:         uint128 value,
80:         bytes memory data
81:     ) internal returns (bool success, bytes memory returnData) {
82:         success = systemCall(gasLimit, to, value, data);
83: 
84:         uint256 size;
85:         assembly {
86:             size := returndatasize()
87:         }
88: 
89:         returnData = new bytes(size);
90:         assembly {
91:             returndatacopy(add(returnData, 0x20), 0, size)
92:         }
93:     }

95:     function getFarCallABI( 
96:         uint32 dataOffset,
97:         uint32 memoryPage,
98:         uint32 dataStart,
99:         uint32 dataLength,
100:         uint32 gasPassed,
101:         uint8 shardId,
102:         CalldataForwardingMode forwardingMode,
103:         bool isConstructorCall,
104:         bool isSystemCall
105:     ) internal pure returns (uint256 farCallAbi) {
106:         // Fill in the call parameter fields
107:         farCallAbi = getFarCallABIWithEmptyFatPointer(
108:             gasPassed,
109:             shardId,
110:             forwardingMode,
111:             isConstructorCall,
112:             isSystemCall
113:         );
114:         // Fill in the fat pointer fields
115:         farCallAbi |= dataOffset;
116:         farCallAbi |= (uint256(memoryPage) << 32);
117:         farCallAbi |= (uint256(dataStart) << 64);
118:         farCallAbi |= (uint256(dataLength) << 96);
119:     }

121:     function getFarCallABIWithEmptyFatPointer( 
122:         uint32 gasPassed,
123:         uint8 shardId,
124:         CalldataForwardingMode forwardingMode,
125:         bool isConstructorCall,
126:         bool isSystemCall
127:     ) internal pure returns (uint256 farCallAbiWithEmptyFatPtr) {
128:         farCallAbiWithEmptyFatPtr |= (uint256(gasPassed) << 192);
129:         farCallAbiWithEmptyFatPtr |= (uint256(forwardingMode) << 224);
130:         farCallAbiWithEmptyFatPtr |= (uint256(shardId) << 232);
131:         if (isConstructorCall) {
132:             farCallAbiWithEmptyFatPtr |= (1 << 240);
133:         }
134:         if (isSystemCall) {
135:             farCallAbiWithEmptyFatPtr |= (1 << 248);
136:         }
137:     }
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L27-L31), [76](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L76-L93), [95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L95-L119), [121](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L121-L137)

```solidity
📁 File: contracts/zksync/contracts/vendor/AddressAliasHelper.sol

28:     function applyL1ToL2Alias(address l1Address) internal pure returns (address l2Address) { 
29:         unchecked {
30:             l2Address = address(uint160(l1Address) + offset);
31:         }
32:     }

38:     function undoL1ToL2Alias(address l2Address) internal pure returns (address l1Address) { 
39:         unchecked {
40:             l1Address = address(uint160(l2Address) - offset);
41:         }
42:     }
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L28-L32), [38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L38-L42)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractsCaller.sol

123:     function systemCallWithReturndata( 
124:         uint32 gasLimit,
125:         address to,
126:         uint128 value,
127:         bytes memory data
128:     ) internal returns (bool success, bytes memory returnData) {
129:         success = systemCall(gasLimit, to, value, data);
130: 
131:         uint256 size;
132:         assembly {
133:             size := returndatasize()
134:         }
135: 
136:         returnData = new bytes(size);
137:         assembly {
138:             returndatacopy(add(returnData, 0x20), 0, size)
139:         }
140:     }

214:     function getFarCallABI( 
215:         uint32 dataOffset,
216:         uint32 memoryPage,
217:         uint32 dataStart,
218:         uint32 dataLength,
219:         uint32 gasPassed,
220:         uint8 shardId,
221:         CalldataForwardingMode forwardingMode,
222:         bool isConstructorCall,
223:         bool isSystemCall
224:     ) internal pure returns (uint256 farCallAbi) {
225:         // Fill in the call parameter fields
226:         farCallAbi = getFarCallABIWithEmptyFatPointer(
227:             gasPassed,
228:             shardId,
229:             forwardingMode,
230:             isConstructorCall,
231:             isSystemCall
232:         );
233:         // Fill in the fat pointer fields
234:         farCallAbi |= dataOffset;
235:         farCallAbi |= (uint256(memoryPage) << 32);
236:         farCallAbi |= (uint256(dataStart) << 64);
237:         farCallAbi |= (uint256(dataLength) << 96);
238:     }

250:     function getFarCallABIWithEmptyFatPointer( 
251:         uint32 gasPassed,
252:         uint8 shardId,
253:         CalldataForwardingMode forwardingMode,
254:         bool isConstructorCall,
255:         bool isSystemCall
256:     ) internal pure returns (uint256 farCallAbiWithEmptyFatPtr) {
257:         farCallAbiWithEmptyFatPtr |= (uint256(gasPassed) << 192);
258:         farCallAbiWithEmptyFatPtr |= (uint256(forwardingMode) << 224);
259:         farCallAbiWithEmptyFatPtr |= (uint256(shardId) << 232);
260:         if (isConstructorCall) {
261:             farCallAbiWithEmptyFatPtr |= (1 << 240);
262:         }
263:         if (isSystemCall) {
264:             farCallAbiWithEmptyFatPtr |= (1 << 248);
265:         }
266:     }
```
[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L123-L140), [214](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L214-L238), [250](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L250-L266)

```solidity
📁 File: system-contracts/contracts/libraries/UnsafeBytesCalldata.sol

40:     function readBytes32(bytes calldata _bytes, uint256 _start) internal pure returns (bytes32 result) { 
41:         assembly {
42:             result := calldataload(add(_bytes.offset, _start))
43:         }
44:     }

46:     function readUint256(bytes calldata _bytes, uint256 _start) internal pure returns (uint256 result) { 
47:         assembly {
48:             result := calldataload(add(_bytes.offset, _start))
49:         }
50:     }
```
[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L40-L44), [46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L46-L50)

```solidity
📁 File: system-contracts/contracts/libraries/Utils.sol

26:     function safeCastToU32(uint256 _x) internal pure returns (uint32) { 
27:         require(_x <= type(uint32).max, "Overflow");
28: 
29:         return uint32(_x);
30:     }
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L26-L30)

</details>


---
### [NC&#x2011;55] Functions not used internally could be marked external
Contracts [are allowed](https://docs.soliditylang.org/en/latest/contracts.html#function-overriding) to override their parents' functions and change the visibility from `external` to `public`.

<details>
<summary><i>There are 15 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

54:     function proveL2MessageInclusion( 
55:         uint256 _batchNumber,
56:         uint256 _index,
57:         L2Message memory _message,
58:         bytes32[] calldata _proof
59:     ) public view returns (bool) {

74:     function proveL1ToL2TransactionStatus( 
75:         bytes32 _l2TxHash,
76:         uint256 _l2BatchNumber,
77:         uint256 _l2MessageIndex,
78:         uint16 _l2TxNumberInBatch,
79:         bytes32[] calldata _merkleProof,
80:         TxStatus _status
81:     ) public view returns (bool) {

143:     function l2TransactionBaseCost( 
144:         uint256 _gasPrice,
145:         uint256 _l2GasLimit,
146:         uint256 _l2GasPerPubdataByteLimit
147:     ) public view returns (uint256) {
```
[54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L54-L59), [74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L74-L81), [143](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L143-L147)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

13:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) { 
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L13)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

14:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) { 
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L14)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

159:     function name() public view override returns (string memory) { 

165:     function symbol() public view override returns (string memory) { 

171:     function decimals() public view override returns (uint8) { 
```
[159](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L159), [165](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L165), [171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L171)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

40:     function extendedAccountVersion(address _address) public view returns (AccountAbstractionVersion) { 
```
[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L40)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

57:     function getRawNonce(address _address) public view returns (uint256) { 

65:     function increaseMinNonce(uint256 _value) public onlySystemCall returns (uint256 oldMinNonce) { 

82:     function setValueUnderNonce(uint256 _key, uint256 _value) public onlySystemCall { 

102:     function getValueUnderNonce(uint256 _key) public view returns (uint256) { 
```
[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L57), [65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L65), [82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L82), [102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L102)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

190:     function getBlockNumber() public view returns (uint128) { 

198:     function getBlockTimestamp() public view returns (uint128) { 
```
[190](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L190), [198](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L198)

</details>


---
### [NC&#x2011;56] Functions should be named in mixedCase style
According to the Solidity [style guide](https://docs.soliditylang.org/en/latest/style-guide.html#function-names) function names should be in `mixedCase` (lowerCamelCase)Rule exceptions
- Allow `_` at the beginning of the mixedCase match for `private`/`internal` functions.

<details>
<summary><i>There are 13 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

/// @audit _L2MessageToLog
130:     function _L2MessageToLog(L2Message memory _message) internal pure returns (L2Log memory) { 
```
[130](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L130)

```solidity
📁 File: contracts/zksync/contracts/SystemContractsCaller.sol

/// @audit getFarCallABI
95:     function getFarCallABI( 

/// @audit getFarCallABIWithEmptyFatPointer
121:     function getFarCallABIWithEmptyFatPointer( 
```
[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L95), [121](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L121)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

/// @audit encodeEIP2930TransactionHash
139:     function encodeEIP2930TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) { 

/// @audit encodeEIP1559TransactionHash
229:     function encodeEIP1559TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) { 
```
[139](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L139), [229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L229)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

/// @audit getBlockHashEVM
132:     function getBlockHashEVM(uint256 _block) external view returns (bytes32 hash) { 
```
[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L132)

```solidity
📁 File: system-contracts/contracts/interfaces/ISystemContext.sol

/// @audit getBlockHashEVM
46:     function getBlockHashEVM(uint256 _block) external view returns (bytes32); 
```
[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContext.sol#L46)

```solidity
📁 File: system-contracts/contracts/libraries/EfficientCall.sol

/// @audit _loadFarCallABIIntoActivePtr
245:     function _loadFarCallABIIntoActivePtr( 
```
[245](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L245)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractsCaller.sol

/// @audit getFarCallABI
214:     function getFarCallABI( 

/// @audit getFarCallABIWithEmptyFatPointer
250:     function getFarCallABIWithEmptyFatPointer( 
```
[214](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L214), [250](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L250)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

/// @audit _encodeHashEIP712Transaction
118:     function _encodeHashEIP712Transaction(Transaction calldata _transaction) private view returns (bytes32) { 

/// @audit _encodeHashEIP2930Transaction
219:     function _encodeHashEIP2930Transaction(Transaction calldata _transaction) private view returns (bytes32) { 

/// @audit _encodeHashEIP1559Transaction
289:     function _encodeHashEIP1559Transaction(Transaction calldata _transaction) private view returns (bytes32) { 
```
[118](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L118), [219](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L219), [289](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L289)

</details>


---
### [NC&#x2011;57] High cyclomatic complexity
Functions with high cyclomatic complexity are harder to understand, test, and maintain. Consider breaking down these blocks into more manageable units, by splitting things into utility functions, by reducing nesting, and by using early returns.

[Learn More About Cyclomatic Complexity](https://en.wikipedia.org/wiki/Cyclomatic_complexity)

<details>
<summary><i>There are 7 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

130:     function _processL2Logs( 
131:         CommitBatchInfo calldata _newBatch,
132:         bytes32 _expectedSystemContractUpgradeTxHash
133:     ) internal pure returns (LogProcessingOutput memory logOutput) {
```
[130](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L130-L133)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

24:     function getTransactionHashes( 
25:         Transaction calldata _transaction
26:     ) external view override returns (bytes32 txHash, bytes32 signedTxHash) {
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L24-L26)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

110:     function verifyCompressedStateDiffs( 
111:         uint256 _numberOfStateDiffs,
112:         uint256 _enumerationIndexSize,
113:         bytes calldata _stateDiffs,
114:         bytes calldata _compressedStateDiffs
115:     ) external payable onlyCallFrom(address(L1_MESSENGER_CONTRACT)) returns (bytes32 stateDiffHash) {
```
[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L110-L115)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

263:     function _setVirtualBlock( 
264:         uint128 _l2BlockNumber,
265:         uint128 _maxVirtualBlocksToCreate,
266:         uint128 _newTimestamp
267:     ) internal {

341:     function setL2Block( 
342:         uint128 _l2BlockNumber,
343:         uint128 _l2BlockTimestamp,
344:         bytes32 _expectedPrevL2BlockHash,
345:         bool _isFirstInBatch,
346:         uint128 _maxVirtualBlocksToCreate
347:     ) external onlyCallFromBootloader {
```
[263](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L263-L267), [341](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L341-L347)

```solidity
📁 File: system-contracts/contracts/libraries/RLPEncoder.sol

84:     function _highestByteSet(uint256 _number) private pure returns (uint256 hbs) { 
```
[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L84)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

100:     function encodeHash(Transaction calldata _transaction) internal view returns (bytes32 resultHash) { 
```
[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L100)

</details>


---
### [NC&#x2011;58] `if`-statement can be converted to a ternary
The code can be made more compact while also increasing readability by converting the following `if`-statements to ternaries (e.g. `foo += (x > y) ? a : b`)

<details>
<summary><i>There are 4 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

222:             if (token == ETH_TOKEN_ADDRESS) { 
223:                 require(msg.value == _request.mintValue, "Bridgehub: msg.value mismatch 1");
224:             } else {
225:                 require(msg.value == 0, "Bridgehub: non-eth bridge with msg.value");
226:             }
```
[222](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L222-L226)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

191:         if (_expectedSystemContractUpgradeTxHash == bytes32(0)) { 
192:             require(processedLogs == 511, "b7");
193:         } else {
194:             require(processedLogs == 1023, "b8");
195:         }

237:         if (systemContractsUpgradeTxHash == bytes32(0) || s.l2SystemContractsUpgradeBatchNumber != 0) { 
238:             _commitBatchesWithoutSystemContractsUpgrade(_lastCommittedBatchData, _newBatchesData);
239:         } else {
240:             _commitBatchesWithSystemContractsUpgrade(
241:                 _lastCommittedBatchData,
242:                 _newBatchesData,
243:                 systemContractsUpgradeTxHash
244:             );
245:         }
```
[191](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L191-L195), [237](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L237-L245)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

406:         if (address(uint160(_transaction.paymaster)) != address(0)) { 
407:             // Paymaster pays for the fee
408:             requiredBalance = _transaction.value;
409:         } else {
410:             // The user should have enough balance for both the fee and the value of the transaction
411:             requiredBalance = _transaction.maxFeePerGas * _transaction.gasLimit + _transaction.value;
412:         }
```
[406](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L406-L412)

</details>


---
### [NC&#x2011;59] Import declarations should import specific identifiers, rather than the whole file
Using import declarations of the form `import {<identifier_name>} from "some/file.sol"` avoids polluting the symbol namespace making flattened files smaller, and speeds up compilation (but does not save any gas)

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol

5: import "./IL1SharedBridge.sol"; 
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L5)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

7: import "./IBridgehub.sol"; 
8: import "../bridge/interfaces/IL1SharedBridge.sol";
9: import "../state-transition/IStateTransitionManager.sol";
10: import "../common/ReentrancyGuard.sol";
11: import "../state-transition/chain-interfaces/IZkSyncStateTransition.sol";

14: import "../vendor/AddressAliasHelper.sol"; 
```
[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L7-L11), [14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L14)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

6: import "../common/Messaging.sol"; 
7: import "../state-transition/IStateTransitionManager.sol";
8: import "../state-transition/libraries/Diamond.sol";
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L6-L8)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

12: import "../l2-deps/ISystemContext.sol"; 
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L12)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol

13: import "../libraries/Diamond.sol"; 
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L13)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

5: import "../state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol"; 
6: import "../state-transition/chain-interfaces/IMailbox.sol";
7: import "../state-transition/chain-interfaces/IVerifier.sol";
8: import "../common/libraries/L2ContractHelper.sol";
9: import "../common/Messaging.sol";
10: import "../state-transition/libraries/TransactionValidator.sol";
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L5-L10)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

5: import "../state-transition/libraries/Diamond.sol"; 
6: import "./BaseZkSyncUpgradeGenesis.sol";
7: import "./IDefaultUpgrade.sol";
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L5-L7)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

5: import "./interfaces/IAccountCodeStorage.sol"; 
6: import "./libraries/Utils.sol";
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L5-L6)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

5: import "./interfaces/IAccount.sol"; 
6: import "./libraries/TransactionHelper.sol";
7: import "./libraries/SystemContractHelper.sol";
8: import "./libraries/EfficientCall.sol";
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L5-L8)

```solidity
📁 File: system-contracts/contracts/interfaces/IAccount.sol

5: import "../libraries/TransactionHelper.sol"; 
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IAccount.sol#L5)

```solidity
📁 File: system-contracts/contracts/interfaces/IBootloaderUtilities.sol

5: import "../libraries/TransactionHelper.sol"; 
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBootloaderUtilities.sol#L5)

```solidity
📁 File: system-contracts/contracts/interfaces/IPaymaster.sol

5: import "../libraries/TransactionHelper.sol"; 
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IPaymaster.sol#L5)

```solidity
📁 File: system-contracts/contracts/libraries/EfficientCall.sol

5: import "./SystemContractHelper.sol"; 
6: import "./Utils.sol";
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L5-L6)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractsCaller.sol

6: import "./Utils.sol"; 
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L6)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

5: import "../openzeppelin/token/ERC20/IERC20.sol"; 
6: import "../openzeppelin/token/ERC20/utils/SafeERC20.sol";

8: import "../interfaces/IPaymasterFlow.sol"; 
9: import "../interfaces/IContractDeployer.sol";

11: import "./RLPEncoder.sol"; 
12: import "./EfficientCall.sol";
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L5-L6), [8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L8-L9), [11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L11-L12)

```solidity
📁 File: system-contracts/contracts/libraries/Utils.sol

4: import "./EfficientCall.sol"; 
```
[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L4)

</details>


---
### [NC&#x2011;60] Imports could be organized more systematically
The contract's interface should be imported first, followed by each of the interfaces it uses, followed by all other files. The examples below do not follow this layout.

<details>
<summary><i>There are 22 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

3: pragma solidity 0.8.20; 
4: 
5: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol";
6: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
7: 
8: import {IL1ERC20Bridge} from "./interfaces/IL1ERC20Bridge.sol";
9: import {IL1SharedBridge} from "./interfaces/IL1SharedBridge.sol";
10: 
11: import {L2ContractHelper} from "../common/libraries/L2ContractHelper.sol";
12: import {ReentrancyGuard} from "../common/ReentrancyGuard.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L3-L12)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

3: pragma solidity 0.8.20; 
4: 
5: import {Initializable} from "@openzeppelin/contracts/proxy/utils/Initializable.sol";
6: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";
7: 
8: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol";
9: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol";
10: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
11: 
12: import {IL1ERC20Bridge} from "./interfaces/IL1ERC20Bridge.sol";
13: import {IL1SharedBridge} from "./interfaces/IL1SharedBridge.sol";
14: import {IL2Bridge} from "./interfaces/IL2Bridge.sol";
15: 
16: import {IMailbox} from "../state-transition/chain-interfaces/IMailbox.sol";
17: import {L2Message, TxStatus} from "../common/Messaging.sol";
18: import {UnsafeBytes} from "../common/libraries/UnsafeBytes.sol";
19: import {ReentrancyGuard} from "../common/ReentrancyGuard.sol";
20: import {AddressAliasHelper} from "../vendor/AddressAliasHelper.sol";
21: import {ERA_CHAIN_ID, ERA_ERC20_BRIDGE_ADDRESS, ETH_TOKEN_ADDRESS, ERA_DIAMOND_PROXY, TWO_BRIDGES_MAGIC_VALUE} from "../common/Config.sol";
22: import {IBridgehub, L2TransactionRequestTwoBridgesInner, L2TransactionRequestDirect} from "../bridgehub/IBridgehub.sol";
23: import {IGetters} from "../state-transition/chain-interfaces/IGetters.sol";
24: import {L2_BASE_TOKEN_SYSTEM_CONTRACT_ADDR} from "../common/L2ContractAddresses.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L3-L24)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

3: pragma solidity 0.8.20; 
4: 
5: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";
6: 
7: import "./IBridgehub.sol";
8: import "../bridge/interfaces/IL1SharedBridge.sol";
9: import "../state-transition/IStateTransitionManager.sol";
10: import "../common/ReentrancyGuard.sol";
11: import "../state-transition/chain-interfaces/IZkSyncStateTransition.sol";
12: import {ETH_TOKEN_ADDRESS, TWO_BRIDGES_MAGIC_VALUE, BRIDGEHUB_MIN_SECOND_BRIDGE_ADDRESS} from "../common/Config.sol";
13: import {BridgehubL2TransactionRequest} from "../common/Messaging.sol";
14: import "../vendor/AddressAliasHelper.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L3-L14)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

3: pragma solidity 0.8.20; 
4: 
5: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";
6: import {IGovernance} from "./IGovernance.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L3-L6)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

3: pragma solidity 0.8.20; 
4: 
5: import {Diamond} from "./libraries/Diamond.sol";
6: import {DiamondProxy} from "./chain-deps/DiamondProxy.sol";
7: import {IAdmin} from "./chain-interfaces/IAdmin.sol";
8: import {IDefaultUpgrade} from "../upgrades/IDefaultUpgrade.sol";
9: import {IDiamondInit} from "./chain-interfaces/IDiamondInit.sol";
10: import {IExecutor} from "./chain-interfaces/IExecutor.sol";
11: import {IStateTransitionManager, StateTransitionManagerInitializeData} from "./IStateTransitionManager.sol";
12: import {ISystemContext} from "./l2-deps/ISystemContext.sol";
13: import {IZkSyncStateTransition} from "./chain-interfaces/IZkSyncStateTransition.sol";
14: import {L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, L2_FORCE_DEPLOYER_ADDR} from "../common/L2ContractAddresses.sol";
15: import {L2CanonicalTransaction} from "../common/Messaging.sol";
16: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";
17: import {ProposedUpgrade} from "../upgrades/BaseZkSyncUpgrade.sol";
18: import {ReentrancyGuard} from "../common/ReentrancyGuard.sol";
19: import {REQUIRED_L2_GAS_PRICE_PER_PUBDATA, L2_TO_L1_LOG_SERIALIZE_SIZE, DEFAULT_L2_LOGS_TREE_ROOT_HASH, EMPTY_STRING_KECCAK, SYSTEM_UPGRADE_L2_TX_TYPE, ERA_DIAMOND_PROXY, ERA_CHAIN_ID} from "../common/Config.sol";
20: import {VerifierParams} from "./chain-interfaces/IVerifier.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L3-L20)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

3: pragma solidity 0.8.20; 
4: 
5: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";
6: import {LibMap} from "./libraries/LibMap.sol";
7: import {IExecutor} from "./chain-interfaces/IExecutor.sol";
8: import {IStateTransitionManager} from "./IStateTransitionManager.sol";
9: import {ERA_CHAIN_ID} from "../common/Config.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L3-L9)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

3: pragma solidity 0.8.20; 
4: 
5: import {Diamond} from "../libraries/Diamond.sol";
6: import {ZkSyncStateTransitionBase} from "./facets/ZkSyncStateTransitionBase.sol";
7: import {FeeParams} from "./ZkSyncStateTransitionStorage.sol";
8: import {L2_TO_L1_LOG_SERIALIZE_SIZE, MAX_GAS_PER_TRANSACTION} from "../../common/Config.sol";
9: import {InitializeData, IDiamondInit} from "../chain-interfaces/IDiamondInit.sol";
10: import {VerifierParams} from "../chain-interfaces/IVerifier.sol";
11: 
12: import "../l2-deps/ISystemContext.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L3-L12)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

3: pragma solidity 0.8.20; 
4: 
5: import {IAdmin} from "../../chain-interfaces/IAdmin.sol";
6: import {Diamond} from "../../libraries/Diamond.sol";
7: import {MAX_GAS_PER_TRANSACTION} from "../../../common/Config.sol";
8: import {FeeParams, PubdataPricingMode} from "../ZkSyncStateTransitionStorage.sol";
9: import {ZkSyncStateTransitionBase} from "./ZkSyncStateTransitionBase.sol";
10: import {IStateTransitionManager} from "../../IStateTransitionManager.sol";
11: 
12: // While formally the following import is not used, it is needed to inherit documentation from it
13: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L3-L13)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

3: pragma solidity 0.8.20; 
4: 
5: import {ZkSyncStateTransitionBase} from "./ZkSyncStateTransitionBase.sol";
6: import {COMMIT_TIMESTAMP_NOT_OLDER, COMMIT_TIMESTAMP_APPROXIMATION_DELTA, EMPTY_STRING_KECCAK, L2_TO_L1_LOG_SERIALIZE_SIZE, MAX_L2_TO_L1_LOGS_COMMITMENT_BYTES, PACKED_L2_BLOCK_TIMESTAMP_MASK, PUBLIC_INPUT_SHIFT, POINT_EVALUATION_PRECOMPILE_ADDR} from "../../../common/Config.sol";
7: import {IExecutor, L2_LOG_ADDRESS_OFFSET, L2_LOG_KEY_OFFSET, L2_LOG_VALUE_OFFSET, SystemLogKey, LogProcessingOutput, PubdataSource, BLS_MODULUS, PUBDATA_COMMITMENT_SIZE, PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET, PUBDATA_COMMITMENT_COMMITMENT_OFFSET, MAX_NUMBER_OF_BLOBS, TOTAL_BLOBS_IN_COMMITMENT} from "../../chain-interfaces/IExecutor.sol";
8: import {PriorityQueue, PriorityOperation} from "../../libraries/PriorityQueue.sol";
9: import {UncheckedMath} from "../../../common/libraries/UncheckedMath.sol";
10: import {UnsafeBytes} from "../../../common/libraries/UnsafeBytes.sol";
11: import {VerifierParams} from "../../chain-interfaces/IVerifier.sol";
12: import {L2_BOOTLOADER_ADDRESS, L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, L2_PUBDATA_CHUNK_PUBLISHER_ADDR} from "../../../common/L2ContractAddresses.sol";
13: import {PubdataPricingMode} from "../ZkSyncStateTransitionStorage.sol";
14: import {IStateTransitionManager} from "../../IStateTransitionManager.sol";
15: 
16: // While formally the following import is not used, it is needed to inherit documentation from it
17: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L3-L17)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

3: pragma solidity 0.8.20; 
4: 
5: import {ZkSyncStateTransitionBase} from "./ZkSyncStateTransitionBase.sol";
6: import {PubdataPricingMode} from "../ZkSyncStateTransitionStorage.sol";
7: import {VerifierParams} from "../../../state-transition/chain-interfaces/IVerifier.sol";
8: import {Diamond} from "../../libraries/Diamond.sol";
9: import {PriorityQueue, PriorityOperation} from "../../../state-transition/libraries/PriorityQueue.sol";
10: import {UncheckedMath} from "../../../common/libraries/UncheckedMath.sol";
11: import {IGetters} from "../../chain-interfaces/IGetters.sol";
12: import {ILegacyGetters} from "../../chain-interfaces/ILegacyGetters.sol";
13: 
14: // While formally the following import is not used, it is needed to inherit documentation from it
15: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L3-L15)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

3: pragma solidity 0.8.20; 
4: 
5: import {Math} from "@openzeppelin/contracts/utils/math/Math.sol";
6: 
7: import {IMailbox} from "../../chain-interfaces/IMailbox.sol";
8: import {Merkle} from "../../libraries/Merkle.sol";
9: import {PriorityQueue, PriorityOperation} from "../../libraries/PriorityQueue.sol";
10: import {TransactionValidator} from "../../libraries/TransactionValidator.sol";
11: import {WritePriorityOpParams, L2CanonicalTransaction, L2Message, L2Log, TxStatus, BridgehubL2TransactionRequest} from "../../../common/Messaging.sol";
12: import {FeeParams, PubdataPricingMode} from "../ZkSyncStateTransitionStorage.sol";
13: import {UncheckedMath} from "../../../common/libraries/UncheckedMath.sol";
14: import {UnsafeBytes} from "../../../common/libraries/UnsafeBytes.sol";
15: import {L2ContractHelper} from "../../../common/libraries/L2ContractHelper.sol";
16: import {AddressAliasHelper} from "../../../vendor/AddressAliasHelper.sol";
17: import {ZkSyncStateTransitionBase} from "./ZkSyncStateTransitionBase.sol";
18: import {REQUIRED_L2_GAS_PRICE_PER_PUBDATA, L1_GAS_PER_PUBDATA_BYTE, L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH, PRIORITY_OPERATION_L2_TX_TYPE, PRIORITY_EXPIRATION, MAX_NEW_FACTORY_DEPS, ETH_TOKEN_ADDRESS, ERA_CHAIN_ID} from "../../../common/Config.sol";
19: import {L2_BOOTLOADER_ADDRESS, L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, L2_BASE_TOKEN_SYSTEM_CONTRACT_ADDR} from "../../../common/L2ContractAddresses.sol";
20: 
21: import {IBridgehub} from "../../../bridgehub/IBridgehub.sol";
22: import {IL1SharedBridge} from "../../../bridge/interfaces/IL1SharedBridge.sol";
23: 
24: // While formally the following import is not used, it is needed to inherit documentation from it
25: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L3-L25)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol

3: pragma solidity 0.8.20; 
4: 
5: import {ZkSyncStateTransitionStorage} from "../ZkSyncStateTransitionStorage.sol";
6: import {ReentrancyGuard} from "../../../common/ReentrancyGuard.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L3-L6)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol

3: pragma solidity 0.8.20; 
4: 
5: import {PriorityOperation} from "../libraries/PriorityQueue.sol";
6: import {VerifierParams} from "../chain-interfaces/IVerifier.sol";
7: import {PubdataPricingMode} from "../chain-deps/ZkSyncStateTransitionStorage.sol";
8: import {IZkSyncStateTransitionBase} from "./IZkSyncStateTransitionBase.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L3-L8)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

3: pragma solidity 0.8.20; 
4: 
5: import "../state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol";
6: import "../state-transition/chain-interfaces/IMailbox.sol";
7: import "../state-transition/chain-interfaces/IVerifier.sol";
8: import "../common/libraries/L2ContractHelper.sol";
9: import "../common/Messaging.sol";
10: import "../state-transition/libraries/TransactionValidator.sol";
11: import {MAX_NEW_FACTORY_DEPS, SYSTEM_UPGRADE_L2_TX_TYPE, MAX_ALLOWED_PROTOCOL_VERSION_DELTA} from "../common/Config.sol";
12: import {ProposedUpgrade, BaseZkSyncUpgrade} from "./BaseZkSyncUpgrade.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L3-L12)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

3: pragma solidity 0.8.20; 
4: 
5: import {Diamond} from "../state-transition/libraries/Diamond.sol";
6: import {BaseZkSyncUpgrade, ProposedUpgrade} from "./BaseZkSyncUpgrade.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L3-L6)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

3: pragma solidity 0.8.20; 
4: 
5: import "../state-transition/libraries/Diamond.sol";
6: import "./BaseZkSyncUpgradeGenesis.sol";
7: import "./IDefaultUpgrade.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L3-L7)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

3: pragma solidity 0.8.20; 
4: 
5: import {Initializable} from "@openzeppelin/contracts/proxy/utils/Initializable.sol";
6: import {BeaconProxy} from "@openzeppelin/contracts/proxy/beacon/BeaconProxy.sol";
7: import {UpgradeableBeacon} from "@openzeppelin/contracts/proxy/beacon/UpgradeableBeacon.sol";
8: 
9: import {IL1ERC20Bridge} from "./interfaces/IL1ERC20Bridge.sol";
10: import {IL2SharedBridge} from "./interfaces/IL2SharedBridge.sol";
11: import {IL2StandardToken} from "./interfaces/IL2StandardToken.sol";
12: 
13: import {L2StandardERC20} from "./L2StandardERC20.sol";
14: import {AddressAliasHelper} from "../vendor/AddressAliasHelper.sol";
15: import {L2ContractHelper, DEPLOYER_SYSTEM_CONTRACT, L2_BASE_TOKEN_ADDRESS, IContractDeployer} from "../L2ContractHelper.sol";
16: import {SystemContractsCaller} from "../SystemContractsCaller.sol";
17: import {ERA_CHAIN_ID, ERA_WETH_ADDRESS} from "../Config.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L3-L17)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

3: pragma solidity 0.8.20; 
4: 
5: import {ERC20PermitUpgradeable} from "@openzeppelin/contracts-upgradeable/token/ERC20/extensions/draft-ERC20PermitUpgradeable.sol";
6: import {UpgradeableBeacon} from "@openzeppelin/contracts/proxy/beacon/UpgradeableBeacon.sol";
7: import {ERC1967Upgrade} from "@openzeppelin/contracts/proxy/ERC1967/ERC1967Upgrade.sol";
8: 
9: import {IL2StandardToken} from "./interfaces/IL2StandardToken.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L3-L9)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

3: pragma solidity 0.8.20; 
4: 
5: import {ImmutableData} from "./interfaces/IImmutableSimulator.sol";
6: import {IContractDeployer} from "./interfaces/IContractDeployer.sol";
7: import {CREATE2_PREFIX, CREATE_PREFIX, NONCE_HOLDER_SYSTEM_CONTRACT, ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT, FORCE_DEPLOYER, MAX_SYSTEM_CONTRACT_ADDRESS, KNOWN_CODE_STORAGE_CONTRACT, BASE_TOKEN_SYSTEM_CONTRACT, IMMUTABLE_SIMULATOR_SYSTEM_CONTRACT, COMPLEX_UPGRADER_CONTRACT, KECCAK256_SYSTEM_CONTRACT} from "./Constants.sol";
8: 
9: import {Utils} from "./libraries/Utils.sol";
10: import {EfficientCall} from "./libraries/EfficientCall.sol";
11: import {SystemContractHelper} from "./libraries/SystemContractHelper.sol";
12: import {ISystemContract} from "./interfaces/ISystemContract.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L3-L12)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

3: pragma solidity 0.8.20; 
4: 
5: import {Utils} from "./libraries/Utils.sol";
6: import {EfficientCall} from "./libraries/EfficientCall.sol";
7: import {ISystemContract} from "./interfaces/ISystemContract.sol";
8: import {SystemContractHelper} from "./libraries/SystemContractHelper.sol";
9: import {MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT, REAL_BASE_TOKEN_SYSTEM_CONTRACT} from "./Constants.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L3-L9)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

3: pragma solidity 0.8.20; 
4: 
5: import {INonceHolder} from "./interfaces/INonceHolder.sol";
6: import {IContractDeployer} from "./interfaces/IContractDeployer.sol";
7: import {ISystemContract} from "./interfaces/ISystemContract.sol";
8: import {DEPLOYER_SYSTEM_CONTRACT} from "./Constants.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L3-L8)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

3: pragma solidity 0.8.20; 
4: 
5: import {ISystemContext} from "./interfaces/ISystemContext.sol";
6: import {ISystemContract} from "./interfaces/ISystemContract.sol";
7: import {ISystemContextDeprecated} from "./interfaces/ISystemContextDeprecated.sol";
8: import {SystemContractHelper} from "./libraries/SystemContractHelper.sol";
9: import {BOOTLOADER_FORMAL_ADDRESS, SystemLogKey} from "./Constants.sol";
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L3-L9)

</details>


---
### [NC&#x2011;61] Inconsistent spacing in comments
Some lines use `// x` and some use `//x`. The instances below point out the usages that don't follow the majority, within each file

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit Space: `5`
/// @audit No space: `72`
1: // SPDX-License-Identifier: MIT 

14: /// @author Matter Labs 
15: /// @custom:security-contact security@matterlabs.dev
16: /// @notice Smart contract that allows depositing ERC20 tokens from Ethereum to hyperchains
17: /// @dev It is a legacy bridge from zkSync Era, that was deprecated in favour of shared bridge.
18: /// It is needed for backward compatibility with already integrated projects.
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L1), [14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L14-L18)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit Space: `4`
/// @audit No space: `142`
1: // SPDX-License-Identifier: MIT 

26: /// @author Matter Labs 
27: /// @custom:security-contact security@matterlabs.dev
28: /// @dev Bridges assets between L1 and hyperchains, supporting both ETH and ERC20 tokens.
29: /// @dev Designed for use with a proxy for upgradability.
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L1), [26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L26-L29)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

/// @audit Space: `11`
/// @audit No space: `79`
1: // SPDX-License-Identifier: MIT 

8: /// @author Matter Labs 
9: /// @custom:security-contact security@matterlabs.dev
10: /// @dev Contract design is inspired by OpenZeppelin TimelockController and in-house Diamond Proxy upgrade mechanism.
11: /// @notice This contract manages operations (calls with preconditions) for governance tasks.
12: /// The contract allows for operations to be scheduled, executed, and canceled with
13: /// appropriate permissions and delays. It is used for managing and coordinating upgrades
14: /// and changes in all zkSync hyperchain governed contracts.

16: /// Operations can be proposed as either fully transparent upgrades with on-chain data, 
17: /// or "shadow" upgrades where upgrade data is not published on-chain before execution. Proposed operations
18: /// are subject to a delay before they can be executed, but they can be executed instantly
19: /// with the security council’s permission.
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L1), [8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L8-L14), [16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L16-L19)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit Space: `3`
/// @audit No space: `41`
1: // SPDX-License-Identifier: MIT 

22: /// @title StateTransition contract 
23: /// @author Matter Labs
24: /// @custom:security-contact security@matterlabs.dev
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L1), [22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L22-L24)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit Space: `11`
/// @audit No space: `58`
1: // SPDX-License-Identifier: MIT 

11: /// @author Matter Labs 
12: /// @custom:security-contact security@matterlabs.dev
13: /// @notice Intermediate smart contract between the validator EOA account and the hyperchains state transition diamond smart contract.
14: /// @dev The primary purpose of this contract is to provide a trustless means of delaying batch execution without
15: /// modifying the main hyperchain diamond contract. As such, even if this contract is compromised, it will not impact the main
16: /// contract.
17: /// @dev zkSync actively monitors the chain activity and reacts to any suspicious activity by freezing the chain.
18: /// This allows time for investigation and mitigation before resuming normal operations.
19: /// @dev The contract overloads all of the 4 methods, that are used in state transition. When the batch is committed,
20: /// the timestamp is stored for it. Later, when the owner calls the batch execution, the contract checks that batch
21: /// was committed not earlier than X time ago.
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L1), [11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L11-L21)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

14: /// @author Matter Labs 
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L14)

</details>


---
### [NC&#x2011;62] Initialisms should be capitalized
According to the Solidity [style guide](https://docs.soliditylang.org/en/latest/style-guide.html#naming-styles) initialisms such as "NFT", "ERC", etc should be capitalized.

<details>
<summary><i>There are 2 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

34:     address public immutable override l1WethAddress; 
```
[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L34)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol

114:     function l1WethAddress() external view returns (address); 
```
[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L114)

</details>


---
### [NC&#x2011;63] Large multiples of ten should use scientific notation
Use a scientific notation rather than decimal literals (e.g. `1e6` instead of `1000000`), for better code readability.

<details>
<summary><i>There are 6 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/Config.sol

/// @audit Use 1e4
92: uint256 constant TX_SLOT_OVERHEAD_L2_GAS = 10000; 
```
[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Config.sol#L92)

```solidity
📁 File: contracts/zksync/contracts/L2ContractHelper.sol

/// @audit Use 0e3
68: uint160 constant SYSTEM_CONTRACTS_OFFSET = 0x8000; // 2^15 
```
[68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L68)

```solidity
📁 File: system-contracts/contracts/Constants.sol

/// @audit Use 0e3
25: uint160 constant REAL_SYSTEM_CONTRACTS_OFFSET = 0x8000; 

/// @audit Use 5e4
108: uint256 constant MAX_ALLOWED_PUBDATA_PER_BATCH = 520000; 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L25), [108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L108)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

/// @audit Use 2e2
36:     uint256 constant GAS_TO_PASS = 2300; 

/// @audit Use 2e3
41:     uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000; 
```
[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L36), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L41)

</details>


---
### [NC&#x2011;64] Large numeric literals should use underscores for readability
<details>
<summary><i>There are 7 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/Config.sol

92: uint256 constant TX_SLOT_OVERHEAD_L2_GAS = 10000; 
```
[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Config.sol#L92)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

194:             require(processedLogs == 1023, "b8"); 
```
[194](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L194)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol

50: uint256 constant BLS_MODULUS = 52435875175126190479447740508185965837690552500527637822603658699938581184513; 
```
[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L50)

```solidity
📁 File: system-contracts/contracts/Constants.sol

108: uint256 constant MAX_ALLOWED_PUBDATA_PER_BATCH = 520000; 

125: uint256 constant L2_TO_L1_LOGS_MERKLE_TREE_LEAVES = 4096; 
```
[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L108), [125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L125)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

36:     uint256 constant GAS_TO_PASS = 2300; 

41:     uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000; 
```
[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L36), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L41)

</details>


---
### [NC&#x2011;65] Large or complicated code bases should implement invariant tests
Large code bases, or code with lots of inline-assembly, complicated math, or complicated interactions between multiple contracts, should implement [invariant fuzzing tests](https://medium.com/coinmonks/smart-contract-fuzzing-d9b88e0b0a05). Invariant fuzzers such as Echidna require the test writer to come up with invariants which should not be violated under any circumstances, and the fuzzer tests various inputs and function calls to ensure that the invariants always hold. Even code with 100% code coverage can still have bugs due to the order of the operations a user performs, and invariant fuzzers, with properly and extensively-written invariants, can close this testing gap significantly.


---
### [NC&#x2011;66] Layout order does not comply with best practices
This is a [best practice](https://docs.soliditylang.org/en/latest/style-guide.html#order-of-layout) that should be followed.

Inside each contract, library or interface, use the following order:

1. Type declarations
2. State variables
3. Events
4. Errors
5. Modifiers
6. Functions

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit struct declaration `MessageParams` after function definition
/// @audit variable declaration `l2BatchNumber` after function definition
/// @audit variable declaration `l2MessageIndex` after function definition
/// @audit variable declaration `l2TxNumberInBatch` after function definition
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step { 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit modifier definition `onlyOwnerOrAdmin` after function definition
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step { 
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

/// @audit event definition `NewChain` after function definition
42: interface IBridgehub { 
```
[42](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L42)

```solidity
📁 File: contracts/ethereum/contracts/common/ReentrancyGuard.sol

/// @audit modifier definition `nonReentrant` after function definition
25: abstract contract ReentrancyGuard { 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L25)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

/// @audit modifier definition `onlySelf` after function definition
/// @audit modifier definition `onlySecurityCouncil` after function definition
/// @audit modifier definition `onlyOwnerOrSecurityCouncil` after function definition
20: contract Governance is IGovernance, Ownable2Step { 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L20)

```solidity
📁 File: contracts/ethereum/contracts/governance/IGovernance.sol

/// @audit struct declaration `Operation` after variable declaration
/// @audit event definition `TransparentOperationScheduled` after function definition
/// @audit event definition `ShadowOperationScheduled` after function definition
/// @audit event definition `OperationExecuted` after function definition
/// @audit event definition `ChangeSecurityCouncil` after function definition
/// @audit event definition `ChangeMinDelay` after function definition
/// @audit event definition `OperationCancelled` after function definition
8: interface IGovernance { 
```
[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L8)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit modifier definition `onlyBridgehub` after function definition
/// @audit modifier definition `onlyOwnerOrAdmin` after function definition
25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step { 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L25)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit variable declaration `stateTransitionManager` after error definition
/// @audit variable declaration `committedBatchTimestamp` after error definition
/// @audit variable declaration `validators` after error definition
/// @audit variable declaration `executionDelay` after error definition
/// @audit modifier definition `onlyChainAdmin` after function definition
/// @audit modifier definition `onlyValidator` after function definition
22: contract ValidatorTimelock is IExecutor, Ownable2Step { 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L22)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol

/// @audit struct declaration `CommitBatchInfo` after variable declaration
/// @audit struct declaration `ProofInput` after variable declaration
/// @audit event definition `BlockCommit` after function definition
/// @audit event definition `BlocksVerification` after function definition
/// @audit event definition `BlockExecution` after function definition
/// @audit event definition `BlocksRevert` after function definition
73: interface IExecutor is IZkSyncStateTransitionBase { 
```
[73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L73)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

/// @audit struct declaration `FacetToSelectors` after variable declaration
/// @audit struct declaration `DiamondStorage` after variable declaration
/// @audit struct declaration `FacetCut` after variable declaration
/// @audit struct declaration `DiamondCutData` after variable declaration
11: library Diamond { 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L11)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

/// @audit struct declaration `ForceDeployment` after function definition
/// @audit variable declaration `bytecodeHash` after function definition
/// @audit variable declaration `newAddress` after function definition
/// @audit variable declaration `callConstructor` after function definition
/// @audit variable declaration `value` after function definition
23: contract ContractDeployer is IContractDeployer, ISystemContract { 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L23)

</details>


---
### [NC&#x2011;67] Libraries should be defined in separate files from their usage
The libraries below should be defined in separate files, so that it's easier for future projects to import them, and to avoid duplication later on if they need to be used elsewhere in the project


<i>There are 2 instaces of this issue:</i>

```solidity
📁 File: contracts/zksync/contracts/SystemContractsCaller.sol

26: library Utils { 

44:         uint32 dataLength = uint32(Utils.safeCastToU32(data.length)); 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L26), [44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L44)


---
### [NC&#x2011;68] Lines are too long
Usually lines in source code are limited to 80 characters. Today's screens are much larger so it's reasonable to stretch this in some cases. Since the files will most likely reside in GitHub, and GitHub starts using a scroll bar in all cases when the length is over 164 characters, the lines below should be split when they reach that length Reference: https://docs.soliditylang.org/en/v0.8.10/style-guide.html#maximum-line-length

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit 130 chars long
31:     /// @dev Used for saving the number of deposited funds, to claim them in case the deposit transaction will fail in zkSync Era. 
```
[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L31)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit 139 chars long
21: import {ERA_CHAIN_ID, ERA_ERC20_BRIDGE_ADDRESS, ETH_TOKEN_ADDRESS, ERA_DIAMOND_PROXY, TWO_BRIDGES_MAGIC_VALUE} from "../common/Config.sol"; 

/// @audit 127 chars long
43:     /// This variable is used to differentiate between pre-upgrade and post-upgrade withdrawals. Withdrawals from batches older 

/// @audit 128 chars long
47:     /// @dev A mapping chainId => bridgeProxy. Used to store the bridge proxy's address, and to see if it has been deployed yet. 

/// @audit 122 chars long
57:     mapping(uint256 chainId => mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized))) 

/// @audit 137 chars long
103:     /// implementation. The owner is the Governor and separate from the ProxyAdmin from now on, so that the Governor can call the bridge. 

/// @audit 172 chars long
160:             uint256 amount = _depositFunds(_prevMsgSender, IERC20(_l1Token), _amount); // note if _prevMsgSender is this contract, this will return 0. This does not happen. 

/// @audit 142 chars long
167:         // Note that we don't save the deposited amount, as this is for the base token, which gets sent to the refundRecipient if the tx fails 

/// @audit 128 chars long
230:     /// @notice Confirms the acceptance of a transaction by the Mailbox, as part of the L2 transaction process within Bridgehub. 

/// @audit 140 chars long
332:                 // Deposits that happened before the upgrade cannot be checked here, they have to be claimed and checked in the legacyBridge 

/// @audit 142 chars long
494:         // It should be equal to the length of the bytes4 function signature + address l1Receiver + uint256 amount = 4 + 20 + 32 = 56 (bytes). 

/// @audit 124 chars long
515:             // It should be equal to the length of the function signature + address + address + uint256 = 4 + 20 + 20 + 32 = 

/// @audit 139 chars long
587:                 mintValue: msg.value, // l2 gas + l2 msg.Value the bridgehub will withdraw the mintValue from the base token bridge for gas 
/// @audit 155 chars long
588:                 l2Value: 0, // L2 msg.value, this contract doesn't support base token deposits or wrapping functionality, for direct deposits use bridgehub
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L21), [43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L43), [47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L47), [57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L57), [103](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L103), [160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L160), [167](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L167), [230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L230), [332](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L332), [494](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L494), [515](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L515), [587](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L587-L588)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit 127 chars long
62:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights 

/// @audit 127 chars long
216:     /// This means this is not ideal for contract calls, as the contract would have to handle token allowance of the base Token 
```
[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L62), [216](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L216)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit 213 chars long
19: import {REQUIRED_L2_GAS_PRICE_PER_PUBDATA, L2_TO_L1_LOG_SERIALIZE_SIZE, DEFAULT_L2_LOGS_TREE_ROOT_HASH, EMPTY_STRING_KECCAK, SYSTEM_UPGRADE_L2_TX_TYPE, ERA_DIAMOND_PROXY, ERA_CHAIN_ID} from "../common/Config.sol"; 

/// @audit 127 chars long
121:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L19), [121](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L121)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit 134 chars long
13: /// @notice Intermediate smart contract between the validator EOA account and the hyperchains state transition diamond smart contract. 

/// @audit 126 chars long
15: /// modifying the main hyperchain diamond contract. As such, even if this contract is compromised, it will not impact the main 
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L13), [15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L15)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol

/// @audit 132 chars long
69:     /// @notice Address which will exercise critical changes to the Diamond Proxy (upgrades, freezing & unfreezing). Replaced by STM 

/// @audit 130 chars long
149:     /// @notice gasPriceMultiplier for each baseToken, so that each L1->L2 transaction pays for its transaction on the destination 
```
[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L69), [149](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L149)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

/// @audit 162 chars long
90:         require(s.totalBatchesCommitted == 0, "AdminFacet: set validium only after genesis"); // Validium mode can be set only before the first batch is committed 
```
[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L90)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit 280 chars long
6: import {COMMIT_TIMESTAMP_NOT_OLDER, COMMIT_TIMESTAMP_APPROXIMATION_DELTA, EMPTY_STRING_KECCAK, L2_TO_L1_LOG_SERIALIZE_SIZE, MAX_L2_TO_L1_LOGS_COMMITMENT_BYTES, PACKED_L2_BLOCK_TIMESTAMP_MASK, PUBLIC_INPUT_SHIFT, POINT_EVALUATION_PRECOMPILE_ADDR} from "../../../common/Config.sol"; 
/// @audit 341 chars long
7: import {IExecutor, L2_LOG_ADDRESS_OFFSET, L2_LOG_KEY_OFFSET, L2_LOG_VALUE_OFFSET, SystemLogKey, LogProcessingOutput, PubdataSource, BLS_MODULUS, PUBDATA_COMMITMENT_SIZE, PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET, PUBDATA_COMMITMENT_COMMITMENT_OFFSET, MAX_NUMBER_OF_BLOBS, TOTAL_BLOBS_IN_COMMITMENT} from "../../chain-interfaces/IExecutor.sol";

/// @audit 192 chars long
12: import {L2_BOOTLOADER_ADDRESS, L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, L2_PUBDATA_CHUNK_PUBLISHER_ADDR} from "../../../common/L2ContractAddresses.sol"; 

/// @audit 176 chars long
57:             // In this scenario, pubdataCommitments is a list of: opening point (16 bytes) || claimed value (32 bytes) || commitment (48 bytes) || proof (48 bytes)) = 144 bytes 

/// @audit 178 chars long
60:             // In this scenario pubdataCommitments is actual pubdata consisting of l2 to l1 logs, l2 to l1 message, compressed smart contract bytecode, and compressed state diffs 

/// @audit 142 chars long
100:     /// @param _packedBatchAndL2BlockTimestamp - packed batch and L2 block timestamp in a format of batchTimestamp * 2**128 + l2BatchTimestamp 

/// @audit 122 chars long
122:         require(block.timestamp - COMMIT_TIMESTAMP_NOT_OLDER <= batchTimestamp, "h1"); // New batch timestamp is too small 
/// @audit 144 chars long
123:         require(lastL2BlockTimestamp <= block.timestamp + COMMIT_TIMESTAMP_APPROXIMATION_DELTA, "h2"); // The last L2 block timestamp is too big

/// @audit 139 chars long
221:         // 1. A chain has to keep their protocol version up to date, as processing a block requires the latest or previous protocol version 
/// @audit 132 chars long
222:         // to solve this we will need to add the feature to create batches with only the protocol upgrade tx, without any other txs.
/// @audit 169 chars long
223:         // 2. A chain might become out of sync if it launches while we are in the middle of a protocol upgrade. This would mean they cannot process their genesis upgrade
/// @audit 139 chars long
224:         // as thier protocolversion would be outdated, and they also cannot process the protocol upgrade tx as they have a pending upgrade.
/// @audit 138 chars long
225:         // 3. The protocol upgrade is increased in the BaseZkSyncUpgrade, in the executor only the systemContractsUpgradeTxHash is checked

/// @audit 158 chars long
230:         // With the new changes for EIP-4844, namely the restriction on number of blobs per block, we only allow for a single batch to be committed at a time. 

/// @audit 149 chars long
233:         require(s.storedBatchHashes[s.totalBatchesCommitted] == _hashStoredBatchInfo(_lastCommittedBatchData), "i"); // incorrect previous batch data 

/// @audit 132 chars long
282:         // While the logic of the contract ensures that the s.l2SystemContractsUpgradeBatchNumber is 0 when this function is called, 

/// @audit 139 chars long
330:         require(priorityOperationsHash == _storedBatch.priorityOperationsHash, "x"); // priority operations hash does not match to expected 
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L6-L7), [12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L12), [57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L57), [60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L60), [100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L100), [122](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L122-L123), [221](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L221-L225), [230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L230), [233](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L233), [282](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L282), [330](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L330)

</details>


---
### [NC&#x2011;69] Long functions should be refactored into multiple, smaller, functions
Functions with too many lines are difficult to understand. It is recommended to refactor complex functions into multiple shorter and easier to understand functions.

<details>
<summary><i>There are 16 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit 65 lines long
303:     function _claimFailedDeposit( 
304:         bool _checkedInLegacyBridge,
305:         uint256 _chainId,
306:         address _depositSender,
307:         address _l1Token,
308:         uint256 _amount,
309:         bytes32 _l2TxHash,
310:         uint256 _l2BatchNumber,
311:         uint256 _l2MessageIndex,
312:         uint16 _l2TxNumberInBatch,
313:         bytes32[] calldata _merkleProof
314:     ) internal nonReentrant {
```
[303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L303-L314)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit 61 lines long
262:     function requestL2TransactionTwoBridges( 
263:         L2TransactionRequestTwoBridgesOuter calldata _request
264:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash) {
```
[262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L262-L264)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit 51 lines long
177:     function _setChainIdUpgrade(uint256 _chainId, address _chainContract) internal { 
```
[177](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L177)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit 65 lines long
32:     function _commitOneBatch( 
33:         StoredBatchInfo memory _previousBatch,
34:         CommitBatchInfo calldata _newBatch,
35:         bytes32 _expectedSystemContractUpgradeTxHash
36:     ) internal view returns (StoredBatchInfo memory) {

/// @audit 66 lines long
130:     function _processL2Logs( 
131:         CommitBatchInfo calldata _newBatch,
132:         bytes32 _expectedSystemContractUpgradeTxHash
133:     ) internal pure returns (LogProcessingOutput memory logOutput) {

/// @audit 52 lines long
386:     function _proveBatches( 
387:         StoredBatchInfo calldata _prevBatch,
388:         StoredBatchInfo[] calldata _committedBatches,
389:         ProofInput calldata _proof
390:     ) internal {
```
[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L32-L36), [130](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L130-L133), [386](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L386-L390)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

/// @audit 52 lines long
50:     function bridgeInitialize(address _l1Address, bytes memory _data) external initializer { 
```
[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L50)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

/// @audit 90 lines long
44:     function encodeLegacyTransactionHash(Transaction calldata _transaction) internal view returns (bytes32 txHash) { 

/// @audit 85 lines long
139:     function encodeEIP2930TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) { 

/// @audit 90 lines long
229:     function encodeEIP1559TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) { 
```
[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L44), [139](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L139), [229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L229)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

/// @audit 80 lines long
110:     function verifyCompressedStateDiffs( 
111:         uint256 _numberOfStateDiffs,
112:         uint256 _enumerationIndexSize,
113:         bytes calldata _stateDiffs,
114:         bytes calldata _compressedStateDiffs
115:     ) external payable onlyCallFrom(address(L1_MESSENGER_CONTRACT)) returns (bytes32 stateDiffHash) {
```
[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L110-L115)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

/// @audit 139 lines long
194:     function publishPubdataAndClearState( 
195:         bytes calldata _totalL2ToL1PubdataAndStateDiffs
196:     ) external onlyCallFromBootloader {
```
[194](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L194-L196)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

/// @audit 57 lines long
341:     function setL2Block( 
342:         uint128 _l2BlockNumber,
343:         uint128 _l2BlockTimestamp,
344:         bytes32 _expectedPrevL2BlockHash,
345:         bool _isFirstInBatch,
346:         uint128 _maxVirtualBlocksToCreate
347:     ) external onlyCallFromBootloader {
```
[341](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L341-L347)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

/// @audit 68 lines long
147:     function _encodeHashLegacyTransaction(Transaction calldata _transaction) private view returns (bytes32) { 

/// @audit 66 lines long
219:     function _encodeHashEIP2930Transaction(Transaction calldata _transaction) private view returns (bytes32) { 

/// @audit 68 lines long
289:     function _encodeHashEIP1559Transaction(Transaction calldata _transaction) private view returns (bytes32) { 
```
[147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L147), [219](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L219), [289](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L289)

</details>


---
### [NC&#x2011;70] Make use of Solidity's `using` keyword
The `using`-`for` [syntax](https://docs.soliditylang.org/en/latest/contracts.html#using-for) is the more common way of calling library functions.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit L2ContractHelper
79:         return L2ContractHelper.computeCreate2Address(l2Bridge, salt, l2TokenProxyBytecodeHash, constructorInputHash); 
```
[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L79)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit UnsafeBytes
503:         (uint32 functionSignature, uint256 offset) = UnsafeBytes.readUint32(_l2ToL1message, 0); 

/// @audit UnsafeBytes
506:             (l1Receiver, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset); 
/// @audit UnsafeBytes
507:             (amount, offset) = UnsafeBytes.readUint256(_l2ToL1message, offset);

/// @audit UnsafeBytes
518:             (l1Receiver, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset); 
/// @audit UnsafeBytes
519:             (l1Token, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset);
/// @audit UnsafeBytes
520:             (amount, offset) = UnsafeBytes.readUint256(_l2ToL1message, offset);

/// @audit AddressAliasHelper
580:                     ? AddressAliasHelper.applyL1ToL2Alias(_prevMsgSender) 
```
[503](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L503), [506](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L506-L507), [518](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L518-L520), [580](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L580)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit AddressAliasHelper
328:             _recipient = msg.sender == tx.origin ? msg.sender : AddressAliasHelper.applyL1ToL2Alias(msg.sender); 

/// @audit AddressAliasHelper
331:             _recipient = AddressAliasHelper.applyL1ToL2Alias(_refundRecipient); 
```
[328](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L328), [331](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L331)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit Diamond
220:         Diamond.DiamondCutData memory cutData = Diamond.DiamondCutData({ 
221:             facetCuts: emptyArray,
222:             initAddress: genesisUpgrade,
223:             initCalldata: abi.encodeCall(IDefaultUpgrade.upgrade, (proposedUpgrade))
224:         });
```
[220](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L220-L224)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

/// @audit Diamond
15:         Diamond.diamondCut(_diamondCut); 

/// @audit Diamond
21:         Diamond.DiamondStorage storage diamondStorage = Diamond.getDiamondStorage(); 
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L15), [21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L21)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

/// @audit Diamond
114:         Diamond.diamondCut(_diamondCut); 

/// @audit Diamond
124:         Diamond.diamondCut(_diamondCut); 

/// @audit Diamond
134:         Diamond.DiamondStorage storage diamondStorage = Diamond.getDiamondStorage(); 

/// @audit Diamond
144:         Diamond.DiamondStorage storage diamondStorage = Diamond.getDiamondStorage(); 
```
[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L114), [124](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L124), [134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L134), [144](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L144)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit UnsafeBytes
144:             (address logSender, ) = UnsafeBytes.readAddress(emittedL2Logs, i + L2_LOG_ADDRESS_OFFSET); 
/// @audit UnsafeBytes
145:             (uint256 logKey, ) = UnsafeBytes.readUint256(emittedL2Logs, i + L2_LOG_KEY_OFFSET);
/// @audit UnsafeBytes
146:             (bytes32 logValue, ) = UnsafeBytes.readBytes32(emittedL2Logs, i + L2_LOG_VALUE_OFFSET);
```
[144](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L144-L146)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

/// @audit Diamond
158:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 

/// @audit Diamond
164:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 

/// @audit Diamond
182:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 

/// @audit Diamond
203:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 

/// @audit Diamond
218:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 

/// @audit Diamond
224:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 

/// @audit Diamond
230:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 
```
[158](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L158), [164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L164), [182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L182), [203](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L203), [218](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L218), [224](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L224), [230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L230)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

/// @audit Merkle
123:         bytes32 calculatedRootHash = Merkle.calculateRoot(_proof, _index, hashedLog); 

/// @audit Math
174:         return Math.max(l2GasPrice, minL2GasPriceBaseToken); 

/// @audit AddressAliasHelper
235:             l2Sender = AddressAliasHelper.applyL1ToL2Alias(_request.sender); 

/// @audit AddressAliasHelper
278:             refundRecipient = AddressAliasHelper.applyL1ToL2Alias(refundRecipient); 

/// @audit TransactionValidator
325:         TransactionValidator.validateL1ToL2Transaction( 
326:             transaction,
327:             transactionEncoding,
328:             s.priorityTxMaxGasLimit,
329:             s.feeParams.priorityTxMaxPubdata
330:         );

/// @audit L2ContractHelper
357:             bytes32 hashedBytecode = L2ContractHelper.hashL2Bytecode(_factoryDeps[i]); 
```
[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L123), [174](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L174), [235](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L235), [278](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L278), [325](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L325-L330), [357](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L357)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol

/// @audit Math
83:             costForComputation += Math.ceilDiv(_encodingLength * L1_TX_DELTA_544_ENCODING_BYTES, 544); 

/// @audit Math
136:         batchOverheadForTransaction = Math.max(batchOverheadForTransaction, overheadForLength); 
```
[83](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L83), [136](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L136)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

/// @audit L2ContractHelper
97:         L2ContractHelper.validateBytecodeHash(_l2DefaultAccountBytecodeHash); 

/// @audit L2ContractHelper
114:         L2ContractHelper.validateBytecodeHash(_l2BootloaderBytecodeHash); 

/// @audit TransactionValidator
194:         TransactionValidator.validateL1ToL2Transaction( 
195:             _l2ProtocolUpgradeTx,
196:             encodedTransaction,
197:             s.priorityTxMaxGasLimit,
198:             s.feeParams.priorityTxMaxPubdata
199:         );

/// @audit TransactionValidator
201:         TransactionValidator.validateUpgradeTransaction(_l2ProtocolUpgradeTx); 

/// @audit L2ContractHelper
228:                 L2ContractHelper.hashL2Bytecode(_factoryDeps[i]) == bytes32(_expectedHashes[i]), 
```
[97](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L97), [114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L114), [194](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L194-L199), [201](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L201), [228](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L228)

</details>


---
### [NC&#x2011;71] Minting to the zero address should be avoided
Minting tokens to the zero address in Solidity is a potential pitfall. The zero address (0x0) is commonly used as a default value and sending tokens there effectively burns them, leading to unintended token loss. To prevent this, include a check in the minting function to ensure the target address is not zero. Using OpenZeppelin's Address library with the requireNonZero function simplifies this check and enhances security.

<details>
<summary><i>There are 2 instances of this issue:</i></summary>

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

145:     function bridgeMint(address _to, uint256 _amount) external override onlyBridge { 
146:         _mint(_to, _amount);
147:         emit BridgeMint(_to, _amount);
148:     }
```
[145](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L145-L148)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

64:     function mint(address _account, uint256 _amount) external override onlyCallFromBootloader { 
65:         totalSupply += _amount;
66:         balance[_account] += _amount;
67:         emit Mint(_account, _amount);
68:     }
```
[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L64-L68)

</details>


---
### [NC&#x2011;72] Missing checks for `address(0x0)` in the constructor
<details>
<summary><i>There are 4 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit _l1WethAddress missing zero address validation
90:     constructor( 
91:         address _l1WethAddress,
92:         IBridgehub _bridgehub,
93:         IL1ERC20Bridge _legacyBridge
94:     ) reentrancyGuardInitializer {
```
[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L90-L94)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

/// @audit _securityCouncil missing zero address validation
41:     constructor(address _admin, address _securityCouncil, uint256 _minDelay) { 
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L41)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit _bridgehub missing zero address validation
58:     constructor(address _bridgehub) reentrancyGuardInitializer { 
```
[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L58)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit _initialOwner missing zero address validation
55:     constructor(address _initialOwner, uint32 _executionDelay) { 
```
[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L55)

</details>


---
### [NC&#x2011;73] Missing checks for uint state variable assignments
<details>
<summary><i>There are 27 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

165:             chainBalance[_chainId][_l1Token] += _amount; 

568:             chainBalance[ERA_CHAIN_ID][_l1Token] += _amount; 
```
[165](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L165), [568](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L568)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

49:         minDelay = _minDelay; 

251:         minDelay = _newDelay; 
```
[49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L49), [251](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L251)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

148:         protocolVersion = _newProtocolVersion; 
```
[148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L148)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

57:         executionDelay = _executionDelay; 

97:         executionDelay = _executionDelay; 
```
[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L57), [97](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L97)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

62:         s.priorityTxMaxGasLimit = _newPriorityTxMaxGasLimit; 

83:         s.baseTokenGasPriceMultiplierNominator = _nominator; 
84:         s.baseTokenGasPriceMultiplierDenominator = _denominator;
```
[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L62), [83](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L83-L84)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

486:             s.totalBatchesVerified = _newLastBatch; 

488:         s.totalBatchesCommitted = _newLastBatch; 
```
[486](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L486), [488](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L488)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

284:         _params.valueToMint = _mintValue; 
```
[284](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L284)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

255:         s.protocolVersion = _newProtocolVersion; 
```
[255](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L255)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

39:         s.protocolVersion = _newProtocolVersion; 
```
[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L39)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

46:             balance[_to] += _amount; 

65:         totalSupply += _amount; 
66:         balance[_account] += _amount;
```
[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L46), [65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L65-L66)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

85:         chainId = _newChainId; 

106:         gasPrice = _gasPrice; 

113:         basePubdataSpent = _basePubdataSpent; 
114:         gasPerPubdataByte = _gasPerPubdataByte;

296:         virtualBlockInfo.timestamp = _newTimestamp; 

303:             virtualBlockUpgradeInfo.virtualBlockFinishL2Block = _l2BlockNumber; 
304:             virtualBlockInfo.number = _l2BlockNumber;

463:         baseFee = _baseFee; 

479:         baseFee = _baseFee; 
```
[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L85), [106](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L106), [113](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L113-L114), [296](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L296), [303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L303-L304), [463](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L463), [479](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L479)

</details>


---
### [NC&#x2011;74] Missing events in initializers
As a best practice, consider emitting an event when the contract is initialized. In this way, it's easy for the user to track the exact point in time when the contract was initialized, by filtering the emitted events.

<details>
<summary><i>There are 6 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

60:     function initialize() external reentrancyGuardInitializer {} 
```
[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L60)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

104:     function initialize( 
105:         address _owner,
106:         uint256 _eraFirstPostUpgradeBatch
107:     ) external reentrancyGuardInitializer initializer {
```
[104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L104-L107)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

41:     function initialize(address _owner) external reentrancyGuardInitializer { 
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L41)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

79:     function initialize( 
80:         StateTransitionManagerInitializeData calldata _initializeData
81:     ) external reentrancyGuardInitializer {
```
[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L79-L81)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

24:     function initialize(InitializeData calldata _initializeData) external reentrancyGuardInitializer returns (bytes32) { 
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L24)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

49:     function initialize( 
50:         address _l1Bridge,
51:         address _l1LegecyBridge,
52:         bytes32 _l2TokenProxyBytecodeHash,
53:         address _aliasedOwner
54:     ) external reinitializer(2) {
```
[49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L49-L54)

</details>


---
### [NC&#x2011;75] Mixed usage of `int/uint` with `int256/uint256`
`int256/uint256` are the preferred type names (they're what are used for function signatures), so they should be used consistently


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

580:         for (uint i = 0; i < MAX_NUMBER_OF_BLOBS; i++) { 
```
[580](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L580)


---
### [NC&#x2011;76] Multiple mappings with same keys can be combined into a single struct mapping for readability
Well-organized data structures make code reviews easier, which may lead to fewer bugs. Consider combining related mappings into mappings to structs, so it's clear what data is related

<details>
<summary><i>There are 19 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

32:     mapping(address account => mapping(address l1Token => mapping(bytes32 depositL2TxHash => uint256 amount))) 

45:     mapping(address => uint256) private __DEPRECATED_lastWithdrawalLimitReset; 

48:     mapping(address => uint256) private __DEPRECATED_withdrawnAmountInWindow; 

51:     mapping(address => mapping(address => uint256)) private __DEPRECATED_totalDepositedAmountPerUser; 
```
[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L32), [45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L45), [48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L48), [51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L51)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

48:     mapping(uint256 chainId => address l2Bridge) public override l2BridgeAddress; 

52:     mapping(uint256 chainId => mapping(bytes32 l2DepositTxHash => bytes32 depositDataHash)) 

65:     mapping(uint256 chainId => mapping(address l1Token => uint256 balance)) internal chainBalance; 
```
[48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L48), [52](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L52), [65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L65)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

26:     mapping(uint256 _chainId => address) public stateTransitionManager; 

29:     mapping(uint256 _chainId => address) public baseToken; 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L26), [29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L29)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

30:     mapping(uint256 => address) public stateTransition; 

48:     mapping(uint256 => bytes32) public upgradeCutHash; 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L30), [48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L48)

```solidity
📁 File: system-contracts/contracts/ImmutableSimulator.sol

21:     mapping(uint256 contractAddress => mapping(uint256 index => bytes32 value)) internal immutableDataStorage; 
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L21)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

36:     mapping(uint256 account => uint256 packedMinAndDeploymentNonce) internal rawNonces; 

41:     mapping(uint256 account => mapping(uint256 nonceKey => uint256 value)) internal nonceValues; 
```
[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L36), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L41)

</details>


---
### [NC&#x2011;77] Multiple type casts create complexity within the code
To ensure reliable and precise data handling in Solidity contracts, developers should avoid double type casting. Multiple type casts can lead to unintended consequences, such as truncation, rounding errors, or loss of precision. This compromises the contract's functionality and readability, making debugging more challenging. Instead, its crucial to use appropriate data types and minimize unnecessary type casting for a more dependable and robust contract execution.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit bytes32(uint256(uint160))
/// @audit uint256(uint160)
77:         bytes32 salt = bytes32(uint256(uint160(_l1Token))); 
```
[77](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L77)

```solidity
📁 File: contracts/ethereum/contracts/common/Config.sol

/// @audit address(uint160)
115: address constant BRIDGEHUB_MIN_SECOND_BRIDGE_ADDRESS = address(uint160(type(uint16).max)); 
```
[115](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Config.sol#L115)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

/// @audit bytes32(uint256)
30:         hashedBytecode = (hashedBytecode | bytes32(uint256(1 << 248))); 

/// @audit uint256(uint8)
/// @audit uint256(uint8)
50:         codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3])); 

/// @audit bytes32(uint256(uint160))
/// @audit uint256(uint160)
66:         bytes32 senderBytes = bytes32(uint256(uint160(_sender))); 

/// @audit uint160(uint256)
71:         return address(uint160(uint256(data))); 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L30), [50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L50), [66](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L66), [71](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L71)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit uint256(uint160)
184:             from: uint256(uint160(L2_FORCE_DEPLOYER_ADDR)), 

/// @audit bytes32(uint256(uint160))
/// @audit uint256(uint160)
264:             bytes32(uint256(uint160(bridgehub))), 
/// @audit uint160(address)
265:             bytes32(uint256(uint160(address(this)))),

/// @audit bytes32(uint256(uint160))
/// @audit uint256(uint160)
267:             bytes32(uint256(uint160(_admin))), 

/// @audit uint256(uint160)
269:             bytes32(uint256(uint160(_baseToken))), 
/// @audit bytes32(uint256(uint160))
270:             bytes32(uint256(uint160(_sharedBridge))),
```
[184](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L184), [264](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L264-L265), [267](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L267), [269](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L269-L270)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit uint8(bytes1)
39:         uint8 pubdataSource = uint8(bytes1(_newBatch.pubdataCommitments[0])); 

/// @audit bytes32(uint256(uint128(bytes16)))
643:             bytes32 openingPoint = bytes32( 
/// @audit uint256(uint128(bytes16))
/// @audit uint128(bytes16)
644:                 uint256(uint128(bytes16(_pubdataCommitments[i:i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET])))
645:             );
```
[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L39), [643](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L643-L645)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

/// @audit bytes32(uint256)
98:             value: bytes32(uint256(_status)) 

/// @audit bytes32(uint256(uint160))
/// @audit uint256(uint160)
137:                 key: bytes32(uint256(uint160(_message.sender))), 

/// @audit uint256(uint160)
296:             from: uint256(uint160(_priorityOpParams.sender)), 

/// @audit uint256(uint160)
306:             reserved: [_priorityOpParams.valueToMint, uint256(uint160(_priorityOpParams.refundRecipient)), 0, 0], 
```
[98](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L98), [137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L137), [296](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L296), [306](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L306)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

/// @audit uint256(uint160)
69:         uint256 addressAsKey = uint256(uint160(_address)); 

/// @audit address(uint160)
92:         address account = address(uint160(_input)); 

/// @audit address(uint160)
120:         address account = address(uint160(_input)); 
```
[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L69), [92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L92), [120](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L120)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

/// @audit address(uint160)
61:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); 

/// @audit uint256(bytes32)
81:             uint256 rInt = uint256(bytes32(_transaction.signature[0:32])); 

/// @audit uint256(uint8)
91:             uint256 vInt = uint256(uint8(_transaction.signature[64])); 

/// @audit address(uint160)
147:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); 

/// @audit uint256(bytes32)
180:             uint256 rInt = uint256(bytes32(_transaction.signature[0:32])); 

/// @audit uint256(uint8)
190:             uint256 vInt = uint256(uint8(_transaction.signature[64])); 

/// @audit address(uint160)
241:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); 

/// @audit uint256(bytes32)
275:             uint256 rInt = uint256(bytes32(_transaction.signature[0:32])); 

/// @audit uint256(uint8)
285:             uint256 vInt = uint256(uint8(_transaction.signature[64])); 
```
[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L61), [81](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L81), [91](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L91), [147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L147), [180](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L180), [190](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L190), [241](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L241), [275](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L275), [285](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L285)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

/// @audit uint8(bytes1)
143:             uint8 metadata = uint8(bytes1(_compressedStateDiffs[stateDiffPtr])); 

/// @audit uint256(bytes32)
252:         number = uint256(bytes32(_calldataSlice)); 
```
[143](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L143), [252](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L252)

</details>


---
### [NC&#x2011;78] Named imports of parent contracts are missing
<details>
<summary><i>There are 4 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit IBridgehub ,ReentrancyGuard 
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step { 
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

/// @audit BaseZkSyncUpgradeGenesis 
11: contract GenesisUpgrade is BaseZkSyncUpgradeGenesis { 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L11)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

/// @audit IAccountCodeStorage 
22: contract AccountCodeStorage is IAccountCodeStorage { 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L22)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

/// @audit IAccount 
19: contract DefaultAccount is IAccount { 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L19)

</details>


---
### [NC&#x2011;79] Names of private/internal state variables should be prefixed with an underscore
According to the Solidity Style Guide, Names of private/internal state variables should be prefixed with an <a href="https://docs.soliditylang.org/en/latest/style-guide.html#underscore-prefix-for-non-external-functions-and-variables">underscore</a>.

<details>
<summary><i>There are 28 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit _eraFirstPostUpgradeBatch
45:     uint256 internal eraFirstPostUpgradeBatch; 

/// @audit _hyperbridgingEnabled
61:     mapping(uint256 chainId => bool enabled) internal hyperbridgingEnabled; 

/// @audit _chainBalance
65:     mapping(uint256 chainId => mapping(address l1Token => uint256 balance)) internal chainBalance; 
```
[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L45), [61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L61), [65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L65)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit _pendingAdmin
35:     address private pendingAdmin; 
```
[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L35)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit _pendingAdmin
54:     address private pendingAdmin; 
```
[54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L54)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit _committedBatchTimestamp
47:     mapping(uint256 => LibMap.Uint32Map) internal committedBatchTimestamp; 
```
[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L47)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol

/// @audit _s
12:     ZkSyncStateTransitionStorage internal s; 
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L12)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

/// @audit _l2TokenProxyBytecodeHash
32:     bytes32 internal l2TokenProxyBytecodeHash; 

/// @audit _l1LegacyBridge
37:     address private l1LegacyBridge; 
```
[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L32), [37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L37)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

/// @audit _availableGetters
26:     ERC20Getters private availableGetters; 

/// @audit _decimals_
31:     uint8 private decimals_; 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L26), [31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L31)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

/// @audit _accountInfo
26:     mapping(address => AccountInfo) internal accountInfo; 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L26)

```solidity
📁 File: system-contracts/contracts/ImmutableSimulator.sol

/// @audit _immutableDataStorage
21:     mapping(uint256 contractAddress => mapping(uint256 index => bytes32 value)) internal immutableDataStorage; 
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L21)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

/// @audit _chainedLogsHash
28:     bytes32 internal chainedLogsHash; 

/// @audit _numberOfLogsToProcess
32:     uint256 internal numberOfLogsToProcess; 

/// @audit _chainedMessagesHash
36:     bytes32 internal chainedMessagesHash; 

/// @audit _chainedL1BytecodesRevealDataHash
41:     bytes32 internal chainedL1BytecodesRevealDataHash; 
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L28), [32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L32), [36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L36), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L41)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

/// @audit _balance
20:     mapping(address account => uint256 balance) internal balance; 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L20)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

/// @audit _rawNonces
36:     mapping(uint256 account => uint256 packedMinAndDeploymentNonce) internal rawNonces; 

/// @audit _nonceValues
41:     mapping(uint256 account => mapping(uint256 nonceKey => uint256 value)) internal nonceValues; 
```
[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L36), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L41)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

/// @audit _currentBatchInfo
51:     BlockInfo internal currentBatchInfo; 

/// @audit _batchHashes
55:     mapping(uint256 batchNumber => bytes32 batchHash) internal batchHashes; 

/// @audit _currentL2BlockInfo
58:     BlockInfo internal currentL2BlockInfo; 

/// @audit _currentL2BlockTxsRollingHash
61:     bytes32 internal currentL2BlockTxsRollingHash; 

/// @audit _l2BlockHash
70:     bytes32[MINIBLOCK_HASHES_TO_STORE] internal l2BlockHash; 

/// @audit _currentVirtualL2BlockInfo
77:     BlockInfo internal currentVirtualL2BlockInfo; 

/// @audit _virtualBlockUpgradeInfo
80:     VirtualBlockUpgradeInfo internal virtualBlockUpgradeInfo; 

/// @audit _basePubdataSpent
95:     uint256 internal basePubdataSpent; 
```
[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L51), [55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L55), [58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L58), [61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L61), [70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L70), [77](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L77), [80](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L80), [95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L95)

</details>


---
### [NC&#x2011;80] NatSpec: Contract declarations should have `@author` tags
<details>
<summary><i>There are 25 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol

3:  
4: interface IWETH9 {
5:     function deposit() external payable;
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol#L3-L5)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

15:  
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step {
17:     /// @notice all the ether is held by the weth bridge
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L15-L17)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

41:  
42: interface IBridgehub {
43:     /// @notice pendingAdmin is changed
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L41-L43)

```solidity
📁 File: contracts/ethereum/contracts/common/ReentrancyGuard.sol

24:  */ 
25: abstract contract ReentrancyGuard {
26:     /// @dev Address of lock flag variable.
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L24-L26)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

25:  
26: interface IStateTransitionManager {
27:     // when a new Chain is added
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L25-L27)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol

60:  
61: interface IDiamondInit {
62:     function initialize(InitializeData calldata _initData) external returns (bytes32);
```
[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L60-L62)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol

14:  
15: interface IZkSyncStateTransition is IAdmin, IExecutor, IGetters, IMailbox {
16:     // KL todo: need this in the server for now
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L14-L16)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol

3:  
4: interface ISystemContext {
5:     function setChainId(uint256 _newChainId) external;
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol#L3-L5)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol

6:  
7: interface IDefaultUpgrade {
8:     function upgrade(ProposedUpgrade calldata _upgrade) external returns (bytes32);
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol#L6-L8)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

20:  
21: library AddressAliasHelper {
22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L20-L22)

```solidity
📁 File: contracts/zksync/contracts/ForceDeployUpgrader.sol

9: /// @notice It is supposed to be used as an implementation of the ComplexUpgrader. 
10: contract ForceDeployUpgrader {
11:     /// @notice A function that performs force deploy
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L9-L11)

```solidity
📁 File: contracts/zksync/contracts/SystemContractsCaller.sol

25:  
26: library Utils {
27:     function safeCastToU32(uint256 _x) internal pure returns (uint32) {

35: /// @dev A more detailed description of the library and its methods can be found in the `system-contracts` repo. 
36: library SystemContractsCaller {
37:     function systemCall(uint32 gasLimit, address to, uint256 value, bytes memory data) internal returns (bool success) {
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L25-L27), [35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L35-L37)

```solidity
📁 File: contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol

4:  
5: interface IL2StandardToken {
6:     event BridgeInitialize(address indexed l1Token, string name, string symbol, uint8 decimals);
```
[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L4-L6)

```solidity
📁 File: contracts/zksync/contracts/interfaces/IPaymaster.sol

13:  
14: interface IPaymaster {
15:     /// @dev Called by the bootloader to verify that the paymaster agrees to pay for the
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L13-L15)

```solidity
📁 File: contracts/zksync/contracts/vendor/AddressAliasHelper.sol

20:  
21: library AddressAliasHelper {
22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L20-L22)

```solidity
📁 File: system-contracts/contracts/interfaces/IAccount.sol

8:  
9: interface IAccount {
10:     /// @notice Called by the bootloader to validate that an account agrees to process the transaction
```
[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IAccount.sol#L8-L10)

```solidity
📁 File: system-contracts/contracts/interfaces/IAccountCodeStorage.sol

4:  
5: interface IAccountCodeStorage {
6:     function storeAccountConstructingCodeHash(address _address, bytes32 _hash) external;
```
[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IAccountCodeStorage.sol#L4-L6)

```solidity
📁 File: system-contracts/contracts/interfaces/IBaseToken.sol

4:  
5: interface IBaseToken {
6:     function balanceOf(uint256) external view returns (uint256);
```
[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L4-L6)

```solidity
📁 File: system-contracts/contracts/interfaces/IBootloaderUtilities.sol

6:  
7: interface IBootloaderUtilities {
8:     function getTransactionHashes(
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBootloaderUtilities.sol#L6-L8)

```solidity
📁 File: system-contracts/contracts/interfaces/IContractDeployer.sol

4:  
5: interface IContractDeployer {
6:     /// @notice Defines the version of the account abstraction protocol
```
[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L4-L6)

```solidity
📁 File: system-contracts/contracts/interfaces/IImmutableSimulator.sol

9:  
10: interface IImmutableSimulator {
11:     function getImmutable(address _dest, uint256 _index) external view returns (bytes32);
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IImmutableSimulator.sol#L9-L11)

```solidity
📁 File: system-contracts/contracts/interfaces/IL2StandardToken.sol

4:  
5: interface IL2StandardToken {
6:     event BridgeMint(address indexed _account, uint256 _amount);
```
[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L4-L6)

```solidity
📁 File: system-contracts/contracts/interfaces/IMailbox.sol

4:  
5: interface IMailbox {
6:     function finalizeEthWithdrawal(
```
[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IMailbox.sol#L4-L6)

```solidity
📁 File: system-contracts/contracts/interfaces/IPaymaster.sol

13:  
14: interface IPaymaster {
15:     /// @dev Called by the bootloader to verify that the paymaster agrees to pay for the
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IPaymaster.sol#L13-L15)

</details>


---
### [NC&#x2011;81] NatSpec: Contract declarations should have `@dev` tags
<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol

10: /// @notice Legacy Bridge interface before hyperchain migration, used for backward compatibility with zkSync Era 
11: interface IL1ERC20Bridge {
12:     event DepositInitiated(
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L10-L12)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol

11: /// @custom:security-contact security@matterlabs.dev 
12: interface IL1SharedBridge {
13:     event LegacyDepositInitiated(
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L11-L13)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol

5: /// @author Matter Labs 
6: interface IL2Bridge {
7:     function finalizeDeposit(
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol#L5-L7)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol

3:  
4: interface IWETH9 {
5:     function deposit() external payable;
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol#L3-L5)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

15:  
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step {
17:     /// @notice all the ether is held by the weth bridge
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L15-L17)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

41:  
42: interface IBridgehub {
43:     /// @notice pendingAdmin is changed
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L41-L43)

```solidity
📁 File: contracts/ethereum/contracts/common/interfaces/IL2ContractDeployer.sol

8:  */ 
9: interface IL2ContractDeployer {
10:     /// @notice A struct that describes a forced deployment on an address.
```
[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/interfaces/IL2ContractDeployer.sol#L8-L10)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

9:  */ 
10: library L2ContractHelper {
11:     /// @dev The prefix used to create CREATE2 addresses.
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L9-L11)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/UncheckedMath.sol

9:  */ 
10: library UncheckedMath {
11:     function uncheckedInc(uint256 _number) internal pure returns (uint256) {
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L9-L11)

```solidity
📁 File: contracts/ethereum/contracts/governance/IGovernance.sol

7: /// @custom:security-contact security@matterlabs.dev 
8: interface IGovernance {
9:     /// @dev This enumeration includes the following states:
```
[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L7-L9)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

25:  
26: interface IStateTransitionManager {
27:     // when a new Chain is added
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L25-L27)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

24: /// @custom:security-contact security@matterlabs.dev 
25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step {
26:     /// @notice Address of the bridgehub
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L24-L26)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

9: /// @custom:security-contact security@matterlabs.dev 
10: contract DiamondProxy {
11:     constructor(uint256 _chainId, Diamond.DiamondCutData memory _diamondCut) {
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L9-L11)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

17: /// @custom:security-contact security@matterlabs.dev 
18: contract AdminFacet is ZkSyncStateTransitionBase, IAdmin {
19:     /// @inheritdoc IZkSyncStateTransitionBase
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L17-L19)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

21: /// @custom:security-contact security@matterlabs.dev 
22: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor {
23:     using UncheckedMath for uint256;
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L21-L23)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

19: /// @custom:security-contact security@matterlabs.dev 
20: contract GettersFacet is ZkSyncStateTransitionBase, IGetters, ILegacyGetters {
21:     using UncheckedMath for uint256;
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L19-L21)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

29: /// @custom:security-contact security@matterlabs.dev 
30: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox {
31:     using UncheckedMath for uint256;
```
[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L29-L31)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol

10: /// @custom:security-contact security@matterlabs.dev 
11: contract ZkSyncStateTransitionBase is ReentrancyGuard {
12:     ZkSyncStateTransitionStorage internal s;
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L10-L12)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol

12: /// @custom:security-contact security@matterlabs.dev 
13: interface IAdmin is IZkSyncStateTransitionBase {
14:     /// @notice Starts the transfer of admin rights. Only the current admin can propose a new pending one.
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L12-L14)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol

60:  
61: interface IDiamondInit {
62:     function initialize(InitializeData calldata _initData) external returns (bytes32);
```
[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L60-L62)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol

72: /// @custom:security-contact security@matterlabs.dev 
73: interface IExecutor is IZkSyncStateTransitionBase {
74:     /// @notice Rollup batch stored data
```
[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L72-L74)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol

12: /// @custom:security-contact security@matterlabs.dev 
13: interface IGetters is IZkSyncStateTransitionBase {
14:     /*//////////////////////////////////////////////////////////////
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L12-L14)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol

10: /// @custom:security-contact security@matterlabs.dev 
11: interface IMailbox is IZkSyncStateTransitionBase {
12:     /// @notice Prove that a specific arbitrary-length message was sent in a specific L2 batch number
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L10-L12)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IVerifier.sol

14: /// @custom:security-contact security@matterlabs.dev 
15: interface IVerifier {
16:     /// @dev Verifies a zk-SNARK proof.
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IVerifier.sol#L14-L16)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol

14:  
15: interface IZkSyncStateTransition is IAdmin, IExecutor, IGetters, IMailbox {
16:     // KL todo: need this in the server for now
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L14-L16)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransitionBase.sol

6: /// @custom:security-contact security@matterlabs.dev 
7: interface IZkSyncStateTransitionBase {
8:     /// @return Returns facet name.
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransitionBase.sol#L6-L8)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol

3:  
4: interface ISystemContext {
5:     function setChainId(uint256 _newChainId) external;
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol#L3-L5)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

10: /// @notice The helper library for managing the EIP-2535 diamond proxy. 
11: library Diamond {
12:     using UncheckedMath for uint256;
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L10-L12)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Merkle.sol

8: /// @custom:security-contact security@matterlabs.dev 
9: library Merkle {
10:     using UncheckedMath for uint256;
```
[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L8-L10)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol

12: /// @custom:security-contact security@matterlabs.dev 
13: library TransactionValidator {
14:     /// @dev Used to validate key properties of an L1->L2 transaction
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L12-L14)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

43: /// @notice Interface to which all the upgrade implementations should adhere 
44: abstract contract BaseZkSyncUpgrade is ZkSyncStateTransitionBase {
45:     /// @notice Changes the protocol version
```
[43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L43-L45)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

16: /// @notice Interface to which all the upgrade implementations should adhere 
17: abstract contract BaseZkSyncUpgradeGenesis is BaseZkSyncUpgrade {
18:     /// @notice Changes the protocol version
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L16-L18)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

9: /// @custom:security-contact security@matterlabs.dev 
10: contract DefaultUpgrade is BaseZkSyncUpgrade {
11:     /// @notice The main function that will be called by the upgrade proxy.
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L9-L11)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

10: /// @custom:security-contact security@matterlabs.dev 
11: contract GenesisUpgrade is BaseZkSyncUpgradeGenesis {
12:     /// @notice The main function that will be called by the upgrade proxy.
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L10-L12)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol

6:  
7: interface IDefaultUpgrade {
8:     function upgrade(ProposedUpgrade calldata _upgrade) external returns (bytes32);
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol#L6-L8)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

20:  
21: library AddressAliasHelper {
22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L20-L22)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

15:  */ 
16: contract BootloaderUtilities is IBootloaderUtilities {
17:     using TransactionHelper for *;
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L15-L17)

```solidity
📁 File: system-contracts/contracts/ComplexUpgrader.sol

13:  */ 
14: contract ComplexUpgrader is IComplexUpgrader {
15:     /// @notice Executes an upgrade process by delegating calls to another contract.
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L13-L15)

```solidity
📁 File: system-contracts/contracts/EmptyContract.sol

9:  */ 
10: contract EmptyContract {
11:     fallback() external payable {}
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L9-L11)

```solidity
📁 File: system-contracts/contracts/PubdataChunkPublisher.sol

15:  */ 
16: contract PubdataChunkPublisher is IPubdataChunkPublisher, ISystemContract {
17:     /// @notice Chunks pubdata into pieces that can fit into blobs.
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L15-L17)

</details>


---
### [NC&#x2011;82] NatSpec: Contract declarations should have `@notice` tags
`@notice` is used to explain to end users what the contract does, and the compiler interprets `///` or `/**` comments as this tag if one was't explicitly provided

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step { 
31:     using SafeERC20 for IERC20;
32: 
33:     /// @dev The address of the WETH token on L1.
34:     address public immutable override l1WethAddress;
35: 
36:     /// @dev Bridgehub smart contract that is used to operate with L2 via asynchronous L2 <-> L1 communication.
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30-L36)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol

12: interface IL1SharedBridge { 
13:     event LegacyDepositInitiated(
14:         uint256 indexed chainId,
15:         bytes32 indexed l2DepositTxHash,
16:         address indexed from,
17:         address to,
18:         address l1Token,
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L12-L18)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol

6: interface IL2Bridge { 
7:     function finalizeDeposit(
8:         address _l1Sender,
9:         address _l2Receiver,
10:         address _l1Token,
11:         uint256 _amount,
12:         bytes calldata _data
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol#L6-L12)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol

4: interface IWETH9 { 
5:     function deposit() external payable;
6: 
7:     function withdraw(uint256 wad) external;
8: }
9: 
```
[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol#L4-L9)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step { 
17:     /// @notice all the ether is held by the weth bridge
18:     IL1SharedBridge public sharedBridge;
19: 
20:     /// @notice we store registered stateTransitionManagers
21:     mapping(address _stateTransitionManager => bool) public stateTransitionManagerIsRegistered;
22:     /// @notice we store registered tokens (for arbitrary base token)
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16-L22)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

42: interface IBridgehub { 
43:     /// @notice pendingAdmin is changed
44:     /// @dev Also emitted when new admin is accepted and in this case, `newPendingAdmin` would be zero address
45:     event NewPendingAdmin(address indexed oldPendingAdmin, address indexed newPendingAdmin);
46: 
47:     /// @notice Admin changed
48:     event NewAdmin(address indexed oldAdmin, address indexed newAdmin);
```
[42](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L42-L48)

```solidity
📁 File: contracts/ethereum/contracts/governance/IGovernance.sol

8: interface IGovernance { 
9:     /// @dev This enumeration includes the following states:
10:     /// @param Unset Default state, indicating the operation has not been set.
11:     /// @param Waiting The operation is scheduled but not yet ready to be executed.
12:     /// @param Ready The operation is ready to be executed.
13:     /// @param Done The operation has been successfully executed.
14:     enum OperationState {
```
[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L8-L14)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

26: interface IStateTransitionManager { 
27:     // when a new Chain is added
28:     event StateTransitionNewChain(uint256 indexed _chainId, address indexed _stateTransitionContract);
29: 
30:     event SetChainIdUpgrade(
31:         address indexed _stateTransitionChain,
32:         L2CanonicalTransaction _l2Transaction,
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L26-L32)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step { 
26:     /// @notice Address of the bridgehub
27:     address public immutable bridgehub;
28: 
29:     /// @notice chainId => chainContract
30:     mapping(uint256 => address) public stateTransition;
31: 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L25-L31)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

17: contract DiamondInit is ZkSyncStateTransitionBase, IDiamondInit { 
18:     /// @dev Initialize the implementation to prevent any possibility of a Parity hack.
19:     constructor() reentrancyGuardInitializer {}
20: 
21:     /// @notice hyperchain diamond contract initialization
22:     /// @return Magic 32 bytes, which indicates that the contract logic is expected to be used as a diamond proxy
23:     /// initializer
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L17-L23)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

10: contract DiamondProxy { 
11:     constructor(uint256 _chainId, Diamond.DiamondCutData memory _diamondCut) {
12:         // Check that the contract is deployed on the expected chain.
13:         // Thus, the contract deployed by the same Create2 factory on the different chain will have different addresses!
14:         require(_chainId == block.chainid, "pr");
15:         Diamond.diamondCut(_diamondCut);
16:     }
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L10-L16)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

18: contract AdminFacet is ZkSyncStateTransitionBase, IAdmin { 
19:     /// @inheritdoc IZkSyncStateTransitionBase
20:     string public constant override getName = "AdminFacet";
21: 
22:     /// @inheritdoc IAdmin
23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin {
24:         // Save previous value into the stack to put it into the event later
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L18-L24)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

22: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor { 
23:     using UncheckedMath for uint256;
24:     using PriorityQueue for PriorityQueue.Queue;
25: 
26:     /// @inheritdoc IZkSyncStateTransitionBase
27:     string public constant override getName = "ExecutorFacet";
28: 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L22-L28)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

20: contract GettersFacet is ZkSyncStateTransitionBase, IGetters, ILegacyGetters { 
21:     using UncheckedMath for uint256;
22:     using PriorityQueue for PriorityQueue.Queue;
23: 
24:     /// @inheritdoc IZkSyncStateTransitionBase
25:     string public constant override getName = "GettersFacet";
26: 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L20-L26)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

30: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox { 
31:     using UncheckedMath for uint256;
32:     using PriorityQueue for PriorityQueue.Queue;
33: 
34:     /// @inheritdoc IZkSyncStateTransitionBase
35:     string public constant override getName = "MailboxFacet";
36: 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L30-L36)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol

11: contract ZkSyncStateTransitionBase is ReentrancyGuard { 
12:     ZkSyncStateTransitionStorage internal s;
13: 
14:     /// @notice Checks that the message sender is an active admin
15:     modifier onlyAdmin() {
16:         require(msg.sender == s.admin, "StateTransition Chain: not admin");
17:         _;
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L11-L17)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol

13: interface IAdmin is IZkSyncStateTransitionBase { 
14:     /// @notice Starts the transfer of admin rights. Only the current admin can propose a new pending one.
15:     /// @notice New admin can accept admin rights by calling `acceptAdmin` function.
16:     /// @param _newPendingAdmin Address of the new admin
17:     function setPendingAdmin(address _newPendingAdmin) external;
18: 
19:     /// @notice Accepts transfer of admin rights. Only pending admin can accept the role.
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L13-L19)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol

61: interface IDiamondInit { 
62:     function initialize(InitializeData calldata _initData) external returns (bytes32);
63: }
64: 
```
[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L61-L64)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol

73: interface IExecutor is IZkSyncStateTransitionBase { 
74:     /// @notice Rollup batch stored data
75:     /// @param batchNumber Rollup batch number
76:     /// @param batchHash Hash of L2 batch
77:     /// @param indexRepeatedStorageChanges The serial number of the shortcut index that's used as a unique identifier for storage keys that were used twice or more
78:     /// @param numberOfLayer1Txs Number of priority operations to be processed
79:     /// @param priorityOperationsHash Hash of all priority operations from this batch
```
[73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L73-L79)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol

13: interface IGetters is IZkSyncStateTransitionBase { 
14:     /*//////////////////////////////////////////////////////////////
15:                             CUSTOM GETTERS
16:     //////////////////////////////////////////////////////////////*/
17: 
18:     /// @return The address of the verifier smart contract
19:     function getVerifier() external view returns (address);
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L13-L19)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol

11: interface IMailbox is IZkSyncStateTransitionBase { 
12:     /// @notice Prove that a specific arbitrary-length message was sent in a specific L2 batch number
13:     /// @param _batchNumber The executed L2 batch number in which the message appeared
14:     /// @param _index The position in the L2 logs Merkle tree of the l2Log that was sent with the message
15:     /// @param _message Information about the sent message: sender address, the message itself, tx index in the L2 batch where the message was sent
16:     /// @param _proof Merkle proof for inclusion of L2 log that was sent with the message
17:     /// @return Whether the proof is valid
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L11-L17)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IVerifier.sol

15: interface IVerifier { 
16:     /// @dev Verifies a zk-SNARK proof.
17:     /// @return A boolean value indicating whether the zk-SNARK proof is valid.
18:     /// Note: The function may revert execution instead of returning false in some cases.
19:     function verify(
20:         uint256[] calldata _publicInputs,
21:         uint256[] calldata _proof,
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IVerifier.sol#L15-L21)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol

15: interface IZkSyncStateTransition is IAdmin, IExecutor, IGetters, IMailbox { 
16:     // KL todo: need this in the server for now
17:     event ProposeTransparentUpgrade(
18:         Diamond.DiamondCutData diamondCut,
19:         uint256 indexed proposalId,
20:         bytes32 proposalSalt
21:     );
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L15-L21)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransitionBase.sol

7: interface IZkSyncStateTransitionBase { 
8:     /// @return Returns facet name.
9:     function getName() external view returns (string memory);
10: }
11: 
```
[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransitionBase.sol#L7-L11)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol

4: interface ISystemContext { 
5:     function setChainId(uint256 _newChainId) external;
6: }
7: 
```
[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol#L4-L7)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Merkle.sol

9: library Merkle { 
10:     using UncheckedMath for uint256;
11: 
12:     /// @dev Calculate Merkle root by the provided Merkle proof.
13:     /// NOTE: When using this function, check that the _path length is equal to the tree height to prevent shorter/longer paths attack
14:     /// @param _path Merkle path from the leaf to the root
15:     /// @param _index Leaf index in the tree
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L9-L15)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol

20: library PriorityQueue { 
21:     using PriorityQueue for Queue;
22: 
23:     /// @notice Container that stores priority operations
24:     /// @param data The inner mapping that saves priority operation by its index
25:     /// @param head The pointer to the first unprocessed priority operation, equal to the tail if the queue is empty
26:     /// @param tail The pointer to the free slot
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L20-L26)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol

13: library TransactionValidator { 
14:     /// @dev Used to validate key properties of an L1->L2 transaction
15:     /// @param _transaction The transaction to validate
16:     /// @param _encoded The abi encoded bytes of the transaction
17:     /// @param _priorityTxMaxGasLimit The max gas limit, generally provided from Storage.sol
18:     /// @param _priorityTxMaxPubdata The maximal amount of pubdata that a single L1->L2 transaction can emit
19:     function validateL1ToL2Transaction(
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L13-L19)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

10: contract DefaultUpgrade is BaseZkSyncUpgrade { 
11:     /// @notice The main function that will be called by the upgrade proxy.
12:     /// @param _proposedUpgrade The upgrade to be executed.
13:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
14:         super.upgrade(_proposedUpgrade);
15:         return Diamond.DIAMOND_INIT_SUCCESS_RETURN_VALUE;
16:     }
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L10-L16)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

11: contract GenesisUpgrade is BaseZkSyncUpgradeGenesis { 
12:     /// @notice The main function that will be called by the upgrade proxy.
13:     /// @param _proposedUpgrade The upgrade to be executed.
14:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
15:         super.upgrade(_proposedUpgrade);
16:         return Diamond.DIAMOND_INIT_SUCCESS_RETURN_VALUE;
17:     }
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L11-L17)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol

7: interface IDefaultUpgrade { 
8:     function upgrade(ProposedUpgrade calldata _upgrade) external returns (bytes32);
9: }
10: 
```
[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol#L7-L10)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

21: library AddressAliasHelper { 
22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
23: 
24:     /// @notice Utility function converts the address that submitted a tx
25:     /// to the inbox on L1 to the msg.sender viewed on L2
26:     /// @param l1Address the address in the L1 that triggered the tx to L2
27:     /// @return l2Address L2 address as viewed in msg.sender
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L21-L27)

```solidity
📁 File: system-contracts/contracts/interfaces/IAccount.sol

9: interface IAccount { 
10:     /// @notice Called by the bootloader to validate that an account agrees to process the transaction
11:     /// (and potentially pay for it).
12:     /// @param _txHash The hash of the transaction to be used in the explorer
13:     /// @param _suggestedSignedHash The hash of the transaction is signed by EOAs
14:     /// @param _transaction The transaction itself
15:     /// @return magic The magic value that should be equal to the signature of this function
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IAccount.sol#L9-L15)

```solidity
📁 File: system-contracts/contracts/interfaces/IAccountCodeStorage.sol

5: interface IAccountCodeStorage { 
6:     function storeAccountConstructingCodeHash(address _address, bytes32 _hash) external;
7: 
8:     function storeAccountConstructedCodeHash(address _address, bytes32 _hash) external;
9: 
10:     function markAccountCodeHashAsConstructed(address _address) external;
11: 
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IAccountCodeStorage.sol#L5-L11)

```solidity
📁 File: system-contracts/contracts/interfaces/IBaseToken.sol

5: interface IBaseToken { 
6:     function balanceOf(uint256) external view returns (uint256);
7: 
8:     function transferFromTo(address _from, address _to, uint256 _amount) external;
9: 
10:     function totalSupply() external view returns (uint256);
11: 
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L5-L11)

```solidity
📁 File: system-contracts/contracts/interfaces/IBootloaderUtilities.sol

7: interface IBootloaderUtilities { 
8:     function getTransactionHashes(
9:         Transaction calldata _transaction
10:     ) external view returns (bytes32 txHash, bytes32 signedTxHash);
11: }
12: 
```
[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBootloaderUtilities.sol#L7-L12)

```solidity
📁 File: system-contracts/contracts/interfaces/IContractDeployer.sol

5: interface IContractDeployer { 
6:     /// @notice Defines the version of the account abstraction protocol
7:     /// that a contract claims to follow.
8:     /// - `None` means that the account is just a contract and it should never be interacted
9:     /// with as a custom account
10:     /// - `Version1` means that the account follows the first version of the account abstraction protocol
11:     enum AccountAbstractionVersion {
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L5-L11)

```solidity
📁 File: system-contracts/contracts/interfaces/IImmutableSimulator.sol

10: interface IImmutableSimulator { 
11:     function getImmutable(address _dest, uint256 _index) external view returns (bytes32);
12: 
13:     function setImmutables(address _dest, ImmutableData[] calldata _immutables) external;
14: }
15: 
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IImmutableSimulator.sol#L10-L15)

```solidity
📁 File: system-contracts/contracts/interfaces/IL2StandardToken.sol

5: interface IL2StandardToken { 
6:     event BridgeMint(address indexed _account, uint256 _amount);
7: 
8:     event BridgeBurn(address indexed _account, uint256 _amount);
9: 
10:     function bridgeMint(address _account, uint256 _amount) external;
11: 
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L5-L11)

```solidity
📁 File: system-contracts/contracts/libraries/Utils.sol

11: library Utils { 
12:     /// @dev Bit mask of bytecode hash "isConstructor" marker
13:     bytes32 constant IS_CONSTRUCTOR_BYTECODE_HASH_BIT_MASK =
14:         0x00ff000000000000000000000000000000000000000000000000000000000000;
15: 
16:     /// @dev Bit mask to set the "isConstructor" marker in the bytecode hash
17:     bytes32 constant SET_IS_CONSTRUCTOR_MARKER_BIT_MASK =
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L11-L17)

</details>


---
### [NC&#x2011;83] NatSpec: Contract declarations should have `@title` tags
<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

18: /// It is needed for backward compatibility with already integrated projects. 
19: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard {
20:     using SafeERC20 for IERC20;
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L18-L20)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

29: /// @dev Designed for use with a proxy for upgradability. 
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step {
31:     using SafeERC20 for IERC20;
```
[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L29-L31)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol

5: /// @author Matter Labs 
6: interface IL2Bridge {
7:     function finalizeDeposit(
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol#L5-L7)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol

3:  
4: interface IWETH9 {
5:     function deposit() external payable;
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol#L3-L5)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

15:  
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step {
17:     /// @notice all the ether is held by the weth bridge
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L15-L17)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

41:  
42: interface IBridgehub {
43:     /// @notice pendingAdmin is changed
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L41-L43)

```solidity
📁 File: contracts/ethereum/contracts/common/ReentrancyGuard.sol

24:  */ 
25: abstract contract ReentrancyGuard {
26:     /// @dev Address of lock flag variable.
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L24-L26)

```solidity
📁 File: contracts/ethereum/contracts/common/interfaces/IL2ContractDeployer.sol

8:  */ 
9: interface IL2ContractDeployer {
10:     /// @notice A struct that describes a forced deployment on an address.
```
[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/interfaces/IL2ContractDeployer.sol#L8-L10)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

9:  */ 
10: library L2ContractHelper {
11:     /// @dev The prefix used to create CREATE2 addresses.
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L9-L11)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/UncheckedMath.sol

9:  */ 
10: library UncheckedMath {
11:     function uncheckedInc(uint256 _number) internal pure returns (uint256) {
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L9-L11)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol

17:  */ 
18: library UnsafeBytes {
19:     function readUint32(bytes memory _bytes, uint256 _start) internal pure returns (uint32 result, uint256 offset) {
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L17-L19)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

19: /// with the security council’s permission. 
20: contract Governance is IGovernance, Ownable2Step {
21:     /// @notice A constant representing the timestamp for completed operations.
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L19-L21)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

25:  
26: interface IStateTransitionManager {
27:     // when a new Chain is added
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L25-L27)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

21: /// was committed not earlier than X time ago. 
22: contract ValidatorTimelock is IExecutor, Ownable2Step {
23:     using LibMap for LibMap.Uint32Map;
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L21-L23)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

16: /// @dev The deployment process takes care of this contract's initialization. 
17: contract DiamondInit is ZkSyncStateTransitionBase, IDiamondInit {
18:     /// @dev Initialize the implementation to prevent any possibility of a Parity hack.
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L16-L18)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol

60:  
61: interface IDiamondInit {
62:     function initialize(InitializeData calldata _initData) external returns (bytes32);
```
[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L60-L62)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/ILegacyGetters.sol

10: /// @custom:security-contact security@matterlabs.dev 
11: interface ILegacyGetters is IZkSyncStateTransitionBase {
12:     /// @return The total number of batches that were committed
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/ILegacyGetters.sol#L10-L12)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol

14:  
15: interface IZkSyncStateTransition is IAdmin, IExecutor, IGetters, IMailbox {
16:     // KL todo: need this in the server for now
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L14-L16)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol

3:  
4: interface ISystemContext {
5:     function setChainId(uint256 _newChainId) external;
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol#L3-L5)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

10: /// @notice The helper library for managing the EIP-2535 diamond proxy. 
11: library Diamond {
12:     using UncheckedMath for uint256;
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L10-L12)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/LibMap.sol

7: /// @custom:security-contact security@matterlabs.dev 
8: library LibMap {
9:     /// @dev A uint32 map in storage.
```
[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L7-L9)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Merkle.sol

8: /// @custom:security-contact security@matterlabs.dev 
9: library Merkle {
10:     using UncheckedMath for uint256;
```
[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L8-L10)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol

19: /// @dev Order of processing operations from queue - FIFO (Fist in - first out) 
20: library PriorityQueue {
21:     using PriorityQueue for Queue;
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L19-L21)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

43: /// @notice Interface to which all the upgrade implementations should adhere 
44: abstract contract BaseZkSyncUpgrade is ZkSyncStateTransitionBase {
45:     /// @notice Changes the protocol version
```
[43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L43-L45)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

16: /// @notice Interface to which all the upgrade implementations should adhere 
17: abstract contract BaseZkSyncUpgradeGenesis is BaseZkSyncUpgrade {
18:     /// @notice Changes the protocol version
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L16-L18)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

9: /// @custom:security-contact security@matterlabs.dev 
10: contract DefaultUpgrade is BaseZkSyncUpgrade {
11:     /// @notice The main function that will be called by the upgrade proxy.
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L9-L11)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

10: /// @custom:security-contact security@matterlabs.dev 
11: contract GenesisUpgrade is BaseZkSyncUpgradeGenesis {
12:     /// @notice The main function that will be called by the upgrade proxy.
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L10-L12)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol

6:  
7: interface IDefaultUpgrade {
8:     function upgrade(ProposedUpgrade calldata _upgrade) external returns (bytes32);
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol#L6-L8)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

20:  
21: library AddressAliasHelper {
22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L20-L22)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

21:  */ 
22: contract AccountCodeStorage is IAccountCodeStorage {
23:     bytes32 constant EMPTY_STRING_KECCAK = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470;
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L21-L23)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

15:  */ 
16: contract BootloaderUtilities is IBootloaderUtilities {
17:     using TransactionHelper for *;
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L15-L17)

```solidity
📁 File: system-contracts/contracts/ComplexUpgrader.sol

13:  */ 
14: contract ComplexUpgrader is IComplexUpgrader {
15:     /// @notice Executes an upgrade process by delegating calls to another contract.
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L13-L15)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

21:  */ 
22: contract Compressor is ICompressor, ISystemContract {
23:     using UnsafeBytesCalldata for bytes;
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L21-L23)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

22:  */ 
23: contract ContractDeployer is IContractDeployer, ISystemContract {
24:     /// @notice Information about an account contract.
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L22-L24)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

18:  */ 
19: contract DefaultAccount is IAccount {
20:     using TransactionHelper for *;
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L18-L20)

```solidity
📁 File: system-contracts/contracts/EmptyContract.sol

9:  */ 
10: contract EmptyContract {
11:     fallback() external payable {}
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L9-L11)

```solidity
📁 File: system-contracts/contracts/ImmutableSimulator.sol

17:  */ 
18: contract ImmutableSimulator is IImmutableSimulator {
19:     /// @dev mapping (contract address) => (index of immutable variable) => value
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L17-L19)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

17:  */ 
18: contract KnownCodesStorage is IKnownCodesStorage, ISystemContract {
19:     modifier onlyCompressor() {
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L17-L19)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

24:  */ 
25: contract L1Messenger is IL1Messenger, ISystemContract {
26:     /// @notice Sequential hash of logs sent in the current block.
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L24-L26)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

17:  */ 
18: contract L2BaseToken is IBaseToken, ISystemContract {
19:     /// @notice The balances of the users.
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L17-L19)

</details>


---
### [NC&#x2011;84] NatSpec: Contract declarations should have NatSpec descriptions
It is recommended that Solidity libraries and contracts are fully annotated using NatSpec for all public interfaces (everything in the ABI). It is clearly stated in the Solidity official documentation. In complex projects such as DeFi, the interpretation of all functions and their arguments and returns is important for code readability and auditability.

<details>
<summary><i>There are 22 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol

4: interface IWETH9 { 
5:     function deposit() external payable;
6: 
7:     function withdraw(uint256 wad) external;
8: }
9: 
```
[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol#L4-L9)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step { 
17:     /// @notice all the ether is held by the weth bridge
18:     IL1SharedBridge public sharedBridge;
19: 
20:     /// @notice we store registered stateTransitionManagers
21:     mapping(address _stateTransitionManager => bool) public stateTransitionManagerIsRegistered;
22:     /// @notice we store registered tokens (for arbitrary base token)
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16-L22)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

42: interface IBridgehub { 
43:     /// @notice pendingAdmin is changed
44:     /// @dev Also emitted when new admin is accepted and in this case, `newPendingAdmin` would be zero address
45:     event NewPendingAdmin(address indexed oldPendingAdmin, address indexed newPendingAdmin);
46: 
47:     /// @notice Admin changed
48:     event NewAdmin(address indexed oldAdmin, address indexed newAdmin);
```
[42](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L42-L48)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

26: interface IStateTransitionManager { 
27:     // when a new Chain is added
28:     event StateTransitionNewChain(uint256 indexed _chainId, address indexed _stateTransitionContract);
29: 
30:     event SetChainIdUpgrade(
31:         address indexed _stateTransitionChain,
32:         L2CanonicalTransaction _l2Transaction,
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L26-L32)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol

61: interface IDiamondInit { 
62:     function initialize(InitializeData calldata _initData) external returns (bytes32);
63: }
64: 
```
[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L61-L64)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol

15: interface IZkSyncStateTransition is IAdmin, IExecutor, IGetters, IMailbox { 
16:     // KL todo: need this in the server for now
17:     event ProposeTransparentUpgrade(
18:         Diamond.DiamondCutData diamondCut,
19:         uint256 indexed proposalId,
20:         bytes32 proposalSalt
21:     );
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L15-L21)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol

4: interface ISystemContext { 
5:     function setChainId(uint256 _newChainId) external;
6: }
7: 
```
[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol#L4-L7)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol

7: interface IDefaultUpgrade { 
8:     function upgrade(ProposedUpgrade calldata _upgrade) external returns (bytes32);
9: }
10: 
```
[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol#L7-L10)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

21: library AddressAliasHelper { 
22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
23: 
24:     /// @notice Utility function converts the address that submitted a tx
25:     /// to the inbox on L1 to the msg.sender viewed on L2
26:     /// @param l1Address the address in the L1 that triggered the tx to L2
27:     /// @return l2Address L2 address as viewed in msg.sender
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L21-L27)

```solidity
📁 File: contracts/zksync/contracts/SystemContractsCaller.sol

26: library Utils { 
27:     function safeCastToU32(uint256 _x) internal pure returns (uint32) {
28:         require(_x <= type(uint32).max, "Overflow");
29: 
30:         return uint32(_x);
31:     }
32: }
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L26-L32)

```solidity
📁 File: contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol

5: interface IL2StandardToken { 
6:     event BridgeInitialize(address indexed l1Token, string name, string symbol, uint8 decimals);
7: 
8:     event BridgeMint(address indexed _account, uint256 _amount);
9: 
10:     event BridgeBurn(address indexed _account, uint256 _amount);
11: 
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L5-L11)

```solidity
📁 File: contracts/zksync/contracts/interfaces/IPaymaster.sol

14: interface IPaymaster { 
15:     /// @dev Called by the bootloader to verify that the paymaster agrees to pay for the
16:     /// fee for the transaction. This transaction should also send the necessary amount of funds onto the bootloader
17:     /// address.
18:     /// @param _txHash The hash of the transaction
19:     /// @param _suggestedSignedHash The hash of the transaction that is signed by an EOA
20:     /// @param _transaction The transaction itself.
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L14-L20)

```solidity
📁 File: contracts/zksync/contracts/vendor/AddressAliasHelper.sol

21: library AddressAliasHelper { 
22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
23: 
24:     /// @notice Utility function converts the address that submitted a tx
25:     /// to the inbox on L1 to the msg.sender viewed on L2
26:     /// @param l1Address the address in the L1 that triggered the tx to L2
27:     /// @return l2Address L2 address as viewed in msg.sender
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L21-L27)

```solidity
📁 File: system-contracts/contracts/interfaces/IAccount.sol

9: interface IAccount { 
10:     /// @notice Called by the bootloader to validate that an account agrees to process the transaction
11:     /// (and potentially pay for it).
12:     /// @param _txHash The hash of the transaction to be used in the explorer
13:     /// @param _suggestedSignedHash The hash of the transaction is signed by EOAs
14:     /// @param _transaction The transaction itself
15:     /// @return magic The magic value that should be equal to the signature of this function
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IAccount.sol#L9-L15)

```solidity
📁 File: system-contracts/contracts/interfaces/IAccountCodeStorage.sol

5: interface IAccountCodeStorage { 
6:     function storeAccountConstructingCodeHash(address _address, bytes32 _hash) external;
7: 
8:     function storeAccountConstructedCodeHash(address _address, bytes32 _hash) external;
9: 
10:     function markAccountCodeHashAsConstructed(address _address) external;
11: 
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IAccountCodeStorage.sol#L5-L11)

```solidity
📁 File: system-contracts/contracts/interfaces/IBaseToken.sol

5: interface IBaseToken { 
6:     function balanceOf(uint256) external view returns (uint256);
7: 
8:     function transferFromTo(address _from, address _to, uint256 _amount) external;
9: 
10:     function totalSupply() external view returns (uint256);
11: 
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L5-L11)

```solidity
📁 File: system-contracts/contracts/interfaces/IBootloaderUtilities.sol

7: interface IBootloaderUtilities { 
8:     function getTransactionHashes(
9:         Transaction calldata _transaction
10:     ) external view returns (bytes32 txHash, bytes32 signedTxHash);
11: }
12: 
```
[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBootloaderUtilities.sol#L7-L12)

```solidity
📁 File: system-contracts/contracts/interfaces/IContractDeployer.sol

5: interface IContractDeployer { 
6:     /// @notice Defines the version of the account abstraction protocol
7:     /// that a contract claims to follow.
8:     /// - `None` means that the account is just a contract and it should never be interacted
9:     /// with as a custom account
10:     /// - `Version1` means that the account follows the first version of the account abstraction protocol
11:     enum AccountAbstractionVersion {
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L5-L11)

```solidity
📁 File: system-contracts/contracts/interfaces/IImmutableSimulator.sol

10: interface IImmutableSimulator { 
11:     function getImmutable(address _dest, uint256 _index) external view returns (bytes32);
12: 
13:     function setImmutables(address _dest, ImmutableData[] calldata _immutables) external;
14: }
15: 
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IImmutableSimulator.sol#L10-L15)

```solidity
📁 File: system-contracts/contracts/interfaces/IL2StandardToken.sol

5: interface IL2StandardToken { 
6:     event BridgeMint(address indexed _account, uint256 _amount);
7: 
8:     event BridgeBurn(address indexed _account, uint256 _amount);
9: 
10:     function bridgeMint(address _account, uint256 _amount) external;
11: 
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L5-L11)

```solidity
📁 File: system-contracts/contracts/interfaces/IMailbox.sol

5: interface IMailbox { 
6:     function finalizeEthWithdrawal(
7:         uint256 _l2BatchNumber,
8:         uint256 _l2MessageIndex,
9:         uint16 _l2TxNumberInBlock,
10:         bytes calldata _message,
11:         bytes32[] calldata _merkleProof
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IMailbox.sol#L5-L11)

```solidity
📁 File: system-contracts/contracts/interfaces/IPaymaster.sol

14: interface IPaymaster { 
15:     /// @dev Called by the bootloader to verify that the paymaster agrees to pay for the
16:     /// fee for the transaction. This transaction should also send the necessary amount of funds onto the bootloader
17:     /// address.
18:     /// @param _txHash The hash of the transaction
19:     /// @param _suggestedSignedHash The hash of the transaction that is signed by an EOA
20:     /// @param _transaction The transaction itself.
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IPaymaster.sol#L14-L20)

</details>


---
### [NC&#x2011;85] NatSpec: Error missing NatSpec `@dev` tag

<i>There are 2 instaces of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

37:     /// @notice Error for when an address is already a validator. 
38:     error AddressAlreadyValidator(uint256 _chainId);
39: 
40:     /// @notice Error for when an address is not a validator.
41:     error ValidatorDoesNotExist(uint256 _chainId);
42: 
```
[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L37-L42)


---
### [NC&#x2011;86] NatSpec: Error missing NatSpec `@param` tag

<i>There are 2 instaces of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit Missing @param for all error parameters
38:     error AddressAlreadyValidator(uint256 _chainId); 

/// @audit Missing @param for all error parameters
41:     error ValidatorDoesNotExist(uint256 _chainId); 
```
[38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L38), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L41)


---
### [NC&#x2011;87] NatSpec: Event declarations should have `@notice` tags
`@notice` is used to explain to end users what the event emits, and the compiler interprets `///` or `/**` comments as this tag if one was't explicitly provided

<details>
<summary><i>There are 34 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol

12:     event DepositInitiated( 
13:         bytes32 indexed l2DepositTxHash,
14:         address indexed from,
15:         address indexed to,
16:         address l1Token,
17:         uint256 amount
18:     );

20:     event WithdrawalFinalized(address indexed to, address indexed l1Token, uint256 amount); 

22:     event ClaimedFailedDeposit(address indexed to, address indexed l1Token, uint256 amount); 
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L12-L18), [20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L20), [22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L22)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol

13:     event LegacyDepositInitiated( 
14:         uint256 indexed chainId,
15:         bytes32 indexed l2DepositTxHash,
16:         address indexed from,
17:         address to,
18:         address l1Token,
19:         uint256 amount
20:     );

22:     event BridgehubDepositInitiated( 
23:         uint256 indexed chainId,
24:         bytes32 indexed txDataHash,
25:         address indexed from,
26:         address to,
27:         address l1Token,
28:         uint256 amount
29:     );

31:     event BridgehubDepositBaseTokenInitiated( 
32:         uint256 indexed chainId,
33:         address indexed from,
34:         address l1Token,
35:         uint256 amount
36:     );

38:     event BridgehubDepositFinalized( 
39:         uint256 indexed chainId,
40:         bytes32 indexed txDataHash,
41:         bytes32 indexed l2DepositTxHash
42:     );

44:     event WithdrawalFinalizedSharedBridge( 
45:         uint256 indexed chainId,
46:         address indexed to,
47:         address indexed l1Token,
48:         uint256 amount
49:     );

51:     event ClaimedFailedDepositSharedBridge( 
52:         uint256 indexed chainId,
53:         address indexed to,
54:         address indexed l1Token,
55:         uint256 amount
56:     );
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L13-L20), [22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L22-L29), [31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L31-L36), [38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L38-L42), [44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L44-L49), [51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L51-L56)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

133:     event NewChain(uint256 indexed chainId, address stateTransitionManager, address indexed chainGovernance); 
```
[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L133)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

28:     event StateTransitionNewChain(uint256 indexed _chainId, address indexed _stateTransitionContract); 

30:     event SetChainIdUpgrade( 
31:         address indexed _stateTransitionChain,
32:         L2CanonicalTransaction _l2Transaction,
33:         uint256 indexed _protocolVersion
34:     );
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L28), [30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L30-L34)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol

17:     event ProposeTransparentUpgrade( 
18:         Diamond.DiamondCutData diamondCut,
19:         uint256 indexed proposalId,
20:         bytes32 proposalSalt
21:     );
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L17-L21)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

24:     event DiamondCut(FacetCut[] facetCuts, address initAddress, bytes initCalldata); 
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L24)

```solidity
📁 File: contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol

7:     event FinalizeDeposit( 
8:         address indexed l1Sender,
9:         address indexed l2Receiver,
10:         address indexed l2Token,
11:         uint256 amount
12:     );

14:     event WithdrawalInitiated( 
15:         address indexed l2Sender,
16:         address indexed l1Receiver,
17:         address indexed l2Token,
18:         uint256 amount
19:     );

22:     event BaseTokenReceived(uint256 amount); 
```
[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L7-L12), [14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L14-L19), [22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L22)

```solidity
📁 File: contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol

6:     event BridgeInitialize(address indexed l1Token, string name, string symbol, uint8 decimals); 

8:     event BridgeMint(address indexed _account, uint256 _amount); 

10:     event BridgeBurn(address indexed _account, uint256 _amount); 
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L6), [8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L8), [10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L10)

```solidity
📁 File: system-contracts/contracts/interfaces/IBaseToken.sol

24:     event Mint(address indexed account, uint256 amount); 

26:     event Transfer(address indexed from, address indexed to, uint256 value); 

28:     event Withdrawal(address indexed _l2Sender, address indexed _l1Receiver, uint256 _amount); 

30:     event WithdrawalWithMessage( 
31:         address indexed _l2Sender,
32:         address indexed _l1Receiver,
33:         uint256 _amount,
34:         bytes _additionalData
35:     );
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L24), [26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L26), [28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L28), [30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L30-L35)

```solidity
📁 File: system-contracts/contracts/interfaces/IContractDeployer.sol

33:     event ContractDeployed( 
34:         address indexed deployerAddress,
35:         bytes32 indexed bytecodeHash,
36:         address indexed contractAddress
37:     );

39:     event AccountNonceOrderingUpdated(address indexed accountAddress, AccountNonceOrdering nonceOrdering); 

41:     event AccountVersionUpdated(address indexed accountAddress, AccountAbstractionVersion aaVersion); 
```
[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L33-L37), [39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L39), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L41)

```solidity
📁 File: system-contracts/contracts/interfaces/IKnownCodesStorage.sol

12:     event MarkedAsKnown(bytes32 indexed bytecodeHash, bool indexed sendBytecodeToL1); 
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IKnownCodesStorage.sol#L12)

```solidity
📁 File: system-contracts/contracts/interfaces/IL1Messenger.sol

43:     event L1MessageSent(address indexed _sender, bytes32 indexed _hash, bytes _message); 

45:     event L2ToL1LogSent(L2ToL1Log _l2log); 

47:     event BytecodeL1PublicationRequested(bytes32 _bytecodeHash); 
```
[43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L43), [45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L45), [47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L47)

```solidity
📁 File: system-contracts/contracts/interfaces/IL2StandardToken.sol

6:     event BridgeMint(address indexed _account, uint256 _amount); 

8:     event BridgeBurn(address indexed _account, uint256 _amount); 
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L6), [8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L8)

```solidity
📁 File: system-contracts/contracts/interfaces/INonceHolder.sol

14:     event ValueSetUnderNonce(address indexed accountAddress, uint256 indexed key, uint256 value); 
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/INonceHolder.sol#L14)

</details>


---
### [NC&#x2011;88] NatSpec: Event declarations should have NatSpec descriptions
It is recommended that events are fully annotated using NatSpec.

<details>
<summary><i>There are 33 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol

12:     event DepositInitiated( 
13:         bytes32 indexed l2DepositTxHash,
14:         address indexed from,
15:         address indexed to,
16:         address l1Token,
17:         uint256 amount
18:     );

20:     event WithdrawalFinalized(address indexed to, address indexed l1Token, uint256 amount); 

22:     event ClaimedFailedDeposit(address indexed to, address indexed l1Token, uint256 amount); 
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L12-L18), [20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L20), [22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L22)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol

13:     event LegacyDepositInitiated( 
14:         uint256 indexed chainId,
15:         bytes32 indexed l2DepositTxHash,
16:         address indexed from,
17:         address to,
18:         address l1Token,
19:         uint256 amount
20:     );

22:     event BridgehubDepositInitiated( 
23:         uint256 indexed chainId,
24:         bytes32 indexed txDataHash,
25:         address indexed from,
26:         address to,
27:         address l1Token,
28:         uint256 amount
29:     );

31:     event BridgehubDepositBaseTokenInitiated( 
32:         uint256 indexed chainId,
33:         address indexed from,
34:         address l1Token,
35:         uint256 amount
36:     );

38:     event BridgehubDepositFinalized( 
39:         uint256 indexed chainId,
40:         bytes32 indexed txDataHash,
41:         bytes32 indexed l2DepositTxHash
42:     );

44:     event WithdrawalFinalizedSharedBridge( 
45:         uint256 indexed chainId,
46:         address indexed to,
47:         address indexed l1Token,
48:         uint256 amount
49:     );

51:     event ClaimedFailedDepositSharedBridge( 
52:         uint256 indexed chainId,
53:         address indexed to,
54:         address indexed l1Token,
55:         uint256 amount
56:     );
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L13-L20), [22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L22-L29), [31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L31-L36), [38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L38-L42), [44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L44-L49), [51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L51-L56)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

133:     event NewChain(uint256 indexed chainId, address stateTransitionManager, address indexed chainGovernance); 
```
[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L133)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

28:     event StateTransitionNewChain(uint256 indexed _chainId, address indexed _stateTransitionContract); 

30:     event SetChainIdUpgrade( 
31:         address indexed _stateTransitionChain,
32:         L2CanonicalTransaction _l2Transaction,
33:         uint256 indexed _protocolVersion
34:     );
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L28), [30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L30-L34)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol

17:     event ProposeTransparentUpgrade( 
18:         Diamond.DiamondCutData diamondCut,
19:         uint256 indexed proposalId,
20:         bytes32 proposalSalt
21:     );
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L17-L21)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

24:     event DiamondCut(FacetCut[] facetCuts, address initAddress, bytes initCalldata); 
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L24)

```solidity
📁 File: contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol

7:     event FinalizeDeposit( 
8:         address indexed l1Sender,
9:         address indexed l2Receiver,
10:         address indexed l2Token,
11:         uint256 amount
12:     );

14:     event WithdrawalInitiated( 
15:         address indexed l2Sender,
16:         address indexed l1Receiver,
17:         address indexed l2Token,
18:         uint256 amount
19:     );
```
[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L7-L12), [14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L14-L19)

```solidity
📁 File: contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol

6:     event BridgeInitialize(address indexed l1Token, string name, string symbol, uint8 decimals); 

8:     event BridgeMint(address indexed _account, uint256 _amount); 

10:     event BridgeBurn(address indexed _account, uint256 _amount); 
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L6), [8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L8), [10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L10)

```solidity
📁 File: system-contracts/contracts/interfaces/IBaseToken.sol

24:     event Mint(address indexed account, uint256 amount); 

26:     event Transfer(address indexed from, address indexed to, uint256 value); 

28:     event Withdrawal(address indexed _l2Sender, address indexed _l1Receiver, uint256 _amount); 

30:     event WithdrawalWithMessage( 
31:         address indexed _l2Sender,
32:         address indexed _l1Receiver,
33:         uint256 _amount,
34:         bytes _additionalData
35:     );
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L24), [26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L26), [28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L28), [30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L30-L35)

```solidity
📁 File: system-contracts/contracts/interfaces/IContractDeployer.sol

33:     event ContractDeployed( 
34:         address indexed deployerAddress,
35:         bytes32 indexed bytecodeHash,
36:         address indexed contractAddress
37:     );

39:     event AccountNonceOrderingUpdated(address indexed accountAddress, AccountNonceOrdering nonceOrdering); 

41:     event AccountVersionUpdated(address indexed accountAddress, AccountAbstractionVersion aaVersion); 
```
[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L33-L37), [39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L39), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L41)

```solidity
📁 File: system-contracts/contracts/interfaces/IKnownCodesStorage.sol

12:     event MarkedAsKnown(bytes32 indexed bytecodeHash, bool indexed sendBytecodeToL1); 
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IKnownCodesStorage.sol#L12)

```solidity
📁 File: system-contracts/contracts/interfaces/IL1Messenger.sol

43:     event L1MessageSent(address indexed _sender, bytes32 indexed _hash, bytes _message); 

45:     event L2ToL1LogSent(L2ToL1Log _l2log); 

47:     event BytecodeL1PublicationRequested(bytes32 _bytecodeHash); 
```
[43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L43), [45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L45), [47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L47)

```solidity
📁 File: system-contracts/contracts/interfaces/IL2StandardToken.sol

6:     event BridgeMint(address indexed _account, uint256 _amount); 

8:     event BridgeBurn(address indexed _account, uint256 _amount); 
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L6), [8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L8)

```solidity
📁 File: system-contracts/contracts/interfaces/INonceHolder.sol

14:     event ValueSetUnderNonce(address indexed accountAddress, uint256 indexed key, uint256 value); 
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/INonceHolder.sol#L14)

</details>


---
### [NC&#x2011;89] NatSpec: Event missing NatSpec `@dev` tag
<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol

11: interface IL1ERC20Bridge { 
12:     event DepositInitiated(
13:         bytes32 indexed l2DepositTxHash,

19:  
20:     event WithdrawalFinalized(address indexed to, address indexed l1Token, uint256 amount);
21: 
22:     event ClaimedFailedDeposit(address indexed to, address indexed l1Token, uint256 amount);
23: 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L11-L13), [19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L19-L23)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol

12: interface IL1SharedBridge { 
13:     event LegacyDepositInitiated(
14:         uint256 indexed chainId,

21:  
22:     event BridgehubDepositInitiated(
23:         uint256 indexed chainId,

30:  
31:     event BridgehubDepositBaseTokenInitiated(
32:         uint256 indexed chainId,

37:  
38:     event BridgehubDepositFinalized(
39:         uint256 indexed chainId,

43:  
44:     event WithdrawalFinalizedSharedBridge(
45:         uint256 indexed chainId,

50:  
51:     event ClaimedFailedDepositSharedBridge(
52:         uint256 indexed chainId,
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L12-L14), [21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L21-L23), [30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L30-L32), [37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L37-L39), [43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L43-L45), [50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L50-L52)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

47:     /// @notice Admin changed 
48:     event NewAdmin(address indexed oldAdmin, address indexed newAdmin);
49: 

132:  
133:     event NewChain(uint256 indexed chainId, address stateTransitionManager, address indexed chainGovernance);
134: }
```
[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L47-L49), [132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L132-L134)

```solidity
📁 File: contracts/ethereum/contracts/governance/IGovernance.sol

67:     /// @notice Emitted when transparent operation is scheduled. 
68:     event TransparentOperationScheduled(bytes32 indexed _id, uint256 delay, Operation _operation);
69: 
70:     /// @notice Emitted when shadow operation is scheduled.
71:     event ShadowOperationScheduled(bytes32 indexed _id, uint256 delay);
72: 
73:     /// @notice Emitted when the operation is executed with delay or instantly.
74:     event OperationExecuted(bytes32 indexed _id);
75: 
76:     /// @notice Emitted when the security council address is changed.
77:     event ChangeSecurityCouncil(address _securityCouncilBefore, address _securityCouncilAfter);
78: 
79:     /// @notice Emitted when the minimum delay for future operations is modified.
80:     event ChangeMinDelay(uint256 _delayBefore, uint256 _delayAfter);
81: 
82:     /// @notice Emitted when the operation with specified id is cancelled.
83:     event OperationCancelled(bytes32 indexed _id);
84: }
```
[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L67-L84)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

27:     // when a new Chain is added 
28:     event StateTransitionNewChain(uint256 indexed _chainId, address indexed _stateTransitionContract);
29: 
30:     event SetChainIdUpgrade(
31:         address indexed _stateTransitionChain,

40:     /// @notice Admin changed 
41:     event NewAdmin(address indexed oldAdmin, address indexed newAdmin);
42: 
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L27-L31), [40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L40-L42)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

28:     /// @notice The delay between committing and executing batches is changed. 
29:     event NewExecutionDelay(uint256 _newExecutionDelay);
30: 
31:     /// @notice A new validator has been added.
32:     event ValidatorAdded(uint256 _chainId, address _addedValidator);
33: 
34:     /// @notice A validator has been removed.
35:     event ValidatorRemoved(uint256 _chainId, address _removedValidator);
36: 
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L28-L36)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol

60:     /// @notice Porter availability status changes 
61:     event IsPorterAvailableStatusUpdate(bool isPorterAvailable);
62: 
63:     /// @notice Validator's status changed
64:     event ValidatorStatusUpdate(address indexed validatorAddress, bool isActive);
65: 

70:     /// @notice Admin changed 
71:     event NewAdmin(address indexed oldAdmin, address indexed newAdmin);
72: 
73:     /// @notice Priority transaction max L2 gas limit changed
74:     event NewPriorityTxMaxGasLimit(uint256 oldPriorityTxMaxGasLimit, uint256 newPriorityTxMaxGasLimit);
75: 
76:     /// @notice Fee params for L1->L2 transactions changed
77:     event NewFeeParams(FeeParams oldFeeParams, FeeParams newFeeParams);
78: 
79:     /// @notice Validium mode status changed
80:     event ValidiumModeStatusUpdate(PubdataPricingMode validiumMode);
81: 
82:     /// @notice BaseToken multiplier for L1->L2 transactions changed
83:     event NewBaseTokenMultiplier(
84:         uint128 oldNominator,

90:     /// @notice Emitted when an upgrade is executed. 
91:     event ExecuteUpgrade(Diamond.DiamondCutData diamondCut);
92: 
93:     /// @notice Emitted when the contract is frozen.
94:     event Freeze();
95: 
96:     /// @notice Emitted when the contract is unfrozen.
97:     event Unfreeze();
98: }
```
[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L60-L65), [70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L70-L84), [90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L90-L98)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

23:  
24:     event DiamondCut(FacetCut[] facetCuts, address initAddress, bytes initCalldata);
25: 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L23-L25)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

45:     /// @notice Changes the protocol version 
46:     event NewProtocolVersion(uint256 indexed previousProtocolVersion, uint256 indexed newProtocolVersion);
47: 
48:     /// @notice Сhanges to the bytecode that is used in L2 as a bootloader (start program)
49:     event NewL2BootloaderBytecodeHash(bytes32 indexed previousBytecodeHash, bytes32 indexed newBytecodeHash);
50: 
51:     /// @notice Сhanges to the bytecode that is used in L2 as a default account
52:     event NewL2DefaultAccountBytecodeHash(bytes32 indexed previousBytecodeHash, bytes32 indexed newBytecodeHash);
53: 
54:     /// @notice Verifier address changed
55:     event NewVerifier(address indexed oldVerifier, address indexed newVerifier);
56: 
57:     /// @notice Verifier parameters changed
58:     event NewVerifierParams(VerifierParams oldVerifierParams, VerifierParams newVerifierParams);
59: 
60:     /// @notice Notifies about complete upgrade
61:     event UpgradeComplete(uint256 indexed newProtocolVersion, bytes32 indexed l2UpgradeTxHash, ProposedUpgrade upgrade);
62: 
```
[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L45-L62)

</details>


---
### [NC&#x2011;90] NatSpec: Event missing NatSpec `@param` tag
<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol

/// @audit Missing @param for all event parameters
12:     event DepositInitiated( 
13:         bytes32 indexed l2DepositTxHash,
14:         address indexed from,
15:         address indexed to,
16:         address l1Token,
17:         uint256 amount
18:     );

/// @audit Missing @param for all event parameters
20:     event WithdrawalFinalized(address indexed to, address indexed l1Token, uint256 amount); 

/// @audit Missing @param for all event parameters
22:     event ClaimedFailedDeposit(address indexed to, address indexed l1Token, uint256 amount); 
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L12-L18), [20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L20), [22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L22)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol

/// @audit Missing @param for all event parameters
13:     event LegacyDepositInitiated( 
14:         uint256 indexed chainId,
15:         bytes32 indexed l2DepositTxHash,
16:         address indexed from,
17:         address to,
18:         address l1Token,
19:         uint256 amount
20:     );

/// @audit Missing @param for all event parameters
22:     event BridgehubDepositInitiated( 
23:         uint256 indexed chainId,
24:         bytes32 indexed txDataHash,
25:         address indexed from,
26:         address to,
27:         address l1Token,
28:         uint256 amount
29:     );

/// @audit Missing @param for all event parameters
31:     event BridgehubDepositBaseTokenInitiated( 
32:         uint256 indexed chainId,
33:         address indexed from,
34:         address l1Token,
35:         uint256 amount
36:     );

/// @audit Missing @param for all event parameters
38:     event BridgehubDepositFinalized( 
39:         uint256 indexed chainId,
40:         bytes32 indexed txDataHash,
41:         bytes32 indexed l2DepositTxHash
42:     );

/// @audit Missing @param for all event parameters
44:     event WithdrawalFinalizedSharedBridge( 
45:         uint256 indexed chainId,
46:         address indexed to,
47:         address indexed l1Token,
48:         uint256 amount
49:     );

/// @audit Missing @param for all event parameters
51:     event ClaimedFailedDepositSharedBridge( 
52:         uint256 indexed chainId,
53:         address indexed to,
54:         address indexed l1Token,
55:         uint256 amount
56:     );
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L13-L20), [22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L22-L29), [31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L31-L36), [38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L38-L42), [44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L44-L49), [51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L51-L56)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

/// @audit Missing @param for all event parameters
45:     event NewPendingAdmin(address indexed oldPendingAdmin, address indexed newPendingAdmin); 

/// @audit Missing @param for all event parameters
48:     event NewAdmin(address indexed oldAdmin, address indexed newAdmin); 

/// @audit Missing @param for all event parameters
133:     event NewChain(uint256 indexed chainId, address stateTransitionManager, address indexed chainGovernance); 
```
[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L45), [48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L48), [133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L133)

```solidity
📁 File: contracts/ethereum/contracts/governance/IGovernance.sol

/// @audit Missing @param for all event parameters
68:     event TransparentOperationScheduled(bytes32 indexed _id, uint256 delay, Operation _operation); 

/// @audit Missing @param for all event parameters
71:     event ShadowOperationScheduled(bytes32 indexed _id, uint256 delay); 

/// @audit Missing @param for all event parameters
74:     event OperationExecuted(bytes32 indexed _id); 

/// @audit Missing @param for all event parameters
77:     event ChangeSecurityCouncil(address _securityCouncilBefore, address _securityCouncilAfter); 

/// @audit Missing @param for all event parameters
80:     event ChangeMinDelay(uint256 _delayBefore, uint256 _delayAfter); 

/// @audit Missing @param for all event parameters
83:     event OperationCancelled(bytes32 indexed _id); 
```
[68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L68), [71](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L71), [74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L74), [77](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L77), [80](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L80), [83](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L83)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

/// @audit Missing @param for all event parameters
28:     event StateTransitionNewChain(uint256 indexed _chainId, address indexed _stateTransitionContract); 

/// @audit Missing @param for all event parameters
30:     event SetChainIdUpgrade( 
31:         address indexed _stateTransitionChain,
32:         L2CanonicalTransaction _l2Transaction,
33:         uint256 indexed _protocolVersion
34:     );

/// @audit Missing @param for all event parameters
38:     event NewPendingAdmin(address indexed oldPendingAdmin, address indexed newPendingAdmin); 

/// @audit Missing @param for all event parameters
41:     event NewAdmin(address indexed oldAdmin, address indexed newAdmin); 
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L28), [30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L30-L34), [38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L38), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L41)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit Missing @param for all event parameters
29:     event NewExecutionDelay(uint256 _newExecutionDelay); 

/// @audit Missing @param for all event parameters
32:     event ValidatorAdded(uint256 _chainId, address _addedValidator); 

/// @audit Missing @param for all event parameters
35:     event ValidatorRemoved(uint256 _chainId, address _removedValidator); 
```
[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L29), [32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L32), [35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L35)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol

/// @audit Missing @param for all event parameters
61:     event IsPorterAvailableStatusUpdate(bool isPorterAvailable); 

/// @audit Missing @param for all event parameters
64:     event ValidatorStatusUpdate(address indexed validatorAddress, bool isActive); 

/// @audit Missing @param for all event parameters
68:     event NewPendingAdmin(address indexed oldPendingAdmin, address indexed newPendingAdmin); 

/// @audit Missing @param for all event parameters
71:     event NewAdmin(address indexed oldAdmin, address indexed newAdmin); 

/// @audit Missing @param for all event parameters
74:     event NewPriorityTxMaxGasLimit(uint256 oldPriorityTxMaxGasLimit, uint256 newPriorityTxMaxGasLimit); 

/// @audit Missing @param for all event parameters
77:     event NewFeeParams(FeeParams oldFeeParams, FeeParams newFeeParams); 

/// @audit Missing @param for all event parameters
80:     event ValidiumModeStatusUpdate(PubdataPricingMode validiumMode); 

/// @audit Missing @param for all event parameters
83:     event NewBaseTokenMultiplier( 
84:         uint128 oldNominator,
85:         uint128 oldDenominator,
86:         uint128 newNominator,
87:         uint128 newDenominator
88:     );
```
[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L61), [64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L64), [68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L68), [71](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L71), [74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L74), [77](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L77), [80](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L80), [83](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L83-L88)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

/// @audit Missing @param for all event parameters
24:     event DiamondCut(FacetCut[] facetCuts, address initAddress, bytes initCalldata); 
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L24)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

/// @audit Missing @param for all event parameters
46:     event NewProtocolVersion(uint256 indexed previousProtocolVersion, uint256 indexed newProtocolVersion); 

/// @audit Missing @param for all event parameters
49:     event NewL2BootloaderBytecodeHash(bytes32 indexed previousBytecodeHash, bytes32 indexed newBytecodeHash); 

/// @audit Missing @param for all event parameters
52:     event NewL2DefaultAccountBytecodeHash(bytes32 indexed previousBytecodeHash, bytes32 indexed newBytecodeHash); 

/// @audit Missing @param for all event parameters
55:     event NewVerifier(address indexed oldVerifier, address indexed newVerifier); 

/// @audit Missing @param for all event parameters
58:     event NewVerifierParams(VerifierParams oldVerifierParams, VerifierParams newVerifierParams); 

/// @audit Missing @param for all event parameters
61:     event UpgradeComplete(uint256 indexed newProtocolVersion, bytes32 indexed l2UpgradeTxHash, ProposedUpgrade upgrade); 
```
[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L46), [49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L49), [52](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L52), [55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L55), [58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L58), [61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L61)

</details>


---
### [NC&#x2011;91] NatSpec: File is missing NatSpec Documentation
<details>
<summary><i>There are 21 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol

1: // SPDX-License-Identifier: Apache-2.0 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol#L1)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L1)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L1)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L1)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L1)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L1)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol

1: // SPDX-License-Identifier: UNLICENSED 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol#L1)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol#L1)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

1: // SPDX-License-Identifier: Apache-2.0 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L1)

```solidity
📁 File: contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L1)

```solidity
📁 File: contracts/zksync/contracts/interfaces/IPaymaster.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L1)

```solidity
📁 File: contracts/zksync/contracts/vendor/AddressAliasHelper.sol

1: // SPDX-License-Identifier: Apache-2.0 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L1)

```solidity
📁 File: system-contracts/contracts/interfaces/IAccount.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IAccount.sol#L1)

```solidity
📁 File: system-contracts/contracts/interfaces/IAccountCodeStorage.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IAccountCodeStorage.sol#L1)

```solidity
📁 File: system-contracts/contracts/interfaces/IBaseToken.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBaseToken.sol#L1)

```solidity
📁 File: system-contracts/contracts/interfaces/IBootloaderUtilities.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IBootloaderUtilities.sol#L1)

```solidity
📁 File: system-contracts/contracts/interfaces/IContractDeployer.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L1)

```solidity
📁 File: system-contracts/contracts/interfaces/IImmutableSimulator.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IImmutableSimulator.sol#L1)

```solidity
📁 File: system-contracts/contracts/interfaces/IL2StandardToken.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L1)

```solidity
📁 File: system-contracts/contracts/interfaces/IMailbox.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IMailbox.sol#L1)

```solidity
📁 File: system-contracts/contracts/interfaces/IPaymaster.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IPaymaster.sol#L1)

</details>


---
### [NC&#x2011;92] NatSpec: Function declarations should have `@notice` tags
`@notice` is used to explain to end users what the function does, and the compiler interprets `///` or `/**` comments as this tag if one was't explicitly provided

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

60:     function initialize() external reentrancyGuardInitializer {} 

63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external { 

75:     function l2TokenAddress(address _l1Token) external view returns (address) { 

160:     function _depositFundsToSharedBridge(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) { 

176:     function claimFailedDeposit( 
177:         address _depositSender,
178:         address _l1Token,
179:         bytes32 _l2TxHash,
180:         uint256 _l2BatchNumber,
181:         uint256 _l2MessageIndex,
182:         uint16 _l2TxNumberInBatch,
183:         bytes32[] calldata _merkleProof
184:     ) external nonReentrant {
```
[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L60), [63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63), [75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L75), [160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L160), [176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L176-L184)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

116:     function transferFundsFromLegacy(address _token, address _target, uint256 _targetChainId) external onlyOwner { 

137:     function receiveEth(uint256 _chainId) external payable { 

142:     function initializeChainGovernance(uint256 _chainId, address _l2BridgeAddress) external onlyOwner { 

173:     function _depositFunds(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) { 

243:     function _getDepositL2Calldata( 
244:         address _l1Sender,
245:         address _l2Receiver,
246:         address _l1Token,
247:         uint256 _amount
248:     ) internal view returns (bytes memory) {

254:     function _getERC20Getters(address _token) internal view returns (bytes memory) { 

277:     function claimFailedDeposit( 
278:         uint256 _chainId,
279:         address _depositSender,
280:         address _l1Token,
281:         uint256 _amount,
282:         bytes32 _l2TxHash,
283:         uint256 _l2BatchNumber,
284:         uint256 _l2MessageIndex,
285:         uint16 _l2TxNumberInBatch,
286:         bytes32[] calldata _merkleProof
287:     ) external override {

303:     function _claimFailedDeposit( 
304:         bool _checkedInLegacyBridge,
305:         uint256 _chainId,
306:         address _depositSender,
307:         address _l1Token,
308:         uint256 _amount,
309:         bytes32 _l2TxHash,
310:         uint256 _l2BatchNumber,
311:         uint256 _l2MessageIndex,
312:         uint16 _l2TxNumberInBatch,
313:         bytes32[] calldata _merkleProof
314:     ) internal nonReentrant {

374:     function _isEraLegacyWithdrawal(uint256 _chainId, uint256 _l2BatchNumber) internal view returns (bool) { 

458:     function _checkWithdrawal( 
459:         uint256 _chainId,
460:         MessageParams memory _messageParams,
461:         bytes calldata _message,
462:         bytes32[] calldata _merkleProof
463:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {

487:     function _parseL2WithdrawalMessage( 
488:         uint256 _chainId,
489:         bytes memory _l2ToL1message
490:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {
```
[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L116), [137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L137), [142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L142), [173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L173), [243](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L243-L248), [254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L254), [277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L277-L287), [303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L303-L314), [374](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L374), [458](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L458-L463), [487](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L487-L490)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

325:     function _actualRefundRecipient(address _refundRecipient) internal view returns (address _recipient) { 
```
[325](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L325)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

89:     function isOperationPending(bytes32 _id) public view returns (bool) { 

95:     function isOperationReady(bytes32 _id) public view returns (bool) { 

100:     function isOperationDone(bytes32 _id) public view returns (bool) { 

105:     function getOperationState(bytes32 _id) public view returns (OperationState) { 

154:     function cancel(bytes32 _id) external onlyOwner { 

204:     function hashOperation(Operation calldata _operation) public pure returns (bytes32) { 

215:     function _schedule(bytes32 _id, uint256 _delay) internal { 

224:     function _execute(Call[] calldata _calls) internal { 

249:     function updateDelay(uint256 _newDelay) external onlySelf { 

256:     function updateSecurityCouncil(address _newSecurityCouncil) external onlySelf { 
```
[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L89), [95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L95), [100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L100), [105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L105), [154](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L154), [204](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L204), [215](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L215), [224](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L224), [249](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L249), [256](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L256)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

74:     function getChainAdmin(uint256 _chainId) external view override returns (address) { 

79:     function initialize( 
80:         StateTransitionManagerInitializeData calldata _initializeData
81:     ) external reentrancyGuardInitializer {

132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin { 

137:     function setInitialCutHash(Diamond.DiamondCutData calldata _diamondCut) external onlyOwner { 

142:     function setNewVersionUpgrade( 
143:         Diamond.DiamondCutData calldata _cutData,
144:         uint256 _oldProtocolVersion,
145:         uint256 _newProtocolVersion
146:     ) external onlyOwner {

152:     function setUpgradeDiamondCut( 
153:         Diamond.DiamondCutData calldata _cutData,
154:         uint256 _oldProtocolVersion
155:     ) external onlyOwner {

160:     function freezeChain(uint256 _chainId) external onlyOwner { 

165:     function unfreezeChain(uint256 _chainId) external onlyOwner { 

170:     function revertBatches(uint256 _chainId, uint256 _newLastBatch) external onlyOwnerOrAdmin { 

177:     function _setChainIdUpgrade(uint256 _chainId, address _chainContract) internal { 

230:     function registerAlreadyDeployedStateTransition( 
231:         uint256 _chainId,
232:         address _stateTransitionContract
233:     ) external onlyOwner {
```
[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L74), [79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L79-L81), [132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132), [137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L137), [142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L142-L146), [152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L152-L155), [160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L160), [165](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L165), [170](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L170), [177](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L177), [230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L230-L233)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

73:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner { 

78:     function addValidator(uint256 _chainId, address _newValidator) external onlyChainAdmin(_chainId) { 
```
[73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L73), [78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L78)

</details>


---
### [NC&#x2011;93] NatSpec: Function declarations should have NatSpec descriptions
It is recommended that Solidity contracts are fully annotated using NatSpec for all public interfaces (everything in the ABI). It is clearly stated in the Solidity official documentation. In complex projects such as DeFi, the interpretation of all functions and their arguments and returns is important for code readability and auditability.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

137:     function receiveEth(uint256 _chainId) external payable { 

487:     function _parseL2WithdrawalMessage( 
```
[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L137), [487](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L487)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol

24:     function isWithdrawalFinalized(uint256 _l2BatchNumber, uint256 _l2MessageIndex) external view returns (bool); 

26:     function deposit( 

35:     function deposit( 

43:     function claimFailedDeposit( 

53:     function finalizeWithdrawal( 

61:     function l2TokenAddress(address _l1Token) external view returns (address); 

63:     function sharedBridge() external view returns (IL1SharedBridge); 

65:     function l2TokenBeacon() external view returns (address); 

67:     function l2Bridge() external view returns (address); 

69:     function depositAmount( 

75:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external; 
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L24), [26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L26), [35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L35), [43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L43), [53](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L53), [61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L61), [63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L63), [65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L65), [67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L67), [69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L69), [75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L75)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol

58:     function isWithdrawalFinalized( 

64:     function depositLegacyErc20Bridge( 

74:     function claimFailedDepositLegacyErc20Bridge( 

85:     function claimFailedDeposit( 

97:     function finalizeWithdrawalLegacyErc20Bridge( 

105:     function finalizeWithdrawal( 
```
[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L58), [64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L64), [74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L74), [85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L85), [97](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L97), [105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L105)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

325:     function _actualRefundRecipient(address _refundRecipient) internal view returns (address _recipient) { 
```
[325](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L325)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/UncheckedMath.sol

11:     function uncheckedInc(uint256 _number) internal pure returns (uint256) { 

17:     function uncheckedAdd(uint256 _lhs, uint256 _rhs) internal pure returns (uint256) { 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L11), [17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L17)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol

19:     function readUint32(bytes memory _bytes, uint256 _start) internal pure returns (uint32 result, uint256 offset) { 

26:     function readAddress(bytes memory _bytes, uint256 _start) internal pure returns (address result, uint256 offset) { 

33:     function readUint256(bytes memory _bytes, uint256 _start) internal pure returns (uint256 result, uint256 offset) { 

40:     function readBytes32(bytes memory _bytes, uint256 _start) internal pure returns (bytes32 result, uint256 offset) { 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L19), [26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L26), [33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L33), [40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L40)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

74:     function getChainAdmin(uint256 _chainId) external view override returns (address) { 

230:     function registerAlreadyDeployedStateTransition( 
```
[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L74), [230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L230)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

89:     function setValidiumMode(PubdataPricingMode _validiumMode) external onlyAdmin { 
```
[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L89)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

215:     function _commitBatches( 

349:     function _executeBatches(StoredBatchInfo[] calldata _batchesData) internal { 

386:     function _proveBatches( 

440:     function _verifyProof(uint256[] memory proofPublicInput, ProofInput calldata _proof) internal view { 

481:     function _revertBatches(uint256 _newLastBatch) internal { 

515:     function _batchPassThroughData(CommitBatchInfo calldata _batch) internal pure returns (bytes memory) { 

525:     function _batchMetaParameters() internal view returns (bytes memory) { 

537:     function _batchAuxiliaryOutput( 
```
[215](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L215), [349](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L349), [386](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L386), [440](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L440), [481](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L481), [515](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L515), [525](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L525), [537](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L537)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

228:     function _requestL2TransactionSender( 

258:     function _requestL2Transaction( 

289:     function _serializeL2Transaction( 
```
[228](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L228), [258](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L258), [289](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L289)

</details>


---
### [NC&#x2011;94] NatSpec: Functions missing NatSpec `@dev` tag
<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

74:     /// @return The L2 token address that would be minted for deposit of the given L1 token on zkSync Era. 
75:     function l2TokenAddress(address _l1Token) external view returns (address) {
76:         bytes32 constructorInputHash = keccak256(abi.encode(l2TokenBeacon, ""));

207:     /// @param _merkleProof The Merkle proof of the inclusion L2 -> L1 message about withdrawal initialization 
208:     function finalizeWithdrawal(
209:         uint256 _l2BatchNumber,
```
[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L74-L76), [207](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L207-L209)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

136:  
137:     function receiveEth(uint256 _chainId) external payable {
138:         require(bridgehub.getStateTransition(_chainId) == msg.sender, "receiveEth not state transition");

181:     /// @notice Initiates a deposit transaction within Bridgehub, used by `requestL2TransactionTwoBridges`. 
182:     function bridgehubDeposit(
183:         uint256 _chainId,

231:     /// This function is utilized by `requestL2TransactionTwoBridges` to validate the execution of a transaction. 
232:     function bridgehubConfirmL2Transaction(
233:         uint256 _chainId,

384:     /// @param _merkleProof The Merkle proof of the inclusion L2 -> L1 message about withdrawal initialization 
385:     function finalizeWithdrawal(
386:         uint256 _chainId,

486:  
487:     function _parseL2WithdrawalMessage(
488:         uint256 _chainId,

614:     /// @return amount The amount of the token being withdrawns 
615:     function finalizeWithdrawalLegacyErc20Bridge(
616:         uint256 _l2BatchNumber,

643:     /// @param _merkleProof The Merkle proof of the processing L1 -> L2 transaction with deposit finalization 
644:     function claimFailedDepositLegacyErc20Bridge(
645:         address _depositSender,
```
[136](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L136-L138), [181](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L181-L183), [231](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L231-L233), [384](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L384-L386), [486](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L486-L488), [614](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L614-L616), [643](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L643-L645)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

37:     /// @notice to avoid parity hack 
38:     constructor() reentrancyGuardInitializer {}
39: 
40:     /// @notice used to initialize the contract
41:     function initialize(address _owner) external reentrancyGuardInitializer {
42:         _transferOwnership(_owner);

50:     /// @inheritdoc IBridgehub 
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin {
52:         // Save previous value into the stack to put it into the event later

59:     /// @inheritdoc IBridgehub 
60:     function acceptAdmin() external {
61:         address currentPendingAdmin = pendingAdmin;

74:     /// @notice return the state transition chain contract for a chainId 
75:     function getStateTransition(uint256 _chainId) public view returns (address) {
76:         return IStateTransitionManager(stateTransitionManager[_chainId]).stateTransition(_chainId);

81:     /// @notice State Transition can be any contract with the appropriate interface/functionality 
82:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner {
83:         require(

91:     /// @notice this stops new Chains from using the STF, old chains are not affected 
92:     function removeStateTransitionManager(address _stateTransitionManager) external onlyOwner {
93:         require(

100:     /// @notice token can be any contract with the appropriate interface/functionality 
101:     function addToken(address _token) external onlyOwner {
102:         require(!tokenIsRegistered[_token], "Bridgehub: token already registered");

107:     /// the order of deployment is Bridgehub, Shared bridge, and then we call this 
108:     function setSharedBridge(address _sharedBridge) external onlyOwner {
109:         sharedBridge = IL1SharedBridge(_sharedBridge);

113:     /// @notice for Eth the baseToken address is 1 
114:     function createNewChain(
115:         uint256 _chainId,

151:     /// @notice forwards function call to Mailbox based on ChainId 
152:     function proveL2MessageInclusion(
153:         uint256 _chainId,

163:     /// @notice forwards function call to Mailbox based on ChainId 
164:     function proveL2LogInclusion(
165:         uint256 _chainId,

175:     /// @notice forwards function call to Mailbox based on ChainId 
176:     function proveL1ToL2TransactionStatus(
177:         uint256 _chainId,

197:     /// @notice forwards function call to Mailbox based on ChainId 
198:     function l2TransactionBaseCost(
199:         uint256 _chainId,

216:     /// This means this is not ideal for contract calls, as the contract would have to handle token allowance of the base Token 
217:     function requestL2TransactionDirect(
218:         L2TransactionRequestDirect calldata _request

261:     /// @notice This function is great for contract calls to L2, the secondBridge can be any contract. 
262:     function requestL2TransactionTwoBridges(
263:         L2TransactionRequestTwoBridgesOuter calldata _request

324:  
325:     function _actualRefundRecipient(address _refundRecipient) internal view returns (address _recipient) {
326:         if (_refundRecipient == address(0)) {
```
[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L37-L42), [50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L50-L52), [59](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L59-L61), [74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L74-L76), [81](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L81-L83), [91](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L91-L93), [100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L100-L102), [107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L107-L109), [113](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L113-L115), [151](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L151-L153), [163](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L163-L165), [175](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L175-L177), [197](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L197-L199), [216](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L216-L218), [261](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L261-L263), [324](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L324-L326)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

40:     /// @param _minDelay The initial minimum delay (in seconds) to be set for operations. 
41:     constructor(address _admin, address _securityCouncil, uint256 _minDelay) {
42:         require(_admin != address(0), "Admin should be non zero address");
```
[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L40-L42)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

73:  
74:     function getChainAdmin(uint256 _chainId) external view override returns (address) {
75:         return IZkSyncStateTransition(stateTransition[_chainId]).getAdmin();

109:     /// @inheritdoc IStateTransitionManager 
110:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin {
111:         // Save previous value into the stack to put it into the event later

118:     /// @inheritdoc IStateTransitionManager 
119:     function acceptAdmin() external {
120:         address currentPendingAdmin = pendingAdmin;

229:  
230:     function registerAlreadyDeployedStateTransition(
231:         uint256 _chainId,

238:     /// @notice called by Bridgehub when a chain registers 
239:     function createNewChain(
240:         uint256 _chainId,
```
[73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L73-L75), [109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L109-L111), [118](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L118-L120), [229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L229-L231), [238](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L238-L240)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

54:  
55:     constructor(address _initialOwner, uint32 _executionDelay) {
56:         _transferOwnership(_initialOwner);
```
[54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L54-L56)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

23:     /// initializer 
24:     function initialize(InitializeData calldata _initializeData) external reentrancyGuardInitializer returns (bytes32) {
25:         require(address(_initializeData.verifier) != address(0), "vt");
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L23-L25)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

10: contract DiamondProxy { 
11:     constructor(uint256 _chainId, Diamond.DiamondCutData memory _diamondCut) {
12:         // Check that the contract is deployed on the expected chain.
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L10-L12)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

22:     /// @inheritdoc IAdmin 
23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin {
24:         // Save previous value into the stack to put it into the event later

31:     /// @inheritdoc IAdmin 
32:     function acceptAdmin() external {
33:         address pendingAdmin = s.pendingAdmin;

44:     /// @inheritdoc IAdmin 
45:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager {
46:         s.validators[_validator] = _active;

50:     /// @inheritdoc IAdmin 
51:     function setPorterAvailability(bool _zkPorterIsAvailable) external onlyStateTransitionManager {
52:         // Change the porter availability

57:     /// @inheritdoc IAdmin 
58:     function setPriorityTxMaxGasLimit(uint256 _newPriorityTxMaxGasLimit) external onlyStateTransitionManager {
59:         require(_newPriorityTxMaxGasLimit <= MAX_GAS_PER_TRANSACTION, "n5");
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L22-L24), [31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L31-L33), [44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L44-L46), [50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L50-L52), [57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L57-L59)

</details>


---
### [NC&#x2011;95] NatSpec: Functions missing NatSpec `@param` tag
It is recommended that Solidity contracts are fully annotated using NatSpec for all public interfaces (everything in the ABI). It is clearly stated in the Solidity official documentation. In complex projects such as DeFi, the interpretation of all functions and their arguments and returns is important for code readability and auditability.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit Missing @param for all function parameters
55:     constructor(IL1SharedBridge _sharedBridge) reentrancyGuardInitializer { 

/// @audit Missing @param for all function parameters
63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external { 

/// @audit Missing @param for all function parameters
75:     function l2TokenAddress(address _l1Token) external view returns (address) { 

/// @audit Missing @param for `_l2Receiver`, `_l1Token`, `_l2TxGasLimit`, `_l2TxGasPerPubdataByte`
98:     function deposit( 
99:         address _l2Receiver,
100:         address _l1Token,
101:         uint256 _amount,
102:         uint256 _l2TxGasLimit,
103:         uint256 _l2TxGasPerPubdataByte
104:     ) external payable returns (bytes32 l2TxHash) {

/// @audit Missing @param for `_l2Receiver`, `_l1Token`, `_l2TxGasLimit`, `_l2TxGasPerPubdataByte`, `_refundRecipient`
133:     function deposit( 
134:         address _l2Receiver,
135:         address _l1Token,
136:         uint256 _amount,
137:         uint256 _l2TxGasLimit,
138:         uint256 _l2TxGasPerPubdataByte,
139:         address _refundRecipient
140:     ) public payable nonReentrant returns (bytes32 l2TxHash) {

/// @audit Missing @param for all function parameters
160:     function _depositFundsToSharedBridge(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) { 

/// @audit Missing @param for all function parameters
176:     function claimFailedDeposit( 
177:         address _depositSender,
178:         address _l1Token,
179:         bytes32 _l2TxHash,
180:         uint256 _l2BatchNumber,
181:         uint256 _l2MessageIndex,
182:         uint16 _l2TxNumberInBatch,
183:         bytes32[] calldata _merkleProof
184:     ) external nonReentrant {

/// @audit Missing @param for `_l2BatchNumber`, `_l2MessageIndex`, `_l2TxNumberInBatch`, `_merkleProof`
208:     function finalizeWithdrawal( 
209:         uint256 _l2BatchNumber,
210:         uint256 _l2MessageIndex,
211:         uint16 _l2TxNumberInBatch,
212:         bytes calldata _message,
213:         bytes32[] calldata _merkleProof
214:     ) external nonReentrant {
```
[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L55), [63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63), [75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L75), [98](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L98-L104), [133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L133-L140), [160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L160), [176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L176-L184), [208](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L208-L214)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit Missing @param for all function parameters
90:     constructor( 
91:         address _l1WethAddress,
92:         IBridgehub _bridgehub,
93:         IL1ERC20Bridge _legacyBridge
94:     ) reentrancyGuardInitializer {

/// @audit Missing @param for `_eraFirstPostUpgradeBatch`
104:     function initialize( 
105:         address _owner,
106:         uint256 _eraFirstPostUpgradeBatch
107:     ) external reentrancyGuardInitializer initializer {

/// @audit Missing @param for all function parameters
116:     function transferFundsFromLegacy(address _token, address _target, uint256 _targetChainId) external onlyOwner { 

/// @audit Missing @param for all function parameters
137:     function receiveEth(uint256 _chainId) external payable { 

/// @audit Missing @param for all function parameters
142:     function initializeChainGovernance(uint256 _chainId, address _l2BridgeAddress) external onlyOwner { 

/// @audit Missing @param for all function parameters
148:     function bridgehubDepositBaseToken( 
149:         uint256 _chainId,
150:         address _prevMsgSender,
151:         address _l1Token,
152:         uint256 _amount
153:     ) external payable virtual onlyBridgehubOrEra(_chainId) {

/// @audit Missing @param for all function parameters
173:     function _depositFunds(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) { 

/// @audit Missing @param for all function parameters
182:     function bridgehubDeposit( 
183:         uint256 _chainId,
184:         address _prevMsgSender,
185:         uint256, // l2Value, needed for Weth deposits in the future
186:         bytes calldata _data
187:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) {

/// @audit Missing @param for all function parameters
232:     function bridgehubConfirmL2Transaction( 
233:         uint256 _chainId,
234:         bytes32 _txDataHash,
235:         bytes32 _txHash
236:     ) external override onlyBridgehub {

/// @audit Missing @param for all function parameters
243:     function _getDepositL2Calldata( 
244:         address _l1Sender,
245:         address _l2Receiver,
246:         address _l1Token,
247:         uint256 _amount
248:     ) internal view returns (bytes memory) {

/// @audit Missing @param for all function parameters
254:     function _getERC20Getters(address _token) internal view returns (bytes memory) { 

/// @audit Missing @param for `_chainId`, `_depositSender`, `_l1Token`, `_l2TxHash`, `_l2BatchNumber`, `_l2MessageIndex`, `_l2TxNumberInBatch`, `_merkleProof`
277:     function claimFailedDeposit( 
278:         uint256 _chainId,
279:         address _depositSender,
280:         address _l1Token,
281:         uint256 _amount,
282:         bytes32 _l2TxHash,
283:         uint256 _l2BatchNumber,
284:         uint256 _l2MessageIndex,
285:         uint16 _l2TxNumberInBatch,
286:         bytes32[] calldata _merkleProof
287:     ) external override {

/// @audit Missing @param for all function parameters
303:     function _claimFailedDeposit( 
304:         bool _checkedInLegacyBridge,
305:         uint256 _chainId,
306:         address _depositSender,
307:         address _l1Token,
308:         uint256 _amount,
309:         bytes32 _l2TxHash,
310:         uint256 _l2BatchNumber,
311:         uint256 _l2MessageIndex,
312:         uint16 _l2TxNumberInBatch,
313:         bytes32[] calldata _merkleProof
314:     ) internal nonReentrant {

/// @audit Missing @param for all function parameters
374:     function _isEraLegacyWithdrawal(uint256 _chainId, uint256 _l2BatchNumber) internal view returns (bool) { 

/// @audit Missing @param for `_chainId`, `_l2BatchNumber`, `_l2MessageIndex`, `_l2TxNumberInBatch`, `_merkleProof`
385:     function finalizeWithdrawal( 
386:         uint256 _chainId,
387:         uint256 _l2BatchNumber,
388:         uint256 _l2MessageIndex,
389:         uint16 _l2TxNumberInBatch,
390:         bytes calldata _message,
391:         bytes32[] calldata _merkleProof
392:     ) external override {

/// @audit Missing @param for all function parameters
409:     function _finalizeWithdrawal( 
410:         uint256 _chainId,
411:         uint256 _l2BatchNumber,
412:         uint256 _l2MessageIndex,
413:         uint16 _l2TxNumberInBatch,
414:         bytes calldata _message,
415:         bytes32[] calldata _merkleProof
416:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount) {

/// @audit Missing @param for all function parameters
458:     function _checkWithdrawal( 
459:         uint256 _chainId,
460:         MessageParams memory _messageParams,
461:         bytes calldata _message,
462:         bytes32[] calldata _merkleProof
463:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {

/// @audit Missing @param for all function parameters
487:     function _parseL2WithdrawalMessage( 
488:         uint256 _chainId,
489:         bytes memory _l2ToL1message
490:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {

/// @audit Missing @param for `_prevMsgSender`, `_l2Receiver`, `_l1Token`, `_l2TxGasLimit`, `_l2TxGasPerPubdataByte`, `_refundRecipient`
554:     function depositLegacyErc20Bridge( 
555:         address _prevMsgSender,
556:         address _l2Receiver,
557:         address _l1Token,
558:         uint256 _amount,
559:         uint256 _l2TxGasLimit,
560:         uint256 _l2TxGasPerPubdataByte,
561:         address _refundRecipient
562:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) {

/// @audit Missing @param for `_l2BatchNumber`, `_l2MessageIndex`, `_l2TxNumberInBatch`, `_merkleProof`
615:     function finalizeWithdrawalLegacyErc20Bridge( 
616:         uint256 _l2BatchNumber,
617:         uint256 _l2MessageIndex,
618:         uint16 _l2TxNumberInBatch,
619:         bytes calldata _message,
620:         bytes32[] calldata _merkleProof
621:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount) {

/// @audit Missing @param for `_depositSender`, `_l1Token`, `_l2TxHash`, `_l2BatchNumber`, `_l2MessageIndex`, `_l2TxNumberInBatch`, `_merkleProof`
644:     function claimFailedDepositLegacyErc20Bridge( 
645:         address _depositSender,
646:         address _l1Token,
647:         uint256 _amount,
648:         bytes32 _l2TxHash,
649:         uint256 _l2BatchNumber,
650:         uint256 _l2MessageIndex,
651:         uint16 _l2TxNumberInBatch,
652:         bytes32[] calldata _merkleProof
653:     ) external override onlyLegacyBridge {
```
[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L90-L94), [104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L104-L107), [116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L116), [137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L137), [142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L142), [148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L148-L153), [173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L173), [182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L182-L187), [232](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L232-L236), [243](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L243-L248), [254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L254), [277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L277-L287), [303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L303-L314), [374](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L374), [385](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L385-L392), [409](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L409-L416), [458](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L458-L463), [487](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L487-L490), [554](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L554-L562), [615](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L615-L621), [644](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L644-L653)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit Missing @param for all function parameters
41:     function initialize(address _owner) external reentrancyGuardInitializer { 

/// @audit Missing @param for all function parameters
75:     function getStateTransition(uint256 _chainId) public view returns (address) { 

/// @audit Missing @param for all function parameters
82:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner { 

/// @audit Missing @param for all function parameters
92:     function removeStateTransitionManager(address _stateTransitionManager) external onlyOwner { 

/// @audit Missing @param for all function parameters
101:     function addToken(address _token) external onlyOwner { 

/// @audit Missing @param for all function parameters
108:     function setSharedBridge(address _sharedBridge) external onlyOwner { 

/// @audit Missing @param for all function parameters
114:     function createNewChain( 
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, //_salt
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {

/// @audit Missing @param for all function parameters
152:     function proveL2MessageInclusion( 
153:         uint256 _chainId,
154:         uint256 _batchNumber,
155:         uint256 _index,
156:         L2Message calldata _message,
157:         bytes32[] calldata _proof
158:     ) external view override returns (bool) {

/// @audit Missing @param for all function parameters
164:     function proveL2LogInclusion( 
165:         uint256 _chainId,
166:         uint256 _batchNumber,
167:         uint256 _index,
168:         L2Log memory _log,
169:         bytes32[] calldata _proof
170:     ) external view override returns (bool) {

/// @audit Missing @param for all function parameters
176:     function proveL1ToL2TransactionStatus( 
177:         uint256 _chainId,
178:         bytes32 _l2TxHash,
179:         uint256 _l2BatchNumber,
180:         uint256 _l2MessageIndex,
181:         uint16 _l2TxNumberInBatch,
182:         bytes32[] calldata _merkleProof,
183:         TxStatus _status
184:     ) external view override returns (bool) {

/// @audit Missing @param for all function parameters
198:     function l2TransactionBaseCost( 
199:         uint256 _chainId,
200:         uint256 _gasPrice,
201:         uint256 _l2GasLimit,
202:         uint256 _l2GasPerPubdataByteLimit
203:     ) external view returns (uint256) {
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L41), [75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L75), [82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L82), [92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L92), [101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L101), [108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108), [114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L121), [152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L152-L158), [164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L164-L170), [176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L176-L184), [198](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L198-L203)

</details>


---
### [NC&#x2011;96] NatSpec: Functions missing NatSpec `@return` tag
It is recommended that Solidity contracts are fully annotated using NatSpec for all public interfaces (everything in the ABI). It is clearly stated in the Solidity official documentation. In complex projects such as DeFi, the interpretation of all functions and their arguments and returns is important for code readability and auditability.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit Missing @return for all function parameters
98:     function deposit( 
99:         address _l2Receiver,
100:         address _l1Token,
101:         uint256 _amount,
102:         uint256 _l2TxGasLimit,
103:         uint256 _l2TxGasPerPubdataByte
104:     ) external payable returns (bytes32 l2TxHash) {

/// @audit Missing @return for all function parameters
133:     function deposit( 
134:         address _l2Receiver,
135:         address _l1Token,
136:         uint256 _amount,
137:         uint256 _l2TxGasLimit,
138:         uint256 _l2TxGasPerPubdataByte,
139:         address _refundRecipient
140:     ) public payable nonReentrant returns (bytes32 l2TxHash) {
```
[98](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L98-L104), [133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L133-L140)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit Missing @return for all function parameters
182:     function bridgehubDeposit( 
183:         uint256 _chainId,
184:         address _prevMsgSender,
185:         uint256, // l2Value, needed for Weth deposits in the future
186:         bytes calldata _data
187:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) {

/// @audit Missing @return for all function parameters
243:     function _getDepositL2Calldata( 
244:         address _l1Sender,
245:         address _l2Receiver,
246:         address _l1Token,
247:         uint256 _amount
248:     ) internal view returns (bytes memory) {

/// @audit Missing @return for all function parameters
254:     function _getERC20Getters(address _token) internal view returns (bytes memory) { 

/// @audit Missing @return for all function parameters
409:     function _finalizeWithdrawal( 
410:         uint256 _chainId,
411:         uint256 _l2BatchNumber,
412:         uint256 _l2MessageIndex,
413:         uint16 _l2TxNumberInBatch,
414:         bytes calldata _message,
415:         bytes32[] calldata _merkleProof
416:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount) {

/// @audit Missing @return for all function parameters
458:     function _checkWithdrawal( 
459:         uint256 _chainId,
460:         MessageParams memory _messageParams,
461:         bytes calldata _message,
462:         bytes32[] calldata _merkleProof
463:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {

/// @audit Missing @return for all function parameters
487:     function _parseL2WithdrawalMessage( 
488:         uint256 _chainId,
489:         bytes memory _l2ToL1message
490:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {

/// @audit Missing @return for all function parameters
554:     function depositLegacyErc20Bridge( 
555:         address _prevMsgSender,
556:         address _l2Receiver,
557:         address _l1Token,
558:         uint256 _amount,
559:         uint256 _l2TxGasLimit,
560:         uint256 _l2TxGasPerPubdataByte,
561:         address _refundRecipient
562:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) {

/// @audit Missing @return for `l1Receiver`, `l1Token`
615:     function finalizeWithdrawalLegacyErc20Bridge( 
616:         uint256 _l2BatchNumber,
617:         uint256 _l2MessageIndex,
618:         uint16 _l2TxNumberInBatch,
619:         bytes calldata _message,
620:         bytes32[] calldata _merkleProof
621:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount) {
```
[182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L182-L187), [243](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L243-L248), [254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L254), [409](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L409-L416), [458](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L458-L463), [487](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L487-L490), [554](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L554-L562), [615](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L615-L621)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit Missing @return for all function parameters
75:     function getStateTransition(uint256 _chainId) public view returns (address) { 

/// @audit Missing @return for all function parameters
114:     function createNewChain( 
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, //_salt
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {

/// @audit Missing @return for all function parameters
152:     function proveL2MessageInclusion( 
153:         uint256 _chainId,
154:         uint256 _batchNumber,
155:         uint256 _index,
156:         L2Message calldata _message,
157:         bytes32[] calldata _proof
158:     ) external view override returns (bool) {

/// @audit Missing @return for all function parameters
164:     function proveL2LogInclusion( 
165:         uint256 _chainId,
166:         uint256 _batchNumber,
167:         uint256 _index,
168:         L2Log memory _log,
169:         bytes32[] calldata _proof
170:     ) external view override returns (bool) {

/// @audit Missing @return for all function parameters
176:     function proveL1ToL2TransactionStatus( 
177:         uint256 _chainId,
178:         bytes32 _l2TxHash,
179:         uint256 _l2BatchNumber,
180:         uint256 _l2MessageIndex,
181:         uint16 _l2TxNumberInBatch,
182:         bytes32[] calldata _merkleProof,
183:         TxStatus _status
184:     ) external view override returns (bool) {

/// @audit Missing @return for all function parameters
198:     function l2TransactionBaseCost( 
199:         uint256 _chainId,
200:         uint256 _gasPrice,
201:         uint256 _l2GasLimit,
202:         uint256 _l2GasPerPubdataByteLimit
203:     ) external view returns (uint256) {

/// @audit Missing @return for all function parameters
217:     function requestL2TransactionDirect( 
218:         L2TransactionRequestDirect calldata _request
219:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash) {

/// @audit Missing @return for all function parameters
262:     function requestL2TransactionTwoBridges( 
263:         L2TransactionRequestTwoBridgesOuter calldata _request
264:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash) {

/// @audit Missing @return for all function parameters
325:     function _actualRefundRecipient(address _refundRecipient) internal view returns (address _recipient) { 
```
[75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L75), [114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L121), [152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L152-L158), [164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L164-L170), [176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L176-L184), [198](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L198-L203), [217](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L217-L219), [262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L262-L264), [325](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L325)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

/// @audit Missing @return for all function parameters
84:     function isOperation(bytes32 _id) public view returns (bool) { 

/// @audit Missing @return for all function parameters
89:     function isOperationPending(bytes32 _id) public view returns (bool) { 

/// @audit Missing @return for all function parameters
95:     function isOperationReady(bytes32 _id) public view returns (bool) { 

/// @audit Missing @return for all function parameters
100:     function isOperationDone(bytes32 _id) public view returns (bool) { 

/// @audit Missing @return for all function parameters
105:     function getOperationState(bytes32 _id) public view returns (OperationState) { 

/// @audit Missing @return for all function parameters
204:     function hashOperation(Operation calldata _operation) public pure returns (bytes32) { 
```
[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L84), [89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L89), [95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L95), [100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L100), [105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L105), [204](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L204)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit Missing @return for all function parameters
74:     function getChainAdmin(uint256 _chainId) external view override returns (address) { 
```
[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L74)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit Missing @return for all function parameters
102:     function getCommittedBatchTimestamp(uint256 _chainId, uint256 _l2BatchNumber) external view returns (uint256) { 
```
[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L102)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit Missing @return for all function parameters
32:     function _commitOneBatch( 
33:         StoredBatchInfo memory _previousBatch,
34:         CommitBatchInfo calldata _newBatch,
35:         bytes32 _expectedSystemContractUpgradeTxHash
36:     ) internal view returns (StoredBatchInfo memory) {

/// @audit Missing @return for all function parameters
130:     function _processL2Logs( 
131:         CommitBatchInfo calldata _newBatch,
132:         bytes32 _expectedSystemContractUpgradeTxHash
133:     ) internal pure returns (LogProcessingOutput memory logOutput) {

/// @audit Missing @return for all function parameters
308:     function _collectOperationsFromPriorityQueue(uint256 _nPriorityOps) internal returns (bytes32 concatHash) { 

/// @audit Missing @return for all function parameters
453:     function _getBatchProofPublicInput( 
454:         bytes32 _prevBatchCommitment,
455:         bytes32 _currentBatchCommitment,
456:         VerifierParams memory _verifierParams
457:     ) internal pure returns (uint256) {

/// @audit Missing @return for all function parameters
500:     function _createBatchCommitment( 
501:         CommitBatchInfo calldata _newBatchData,
502:         bytes32 _stateDiffHash,
503:         bytes32[] memory _blobCommitments,
504:         bytes32[] memory _blobHashes
505:     ) internal view returns (bytes32) {

/// @audit Missing @return for all function parameters
515:     function _batchPassThroughData(CommitBatchInfo calldata _batch) internal pure returns (bytes memory) { 

/// @audit Missing @return for all function parameters
525:     function _batchMetaParameters() internal view returns (bytes memory) { 

/// @audit Missing @return for all function parameters
537:     function _batchAuxiliaryOutput( 
538:         CommitBatchInfo calldata _batch,
539:         bytes32 _stateDiffHash,
540:         bytes32[] memory _blobCommitments,
541:         bytes32[] memory _blobHashes
542:     ) internal pure returns (bytes memory) {

/// @audit Missing @return for all function parameters
561:     function _encodeBlobAuxilaryOutput( 
562:         bytes32[] memory _blobCommitments,
563:         bytes32[] memory _blobHashes
564:     ) internal pure returns (bytes32[] memory blobAuxOutputWords) {

/// @audit Missing @return for all function parameters
587:     function _hashStoredBatchInfo(StoredBatchInfo memory _storedBatchInfo) internal pure returns (bytes32) { 

/// @audit Missing @return for all function parameters
592:     function _checkBit(uint256 _bitMap, uint8 _index) internal pure returns (bool) { 

/// @audit Missing @return for all function parameters
597:     function _setBit(uint256 _bitMap, uint8 _index) internal pure returns (uint256) { 

/// @audit Missing @return for all function parameters
625:     function _verifyBlobInformation( 
626:         bytes calldata _pubdataCommitments,
627:         bytes32[] memory _blobHashes
628:     ) internal view returns (bytes32[] memory blobCommitments) {
```
[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L32-L36), [130](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L130-L133), [308](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L308), [453](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L453-L457), [500](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L500-L505), [515](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L515), [525](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L525), [537](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L537-L542), [561](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L561-L564), [587](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L587), [592](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L592), [597](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L597), [625](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L625-L628)

</details>


---
### [NC&#x2011;97] NatSpec: Modifier declarations should have NatSpec descriptions
It is recommended that modifiers are fully annotated using NatSpec.

<details>
<summary><i>There are 12 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

45:     modifier onlyOwnerOrAdmin() { 
```
[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L45)

```solidity
📁 File: contracts/ethereum/contracts/common/ReentrancyGuard.sol

41:     modifier reentrancyGuardInitializer() { 
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L41)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol

26:     modifier onlyStateTransitionManager() { 

31:     modifier onlyBridgehub() { 

36:     modifier onlyAdminOrStateTransitionManager() { 

44:     modifier onlyValidatorOrStateTransitionManager() { 

52:     modifier onlyBaseTokenBridge() { 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L26), [31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L31), [36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L36), [44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L44), [52](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L52)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

129:     modifier onlyBridge() { 

134:     modifier onlyNextVersion(uint8 _version) { 
```
[129](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L129), [134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L134)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

25:     modifier onlyDeployer() { 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L25)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

28:     modifier onlySelf() { 
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L28)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

19:     modifier onlyCompressor() { 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L19)

</details>


---
### [NC&#x2011;98] NatSpec: Modifier missing NatSpec `@dev` tag
<details>
<summary><i>There are 29 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

67:     /// @notice Checks that the message sender is the bridgehub. 
68:     modifier onlyBridgehub() {
69:         require(msg.sender == address(bridgehub), "ShB not BH");

73:     /// @notice Checks that the message sender is the bridgehub or zkSync Era Diamond Proxy. 
74:     modifier onlyBridgehubOrEra(uint256 _chainId) {
75:         require(

82:     /// @notice Checks that the message sender is the legacy bridge. 
83:     modifier onlyLegacyBridge() {
84:         require(msg.sender == address(legacyBridge), "ShB not legacy bridge");
```
[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L67-L69), [73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L73-L75), [82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L82-L84)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

44:  
45:     modifier onlyOwnerOrAdmin() {
46:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin");
```
[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L44-L46)

```solidity
📁 File: contracts/ethereum/contracts/common/ReentrancyGuard.sol

40:  
41:     modifier reentrancyGuardInitializer() {
42:         _initializeReentrancyGuard();
```
[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L40-L42)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

57:     /// @notice Checks that the message sender is contract itself. 
58:     modifier onlySelf() {
59:         require(msg.sender == address(this), "Only governance contract itself is allowed to call this function");

63:     /// @notice Checks that the message sender is an active security council. 
64:     modifier onlySecurityCouncil() {
65:         require(msg.sender == securityCouncil, "Only security council is allowed to call this function");

69:     /// @notice Checks that the message sender is an active owner or an active security council. 
70:     modifier onlyOwnerOrSecurityCouncil() {
71:         require(
```
[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L57-L59), [63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L63-L65), [69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L69-L71)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

62:     /// @notice only the bridgehub can call 
63:     modifier onlyBridgehub() {
64:         require(msg.sender == bridgehub, "StateTransition: only bridgehub");

68:     /// @notice the admin can call, for non-critical updates 
69:     modifier onlyOwnerOrAdmin() {
70:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin");
```
[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L62-L64), [68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L68-L70)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

60:     /// @notice Checks if the caller is the admin of the chain. 
61:     modifier onlyChainAdmin(uint256 _chainId) {
62:         require(msg.sender == stateTransitionManager.getChainAdmin(_chainId), "ValidatorTimelock: only chain admin");

66:     /// @notice Checks if the caller is a validator. 
67:     modifier onlyValidator(uint256 _chainId) {
68:         require(validators[_chainId][msg.sender] == true, "ValidatorTimelock: only validator");
```
[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L60-L62), [66](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L66-L68)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol

14:     /// @notice Checks that the message sender is an active admin 
15:     modifier onlyAdmin() {
16:         require(msg.sender == s.admin, "StateTransition Chain: not admin");

20:     /// @notice Checks if validator is active 
21:     modifier onlyValidator() {
22:         require(s.validators[msg.sender], "StateTransition Chain: not validator");

25:  
26:     modifier onlyStateTransitionManager() {
27:         require(msg.sender == s.stateTransitionManager, "StateTransition Chain: not state transition manager");

30:  
31:     modifier onlyBridgehub() {
32:         require(msg.sender == s.bridgehub, "StateTransition Chain: not bridgehub");

35:  
36:     modifier onlyAdminOrStateTransitionManager() {
37:         require(

43:  
44:     modifier onlyValidatorOrStateTransitionManager() {
45:         require(

51:  
52:     modifier onlyBaseTokenBridge() {
53:         require(msg.sender == s.baseTokenBridge, "Only shared bridge can call this function");
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L14-L16), [20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L20-L22), [25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L25-L27), [30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L30-L32), [35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L35-L37), [43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L43-L45), [51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L51-L53)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

128:  
129:     modifier onlyBridge() {
130:         require(msg.sender == l2Bridge, "xnt"); // Only L2 bridge can call this method

133:  
134:     modifier onlyNextVersion(uint8 _version) {
135:         // The version should be incremented by 1. Otherwise, the governor risks disabling
```
[128](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L128-L130), [133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L133-L135)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

24:  
25:     modifier onlyDeployer() {
26:         require(msg.sender == address(DEPLOYER_SYSTEM_CONTRACT), "Callable only by the deployer system contract");
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L24-L26)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

27:  
28:     modifier onlySelf() {
29:         require(msg.sender == address(this), "Callable only by self");
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L27-L29)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

18: contract KnownCodesStorage is IKnownCodesStorage, ISystemContract { 
19:     modifier onlyCompressor() {
20:         require(msg.sender == address(COMPRESSOR_CONTRACT), "Callable only by the compressor");
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L18-L20)

```solidity
📁 File: system-contracts/contracts/interfaces/ISystemContract.sol

19:     /// can only be called via a system call. 
20:     modifier onlySystemCall() {
21:         require(

29:     /// can only be called from a system contract. 
30:     modifier onlyCallFromSystemContract() {
31:         require(

39:     /// can only be called from a special given address. 
40:     modifier onlyCallFrom(address caller) {
41:         require(msg.sender == caller, "Inappropriate caller");

46:     /// can only be called from the bootloader. 
47:     modifier onlyCallFromBootloader() {
48:         require(msg.sender == BOOTLOADER_FORMAL_ADDRESS, "Callable only by the bootloader");

53:     /// can only be called from the L1 force deployer. 
54:     modifier onlyCallFromForceDeployer() {
55:         require(msg.sender == FORCE_DEPLOYER);
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L19-L21), [29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L29-L31), [39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L39-L41), [46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L46-L48), [53](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L53-L55)

</details>


---
### [NC&#x2011;99] NatSpec: Modifier missing NatSpec `@param` tag
It is recommended that Solidity contracts are fully annotated using NatSpec for all public interfaces (everything in the ABI). It is clearly stated in the Solidity official documentation. In complex projects such as DeFi, the interpretation of all functions and their arguments and returns is important for code readability and auditability.

<details>
<summary><i>There are 5 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit Missing @param for all modifier parameters
74:     modifier onlyBridgehubOrEra(uint256 _chainId) { 
```
[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L74)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit Missing @param for all modifier parameters
61:     modifier onlyChainAdmin(uint256 _chainId) { 

/// @audit Missing @param for all modifier parameters
67:     modifier onlyValidator(uint256 _chainId) { 
```
[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L61), [67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L67)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

/// @audit Missing @param for all modifier parameters
134:     modifier onlyNextVersion(uint8 _version) { 
```
[134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L134)

```solidity
📁 File: system-contracts/contracts/interfaces/ISystemContract.sol

/// @audit Missing @param for all modifier parameters
40:     modifier onlyCallFrom(address caller) { 
```
[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L40)

</details>


---
### [NC&#x2011;100] Non-assembly method available
`assembly{ id := chainid() }` => `uint256 id = block.chainid`, `assembly { size := extcodesize() }` => `uint256 size = address().code.length`, `assembly { hash := extcodehash() }` => `bytes32 hash = address().codehash`
 There are some automated tools that will flag a project as having higher complexity if there is inline-assembly, so it's best to avoid using it where it's not necessary

<details>
<summary><i>There are 2 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Merkle.sol

44:             result := keccak256(0x00, 0x40) 
```
[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L44)

```solidity
📁 File: system-contracts/contracts/PubdataChunkPublisher.sol

49:                 blobHash := keccak256(add(ptr, start), BLOB_SIZE_BYTES) 
```
[49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L49)

</details>


---
### [NC&#x2011;101] Non-`external`/`public` function names should begin with an underscore
According to the Solidity Style Guide, Non-`external`/`public` function names should begin with an <a href="https://docs.soliditylang.org/en/latest/style-guide.html#underscore-prefix-for-non-external-functions-and-variables">underscore</a>.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

/// @audit _hashL2Bytecode
21:     function hashL2Bytecode(bytes memory _bytecode) internal pure returns (bytes32 hashedBytecode) { 

/// @audit _validateBytecodeHash
39:     function validateBytecodeHash(bytes32 _bytecodeHash) internal pure { 

/// @audit _bytecodeLen
49:     function bytecodeLen(bytes32 _bytecodeHash) internal pure returns (uint256 codeLengthInWords) { 

/// @audit _computeCreate2Address
60:     function computeCreate2Address( 
61:         address _sender,
62:         bytes32 _salt,
63:         bytes32 _bytecodeHash,
64:         bytes32 _constructorInputHash
65:     ) internal pure returns (address) {
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L21), [39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L39), [49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L49), [60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L60-L65)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/UncheckedMath.sol

/// @audit _uncheckedInc
11:     function uncheckedInc(uint256 _number) internal pure returns (uint256) { 

/// @audit _uncheckedAdd
17:     function uncheckedAdd(uint256 _lhs, uint256 _rhs) internal pure returns (uint256) { 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L11), [17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L17)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol

/// @audit _readUint32
19:     function readUint32(bytes memory _bytes, uint256 _start) internal pure returns (uint32 result, uint256 offset) { 

/// @audit _readAddress
26:     function readAddress(bytes memory _bytes, uint256 _start) internal pure returns (address result, uint256 offset) { 

/// @audit _readUint256
33:     function readUint256(bytes memory _bytes, uint256 _start) internal pure returns (uint256 result, uint256 offset) { 

/// @audit _readBytes32
40:     function readBytes32(bytes memory _bytes, uint256 _start) internal pure returns (bytes32 result, uint256 offset) { 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L19), [26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L26), [33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L33), [40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L40)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

/// @audit _getDiamondStorage
87:     function getDiamondStorage() internal pure returns (DiamondStorage storage diamondStorage) { 

/// @audit _diamondCut
96:     function diamondCut(DiamondCutData memory _diamondCut) internal { 
```
[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L87), [96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L96)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/LibMap.sol

/// @audit _get
18:     function get(Uint32Map storage _map, uint256 _index) internal view returns (uint32 result) { 

/// @audit _set
38:     function set(Uint32Map storage _map, uint256 _index, uint32 _value) internal { 
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L18), [38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L38)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Merkle.sol

/// @audit _calculateRoot
18:     function calculateRoot( 
19:         bytes32[] calldata _path,
20:         uint256 _index,
21:         bytes32 _itemHash
22:     ) internal pure returns (bytes32) {
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L18-L22)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol

/// @audit _getFirstUnprocessedPriorityTx
35:     function getFirstUnprocessedPriorityTx(Queue storage _queue) internal view returns (uint256) { 

/// @audit _getTotalPriorityTxs
40:     function getTotalPriorityTxs(Queue storage _queue) internal view returns (uint256) { 

/// @audit _getSize
45:     function getSize(Queue storage _queue) internal view returns (uint256) { 

/// @audit _isEmpty
50:     function isEmpty(Queue storage _queue) internal view returns (bool) { 

/// @audit _pushBack
55:     function pushBack(Queue storage _queue, PriorityOperation memory _operation) internal { 

/// @audit _front
64:     function front(Queue storage _queue) internal view returns (PriorityOperation memory) { 

/// @audit _popFront
72:     function popFront(Queue storage _queue) internal returns (PriorityOperation memory priorityOperation) { 
```
[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L35), [40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L40), [45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L45), [50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L50), [55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L55), [64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L64), [72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L72)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol

/// @audit _validateL1ToL2Transaction
19:     function validateL1ToL2Transaction( 
20:         L2CanonicalTransaction memory _transaction,
21:         bytes memory _encoded,
22:         uint256 _priorityTxMaxGasLimit,
23:         uint256 _priorityTxMaxPubdata
24:     ) internal pure {

/// @audit _validateUpgradeTransaction
46:     function validateUpgradeTransaction(L2CanonicalTransaction memory _transaction) internal pure { 

/// @audit _getMinimalPriorityTransactionGasLimit
69:     function getMinimalPriorityTransactionGasLimit( 
70:         uint256 _encodingLength,
71:         uint256 _numberOfFactoryDependencies,
72:         uint256 _l2GasPricePerPubdata
73:     ) internal pure returns (uint256) {

/// @audit _getTransactionBodyGasLimit
109:     function getTransactionBodyGasLimit( 
110:         uint256 _totalGasLimit,
111:         uint256 _encodingLength
112:     ) internal pure returns (uint256 txBodyGasLimit) {

/// @audit _getOverheadForTransaction
128:     function getOverheadForTransaction( 
129:         uint256 _encodingLength
130:     ) internal pure returns (uint256 batchOverheadForTransaction) {
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L19-L24), [46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L46), [69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L69-L73), [109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L109-L112), [128](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L128-L130)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

/// @audit _applyL1ToL2Alias
28:     function applyL1ToL2Alias(address l1Address) internal pure returns (address l2Address) { 

/// @audit _undoL1ToL2Alias
38:     function undoL1ToL2Alias(address l2Address) internal pure returns (address l1Address) { 
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L28), [38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L38)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

/// @audit _encodeLegacyTransactionHash
44:     function encodeLegacyTransactionHash(Transaction calldata _transaction) internal view returns (bytes32 txHash) { 

/// @audit _encodeEIP2930TransactionHash
139:     function encodeEIP2930TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) { 

/// @audit _encodeEIP1559TransactionHash
229:     function encodeEIP1559TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) { 
```
[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L44), [139](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L139), [229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L229)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

/// @audit _keccakGasCost
50:     function keccakGasCost(uint256 _length) internal pure returns (uint256) { 

/// @audit _sha256GasCost
61:     function sha256GasCost(uint256 _length) internal pure returns (uint256) { 
```
[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L50), [61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L61)

```solidity
📁 File: system-contracts/contracts/libraries/EfficientCall.sol

/// @audit _keccak
36:     function keccak(bytes calldata _data) internal view returns (bytes32) { 

/// @audit _sha
45:     function sha(bytes calldata _data) internal view returns (bytes32) { 

/// @audit _call
58:     function call( 
59:         uint256 _gas,
60:         address _address,
61:         uint256 _value,
62:         bytes calldata _data,
63:         bool _isSystem
64:     ) internal returns (bytes memory returnData) {

/// @audit _staticCall
74:     function staticCall( 
75:         uint256 _gas,
76:         address _address,
77:         bytes calldata _data
78:     ) internal view returns (bytes memory returnData) {

/// @audit _delegateCall
88:     function delegateCall( 
89:         uint256 _gas,
90:         address _address,
91:         bytes calldata _data
92:     ) internal returns (bytes memory returnData) {

/// @audit _mimicCall
105:     function mimicCall( 
106:         uint256 _gas,
107:         address _address,
108:         bytes calldata _data,
109:         address _whoToMimic,
110:         bool _isConstructor,
111:         bool _isSystem
112:     ) internal returns (bytes memory returnData) {
```
[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L36), [45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L45), [58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L58-L64), [74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L74-L78), [88](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L88-L92), [105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L105-L112)

</details>


---
### [NC&#x2011;102] Not using the latest versions of project dependencies
Update the project dependencies to their latest versions wherever possible.

Use tools such as `retire.js`, `npm audit`, and `yarn audit` to confirm that no vulnerable dependencies remain.

|Dependency|Current Version|Latest Version|
|:-:|:-:|:-:|
|`forge-std`|1.7.6|1.8.1|
|`openzeppelin-contracts`|4.9.5|5.0.2|
|`openzeppelin-contracts-upgradeable`|4.9.5|5.0.2|



<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

1: // SPDX-License-Identifier: MIT 
```
[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L1)


---
### [NC&#x2011;103] Not using the named return variables anywhere in the function is confusing
Declaring named returns, but not using them, is confusing to the reader. Consider either completely removing them (by declaring just the type without a name), or remove the return statement and do a variable assignment.

This would improve the readability of the code, and it may also help reduce regressions during future code refactors.

If the optimizer is not turned on, leaving the code as it is will also waste gas for the stack variable.

<details>
<summary><i>There are 4 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

/// @audit chainId is unused
114:     function createNewChain( 
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, //_salt
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {
122:         require(_chainId != 0, "Bridgehub: chainId cannot be 0");
123:         require(_chainId <= type(uint48).max, "Bridgehub: chainId too large");
124: 
125:         require(
126:             stateTransitionManagerIsRegistered[_stateTransitionManager],
127:             "Bridgehub: state transition not registered"
128:         );
129:         require(tokenIsRegistered[_baseToken], "Bridgehub: token not registered");
130:         require(address(sharedBridge) != address(0), "Bridgehub: weth bridge not set");
131: 
132:         require(stateTransitionManager[_chainId] == address(0), "Bridgehub: chainId already registered");
133: 
134:         stateTransitionManager[_chainId] = _stateTransitionManager;
135:         baseToken[_chainId] = _baseToken;
136: 
137:         IStateTransitionManager(_stateTransitionManager).createNewChain(
138:             _chainId,
139:             _baseToken,
140:             address(sharedBridge),
141:             _admin,
142:             _initData
143:         );
144: 
145:         emit NewChain(_chainId, _stateTransitionManager, _admin);
146:         return _chainId;
147:     }
```
[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L147)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

/// @audit diamondStorage is unused
87:     function getDiamondStorage() internal pure returns (DiamondStorage storage diamondStorage) { 
88:         bytes32 position = DIAMOND_STORAGE_POSITION;
89:         assembly {
90:             diamondStorage.slot := position
91:         }
92:     }
```
[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L87-L92)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

/// @audit txHash is unused
44:     function encodeLegacyTransactionHash(Transaction calldata _transaction) internal view returns (bytes32 txHash) { 
45:         // Hash of legacy transactions are encoded as one of the:
46:         // - RLP(nonce, gasPrice, gasLimit, to, value, data, chainId, 0, 0)
47:         // - RLP(nonce, gasPrice, gasLimit, to, value, data)
48:         //
49:         // In this RLP encoding, only the first one above list appears, so we encode each element
50:         // inside list and then concatenate the length of all elements with them.
51: 
52:         bytes memory encodedNonce = RLPEncoder.encodeUint256(_transaction.nonce);
53:         // Encode `gasPrice` and `gasLimit` together to prevent "stack too deep error".
54:         bytes memory encodedGasParam;
55:         {
56:             bytes memory encodedGasPrice = RLPEncoder.encodeUint256(_transaction.maxFeePerGas);
57:             bytes memory encodedGasLimit = RLPEncoder.encodeUint256(_transaction.gasLimit);
58:             encodedGasParam = bytes.concat(encodedGasPrice, encodedGasLimit);
59:         }
60: 
61:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));
62:         bytes memory encodedValue = RLPEncoder.encodeUint256(_transaction.value);
63:         // Encode only the length of the transaction data, and not the data itself,
64:         // so as not to copy to memory a potentially huge transaction data twice.
65:         bytes memory encodedDataLength;
66:         {
67:             // Safe cast, because the length of the transaction data can't be so large.
68:             uint64 txDataLen = uint64(_transaction.data.length);
69:             if (txDataLen != 1) {
70:                 // If the length is not equal to one, then only using the length can it be encoded definitely.
71:                 encodedDataLength = RLPEncoder.encodeNonSingleBytesLen(txDataLen);
72:             } else if (_transaction.data[0] >= 0x80) {
73:                 // If input is a byte in [0x80, 0xff] range, RLP encoding will concatenates 0x81 with the byte.
74:                 encodedDataLength = hex"81";
75:             }
76:             // Otherwise the length is not encoded at all.
77:         }
78: 
79:         bytes memory rEncoded;
80:         {
81:             uint256 rInt = uint256(bytes32(_transaction.signature[0:32]));
82:             rEncoded = RLPEncoder.encodeUint256(rInt);
83:         }
84:         bytes memory sEncoded;
85:         {
86:             uint256 sInt = uint256(bytes32(_transaction.signature[32:64]));
87:             sEncoded = RLPEncoder.encodeUint256(sInt);
88:         }
89:         bytes memory vEncoded;
90:         {
91:             uint256 vInt = uint256(uint8(_transaction.signature[64]));
92:             require(vInt == 27 || vInt == 28, "Invalid v value");
93: 
94:             // If the `chainId` is specified in the transaction, then the `v` value is encoded as
95:             // `35 + y + 2 * chainId == vInt + 8 + 2 * chainId`, where y - parity bit (see EIP-155).
96:             if (_transaction.reserved[0] != 0) {
97:                 vInt += 8 + block.chainid * 2;
98:             }
99: 
100:             vEncoded = RLPEncoder.encodeUint256(vInt);
101:         }
102: 
103:         bytes memory encodedListLength;
104:         unchecked {
105:             uint256 listLength = encodedNonce.length +
106:                 encodedGasParam.length +
107:                 encodedTo.length +
108:                 encodedValue.length +
109:                 encodedDataLength.length +
110:                 _transaction.data.length +
111:                 rEncoded.length +
112:                 sEncoded.length +
113:                 vEncoded.length;
114: 
115:             // Safe cast, because the length of the list can't be so large.
116:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength));
117:         }
118: 
119:         return
120:             keccak256(
121:                 bytes.concat(
122:                     encodedListLength,
123:                     encodedNonce,
124:                     encodedGasParam,
125:                     encodedTo,
126:                     encodedValue,
127:                     encodedDataLength,
128:                     _transaction.data,
129:                     vEncoded,
130:                     rEncoded,
131:                     sEncoded
132:                 )
133:             );
134:     }
```
[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L44-L134)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

/// @audit info is unused
34:     function getAccountInfo(address _address) external view returns (AccountInfo memory info) { 
35:         return accountInfo[_address];
36:     }
```
[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L34-L36)

</details>


---
### [NC&#x2011;104] Outdated Solidity version
Upgrade to the latest solidity version.

<a href="https://blog.soliditylang.org/2021/04/21/solidity-0.8.4-release-announcement/">0.8.4</a>: bytes.concat() instead of abi.encodePacked(<bytes>,<bytes>) 
<a href="https://blog.soliditylang.org/2022/02/16/solidity-0.8.12-release-announcement/">0.8.12</a>: string.concat() instead of abi.encodePacked(<str>,<str>) 
<a href="https://blog.soliditylang.org/2022/03/16/solidity-0.8.13-release-announcement/">0.8.13</a>:
- Ability to use using for with a list of free functions

<a href="https://blog.soliditylang.org/2022/05/18/solidity-0.8.14-release-announcement/">0.8.14</a>:
- ABI Encoder: When ABI-encoding values from calldata that contain nested arrays, correctly validate the nested array length against calldatasize() in all cases.
- Override Checker: Allow changing data location for parameters only when overriding external functions.

<a href="https://blog.soliditylang.org/2022/06/15/solidity-0.8.15-release-announcement/">0.8.15</a>:
- Code Generation: Avoid writing dirty bytes to storage when copying bytes arrays.
- Yul Optimizer: Keep all memory side-effects of inline assembly blocks.

<a href="https://blog.soliditylang.org/2022/08/08/solidity-0.8.16-release-announcement/">0.8.16</a>:
 - Code Generation: Fix data corruption that affected ABI-encoding of calldata values represented by tuples: structs at any nesting level; argument lists of external functions, events and errors; return value lists of external functions. The 32 leading bytes of the first dynamically-encoded value in the tuple would get zeroed when the last component contained a statically-encoded array.

<a href="https://blog.soliditylang.org/2022/09/08/solidity-0.8.17-release-announcement/">0.8.17</a>:
 - Yul Optimizer: Prevent the incorrect removal of storage writes before calls to Yul functions that conditionally terminate the external EVM call.

<a href="https://blog.soliditylang.org/2023/02/22/solidity-0.8.19-release-announcement/">0.8.19</a>:
- SMTChecker: New trusted mode that assumes that any compile-time available code is the actual used code, even in external calls.

Bug Fixes:
- Assembler: Avoid duplicating subassembly bytecode where possible.
- Code Generator: Avoid including references to the deployed label of referenced functions if they are called right away.
- ContractLevelChecker: Properly distinguish the case of missing base constructor arguments from having an unimplemented base function.
- SMTChecker: Fix internal error caused by unhandled z3 expressions that come from the solver when bitwise operators are used.
- SMTChecker: Fix internal error when using the custom NatSpec annotation to abstract free functions.
- TypeChecker: Also allow external library functions in using for.

<a href="https://blog.soliditylang.org/2023/05/10/solidity-0.8.20-release-announcement/">0.8.20</a>:
- Assembler: Use push0 for placing 0 on the stack for EVM versions starting from “Shanghai”. This decreases the deployment and runtime costs.
- Optimizer: Re-implement simplified version of UnusedAssignEliminator and UnusedStoreEliminator. It can correctly remove some unused assignments in deeply nested loops that were ignored by the old version.
- Parser: Unary plus is no longer recognized as a unary operator in the AST and triggers an error at the parsing stage (rather than later during the analysis).
- SMTChecker: Group all messages about unsupported language features in a single warning. The CLI option --model-checker-show-unsupported and the JSON option settings.modelChecker.showUnsupported can be enabled to show the full list.
- SMTChecker: Properties that are proved safe are now reported explicitly at the end of analysis. By default, only the number of safe properties is shown. The CLI option --model-checker-show-proved-safe and the JSON option settings.modelChecker.showProvedSafe can be enabled to show the full list of safe properties.
- Standard JSON Interface: Add experimental support for importing ASTs via Standard JSON.
- Yul EVM Code Transform: If available, use push0 instead of codesize to produce an arbitrary value on stack in order to create equal stack heights between branches.

<a href="https://soliditylang.org/blog/2023/07/19/solidity-0.8.21-release-announcement">0.8.21</a>:
- Code Generator: Always generate code for the expression in `<expression>.selector` in the legacy code generation pipeline.
- Yul Optimizer: Fix FullInliner step (i) not preserving the evaluation order of arguments passed into inlined functions in code that is not in expression-split form.
- Allow qualified access to events from other contracts.
- Relax restrictions on initialization of immutable variables. Reads and writes may now happen at any point at construction time outside of functions and modifiers. Explicit initialization is no longer mandatory.


<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol

2: pragma solidity 0.8.20; 
```
[2](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol#L2)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/common/interfaces/IL2ContractDeployer.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/interfaces/IL2ContractDeployer.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/UncheckedMath.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/governance/IGovernance.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/ILegacyGetters.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/ILegacyGetters.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/LibMap.sol

2: pragma solidity 0.8.20; 
```
[2](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L2)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Merkle.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L3)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

3: pragma solidity 0.8.20; 
```
[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L3)

</details>


---
### [NC&#x2011;105] Overly complicated arithmetic
To maintain readability in code, particularly in Solidity which can involve complex mathematical operations, it is often recommended to limit the number of arithmetic operations to a maximum of 2-3 per line. Too many operations in a single line can make the code difficult to read and understand, increase the likelihood of mistakes, and complicate the process of debugging and reviewing the code.


<i>There are 2 instaces of this issue:</i>

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

62:         return SHA256_ROUND_GAS_COST * ((_length + 8) / SHA256_ROUND_NUMBER_OF_BYTES + 1); 

148:         uint256 gasToPay = keccakGasCost(L2_TO_L1_LOG_SERIALIZE_SIZE) + 
149:             3 *
150:             keccakGasCost(64) +
151:             gasSpentOnMessageHashing +
152:             COMPUTATIONAL_PRICE_FOR_PUBDATA *
153:             pubdataLen;
```
[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L62), [148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L148-L153)


---
### [NC&#x2011;106] Overridden function has no body
Consider adding a NatSpec comment describing why the function doesn't need a body and or the purpose it serves

<details>
<summary><i>There are 3 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

60:     function initialize() external reentrancyGuardInitializer {} 
```
[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L60)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

263:     function _upgradeL1Contract(bytes calldata _customCallDataForUpgrade) internal virtual {} 

269:     function _postUpgrade(bytes calldata _customCallDataForUpgrade) internal virtual {} 
```
[263](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L263), [269](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L269)

</details>


---
### [NC&#x2011;107] `override` function arguments that are unused should have the variable name removed or commented out to avoid compiler warnings
<details>
<summary><i>There are 2 instances of this issue:</i></summary>

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

/// @audit _transaction
125:     function executeTransactionFromOutside(Transaction calldata _transaction) external payable override { 
```
[125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L125)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

/// @audit _hash
65:     function getMarker(bytes32 _hash) public view override returns (uint256 marker) { 
```
[65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L65)

</details>


---
### [NC&#x2011;108] Parameter change does not emit event
Events help non-contract tools to track changes

<details>
<summary><i>There are 10 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

82:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner { 
83:         require(
84:             !stateTransitionManagerIsRegistered[_stateTransitionManager],
85:             "Bridgehub: state transition already registered"
86:         );
87:         stateTransitionManagerIsRegistered[_stateTransitionManager] = true;
88:     }

92:     function removeStateTransitionManager(address _stateTransitionManager) external onlyOwner { 
93:         require(
94:             stateTransitionManagerIsRegistered[_stateTransitionManager],
95:             "Bridgehub: state transition not registered yet"
96:         );
97:         stateTransitionManagerIsRegistered[_stateTransitionManager] = false;
98:     }

101:     function addToken(address _token) external onlyOwner { 
102:         require(!tokenIsRegistered[_token], "Bridgehub: token already registered");
103:         tokenIsRegistered[_token] = true;
104:     }

108:     function setSharedBridge(address _sharedBridge) external onlyOwner { 
109:         sharedBridge = IL1SharedBridge(_sharedBridge);
110:     }
```
[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L82-L88), [92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L92-L98), [101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L101-L104), [108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108-L110)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin { 
133:         validatorTimelock = _validatorTimelock;
134:     }
```
[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132-L134)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

263:     function _upgradeL1Contract(bytes calldata _customCallDataForUpgrade) internal virtual {} 

269:     function _postUpgrade(bytes calldata _customCallDataForUpgrade) internal virtual {} 
```
[263](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L263), [269](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L269)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

84:     function setChainId(uint256 _newChainId) external onlyCallFromForceDeployer { 
85:         chainId = _newChainId;
86:     }

99:     function setTxOrigin(address _newOrigin) external onlyCallFromBootloader { 
100:         origin = _newOrigin;
101:     }

105:     function setGasPrice(uint256 _gasPrice) external onlyCallFromBootloader { 
106:         gasPrice = _gasPrice;
107:     }
```
[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L84-L86), [99](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L99-L101), [105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L105-L107)

</details>


---
### [NC&#x2011;109] Place `interface` files into a dedicated folder
Using a separate folder for interfaces keeps the codebase organised and helps to facilitate security audits as well as future development.

<details>
<summary><i>There are 8 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

42: interface IBridgehub { 
```
[42](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L42)

```solidity
📁 File: contracts/ethereum/contracts/governance/IGovernance.sol

8: interface IGovernance { 
```
[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L8)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

26: interface IStateTransitionManager { 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L26)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol

4: interface ISystemContext { 
```
[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol#L4)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol

7: interface IDefaultUpgrade { 
```
[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol#L7)

```solidity
📁 File: contracts/zksync/contracts/L2ContractHelper.sol

18: interface IL2Messenger { 

30: interface IContractDeployer { 

61: interface IBaseToken { 
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L18), [30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L30), [61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L61)

</details>


---
### [NC&#x2011;110] Polymorphic functions make security audits more time-consuming and error-prone
The instances below point to one of two functions with the same name. Consider naming each function differently, in order to make code navigation and analysis easier.

<details>
<summary><i>There are 4 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit deposit(address _l2Receiver, address _l1Token, uint256 _amount, uint256 _l2TxGasLimit, uint256 _l2TxGasPerPubdataByte)
/// @audit deposit(address _l2Receiver, address _l1Token, uint256 _amount, uint256 _l2TxGasLimit, uint256 _l2TxGasPerPubdataByte, address _refundRecipient)
19: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard { 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L19)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol

/// @audit deposit(uint256 _l2BatchNumber, uint256 _l2MessageIndex)
/// @audit deposit(uint256 _l2BatchNumber, uint256 _l2MessageIndex)
11: interface IL1ERC20Bridge { 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L11)

</details>


---
### [NC&#x2011;111] Prefer skip over revert model in iteration
It is preferable to skip operations on an array index when a condition is not met rather than reverting the whole transaction as reverting can introduce the possiblity of malicous actors purposefully introducing array objects which fail conditional checks within for/while loops so group operations fail. As such it is recommended to simply skip such array indices over reverting unless there is a valid security or logic reason behind not doing so.

<details>
<summary><i>There are 14 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

/// @audit reverts on line: 195
185:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { 

/// @audit reverts on line: 217
209:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { 
```
[185](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L185), [209](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L209)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit reverts on line: 149, 154, 157, 160, 163, 166, 169, 172, 175, 178, 181, 182
142:         for (uint256 i = 0; i < emittedL2Logs.length; i = i.uncheckedAdd(L2_TO_L1_LOG_SERIALIZE_SIZE)) { 

/// @audit reverts on line: 407
405:         for (uint256 i = 0; i < committedBatchesLength; i = i.uncheckedInc()) { 

/// @audit reverts on line: 639
636:         for (uint256 i = 0; i < _pubdataCommitments.length; i += PUBDATA_COMMITMENT_SIZE) { 

/// @audit reverts on line: 668
667:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) { 
```
[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L142), [405](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L405), [636](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L636), [667](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L667)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

/// @audit reverts on line: 107
101:         for (uint256 i = 0; i < facetCutsLength; i = i.uncheckedInc()) { 

/// @audit reverts on line: 141
138:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) { 

/// @audit reverts on line: 161
158:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) { 

/// @audit reverts on line: 181
178:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) { 
```
[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L101), [138](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L138), [158](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L158), [178](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L178)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

/// @audit reverts on line: 227
226:         for (uint256 i = 0; i < _factoryDeps.length; ++i) { 
```
[226](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L226)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

/// @audit reverts on line: 63, 68
61:             for (uint256 encodedDataPointer = 0; encodedDataPointer < encodedData.length; encodedDataPointer += 2) { 

/// @audit reverts on line: 140
127:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) { 

/// @audit reverts on line: 171
159:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) { 
```
[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L61), [127](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L127), [159](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L159)

</details>


---
### [NC&#x2011;112] `public` functions not called by the contract should be declared `external` instead
Contracts are allowed to override their parents’ functions and change the visibility from public to external.

<details>
<summary><i>There are 17 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

54:     function proveL2MessageInclusion( 

74:     function proveL1ToL2TransactionStatus( 

143:     function l2TransactionBaseCost( 
```
[54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L54), [74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L74), [143](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L143)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

67:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual returns (bytes32 txHash) { 
```
[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L67)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

47:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual override returns (bytes32) { 
```
[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L47)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

13:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) { 
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L13)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

14:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) { 
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L14)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2StandardERC20.sol

159:     function name() public view override returns (string memory) { 

165:     function symbol() public view override returns (string memory) { 

171:     function decimals() public view override returns (uint8) { 
```
[159](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L159), [165](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L165), [171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L171)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

40:     function extendedAccountVersion(address _address) public view returns (AccountAbstractionVersion) { 
```
[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L40)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

57:     function getRawNonce(address _address) public view returns (uint256) { 

65:     function increaseMinNonce(uint256 _value) public onlySystemCall returns (uint256 oldMinNonce) { 

82:     function setValueUnderNonce(uint256 _key, uint256 _value) public onlySystemCall { 

102:     function getValueUnderNonce(uint256 _key) public view returns (uint256) { 
```
[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L57), [65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L65), [82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L82), [102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L102)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

190:     function getBlockNumber() public view returns (uint128) { 

198:     function getBlockTimestamp() public view returns (uint128) { 
```
[190](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L190), [198](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L198)

</details>


---
### [NC&#x2011;113] `receive()`/`payable fallback()` function does not authorize requests
If the intention is for the Ether to be used, the function should call another function, otherwise it should revert (e.g. `require(msg.sender == address(weth))`). Having no access control on the function means that someone may send Ether to the contract, and have no way to get anything back out, which is a loss of funds. If the concern is having to spend a small amount of gas to check the sender against an immutable address, the code should at least have a function to rescue unused Ether.

<details>
<summary><i>There are 7 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

262:     receive() external payable {} 
```
[262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L262)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

20:     fallback() external payable { 
21:         Diamond.DiamondStorage storage diamondStorage = Diamond.getDiamondStorage();
22:         // Check whether the data contains a "full" selector or it is empty.
23:         // Required because Diamond proxy finds a facet by function signature,
24:         // which is not defined for data length in range [1, 3].
25:         require(msg.data.length >= 4 || msg.data.length == 0, "Ut");
26:         // Get facet from function selector
27:         Diamond.SelectorToFacet memory facet = diamondStorage.selectorToFacet[msg.sig];
28:         address facetAddress = facet.facetAddress;
29: 
30:         require(facetAddress != address(0), "F"); // Proxy has no facet for this selector
31:         require(!diamondStorage.isFrozen || !facet.isFreezable, "q1"); // Facet is frozen
32: 
33:         assembly {
34:             // The pointer to the free memory slot
35:             let ptr := mload(0x40)
36:             // Copy function signature and arguments from calldata at zero position into memory at pointer position
37:             calldatacopy(ptr, 0, calldatasize())
38:             // Delegatecall method of the implementation contract returns 0 on error
39:             let result := delegatecall(gas(), facetAddress, ptr, calldatasize(), 0, 0)
40:             // Get the size of the last return data
41:             let size := returndatasize()
42:             // Copy the size length of bytes from return data at zero position to pointer position
43:             returndatacopy(ptr, 0, size)
44:             // Depending on the result value
45:             switch result
46:             case 0 {
47:                 // End execution and revert state changes
48:                 revert(ptr, size)
49:             }
50:             default {
51:                 // Return data with length of size at pointers position
52:                 return(ptr, size)
53:             }
54:         }
55:     }
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L20-L55)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

220:     fallback() external payable ignoreInDelegateCall { 
221:         // fallback of default account shouldn't be called by bootloader under no circumstances
222:         assert(msg.sender != BOOTLOADER_FORMAL_ADDRESS);
223: 
224:         // If the contract is called directly, behave like an EOA
225:     }

227:     receive() external payable { 
228:         // If the contract is called directly, behave like an EOA
229:     }
```
[220](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L220-L225), [227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L227-L229)

```solidity
📁 File: system-contracts/contracts/EmptyContract.sol

11:     fallback() external payable {} 

13:     receive() external payable {} 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L11), [13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L13)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

47:     fallback(bytes calldata _data) external onlySystemCall returns (bytes memory) { 
48:         // Firstly we calculate how much gas has been actually provided by the user to the inner call.
49:         // For that, we need to get the total gas available in this context and subtract the stipend from it.
50:         uint256 gasInContext = gasleft();
51:         // Note, that the `gasInContext` might be slightly less than the MSG_VALUE_SIMULATOR_STIPEND_GAS, since
52:         // by the time we retrieve it, some gas might have already been spent, e.g. on the `gasleft` opcode itself.
53:         uint256 userGas = gasInContext > MSG_VALUE_SIMULATOR_STIPEND_GAS
54:             ? gasInContext - MSG_VALUE_SIMULATOR_STIPEND_GAS
55:             : 0;
56: 
57:         (uint256 value, bool isSystemCall, address to) = _getAbiParams();
58: 
59:         // Prevent mimic call to the MsgValueSimulator to prevent an unexpected change of callee.
60:         require(to != address(this), "MsgValueSimulator calls itself");
61: 
62:         if (value != 0) {
63:             (bool success, ) = address(REAL_BASE_TOKEN_SYSTEM_CONTRACT).call(
64:                 abi.encodeCall(REAL_BASE_TOKEN_SYSTEM_CONTRACT.transferFromTo, (msg.sender, to, value))
65:             );
66: 
67:             // If the transfer of ETH fails, we do the most Ethereum-like behaviour in such situation: revert(0,0)
68:             if (!success) {
69:                 assembly {
70:                     revert(0, 0)
71:                 }
72:             }
73: 
74:             // If value is non-zero, we also provide additional gas to the callee.
75:             userGas += GAS_TO_PASS;
76:         }
77: 
78:         // For the next call this `msg.value` will be used.
79:         SystemContractHelper.setValueForNextFarCall(Utils.safeCastToU128(value));
80: 
81:         return EfficientCall.mimicCall(userGas, to, _data, msg.sender, false, isSystemCall);
82:     }
```
[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L47-L82)

</details>


---
### [NC&#x2011;114] Redundant IERC20 import
IERC20 is already present in SafeERC20 or ERC20, no need to import it twice

Replace
```solidity
import { IERC20 } from "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import { SafeERC20 } from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
```
with
```solidity
import { SafeERC20, IERC20 } from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
```

<details>
<summary><i>There are 6 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

5: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol"; 
6: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L5-L6)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

9: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol"; 
10: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
```
[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L9-L10)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

5: import "../openzeppelin/token/ERC20/IERC20.sol"; 
6: import "../openzeppelin/token/ERC20/utils/SafeERC20.sol";
```
[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L5-L6)

</details>


---
### [NC&#x2011;115] `require()` / `revert()` statements should have descriptive reason strings
<details>
<summary><i>There are 2 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

51:             require(_newBatch.pubdataCommitments.length == 1); 
```
[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L51)

```solidity
📁 File: system-contracts/contracts/interfaces/ISystemContract.sol

55:         require(msg.sender == FORCE_DEPLOYER); 
```
[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L55)

</details>


---
### [NC&#x2011;116] Returning a struct instead of a bunch of variables is better
If a function returns [too many variables](https://docs.soliditylang.org/en/v0.8.21/contracts.html#returning-multiple-values), replacing them with a struct can improve code readability, maintainability and reusability.

<details>
<summary><i>There are 6 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

409:     function _finalizeWithdrawal( 
410:         uint256 _chainId,
411:         uint256 _l2BatchNumber,
412:         uint256 _l2MessageIndex,
413:         uint16 _l2TxNumberInBatch,
414:         bytes calldata _message,
415:         bytes32[] calldata _merkleProof
416:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount) {

458:     function _checkWithdrawal( 
459:         uint256 _chainId,
460:         MessageParams memory _messageParams,
461:         bytes calldata _message,
462:         bytes32[] calldata _merkleProof
463:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {

487:     function _parseL2WithdrawalMessage( 
488:         uint256 _chainId,
489:         bytes memory _l2ToL1message
490:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {

615:     function finalizeWithdrawalLegacyErc20Bridge( 
616:         uint256 _l2BatchNumber,
617:         uint256 _l2MessageIndex,
618:         uint16 _l2TxNumberInBatch,
619:         bytes calldata _message,
620:         bytes32[] calldata _merkleProof
621:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount) {
```
[409](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L409-L416), [458](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L458-L463), [487](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L487-L490), [615](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L615-L621)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol

97:     function finalizeWithdrawalLegacyErc20Bridge( 
```
[97](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L97)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

25:     function _getAbiParams() internal view returns (uint256 value, bool isSystemCall, address to) { 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L25)

</details>


---
### [NC&#x2011;117] Simplify complex require statements
Simplifying complex `require` statements with local variables and `if`(or `revert`) statements can improve readability, make debugging easier, and promote modularity and reusability in the code.

<details>
<summary><i>There are 3 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

75:         require( 
76:             msg.sender == address(bridgehub) || (_chainId == ERA_CHAIN_ID && msg.sender == ERA_DIAMOND_PROXY),
77:             "L1SharedBridge: not bridgehub or era chain"
78:         );
```
[75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L75-L78)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

668:             require( 
669:                 (_blobHashes[i] == bytes32(0) && blobCommitments[i] == bytes32(0)) ||
670:                     (_blobHashes[i] != bytes32(0) && blobCommitments[i] != bytes32(0)),
671:                 "bh"
672:             );
```
[668](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L668-L672)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

33:         require( 
34:             msg.sender == MSG_VALUE_SYSTEM_CONTRACT ||
35:                 msg.sender == address(DEPLOYER_SYSTEM_CONTRACT) ||
36:                 msg.sender == BOOTLOADER_FORMAL_ADDRESS,
37:             "Only system contracts with special access can call this method"
38:         );
```
[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L33-L38)

</details>


---
### [NC&#x2011;118] Some contracts can be abstract
In Solidity, a contract that's not meant to be deployed on its own but is intended to be inherited by other contracts should be marked `abstract`. This ensures that developers recognize the contract's incomplete or intended-to-be-extended nature. If a contract has unimplemented functions or is designed with the intention that another contract should extend its functionality, it should be explicitly labeled as `abstract`. This helps prevent inadvertent deployments and clearly communicates the contract's purpose to other developers. Resolution: Review the contract, and if it's not supposed to function standalone, mark it as `abstract` to make the intention clear.

<details>
<summary><i>There are 2 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol

11: contract ZkSyncStateTransitionBase is ReentrancyGuard { 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L11)

```solidity
📁 File: system-contracts/contracts/EmptyContract.sol

10: contract EmptyContract { 
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L10)

</details>


---
### [NC&#x2011;119] Some events are never emitted
The following events are never emitted, consider to remove them.

<details>
<summary><i>There are 5 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol

134:     event EthWithdrawalFinalized(address indexed to, uint256 amount); 
```
[134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L134)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol

17:     event ProposeTransparentUpgrade( 
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L17)

```solidity
📁 File: contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol

22:     event BaseTokenReceived(uint256 amount); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L22)

```solidity
📁 File: system-contracts/contracts/interfaces/IL2StandardToken.sol

6:     event BridgeMint(address indexed _account, uint256 _amount); 

8:     event BridgeBurn(address indexed _account, uint256 _amount); 
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L6), [8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L8)

</details>


---
### [NC&#x2011;120] Some variables have a implicit default visibility
Consider always adding an explicit visibility modifier for variables, as the default is `internal`.

<details>
<summary><i>There are 11 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L22)

```solidity
📁 File: contracts/zksync/contracts/vendor/AddressAliasHelper.sol

22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L22)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

23:     bytes32 constant EMPTY_STRING_KECCAK = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470; 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L23)

```solidity
📁 File: system-contracts/contracts/GasBoundCaller.sol

18:     uint256 constant CALL_ENTRY_OVERHEAD = 800; 

21:     uint256 constant CALL_RETURN_OVERHEAD = 200; 
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L18), [21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L21)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

36:     uint256 constant GAS_TO_PASS = 2300; 

41:     uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000; 
```
[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L36), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L41)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

82:     bytes32 constant EIP712_DOMAIN_TYPEHASH = keccak256("EIP712Domain(string name,string version,uint256 chainId)"); 

84:     bytes32 constant EIP712_TRANSACTION_TYPE_HASH = 
```
[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L82), [84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L84)

```solidity
📁 File: system-contracts/contracts/libraries/Utils.sol

13:     bytes32 constant IS_CONSTRUCTOR_BYTECODE_HASH_BIT_MASK = 

17:     bytes32 constant SET_IS_CONSTRUCTOR_MARKER_BIT_MASK = 
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L13), [17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L17)

</details>


---
### [NC&#x2011;121] State variables should include comments
Consider adding some comments on critical state variables to explain what they are supposed to do: this will help for future code reviews.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

402:         uint256 l2BatchNumber; 
403:         uint256 l2MessageIndex;
404:         uint16 l2TxNumberInBatch;
```
[402](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L402-L404)

```solidity
📁 File: contracts/ethereum/contracts/common/interfaces/IL2ContractDeployer.sol

17:         bytes32 bytecodeHash; 
18:         address newAddress;
19:         bool callConstructor;
20:         uint256 value;
21:         bytes input;
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/interfaces/IL2ContractDeployer.sol#L17-L21)

```solidity
📁 File: contracts/ethereum/contracts/governance/IGovernance.sol

26:         address target; 
27:         uint256 value;
28:         bytes data;

36:         Call[] calls; 
37:         bytes32 predecessor;
38:         bytes32 salt;
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L26-L28), [36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/IGovernance.sol#L36-L38)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol

12:     ZkSyncStateTransitionStorage internal s; 
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L12)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol

84:         uint64 batchNumber; 
85:         bytes32 batchHash;
86:         uint64 indexRepeatedStorageChanges;
87:         uint256 numberOfLayer1Txs;
88:         bytes32 priorityOperationsHash;
```
[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L84-L88)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

31:         address facetAddress; 
32:         uint16 selectorPosition;
33:         bool isFreezable;

40:         bytes4[] selectors; 
41:         uint16 facetPosition;

51:         mapping(bytes4 selector => SelectorToFacet selectorInfo) selectorToFacet; 
52:         mapping(address facetAddress => FacetToSelectors facetInfo) facetToSelectors;
53:         address[] facets;
54:         bool isFrozen;

63:         address facet; 
64:         Action action;
65:         bool isFreezable;
66:         bytes4[] selectors;

74:         FacetCut[] facetCuts; 
75:         address initAddress;
76:         bytes initCalldata;
```
[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L31-L33), [40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L40-L41), [51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L51-L54), [63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L63-L66), [74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L74-L76)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/LibMap.sol

11:         mapping(uint256 packedIndex => uint256 eightPackedValues) map; 
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L11)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol

28:         mapping(uint256 priorityOpId => PriorityOperation priorityOp) data; 
29:         uint256 tail;
30:         uint256 head;
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L28-L30)

</details>


---
### [NC&#x2011;122] The `nonReentrant` `modifier` should occur before all other modifiers
This is a best-practice to protect against reentrancy in other modifiers

<details>
<summary><i>There are 2 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

554:     function depositLegacyErc20Bridge( 
555:         address _prevMsgSender,
556:         address _l2Receiver,
557:         address _l1Token,
558:         uint256 _amount,
559:         uint256 _l2TxGasLimit,
560:         uint256 _l2TxGasPerPubdataByte,
561:         address _refundRecipient
562:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) {
```
[554](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L554-L562)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

114:     function createNewChain( 
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, //_salt
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {
```
[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L121)

</details>


---
### [NC&#x2011;123] TODO Left in the code
TODOs may signal that a feature is missing or not ready for audit, consider resolving the issue and removing the TODO comment

<details>
<summary><i>There are 2 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/Config.sol

21: // TODO: change constant to the real root hash of empty Merkle tree (SMA-184) 
```
[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Config.sol#L21)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

338:                 layer2Tip: uint192(0) // TODO: Restore after fee modeling will be stable. (SMA-1230) 
```
[338](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L338)

</details>


---
### [NC&#x2011;124] Top-level declarations should be separated by at least two lines
<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

19: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard { 
20:     using SafeERC20 for IERC20;
21: 
22:     /// @dev The shared bridge that is now used for all bridging, replacing the legacy contract.
23:     IL1SharedBridge public immutable override sharedBridge;

226:     } 
```
[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L19-L23), [226](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L226-L27)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step { 
31:     using SafeERC20 for IERC20;
32: 
33:     /// @dev The address of the WETH token on L1.
34:     address public immutable override l1WethAddress;

135:     } 
136: 
137:     function receiveEth(uint256 _chainId) external payable {

399:     } 
400: 
401:     struct MessageParams {

485:     } 
486: 
487:     function _parseL2WithdrawalMessage(

666:     } 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30-L34), [135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L135-L137), [399](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L399-L401), [485](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L485-L487), [666](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L666-L48)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step { 
17:     /// @notice all the ether is held by the weth bridge
18:     IL1SharedBridge public sharedBridge;

43:     } 
44: 
45:     modifier onlyOwnerOrAdmin() {

323:     } 
324: 
325:     function _actualRefundRecipient(address _refundRecipient) internal view returns (address _recipient) {

335:     } 
```
[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16-L18), [43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L43-L45), [323](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L323-L325), [335](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L335-L21)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

10: library L2ContractHelper { 
11:     /// @dev The prefix used to create CREATE2 addresses.
12:     bytes32 private constant CREATE2_PREFIX = keccak256("zksyncCreate2");
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L10-L12)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/UncheckedMath.sol

10: library UncheckedMath { 
11:     function uncheckedInc(uint256 _number) internal pure returns (uint256) {
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L10-L11)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

20: contract Governance is IGovernance, Ownable2Step { 
21:     /// @notice A constant representing the timestamp for completed operations.
22:     uint256 internal constant EXECUTED_PROPOSAL_TIMESTAMP = uint256(1);

262:     receive() external payable {} 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L20-L22), [262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L262-L32)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step { 
26:     /// @notice Address of the bridgehub
27:     address public immutable bridgehub;

228:     } 
229: 
230:     function registerAlreadyDeployedStateTransition(

288:     } 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L25-L27), [228](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L228-L230), [288](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L288-L30)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

22: contract ValidatorTimelock is IExecutor, Ownable2Step { 
23:     using LibMap for LibMap.Uint32Map;
24: 
25:     /// @dev Part of the IBase interface. Not used in this contract.
26:     string public constant override getName = "ValidatorTimelock";

247:     } 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L22-L26), [247](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L247-L47)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol

17: contract DiamondInit is ZkSyncStateTransitionBase, IDiamondInit { 
18:     /// @dev Initialize the implementation to prevent any possibility of a Parity hack.
19:     constructor() reentrancyGuardInitializer {}
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L17-L19)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol

10: contract DiamondProxy { 
11:     constructor(uint256 _chainId, Diamond.DiamondCutData memory _diamondCut) {
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L10-L11)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

18: contract AdminFacet is ZkSyncStateTransitionBase, IAdmin { 
19:     /// @inheritdoc IZkSyncStateTransitionBase
20:     string public constant override getName = "AdminFacet";
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L18-L20)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

22: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor { 
23:     using UncheckedMath for uint256;
24:     using PriorityQueue for PriorityQueue.Queue;
25: 
26:     /// @inheritdoc IZkSyncStateTransitionBase
27:     string public constant override getName = "ExecutorFacet";

213:     } 
214: 
215:     function _commitBatches(

347:     } 
348: 
349:     function _executeBatches(StoredBatchInfo[] calldata _batchesData) internal {

384:     } 
385: 
386:     function _proveBatches(

513:     } 
514: 
515:     function _batchPassThroughData(CommitBatchInfo calldata _batch) internal pure returns (bytes memory) {

523:     } 
524: 
525:     function _batchMetaParameters() internal view returns (bytes memory) {

535:     } 
536: 
537:     function _batchAuxiliaryOutput(
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L22-L27), [213](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L213-L215), [347](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L347-L349), [384](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L384-L386), [513](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L513-L515), [523](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L523-L525), [535](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L535-L537)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

20: contract GettersFacet is ZkSyncStateTransitionBase, IGetters, ILegacyGetters { 
21:     using UncheckedMath for uint256;
22:     using PriorityQueue for PriorityQueue.Queue;
23: 
24:     /// @inheritdoc IZkSyncStateTransitionBase
25:     string public constant override getName = "GettersFacet";
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L20-L25)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

30: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox { 
31:     using UncheckedMath for uint256;
32:     using PriorityQueue for PriorityQueue.Queue;
33: 
34:     /// @inheritdoc IZkSyncStateTransitionBase
35:     string public constant override getName = "MailboxFacet";

226:     } 
227: 
228:     function _requestL2TransactionSender(

256:     } 
257: 
258:     function _requestL2Transaction(

287:     } 
288: 
289:     function _serializeL2Transaction(
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L30-L35), [226](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L226-L228), [256](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L256-L258), [287](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L287-L289)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol

11: contract ZkSyncStateTransitionBase is ReentrancyGuard { 
12:     ZkSyncStateTransitionStorage internal s;
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L11-L12)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

44: abstract contract BaseZkSyncUpgrade is ZkSyncStateTransitionBase { 
45:     /// @notice Changes the protocol version
46:     event NewProtocolVersion(uint256 indexed previousProtocolVersion, uint256 indexed newProtocolVersion);
```
[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L44-L46)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

17: abstract contract BaseZkSyncUpgradeGenesis is BaseZkSyncUpgrade { 
18:     /// @notice Changes the protocol version
19:     /// @param _newProtocolVersion The new protocol version
20:     function _setNewProtocolVersion(uint256 _newProtocolVersion) internal override {
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L17-L20)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

10: contract DefaultUpgrade is BaseZkSyncUpgrade { 
11:     /// @notice The main function that will be called by the upgrade proxy.
12:     /// @param _proposedUpgrade The upgrade to be executed.
13:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L10-L13)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

11: contract GenesisUpgrade is BaseZkSyncUpgradeGenesis { 
12:     /// @notice The main function that will be called by the upgrade proxy.
13:     /// @param _proposedUpgrade The upgrade to be executed.
14:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
```
[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L11-L14)

</details>


---
### [NC&#x2011;125] Unnecessary cast
The variable is being cast to its own type

<details>
<summary><i>There are 17 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

/// @audit protocolVersion
266:             bytes32(uint256(protocolVersion)), 

/// @audit storedBatchZero
271:             bytes32(storedBatchZero), 
```
[266](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L266), [271](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L271)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

/// @audit _newBatch.pubdataCommitments[0]
39:         uint8 pubdataSource = uint8(bytes1(_newBatch.pubdataCommitments[0])); 
```
[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L39)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

/// @audit s.bridgehub
48:         return address(s.bridgehub); 

/// @audit s.stateTransitionManager
53:         return address(s.stateTransitionManager); 

/// @audit s.baseToken
58:         return address(s.baseToken); 

/// @audit s.baseTokenBridge
63:         return address(s.baseTokenBridge); 
```
[48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L48), [53](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L53), [58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L58), [63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L63)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

/// @audit _priorityOpParams.l2GasPrice
300:             maxFeePerGas: uint256(_priorityOpParams.l2GasPrice), 

/// @audit _priorityOpParams.txId
304:             nonce: uint256(_priorityOpParams.txId), 
```
[300](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L300), [304](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L304)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol

46:         return uint256(_queue.tail - _queue.head); 
```
[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L46)

```solidity
📁 File: contracts/zksync/contracts/SystemContractsCaller.sol

/// @audit safeCastToU32
44:         uint32 dataLength = uint32(Utils.safeCastToU32(data.length)); 
```
[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L44)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

/// @audit _compressedStateDiffs[stateDiffPtr]
143:             uint8 metadata = uint8(bytes1(_compressedStateDiffs[stateDiffPtr])); 

/// @audit _compressedStateDiffs[stateDiffPtr]
174:             uint8 metadata = uint8(bytes1(_compressedStateDiffs[stateDiffPtr])); 
```
[143](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L143), [174](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L174)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

/// @audit _totalL2ToL1PubdataAndStateDiffs[calldataPtr]
280:             uint256(uint8(bytes1(_totalL2ToL1PubdataAndStateDiffs[calldataPtr]))) == 

/// @audit _totalL2ToL1PubdataAndStateDiffs[calldataPtr]
289:         uint8 enumerationIndexSize = uint8(bytes1(_totalL2ToL1PubdataAndStateDiffs[calldataPtr])); 
```
[280](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L280), [289](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L289)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractHelper.sol

/// @audit MAX_SYSTEM_CONTRACT_ADDRESS
339:         return uint160(_address) <= uint160(MAX_SYSTEM_CONTRACT_ADDRESS); 
```
[339](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L339)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractsCaller.sol

/// @audit safeCastToU32
83:         uint32 dataLength = uint32(Utils.safeCastToU32(data.length)); 
```
[83](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L83)

</details>


---
### [NC&#x2011;126] Unspecific compiler version pragma
Some files use `>=`, some use `^`. The instances below are examples of the method that has the fewest instances for a specific version. Note that using `>=` without also specifying `<=` will lead to failures to compile, or external project incompatability, when the major version changes and there are breaking-changes, so `^` should be preferred regardless of the instance counts


<i>There is one instance of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol

2: pragma solidity ^0.8.0; 
```
[2](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol#L2)


---
### [NC&#x2011;127] Unused contract variables
Note that there may be cases where a variable appears to be used, but this is only because there are multiple definitions of the varible in different files. In such cases, the variable definition should be moved into a separate file. The instances below are the unused variables.


<i>There are 3 instaces of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

45:     mapping(address => uint256) private __DEPRECATED_lastWithdrawalLimitReset; 

48:     mapping(address => uint256) private __DEPRECATED_withdrawnAmountInWindow; 

51:     mapping(address => mapping(address => uint256)) private __DEPRECATED_totalDepositedAmountPerUser; 
```
[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L45), [48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L48), [51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L51)


---
### [NC&#x2011;128] Unused `event` definition
The following events are never used, consider to remove them.

<details>
<summary><i>There are 5 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol

134:     event EthWithdrawalFinalized(address indexed to, uint256 amount); 
```
[134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L134)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol

17:     event ProposeTransparentUpgrade( 
18:         Diamond.DiamondCutData diamondCut,
19:         uint256 indexed proposalId,
20:         bytes32 proposalSalt
21:     );
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L17-L21)

```solidity
📁 File: contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol

22:     event BaseTokenReceived(uint256 amount); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L22)

```solidity
📁 File: system-contracts/contracts/interfaces/IL2StandardToken.sol

6:     event BridgeMint(address indexed _account, uint256 _amount); 

8:     event BridgeBurn(address indexed _account, uint256 _amount); 
```
[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L6), [8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L8)

</details>


---
### [NC&#x2011;129] Unused function parameter
Comment out the variable name to suppress compiler warnings


<i>There is one instance of this issue:</i>

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

/// @audit _transaction is unused
125:     function executeTransactionFromOutside(Transaction calldata _transaction) external payable override { 
```
[125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L125)


---
### [NC&#x2011;130] Unused `modifier` definition
The following modifier are never used, consider to remove them.

<details>
<summary><i>There are 14 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/ReentrancyGuard.sol

41:     modifier reentrancyGuardInitializer() { 
42:         _initializeReentrancyGuard();
43:         _;
44:     }

68:     modifier nonReentrant() { 
69:         uint256 _status;
70:         assembly {
71:             _status := sload(LOCK_FLAG_ADDRESS)
72:         }
73: 
74:         // On the first call to nonReentrant, _notEntered will be true
75:         require(_status == _NOT_ENTERED, "r1");
76: 
77:         // Any calls to nonReentrant after this point will fail
78:         assembly {
79:             sstore(LOCK_FLAG_ADDRESS, _ENTERED)
80:         }
81: 
82:         _;
83: 
84:         // By storing the original value once again, a refund is triggered (see
85:         // https://eips.ethereum.org/EIPS/eip-2200)
86:         assembly {
87:             sstore(LOCK_FLAG_ADDRESS, _NOT_ENTERED)
88:         }
89:     }
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L41-L44), [68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L68-L89)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol

15:     modifier onlyAdmin() { 
16:         require(msg.sender == s.admin, "StateTransition Chain: not admin");
17:         _;
18:     }

21:     modifier onlyValidator() { 
22:         require(s.validators[msg.sender], "StateTransition Chain: not validator");
23:         _;
24:     }

26:     modifier onlyStateTransitionManager() { 
27:         require(msg.sender == s.stateTransitionManager, "StateTransition Chain: not state transition manager");
28:         _;
29:     }

31:     modifier onlyBridgehub() { 
32:         require(msg.sender == s.bridgehub, "StateTransition Chain: not bridgehub");
33:         _;
34:     }

36:     modifier onlyAdminOrStateTransitionManager() { 
37:         require(
38:             msg.sender == s.admin || msg.sender == s.stateTransitionManager,
39:             "StateTransition Chain: Only by admin or state transition manager"
40:         );
41:         _;
42:     }

44:     modifier onlyValidatorOrStateTransitionManager() { 
45:         require(
46:             s.validators[msg.sender] || msg.sender == s.stateTransitionManager,
47:             "StateTransition Chain: Only by validator or state transition manager"
48:         );
49:         _;
50:     }

52:     modifier onlyBaseTokenBridge() { 
53:         require(msg.sender == s.baseTokenBridge, "Only shared bridge can call this function");
54:         _;
55:     }
```
[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L15-L18), [21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L21-L24), [26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L26-L29), [31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L31-L34), [36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L36-L42), [44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L44-L50), [52](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L52-L55)

```solidity
📁 File: system-contracts/contracts/interfaces/ISystemContract.sol

20:     modifier onlySystemCall() { 
21:         require(
22:             SystemContractHelper.isSystemCall() || SystemContractHelper.isSystemContract(msg.sender),
23:             "This method require system call flag"
24:         );
25:         _;
26:     }

30:     modifier onlyCallFromSystemContract() { 
31:         require(
32:             SystemContractHelper.isSystemContract(msg.sender),
33:             "This method require the caller to be system contract"
34:         );
35:         _;
36:     }

40:     modifier onlyCallFrom(address caller) { 
41:         require(msg.sender == caller, "Inappropriate caller");
42:         _;
43:     }

47:     modifier onlyCallFromBootloader() { 
48:         require(msg.sender == BOOTLOADER_FORMAL_ADDRESS, "Callable only by the bootloader");
49:         _;
50:     }

54:     modifier onlyCallFromForceDeployer() { 
55:         require(msg.sender == FORCE_DEPLOYER);
56:         _;
57:     }
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L20-L26), [30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L30-L36), [40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L40-L43), [47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L47-L50), [54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L54-L57)

</details>


---
### [NC&#x2011;131] Unusual loop variable
The normal name for loop variables is `i`, and when there is a nested loop, to use `j`. Not following this convention may lead to some reviewer confusion


<i>There is one instance of this issue:</i>

```solidity
📁 File: system-contracts/contracts/Compressor.sol

61:             for (uint256 encodedDataPointer = 0; encodedDataPointer < encodedData.length; encodedDataPointer += 2) { 
```
[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L61)


---
### [NC&#x2011;132] Use `@inheritdoc` for overridden functions
<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

182:     function bridgehubDeposit( 
183:         uint256 _chainId,
184:         address _prevMsgSender,
185:         uint256, // l2Value, needed for Weth deposits in the future
186:         bytes calldata _data
187:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) {

232:     function bridgehubConfirmL2Transaction( 
233:         uint256 _chainId,
234:         bytes32 _txDataHash,
235:         bytes32 _txHash
236:     ) external override onlyBridgehub {

277:     function claimFailedDeposit( 
278:         uint256 _chainId,
279:         address _depositSender,
280:         address _l1Token,
281:         uint256 _amount,
282:         bytes32 _l2TxHash,
283:         uint256 _l2BatchNumber,
284:         uint256 _l2MessageIndex,
285:         uint16 _l2TxNumberInBatch,
286:         bytes32[] calldata _merkleProof
287:     ) external override {

385:     function finalizeWithdrawal( 
386:         uint256 _chainId,
387:         uint256 _l2BatchNumber,
388:         uint256 _l2MessageIndex,
389:         uint16 _l2TxNumberInBatch,
390:         bytes calldata _message,
391:         bytes32[] calldata _merkleProof
392:     ) external override {

554:     function depositLegacyErc20Bridge( 
555:         address _prevMsgSender,
556:         address _l2Receiver,
557:         address _l1Token,
558:         uint256 _amount,
559:         uint256 _l2TxGasLimit,
560:         uint256 _l2TxGasPerPubdataByte,
561:         address _refundRecipient
562:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) {

615:     function finalizeWithdrawalLegacyErc20Bridge( 
616:         uint256 _l2BatchNumber,
617:         uint256 _l2MessageIndex,
618:         uint16 _l2TxNumberInBatch,
619:         bytes calldata _message,
620:         bytes32[] calldata _merkleProof
621:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount) {

644:     function claimFailedDepositLegacyErc20Bridge( 
645:         address _depositSender,
646:         address _l1Token,
647:         uint256 _amount,
648:         bytes32 _l2TxHash,
649:         uint256 _l2BatchNumber,
650:         uint256 _l2MessageIndex,
651:         uint16 _l2TxNumberInBatch,
652:         bytes32[] calldata _merkleProof
653:     ) external override onlyLegacyBridge {
```
[182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L182-L187), [232](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L232-L236), [277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L277-L287), [385](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L385-L392), [554](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L554-L562), [615](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L615-L621), [644](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L644-L653)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

152:     function proveL2MessageInclusion( 
153:         uint256 _chainId,
154:         uint256 _batchNumber,
155:         uint256 _index,
156:         L2Message calldata _message,
157:         bytes32[] calldata _proof
158:     ) external view override returns (bool) {

164:     function proveL2LogInclusion( 
165:         uint256 _chainId,
166:         uint256 _batchNumber,
167:         uint256 _index,
168:         L2Log memory _log,
169:         bytes32[] calldata _proof
170:     ) external view override returns (bool) {

176:     function proveL1ToL2TransactionStatus( 
177:         uint256 _chainId,
178:         bytes32 _l2TxHash,
179:         uint256 _l2BatchNumber,
180:         uint256 _l2MessageIndex,
181:         uint16 _l2TxNumberInBatch,
182:         bytes32[] calldata _merkleProof,
183:         TxStatus _status
184:     ) external view override returns (bool) {

217:     function requestL2TransactionDirect( 
218:         L2TransactionRequestDirect calldata _request
219:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash) {

262:     function requestL2TransactionTwoBridges( 
263:         L2TransactionRequestTwoBridgesOuter calldata _request
264:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash) {
```
[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L152-L158), [164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L164-L170), [176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L176-L184), [217](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L217-L219), [262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L262-L264)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

74:     function getChainAdmin(uint256 _chainId) external view override returns (address) { 
```
[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L74)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

20:     function _setNewProtocolVersion(uint256 _newProtocolVersion) internal override { 

47:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual override returns (bytes32) { 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L20), [47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L47)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

13:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) { 
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L13)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

14:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) { 
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L14)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

35:     function storeAccountConstructingCodeHash(address _address, bytes32 _hash) external override onlyDeployer { 

46:     function storeAccountConstructedCodeHash(address _address, bytes32 _hash) external override onlyDeployer { 

54:     function markAccountCodeHashAsConstructed(address _address) external override onlyDeployer { 

78:     function getRawCodeHash(address _address) public view override returns (bytes32 codeHash) { 

89:     function getCodeHash(uint256 _input) external view override returns (bytes32) { 

117:     function getCodeSize(uint256 _input) external view override returns (uint256 codeSize) { 
```
[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L35), [46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L46), [54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L54), [78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L78), [89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L89), [117](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L117)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

24:     function getTransactionHashes( 
25:         Transaction calldata _transaction
26:     ) external view override returns (bytes32 txHash, bytes32 signedTxHash) {
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L24-L26)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

95:     function getNewAddressCreate2( 
96:         address _sender,
97:         bytes32 _bytecodeHash,
98:         bytes32 _salt,
99:         bytes calldata _input
100:     ) public view override returns (address newAddress) {

115:     function getNewAddressCreate( 
116:         address _sender,
117:         uint256 _senderNonce
118:     ) public pure override returns (address newAddress) {

132:     function create2( 
133:         bytes32 _salt,
134:         bytes32 _bytecodeHash,
135:         bytes calldata _input
136:     ) external payable override returns (address) {

147:     function create( 
148:         bytes32 _salt,
149:         bytes32 _bytecodeHash,
150:         bytes calldata _input
151:     ) external payable override returns (address) {

162:     function create2Account( 
163:         bytes32 _salt,
164:         bytes32 _bytecodeHash,
165:         bytes calldata _input,
166:         AccountAbstractionVersion _aaVersion
167:     ) public payable override onlySystemCall returns (address) {

182:     function createAccount( 
183:         bytes32, // salt
184:         bytes32 _bytecodeHash,
185:         bytes calldata _input,
186:         AccountAbstractionVersion _aaVersion
187:     ) public payable override onlySystemCall returns (address) {
```
[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L95-L100), [115](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L115-L118), [132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L132-L136), [147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L147-L151), [162](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L162-L167), [182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L182-L187)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

67:     function validateTransaction( 
68:         bytes32, // _txHash
69:         bytes32 _suggestedSignedHash,
70:         Transaction calldata _transaction
71:     ) external payable override ignoreNonBootloader ignoreInDelegateCall returns (bytes4 magic) {

112:     function executeTransaction( 
113:         bytes32, // _txHash
114:         bytes32, // _suggestedSignedHash
115:         Transaction calldata _transaction
116:     ) external payable override ignoreNonBootloader ignoreInDelegateCall {

125:     function executeTransactionFromOutside(Transaction calldata _transaction) external payable override { 
```
[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L67-L71), [112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L112-L116), [125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L125)

```solidity
📁 File: system-contracts/contracts/ImmutableSimulator.sol

27:     function getImmutable(address _dest, uint256 _index) external view override returns (bytes32) { 

34:     function setImmutables(address _dest, ImmutableData[] calldata _immutables) external override { 
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L27), [34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L34)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

65:     function getMarker(bytes32 _hash) public view override returns (uint256 marker) { 
```
[65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L65)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

116:     function sendToL1(bytes calldata _message) external override returns (bytes32 hash) { 

161:     function requestBytecodeL1Publication( 
162:         bytes32 _bytecodeHash
163:     ) external override onlyCallFrom(address(KNOWN_CODE_STORAGE_CONTRACT)) {
```
[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L116), [161](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L161-L163)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

32:     function transferFromTo(address _from, address _to, uint256 _amount) external override { 

56:     function balanceOf(uint256 _account) external view override returns (uint256) { 
```
[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L32), [56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L56)

</details>


---
### [NC&#x2011;133] Use a single file for system wide constants
Consider grouping all the system constants under a single file. This finding shows only the first constant for each file, for brevity.

<details>
<summary><i>There are 31 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/common/ReentrancyGuard.sol

29:     uint256 private constant LOCK_FLAG_ADDRESS = 0x8e94fed44239eb2314ab7a406345e6c5a8f0ccedf3b600de3d004e672c33abf4; 

38:     uint256 private constant _NOT_ENTERED = 1; 
39:     uint256 private constant _ENTERED = 2;
```
[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L29), [38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L38-L39)

```solidity
📁 File: contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol

12:     bytes32 private constant CREATE2_PREFIX = keccak256("zksyncCreate2"); 
```
[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L12)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

22:     uint256 internal constant EXECUTED_PROPOSAL_TIMESTAMP = uint256(1); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L22)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

26:     string public constant override getName = "ValidatorTimelock"; 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L26)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

20:     string public constant override getName = "AdminFacet"; 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L20)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

27:     string public constant override getName = "ExecutorFacet"; 
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L27)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

25:     string public constant override getName = "GettersFacet"; 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L25)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

35:     string public constant override getName = "MailboxFacet"; 
```
[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L35)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

17:     bytes32 internal constant DIAMOND_INIT_SUCCESS_RETURN_VALUE = 
18:         0x33774e659306e47509050e97cb651e731180a42d458212294d30751925c551a2; // keccak256("diamond.zksync.init") - 1

21:     bytes32 private constant DIAMOND_STORAGE_POSITION = 
22:         0xc8fcad8db84d3cc18b4c41d551ea0ee66dd599cde068d998e57d5e09332c131b; // keccak256("diamond.standard.diamond.storage") - 1;
```
[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L17-L18), [21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L21-L22)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L22)

```solidity
📁 File: contracts/zksync/contracts/L2ContractHelper.sol

85:     bytes32 private constant CREATE2_PREFIX = keccak256("zksyncCreate2"); 
```
[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L85)

```solidity
📁 File: contracts/zksync/contracts/vendor/AddressAliasHelper.sol

22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L22)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

23:     bytes32 constant EMPTY_STRING_KECCAK = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470; 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L23)

```solidity
📁 File: system-contracts/contracts/GasBoundCaller.sol

18:     uint256 constant CALL_ENTRY_OVERHEAD = 800; 

21:     uint256 constant CALL_RETURN_OVERHEAD = 200; 
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L18), [21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L21)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

44:     uint256 internal constant KECCAK_ROUND_GAS_COST = 40; 

47:     uint256 internal constant KECCAK_ROUND_NUMBER_OF_BYTES = 136; 

55:     uint256 internal constant SHA256_ROUND_GAS_COST = 7; 

58:     uint256 internal constant SHA256_ROUND_NUMBER_OF_BYTES = 64; 
```
[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L44), [47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L47), [55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L55), [58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L58)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

36:     uint256 constant GAS_TO_PASS = 2300; 

41:     uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000; 
```
[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L36), [41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L41)

```solidity
📁 File: system-contracts/contracts/NonceHolder.sol

28:     uint256 private constant DEPLOY_NONCE_MULTIPLIER = 2 ** 128; 

31:     uint256 private constant MAXIMAL_MIN_NONCE_INCREMENT = 2 ** 32; 
```
[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L28), [31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L31)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

23:     uint256 internal constant MINIBLOCK_HASHES_TO_STORE = 257; 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L23)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

82:     bytes32 constant EIP712_DOMAIN_TYPEHASH = keccak256("EIP712Domain(string name,string version,uint256 chainId)"); 

84:     bytes32 constant EIP712_TRANSACTION_TYPE_HASH = 
85:         keccak256(
86:             "Transaction(uint256 txType,uint256 from,uint256 to,uint256 gasLimit,uint256 gasPerPubdataByteLimit,uint256 maxFeePerGas,uint256 maxPriorityFeePerGas,uint256 paymaster,uint256 nonce,uint256 value,bytes data,bytes32[] factoryDeps,bytes paymasterInput)"
87:         );
```
[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L82), [84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L84-L87)

```solidity
📁 File: system-contracts/contracts/libraries/Utils.sol

13:     bytes32 constant IS_CONSTRUCTOR_BYTECODE_HASH_BIT_MASK = 
14:         0x00ff000000000000000000000000000000000000000000000000000000000000;

17:     bytes32 constant SET_IS_CONSTRUCTOR_MARKER_BIT_MASK = 
18:         0x0001000000000000000000000000000000000000000000000000000000000000;
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L13-L14), [17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L17-L18)

</details>


---
### [NC&#x2011;134] Use a struct to encapsulate multiple function parameters
If a function has too many parameters, replacing them with a struct can improve code readability and maintainability, increase reusability, and reduce the likelihood of errors when passing the parameters.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

98:     function deposit( 
99:         address _l2Receiver,
100:         address _l1Token,
101:         uint256 _amount,
102:         uint256 _l2TxGasLimit,
103:         uint256 _l2TxGasPerPubdataByte
104:     ) external payable returns (bytes32 l2TxHash) {

133:     function deposit( 
134:         address _l2Receiver,
135:         address _l1Token,
136:         uint256 _amount,
137:         uint256 _l2TxGasLimit,
138:         uint256 _l2TxGasPerPubdataByte,
139:         address _refundRecipient
140:     ) public payable nonReentrant returns (bytes32 l2TxHash) {

176:     function claimFailedDeposit( 
177:         address _depositSender,
178:         address _l1Token,
179:         bytes32 _l2TxHash,
180:         uint256 _l2BatchNumber,
181:         uint256 _l2MessageIndex,
182:         uint16 _l2TxNumberInBatch,
183:         bytes32[] calldata _merkleProof
184:     ) external nonReentrant {

208:     function finalizeWithdrawal( 
209:         uint256 _l2BatchNumber,
210:         uint256 _l2MessageIndex,
211:         uint16 _l2TxNumberInBatch,
212:         bytes calldata _message,
213:         bytes32[] calldata _merkleProof
214:     ) external nonReentrant {
```
[98](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L98-L104), [133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L133-L140), [176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L176-L184), [208](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L208-L214)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

277:     function claimFailedDeposit( 
278:         uint256 _chainId,
279:         address _depositSender,
280:         address _l1Token,
281:         uint256 _amount,
282:         bytes32 _l2TxHash,
283:         uint256 _l2BatchNumber,
284:         uint256 _l2MessageIndex,
285:         uint16 _l2TxNumberInBatch,
286:         bytes32[] calldata _merkleProof
287:     ) external override {

303:     function _claimFailedDeposit( 
304:         bool _checkedInLegacyBridge,
305:         uint256 _chainId,
306:         address _depositSender,
307:         address _l1Token,
308:         uint256 _amount,
309:         bytes32 _l2TxHash,
310:         uint256 _l2BatchNumber,
311:         uint256 _l2MessageIndex,
312:         uint16 _l2TxNumberInBatch,
313:         bytes32[] calldata _merkleProof
314:     ) internal nonReentrant {

385:     function finalizeWithdrawal( 
386:         uint256 _chainId,
387:         uint256 _l2BatchNumber,
388:         uint256 _l2MessageIndex,
389:         uint16 _l2TxNumberInBatch,
390:         bytes calldata _message,
391:         bytes32[] calldata _merkleProof
392:     ) external override {

409:     function _finalizeWithdrawal( 
410:         uint256 _chainId,
411:         uint256 _l2BatchNumber,
412:         uint256 _l2MessageIndex,
413:         uint16 _l2TxNumberInBatch,
414:         bytes calldata _message,
415:         bytes32[] calldata _merkleProof
416:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount) {

554:     function depositLegacyErc20Bridge( 
555:         address _prevMsgSender,
556:         address _l2Receiver,
557:         address _l1Token,
558:         uint256 _amount,
559:         uint256 _l2TxGasLimit,
560:         uint256 _l2TxGasPerPubdataByte,
561:         address _refundRecipient
562:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) {

615:     function finalizeWithdrawalLegacyErc20Bridge( 
616:         uint256 _l2BatchNumber,
617:         uint256 _l2MessageIndex,
618:         uint16 _l2TxNumberInBatch,
619:         bytes calldata _message,
620:         bytes32[] calldata _merkleProof
621:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount) {

644:     function claimFailedDepositLegacyErc20Bridge( 
645:         address _depositSender,
646:         address _l1Token,
647:         uint256 _amount,
648:         bytes32 _l2TxHash,
649:         uint256 _l2BatchNumber,
650:         uint256 _l2MessageIndex,
651:         uint16 _l2TxNumberInBatch,
652:         bytes32[] calldata _merkleProof
653:     ) external override onlyLegacyBridge {
```
[277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L277-L287), [303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L303-L314), [385](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L385-L392), [409](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L409-L416), [554](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L554-L562), [615](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L615-L621), [644](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L644-L653)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol

26:     function deposit( 

35:     function deposit( 

43:     function claimFailedDeposit( 

53:     function finalizeWithdrawal( 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L26), [35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L35), [43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L43), [53](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L53)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol

64:     function depositLegacyErc20Bridge( 

74:     function claimFailedDepositLegacyErc20Bridge( 

85:     function claimFailedDeposit( 

97:     function finalizeWithdrawalLegacyErc20Bridge( 

105:     function finalizeWithdrawal( 
```
[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L64), [74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L74), [85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L85), [97](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L97), [105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L105)

```solidity
📁 File: contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol

7:     function finalizeDeposit( 
```
[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol#L7)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

114:     function createNewChain( 
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, //_salt
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {

176:     function proveL1ToL2TransactionStatus( 
177:         uint256 _chainId,
178:         bytes32 _l2TxHash,
179:         uint256 _l2BatchNumber,
180:         uint256 _l2MessageIndex,
181:         uint16 _l2TxNumberInBatch,
182:         bytes32[] calldata _merkleProof,
183:         TxStatus _status
184:     ) external view override returns (bool) {
```
[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L121), [176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L176-L184)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/IBridgehub.sol

89:     function proveL1ToL2TransactionStatus( 

116:     function createNewChain( 
```
[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L89), [116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L116)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol

74:     function createNewChain( 
```
[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L74)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

239:     function createNewChain( 
240:         uint256 _chainId,
241:         address _baseToken,
242:         address _sharedBridge,
243:         address _admin,
244:         bytes calldata _diamondCut
245:     ) external onlyBridgehub {
```
[239](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L239-L245)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

74:     function proveL1ToL2TransactionStatus( 
75:         bytes32 _l2TxHash,
76:         uint256 _l2BatchNumber,
77:         uint256 _l2MessageIndex,
78:         uint16 _l2TxNumberInBatch,
79:         bytes32[] calldata _merkleProof,
80:         TxStatus _status
81:     ) public view returns (bool) {

178:     function finalizeEthWithdrawal( 
179:         uint256 _l2BatchNumber,
180:         uint256 _l2MessageIndex,
181:         uint16 _l2TxNumberInBatch,
182:         bytes calldata _message,
183:         bytes32[] calldata _merkleProof
184:     ) external nonReentrant {

197:     function requestL2Transaction( 
198:         address _contractL2,
199:         uint256 _l2Value,
200:         bytes calldata _calldata,
201:         uint256 _l2GasLimit,
202:         uint256 _l2GasPerPubdataByteLimit,
203:         bytes[] calldata _factoryDeps,
204:         address _refundRecipient
205:     ) external payable returns (bytes32 canonicalTxHash) {
```
[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L74-L81), [178](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L178-L184), [197](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L197-L205)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol

47:     function proveL1ToL2TransactionStatus( 

62:     function finalizeEthWithdrawal( 

88:     function requestL2Transaction( 
```
[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L47), [62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L62), [88](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L88)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

321:     function _constructContract( 
322:         address _sender,
323:         address _newAddress,
324:         bytes32 _bytecodeHash,
325:         bytes calldata _input,
326:         bool _isSystem,
327:         bool _callConstructor
328:     ) internal {
```
[321](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L321-L328)

```solidity
📁 File: system-contracts/contracts/SystemContext.sol

341:     function setL2Block( 
342:         uint128 _l2BlockNumber,
343:         uint128 _l2BlockTimestamp,
344:         bytes32 _expectedPrevL2BlockHash,
345:         bool _isFirstInBatch,
346:         uint128 _maxVirtualBlocksToCreate
347:     ) external onlyCallFromBootloader {
```
[341](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L341-L347)

```solidity
📁 File: system-contracts/contracts/libraries/EfficientCall.sol

58:     function call( 
59:         uint256 _gas,
60:         address _address,
61:         uint256 _value,
62:         bytes calldata _data,
63:         bool _isSystem
64:     ) internal returns (bytes memory returnData) {

105:     function mimicCall( 
106:         uint256 _gas,
107:         address _address,
108:         bytes calldata _data,
109:         address _whoToMimic,
110:         bool _isConstructor,
111:         bool _isSystem
112:     ) internal returns (bytes memory returnData) {

124:     function rawCall( 
125:         uint256 _gas,
126:         address _address,
127:         uint256 _value,
128:         bytes calldata _data,
129:         bool _isSystem
130:     ) internal returns (bool success) {

191:     function rawMimicCall( 
192:         uint256 _gas,
193:         address _address,
194:         bytes calldata _data,
195:         address _whoToMimic,
196:         bool _isConstructor,
197:         bool _isSystem
198:     ) internal returns (bool success) {
```
[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L58-L64), [105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L105-L112), [124](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L124-L130), [191](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L191-L198)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractHelper.sol

124:     function packPrecompileParams( 
125:         uint32 _inputMemoryOffset,
126:         uint32 _inputMemoryLength,
127:         uint32 _outputMemoryOffset,
128:         uint32 _outputMemoryLength,
129:         uint64 _perPrecompileInterpreted
130:     ) internal pure returns (uint256 rawParams) {
```
[124](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L124-L130)

</details>


---
### [NC&#x2011;135] Use bit shifts in an imutable variable rather than long bit masks of a single bit, for readability
<details>
<summary><i>There are 3 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L22)

```solidity
📁 File: contracts/zksync/contracts/vendor/AddressAliasHelper.sol

22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L22)

```solidity
📁 File: system-contracts/contracts/libraries/Utils.sol

18:         0x0001000000000000000000000000000000000000000000000000000000000000; 
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L18)

</details>


---
### [NC&#x2011;136] Use `bytes.concat()` on bytes instead of `abi.encodePacked()` for clearer semantic meaning
Starting with version 0.8.4, Solidity has the `bytes.concat()` function, which allows one to concatenate a list of bytes/strings, without extra padding. Using this function rather than `abi.encodePacked()` makes the intended operation more clear, leading to less reviewer confusion.

<details>
<summary><i>There are 6 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

461:                     abi.encodePacked( 
462:                         _prevBatchCommitment,
463:                         _currentBatchCommitment,
464:                         _verifierParams.recursionNodeLevelVkHash,
465:                         _verifierParams.recursionLeafLevelVkHash
466:                     )

548:             abi.encodePacked( 
549:                 l2ToL1LogsHash,
550:                 _stateDiffHash,
551:                 _batch.bootloaderHeapInitialContentsHash,
552:                 _batch.eventsQueueStateHash,
553:                 _encodeBlobAuxilaryOutput(_blobCommitments, _blobHashes)
554:             );

610:         bytes memory precompileInput = abi.encodePacked(_versionedHash, _openingPoint, _openingValueCommitmentProof); 

655:                 abi.encodePacked(blobVersionedHash, _pubdataCommitments[i:i + PUBDATA_COMMITMENT_COMMITMENT_OFFSET]) 
```
[461](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L461-L466), [548](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L548-L554), [610](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L610), [655](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L655)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

133:                 keccak256(abi.encodePacked(_transaction.factoryDeps)), 

142:         return keccak256(abi.encodePacked("\x19\x01", domainSeparator, structHash)); 
```
[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L133), [142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L142)

</details>


---
### [NC&#x2011;137] Use CamelCase for contract and library names
According to the Solidity [style guide](https://docs.soliditylang.org/en/latest/style-guide.html#contract-and-library-names) contracts and library names should be in `CapWords style` (CamelCase).


<i>There is one instance of this issue:</i>

```solidity
📁 File: system-contracts/contracts/libraries/RLPEncoder.sol

10: library RLPEncoder { 
```
[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L10)


---
### [NC&#x2011;138] Use delete instead of assigning values to `false`
The `delete` keyword more closely matches the semantics of what is being done, and draws more attention to the changing of state, which may lead to a more thorough audit of its associated logic.

<details>
<summary><i>There are 3 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

97:         stateTransitionManagerIsRegistered[_stateTransitionManager] = false; 
```
[97](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L97)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

91:         validators[_chainId][_validator] = false; 
```
[91](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L91)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

147:         diamondStorage.isFrozen = false; 
```
[147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L147)

</details>


---
### [NC&#x2011;139] Use EIP-5627 to describe EIP-712 domains
EIP-5267 is a standard which allows for the retrieval and description of EIP-712 hash domains. This enable external tools to allow users to view the fields and values that describe their domain.

This is especially useful when a project may exist on multiple chains and or in multiple contracts, and allows users/tools to verify that the signature is for the right fork, chain, version, contract, etc.


<i>There is one instance of this issue:</i>

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

82:     bytes32 constant EIP712_DOMAIN_TYPEHASH = keccak256("EIP712Domain(string name,string version,uint256 chainId)"); 
```
[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L82)


---
### [NC&#x2011;140] Use of `override` is unnecessary
Starting with Solidity version [0.8.8](https://docs.soliditylang.org/en/v0.8.20/contracts.html#function-overriding), using the override keyword when the function solely overrides an interface function, and the function doesn't exist in multiple base contracts, is unnecessary.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

182:     function bridgehubDeposit( 
183:         uint256 _chainId,
184:         address _prevMsgSender,
185:         uint256, // l2Value, needed for Weth deposits in the future
186:         bytes calldata _data
187:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) {

232:     function bridgehubConfirmL2Transaction( 
233:         uint256 _chainId,
234:         bytes32 _txDataHash,
235:         bytes32 _txHash
236:     ) external override onlyBridgehub {

277:     function claimFailedDeposit( 
278:         uint256 _chainId,
279:         address _depositSender,
280:         address _l1Token,
281:         uint256 _amount,
282:         bytes32 _l2TxHash,
283:         uint256 _l2BatchNumber,
284:         uint256 _l2MessageIndex,
285:         uint16 _l2TxNumberInBatch,
286:         bytes32[] calldata _merkleProof
287:     ) external override {

385:     function finalizeWithdrawal( 
386:         uint256 _chainId,
387:         uint256 _l2BatchNumber,
388:         uint256 _l2MessageIndex,
389:         uint16 _l2TxNumberInBatch,
390:         bytes calldata _message,
391:         bytes32[] calldata _merkleProof
392:     ) external override {

554:     function depositLegacyErc20Bridge( 
555:         address _prevMsgSender,
556:         address _l2Receiver,
557:         address _l1Token,
558:         uint256 _amount,
559:         uint256 _l2TxGasLimit,
560:         uint256 _l2TxGasPerPubdataByte,
561:         address _refundRecipient
562:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) {

615:     function finalizeWithdrawalLegacyErc20Bridge( 
616:         uint256 _l2BatchNumber,
617:         uint256 _l2MessageIndex,
618:         uint16 _l2TxNumberInBatch,
619:         bytes calldata _message,
620:         bytes32[] calldata _merkleProof
621:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount) {

644:     function claimFailedDepositLegacyErc20Bridge( 
645:         address _depositSender,
646:         address _l1Token,
647:         uint256 _amount,
648:         bytes32 _l2TxHash,
649:         uint256 _l2BatchNumber,
650:         uint256 _l2MessageIndex,
651:         uint16 _l2TxNumberInBatch,
652:         bytes32[] calldata _merkleProof
653:     ) external override onlyLegacyBridge {
```
[182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L182-L187), [232](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L232-L236), [277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L277-L287), [385](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L385-L392), [554](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L554-L562), [615](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L615-L621), [644](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L644-L653)

```solidity
📁 File: contracts/ethereum/contracts/bridgehub/Bridgehub.sol

152:     function proveL2MessageInclusion( 
153:         uint256 _chainId,
154:         uint256 _batchNumber,
155:         uint256 _index,
156:         L2Message calldata _message,
157:         bytes32[] calldata _proof
158:     ) external view override returns (bool) {

164:     function proveL2LogInclusion( 
165:         uint256 _chainId,
166:         uint256 _batchNumber,
167:         uint256 _index,
168:         L2Log memory _log,
169:         bytes32[] calldata _proof
170:     ) external view override returns (bool) {

176:     function proveL1ToL2TransactionStatus( 
177:         uint256 _chainId,
178:         bytes32 _l2TxHash,
179:         uint256 _l2BatchNumber,
180:         uint256 _l2MessageIndex,
181:         uint16 _l2TxNumberInBatch,
182:         bytes32[] calldata _merkleProof,
183:         TxStatus _status
184:     ) external view override returns (bool) {

217:     function requestL2TransactionDirect( 
218:         L2TransactionRequestDirect calldata _request
219:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash) {

262:     function requestL2TransactionTwoBridges( 
263:         L2TransactionRequestTwoBridgesOuter calldata _request
264:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash) {
```
[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L152-L158), [164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L164-L170), [176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L176-L184), [217](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L217-L219), [262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L262-L264)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

74:     function getChainAdmin(uint256 _chainId) external view override returns (address) { 
```
[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L74)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol

20:     function _setNewProtocolVersion(uint256 _newProtocolVersion) internal override { 

47:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual override returns (bytes32) { 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L20), [47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L47)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol

13:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) { 
```
[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L13)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol

14:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) { 
```
[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L14)

```solidity
📁 File: system-contracts/contracts/AccountCodeStorage.sol

35:     function storeAccountConstructingCodeHash(address _address, bytes32 _hash) external override onlyDeployer { 

46:     function storeAccountConstructedCodeHash(address _address, bytes32 _hash) external override onlyDeployer { 

54:     function markAccountCodeHashAsConstructed(address _address) external override onlyDeployer { 

78:     function getRawCodeHash(address _address) public view override returns (bytes32 codeHash) { 

89:     function getCodeHash(uint256 _input) external view override returns (bytes32) { 

117:     function getCodeSize(uint256 _input) external view override returns (uint256 codeSize) { 
```
[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L35), [46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L46), [54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L54), [78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L78), [89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L89), [117](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L117)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

24:     function getTransactionHashes( 
25:         Transaction calldata _transaction
26:     ) external view override returns (bytes32 txHash, bytes32 signedTxHash) {
```
[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L24-L26)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

95:     function getNewAddressCreate2( 
96:         address _sender,
97:         bytes32 _bytecodeHash,
98:         bytes32 _salt,
99:         bytes calldata _input
100:     ) public view override returns (address newAddress) {

115:     function getNewAddressCreate( 
116:         address _sender,
117:         uint256 _senderNonce
118:     ) public pure override returns (address newAddress) {

132:     function create2( 
133:         bytes32 _salt,
134:         bytes32 _bytecodeHash,
135:         bytes calldata _input
136:     ) external payable override returns (address) {

147:     function create( 
148:         bytes32 _salt,
149:         bytes32 _bytecodeHash,
150:         bytes calldata _input
151:     ) external payable override returns (address) {

162:     function create2Account( 
163:         bytes32 _salt,
164:         bytes32 _bytecodeHash,
165:         bytes calldata _input,
166:         AccountAbstractionVersion _aaVersion
167:     ) public payable override onlySystemCall returns (address) {

182:     function createAccount( 
183:         bytes32, // salt
184:         bytes32 _bytecodeHash,
185:         bytes calldata _input,
186:         AccountAbstractionVersion _aaVersion
187:     ) public payable override onlySystemCall returns (address) {
```
[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L95-L100), [115](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L115-L118), [132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L132-L136), [147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L147-L151), [162](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L162-L167), [182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L182-L187)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

67:     function validateTransaction( 
68:         bytes32, // _txHash
69:         bytes32 _suggestedSignedHash,
70:         Transaction calldata _transaction
71:     ) external payable override ignoreNonBootloader ignoreInDelegateCall returns (bytes4 magic) {

112:     function executeTransaction( 
113:         bytes32, // _txHash
114:         bytes32, // _suggestedSignedHash
115:         Transaction calldata _transaction
116:     ) external payable override ignoreNonBootloader ignoreInDelegateCall {

125:     function executeTransactionFromOutside(Transaction calldata _transaction) external payable override { 
```
[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L67-L71), [112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L112-L116), [125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L125)

```solidity
📁 File: system-contracts/contracts/ImmutableSimulator.sol

27:     function getImmutable(address _dest, uint256 _index) external view override returns (bytes32) { 

34:     function setImmutables(address _dest, ImmutableData[] calldata _immutables) external override { 
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L27), [34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L34)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

65:     function getMarker(bytes32 _hash) public view override returns (uint256 marker) { 
```
[65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L65)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

116:     function sendToL1(bytes calldata _message) external override returns (bytes32 hash) { 

161:     function requestBytecodeL1Publication( 
162:         bytes32 _bytecodeHash
163:     ) external override onlyCallFrom(address(KNOWN_CODE_STORAGE_CONTRACT)) {
```
[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L116), [161](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L161-L163)

```solidity
📁 File: system-contracts/contracts/L2BaseToken.sol

32:     function transferFromTo(address _from, address _to, uint256 _amount) external override { 

56:     function balanceOf(uint256 _account) external view override returns (uint256) { 
```
[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L32), [56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L56)

</details>


---
### [NC&#x2011;141] Use OpenZeppelin's `MerkleProof` rather than rolling your own
Use [MerkleProof](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/8b2ed0f5706fe1a7ab6ade84b27bf875dc611fda/contracts/utils/cryptography/MerkleProof.sol#L6-L20) for handling Merkle tree proofs, since the general advice is "don't roll your own crypto".


<i>There are 2 instaces of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Merkle.sol

18:     function calculateRoot( 
19:         bytes32[] calldata _path,
20:         uint256 _index,
21:         bytes32 _itemHash
22:     ) internal pure returns (bytes32) {
23:         uint256 pathLength = _path.length;
24:         require(pathLength > 0, "xc");
25:         require(pathLength < 256, "bt");
26:         require(_index < (1 << pathLength), "px");
27: 
28:         bytes32 currentHash = _itemHash;
29:         for (uint256 i; i < pathLength; i = i.uncheckedInc()) {
30:             currentHash = (_index % 2 == 0)
31:                 ? _efficientHash(currentHash, _path[i])
32:                 : _efficientHash(_path[i], currentHash);
33:             _index /= 2;
34:         }
35: 
36:         return currentHash;
37:     }

40:     function _efficientHash(bytes32 _lhs, bytes32 _rhs) private pure returns (bytes32 result) { 
41:         assembly {
42:             mstore(0x00, _lhs)
43:             mstore(0x20, _rhs)
44:             result := keccak256(0x00, 0x40)
45:         }
46:     }
```
[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L18-L37), [40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L40-L46)


---
### [NC&#x2011;142] Use OpenZeppelin's `ReentrancyGuard`/`ReentrancyGuardUpgradeable` rather than writing your own
The OpenZeppelin version has been gas-optimized, and thoroughly test, so consider using it rather than writing your own.


<i>There are 2 instaces of this issue:</i>

```solidity
📁 File: contracts/ethereum/contracts/common/ReentrancyGuard.sol

41:     modifier reentrancyGuardInitializer() { 
42:         _initializeReentrancyGuard();
43:         _;
44:     }

68:     modifier nonReentrant() { 
69:         uint256 _status;
70:         assembly {
71:             _status := sload(LOCK_FLAG_ADDRESS)
72:         }
73: 
74:         // On the first call to nonReentrant, _notEntered will be true
75:         require(_status == _NOT_ENTERED, "r1");
76: 
77:         // Any calls to nonReentrant after this point will fail
78:         assembly {
79:             sstore(LOCK_FLAG_ADDRESS, _ENTERED)
80:         }
81: 
82:         _;
83: 
84:         // By storing the original value once again, a refund is triggered (see
85:         // https://eips.ethereum.org/EIPS/eip-2200)
86:         assembly {
87:             sstore(LOCK_FLAG_ADDRESS, _NOT_ENTERED)
88:         }
89:     }
```
[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L41-L44), [68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L68-L89)


---
### [NC&#x2011;143] Use `string.concat()` on strings instead of `abi.encodePacked()` for clearer semantic meaning
Starting with version 0.8.12, Solidity has the `string.concat()` function, which allows one to concatenate a list of strings, without extra padding. Using this function rather than `abi.encodePacked()` makes the intended operation more clear, leading to less reviewer confusion.

<details>
<summary><i>There are 6 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

461:                     abi.encodePacked( 

548:             abi.encodePacked( 

610:         bytes memory precompileInput = abi.encodePacked(_versionedHash, _openingPoint, _openingValueCommitmentProof); 

655:                 abi.encodePacked(blobVersionedHash, _pubdataCommitments[i:i + PUBDATA_COMMITMENT_COMMITMENT_OFFSET]) 
```
[461](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L461), [548](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L548), [610](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L610), [655](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L655)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

133:                 keccak256(abi.encodePacked(_transaction.factoryDeps)), 

142:         return keccak256(abi.encodePacked("\x19\x01", domainSeparator, structHash)); 
```
[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L133), [142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L142)

</details>


---
### [NC&#x2011;144] Use UPPER_CASE for `constant`
Constants should be in CONSTANT_CASE as stated [Solidity style guide](https://docs.soliditylang.org/en/latest/style-guide.html#constants).

<details>
<summary><i>There are 7 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

26:     string public constant override getName = "ValidatorTimelock"; 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L26)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol

20:     string public constant override getName = "AdminFacet"; 
```
[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L20)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

27:     string public constant override getName = "ExecutorFacet"; 
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L27)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

25:     string public constant override getName = "GettersFacet"; 
```
[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L25)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

35:     string public constant override getName = "MailboxFacet"; 
```
[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L35)

```solidity
📁 File: contracts/ethereum/contracts/vendor/AddressAliasHelper.sol

22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L22)

```solidity
📁 File: contracts/zksync/contracts/vendor/AddressAliasHelper.sol

22:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111); 
```
[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L22)

</details>


---
### [NC&#x2011;145] Use UPPER_CASE for `immutable`
Immutables should be in uppercase as stated [Solidity style guide](https://docs.soliditylang.org/en/latest/style-guide.html#constants).

<details>
<summary><i>There are 5 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

23:     IL1SharedBridge public immutable override sharedBridge; 
```
[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L23)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

34:     address public immutable override l1WethAddress; 

37:     IBridgehub public immutable override bridgehub; 

40:     IL1ERC20Bridge public immutable override legacyBridge; 
```
[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L34), [37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L37), [40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L40)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

27:     address public immutable bridgehub; 
```
[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L27)

</details>


---
### [NC&#x2011;146] `variable`/`struct`/`contract` names should be descriptive rather than cryptic
<details>
<summary><i>There are 25 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

158:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 

164:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 

182:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 

203:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 

218:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 

224:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 

230:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); 
```
[158](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L158), [164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L164), [182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L182), [203](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L203), [218](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L218), [224](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L224), [230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L230)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

127:         DiamondStorage storage ds = getDiamondStorage(); 

150:         DiamondStorage storage ds = getDiamondStorage(); 

173:         DiamondStorage storage ds = getDiamondStorage(); 

190:         DiamondStorage storage ds = getDiamondStorage(); 

206:         DiamondStorage storage ds = getDiamondStorage(); 

229:         DiamondStorage storage ds = getDiamondStorage(); 

258:         DiamondStorage storage ds = getDiamondStorage(); 
```
[127](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L127), [150](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L150), [173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L173), [190](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L190), [206](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L206), [229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L229), [258](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L258)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

146:             uint8 len = operation == 0 ? 32 : metadata >> LENGTH_BITS_OFFSET; 

177:             uint8 len = operation == 0 ? 32 : metadata >> LENGTH_BITS_OFFSET; 
```
[146](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L146), [177](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L177)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

135:         uint32 gas = Utils.safeCastToU32(gasleft()); 

161:         uint8 v; 
162:         bytes32 r;
163:         bytes32 s;
```
[135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L135), [161](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L161-L163)

```solidity
📁 File: system-contracts/contracts/libraries/EfficientCall.sol

264:         uint32 gas = Utils.safeCastToU32(_gas); 
```
[264](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L264)

```solidity
📁 File: system-contracts/contracts/libraries/RLPEncoder.sol

31:                 uint256 hbs = _highestByteSet(_val); 

36:                 uint256 lbs = 31 - hbs; 

66:                 uint256 hbs = _highestByteSet(uint256(_len)); 

71:                 uint256 lbs = 31 - hbs; 
```
[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L31), [36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L36), [66](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L66), [71](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L71)

</details>


---
### [NC&#x2011;147] Variables need not be initialized to zero
The default value for variables is zero, so initializing them to zero is superfluous.

<details>
<summary><i>There are 38 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

225:         for (uint256 i = 0; i < _calls.length; ++i) { 
```
[225](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L225)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol

116:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { 

135:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { 

185:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { 

209:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { 
```
[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L116), [135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L135), [185](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L185), [209](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L209)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol

142:         for (uint256 i = 0; i < emittedL2Logs.length; i = i.uncheckedAdd(L2_TO_L1_LOG_SERIALIZE_SIZE)) { 

257:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) { 

289:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) { 

311:         for (uint256 i = 0; i < _nPriorityOps; i = i.uncheckedInc()) { 

351:         for (uint256 i = 0; i < nBatches; i = i.uncheckedInc()) { 

405:         for (uint256 i = 0; i < committedBatchesLength; i = i.uncheckedInc()) { 

580:         for (uint i = 0; i < MAX_NUMBER_OF_BLOBS; i++) { 

629:         uint256 versionedHashIndex = 0; 

636:         for (uint256 i = 0; i < _pubdataCommitments.length; i += PUBDATA_COMMITMENT_SIZE) { 

667:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) { 
```
[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L142), [257](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L257), [289](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L289), [311](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L311), [351](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L351), [405](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L405), [580](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L580), [629](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L629), [636](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L636), [667](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L667)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol

208:         for (uint256 i = 0; i < facetsLen; i = i.uncheckedInc()) { 
```
[208](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L208)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

356:         for (uint256 i = 0; i < factoryDepsLen; i = i.uncheckedInc()) { 
```
[356](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L356)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/Diamond.sol

101:         for (uint256 i = 0; i < facetCutsLength; i = i.uncheckedInc()) { 

138:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) { 

158:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) { 

178:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) { 
```
[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L101), [138](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L138), [158](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L158), [178](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L178)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol

92:         uint256 costForPubdata = 0; 
```
[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L92)

```solidity
📁 File: contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol

226:         for (uint256 i = 0; i < _factoryDeps.length; ++i) { 
```
[226](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L226)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

61:             for (uint256 encodedDataPointer = 0; encodedDataPointer < encodedData.length; encodedDataPointer += 2) { 

124:         uint256 numInitialWritesProcessed = 0; 

127:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) { 

159:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) { 
```
[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L61), [124](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L124), [127](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L127), [159](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L159)

```solidity
📁 File: system-contracts/contracts/ContractDeployer.sol

247:         uint256 sumOfValues = 0; 
248:         for (uint256 i = 0; i < deploymentsLength; ++i) {

253:         for (uint256 i = 0; i < deploymentsLength; ++i) { 
```
[247](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L247-L248), [253](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L253)

```solidity
📁 File: system-contracts/contracts/ImmutableSimulator.sol

38:             for (uint256 i = 0; i < immutablesLength; ++i) { 
```
[38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L38)

```solidity
📁 File: system-contracts/contracts/KnownCodesStorage.sol

30:             for (uint256 i = 0; i < hashesLen; ++i) { 
```
[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L30)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

197:         uint256 calldataPtr = 0; 

206:         for (uint256 i = 0; i < numberOfL2ToL1Logs; ++i) { 

224:             for (uint256 i = 0; i < nodesOnCurrentLevel; ++i) { 

236:         for (uint256 i = 0; i < numberOfMessages; ++i) { 

254:         for (uint256 i = 0; i < numberOfBytecodes; ++i) { 
```
[197](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L197), [206](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L206), [224](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L224), [236](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L236), [254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L254)

```solidity
📁 File: system-contracts/contracts/PubdataChunkPublisher.sol

36:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) { 
```
[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L36)

</details>


---
### [NC&#x2011;148] Variables should be named in mixedCase style
As the [Solidity Style Guide](https://docs.soliditylang.org/en/latest/style-guide.html#naming-styles) suggests: arguments, local variables and mutable state variables should be named in mixedCase style.

Rule exceptions
- Allow constant variable name/symbol/decimals to be lowercase (ERC20).
- Allow `_` at the beginning of the mixedCase match for `private variables` and `unused parameters`.

<details>
<summary><i>There are 40 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol

/// @audit __DEPRECATED_lastWithdrawalLimitReset
45:     mapping(address => uint256) private __DEPRECATED_lastWithdrawalLimitReset; 

/// @audit __DEPRECATED_withdrawnAmountInWindow
48:     mapping(address => uint256) private __DEPRECATED_withdrawnAmountInWindow; 

/// @audit __DEPRECATED_totalDepositedAmountPerUser
51:     mapping(address => mapping(address => uint256)) private __DEPRECATED_totalDepositedAmountPerUser; 

/// @audit _sharedBridge
55:     constructor(IL1SharedBridge _sharedBridge) reentrancyGuardInitializer { 

/// @audit _token
/// @audit _amount
63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external { 

/// @audit _l1Token
75:     function l2TokenAddress(address _l1Token) external view returns (address) { 

/// @audit _l2Receiver
99:         address _l2Receiver, 
/// @audit _l1Token
100:         address _l1Token,
/// @audit _amount
101:         uint256 _amount,
/// @audit _l2TxGasLimit
102:         uint256 _l2TxGasLimit,
/// @audit _l2TxGasPerPubdataByte
103:         uint256 _l2TxGasPerPubdataByte

/// @audit _l2Receiver
134:         address _l2Receiver, 
/// @audit _l1Token
135:         address _l1Token,
/// @audit _amount
136:         uint256 _amount,
/// @audit _l2TxGasLimit
137:         uint256 _l2TxGasLimit,
/// @audit _l2TxGasPerPubdataByte
138:         uint256 _l2TxGasPerPubdataByte,
/// @audit _refundRecipient
139:         address _refundRecipient

/// @audit _from
/// @audit _token
/// @audit _amount
160:     function _depositFundsToSharedBridge(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) { 

/// @audit _depositSender
177:         address _depositSender, 
/// @audit _l1Token
178:         address _l1Token,
/// @audit _l2TxHash
179:         bytes32 _l2TxHash,
/// @audit _l2BatchNumber
180:         uint256 _l2BatchNumber,
/// @audit _l2MessageIndex
181:         uint256 _l2MessageIndex,
/// @audit _l2TxNumberInBatch
182:         uint16 _l2TxNumberInBatch,
/// @audit _merkleProof
183:         bytes32[] calldata _merkleProof

/// @audit _l2BatchNumber
209:         uint256 _l2BatchNumber, 
/// @audit _l2MessageIndex
210:         uint256 _l2MessageIndex,
/// @audit _l2TxNumberInBatch
211:         uint16 _l2TxNumberInBatch,
/// @audit _message
212:         bytes calldata _message,
/// @audit _merkleProof
213:         bytes32[] calldata _merkleProof
```
[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L45), [48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L48), [51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L51), [55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L55), [63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63), [75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L75), [99](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L99-L103), [134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L134-L139), [160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L160), [177](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L177-L183), [209](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L209-L213)

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

/// @audit _l1WethAddress
91:         address _l1WethAddress, 
/// @audit _bridgehub
92:         IBridgehub _bridgehub,
/// @audit _legacyBridge
93:         IL1ERC20Bridge _legacyBridge

/// @audit _owner
105:         address _owner, 
/// @audit _eraFirstPostUpgradeBatch
106:         uint256 _eraFirstPostUpgradeBatch

/// @audit _token
/// @audit _target
116:     function transferFundsFromLegacy(address _token, address _target, uint256 _targetChainId) external onlyOwner { 
```
[91](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L91-L93), [105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L105-L106), [116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L116)

</details>


---
### [NC&#x2011;149] Zero as a function argument should have a descriptive meaning
Consider using descriptive constants or an enum instead of passing zero directly on function calls, as that might be error-prone, to fully describe the caller's intention.

<details>
<summary><i>There are 23 instances of this issue:</i></summary>

```solidity
📁 File: contracts/ethereum/contracts/bridge/L1SharedBridge.sol

223:                 factoryDeps: new bytes[](0), 

503:         (uint32 functionSignature, uint256 offset) = UnsafeBytes.readUint32(_l2ToL1message, 0); 

584:             L2TransactionRequestDirect memory request = L2TransactionRequestDirect({ 
585:                 chainId: ERA_CHAIN_ID,
586:                 l2Contract: l2BridgeAddress[ERA_CHAIN_ID],
587:                 mintValue: msg.value, // l2 gas + l2 msg.Value the bridgehub will withdraw the mintValue from the base token bridge for gas
588:                 l2Value: 0, // L2 msg.value, this contract doesn't support base token deposits or wrapping functionality, for direct deposits use bridgehub
589:                 l2Calldata: l2TxCalldata,
590:                 l2GasLimit: _l2TxGasLimit,
591:                 l2GasPerPubdataByteLimit: _l2TxGasPerPubdataByte,
592:                 factoryDeps: new bytes[](0),
593:                 refundRecipient: refundRecipient
594:             });
```
[223](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L223), [503](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L503), [584](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L584-L594)

```solidity
📁 File: contracts/ethereum/contracts/governance/Governance.sol

50:         emit ChangeMinDelay(0, _minDelay); 
```
[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L50)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/StateTransitionManager.sol

90:         IExecutor.StoredBatchInfo memory batchZero = IExecutor.StoredBatchInfo( 
91:             0,
92:             _initializeData.genesisBatchHash,
93:             _initializeData.genesisIndexRepeatedStorageChanges,
94:             0,
95:             EMPTY_STRING_KECCAK,
96:             DEFAULT_L2_LOGS_TREE_ROOT_HASH,
97:             0,
98:             _initializeData.genesisBatchCommitment
99:         );

182:         L2CanonicalTransaction memory l2ProtocolUpgradeTx = L2CanonicalTransaction({ 
183:             txType: SYSTEM_UPGRADE_L2_TX_TYPE,
184:             from: uint256(uint160(L2_FORCE_DEPLOYER_ADDR)),
185:             to: uint256(uint160(L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR)),
186:             gasLimit: 5,
187:             gasPerPubdataByteLimit: REQUIRED_L2_GAS_PRICE_PER_PUBDATA,
188:             maxFeePerGas: uint256(0),
189:             maxPriorityFeePerGas: uint256(0),
190:             paymaster: uint256(0),
191:             // Note, that the priority operation id is used as "nonce" for L1->L2 transactions
192:             nonce: protocolVersion,
193:             value: 0,
194:             reserved: [uint256(0), 0, 0, 0],
195:             data: systemContextCalldata,
196:             signature: new bytes(0),
197:             factoryDeps: uintEmptyArray,
198:             paymasterInput: new bytes(0),
199:             reservedDynamic: new bytes(0)
200:         });
```
[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L90-L99), [182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L182-L200)

```solidity
📁 File: contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol

92:         L2Log memory l2Log = L2Log({ 
93:             l2ShardId: 0,
94:             isService: true,
95:             txNumberInBatch: _l2TxNumberInBatch,
96:             sender: L2_BOOTLOADER_ADDRESS,
97:             key: _l2TxHash,
98:             value: bytes32(uint256(_status))
99:         });

132:             L2Log({ 
133:                 l2ShardId: 0,
134:                 isService: true,
135:                 txNumberInBatch: _message.txNumberInBatch,
136:                 sender: L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR,
137:                 key: bytes32(uint256(uint160(_message.sender))),
138:                 value: keccak256(_message.data)
139:             });
```
[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L92-L99), [132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L132-L139)

```solidity
📁 File: contracts/zksync/contracts/SystemContractsCaller.sol

46:         uint256 farCallAbi = getFarCallABI( 
47:             0,
48:             0,
49:             dataStart,
50:             dataLength,
51:             gasLimit,
52:             // Only rollup is supported for now
53:             0,
54:             CalldataForwardingMode.UseHeap,
55:             false,
56:             true
57:         );
```
[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L46-L57)

```solidity
📁 File: contracts/zksync/contracts/bridge/L2SharedBridge.sol

165:         (bool success, bytes memory returndata) = SystemContractsCaller.systemCallWithReturndata( 
166:             uint32(gasleft()),
167:             DEPLOYER_SYSTEM_CONTRACT,
168:             0,
169:             abi.encodeCall(
170:                 IContractDeployer.create2,
171:                 (salt, l2TokenProxyBytecodeHash, abi.encode(address(l2TokenBeacon), ""))
172:             )
173:         );
```
[165](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L165-L173)

```solidity
📁 File: system-contracts/contracts/BootloaderUtilities.sol

176:         bytes memory encodedAccessListLength = RLPEncoder.encodeListLen(0); 

271:         bytes memory encodedAccessListLength = RLPEncoder.encodeListLen(0); 
```
[176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L176), [271](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L271)

```solidity
📁 File: system-contracts/contracts/Compressor.sol

121:         uint256 numberOfInitialWrites = uint256(_compressedStateDiffs.readUint16(0)); 

202:             uint256 dictionaryLen = uint256(_rawCompressedData.readUint16(0)); 
```
[121](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L121), [202](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L202)

```solidity
📁 File: system-contracts/contracts/DefaultAccount.sol

83:         SystemContractsCaller.systemCallWithPropagatedRevert( 
84:             uint32(gasleft()),
85:             address(NONCE_HOLDER_SYSTEM_CONTRACT),
86:             0,
87:             abi.encodeCall(INonceHolder.incrementMinNonceIfEquals, (_transaction.nonce))
88:         );
```
[83](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L83-L88)

```solidity
📁 File: system-contracts/contracts/L1Messenger.sol

75:         L2ToL1Log memory l2ToL1Log = L2ToL1Log({ 
76:             l2ShardId: 0,
77:             isService: _isService,
78:             txNumberInBlock: SYSTEM_CONTEXT_CONTRACT.txNumberInBlock(),
79:             sender: msg.sender,
80:             key: _key,
81:             value: _value
82:         });

125:         L2ToL1Log memory l2ToL1Log = L2ToL1Log({ 
126:             l2ShardId: 0,
127:             isService: true,
128:             txNumberInBlock: SYSTEM_CONTEXT_CONTRACT.txNumberInBlock(),
129:             sender: address(this),
130:             key: bytes32(uint256(uint160(msg.sender))),
131:             value: hash
132:         });
```
[75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L75-L82), [125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L125-L132)

```solidity
📁 File: system-contracts/contracts/MsgValueSimulator.sol

26:         value = SystemContractHelper.getExtraAbiData(0); 
```
[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L26)

```solidity
📁 File: system-contracts/contracts/libraries/EfficientCall.sol

265:         uint256 farCallAbi = SystemContractsCaller.getFarCallABIWithEmptyFatPointer( 
266:             gas,
267:             // Only rollup is supported for now
268:             0,
269:             CalldataForwardingMode.ForwardFatPointer,
270:             _isConstructor,
271:             _isSystem
272:         );
```
[265](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L265-L272)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractHelper.sol

345:         bool precompileCallSuccess = unsafePrecompileCall( 
346:             0, // The precompile parameters are formal ones. We only need the precompile call to burn gas.
347:             _gasToPay,
348:             _pubdataToSpend
349:         );
```
[345](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L345-L349)

```solidity
📁 File: system-contracts/contracts/libraries/SystemContractsCaller.sol

85:         uint256 farCallAbi = SystemContractsCaller.getFarCallABI( 
86:             0,
87:             0,
88:             dataStart,
89:             dataLength,
90:             gasLimit,
91:             // Only rollup is supported for now
92:             0,
93:             CalldataForwardingMode.UseHeap,
94:             false,
95:             true
96:         );
```
[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L85-L96)

```solidity
📁 File: system-contracts/contracts/libraries/TransactionHelper.sol

261:         bytes memory encodedAccessListLength = RLPEncoder.encodeListLen(0); 

333:         bytes memory encodedAccessListLength = RLPEncoder.encodeListLen(0); 
```
[261](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L261), [333](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L333)

</details>
