# QA Report

Issues in [4naly3er-report](https://github.com/code-423n4/2024-03-zksync/blob/main/4naly3er-report.md) have been excluded.

## Summary

### Low Issues

Total **232 instances** over **27 issues**:

|ID|Issue|Instances|
|:--:|:---|:--:|
| [[L-01]](#l-01-missing-storage-gap-for-upgradeable-contracts) | Missing storage gap for upgradeable contracts | 3 |
| [[L-02]](#l-02-array-length-is-not-checked-before-access-its-index) | Array length is not checked before access its index | 2 |
| [[L-03]](#l-03-events-may-be-emitted-out-of-order-due-to-reentrancy) | Events may be emitted out of order due to reentrancy | 22 |
| [[L-04]](#l-04-passing-concat-with-dynamic-arguments-to-a-hash-can-cause-collisions) | Passing `concat()` with dynamic arguments to a hash can cause collisions | 6 |
| [[L-05]](#l-05-draft-imports-may-break-in-new-minor-versions) | Draft imports may break in new minor versions | 1 |
| [[L-06]](#l-06-variables-shadowing-other-definitions) | Variables shadowing other definitions | 4 |
| [[L-07]](#l-07-missing-zero-address-check-in-constructor) | Missing zero address check in constructor | 7 |
| [[L-08]](#l-08-missing-zero-address-check-in-initializer) | Missing zero address check in initializer | 1 |
| [[L-09]](#l-09-function-receivepayable-fallback-does-not-authorize-sender) | Function `receive()`/`payable fallback()` does not authorize sender | 4 |
| [[L-10]](#l-10-revert-on-transfer-to-the-zero-address) | Revert on transfer to the zero address | 2 |
| [[L-11]](#l-11-state-variables-not-limited-to-reasonable-values) | State variables not limited to reasonable values | 3 |
| [[L-12]](#l-12-consider-implementing-two-step-procedure-for-updating-protocol-addresses) | Consider implementing two-step procedure for updating protocol addresses | 7 |
| [[L-13]](#l-13-downcasting-other-types-to-an-address-can-cause-collisions) | Downcasting other types to an address can cause collisions | 21 |
| [[L-14]](#l-14-newer-zksolc-versions-should-be-used) | Newer zksolc versions should be used | 2 |
| [[L-15]](#l-15-constructor--initialization-function-lacks-parameter-validation) | Constructor / initialization function lacks parameter validation | 5 |
| [[L-16]](#l-16-missing-checks-for-address0-when-setting-address-state-variables) | Missing checks for `address(0)` when setting address state variables | 7 |
| [[L-17]](#l-17-unsafe-solidity-low-level-call-can-cause-gas-grief-attack) | Unsafe solidity low-level call can cause gas grief attack | 9 |
| [[L-18]](#l-18-owner-can-renounce-ownership) | Owner can renounce Ownership | 5 |
| [[L-19]](#l-19-functions-calling-contractsaddresses-with-transfer-hooks-should-be-protected-by-reentrancy-guard) | Functions calling contracts/addresses with transfer hooks should be protected by reentrancy guard | 3 |
| [[L-20]](#l-20-critical-functions-should-be-controlled-by-time-locks) | Critical functions should be controlled by time locks | 18 |
| [[L-21]](#l-21-missing-contract-existence-checks-before-low-level-calls) | Missing contract existence checks before low-level calls | 9 |
| [[L-22]](#l-22-external-function-calls-within-loops) | External function calls within loops | 5 |
| [[L-23]](#l-23-the-safeapprove-function-is-deprecated) | The safeApprove() function is deprecated | 2 |
| [[L-24]](#l-24-tokens-may-be-minted-to-the-zero-address) | Tokens may be minted to the zero address | 2 |
| [[L-25]](#l-25-use-safecast-to-downcast-safely) | Use `SafeCast` to downcast safely | 28 |
| [[L-26]](#l-26-use-descriptive-constant-instead-of-0-as-a-parameter) | Use descriptive constant instead of 0 as a parameter | 24 |
| [[L-27]](#l-27-code-does-not-follow-the-best-practice-of-check-effects-interaction) | Code does not follow the best practice of check-effects-interaction | 30 |

### Non Critical Issues

Total **3302 instances** over **108 issues**:

|ID|Issue|Instances|
|:--:|:---|:--:|
| [[N-01]](#n-01-abiencodepacked-should-be-replaced-with-bytesconcat) | `abi.encodePacked()` should be replaced with `bytes.concat()` | 4 |
| [[N-02]](#n-02-import-declarations-should-import-specific-identifiers-rather-than-the-whole-file) | Import declarations should import specific identifiers, rather than the whole file | 41 |
| [[N-03]](#n-03-event-should-include-parameters) | Event should include parameters | 2 |
| [[N-04]](#n-04-visibility-of-state-variables-is-not-explicitly-defined) | Visibility of state variables is not explicitly defined | 9 |
| [[N-05]](#n-05-there-is-no-need-to-initialize-variables-with-0) | There is no need to initialize variables with 0 | 41 |
| [[N-06]](#n-06-names-of-constants-should-use-the-upper_case_with_underscores-style) | Names of constants should use the UPPER_CASE_WITH_UNDERSCORES style | 7 |
| [[N-07]](#n-07-names-of-privateinternal-functions-should-be-prefixed-with-an-underscore) | Names of `private`/`internal` functions should be prefixed with an underscore | 109 |
| [[N-08]](#n-08-names-of-privateinternal-state-variables-should-be-prefixed-with-an-underscore) | Names of `private`/`internal` state variables should be prefixed with an underscore | 40 |
| [[N-09]](#n-09-order-of-functions-does-not-follow-the-solidity-style-guide) | Order of functions does not follow the Solidity Style Guide | 158 |
| [[N-10]](#n-10-the-nonreentrant-modifier-should-occur-before-all-other-modifiers) | The `nonReentrant` `modifier` should occur before all other modifiers | 2 |
| [[N-11]](#n-11-use-of-override-is-unnecessary) | Use of `override` is unnecessary | 53 |
| [[N-12]](#n-12-unused-events) | Unused events | 5 |
| [[N-13]](#n-13-unused-structs) | Unused `struct`s | 1 |
| [[N-14]](#n-14-custom-errors-should-be-used-rather-than-revertrequire) | Custom errors should be used rather than `revert()`/`require()` | 340 |
| [[N-15]](#n-15-use-uint256int256-instead-of-uintint) | Use `uint256`/`int256` instead of `uint`/`int` | 1 |
| [[N-16]](#n-16-large-numeric-literals-should-use-underscores-for-readability) | Large numeric literals should use underscores for readability | 14 |
| [[N-17]](#n-17-add-inline-comments-for-unnamed-parameters) | Add inline comments for unnamed parameters | 9 |
| [[N-18]](#n-18-consider-providing-a-ranged-getter-for-array-state-variables) | Consider providing a ranged getter for array state variables | 1 |
| [[N-19]](#n-19-assembly-blocks-should-have-extensive-comments) | Assembly blocks should have extensive comments | 60 |
| [[N-20]](#n-20-consider-splitting-complex-checks-into-multiple-steps) | Consider splitting complex checks into multiple steps | 5 |
| [[N-21]](#n-21-consider-moving-msgsender-checks-to-modifiers) | Consider moving `msg.sender` checks to `modifier`s | 13 |
| [[N-22]](#n-22-missing-checks-for-empty-bytes-when-updating-bytes-state-variables) | Missing checks for empty bytes when updating bytes state variables | 3 |
| [[N-23]](#n-23-complex-casting) | Complex casting | 26 |
| [[N-24]](#n-24-complex-math-should-be-split-into-multiple-steps) | Complex math should be split into multiple steps | 5 |
| [[N-25]](#n-25-consider-adding-a-blockdeny-list) | Consider adding a block/deny-list | 21 |
| [[N-26]](#n-26-constantsimmutables-redefined-elsewhere) | Constants/Immutables redefined elsewhere | 7 |
| [[N-27]](#n-27-convert-simple-if-statements-to-ternary-expressions) | Convert simple `if`-statements to ternary expressions | 3 |
| [[N-28]](#n-28-contracts-should-each-be-defined-in-separate-files) | Contracts should each be defined in separate files | 2 |
| [[N-29]](#n-29-contract-name-does-not-match-its-filename) | Contract name does not match its filename | 4 |
| [[N-30]](#n-30-do-not-use-literal-numbers-for-array-indexes) | Do not use literal numbers for array indexes | 41 |
| [[N-31]](#n-31-contract-timekeeping-will-break-earlier-than-the-ethereum-network-itself-will-stop-working) | Contract timekeeping will break earlier than the Ethereum network itself will stop working | 2 |
| [[N-32]](#n-32-consider-emitting-an-event-at-the-end-of-the-constructor) | Consider emitting an event at the end of the constructor | 9 |
| [[N-33]](#n-33-empty-function-body-without-comments) | Empty function body without comments | 8 |
| [[N-34]](#n-34-requirerevertstatements-should-have-descriptive-reason-strings) | `require()` / `revert()` statements should have descriptive reason strings | 5 |
| [[N-35]](#n-35-events-are-emitted-without-the-sender-information) | Events are emitted without the sender information | 19 |
| [[N-36]](#n-36-event-is-missing-indexed-fields) | Event is missing `indexed` fields | 18 |
| [[N-37]](#n-37-imports-could-be-organized-more-systematically) | Imports could be organized more systematically | 46 |
| [[N-38]](#n-38-openzeppelincontracts-should-be-upgraded-to-a-newer-version) | @openzeppelin/contracts should be upgraded to a newer version | 20 |
| [[N-39]](#n-39-lib-openzeppelincontracts-upgradeable-should-be-upgraded-to-a-newer-version) | Lib @openzeppelin/contracts-upgradeable should be upgraded to a newer version | 2 |
| [[N-40]](#n-40-lines-are-too-long) | Lines are too long | 164 |
| [[N-41]](#n-41-magic-numbers-should-be-replaced-with-constants) | Magic numbers should be replaced with constants | 180 |
| [[N-42]](#n-42-expressions-for-constant-values-should-use-immutable-rather-than-constant) | Expressions for constant values should use `immutable` rather than `constant` | 36 |
| [[N-43]](#n-43-consider-moving-duplicated-strings-to-constants) | Consider moving duplicated strings to constants | 34 |
| [[N-44]](#n-44-functions-not-used-internally-could-be-marked-external) | Functions not used internally could be marked external | 15 |
| [[N-45]](#n-45-contracts-containing-only-utility-functions-should-be-made-into-libraries) | Contracts containing only utility functions should be made into libraries | 7 |
| [[N-46]](#n-46-contract-uses-both-requirerevert-as-well-as-custom-errors) | Contract uses both `require()`/`revert()` as well as custom errors | 1 |
| [[N-47]](#n-47-functions-should-be-named-in-mixedcase-style) | Functions should be named in mixedCase style | 6 |
| [[N-48]](#n-48-variable-names-for-immutables-should-use-upper_case_with_underscores) | Variable names for `immutable`s should use UPPER_CASE_WITH_UNDERSCORES | 5 |
| [[N-49]](#n-49-order-of-contract-layout-does-not-follow-the-solidity-style-guide) | Order of contract layout does not follow the Solidity Style Guide | 17 |
| [[N-50]](#n-50-consider-adding-validation-of-user-inputs) | Consider adding validation of user inputs | 58 |
| [[N-51]](#n-51-named-imports-of-parent-contracts-are-missing) | Named imports of parent contracts are missing | 5 |
| [[N-52]](#n-52-each-interfaces-should-be-defined-in-a-separate-file) | Each interfaces should be defined in a separate file | 3 |
| [[N-53]](#n-53-libraries-should-be-defined-in-separate-files) | Libraries should be defined in separate files | 3 |
| [[N-54]](#n-54-put-all-system-wide-constants-in-one-file) | Put all system-wide constants in one file | 125 |
| [[N-55]](#n-55-else-block-not-required) | `else`-block not required | 3 |
| [[N-56]](#n-56-redundant-return-statement-in-a-function-with-named-return-variables) | Redundant return statement in a function with named return variables | 1 |
| [[N-57]](#n-57-assertshould-be-replaced-with-require-or-revert) | `assert()` should be replaced with `require()` or `revert()` | 5 |
| [[N-58]](#n-58-large-multiples-of-ten-should-use-scientific-notation) | Large multiples of ten should use scientific notation | 5 |
| [[N-59]](#n-59-spdx-identifier-should-be-the-in-the-first-line-of-a-solidity-file) | SPDX identifier should be the in the first line of a solidity file | 62 |
| [[N-60]](#n-60-todos-left-in-the-code) | `TODO`s left in the code | 3 |
| [[N-61]](#n-61-high-cyclomatic-complexity) | High cyclomatic complexity | 5 |
| [[N-62]](#n-62-typos) | Typos | 26 |
| [[N-63]](#n-63-consider-bounding-input-array-length) | Consider bounding input array length | 18 |
| [[N-64]](#n-64-unnecessary-casting) | Unnecessary casting | 17 |
| [[N-65]](#n-65-unused-contract-variables) | Unused contract variables | 8 |
| [[N-66]](#n-66-unused-function-parameters) | Unused function parameters | 3 |
| [[N-67]](#n-67-unused-import) | Unused import | 164 |
| [[N-68]](#n-68-unused-local-variables) | Unused local variables | 1 |
| [[N-69]](#n-69-unused-named-return) | Unused named return | 3 |
| [[N-70]](#n-70-use-delete-instead-of-assigning-values-to-false) | Use delete instead of assigning values to `false` | 3 |
| [[N-71]](#n-71-consider-using-delete-rather-than-assigning-zero-to-clear-values) | Consider using `delete` rather than assigning zero to clear values | 8 |
| [[N-72]](#n-72-use-the-latest-solidity-version) | Use the latest Solidity version | 103 |
| [[N-73]](#n-73-consider-using-named-function-arguments) | Consider using named function arguments | 22 |
| [[N-74]](#n-74-named-mappings-are-recommended) | Named mappings are recommended | 23 |
| [[N-75]](#n-75-named-returns-are-recommended) | Named returns are recommended | 145 |
| [[N-76]](#n-76-use-transfer-libraries-instead-of-low-level-calls-to-transfer-native-tokens) | Use transfer libraries instead of low level calls to transfer native tokens | 3 |
| [[N-77]](#n-77-use-typexmax-instead-of-constant-formulas-like-2n) | Use `type(X).max` instead of constant formulas like `2**n` | 5 |
| [[N-78]](#n-78-consider-using-the-using-for-syntax) | Consider using the `using`-`for` syntax | 169 |
| [[N-79]](#n-79-using-underscore-at-the-end-of-variable-name) | Using underscore at the end of variable name | 1 |
| [[N-80]](#n-80-use-a-struct-to-encapsulate-multiple-function-parameters) | Use a struct to encapsulate multiple function parameters | 17 |
| [[N-81]](#n-81-returning-a-struct-instead-of-a-bunch-of-variables-is-better) | Returning a struct instead of a bunch of variables is better | 18 |
| [[N-82]](#n-82-events-that-mark-critical-parameter-changes-should-contain-both-the-old-and-the-new-value) | Events that mark critical parameter changes should contain both the old and the new value | 10 |
| [[N-83]](#n-83-contract-variables-should-have-comments) | Contract variables should have comments | 6 |
| [[N-84]](#n-84-missing-event-when-a-state-variables-is-set-in-constructor) | Missing event when a state variables is set in constructor | 3 |
| [[N-85]](#n-85-empty-bytes-check-is-missing) | Empty bytes check is missing | 20 |
| [[N-86]](#n-86-dont-define-functions-with-the-same-name-in-a-contract) | Don't define functions with the same name in a contract | 2 |
| [[N-87]](#n-87-interface-files-should-not-use-fixed-compiler-versions) | Interface files should not use fixed compiler versions | 47 |
| [[N-88]](#n-88-addresses-shouldnt-be-hard-coded) | Addresses shouldn't be hard-coded | 3 |
| [[N-89]](#n-89-assembly-block-creates-dirty-bits) | Assembly block creates dirty bits | 2 |
| [[N-90]](#n-90-multiple-mappings-with-same-keys-can-be-combined-into-a-single-struct-mapping-for-readability) | Multiple mappings with same keys can be combined into a single struct mapping for readability | 19 |
| [[N-91]](#n-91-control-structures-do-not-follow-the-solidity-style-guide) | Control structures do not follow the Solidity Style Guide | 9 |
| [[N-92]](#n-92-do-not-cache-constants) | Do not cache constants | 1 |
| [[N-93]](#n-93-too-long-functions-should-be-refactored) | Too long functions should be refactored | 5 |
| [[N-94]](#n-94-inconsistent-spacing-in-comments) | Inconsistent spacing in comments | 38 |
| [[N-95]](#n-95-missing-event-for-critical-changes) | Missing event for critical changes | 18 |
| [[N-96]](#n-96-non-assembly-method-available) | Non-assembly method available | 19 |
| [[N-97]](#n-97-duplicated-requirerevert-checks-should-be-refactored) | Duplicated `require()`/`revert()` checks should be refactored | 4 |
| [[N-98]](#n-98-consider-adding-emergency-stop-functionality) | Consider adding emergency-stop functionality | 10 |
| [[N-99]](#n-99-avoid-the-use-of-sensitive-terms) | Avoid the use of sensitive terms | 81 |
| [[N-100]](#n-100-missing-checks-for-uint-state-variable-assignments) | Missing checks for uint state variable assignments | 12 |
| [[N-101]](#n-101-use-the-modern-upgradeable-contract-paradigm) | Use the Modern Upgradeable Contract Paradigm | 28 |
| [[N-102]](#n-102-large-or-complicated-code-bases-should-implement-invariant-tests) | Large or complicated code bases should implement invariant tests | 3 |
| [[N-103]](#n-103-the-default-value-is-manually-set-when-it-is-declared) | The default value is manually set when it is declared | 38 |
| [[N-104]](#n-104-contracts-should-have-all-publicexternal-functions-exposed-by-interfaces) | Contracts should have all `public`/`external` functions exposed by `interface`s | 13 |
| [[N-105]](#n-105-top-level-declarations-should-be-separated-by-at-least-two-lines) | Top-level declarations should be separated by at least two lines | 97 |
| [[N-106]](#n-106-consider-adding-formal-verification-proofs) | Consider adding formal verification proofs | 104 |
| [[N-107]](#n-107-use-scopes-sparingly) | Use scopes sparingly | 31 |
| [[N-108]](#n-108-prevent-re-setting-a-state-variable-with-the-same-value) | Prevent re-setting a state variable with the same value | 23 |

## Low Issues

### [L-01] Missing storage gap for upgradeable contracts

Each upgradeable contract (even for most derived) should include a state variable of type fixed-size array (usually named [`__gap`](https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable/blob/f4b309ae37dc650efa7523dd1230d230e3f452d7/contracts/token/ERC20/ERC20Upgradeable.sol#L383) and placed after all other variables) to provide reserved space in storage.
It allows the team to freely add new state variables in the future upgrades without compromising the storage compatibility with existing deployments.

There are 3 instances:

- *L1SharedBridge.sol* ( [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L32-L32) ):

```solidity
32: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step {
```

- *L2SharedBridge.sol* ( [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L25-L25) ):

```solidity
25: contract L2SharedBridge is IL2SharedBridge, Initializable {
```

- *L2StandardERC20.sol* ( [17-17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L17-L17) ):

```solidity
17: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade {
```

### [L-02] Array length is not checked before access its index

Accessing the elements of the array without checking or ensuring the validity of the access index in advance. It may result in an unexpected out-of-bounds error, or may result in missing elements when trying to traverse the entire array.

There are 2 instances:

- *Executor.sol* ( [667-667](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L667-L667), [668-668](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L668-L668) ):

```solidity
667:                 (_blobHashes[i] == bytes32(0) && blobCommitments[i] == bytes32(0)) ||

668:                     (_blobHashes[i] != bytes32(0) && blobCommitments[i] != bytes32(0)),
```

### [L-03] Events may be emitted out of order due to reentrancy

Ensure that events follow the best practice of check-effects-interaction, and are emitted before external calls.

<details>
<summary>There are 22 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [157-157](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L157-L157), [201-201](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L201-L201), [227-227](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L227-L227) ):

```solidity
/// @audit _depositFundsToSharedBridge() is called prior to this emission in deposit(), which will call `safeTransferFrom()`
157:         emit DepositInitiated(l2TxHash, msg.sender, _l2Receiver, _l1Token, _amount);

/// @audit claimFailedDepositLegacyErc20Bridge() is called prior to this emission in claimFailedDeposit()
201:         emit ClaimedFailedDeposit(_depositSender, _l1Token, amount);

/// @audit finalizeWithdrawalLegacyErc20Bridge() is called prior to this emission in finalizeWithdrawal()
227:         emit WithdrawalFinalized(l1Receiver, l1Token, amount);
```

- *L1SharedBridge.sol* ( [170-170](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L170-L170), [229-229](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L229-L229), [369-369](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L369-L369), [456-456](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L456-L456), [604-604](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L604-L604) ):

```solidity
/// @audit _depositFunds() is called prior to this emission in bridgehubDepositBaseToken(), which will call `safeTransferFrom()`
170:         emit BridgehubDepositBaseTokenInitiated(_chainId, _prevMsgSender, _l1Token, _amount);

/// @audit _getDepositL2Calldata() is called prior to this emission in bridgehubDeposit(), which will call `staticcall()`
229:         emit BridgehubDepositInitiated(_chainId, txDataHash, _prevMsgSender, _l2Receiver, _l1Token, amount);

/// @audit safeTransfer() is called prior to this emission in _claimFailedDeposit()
369:         emit ClaimedFailedDepositSharedBridge(_chainId, _depositSender, _l1Token, _amount);

/// @audit safeTransfer() is called prior to this emission in _finalizeWithdrawal()
456:         emit WithdrawalFinalizedSharedBridge(_chainId, l1Receiver, l1Token, amount);

/// @audit _getDepositL2Calldata() is called prior to this emission in depositLegacyErc20Bridge(), which will call `staticcall()`
604:         emit LegacyDepositInitiated(ERA_CHAIN_ID, l2TxHash, _prevMsgSender, _l2Receiver, _l1Token, _amount);
```

- *Bridgehub.sol* ( [147-147](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L147-L147) ):

```solidity
/// @audit createNewChain() is called prior to this emission in createNewChain()
147:         emit NewChain(_chainId, _stateTransitionManager, _admin);
```

- *Governance.sol* ( [182-182](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L182-L182), [201-201](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L201-L201) ):

```solidity
/// @audit _execute() is called prior to this emission in execute(), which will call `call()`
182:         emit OperationExecuted(id);

/// @audit _execute() is called prior to this emission in executeInstant(), which will call `call()`
201:         emit OperationExecuted(id);
```

- *StateTransitionManager.sol* ( [229-229](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L229-L229), [289-289](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L289-L289) ):

```solidity
/// @audit executeUpgrade() is called prior to this emission in _setChainIdUpgrade()
229:         emit SetChainIdUpgrade(_chainContract, l2ProtocolUpgradeTx, protocolVersion);

/// @audit () is called prior to this emission in createNewChain()
289:         emit StateTransitionNewChain(_chainId, stateTransitionAddress);
```

- *Admin.sol* ( [117-117](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L117-L117), [127-127](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L127-L127) ):

```solidity
/// @audit diamondCut() is called prior to this emission in upgradeChainFromVersion(), which will call `delegatecall()`
117:         emit ExecuteUpgrade(_diamondCut);

/// @audit diamondCut() is called prior to this emission in executeUpgrade(), which will call `delegatecall()`
127:         emit ExecuteUpgrade(_diamondCut);
```

- *Diamond.sol* ( [123-123](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L123-L123) ):

```solidity
/// @audit _initializeDiamondCut() is called prior to this emission in diamondCut(), which will call `delegatecall()`
123:         emit DiamondCut(facetCuts, initAddress, initCalldata);
```

- *L2SharedBridge.sol* ( [107-107](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L107-L107), [136-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L136-L136) ):

```solidity
/// @audit bridgeMint() is called prior to this emission in finalizeDeposit()
107:         emit FinalizeDeposit(_l1Sender, _l2Receiver, expectedL2Token, _amount);

/// @audit bridgeBurn() is called prior to this emission in withdraw()
136:         emit WithdrawalInitiated(msg.sender, _l1Receiver, _l2Token, _amount);
```

- *ContractDeployer.sol* ( [355-355](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L355-L355) ):

```solidity
/// @audit storeAccountConstructedCodeHash() is called prior to this emission in _constructContract()
355:         emit ContractDeployed(_sender, _bytecodeHash, _newAddress);
```

- *KnownCodesStorage.sol* ( [59-59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L59-L59) ):

```solidity
/// @audit requestBytecodeL1Publication() is called prior to this emission in _markBytecodeAsPublished()
59:             emit MarkedAsKnown(_bytecodeHash, _shouldSendToL1);
```

- *L2BaseToken.sol* ( [79-79](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L79-L79), [92-92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L92-L92) ):

```solidity
/// @audit sendToL1() is called prior to this emission in withdraw()
79:         emit Withdrawal(msg.sender, _l1Receiver, amount);

/// @audit sendToL1() is called prior to this emission in withdrawWithMessage()
92:         emit WithdrawalWithMessage(msg.sender, _l1Receiver, amount, _additionalData);
```

</details>

### [L-04] Passing `concat()` with dynamic arguments to a hash can cause collisions

Passing `bytes.concat()`/`string.concat()` with **multiple dynamic arguments** can cause hash collisions. It is recommended to use `abi.encode()` instead which will pad items to 32 bytes and [prevent hash collisions](https://docs.soliditylang.org/en/v0.8.20/abi-spec.html#non-standard-packed-mode).

<details>
<summary>There are 6 instances (click to show):</summary>

- *BootloaderUtilities.sol* ( [120-133](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L120-L133), [211-223](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L211-L223), [306-318](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L306-L318) ):

```solidity
120:             keccak256(
121:                 bytes.concat(
122:                     encodedListLength,
123:                     encodedNonce,
124:                     encodedGasParam,
125:                     encodedTo,
126:                     encodedValue,
127:                     encodedDataLength,
128:                     _transaction.data,
129:                     vEncoded,
130:                     rEncoded,
131:                     sEncoded
132:                 )
133:             );

211:             keccak256(
212:                 bytes.concat(
213:                     "\x01",
214:                     encodedListLength,
215:                     encodedFixedLengthParams,
216:                     encodedDataLength,
217:                     _transaction.data,
218:                     encodedAccessListLength,
219:                     vEncoded,
220:                     rEncoded,
221:                     sEncoded
222:                 )
223:             );

306:             keccak256(
307:                 bytes.concat(
308:                     "\x02",
309:                     encodedListLength,
310:                     encodedFixedLengthParams,
311:                     encodedDataLength,
312:                     _transaction.data,
313:                     encodedAccessListLength,
314:                     vEncoded,
315:                     rEncoded,
316:                     sEncoded
317:                 )
318:             );
```

- *TransactionHelper.sol* ( [203-214](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L203-L214), [275-284](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L275-L284), [347-356](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L347-L356) ):

```solidity
203:             keccak256(
204:                 bytes.concat(
205:                     encodedListLength,
206:                     encodedNonce,
207:                     encodedGasParam,
208:                     encodedTo,
209:                     encodedValue,
210:                     encodedDataLength,
211:                     _transaction.data,
212:                     encodedChainId
213:                 )
214:             );

275:             keccak256(
276:                 bytes.concat(
277:                     "\x01",
278:                     encodedListLength,
279:                     encodedFixedLengthParams,
280:                     encodedDataLength,
281:                     _transaction.data,
282:                     encodedAccessListLength
283:                 )
284:             );

347:             keccak256(
348:                 bytes.concat(
349:                     "\x02",
350:                     encodedListLength,
351:                     encodedFixedLengthParams,
352:                     encodedDataLength,
353:                     _transaction.data,
354:                     encodedAccessListLength
355:                 )
356:             );
```

</details>

### [L-05] Draft imports may break in new minor versions

While OpenZeppelin draft contracts are safe to use and have been audited, their 'draft' status means that the EIPs they're based on are not finalized, and thus there may be breaking changes in even [minor releases](https://docs.openzeppelin.com/contracts/3.x/api/drafts). If a bug is found in this version of OpenZeppelin, and the version that you're forced to upgrade to has breaking changes in the new version, you'll encounter unnecessary delays in porting and testing replacement contracts. Ensure that you have extensive test coverage of this area so that differences can be automatically detected, and have a plan in place for how you would fully test a new version of these contracts if they do indeed change unexpectedly. Consider creating a forked version of the file rather than importing it from the package, and manually patch your fork as changes are made.

There is 1 instance:

- *L2StandardERC20.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L7) ):

```solidity
7: import {ERC20PermitUpgradeable} from "@openzeppelin/contracts-upgradeable/token/ERC20/extensions/draft-ERC20PermitUpgradeable.sol";
```

### [L-06] Variables shadowing other definitions

A variable declaration shadowing any other existing definition is error-prone. It can cause confusion for developers, potentially introduce bugs, and reduce the readability and maintainability.

There are 4 instances:

- *L1SharedBridge.sol* ( [107-107](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L107-L107) ):

```solidity
/// @audit Shadows `state variable _owner`
107:         address _owner,
```

- *Bridgehub.sol* ( [43-43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L43-L43) ):

```solidity
/// @audit Shadows `state variable _owner`
43:     function initialize(address _owner) external reentrancyGuardInitializer {
```

- *L2StandardERC20.sol* ( [117-117](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L117-L117), [136-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L136-L136) ):

```solidity
/// @audit Shadows `state variable _version`
117:         uint8 _version

/// @audit Shadows `state variable _version`
136:     modifier onlyNextVersion(uint8 _version) {
```

### [L-07] Missing zero address check in constructor

Constructors often take address parameters to initialize important components of a contract, such as owner or linked contracts. However, without a checking, there's a risk that an address parameter could be mistakenly set to the zero address (0x0). This could be due to an error or oversight during contract deployment. A zero address in a crucial role can cause serious issues, as it cannot perform actions like a normal address, and any funds sent to it will be irretrievable. It's therefore crucial to include a zero address check in constructors to prevent such potential problems. If a zero address is detected, the constructor should revert the transaction.

<details>
<summary>There are 7 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L57-L57) ):

```solidity
/// @audit `_sharedBridge not checked`
57:     constructor(IL1SharedBridge _sharedBridge) reentrancyGuardInitializer {
```

- *L1SharedBridge.sol* ( [92-96](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L92-L96) ):

```solidity
/// @audit `_l1WethAddress not checked`
/// @audit `_bridgehub not checked`
/// @audit `_legacyBridge not checked`
92:     constructor(
93:         address _l1WethAddress,
94:         IBridgehub _bridgehub,
95:         IL1ERC20Bridge _legacyBridge
96:     ) reentrancyGuardInitializer {
```

- *Governance.sol* ( [43-43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L43-L43) ):

```solidity
/// @audit `_securityCouncil not checked`
43:     constructor(address _admin, address _securityCouncil, uint256 _minDelay) {
```

- *StateTransitionManager.sol* ( [60-60](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L60-L60) ):

```solidity
/// @audit `_bridgehub not checked`
60:     constructor(address _bridgehub) reentrancyGuardInitializer {
```

- *ValidatorTimelock.sol* ( [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L57-L57) ):

```solidity
/// @audit `_initialOwner not checked`
57:     constructor(address _initialOwner, uint32 _executionDelay) {
```

</details>

### [L-08] Missing zero address check in initializer

Consider adding a zero address check for each address type parameter in initializer.

There is 1 instance:

- *Bridgehub.sol* ( [43-43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L43-L43) ):

```solidity
/// @audit `_owner not checked`
43:     function initialize(address _owner) external reentrancyGuardInitializer {
```

### [L-09] Function `receive()`/`payable fallback()` does not authorize sender

Users may send ETH by mistake to these contracts. As there is no access control on these functions, the funds will be permanently lost.

There are 4 instances:

- *Governance.sol* ( [264](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L264) ):

```solidity
264:     receive() external payable {}
```

- *DefaultAccount.sol* ( [227](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L227) ):

```solidity
227:     receive() external payable {
```

- *EmptyContract.sol* ( [11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/EmptyContract.sol#L11), [13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/EmptyContract.sol#L13) ):

```solidity
11:     fallback() external payable {}

13:     receive() external payable {}
```

### [L-10] Revert on transfer to the zero address

It's good practice to revert a token transfer transaction if the recipient's address is the zero address. This can prevent unintentional transfers to the zero address due to accidental operations or programming errors. Many token contracts implement such a safeguard, such as [OpenZeppelin - ERC20](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/9e3f4d60c581010c4a3979480e07cc7752f124cc/contracts/token/ERC20/ERC20.sol#L232), [OpenZeppelin - ERC721](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/9e3f4d60c581010c4a3979480e07cc7752f124cc/contracts/token/ERC721/ERC721.sol#L142).

There are 2 instances:

- *L1ERC20Bridge.sol* ( [164-164](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L164-L164) ):

```solidity
164:         _token.safeTransferFrom(_from, address(sharedBridge), _amount);
```

- *L1SharedBridge.sol* ( [454-454](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L454-L454) ):

```solidity
454:             IERC20(l1Token).safeTransfer(l1Receiver, amount);
```

### [L-11] State variables not limited to reasonable values

Consider adding appropriate minimum/maximum value checks to ensure that the following state variables can never be used to excessively harm users, including via griefing.

There are 3 instances:

- *Governance.sol* ( [253-253](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L253-L253) ):

```solidity
253:         minDelay = _newDelay;
```

- *SystemContext.sol* ( [463-463](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L463-L463), [479-479](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L479-L479) ):

```solidity
463:         baseFee = _baseFee;

479:         baseFee = _baseFee;
```

### [L-12] Consider implementing two-step procedure for updating protocol addresses

A copy-paste error or a typo may end up bricking protocol functionality, or sending tokens to an address with no known private key. Consider implementing a two-step procedure for updating protocol addresses, where the recipient is set as pending, and must 'accept' the assignment by making an affirmative call. A straight forward way of doing this would be to have the target contracts implement [EIP-165](https://eips.ethereum.org/EIPS/eip-165), and to have the 'set' functions ensure that the recipient is of the right interface type.

<details>
<summary>There are 7 instances (click to show):</summary>

- *Bridgehub.sol* ( [53-59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L53-L59), [110-112](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L110-L112) ):

```solidity
53:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin {
54:         // Save previous value into the stack to put it into the event later
55:         address oldPendingAdmin = pendingAdmin;
56:         // Change pending admin
57:         pendingAdmin = _newPendingAdmin;
58:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
59:     }

110:     function setSharedBridge(address _sharedBridge) external onlyOwner {
111:         sharedBridge = IL1SharedBridge(_sharedBridge);
112:     }
```

- *StateTransitionManager.sol* ( [112-118](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L112-L118), [134-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L134-L136) ):

```solidity
112:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin {
113:         // Save previous value into the stack to put it into the event later
114:         address oldPendingAdmin = pendingAdmin;
115:         // Change pending admin
116:         pendingAdmin = _newPendingAdmin;
117:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
118:     }

134:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin {
135:         validatorTimelock = _validatorTimelock;
136:     }
```

- *ValidatorTimelock.sol* ( [75-77](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L75-L77) ):

```solidity
75:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner {
76:         stateTransitionManager = _stateTransitionManager;
77:     }
```

- *Admin.sol* ( [25-31](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L25-L31), [47-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L47-L50) ):

```solidity
25:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin {
26:         // Save previous value into the stack to put it into the event later
27:         address oldPendingAdmin = s.pendingAdmin;
28:         // Change pending admin
29:         s.pendingAdmin = _newPendingAdmin;
30:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
31:     }

47:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager {
48:         s.validators[_validator] = _active;
49:         emit ValidatorStatusUpdate(_validator, _active);
50:     }
```

</details>

### [L-13] Downcasting other types to an address can cause collisions

Downcasting other types to an address will truncates the upper bytes, which means that multiple values can be mapped to an address, i.e. address collisions can occur.

<details>
<summary>There are 21 instances (click to show):</summary>

- *L2ContractHelper.sol* ( [73-73](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L73-L73) ):

```solidity
73:         return address(uint160(uint256(data)));
```

- *AddressAliasHelper.sol* ( [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L32-L32), [42-42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L42-L42) ):

```solidity
32:             l2Address = address(uint160(l1Address) + offset);

42:             l1Address = address(uint160(l2Address) - offset);
```

- *L2ContractHelper.sol* ( [114-114](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L114-L114) ):

```solidity
114:         return address(uint160(uint256(data)));
```

- *AddressAliasHelper.sol* ( [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L32-L32), [42-42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L42-L42) ):

```solidity
32:             l2Address = address(uint160(l1Address) + offset);

42:             l1Address = address(uint160(l2Address) - offset);
```

- *AccountCodeStorage.sol* ( [92-92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L92-L92), [120-120](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L120-L120) ):

```solidity
92:         address account = address(uint160(_input));

120:         address account = address(uint160(_input));
```

- *BootloaderUtilities.sol* ( [61-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L61-L61), [147-147](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L147-L147), [241-241](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L241-L241) ):

```solidity
61:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));

147:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));

241:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));
```

- *ContractDeployer.sol* ( [109-109](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L109-L109), [125-125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L125-L125) ):

```solidity
109:         newAddress = address(uint160(uint256(hash)));

125:         newAddress = address(uint160(uint256(hash)));
```

- *DefaultAccount.sol* ( [132-132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L132-L132) ):

```solidity
132:         address to = address(uint160(_transaction.to));
```

- *L2BaseToken.sol* ( [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L57-L57) ):

```solidity
57:         return balance[address(uint160(_account))];
```

- *MsgValueSimulator.sol* ( [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L32-L32) ):

```solidity
32:         to = address(uint160(addressAsUint));
```

- *TransactionHelper.sol* ( [164-164](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L164-L164), [232-232](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L232-L232), [303-303](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L303-L303), [375-375](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L375-L375), [406-406](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L406-L406) ):

```solidity
164:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));

232:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));

303:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));

375:             address paymaster = address(uint160(_transaction.paymaster));

406:         if (address(uint160(_transaction.paymaster)) != address(0)) {
```

</details>

### [L-14] Newer zksolc versions should be used

The [latest versions of zksolc](https://github.com/matter-labs/zksolc-bin/releases) have **fixed some known bugs** and added a number of new features and optimizations. See [the changelog](https://github.com/matter-labs/era-compiler-solidity/blob/main/CHANGELOG.md) for details.

There are 2 instances:

- Global finding

- Global finding

### [L-15] Constructor / initialization function lacks parameter validation

Constructors and initialization functions play a critical role in contracts by setting important initial states when the contract is first deployed before the system starts. The parameters passed to the constructor and initialization functions directly affect the behavior of the contract / protocol. If incorrect parameters are provided, the system may fail to run, behave abnormally, be unstable, or lack security. Therefore, it's crucial to carefully check each parameter in the constructor and initialization functions. If an exception is found, the transaction should be rolled back.

<details>
<summary>There are 5 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [106-109](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L106-L109) ):

```solidity
/// @audit `_eraFirstPostUpgradeBatch`
106:     function initialize(
107:         address _owner,
108:         uint256 _eraFirstPostUpgradeBatch
109:     ) external reentrancyGuardInitializer initializer {
```

- *Governance.sol* ( [43-43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L43-L43) ):

```solidity
/// @audit `_minDelay`
43:     constructor(address _admin, address _securityCouncil, uint256 _minDelay) {
```

- *ValidatorTimelock.sol* ( [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L57-L57) ):

```solidity
/// @audit `_executionDelay`
57:     constructor(address _initialOwner, uint32 _executionDelay) {
```

- *DiamondProxy.sol* ( [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L13-L13) ):

```solidity
/// @audit `_diamondCut`
13:     constructor(uint256 _chainId, Diamond.DiamondCutData memory _diamondCut) {
```

- *L2StandardERC20.sol* ( [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L52-L52) ):

```solidity
/// @audit `_data`
52:     function bridgeInitialize(address _l1Address, bytes memory _data) external initializer {
```

</details>

### [L-16] Missing checks for `address(0)` when setting address state variables

Consider adding a zero address check when setting address state variables.

<details>
<summary>There are 7 instances (click to show):</summary>

- *Bridgehub.sol* ( [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L57-L57), [111-111](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L111-L111) ):

```solidity
57:         pendingAdmin = _newPendingAdmin;

111:         sharedBridge = IL1SharedBridge(_sharedBridge);
```

- *Governance.sol* ( [260-260](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L260-L260) ):

```solidity
260:         securityCouncil = _newSecurityCouncil;
```

- *StateTransitionManager.sol* ( [116-116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L116-L116), [135-135](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L135-L135) ):

```solidity
116:         pendingAdmin = _newPendingAdmin;

135:         validatorTimelock = _validatorTimelock;
```

- *ValidatorTimelock.sol* ( [76-76](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L76-L76) ):

```solidity
76:         stateTransitionManager = _stateTransitionManager;
```

- *SystemContext.sol* ( [100-100](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L100-L100) ):

```solidity
100:         origin = _newOrigin;
```

</details>

### [L-17] Unsafe solidity low-level call can cause gas grief attack

Using the low-level calls of a solidity address can leave the contract open to gas grief attacks. These attacks occur when the called contract returns a large amount of data.
So when calling an external contract, it is necessary to check the length of the return data before reading/copying it (using `returndatasize()`).

<details>
<summary>There are 9 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [264-264](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L264-L264), [265-265](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L265-L265), [266-266](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L266-L266) ):

```solidity
264:         (, bytes memory data1) = _token.staticcall(abi.encodeCall(IERC20Metadata.name, ()));

265:         (, bytes memory data2) = _token.staticcall(abi.encodeCall(IERC20Metadata.symbol, ()));

266:         (, bytes memory data3) = _token.staticcall(abi.encodeCall(IERC20Metadata.decimals, ()));
```

- *Governance.sol* ( [228-228](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L228-L228) ):

```solidity
228:             (bool success, bytes memory returnData) = _calls[i].target.call{value: _calls[i].value}(_calls[i].data);
```

- *Executor.sol* ( [610-610](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L610-L610), [678-678](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L678-L678) ):

```solidity
610:         (bool success, bytes memory data) = POINT_EVALUATION_PRECOMPILE_ADDR.staticcall(precompileInput);

678:         (bool success, bytes memory data) = s.blobVersionedHashRetriever.staticcall(abi.encode(_index));
```

- *Diamond.sol* ( [285-285](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L285-L285) ):

```solidity
285:             (bool success, bytes memory data) = _init.delegatecall(_calldata);
```

- *ComplexUpgrader.sol* ( [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol#L25-L25) ):

```solidity
25:         (bool success, bytes memory returnData) = _delegateTo.delegatecall(_calldata);
```

- *MsgValueSimulator.sol* ( [63-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L63-L65) ):

```solidity
63:             (bool success, ) = address(REAL_BASE_TOKEN_SYSTEM_CONTRACT).call(
64:                 abi.encodeCall(REAL_BASE_TOKEN_SYSTEM_CONTRACT.transferFromTo, (msg.sender, to, value))
65:             );
```

</details>

### [L-18] Owner can renounce Ownership

Each of the following contracts implements or inherits the `renounceOwnership()` function. This can represent a certain risk if the ownership is renounced for any other reason than by design. Renouncing ownership will leave the contract without an owner, thereby removing any functionality that is only available to the owner.

<details>
<summary>There are 5 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L32-L32) ):

```solidity
32: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step {
```

- *Bridgehub.sol* ( [18-19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L18-L19) ):

```solidity
18: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step {
19:     /// @notice all the ether is held by the weth bridge
```

- *Governance.sol* ( [22-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L22-L23) ):

```solidity
22: contract Governance is IGovernance, Ownable2Step {
23:     /// @notice A constant representing the timestamp for completed operations.
```

- *StateTransitionManager.sol* ( [27-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L27-L28) ):

```solidity
27: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step {
28:     /// @notice Address of the bridgehub
```

- *ValidatorTimelock.sol* ( [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L24-L24) ):

```solidity
24: contract ValidatorTimelock is IExecutor, Ownable2Step {
```

</details>

### [L-19] Functions calling contracts/addresses with transfer hooks should be protected by reentrancy guard

Even if the function follows the best practice of check-effects-interaction, not using a reentrancy guard when there may be transfer hooks opens the users of this protocol up to [read-only reentrancy vulnerability](https://chainsecurity.com/curve-lp-oracle-manipulation-post-mortem/) with no way to protect them except by block-listing the entire protocol.

There are 3 instances:

- *L1ERC20Bridge.sol* ( [69-69](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L69-L69), [164-164](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L164-L164) ):

```solidity
69:         IERC20(_token).safeTransfer(address(sharedBridge), amount);

164:         _token.safeTransferFrom(_from, address(sharedBridge), _amount);
```

- *L1SharedBridge.sol* ( [177-177](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L177-L177) ):

```solidity
177:         _token.safeTransferFrom(_from, address(this), _amount);
```

### [L-20] Critical functions should be controlled by time locks

It is a good practice to give time for users to react and adjust to critical changes. A timelock provides more guarantees and reduces the level of trust required, thus decreasing risk for users. It also indicates that the project is legitimate (less risk of a malicious owner making a sandwich attack on a user).

<details>
<summary>There are 18 instances (click to show):</summary>

- *Bridgehub.sol* ( [53-53](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L53-L53), [84-84](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L84-L84), [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L94-L94), [103-103](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L103-L103), [110-110](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L110-L110) ):

```solidity
53:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin {

84:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner {

94:     function removeStateTransitionManager(address _stateTransitionManager) external onlyOwner {

103:     function addToken(address _token) external onlyOwner {

110:     function setSharedBridge(address _sharedBridge) external onlyOwner {
```

- *Governance.sol* ( [258-258](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L258-L258) ):

```solidity
258:     function updateSecurityCouncil(address _newSecurityCouncil) external onlySelf {
```

- *StateTransitionManager.sol* ( [112-112](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L112-L112), [134-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L134-L134) ):

```solidity
112:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin {

134:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin {
```

- *ValidatorTimelock.sol* ( [75-75](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L75-L75), [80-80](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L80-L80), [89-89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L89-L89) ):

```solidity
75:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner {

80:     function addValidator(uint256 _chainId, address _newValidator) external onlyChainAdmin(_chainId) {

89:     function removeValidator(uint256 _chainId, address _validator) external onlyChainAdmin(_chainId) {
```

- *Admin.sol* ( [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L25-L25), [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L47-L47) ):

```solidity
25:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin {

47:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager {
```

- *BaseZkSyncUpgrade.sol* ( [128-128](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L128-L128), [165-165](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L165-L165) ):

```solidity
128:     function _setVerifier(IVerifier _newVerifier) private {

165:     function _upgradeVerifier(address _newVerifier, VerifierParams calldata _verifierParams) internal {
```

- *ComplexUpgrader.sol* ( [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol#L21-L21) ):

```solidity
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable {
```

- *ImmutableSimulator.sol* ( [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L34-L34) ):

```solidity
34:     function setImmutables(address _dest, ImmutableData[] calldata _immutables) external override {
```

- *SystemContext.sol* ( [99-99](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L99-L99) ):

```solidity
99:     function setTxOrigin(address _newOrigin) external onlyCallFromBootloader {
```

</details>

### [L-21] Missing contract existence checks before low-level calls

Low-level calls return success if there is no code present at the specified address. In addition to the zero-address checks, add a check to verify that `<address>.code.length > 0`.

<details>
<summary>There are 9 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [264-264](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L264-L264), [265-265](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L265-L265), [266-266](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L266-L266) ):

```solidity
264:         (, bytes memory data1) = _token.staticcall(abi.encodeCall(IERC20Metadata.name, ()));

265:         (, bytes memory data2) = _token.staticcall(abi.encodeCall(IERC20Metadata.symbol, ()));

266:         (, bytes memory data3) = _token.staticcall(abi.encodeCall(IERC20Metadata.decimals, ()));
```

- *Governance.sol* ( [228-228](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L228-L228) ):

```solidity
228:             (bool success, bytes memory returnData) = _calls[i].target.call{value: _calls[i].value}(_calls[i].data);
```

- *Executor.sol* ( [610-610](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L610-L610), [678-678](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L678-L678) ):

```solidity
610:         (bool success, bytes memory data) = POINT_EVALUATION_PRECOMPILE_ADDR.staticcall(precompileInput);

678:         (bool success, bytes memory data) = s.blobVersionedHashRetriever.staticcall(abi.encode(_index));
```

- *Diamond.sol* ( [285-285](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L285-L285) ):

```solidity
285:             (bool success, bytes memory data) = _init.delegatecall(_calldata);
```

- *ComplexUpgrader.sol* ( [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol#L25-L25) ):

```solidity
25:         (bool success, bytes memory returnData) = _delegateTo.delegatecall(_calldata);
```

- *MsgValueSimulator.sol* ( [63-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L63-L65) ):

```solidity
63:             (bool success, ) = address(REAL_BASE_TOKEN_SYSTEM_CONTRACT).call(
64:                 abi.encodeCall(REAL_BASE_TOKEN_SYSTEM_CONTRACT.transferFromTo, (msg.sender, to, value))
65:             );
```

</details>

### [L-22] External function calls within loops

Calling external functions within loops can easily result in insufficient gas. This greatly increases the likelihood of transaction failures, DOS attacks, and other unexpected actions. It is recommended to limit the number of loops within loops that call external functions, and to limit the gas line for each external call.

<details>
<summary>There are 5 instances (click to show):</summary>

- *Governance.sol* ( [228-228](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L228-L228) ):

```solidity
/// @audit Calling `call()` within `for` loop
228:             (bool success, bytes memory returnData) = _calls[i].target.call{value: _calls[i].value}(_calls[i].data);
```

- *Executor.sol* ( [635-635](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L635-L635), [645-649](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L645-L649) ):

```solidity
/// @audit Calling `_getBlobVersionedHash()` within `for` loop, it will trigger an external call - `staticcall()`
635:             bytes32 blobVersionedHash = _getBlobVersionedHash(versionedHashIndex);

/// @audit Calling `_pointEvaluationPrecompile()` within `for` loop, it will trigger an external call - `staticcall()`
645:             _pointEvaluationPrecompile(
646:                 blobVersionedHash,
647:                 openingPoint,
648:                 _pubdataCommitments[i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET:i + PUBDATA_COMMITMENT_SIZE]
649:             );
```

- *ContractDeployer.sol* ( [254-254](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L254-L254) ):

```solidity
/// @audit Calling `forceDeployOnAddress()` within `for` loop
254:             this.forceDeployOnAddress{value: _deployments[i].value}(_deployments[i], msg.sender);
```

- *KnownCodesStorage.sol* ( [31-31](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L31-L31) ):

```solidity
/// @audit Calling `_markBytecodeAsPublished()` within `for` loop, it will trigger an external call - `requestBytecodeL1Publication()`
31:                 _markBytecodeAsPublished(_hashes[i], _shouldSendToL1);
```

</details>

### [L-23] The safeApprove() function is deprecated

The `safeApprove()` like function [is deprecated](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/bfff03c0d2a59bcd8e2ead1da9aed9edf0080d05/contracts/token/ERC20/utils/SafeERC20.sol#L38-L49).
It is encouraged to use `safeIncreaseAllowance()` and `safeDecreaseAllowance()` instead.

There are 2 instances:

- *TransactionHelper.sol* ( [382](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L382), [383](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L383) ):

```solidity
382:                 IERC20(token).safeApprove(paymaster, 0);

383:                 IERC20(token).safeApprove(paymaster, minAllowance);
```

### [L-24] Tokens may be minted to the zero address

Neither the listed functions, nor `_mint()` prevent minting to `address(0x0)`

There are 2 instances:

- *L2StandardERC20.sol* ( [148-148](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L148-L148) ):

```solidity
148:         _mint(_to, _amount);
```

- *L2BaseToken.sol* ( [64-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L64-L64) ):

```solidity
64:     function mint(address _account, uint256 _amount) external override onlyCallFromBootloader {
```

### [L-25] Use `SafeCast` to downcast safely

When a type is downcast to a smaller type, the higher order bits are truncated, effectively applying a modulo to the original value. The loss of data may cause incorrect calculations, unexpected state changes, or other unexpected behavior.
It is recommended to use the [SafeCast library](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/math/SafeCast.sol).

<details>
<summary>There are 28 instances (click to show):</summary>

- *ValidatorTimelock.sol* ( [117-117](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L117-L117), [136-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L136-L136) ):

```solidity
/// @audit uint256 -> uint32
117:             uint32 timestamp = uint32(block.timestamp);

/// @audit uint256 -> uint32
136:             uint32 timestamp = uint32(block.timestamp);
```

- *LibMap.sol* ( [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L32-L32), [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L56-L56) ):

```solidity
/// @audit uint256 -> uint32
32:             result = uint32(mapValue >> bitOffset);

/// @audit uint256 -> uint32
56:             uint32 oldValue = uint32(mapValue >> bitOffset);
```

- *L2SharedBridge.sol* ( [168-168](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L168-L168) ):

```solidity
/// @audit uint256 -> uint32
168:             uint32(gasleft()),
```

- *BootloaderUtilities.sol* ( [116-116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L116-L116), [207-207](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L207-L207), [302-302](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L302-L302) ):

```solidity
/// @audit uint256 -> uint64
116:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength));

/// @audit uint256 -> uint64
207:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength));

/// @audit uint256 -> uint64
302:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength));
```

- *DefaultAccount.sol* ( [84-84](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L84-L84) ):

```solidity
/// @audit uint256 -> uint32
84:             uint32(gasleft()),
```

- *L1Messenger.sol* ( [154-154](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L154-L154), [179-179](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L179-L179) ):

```solidity
/// @audit uint256 -> uint32
154:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), uint32(pubdataLen));

/// @audit uint256 -> uint32
179:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), uint32(pubdataLen));
```

- *SystemContext.sol* ( [234-234](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L234-L234), [476-476](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L476-L476), [476-476](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L476-L476) ):

```solidity
/// @audit uint128 -> uint32
234:         return keccak256(abi.encodePacked(uint32(_blockNumber)));

/// @audit uint256 -> uint128
476:         BlockInfo memory newBlockInfo = BlockInfo({number: uint128(_number), timestamp: uint128(_newTimestamp)});

/// @audit uint256 -> uint128
476:         BlockInfo memory newBlockInfo = BlockInfo({number: uint128(_number), timestamp: uint128(_newTimestamp)});
```

- *EfficientCall.sol* ( [259-259](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L259-L259), [261-261](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L261-L261) ):

```solidity
/// @audit uint256 -> uint32
259:         SystemContractHelper.ptrAddIntoActive(uint32(dataOffset));

/// @audit uint256 -> uint32
261:         uint32 shrinkTo = uint32(msg.data.length - (_data.length + dataOffset));
```

- *RLPEncoder.sol* ( [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L34-L34), [64-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L64-L64), [69-69](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L69-L69) ):

```solidity
/// @audit uint256 -> uint8
34:                 encoded[0] = bytes1(uint8(hbs + 0x81));

/// @audit uint256 -> uint8
64:                 encoded[0] = bytes1(uint8(_len + _offset));

/// @audit uint256 -> uint8
69:                 encoded[0] = bytes1(uint8(_offset + hbs + 56));
```

- *SystemContractHelper.sol* ( [228-228](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L228-L228), [238-238](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L238-L238), [247-247](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L247-L247), [255-255](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L255-L255), [264-264](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L264-L264), [273-273](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L273-L273) ):

```solidity
/// @audit uint256 -> uint32
228:         pubdataPublished = uint32(extractNumberFromMeta(meta, META_GAS_PER_PUBDATA_BYTE_OFFSET, 32));

/// @audit uint256 -> uint32
238:         heapSize = uint32(extractNumberFromMeta(meta, META_HEAP_SIZE_OFFSET, 32));

/// @audit uint256 -> uint32
247:         auxHeapSize = uint32(extractNumberFromMeta(meta, META_AUX_HEAP_SIZE_OFFSET, 32));

/// @audit uint256 -> uint8
255:         shardId = uint8(extractNumberFromMeta(meta, META_SHARD_ID_OFFSET, 8));

/// @audit uint256 -> uint8
264:         callerShardId = uint8(extractNumberFromMeta(meta, META_CALLER_SHARD_ID_OFFSET, 8));

/// @audit uint256 -> uint8
273:         codeShardId = uint8(extractNumberFromMeta(meta, META_CODE_SHARD_ID_OFFSET, 8));
```

- *TransactionHelper.sol* ( [199-199](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L199-L199), [271-271](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L271-L271), [343-343](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L343-L343) ):

```solidity
/// @audit uint256 -> uint64
199:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength));

/// @audit uint256 -> uint64
271:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength));

/// @audit uint256 -> uint64
343:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength));
```

</details>

### [L-26] Use descriptive constant instead of 0 as a parameter

Passing `0` or `0x0` as a function argument can sometimes result in a security issue(e.g. passing zero as the slippage parameter). A historical example is the infamous `0x0` address bug where numerous tokens were lost. This happens because `0` can be interpreted as an uninitialized `address`, leading to transfers to the `0x0` `address`, effectively burning tokens. Moreover, `0` as a denominator in division operations would cause a runtime exception. It's also often indicative of a logical error in the caller's code.

Consider using a constant variable with a descriptive name, so it's clear that the argument is intentionally being used, and for the right reasons.

<details>
<summary>There are 24 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [107-107](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L107-L107) ):

```solidity
107:         l2TxHash = deposit(_l2Receiver, _l1Token, _amount, _l2TxGasLimit, _l2TxGasPerPubdataByte, address(0));
```

- *L1SharedBridge.sol* ( [505-505](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L505-L505) ):

```solidity
505:         (uint32 functionSignature, uint256 offset) = UnsafeBytes.readUint32(_l2ToL1message, 0);
```

- *Executor.sol* ( [260-260](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L260-L260), [515-520](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L515-L520) ):

```solidity
260:             _lastCommittedBatchData = _commitOneBatch(_lastCommittedBatchData, _newBatchesData[i], bytes32(0));

515:             abi.encodePacked(
516:                 _batch.indexRepeatedStorageChanges,
517:                 _batch.newStateRoot,
518:                 uint64(0), // index repeated storage changes in zkPorter
519:                 bytes32(0) // zkPorter batch hash
520:             );
```

- *SystemContractsCaller.sol* ( [48-59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L48-L59) ):

```solidity
48:         uint256 farCallAbi = getFarCallABI(
49:             0,
50:             0,
51:             dataStart,
52:             dataLength,
53:             gasLimit,
54:             // Only rollup is supported for now
55:             0,
56:             CalldataForwardingMode.UseHeap,
57:             false,
58:             true
59:         );
```

- *L2SharedBridge.sol* ( [167-175](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L167-L175) ):

```solidity
167:         (bool success, bytes memory returndata) = SystemContractsCaller.systemCallWithReturndata(
168:             uint32(gasleft()),
169:             DEPLOYER_SYSTEM_CONTRACT,
170:             0,
171:             abi.encodeCall(
172:                 IContractDeployer.create2,
173:                 (salt, l2TokenProxyBytecodeHash, abi.encode(address(l2TokenBeacon), ""))
174:             )
175:         );
```

- *BootloaderUtilities.sol* ( [176-176](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L176-L176), [271-271](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L271-L271) ):

```solidity
176:         bytes memory encodedAccessListLength = RLPEncoder.encodeListLen(0);

271:         bytes memory encodedAccessListLength = RLPEncoder.encodeListLen(0);
```

- *Compressor.sol* ( [121-121](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L121-L121), [202-202](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L202-L202) ):

```solidity
121:         uint256 numberOfInitialWrites = uint256(_compressedStateDiffs.readUint16(0));

202:             uint256 dictionaryLen = uint256(_rawCompressedData.readUint16(0));
```

- *DefaultAccount.sol* ( [83-88](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L83-L88) ):

```solidity
83:         SystemContractsCaller.systemCallWithPropagatedRevert(
84:             uint32(gasleft()),
85:             address(NONCE_HOLDER_SYSTEM_CONTRACT),
86:             0,
87:             abi.encodeCall(INonceHolder.incrementMinNonceIfEquals, (_transaction.nonce))
88:         );
```

- *L1Messenger.sol* ( [90-90](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L90-L90) ):

```solidity
90:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), 0);
```

- *MsgValueSimulator.sol* ( [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L26-L26) ):

```solidity
26:         value = SystemContractHelper.getExtraAbiData(0);
```

- *EfficientCall.sol* ( [265-272](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L265-L272) ):

```solidity
265:         uint256 farCallAbi = SystemContractsCaller.getFarCallABIWithEmptyFatPointer(
266:             gas,
267:             // Only rollup is supported for now
268:             0,
269:             CalldataForwardingMode.ForwardFatPointer,
270:             _isConstructor,
271:             _isSystem
272:         );
```

- *SystemContractHelper.sol* ( [345-349](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L345-L349) ):

```solidity
345:         bool precompileCallSuccess = unsafePrecompileCall(
346:             0, // The precompile parameters are formal ones. We only need the precompile call to burn gas.
347:             _gasToPay,
348:             _pubdataToSpend
349:         );
```

- *SystemContractsCaller.sol* ( [85-96](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L85-L96) ):

```solidity
85:         uint256 farCallAbi = SystemContractsCaller.getFarCallABI(
86:             0,
87:             0,
88:             dataStart,
89:             dataLength,
90:             gasLimit,
91:             // Only rollup is supported for now
92:             0,
93:             CalldataForwardingMode.UseHeap,
94:             false,
95:             true
96:         );
```

- *TransactionHelper.sol* ( [261-261](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L261-L261), [333-333](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L333-L333), [382-382](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L382-L382) ):

```solidity
261:         bytes memory encodedAccessListLength = RLPEncoder.encodeListLen(0);

333:         bytes memory encodedAccessListLength = RLPEncoder.encodeListLen(0);

382:                 IERC20(token).safeApprove(paymaster, 0);
```

</details>

### [L-27] Code does not follow the best practice of check-effects-interaction

Code should follow the best-practice of [check-effects-interaction](https://blockchain-academy.hs-mittweida.de/courses/solidity-coding-beginners-to-intermediate/lessons/solidity-11-coding-patterns/topic/checks-effects-interactions/), where state variables are updated before any external calls are made. Doing so prevents a large class of reentrancy bugs.

<details>
<summary>There are 30 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [147-155](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L147-L155), [156-156](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L156-L156) ):

```solidity
/// @audit `_depositFundsToSharedBridge()` is called on line 144, triggering an external call - `balanceOf()`
147:         l2TxHash = sharedBridge.depositLegacyErc20Bridge{value: msg.value}(
148:             msg.sender,
149:             _l2Receiver,
150:             _l1Token,
151:             _amount,
152:             _l2TxGasLimit,
153:             _l2TxGasPerPubdataByte,
154:             _refundRecipient
155:         );

/// @audit `_depositFundsToSharedBridge()` is called on line 144, triggering an external call - `balanceOf()`
156:         depositAmount[msg.sender][_l1Token][l2TxHash] = _amount;
```

- *L1SharedBridge.sol* ( [135-135](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L135-L135), [167-167](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L167-L167), [221-227](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L221-L227), [581-583](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L581-L583), [597-597](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L597-L597), [602-602](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L602-L602) ):

```solidity
/// @audit `balanceOf()` is called on line 129
135:             chainBalance[_targetChainId][_token] = chainBalance[_targetChainId][_token] + amount;

/// @audit `_depositFunds()` is called on line 162, triggering an external call - `balanceOf()`
167:             chainBalance[_chainId][_l1Token] += _amount;

/// @audit `_getDepositL2Calldata()` is called on line 219, triggering an external call - `staticcall()`
221:             request = L2TransactionRequestTwoBridgesInner({
222:                 magicValue: TWO_BRIDGES_MAGIC_VALUE,
223:                 l2Contract: l2BridgeAddress[_chainId],
224:                 l2Calldata: l2TxCalldata,
225:                 factoryDeps: new bytes[](0),
226:                 txDataHash: txDataHash
227:             });

/// @audit `_getDepositL2Calldata()` is called on line 573, triggering an external call - `staticcall()`
581:                 refundRecipient = _prevMsgSender != tx.origin
582:                     ? AddressAliasHelper.applyL1ToL2Alias(_prevMsgSender)
583:                     : _prevMsgSender;

/// @audit `_getDepositL2Calldata()` is called on line 573, triggering an external call - `staticcall()`
597:             l2TxHash = bridgehub.requestL2TransactionDirect{value: msg.value}(request);

/// @audit `_getDepositL2Calldata()` is called on line 573, triggering an external call - `staticcall()`
602:         depositHappened[ERA_CHAIN_ID][l2TxHash] = txDataHash;
```

- *Bridgehub.sol* ( [240-252](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L240-L252), [306-318](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L306-L318) ):

```solidity
/// @audit `getStateTransition()` is called on line 238, triggering an external call - `stateTransition()`
240:         canonicalTxHash = IZkSyncStateTransition(stateTransition).bridgehubRequestL2Transaction(
241:             BridgehubL2TransactionRequest({
242:                 sender: msg.sender,
243:                 contractL2: _request.l2Contract,
244:                 mintValue: _request.mintValue,
245:                 l2Value: _request.l2Value,
246:                 l2Calldata: _request.l2Calldata,
247:                 l2GasLimit: _request.l2GasLimit,
248:                 l2GasPerPubdataByteLimit: _request.l2GasPerPubdataByteLimit,
249:                 factoryDeps: _request.factoryDeps,
250:                 refundRecipient: refundRecipient
251:             })
252:         );

/// @audit `getStateTransition()` is called on line 288, triggering an external call - `stateTransition()`
306:         canonicalTxHash = IZkSyncStateTransition(stateTransition).bridgehubRequestL2Transaction(
307:             BridgehubL2TransactionRequest({
308:                 sender: _request.secondBridgeAddress,
309:                 contractL2: outputRequest.l2Contract,
310:                 mintValue: _request.mintValue,
311:                 l2Value: _request.l2Value,
312:                 l2Calldata: outputRequest.l2Calldata,
313:                 l2GasLimit: _request.l2GasLimit,
314:                 l2GasPerPubdataByteLimit: _request.l2GasPerPubdataByteLimit,
315:                 factoryDeps: outputRequest.factoryDeps,
316:                 refundRecipient: refundRecipient
317:             })
318:         );
```

- *Governance.sol* ( [181-181](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L181-L181), [200-200](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L200-L200) ):

```solidity
/// @audit `_execute()` is called on line 176, triggering an external call - `call()`
181:         timestamps[id] = EXECUTED_PROPOSAL_TIMESTAMP;

/// @audit `_execute()` is called on line 195, triggering an external call - `call()`
200:         timestamps[id] = EXECUTED_PROPOSAL_TIMESTAMP;
```

- *StateTransitionManager.sol* ( [284-284](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L284-L284) ):

```solidity
/// @audit `()` is called on line 279
284:         stateTransition[_chainId] = stateTransitionAddress;
```

- *Executor.sol* ( [68-68](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L68-L68), [69-73](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L69-L73), [665-665](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L665-L665), [680-680](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L680-L680) ):

```solidity
/// @audit `_verifyBlobInformation()` is called on line 60, triggering an external call - `staticcall()`
68:             blobHashes[0] = logOutput.blob1Hash;

/// @audit `_verifyBlobInformation()` is called on line 60, triggering an external call - `staticcall()`
69:             blobCommitments[0] = bytes32(
70:                 _newBatch.pubdataCommitments[_newBatch.pubdataCommitments.length - 32:_newBatch
71:                     .pubdataCommitments
72:                     .length]
73:             );

/// @audit `_getBlobVersionedHash()` is called on line 660, triggering an external call - `staticcall()`
665:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) {

/// @audit `staticcall()` is called on line 678
680:         versionedHash = abi.decode(data, (bytes32));
```

- *L2StandardERC20.sol* ( [78-78](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L78-L78), [80-80](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L80-L80), [84-84](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L84-L84), [86-86](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L86-L86), [97-97](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L97-L97), [99-99](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L99-L99), [102-102](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L102-L102), [126-126](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L126-L126) ):

```solidity
/// @audit `decodeString()` is called on line 77
78:             decodedName = nameString;

/// @audit `decodeString()` is called on line 77
80:             getters.ignoreName = true;

/// @audit `decodeString()` is called on line 77
84:             decodedSymbol = symbolString;

/// @audit `decodeString()` is called on line 77
86:             getters.ignoreSymbol = true;

/// @audit `decodeString()` is called on line 77
97:             decimals_ = decimalsUint8;

/// @audit `decodeString()` is called on line 77
99:             getters.ignoreDecimals = true;

/// @audit `decodeString()` is called on line 77
102:         availableGetters = getters;

/// @audit `owner()` is called on line 122
126:         availableGetters = _availableGetters;
```

- *L1Messenger.sol* ( [329-329](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L329-L329), [330-330](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L330-L330), [331-331](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L331-L331), [332-332](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L332-L332) ):

```solidity
/// @audit `verifyCompressedStateDiffs()` is called on line 307
329:         chainedLogsHash = bytes32(0);

/// @audit `verifyCompressedStateDiffs()` is called on line 307
330:         numberOfLogsToProcess = 0;

/// @audit `verifyCompressedStateDiffs()` is called on line 307
331:         chainedMessagesHash = bytes32(0);

/// @audit `verifyCompressedStateDiffs()` is called on line 307
332:         chainedL1BytecodesRevealDataHash = bytes32(0);
```

- *MsgValueSimulator.sol* ( [75-75](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L75-L75) ):

```solidity
/// @audit `call()` is called on line 63
75:             userGas += GAS_TO_PASS;
```

</details>

## Non Critical Issues

### [N-01] `abi.encodePacked()` should be replaced with `bytes.concat()`

Solidity version 0.8.4 introduces `bytes.concat()`, which can be used to replace `abi.encodePacked()` on bytes/strings. It can make the intended operation clearer, leading to less reviewer confusion.

There are 4 instances:

- *Executor.sol* ( [459-464](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L459-L464), [608-608](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L608-L608), [653-653](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L653-L653) ):

```solidity
459:                     abi.encodePacked(
460:                         _prevBatchCommitment,
461:                         _currentBatchCommitment,
462:                         _verifierParams.recursionNodeLevelVkHash,
463:                         _verifierParams.recursionLeafLevelVkHash
464:                     )

608:         bytes memory precompileInput = abi.encodePacked(_versionedHash, _openingPoint, _openingValueCommitmentProof);

653:                 abi.encodePacked(blobVersionedHash, _pubdataCommitments[i:i + PUBDATA_COMMITMENT_COMMITMENT_OFFSET])
```

- *TransactionHelper.sol* ( [142-142](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L142-L142) ):

```solidity
142:         return keccak256(abi.encodePacked("\x19\x01", domainSeparator, structHash));
```

### [N-02] Import declarations should import specific identifiers, rather than the whole file

Using import declarations of the form `import {<identifier_name>} from "some/file.sol"` avoids polluting the symbol namespace making flattened files smaller, and speeds up compilation (but does not save any gas).

<details>
<summary>There are 41 instances (click to show):</summary>

- *IL1ERC20Bridge.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L7) ):

```solidity
7: import "./IL1SharedBridge.sol";
```

- *Bridgehub.sol* ( [9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L9), [10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L10), [11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L11), [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L12), [13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L13), [16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16) ):

```solidity
9: import "./IBridgehub.sol";

10: import "../bridge/interfaces/IL1SharedBridge.sol";

11: import "../state-transition/IStateTransitionManager.sol";

12: import "../common/ReentrancyGuard.sol";

13: import "../state-transition/chain-interfaces/IZkSyncStateTransition.sol";

16: import "../vendor/AddressAliasHelper.sol";
```

- *IBridgehub.sol* ( [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L8), [9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L9), [10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L10) ):

```solidity
8: import "../common/Messaging.sol";

9: import "../state-transition/IStateTransitionManager.sol";

10: import "../state-transition/libraries/Diamond.sol";
```

- *DiamondInit.sol* ( [14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L14) ):

```solidity
14: import "../l2-deps/ISystemContext.sol";
```

- *IZkSyncStateTransition.sol* ( [15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L15) ):

```solidity
15: import "../libraries/Diamond.sol";
```

- *BaseZkSyncUpgradeGenesis.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L7), [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L8), [9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L9), [10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L10), [11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L11), [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L12) ):

```solidity
7: import "../state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol";

8: import "../state-transition/chain-interfaces/IMailbox.sol";

9: import "../state-transition/chain-interfaces/IVerifier.sol";

10: import "../common/libraries/L2ContractHelper.sol";

11: import "../common/Messaging.sol";

12: import "../state-transition/libraries/TransactionValidator.sol";
```

- *GenesisUpgrade.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L7), [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L8), [9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L9) ):

```solidity
7: import "../state-transition/libraries/Diamond.sol";

8: import "./BaseZkSyncUpgradeGenesis.sol";

9: import "./IDefaultUpgrade.sol";
```

- *IPaymaster.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L7) ):

```solidity
7: import "../L2ContractHelper.sol";
```

- *AccountCodeStorage.sol* ( [5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L5), [6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L6) ):

```solidity
5: import "./interfaces/IAccountCodeStorage.sol";

6: import "./libraries/Utils.sol";
```

- *DefaultAccount.sol* ( [5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L5), [6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L6), [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L7), [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L8) ):

```solidity
5: import "./interfaces/IAccount.sol";

6: import "./libraries/TransactionHelper.sol";

7: import "./libraries/SystemContractHelper.sol";

8: import "./libraries/EfficientCall.sol";
```

- *IAccount.sol* ( [5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IAccount.sol#L5) ):

```solidity
5: import "../libraries/TransactionHelper.sol";
```

- *IBootloaderUtilities.sol* ( [5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBootloaderUtilities.sol#L5) ):

```solidity
5: import "../libraries/TransactionHelper.sol";
```

- *IPaymaster.sol* ( [5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L5) ):

```solidity
5: import "../libraries/TransactionHelper.sol";
```

- *EfficientCall.sol* ( [5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L5), [6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L6) ):

```solidity
5: import "./SystemContractHelper.sol";

6: import "./Utils.sol";
```

- *SystemContractsCaller.sol* ( [6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L6) ):

```solidity
6: import "./Utils.sol";
```

- *TransactionHelper.sol* ( [5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L5), [6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L6), [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L8), [9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L9), [11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L11), [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L12) ):

```solidity
5: import "../openzeppelin/token/ERC20/IERC20.sol";

6: import "../openzeppelin/token/ERC20/utils/SafeERC20.sol";

8: import "../interfaces/IPaymasterFlow.sol";

9: import "../interfaces/IContractDeployer.sol";

11: import "./RLPEncoder.sol";

12: import "./EfficientCall.sol";
```

- *Utils.sol* ( [4](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L4) ):

```solidity
4: import "./EfficientCall.sol";
```

</details>

### [N-03] Event should include parameters

It is beneficial for events to include parameters. Including parameters in events allows you to provide additional information and context when emitting the event. This can be valuable for logging important state changes, or recording related accounts, or capturing relevant data.

There are 2 instances:

- *IAdmin.sol* ( [96-96](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L96-L96), [99-99](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L99-L99) ):

```solidity
96:     event Freeze();

99:     event Unfreeze();
```

### [N-04] Visibility of state variables is not explicitly defined

To avoid misunderstandings and unexpected state accesses, it is recommended to explicitly define the visibility of each state variable.

<details>
<summary>There are 9 instances (click to show):</summary>

- *AddressAliasHelper.sol* ( [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L24-L24) ):

```solidity
24:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
```

- *AddressAliasHelper.sol* ( [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L24-L24) ):

```solidity
24:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
```

- *AccountCodeStorage.sol* ( [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L23-L23) ):

```solidity
23:     bytes32 constant EMPTY_STRING_KECCAK = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470;
```

- *MsgValueSimulator.sol* ( [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L36-L36), [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L41-L41) ):

```solidity
36:     uint256 constant GAS_TO_PASS = 2300;

41:     uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000;
```

- *TransactionHelper.sol* ( [82-82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L82-L82), [84-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L84-L87) ):

```solidity
82:     bytes32 constant EIP712_DOMAIN_TYPEHASH = keccak256("EIP712Domain(string name,string version,uint256 chainId)");

84:     bytes32 constant EIP712_TRANSACTION_TYPE_HASH =
85:         keccak256(
86:             "Transaction(uint256 txType,uint256 from,uint256 to,uint256 gasLimit,uint256 gasPerPubdataByteLimit,uint256 maxFeePerGas,uint256 maxPriorityFeePerGas,uint256 paymaster,uint256 nonce,uint256 value,bytes data,bytes32[] factoryDeps,bytes paymasterInput)"
87:         );
```

- *Utils.sol* ( [13-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L13-L14), [17-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L17-L18) ):

```solidity
13:     bytes32 constant IS_CONSTRUCTOR_BYTECODE_HASH_BIT_MASK =
14:         0x00ff000000000000000000000000000000000000000000000000000000000000;

17:     bytes32 constant SET_IS_CONSTRUCTOR_MARKER_BIT_MASK =
18:         0x0001000000000000000000000000000000000000000000000000000000000000;
```

</details>

### [N-05] There is no need to initialize variables with 0

Since the variables are automatically set to 0 when created, it is redundant to initialize it with 0 again.

<details>
<summary>There are 41 instances (click to show):</summary>

- *Config.sol* ( [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L24-L24), [39-39](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L39-L39) ):

```solidity
24: bytes32 constant DEFAULT_L2_LOGS_TREE_ROOT_HASH = bytes32(0);

39: uint256 constant PRIORITY_EXPIRATION = 0 days;
```

- *Governance.sol* ( [227-227](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L227-L227) ):

```solidity
227:         for (uint256 i = 0; i < _calls.length; ++i) {
```

- *ValidatorTimelock.sol* ( [118-118](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L118-L118), [137-137](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L137-L137), [187-187](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L187-L187), [211-211](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L211-L211) ):

```solidity
118:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {

137:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {

187:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {

211:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {
```

- *Executor.sol* ( [144-144](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L144-L144), [259-259](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L259-L259), [291-291](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L291-L291), [313-313](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L313-L313), [353-353](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L353-L353), [407-407](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L407-L407), [578-578](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L578-L578), [627-627](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L627-L627), [634-634](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L634-L634), [665-665](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L665-L665) ):

```solidity
144:         for (uint256 i = 0; i < emittedL2Logs.length; i = i.uncheckedAdd(L2_TO_L1_LOG_SERIALIZE_SIZE)) {

259:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) {

291:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) {

313:         for (uint256 i = 0; i < _nPriorityOps; i = i.uncheckedInc()) {

353:         for (uint256 i = 0; i < nBatches; i = i.uncheckedInc()) {

407:         for (uint256 i = 0; i < committedBatchesLength; i = i.uncheckedInc()) {

578:         for (uint i = 0; i < MAX_NUMBER_OF_BLOBS; i++) {

627:         uint256 versionedHashIndex = 0;

634:         for (uint256 i = 0; i < _pubdataCommitments.length; i += PUBDATA_COMMITMENT_SIZE) {

665:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) {
```

- *Getters.sol* ( [210-210](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L210-L210) ):

```solidity
210:         for (uint256 i = 0; i < facetsLen; i = i.uncheckedInc()) {
```

- *Mailbox.sol* ( [358-358](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L358-L358) ):

```solidity
358:         for (uint256 i = 0; i < factoryDepsLen; i = i.uncheckedInc()) {
```

- *Diamond.sol* ( [103-103](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L103-L103), [140-140](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L140-L140), [160-160](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L160-L160), [180-180](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L180-L180) ):

```solidity
103:         for (uint256 i = 0; i < facetCutsLength; i = i.uncheckedInc()) {

140:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) {

160:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) {

180:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) {
```

- *TransactionValidator.sol* ( [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L94-L94) ):

```solidity
94:         uint256 costForPubdata = 0;
```

- *BaseZkSyncUpgrade.sol* ( [228-228](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L228-L228) ):

```solidity
228:         for (uint256 i = 0; i < _factoryDeps.length; ++i) {
```

- *Compressor.sol* ( [61-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L61-L61), [124-124](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L124-L124), [127-127](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L127-L127), [159-159](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L159-L159) ):

```solidity
61:             for (uint256 encodedDataPointer = 0; encodedDataPointer < encodedData.length; encodedDataPointer += 2) {

124:         uint256 numInitialWritesProcessed = 0;

127:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) {

159:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) {
```

- *ContractDeployer.sol* ( [247-247](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L247-L247), [248-248](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L248-L248), [253-253](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L253-L253) ):

```solidity
247:         uint256 sumOfValues = 0;

248:         for (uint256 i = 0; i < deploymentsLength; ++i) {

253:         for (uint256 i = 0; i < deploymentsLength; ++i) {
```

- *ImmutableSimulator.sol* ( [38-38](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L38-L38) ):

```solidity
38:             for (uint256 i = 0; i < immutablesLength; ++i) {
```

- *KnownCodesStorage.sol* ( [30-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L30-L30) ):

```solidity
30:             for (uint256 i = 0; i < hashesLen; ++i) {
```

- *L1Messenger.sol* ( [197-197](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L197-L197), [206-206](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L206-L206), [224-224](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L224-L224), [236-236](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L236-L236), [254-254](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L254-L254) ):

```solidity
197:         uint256 calldataPtr = 0;

206:         for (uint256 i = 0; i < numberOfL2ToL1Logs; ++i) {

224:             for (uint256 i = 0; i < nodesOnCurrentLevel; ++i) {

236:         for (uint256 i = 0; i < numberOfMessages; ++i) {

254:         for (uint256 i = 0; i < numberOfBytecodes; ++i) {
```

- *PubdataChunkPublisher.sol* ( [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L36-L36) ):

```solidity
36:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) {
```

- *TransactionHelper.sol* ( [18-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L18-L18) ):

```solidity
18: uint8 constant LEGACY_TX_TYPE = 0x0;
```

</details>

### [N-06] Names of constants should use the UPPER_CASE_WITH_UNDERSCORES style

It is recommended by the [Solidity Style Guide](https://docs.soliditylang.org/en/latest/style-guide.html)

<details>
<summary>There are 7 instances (click to show):</summary>

- *ValidatorTimelock.sol* ( [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L28-L28) ):

```solidity
28:     string public constant override getName = "ValidatorTimelock";
```

- *Admin.sol* ( [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L22-L22) ):

```solidity
22:     string public constant override getName = "AdminFacet";
```

- *Executor.sol* ( [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L29-L29) ):

```solidity
29:     string public constant override getName = "ExecutorFacet";
```

- *Getters.sol* ( [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L27-L27) ):

```solidity
27:     string public constant override getName = "GettersFacet";
```

- *Mailbox.sol* ( [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L37-L37) ):

```solidity
37:     string public constant override getName = "MailboxFacet";
```

- *AddressAliasHelper.sol* ( [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L24-L24) ):

```solidity
24:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
```

- *AddressAliasHelper.sol* ( [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L24-L24) ):

```solidity
24:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
```

</details>

### [N-07] Names of `private`/`internal` functions should be prefixed with an underscore

It is recommended by the [Solidity Style Guide](https://docs.soliditylang.org/en/v0.8.20/style-guide.html#underscore-prefix-for-non-external-functions-and-variables).

<details>
<summary>There are 109 instances (click to show):</summary>

- *L2ContractHelper.sol* ( [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L23-L23), [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L41-L41), [51-51](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L51-L51), [62-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L62-L67) ):

```solidity
23:     function hashL2Bytecode(bytes memory _bytecode) internal pure returns (bytes32 hashedBytecode) {

41:     function validateBytecodeHash(bytes32 _bytecodeHash) internal pure {

51:     function bytecodeLen(bytes32 _bytecodeHash) internal pure returns (uint256 codeLengthInWords) {

62:     function computeCreate2Address(
63:         address _sender,
64:         bytes32 _salt,
65:         bytes32 _bytecodeHash,
66:         bytes32 _constructorInputHash
67:     ) internal pure returns (address) {
```

- *UncheckedMath.sol* ( [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L13-L13), [19-19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L19-L19) ):

```solidity
13:     function uncheckedInc(uint256 _number) internal pure returns (uint256) {

19:     function uncheckedAdd(uint256 _lhs, uint256 _rhs) internal pure returns (uint256) {
```

- *UnsafeBytes.sol* ( [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L21-L21), [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L28-L28), [35-35](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L35-L35), [42-42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L42-L42) ):

```solidity
21:     function readUint32(bytes memory _bytes, uint256 _start) internal pure returns (uint32 result, uint256 offset) {

28:     function readAddress(bytes memory _bytes, uint256 _start) internal pure returns (address result, uint256 offset) {

35:     function readUint256(bytes memory _bytes, uint256 _start) internal pure returns (uint256 result, uint256 offset) {

42:     function readBytes32(bytes memory _bytes, uint256 _start) internal pure returns (bytes32 result, uint256 offset) {
```

- *Diamond.sol* ( [89-89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L89-L89), [98-98](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L98-L98) ):

```solidity
89:     function getDiamondStorage() internal pure returns (DiamondStorage storage diamondStorage) {

98:     function diamondCut(DiamondCutData memory _diamondCut) internal {
```

- *LibMap.sol* ( [20-20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L20-L20), [40-40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L40-L40) ):

```solidity
20:     function get(Uint32Map storage _map, uint256 _index) internal view returns (uint32 result) {

40:     function set(Uint32Map storage _map, uint256 _index, uint32 _value) internal {
```

- *Merkle.sol* ( [20-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L20-L24) ):

```solidity
20:     function calculateRoot(
21:         bytes32[] calldata _path,
22:         uint256 _index,
23:         bytes32 _itemHash
24:     ) internal pure returns (bytes32) {
```

- *PriorityQueue.sol* ( [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L37-L37), [42-42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L42-L42), [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L47-L47), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L52-L52), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L57-L57), [66-66](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L66-L66), [74-74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L74-L74) ):

```solidity
37:     function getFirstUnprocessedPriorityTx(Queue storage _queue) internal view returns (uint256) {

42:     function getTotalPriorityTxs(Queue storage _queue) internal view returns (uint256) {

47:     function getSize(Queue storage _queue) internal view returns (uint256) {

52:     function isEmpty(Queue storage _queue) internal view returns (bool) {

57:     function pushBack(Queue storage _queue, PriorityOperation memory _operation) internal {

66:     function front(Queue storage _queue) internal view returns (PriorityOperation memory) {

74:     function popFront(Queue storage _queue) internal returns (PriorityOperation memory priorityOperation) {
```

- *TransactionValidator.sol* ( [21-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L21-L26), [48-48](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L48-L48), [71-75](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L71-L75), [111-114](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L111-L114), [130-132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L130-L132) ):

```solidity
21:     function validateL1ToL2Transaction(
22:         L2CanonicalTransaction memory _transaction,
23:         bytes memory _encoded,
24:         uint256 _priorityTxMaxGasLimit,
25:         uint256 _priorityTxMaxPubdata
26:     ) internal pure {

48:     function validateUpgradeTransaction(L2CanonicalTransaction memory _transaction) internal pure {

71:     function getMinimalPriorityTransactionGasLimit(
72:         uint256 _encodingLength,
73:         uint256 _numberOfFactoryDependencies,
74:         uint256 _l2GasPricePerPubdata
75:     ) internal pure returns (uint256) {

111:     function getTransactionBodyGasLimit(
112:         uint256 _totalGasLimit,
113:         uint256 _encodingLength
114:     ) internal pure returns (uint256 txBodyGasLimit) {

130:     function getOverheadForTransaction(
131:         uint256 _encodingLength
132:     ) internal pure returns (uint256 batchOverheadForTransaction) {
```

- *AddressAliasHelper.sol* ( [30-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L30-L30), [40-40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L40-L40) ):

```solidity
30:     function applyL1ToL2Alias(address l1Address) internal pure returns (address l2Address) {

40:     function undoL1ToL2Alias(address l2Address) internal pure returns (address l1Address) {
```

- *L2ContractHelper.sol* ( [92-92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L92-L92), [103-108](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L103-L108) ):

```solidity
92:     function sendMessageToL1(bytes memory _message) internal returns (bytes32) {

103:     function computeCreate2Address(
104:         address _sender,
105:         bytes32 _salt,
106:         bytes32 _bytecodeHash,
107:         bytes32 _constructorInputHash
108:     ) internal pure returns (address) {
```

- *SystemContractsCaller.sol* ( [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L29-L29), [39-39](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L39-L39), [78-83](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L78-L83), [97-107](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L97-L107), [123-129](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L123-L129) ):

```solidity
29:     function safeCastToU32(uint256 _x) internal pure returns (uint32) {

39:     function systemCall(uint32 gasLimit, address to, uint256 value, bytes memory data) internal returns (bool success) {

78:     function systemCallWithReturndata(
79:         uint32 gasLimit,
80:         address to,
81:         uint128 value,
82:         bytes memory data
83:     ) internal returns (bool success, bytes memory returnData) {

97:     function getFarCallABI(
98:         uint32 dataOffset,
99:         uint32 memoryPage,
100:         uint32 dataStart,
101:         uint32 dataLength,
102:         uint32 gasPassed,
103:         uint8 shardId,
104:         CalldataForwardingMode forwardingMode,
105:         bool isConstructorCall,
106:         bool isSystemCall
107:     ) internal pure returns (uint256 farCallAbi) {

123:     function getFarCallABIWithEmptyFatPointer(
124:         uint32 gasPassed,
125:         uint8 shardId,
126:         CalldataForwardingMode forwardingMode,
127:         bool isConstructorCall,
128:         bool isSystemCall
129:     ) internal pure returns (uint256 farCallAbiWithEmptyFatPtr) {
```

- *AddressAliasHelper.sol* ( [30-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L30-L30), [40-40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L40-L40) ):

```solidity
30:     function applyL1ToL2Alias(address l1Address) internal pure returns (address l2Address) {

40:     function undoL1ToL2Alias(address l2Address) internal pure returns (address l1Address) {
```

- *BootloaderUtilities.sol* ( [44-44](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L44-L44), [139-139](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L139-L139), [229-229](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L229-L229) ):

```solidity
44:     function encodeLegacyTransactionHash(Transaction calldata _transaction) internal view returns (bytes32 txHash) {

139:     function encodeEIP2930TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) {

229:     function encodeEIP1559TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) {
```

- *L1Messenger.sol* ( [50-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L50-L50), [61-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L61-L61) ):

```solidity
50:     function keccakGasCost(uint256 _length) internal pure returns (uint256) {

61:     function sha256GasCost(uint256 _length) internal pure returns (uint256) {
```

- *EfficientCall.sol* ( [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L36-L36), [45-45](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L45-L45), [58-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L58-L64), [74-78](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L74-L78), [88-92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L88-L92), [105-112](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L105-L112), [124-130](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L124-L130), [159-159](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L159-L159), [173-173](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L173-L173), [191-198](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L191-L198), [232-232](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L232-L232) ):

```solidity
36:     function keccak(bytes calldata _data) internal view returns (bytes32) {

45:     function sha(bytes calldata _data) internal view returns (bytes32) {

58:     function call(
59:         uint256 _gas,
60:         address _address,
61:         uint256 _value,
62:         bytes calldata _data,
63:         bool _isSystem
64:     ) internal returns (bytes memory returnData) {

74:     function staticCall(
75:         uint256 _gas,
76:         address _address,
77:         bytes calldata _data
78:     ) internal view returns (bytes memory returnData) {

88:     function delegateCall(
89:         uint256 _gas,
90:         address _address,
91:         bytes calldata _data
92:     ) internal returns (bytes memory returnData) {

105:     function mimicCall(
106:         uint256 _gas,
107:         address _address,
108:         bytes calldata _data,
109:         address _whoToMimic,
110:         bool _isConstructor,
111:         bool _isSystem
112:     ) internal returns (bytes memory returnData) {

124:     function rawCall(
125:         uint256 _gas,
126:         address _address,
127:         uint256 _value,
128:         bytes calldata _data,
129:         bool _isSystem
130:     ) internal returns (bool success) {

159:     function rawStaticCall(uint256 _gas, address _address, bytes calldata _data) internal view returns (bool success) {

173:     function rawDelegateCall(uint256 _gas, address _address, bytes calldata _data) internal returns (bool success) {

191:     function rawMimicCall(
192:         uint256 _gas,
193:         address _address,
194:         bytes calldata _data,
195:         address _whoToMimic,
196:         bool _isConstructor,
197:         bool _isSystem
198:     ) internal returns (bool success) {

232:     function propagateRevert() internal pure {
```

- *RLPEncoder.sol* ( [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L11-L11), [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L24-L24), [49-49](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L49-L49), [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L56-L56) ):

```solidity
11:     function encodeAddress(address _val) internal pure returns (bytes memory encoded) {

24:     function encodeUint256(uint256 _val) internal pure returns (bytes memory encoded) {

49:     function encodeNonSingleBytesLen(uint64 _len) internal pure returns (bytes memory) {

56:     function encodeListLen(uint64 _len) internal pure returns (bytes memory) {
```

- *SystemContractHelper.sol* ( [48-48](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L48-L48), [63-63](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L63-L63), [74-74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L74-L74), [85-85](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L85-L85), [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L94-L94), [106-106](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L106-L106), [124-130](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L124-L130), [148-152](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L148-L152), [168-168](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L168-L168), [181-181](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L181-L181), [191-191](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L191-L191), [203-203](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L203-L203), [215-215](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L215-L215), [227-227](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L227-L227), [237-237](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L237-L237), [246-246](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L246-L246), [254-254](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L254-L254), [263-263](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L263-L263), [272-272](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L272-L272), [279-279](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L279-L279), [296-296](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L296-L296), [307-307](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L307-L307), [318-318](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L318-L318), [329-329](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L329-L329), [338-338](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L338-L338), [344-344](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L344-L344) ):

```solidity
48:     function toL1(bool _isService, bytes32 _key, bytes32 _value) internal {

63:     function getCodeAddress() internal view returns (address addr) {

74:     function loadCalldataIntoActivePtr() internal view {

85:     function ptrPackIntoActivePtr(uint256 _farCallAbi) internal view {

94:     function ptrAddIntoActive(uint32 _value) internal view {

106:     function ptrShrinkIntoActive(uint32 _shrink) internal view {

124:     function packPrecompileParams(
125:         uint32 _inputMemoryOffset,
126:         uint32 _inputMemoryLength,
127:         uint32 _outputMemoryOffset,
128:         uint32 _outputMemoryLength,
129:         uint64 _perPrecompileInterpreted
130:     ) internal pure returns (uint256 rawParams) {

148:     function unsafePrecompileCall(
149:         uint256 _rawParams,
150:         uint32 _gasToBurn,
151:         uint32 _pubdataToSpend
152:     ) internal view returns (bool success) {

168:     function setValueForNextFarCall(uint128 _value) internal returns (bool success) {

181:     function eventInitialize(uint256 initializer, uint256 value1) internal {

191:     function eventWrite(uint256 value1, uint256 value2) internal {

203:     function getZkSyncMetaBytes() internal view returns (uint256 meta) {

215:     function extractNumberFromMeta(uint256 meta, uint256 offset, uint256 size) internal pure returns (uint256 result) {

227:     function getPubdataPublishedFromMeta(uint256 meta) internal pure returns (uint32 pubdataPublished) {

237:     function getHeapSizeFromMeta(uint256 meta) internal pure returns (uint32 heapSize) {

246:     function getAuxHeapSizeFromMeta(uint256 meta) internal pure returns (uint32 auxHeapSize) {

254:     function getShardIdFromMeta(uint256 meta) internal pure returns (uint8 shardId) {

263:     function getCallerShardIdFromMeta(uint256 meta) internal pure returns (uint8 callerShardId) {

272:     function getCodeShardIdFromMeta(uint256 meta) internal pure returns (uint8 codeShardId) {

279:     function getZkSyncMeta() internal view returns (ZkSyncMeta memory meta) {

296:     function getCallFlags() internal view returns (uint256 callFlags) {

307:     function getCalldataPtr() internal view returns (uint256 ptr) {

318:     function getExtraAbiData(uint256 index) internal view returns (uint256 extraAbiData) {

329:     function isSystemCall() internal view returns (bool) {

338:     function isSystemContract(address _address) internal pure returns (bool) {

344:     function burnGas(uint32 _gasToPay, uint32 _pubdataToSpend) internal view {
```

- *SystemContractsCaller.sol* ( [76-76](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L76-L76), [123-128](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L123-L128), [150-155](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L150-L155), [214-224](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L214-L224), [250-256](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L250-L256) ):

```solidity
76:     function systemCall(uint32 gasLimit, address to, uint256 value, bytes memory data) internal returns (bool success) {

123:     function systemCallWithReturndata(
124:         uint32 gasLimit,
125:         address to,
126:         uint128 value,
127:         bytes memory data
128:     ) internal returns (bool success, bytes memory returnData) {

150:     function systemCallWithPropagatedRevert(
151:         uint32 gasLimit,
152:         address to,
153:         uint128 value,
154:         bytes memory data
155:     ) internal returns (bytes memory returnData) {

214:     function getFarCallABI(
215:         uint32 dataOffset,
216:         uint32 memoryPage,
217:         uint32 dataStart,
218:         uint32 dataLength,
219:         uint32 gasPassed,
220:         uint8 shardId,
221:         CalldataForwardingMode forwardingMode,
222:         bool isConstructorCall,
223:         bool isSystemCall
224:     ) internal pure returns (uint256 farCallAbi) {

250:     function getFarCallABIWithEmptyFatPointer(
251:         uint32 gasPassed,
252:         uint8 shardId,
253:         CalldataForwardingMode forwardingMode,
254:         bool isConstructorCall,
255:         bool isSystemCall
256:     ) internal pure returns (uint256 farCallAbiWithEmptyFatPtr) {
```

- *TransactionHelper.sol* ( [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L94-L94), [100-100](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L100-L100), [362-362](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L362-L362), [395-395](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L395-L395), [405-405](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L405-L405) ):

```solidity
94:     function isEthToken(uint256 _addr) internal pure returns (bool) {

100:     function encodeHash(Transaction calldata _transaction) internal view returns (bytes32 resultHash) {

362:     function processPaymasterInput(Transaction calldata _transaction) internal {

395:     function payToTheBootloader(Transaction calldata _transaction) internal returns (bool success) {

405:     function totalRequiredBalance(Transaction calldata _transaction) internal pure returns (uint256 requiredBalance) {
```

- *UnsafeBytesCalldata.sol* ( [19-19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L19-L19), [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L26-L26), [33-33](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L33-L33), [40-40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L40-L40), [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L46-L46) ):

```solidity
19:     function readUint16(bytes calldata _bytes, uint256 _start) internal pure returns (uint16 result) {

26:     function readUint32(bytes calldata _bytes, uint256 _start) internal pure returns (uint32 result) {

33:     function readUint64(bytes calldata _bytes, uint256 _start) internal pure returns (uint64 result) {

40:     function readBytes32(bytes calldata _bytes, uint256 _start) internal pure returns (bytes32 result) {

46:     function readUint256(bytes calldata _bytes, uint256 _start) internal pure returns (uint256 result) {
```

- *Utils.sol* ( [20-20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L20-L20), [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L26-L26), [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L32-L32), [39-39](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L39-L39), [44-44](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L44-L44), [51-51](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L51-L51), [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L56-L56), [63-63](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L63-L63), [71-71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L71-L71), [82-82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L82-L82) ):

```solidity
20:     function safeCastToU128(uint256 _x) internal pure returns (uint128) {

26:     function safeCastToU32(uint256 _x) internal pure returns (uint32) {

32:     function safeCastToU24(uint256 _x) internal pure returns (uint24) {

39:     function bytecodeLenInBytes(bytes32 _bytecodeHash) internal pure returns (uint256 codeLength) {

44:     function bytecodeLenInWords(bytes32 _bytecodeHash) internal pure returns (uint256 codeLengthInWords) {

51:     function isContractConstructed(bytes32 _bytecodeHash) internal pure returns (bool) {

56:     function isContractConstructing(bytes32 _bytecodeHash) internal pure returns (bool) {

63:     function constructingBytecodeHash(bytes32 _bytecodeHash) internal pure returns (bytes32) {

71:     function constructedBytecodeHash(bytes32 _bytecodeHash) internal pure returns (bytes32) {

82:     function hashL2Bytecode(bytes calldata _bytecode) internal view returns (bytes32 hashedBytecode) {
```

</details>

### [N-08] Names of `private`/`internal` state variables should be prefixed with an underscore

It is recommended by the [Solidity Style Guide](https://docs.soliditylang.org/en/v0.8.20/style-guide.html#underscore-prefix-for-non-external-functions-and-variables).

<details>
<summary>There are 40 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L47-L47), [63-63](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L63-L63), [67-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L67-L67) ):

```solidity
47:     uint256 internal eraFirstPostUpgradeBatch;

63:     mapping(uint256 chainId => bool enabled) internal hyperbridgingEnabled;

67:     mapping(uint256 chainId => mapping(address l1Token => uint256 balance)) internal chainBalance;
```

- *Bridgehub.sol* ( [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L37-L37) ):

```solidity
37:     address private pendingAdmin;
```

- *ReentrancyGuard.sol* ( [31-31](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L31-L31) ):

```solidity
31:     uint256 private constant LOCK_FLAG_ADDRESS = 0x8e94fed44239eb2314ab7a406345e6c5a8f0ccedf3b600de3d004e672c33abf4;
```

- *Governance.sol* ( [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L24-L24) ):

```solidity
24:     uint256 internal constant EXECUTED_PROPOSAL_TIMESTAMP = uint256(1);
```

- *StateTransitionManager.sol* ( [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L56-L56) ):

```solidity
56:     address private pendingAdmin;
```

- *ValidatorTimelock.sol* ( [49-49](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L49-L49) ):

```solidity
49:     mapping(uint256 => LibMap.Uint32Map) internal committedBatchTimestamp;
```

- *ZkSyncStateTransitionBase.sol* ( [14-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L14-L14) ):

```solidity
14:     ZkSyncStateTransitionStorage internal s;
```

- *L2SharedBridge.sol* ( [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L34-L34), [39-39](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L39-L39) ):

```solidity
34:     bytes32 internal l2TokenProxyBytecodeHash;

39:     address private l1LegacyBridge;
```

- *L2StandardERC20.sol* ( [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L28-L28), [33-33](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L33-L33) ):

```solidity
28:     ERC20Getters private availableGetters;

33:     uint8 private decimals_;
```

- *AccountCodeStorage.sol* ( [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L23-L23) ):

```solidity
23:     bytes32 constant EMPTY_STRING_KECCAK = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470;
```

- *ContractDeployer.sol* ( [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L26-L26) ):

```solidity
26:     mapping(address => AccountInfo) internal accountInfo;
```

- *ImmutableSimulator.sol* ( [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L21-L21) ):

```solidity
21:     mapping(uint256 contractAddress => mapping(uint256 index => bytes32 value)) internal immutableDataStorage;
```

- *L1Messenger.sol* ( [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L28-L28), [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L32-L32), [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L36-L36), [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L41-L41), [44-44](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L44-L44), [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L47-L47), [55-55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L55-L55), [58-58](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L58-L58) ):

```solidity
28:     bytes32 internal chainedLogsHash;

32:     uint256 internal numberOfLogsToProcess;

36:     bytes32 internal chainedMessagesHash;

41:     bytes32 internal chainedL1BytecodesRevealDataHash;

44:     uint256 internal constant KECCAK_ROUND_GAS_COST = 40;

47:     uint256 internal constant KECCAK_ROUND_NUMBER_OF_BYTES = 136;

55:     uint256 internal constant SHA256_ROUND_GAS_COST = 7;

58:     uint256 internal constant SHA256_ROUND_NUMBER_OF_BYTES = 64;
```

- *L2BaseToken.sol* ( [20-20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L20-L20) ):

```solidity
20:     mapping(address account => uint256 balance) internal balance;
```

- *MsgValueSimulator.sol* ( [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L36-L36), [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L41-L41) ):

```solidity
36:     uint256 constant GAS_TO_PASS = 2300;

41:     uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000;
```

- *NonceHolder.sol* ( [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L28-L28), [31-31](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L31-L31), [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L36-L36), [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L41-L41) ):

```solidity
28:     uint256 private constant DEPLOY_NONCE_MULTIPLIER = 2 ** 128;

31:     uint256 private constant MAXIMAL_MIN_NONCE_INCREMENT = 2 ** 32;

36:     mapping(uint256 account => uint256 packedMinAndDeploymentNonce) internal rawNonces;

41:     mapping(uint256 account => mapping(uint256 nonceKey => uint256 value)) internal nonceValues;
```

- *SystemContext.sol* ( [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L23-L23), [51-51](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L51-L51), [55-55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L55-L55), [58-58](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L58-L58), [61-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L61-L61), [70-70](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L70-L70), [77-77](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L77-L77), [80-80](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L80-L80), [95-95](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L95-L95) ):

```solidity
23:     uint256 internal constant MINIBLOCK_HASHES_TO_STORE = 257;

51:     BlockInfo internal currentBatchInfo;

55:     mapping(uint256 batchNumber => bytes32 batchHash) internal batchHashes;

58:     BlockInfo internal currentL2BlockInfo;

61:     bytes32 internal currentL2BlockTxsRollingHash;

70:     bytes32[MINIBLOCK_HASHES_TO_STORE] internal l2BlockHash;

77:     BlockInfo internal currentVirtualL2BlockInfo;

80:     VirtualBlockUpgradeInfo internal virtualBlockUpgradeInfo;

95:     uint256 internal basePubdataSpent;
```

</details>

### [N-09] Order of functions does not follow the Solidity Style Guide

According to the [Solidity Style Guide](https://docs.soliditylang.org/en/v0.8.20/style-guide.html#order-of-functions), functions should be grouped according to their visibility and ordered: `constructor`, `receive`, `fallback`, `external`, `public`, `internal`, `private`. Within a grouping, place the view and pure functions last.

<details>
<summary>There are 158 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [77-77](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L77-L77), [100-106](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L100-L106), [162-162](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L162-L162), [178-186](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L178-L186), [210-216](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L210-L216) ):

```solidity
/// @audit ↓↓ Out of order with `deposit()`
77:     function l2TokenAddress(address _l1Token) external view returns (address) {

/// @audit ↑↑ Out of order with `l2TokenAddress()`
100:     function deposit(
101:         address _l2Receiver,
102:         address _l1Token,
103:         uint256 _amount,
104:         uint256 _l2TxGasLimit,
105:         uint256 _l2TxGasPerPubdataByte
106:     ) external payable returns (bytes32 l2TxHash) {

/// @audit ↓↓ Out of order with `claimFailedDeposit()`
162:     function _depositFundsToSharedBridge(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) {

/// @audit ↑↑ Out of order with `_depositFundsToSharedBridge()`
178:     function claimFailedDeposit(
179:         address _depositSender,
180:         address _l1Token,
181:         bytes32 _l2TxHash,
182:         uint256 _l2BatchNumber,
183:         uint256 _l2MessageIndex,
184:         uint16 _l2TxNumberInBatch,
185:         bytes32[] calldata _merkleProof
186:     ) external nonReentrant {

/// @audit ↑↑ Out of order with `claimFailedDeposit()`
210:     function finalizeWithdrawal(
211:         uint256 _l2BatchNumber,
212:         uint256 _l2MessageIndex,
213:         uint16 _l2TxNumberInBatch,
214:         bytes calldata _message,
215:         bytes32[] calldata _merkleProof
216:     ) external nonReentrant {
```

- *L1SharedBridge.sol* ( [175-175](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L175-L175), [184-189](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L184-L189), [256-256](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L256-L256), [279-289](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L279-L289), [376-376](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L376-L376), [387-394](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L387-L394), [489-492](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L489-L492), [556-564](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L556-L564), [617-623](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L617-L623), [646-655](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L646-L655) ):

```solidity
/// @audit ↓↓ Out of order with `bridgehubDeposit()`
175:     function _depositFunds(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) {

/// @audit ↑↑ Out of order with `_depositFunds()`
184:     function bridgehubDeposit(
185:         uint256 _chainId,
186:         address _prevMsgSender,
187:         uint256, // l2Value, needed for Weth deposits in the future
188:         bytes calldata _data
189:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) {

/// @audit ↓↓ Out of order with `claimFailedDeposit()`
256:     function _getERC20Getters(address _token) internal view returns (bytes memory) {

/// @audit ↑↑ Out of order with `_getERC20Getters()`
279:     function claimFailedDeposit(
280:         uint256 _chainId,
281:         address _depositSender,
282:         address _l1Token,
283:         uint256 _amount,
284:         bytes32 _l2TxHash,
285:         uint256 _l2BatchNumber,
286:         uint256 _l2MessageIndex,
287:         uint16 _l2TxNumberInBatch,
288:         bytes32[] calldata _merkleProof
289:     ) external override {

/// @audit ↓↓ Out of order with `finalizeWithdrawal()`
376:     function _isEraLegacyWithdrawal(uint256 _chainId, uint256 _l2BatchNumber) internal view returns (bool) {

/// @audit ↑↑ Out of order with `_isEraLegacyWithdrawal()`
387:     function finalizeWithdrawal(
388:         uint256 _chainId,
389:         uint256 _l2BatchNumber,
390:         uint256 _l2MessageIndex,
391:         uint16 _l2TxNumberInBatch,
392:         bytes calldata _message,
393:         bytes32[] calldata _merkleProof
394:     ) external override {

/// @audit ↓↓ Out of order with `depositLegacyErc20Bridge()`
489:     function _parseL2WithdrawalMessage(
490:         uint256 _chainId,
491:         bytes memory _l2ToL1message
492:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {

/// @audit ↑↑ Out of order with `_parseL2WithdrawalMessage()`
556:     function depositLegacyErc20Bridge(
557:         address _prevMsgSender,
558:         address _l2Receiver,
559:         address _l1Token,
560:         uint256 _amount,
561:         uint256 _l2TxGasLimit,
562:         uint256 _l2TxGasPerPubdataByte,
563:         address _refundRecipient
564:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) {

/// @audit ↑↑ Out of order with `depositLegacyErc20Bridge()`
617:     function finalizeWithdrawalLegacyErc20Bridge(
618:         uint256 _l2BatchNumber,
619:         uint256 _l2MessageIndex,
620:         uint16 _l2TxNumberInBatch,
621:         bytes calldata _message,
622:         bytes32[] calldata _merkleProof
623:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount) {

/// @audit ↑↑ Out of order with `finalizeWithdrawalLegacyErc20Bridge()`
646:     function claimFailedDepositLegacyErc20Bridge(
647:         address _depositSender,
648:         address _l1Token,
649:         uint256 _amount,
650:         bytes32 _l2TxHash,
651:         uint256 _l2BatchNumber,
652:         uint256 _l2MessageIndex,
653:         uint16 _l2TxNumberInBatch,
654:         bytes32[] calldata _merkleProof
655:     ) external override onlyLegacyBridge {
```

- *IL1ERC20Bridge.sol* ( [69-69](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L69-L69), [71-75](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L71-L75), [77-77](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L77-L77) ):

```solidity
/// @audit ↓↓ Out of order with `depositAmount()`
69:     function l2Bridge() external view returns (address);

/// @audit ↑↑ Out of order with `l2Bridge()`
71:     function depositAmount(
72:         address _account,
73:         address _l1Token,
74:         bytes32 _depositL2TxHash
75:     ) external returns (uint256 amount);

/// @audit ↑↑ Out of order with `depositAmount()`
77:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external;
```

- *IL1SharedBridge.sol* ( [124-124](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L124-L124), [130-135](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L130-L135), [137-142](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L137-L142), [144-144](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L144-L144), [146-146](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L146-L146) ):

```solidity
/// @audit ↓↓ Out of order with `bridgehubDeposit()`
124:     function depositHappened(uint256 _chainId, bytes32 _l2TxHash) external view returns (bytes32);

/// @audit ↑↑ Out of order with `depositHappened()`
130:     function bridgehubDeposit(
131:         uint256 _chainId,
132:         address _prevMsgSender,
133:         uint256 _l2Value,
134:         bytes calldata _data
135:     ) external payable returns (L2TransactionRequestTwoBridgesInner memory request);

/// @audit ↑↑ Out of order with `bridgehubDeposit()`
137:     function bridgehubDepositBaseToken(
138:         uint256 _chainId,
139:         address _prevMsgSender,
140:         address _l1Token,
141:         uint256 _amount
142:     ) external payable;

/// @audit ↑↑ Out of order with `bridgehubDepositBaseToken()`
144:     function bridgehubConfirmL2Transaction(uint256 _chainId, bytes32 _txDataHash, bytes32 _txHash) external;

/// @audit ↑↑ Out of order with `bridgehubConfirmL2Transaction()`
146:     function receiveEth(uint256 _chainId) external payable;
```

- *Bridgehub.sol* ( [77-77](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L77-L77), [84-84](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L84-L84), [200-205](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L200-L205), [219-221](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L219-L221), [264-266](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L264-L266) ):

```solidity
/// @audit ↓↓ Out of order with `addStateTransitionManager()`
77:     function getStateTransition(uint256 _chainId) public view returns (address) {

/// @audit ↑↑ Out of order with `getStateTransition()`
84:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner {

/// @audit ↓↓ Out of order with `requestL2TransactionDirect()`
200:     function l2TransactionBaseCost(
201:         uint256 _chainId,
202:         uint256 _gasPrice,
203:         uint256 _l2GasLimit,
204:         uint256 _l2GasPerPubdataByteLimit
205:     ) external view returns (uint256) {

/// @audit ↑↑ Out of order with `l2TransactionBaseCost()`
219:     function requestL2TransactionDirect(
220:         L2TransactionRequestDirect calldata _request
221:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash) {

/// @audit ↑↑ Out of order with `requestL2TransactionDirect()`
264:     function requestL2TransactionTwoBridges(
265:         L2TransactionRequestTwoBridgesOuter calldata _request
266:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash) {
```

- *IBridgehub.sol* ( [91-99](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L91-L99), [101-103](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L101-L103), [105-107](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L105-L107), [109-114](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L109-L114), [118-125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L118-L125), [127-127](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L127-L127), [129-129](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L129-L129), [131-131](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L131-L131), [133-133](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L133-L133) ):

```solidity
/// @audit ↓↓ Out of order with `requestL2TransactionDirect()`
91:     function proveL1ToL2TransactionStatus(
92:         uint256 _chainId,
93:         bytes32 _l2TxHash,
94:         uint256 _l2BatchNumber,
95:         uint256 _l2MessageIndex,
96:         uint16 _l2TxNumberInBatch,
97:         bytes32[] calldata _merkleProof,
98:         TxStatus _status
99:     ) external view returns (bool);

/// @audit ↑↑ Out of order with `proveL1ToL2TransactionStatus()`
101:     function requestL2TransactionDirect(
102:         L2TransactionRequestDirect calldata _request
103:     ) external payable returns (bytes32 canonicalTxHash);

/// @audit ↑↑ Out of order with `requestL2TransactionDirect()`
105:     function requestL2TransactionTwoBridges(
106:         L2TransactionRequestTwoBridgesOuter calldata _request
107:     ) external payable returns (bytes32 canonicalTxHash);

/// @audit ↓↓ Out of order with `createNewChain()`
109:     function l2TransactionBaseCost(
110:         uint256 _chainId,
111:         uint256 _gasPrice,
112:         uint256 _l2GasLimit,
113:         uint256 _l2GasPerPubdataByteLimit
114:     ) external view returns (uint256);

/// @audit ↑↑ Out of order with `l2TransactionBaseCost()`
118:     function createNewChain(
119:         uint256 _chainId,
120:         address _stateTransitionManager,
121:         address _baseToken,
122:         uint256 _salt,
123:         address _admin,
124:         bytes calldata _initData
125:     ) external returns (uint256 chainId);

/// @audit ↑↑ Out of order with `createNewChain()`
127:     function addStateTransitionManager(address _stateTransitionManager) external;

/// @audit ↑↑ Out of order with `addStateTransitionManager()`
129:     function removeStateTransitionManager(address _stateTransitionManager) external;

/// @audit ↑↑ Out of order with `removeStateTransitionManager()`
131:     function addToken(address _token) external;

/// @audit ↑↑ Out of order with `addToken()`
133:     function setSharedBridge(address _sharedBridge) external;
```

- *Governance.sol* ( [107-107](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L107-L107), [131-131](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L131-L131), [144-144](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L144-L144), [156-156](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L156-L156), [169-169](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L169-L169), [188-188](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L188-L188), [217-217](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L217-L217), [226-226](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L226-L226), [241-241](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L241-L241), [251-251](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L251-L251), [258-258](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L258-L258), [264-264](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L264-L264) ):

```solidity
/// @audit ↓↓ Out of order with `scheduleTransparent()`
107:     function getOperationState(bytes32 _id) public view returns (OperationState) {

/// @audit ↑↑ Out of order with `getOperationState()`
131:     function scheduleTransparent(Operation calldata _operation, uint256 _delay) external onlyOwner {

/// @audit ↑↑ Out of order with `scheduleTransparent()`
144:     function scheduleShadow(bytes32 _id, uint256 _delay) external onlyOwner {

/// @audit ↑↑ Out of order with `scheduleShadow()`
156:     function cancel(bytes32 _id) external onlyOwner {

/// @audit ↑↑ Out of order with `cancel()`
169:     function execute(Operation calldata _operation) external payable onlyOwnerOrSecurityCouncil {

/// @audit ↑↑ Out of order with `execute()`
188:     function executeInstant(Operation calldata _operation) external payable onlySecurityCouncil {

/// @audit ↓↓ Out of order with `_execute()`
217:     function _schedule(bytes32 _id, uint256 _delay) internal {

/// @audit ↑↑ Out of order with `_schedule()`
226:     function _execute(Call[] calldata _calls) internal {

/// @audit ↓↓ Out of order with `updateDelay()`
241:     function _checkPredecessorDone(bytes32 _predecessorId) internal view {

/// @audit ↑↑ Out of order with `_checkPredecessorDone()`
251:     function updateDelay(uint256 _newDelay) external onlySelf {

/// @audit ↑↑ Out of order with `updateDelay()`
258:     function updateSecurityCouncil(address _newSecurityCouncil) external onlySelf {

/// @audit ↑↑ Out of order with `updateSecurityCouncil()`
264:     receive() external payable {}
```

- *IGovernance.sol* ( [51-51](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L51-L51), [53-53](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L53-L53), [55-55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L55-L55), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L57-L57), [59-59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L59-L59), [61-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L61-L61), [63-63](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L63-L63), [65-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L65-L65), [67-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L67-L67) ):

```solidity
/// @audit ↓↓ Out of order with `scheduleTransparent()`
51:     function getOperationState(bytes32 _id) external view returns (OperationState);

/// @audit ↑↑ Out of order with `getOperationState()`
53:     function scheduleTransparent(Operation calldata _operation, uint256 _delay) external;

/// @audit ↑↑ Out of order with `scheduleTransparent()`
55:     function scheduleShadow(bytes32 _id, uint256 _delay) external;

/// @audit ↑↑ Out of order with `scheduleShadow()`
57:     function cancel(bytes32 _id) external;

/// @audit ↑↑ Out of order with `cancel()`
59:     function execute(Operation calldata _operation) external payable;

/// @audit ↑↑ Out of order with `execute()`
61:     function executeInstant(Operation calldata _operation) external payable;

/// @audit ↓↓ Out of order with `updateDelay()`
63:     function hashOperation(Operation calldata _operation) external pure returns (bytes32);

/// @audit ↑↑ Out of order with `hashOperation()`
65:     function updateDelay(uint256 _newDelay) external;

/// @audit ↑↑ Out of order with `updateDelay()`
67:     function updateSecurityCouncil(address _newSecurityCouncil) external;
```

- *IStateTransitionManager.sol* ( [65-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L65-L65), [67-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L67-L67), [69-69](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L69-L69), [71-71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L71-L71), [73-73](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L73-L73), [76-82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L76-L82), [84-84](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L84-L84), [86-90](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L86-L90), [92-92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L92-L92), [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L94-L94), [96-96](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L96-L96) ):

```solidity
/// @audit ↓↓ Out of order with `initialize()`
65:     function protocolVersion() external view returns (uint256);

/// @audit ↑↑ Out of order with `protocolVersion()`
67:     function initialize(StateTransitionManagerInitializeData calldata _initalizeData) external;

/// @audit ↑↑ Out of order with `initialize()`
69:     function setInitialCutHash(Diamond.DiamondCutData calldata _diamondCut) external;

/// @audit ↑↑ Out of order with `setInitialCutHash()`
71:     function setValidatorTimelock(address _validatorTimelock) external;

/// @audit ↓↓ Out of order with `createNewChain()`
73:     function getChainAdmin(uint256 _chainId) external view returns (address);

/// @audit ↑↑ Out of order with `getChainAdmin()`
76:     function createNewChain(
77:         uint256 _chainId,
78:         address _baseToken,
79:         address _sharedBridge,
80:         address _admin,
81:         bytes calldata _diamondCut
82:     ) external;

/// @audit ↑↑ Out of order with `createNewChain()`
84:     function registerAlreadyDeployedStateTransition(uint256 _chainId, address _stateTransitionContract) external;

/// @audit ↑↑ Out of order with `registerAlreadyDeployedStateTransition()`
86:     function setNewVersionUpgrade(
87:         Diamond.DiamondCutData calldata _cutData,
88:         uint256 _oldProtocolVersion,
89:         uint256 _newProtocolVersion
90:     ) external;

/// @audit ↑↑ Out of order with `setNewVersionUpgrade()`
92:     function setUpgradeDiamondCut(Diamond.DiamondCutData calldata _cutData, uint256 _oldProtocolVersion) external;

/// @audit ↑↑ Out of order with `setUpgradeDiamondCut()`
94:     function freezeChain(uint256 _chainId) external;

/// @audit ↑↑ Out of order with `freezeChain()`
96:     function unfreezeChain(uint256 _chainId) external;
```

- *StateTransitionManager.sol* ( [179-179](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L179-L179), [232-235](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L232-L235) ):

```solidity
/// @audit ↓↓ Out of order with `registerAlreadyDeployedStateTransition()`
179:     function _setChainIdUpgrade(uint256 _chainId, address _chainContract) internal {

/// @audit ↑↑ Out of order with `_setChainIdUpgrade()`
232:     function registerAlreadyDeployedStateTransition(
233:         uint256 _chainId,
234:         address _stateTransitionContract
235:     ) external onlyOwner {
```

- *ValidatorTimelock.sol* ( [104-104](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L104-L104), [110-113](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L110-L113), [128-132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L128-L132), [148-148](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L148-L148), [155-155](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L155-L155), [162-166](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L162-L166), [173-178](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L173-L178), [184-184](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L184-L184), [205-208](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L205-L208) ):

```solidity
/// @audit ↓↓ Out of order with `commitBatches()`
104:     function getCommittedBatchTimestamp(uint256 _chainId, uint256 _l2BatchNumber) external view returns (uint256) {

/// @audit ↑↑ Out of order with `getCommittedBatchTimestamp()`
110:     function commitBatches(
111:         StoredBatchInfo calldata,
112:         CommitBatchInfo[] calldata _newBatchesData
113:     ) external onlyValidator(ERA_CHAIN_ID) {

/// @audit ↑↑ Out of order with `commitBatches()`
128:     function commitBatchesSharedBridge(
129:         uint256 _chainId,
130:         StoredBatchInfo calldata,
131:         CommitBatchInfo[] calldata _newBatchesData
132:     ) external onlyValidator(_chainId) {

/// @audit ↑↑ Out of order with `commitBatchesSharedBridge()`
148:     function revertBatches(uint256) external onlyValidator(ERA_CHAIN_ID) {

/// @audit ↑↑ Out of order with `revertBatches()`
155:     function revertBatchesSharedBridge(uint256 _chainId, uint256) external onlyValidator(_chainId) {

/// @audit ↑↑ Out of order with `revertBatchesSharedBridge()`
162:     function proveBatches(
163:         StoredBatchInfo calldata,
164:         StoredBatchInfo[] calldata,
165:         ProofInput calldata
166:     ) external onlyValidator(ERA_CHAIN_ID) {

/// @audit ↑↑ Out of order with `proveBatches()`
173:     function proveBatchesSharedBridge(
174:         uint256 _chainId,
175:         StoredBatchInfo calldata,
176:         StoredBatchInfo[] calldata,
177:         ProofInput calldata
178:     ) external onlyValidator(_chainId) {

/// @audit ↑↑ Out of order with `proveBatchesSharedBridge()`
184:     function executeBatches(StoredBatchInfo[] calldata _newBatchesData) external onlyValidator(ERA_CHAIN_ID) {

/// @audit ↑↑ Out of order with `executeBatches()`
205:     function executeBatchesSharedBridge(
206:         uint256 _chainId,
207:         StoredBatchInfo[] calldata _newBatchesData
208:     ) external onlyValidator(_chainId) {
```

- *Executor.sol* ( [132-135](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L132-L135), [201-204](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L201-L204), [209-213](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L209-L213), [217-220](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L217-L220), [255-258](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L255-L258), [275-279](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L275-L279), [310-310](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L310-L310), [323-323](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L323-L323), [339-342](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L339-L342), [347-347](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L347-L347), [351-351](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L351-L351), [370-374](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L370-L374), [379-384](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L379-L384), [451-455](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L451-L455), [470-470](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L470-L470), [475-475](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L475-L475) ):

```solidity
/// @audit ↓↓ Out of order with `commitBatches()`
132:     function _processL2Logs(
133:         CommitBatchInfo calldata _newBatch,
134:         bytes32 _expectedSystemContractUpgradeTxHash
135:     ) internal pure returns (LogProcessingOutput memory logOutput) {

/// @audit ↑↑ Out of order with `_processL2Logs()`
201:     function commitBatches(
202:         StoredBatchInfo memory _lastCommittedBatchData,
203:         CommitBatchInfo[] calldata _newBatchesData
204:     ) external nonReentrant onlyValidator {

/// @audit ↑↑ Out of order with `commitBatches()`
209:     function commitBatchesSharedBridge(
210:         uint256, // _chainId
211:         StoredBatchInfo memory _lastCommittedBatchData,
212:         CommitBatchInfo[] calldata _newBatchesData
213:     ) external nonReentrant onlyValidator {

/// @audit ↓↓ Out of order with `_commitBatchesWithoutSystemContractsUpgrade()`
217:     function _commitBatches(
218:         StoredBatchInfo memory _lastCommittedBatchData,
219:         CommitBatchInfo[] calldata _newBatchesData
220:     ) internal {

/// @audit ↑↑ Out of order with `_commitBatches()`
255:     function _commitBatchesWithoutSystemContractsUpgrade(
256:         StoredBatchInfo memory _lastCommittedBatchData,
257:         CommitBatchInfo[] calldata _newBatchesData
258:     ) internal {

/// @audit ↑↑ Out of order with `_commitBatchesWithoutSystemContractsUpgrade()`
275:     function _commitBatchesWithSystemContractsUpgrade(
276:         StoredBatchInfo memory _lastCommittedBatchData,
277:         CommitBatchInfo[] calldata _newBatchesData,
278:         bytes32 _systemContractUpgradeTxHash
279:     ) internal {

/// @audit ↑↑ Out of order with `_commitBatchesWithSystemContractsUpgrade()`
310:     function _collectOperationsFromPriorityQueue(uint256 _nPriorityOps) internal returns (bytes32 concatHash) {

/// @audit ↑↑ Out of order with `_collectOperationsFromPriorityQueue()`
323:     function _executeOneBatch(StoredBatchInfo memory _storedBatch, uint256 _executedBatchIdx) internal {

/// @audit ↑↑ Out of order with `_executeOneBatch()`
339:     function executeBatchesSharedBridge(
340:         uint256,
341:         StoredBatchInfo[] calldata _batchesData
342:     ) external nonReentrant onlyValidator {

/// @audit ↑↑ Out of order with `executeBatchesSharedBridge()`
347:     function executeBatches(StoredBatchInfo[] calldata _batchesData) external nonReentrant onlyValidator {

/// @audit ↓↓ Out of order with `proveBatches()`
351:     function _executeBatches(StoredBatchInfo[] calldata _batchesData) internal {

/// @audit ↑↑ Out of order with `_executeBatches()`
370:     function proveBatches(
371:         StoredBatchInfo calldata _prevBatch,
372:         StoredBatchInfo[] calldata _committedBatches,
373:         ProofInput calldata _proof
374:     ) external nonReentrant onlyValidator {

/// @audit ↑↑ Out of order with `proveBatches()`
379:     function proveBatchesSharedBridge(
380:         uint256, // _chainId
381:         StoredBatchInfo calldata _prevBatch,
382:         StoredBatchInfo[] calldata _committedBatches,
383:         ProofInput calldata _proof
384:     ) external nonReentrant onlyValidator {

/// @audit ↓↓ Out of order with `revertBatches()`
451:     function _getBatchProofPublicInput(
452:         bytes32 _prevBatchCommitment,
453:         bytes32 _currentBatchCommitment,
454:         VerifierParams memory _verifierParams
455:     ) internal pure returns (uint256) {

/// @audit ↑↑ Out of order with `_getBatchProofPublicInput()`
470:     function revertBatches(uint256 _newLastBatch) external nonReentrant onlyValidatorOrStateTransitionManager {

/// @audit ↑↑ Out of order with `revertBatches()`
475:     function revertBatchesSharedBridge(uint256, uint256 _newLastBatch) external nonReentrant onlyValidator {
```

- *Mailbox.sol* ( [56-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L56-L61), [66-71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L66-L71), [132-132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L132-L132), [145-149](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L145-L149), [158-158](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L158-L158), [180-186](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L180-L186), [199-207](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L199-L207), [230-232](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L230-L232), [260-265](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L260-L265), [291-295](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L291-L295), [318-322](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L318-L322) ):

```solidity
/// @audit ↓↓ Out of order with `proveL2LogInclusion()`
56:     function proveL2MessageInclusion(
57:         uint256 _batchNumber,
58:         uint256 _index,
59:         L2Message memory _message,
60:         bytes32[] calldata _proof
61:     ) public view returns (bool) {

/// @audit ↑↑ Out of order with `proveL2MessageInclusion()`
66:     function proveL2LogInclusion(
67:         uint256 _batchNumber,
68:         uint256 _index,
69:         L2Log memory _log,
70:         bytes32[] calldata _proof
71:     ) external view returns (bool) {

/// @audit ↓↓ Out of order with `l2TransactionBaseCost()`
132:     function _L2MessageToLog(L2Message memory _message) internal pure returns (L2Log memory) {

/// @audit ↑↑ Out of order with `_L2MessageToLog()`
145:     function l2TransactionBaseCost(
146:         uint256 _gasPrice,
147:         uint256 _l2GasLimit,
148:         uint256 _l2GasPerPubdataByteLimit
149:     ) public view returns (uint256) {

/// @audit ↓↓ Out of order with `finalizeEthWithdrawal()`
158:     function _deriveL2GasPrice(uint256 _l1GasPrice, uint256 _gasPerPubdata) internal view returns (uint256) {

/// @audit ↑↑ Out of order with `_deriveL2GasPrice()`
180:     function finalizeEthWithdrawal(
181:         uint256 _l2BatchNumber,
182:         uint256 _l2MessageIndex,
183:         uint16 _l2TxNumberInBatch,
184:         bytes calldata _message,
185:         bytes32[] calldata _merkleProof
186:     ) external nonReentrant {

/// @audit ↑↑ Out of order with `finalizeEthWithdrawal()`
199:     function requestL2Transaction(
200:         address _contractL2,
201:         uint256 _l2Value,
202:         bytes calldata _calldata,
203:         uint256 _l2GasLimit,
204:         uint256 _l2GasPerPubdataByteLimit,
205:         bytes[] calldata _factoryDeps,
206:         address _refundRecipient
207:     ) external payable returns (bytes32 canonicalTxHash) {

/// @audit ↓↓ Out of order with `_requestL2Transaction()`
230:     function _requestL2TransactionSender(
231:         BridgehubL2TransactionRequest memory _request
232:     ) internal nonReentrant returns (bytes32 canonicalTxHash) {

/// @audit ↑↑ Out of order with `_requestL2TransactionSender()`
260:     function _requestL2Transaction(
261:         uint256 _mintValue,
262:         WritePriorityOpParams memory _params,
263:         bytes memory _calldata,
264:         bytes[] memory _factoryDeps
265:     ) internal returns (bytes32 canonicalTxHash) {

/// @audit ↓↓ Out of order with `_writePriorityOp()`
291:     function _serializeL2Transaction(
292:         WritePriorityOpParams memory _priorityOpParams,
293:         bytes memory _calldata,
294:         bytes[] memory _factoryDeps
295:     ) internal pure returns (L2CanonicalTransaction memory transaction) {

/// @audit ↑↑ Out of order with `_serializeL2Transaction()`
318:     function _writePriorityOp(
319:         WritePriorityOpParams memory _priorityOpParams,
320:         bytes memory _calldata,
321:         bytes[] memory _factoryDeps
322:     ) internal returns (bytes32 canonicalTxHash) {
```

- *IMailbox.sol* ( [49-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L49-L56), [64-70](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L64-L70), [90-98](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L90-L98), [100-102](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L100-L102), [109-113](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L109-L113), [116-116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L116-L116) ):

```solidity
/// @audit ↓↓ Out of order with `finalizeEthWithdrawal()`
49:     function proveL1ToL2TransactionStatus(
50:         bytes32 _l2TxHash,
51:         uint256 _l2BatchNumber,
52:         uint256 _l2MessageIndex,
53:         uint16 _l2TxNumberInBatch,
54:         bytes32[] calldata _merkleProof,
55:         TxStatus _status
56:     ) external view returns (bool);

/// @audit ↑↑ Out of order with `proveL1ToL2TransactionStatus()`
64:     function finalizeEthWithdrawal(
65:         uint256 _l2BatchNumber,
66:         uint256 _l2MessageIndex,
67:         uint16 _l2TxNumberInBatch,
68:         bytes calldata _message,
69:         bytes32[] calldata _merkleProof
70:     ) external;

/// @audit ↑↑ Out of order with `finalizeEthWithdrawal()`
90:     function requestL2Transaction(
91:         address _contractL2,
92:         uint256 _l2Value,
93:         bytes calldata _calldata,
94:         uint256 _l2GasLimit,
95:         uint256 _l2GasPerPubdataByteLimit,
96:         bytes[] calldata _factoryDeps,
97:         address _refundRecipient
98:     ) external payable returns (bytes32 canonicalTxHash);

/// @audit ↑↑ Out of order with `requestL2Transaction()`
100:     function bridgehubRequestL2Transaction(
101:         BridgehubL2TransactionRequest calldata _request
102:     ) external payable returns (bytes32 canonicalTxHash);

/// @audit ↓↓ Out of order with `transferEthToSharedBridge()`
109:     function l2TransactionBaseCost(
110:         uint256 _gasPrice,
111:         uint256 _l2GasLimit,
112:         uint256 _l2GasPerPubdataByteLimit
113:     ) external view returns (uint256);

/// @audit ↑↑ Out of order with `l2TransactionBaseCost()`
116:     function transferEthToSharedBridge() external;
```

- *PriorityQueue.sol* ( [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L52-L52), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L57-L57), [66-66](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L66-L66), [74-74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L74-L74) ):

```solidity
/// @audit ↓↓ Out of order with `pushBack()`
52:     function isEmpty(Queue storage _queue) internal view returns (bool) {

/// @audit ↑↑ Out of order with `isEmpty()`
57:     function pushBack(Queue storage _queue, PriorityOperation memory _operation) internal {

/// @audit ↓↓ Out of order with `popFront()`
66:     function front(Queue storage _queue) internal view returns (PriorityOperation memory) {

/// @audit ↑↑ Out of order with `front()`
74:     function popFront(Queue storage _queue) internal returns (PriorityOperation memory priorityOperation) {
```

- *BaseZkSyncUpgrade.sol* ( [144-144](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L144-L144), [165-165](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L165-L165), [224-224](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L224-L224), [238-238](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L238-L238) ):

```solidity
/// @audit ↓↓ Out of order with `_upgradeVerifier()`
144:     function _setVerifierParams(VerifierParams calldata _newVerifierParams) private {

/// @audit ↑↑ Out of order with `_setVerifierParams()`
165:     function _upgradeVerifier(address _newVerifier, VerifierParams calldata _verifierParams) internal {

/// @audit ↓↓ Out of order with `_setNewProtocolVersion()`
224:     function _verifyFactoryDeps(bytes[] calldata _factoryDeps, uint256[] calldata _expectedHashes) private pure {

/// @audit ↑↑ Out of order with `_verifyFactoryDeps()`
238:     function _setNewProtocolVersion(uint256 _newProtocolVersion) internal virtual {
```

- *BaseZkSyncUpgradeGenesis.sol* ( [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L22-L22), [49-49](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L49-L49) ):

```solidity
/// @audit ↓↓ Out of order with `upgrade()`
22:     function _setNewProtocolVersion(uint256 _newProtocolVersion) internal override {

/// @audit ↑↑ Out of order with `_setNewProtocolVersion()`
49:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual override returns (bytes32) {
```

- *L2SharedBridge.sol* ( [111-111](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L111-L111), [125-125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L125-L125), [140-144](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L140-L144), [151-151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L151-L151) ):

```solidity
/// @audit ↓↓ Out of order with `withdraw()`
111:     function _deployL2Token(address _l1Token, bytes calldata _data) internal returns (address) {

/// @audit ↑↑ Out of order with `_deployL2Token()`
125:     function withdraw(address _l1Receiver, address _l2Token, uint256 _amount) external override {

/// @audit ↓↓ Out of order with `l2TokenAddress()`
140:     function _getL1WithdrawMessage(
141:         address _to,
142:         address _l1Token,
143:         uint256 _amount
144:     ) internal pure returns (bytes memory) {

/// @audit ↑↑ Out of order with `_getL1WithdrawMessage()`
151:     function l2TokenAddress(address _l1Token) public view override returns (address) {
```

- *L2StandardERC20.sol* ( [173-173](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L173-L173), [180-180](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L180-L180) ):

```solidity
/// @audit ↓↓ Out of order with `decodeString()`
173:     function decimals() public view override returns (uint8) {

/// @audit ↑↑ Out of order with `decimals()`
180:     function decodeString(bytes memory _input) external pure returns (string memory result) {
```

- *AccountCodeStorage.sol* ( [68-68](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L68-L68), [78-78](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L78-L78), [89-89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L89-L89) ):

```solidity
/// @audit ↓↓ Out of order with `getRawCodeHash()`
68:     function _storeCodeHash(address _address, bytes32 _hash) internal {

/// @audit ↑↑ Out of order with `_storeCodeHash()`
78:     function getRawCodeHash(address _address) public view override returns (bytes32 codeHash) {

/// @audit ↑↑ Out of order with `getRawCodeHash()`
89:     function getCodeHash(uint256 _input) external view override returns (bytes32) {
```

- *ContractDeployer.sol* ( [58-58](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L58-L58), [65-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L65-L65), [115-118](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L115-L118), [132-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L132-L136), [147-151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L147-L151), [162-167](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L162-L167), [182-187](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L182-L187), [213-213](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L213-L213), [238-238](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L238-L238), [258-263](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L258-L263), [283-288](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L283-L288), [301-301](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L301-L301), [309-309](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L309-L309), [321-328](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L321-L328) ):

```solidity
/// @audit ↓↓ Out of order with `updateAccountVersion()`
58:     function _storeAccountInfo(address _address, AccountInfo memory _newInfo) internal {

/// @audit ↑↑ Out of order with `_storeAccountInfo()`
65:     function updateAccountVersion(AccountAbstractionVersion _version) external onlySystemCall {

/// @audit ↓↓ Out of order with `create2()`
115:     function getNewAddressCreate(
116:         address _sender,
117:         uint256 _senderNonce
118:     ) public pure override returns (address newAddress) {

/// @audit ↑↑ Out of order with `getNewAddressCreate()`
132:     function create2(
133:         bytes32 _salt,
134:         bytes32 _bytecodeHash,
135:         bytes calldata _input
136:     ) external payable override returns (address) {

/// @audit ↑↑ Out of order with `create2()`
147:     function create(
148:         bytes32 _salt,
149:         bytes32 _bytecodeHash,
150:         bytes calldata _input
151:     ) external payable override returns (address) {

/// @audit ↓↓ Out of order with `createAccount()`
162:     function create2Account(
163:         bytes32 _salt,
164:         bytes32 _bytecodeHash,
165:         bytes calldata _input,
166:         AccountAbstractionVersion _aaVersion
167:     ) public payable override onlySystemCall returns (address) {

/// @audit ↑↑ Out of order with `create2Account()`
182:     function createAccount(
183:         bytes32, // salt
184:         bytes32 _bytecodeHash,
185:         bytes calldata _input,
186:         AccountAbstractionVersion _aaVersion
187:     ) public payable override onlySystemCall returns (address) {

/// @audit ↑↑ Out of order with `createAccount()`
213:     function forceDeployOnAddress(ForceDeployment calldata _deployment, address _sender) external payable onlySelf {

/// @audit ↑↑ Out of order with `forceDeployOnAddress()`
238:     function forceDeployOnAddresses(ForceDeployment[] calldata _deployments) external payable {

/// @audit ↓↓ Out of order with `_performDeployOnAddress()`
258:     function _nonSystemDeployOnAddress(
259:         bytes32 _bytecodeHash,
260:         address _newAddress,
261:         AccountAbstractionVersion _aaVersion,
262:         bytes calldata _input
263:     ) internal {

/// @audit ↑↑ Out of order with `_nonSystemDeployOnAddress()`
283:     function _performDeployOnAddress(
284:         bytes32 _bytecodeHash,
285:         address _newAddress,
286:         AccountAbstractionVersion _aaVersion,
287:         bytes calldata _input
288:     ) internal {

/// @audit ↓↓ Out of order with `_storeConstructingByteCodeHashOnAddress()`
301:     function _ensureBytecodeIsKnown(bytes32 _bytecodeHash) internal view {

/// @audit ↑↑ Out of order with `_ensureBytecodeIsKnown()`
309:     function _storeConstructingByteCodeHashOnAddress(address _newAddress, bytes32 _bytecodeHash) internal {

/// @audit ↑↑ Out of order with `_storeConstructingByteCodeHashOnAddress()`
321:     function _constructContract(
322:         address _sender,
323:         address _newAddress,
324:         bytes32 _bytecodeHash,
325:         bytes calldata _input,
326:         bool _isSystem,
327:         bool _callConstructor
328:     ) internal {
```

- *DefaultAccount.sol* ( [78-81](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L78-L81), [112-116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L112-L116), [159-159](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L159-L159), [196-200](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L196-L200), [212-216](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L212-L216), [220-220](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L220-L220), [227-227](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L227-L227) ):

```solidity
/// @audit ↓↓ Out of order with `executeTransaction()`
78:     function _validateTransaction(
79:         bytes32 _suggestedSignedHash,
80:         Transaction calldata _transaction
81:     ) internal returns (bytes4 magic) {

/// @audit ↑↑ Out of order with `_validateTransaction()`
112:     function executeTransaction(
113:         bytes32, // _txHash
114:         bytes32, // _suggestedSignedHash
115:         Transaction calldata _transaction
116:     ) external payable override ignoreNonBootloader ignoreInDelegateCall {

/// @audit ↓↓ Out of order with `payForTransaction()`
159:     function _isValidSignature(bytes32 _hash, bytes memory _signature) internal view returns (bool) {

/// @audit ↑↑ Out of order with `_isValidSignature()`
196:     function payForTransaction(
197:         bytes32, // _txHash
198:         bytes32, // _suggestedSignedHash
199:         Transaction calldata _transaction
200:     ) external payable ignoreNonBootloader ignoreInDelegateCall {

/// @audit ↑↑ Out of order with `payForTransaction()`
212:     function prepareForPaymaster(
213:         bytes32, // _txHash
214:         bytes32, // _suggestedSignedHash
215:         Transaction calldata _transaction
216:     ) external payable ignoreNonBootloader ignoreInDelegateCall {

/// @audit ↑↑ Out of order with `prepareForPaymaster()`
220:     fallback() external payable ignoreInDelegateCall {

/// @audit ↑↑ Out of order with `fallback()`
227:     receive() external payable {
```

- *EmptyContract.sol* ( [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/EmptyContract.sol#L11-L11), [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/EmptyContract.sol#L13-L13) ):

```solidity
/// @audit ↓↓ Out of order with `receive()`
11:     fallback() external payable {}

/// @audit ↑↑ Out of order with `fallback()`
13:     receive() external payable {}
```

- *KnownCodesStorage.sol* ( [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L46-L46), [65-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L65-L65) ):

```solidity
/// @audit ↓↓ Out of order with `getMarker()`
46:     function _markBytecodeAsPublished(bytes32 _bytecodeHash, bool _shouldSendToL1) internal {

/// @audit ↑↑ Out of order with `_markBytecodeAsPublished()`
65:     function getMarker(bytes32 _hash) public view override returns (uint256 marker) {
```

- *L1Messenger.sol* ( [61-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L61-L61), [70-74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L70-L74), [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L94-L94), [116-116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L116-L116), [161-163](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L161-L163), [194-196](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L194-L196) ):

```solidity
/// @audit ↓↓ Out of order with `sendL2ToL1Log()`
61:     function sha256GasCost(uint256 _length) internal pure returns (uint256) {

/// @audit ↑↑ Out of order with `sha256GasCost()`
70:     function sendL2ToL1Log(
71:         bool _isService,
72:         bytes32 _key,
73:         bytes32 _value
74:     ) external onlyCallFromSystemContract returns (uint256 logIdInMerkleTree) {

/// @audit ↓↓ Out of order with `sendToL1()`
94:     function _processL2ToL1Log(L2ToL1Log memory _l2ToL1Log) internal returns (uint256 logIdInMerkleTree) {

/// @audit ↑↑ Out of order with `_processL2ToL1Log()`
116:     function sendToL1(bytes calldata _message) external override returns (bytes32 hash) {

/// @audit ↑↑ Out of order with `sendToL1()`
161:     function requestBytecodeL1Publication(
162:         bytes32 _bytecodeHash
163:     ) external override onlyCallFrom(address(KNOWN_CODE_STORAGE_CONTRACT)) {

/// @audit ↑↑ Out of order with `requestBytecodeL1Publication()`
194:     function publishPubdataAndClearState(
195:         bytes calldata _totalL2ToL1PubdataAndStateDiffs
196:     ) external onlyCallFromBootloader {
```

- *L2BaseToken.sol* ( [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L56-L56), [64-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L64-L64), [72-72](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L72-L72), [85-85](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L85-L85), [117-122](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L117-L122), [128-128](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L128-L128) ):

```solidity
/// @audit ↓↓ Out of order with `mint()`
56:     function balanceOf(uint256 _account) external view override returns (uint256) {

/// @audit ↑↑ Out of order with `balanceOf()`
64:     function mint(address _account, uint256 _amount) external override onlyCallFromBootloader {

/// @audit ↑↑ Out of order with `mint()`
72:     function withdraw(address _l1Receiver) external payable override {

/// @audit ↑↑ Out of order with `withdraw()`
85:     function withdrawWithMessage(address _l1Receiver, bytes memory _additionalData) external payable override {

/// @audit ↓↓ Out of order with `name()`
117:     function _getExtendedWithdrawMessage(
118:         address _to,
119:         uint256 _amount,
120:         address _sender,
121:         bytes memory _additionalData
122:     ) internal pure returns (bytes memory) {

/// @audit ↑↑ Out of order with `_getExtendedWithdrawMessage()`
128:     function name() external pure override returns (string memory) {
```

- *MsgValueSimulator.sol* ( [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L25-L25), [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L47-L47) ):

```solidity
/// @audit ↓↓ Out of order with `fallback()`
25:     function _getAbiParams() internal view returns (uint256 value, bool isSystemCall, address to) {

/// @audit ↑↑ Out of order with `_getAbiParams()`
47:     fallback(bytes calldata _data) external onlySystemCall returns (bytes memory) {
```

- *NonceHolder.sol* ( [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L57-L57), [65-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L65-L65), [82-82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L82-L82), [102-102](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L102-L102), [110-110](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L110-L110), [125-125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L125-L125), [135-135](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L135-L135), [154-154](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L154-L154), [166-166](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L166-L166) ):

```solidity
/// @audit ↓↓ Out of order with `increaseMinNonce()`
57:     function getRawNonce(address _address) public view returns (uint256) {

/// @audit ↑↑ Out of order with `getRawNonce()`
65:     function increaseMinNonce(uint256 _value) public onlySystemCall returns (uint256 oldMinNonce) {

/// @audit ↑↑ Out of order with `increaseMinNonce()`
82:     function setValueUnderNonce(uint256 _key, uint256 _value) public onlySystemCall {

/// @audit ↓↓ Out of order with `incrementMinNonceIfEquals()`
102:     function getValueUnderNonce(uint256 _key) public view returns (uint256) {

/// @audit ↑↑ Out of order with `getValueUnderNonce()`
110:     function incrementMinNonceIfEquals(uint256 _expectedNonce) external onlySystemCall {

/// @audit ↓↓ Out of order with `incrementDeploymentNonce()`
125:     function getDeploymentNonce(address _address) external view returns (uint256 deploymentNonce) {

/// @audit ↑↑ Out of order with `getDeploymentNonce()`
135:     function incrementDeploymentNonce(address _address) external returns (uint256 prevDeploymentNonce) {

/// @audit ↓↓ Out of order with `validateNonceUsage()`
154:     function isNonceUsed(address _address, uint256 _nonce) public view returns (bool) {

/// @audit ↑↑ Out of order with `isNonceUsed()`
166:     function validateNonceUsage(address _address, uint256 _key, bool _shouldBeUsed) external view {
```

- *SystemContext.sol* ( [117-117](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L117-L117), [122-122](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L122-L122), [205-205](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L205-L205), [212-212](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L212-L212), [233-233](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L233-L233), [241-241](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L241-L241), [263-267](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L263-L267), [314-314](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L314-L314), [341-347](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L341-L347), [402-402](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L402-L402), [408-408](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L408-L408), [427-427](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L427-L427), [444-449](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L444-L449), [471-475](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L471-L475), [482-482](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L482-L482), [486-486](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L486-L486) ):

```solidity
/// @audit ↓↓ Out of order with `getCurrentPubdataCost()`
117:     function getCurrentPubdataSpent() public view returns (uint256) {

/// @audit ↑↑ Out of order with `getCurrentPubdataSpent()`
122:     function getCurrentPubdataCost() external view returns (uint256) {

/// @audit ↓↓ Out of order with `_setL2BlockHash()`
205:     function _getLatest257L2blockHash(uint256 _block) internal view returns (bytes32) {

/// @audit ↑↑ Out of order with `_getLatest257L2blockHash()`
212:     function _setL2BlockHash(uint256 _block, bytes32 _hash) internal {

/// @audit ↓↓ Out of order with `_upgradeL2Blocks()`
233:     function _calculateLegacyL2BlockHash(uint128 _blockNumber) internal pure returns (bytes32) {

/// @audit ↑↑ Out of order with `_calculateLegacyL2BlockHash()`
241:     function _upgradeL2Blocks(uint128 _l2BlockNumber, bytes32 _expectedPrevL2BlockHash, bool _isFirstInBatch) internal {

/// @audit ↑↑ Out of order with `_upgradeL2Blocks()`
263:     function _setVirtualBlock(
264:         uint128 _l2BlockNumber,
265:         uint128 _maxVirtualBlocksToCreate,
266:         uint128 _newTimestamp
267:     ) internal {

/// @audit ↑↑ Out of order with `_setVirtualBlock()`
314:     function _setNewL2BlockData(uint128 _l2BlockNumber, uint128 _l2BlockTimestamp, bytes32 _prevL2BlockHash) internal {

/// @audit ↑↑ Out of order with `_setNewL2BlockData()`
341:     function setL2Block(
342:         uint128 _l2BlockNumber,
343:         uint128 _l2BlockTimestamp,
344:         bytes32 _expectedPrevL2BlockHash,
345:         bool _isFirstInBatch,
346:         uint128 _maxVirtualBlocksToCreate
347:     ) external onlyCallFromBootloader {

/// @audit ↑↑ Out of order with `setL2Block()`
402:     function appendTransactionToCurrentL2Block(bytes32 _txHash) external onlyCallFromBootloader {

/// @audit ↑↑ Out of order with `appendTransactionToCurrentL2Block()`
408:     function publishTimestampDataToL1() external onlyCallFromBootloader {

/// @audit ↓↓ Out of order with `setNewBatch()`
427:     function _ensureBatchConsistentWithL2Block(uint128 _newTimestamp) internal view {

/// @audit ↑↑ Out of order with `_ensureBatchConsistentWithL2Block()`
444:     function setNewBatch(
445:         bytes32 _prevBatchHash,
446:         uint128 _newTimestamp,
447:         uint128 _expectedNewNumber,
448:         uint256 _baseFee
449:     ) external onlyCallFromBootloader {

/// @audit ↑↑ Out of order with `setNewBatch()`
471:     function unsafeOverrideBatch(
472:         uint256 _newTimestamp,
473:         uint256 _number,
474:         uint256 _baseFee
475:     ) external onlyCallFromBootloader {

/// @audit ↑↑ Out of order with `unsafeOverrideBatch()`
482:     function incrementTxNumberInBatch() external onlyCallFromBootloader {

/// @audit ↑↑ Out of order with `incrementTxNumberInBatch()`
486:     function resetTxNumberInBatch() external onlyCallFromBootloader {
```

- *IBaseToken.sol* ( [16-16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBaseToken.sol#L16-L16), [18-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBaseToken.sol#L18-L18), [20-20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBaseToken.sol#L20-L20), [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBaseToken.sol#L22-L22) ):

```solidity
/// @audit ↓↓ Out of order with `mint()`
16:     function decimals() external pure returns (uint8);

/// @audit ↑↑ Out of order with `decimals()`
18:     function mint(address _account, uint256 _amount) external;

/// @audit ↑↑ Out of order with `mint()`
20:     function withdraw(address _l1Receiver) external payable;

/// @audit ↑↑ Out of order with `withdraw()`
22:     function withdrawWithMessage(address _l1Receiver, bytes calldata _additionalData) external payable;
```

- *IContractDeployer.sol* ( [50-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L50-L50), [52-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L52-L56), [58-63](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L58-L63), [68-72](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L68-L72), [76-81](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L76-L81), [84-84](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L84-L84), [87-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L87-L87), [90-90](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L90-L90) ):

```solidity
/// @audit ↓↓ Out of order with `create2()`
50:     function getNewAddressCreate(address _sender, uint256 _senderNonce) external pure returns (address newAddress);

/// @audit ↑↑ Out of order with `getNewAddressCreate()`
52:     function create2(
53:         bytes32 _salt,
54:         bytes32 _bytecodeHash,
55:         bytes calldata _input
56:     ) external payable returns (address newAddress);

/// @audit ↑↑ Out of order with `create2()`
58:     function create2Account(
59:         bytes32 _salt,
60:         bytes32 _bytecodeHash,
61:         bytes calldata _input,
62:         AccountAbstractionVersion _aaVersion
63:     ) external payable returns (address newAddress);

/// @audit ↑↑ Out of order with `create2Account()`
68:     function create(
69:         bytes32 _salt,
70:         bytes32 _bytecodeHash,
71:         bytes calldata _input
72:     ) external payable returns (address newAddress);

/// @audit ↑↑ Out of order with `create()`
76:     function createAccount(
77:         bytes32 _salt,
78:         bytes32 _bytecodeHash,
79:         bytes calldata _input,
80:         AccountAbstractionVersion _aaVersion
81:     ) external payable returns (address newAddress);

/// @audit ↓↓ Out of order with `updateAccountVersion()`
84:     function getAccountInfo(address _address) external view returns (AccountInfo memory info);

/// @audit ↑↑ Out of order with `getAccountInfo()`
87:     function updateAccountVersion(AccountAbstractionVersion _version) external;

/// @audit ↑↑ Out of order with `updateAccountVersion()`
90:     function updateNonceOrdering(AccountNonceOrdering _nonceOrdering) external;
```

- *INonceHolder.sol* ( [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/INonceHolder.sol#L21-L21), [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/INonceHolder.sol#L24-L24), [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/INonceHolder.sol#L27-L27), [30-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/INonceHolder.sol#L30-L30), [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/INonceHolder.sol#L34-L34), [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/INonceHolder.sol#L37-L37), [40-40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/INonceHolder.sol#L40-L40) ):

```solidity
/// @audit ↓↓ Out of order with `increaseMinNonce()`
21:     function getRawNonce(address _address) external view returns (uint256);

/// @audit ↑↑ Out of order with `getRawNonce()`
24:     function increaseMinNonce(uint256 _value) external returns (uint256);

/// @audit ↑↑ Out of order with `increaseMinNonce()`
27:     function setValueUnderNonce(uint256 _key, uint256 _value) external;

/// @audit ↓↓ Out of order with `incrementMinNonceIfEquals()`
30:     function getValueUnderNonce(uint256 _key) external view returns (uint256);

/// @audit ↑↑ Out of order with `getValueUnderNonce()`
34:     function incrementMinNonceIfEquals(uint256 _expectedNonce) external;

/// @audit ↓↓ Out of order with `incrementDeploymentNonce()`
37:     function getDeploymentNonce(address _address) external view returns (uint256);

/// @audit ↑↑ Out of order with `getDeploymentNonce()`
40:     function incrementDeploymentNonce(address _address) external returns (uint256);
```

- *EfficientCall.sol* ( [45-45](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L45-L45), [58-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L58-L64), [74-78](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L74-L78), [88-92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L88-L92), [105-112](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L105-L112), [124-130](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L124-L130), [159-159](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L159-L159), [173-173](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L173-L173), [191-198](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L191-L198), [215-215](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L215-L215), [232-232](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L232-L232) ):

```solidity
/// @audit ↓↓ Out of order with `call()`
45:     function sha(bytes calldata _data) internal view returns (bytes32) {

/// @audit ↑↑ Out of order with `sha()`
58:     function call(
59:         uint256 _gas,
60:         address _address,
61:         uint256 _value,
62:         bytes calldata _data,
63:         bool _isSystem
64:     ) internal returns (bytes memory returnData) {

/// @audit ↓↓ Out of order with `delegateCall()`
74:     function staticCall(
75:         uint256 _gas,
76:         address _address,
77:         bytes calldata _data
78:     ) internal view returns (bytes memory returnData) {

/// @audit ↑↑ Out of order with `staticCall()`
88:     function delegateCall(
89:         uint256 _gas,
90:         address _address,
91:         bytes calldata _data
92:     ) internal returns (bytes memory returnData) {

/// @audit ↑↑ Out of order with `delegateCall()`
105:     function mimicCall(
106:         uint256 _gas,
107:         address _address,
108:         bytes calldata _data,
109:         address _whoToMimic,
110:         bool _isConstructor,
111:         bool _isSystem
112:     ) internal returns (bytes memory returnData) {

/// @audit ↑↑ Out of order with `mimicCall()`
124:     function rawCall(
125:         uint256 _gas,
126:         address _address,
127:         uint256 _value,
128:         bytes calldata _data,
129:         bool _isSystem
130:     ) internal returns (bool success) {

/// @audit ↓↓ Out of order with `rawDelegateCall()`
159:     function rawStaticCall(uint256 _gas, address _address, bytes calldata _data) internal view returns (bool success) {

/// @audit ↑↑ Out of order with `rawStaticCall()`
173:     function rawDelegateCall(uint256 _gas, address _address, bytes calldata _data) internal returns (bool success) {

/// @audit ↑↑ Out of order with `rawDelegateCall()`
191:     function rawMimicCall(
192:         uint256 _gas,
193:         address _address,
194:         bytes calldata _data,
195:         address _whoToMimic,
196:         bool _isConstructor,
197:         bool _isSystem
198:     ) internal returns (bool success) {

/// @audit ↓↓ Out of order with `propagateRevert()`
215:     function _verifyCallResult(bool _success) private pure returns (bytes memory returnData) {

/// @audit ↑↑ Out of order with `_verifyCallResult()`
232:     function propagateRevert() internal pure {
```

- *SystemContractHelper.sol* ( [148-152](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L148-L152), [168-168](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L168-L168), [181-181](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L181-L181), [191-191](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L191-L191) ):

```solidity
/// @audit ↓↓ Out of order with `setValueForNextFarCall()`
148:     function unsafePrecompileCall(
149:         uint256 _rawParams,
150:         uint32 _gasToBurn,
151:         uint32 _pubdataToSpend
152:     ) internal view returns (bool success) {

/// @audit ↑↑ Out of order with `unsafePrecompileCall()`
168:     function setValueForNextFarCall(uint128 _value) internal returns (bool success) {

/// @audit ↑↑ Out of order with `setValueForNextFarCall()`
181:     function eventInitialize(uint256 initializer, uint256 value1) internal {

/// @audit ↑↑ Out of order with `eventInitialize()`
191:     function eventWrite(uint256 value1, uint256 value2) internal {
```

- *TransactionHelper.sol* ( [289-289](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L289-L289), [362-362](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L362-L362), [395-395](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L395-L395) ):

```solidity
/// @audit ↓↓ Out of order with `processPaymasterInput()`
289:     function _encodeHashEIP1559Transaction(Transaction calldata _transaction) private view returns (bytes32) {

/// @audit ↑↑ Out of order with `_encodeHashEIP1559Transaction()`
362:     function processPaymasterInput(Transaction calldata _transaction) internal {

/// @audit ↑↑ Out of order with `processPaymasterInput()`
395:     function payToTheBootloader(Transaction calldata _transaction) internal returns (bool success) {
```

</details>

### [N-10] The `nonReentrant` `modifier` should occur before all other modifiers

This is a best-practice to protect against reentrancy in other modifiers

There are 2 instances:

- *L1SharedBridge.sol* ( [556-564](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L556-L564) ):

```solidity
556:     function depositLegacyErc20Bridge(
557:         address _prevMsgSender,
558:         address _l2Receiver,
559:         address _l1Token,
560:         uint256 _amount,
561:         uint256 _l2TxGasLimit,
562:         uint256 _l2TxGasPerPubdataByte,
563:         address _refundRecipient
564:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) {
```

- *Bridgehub.sol* ( [116-123](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L116-L123) ):

```solidity
116:     function createNewChain(
117:         uint256 _chainId,
118:         address _stateTransitionManager,
119:         address _baseToken,
120:         uint256, //_salt
121:         address _admin,
122:         bytes calldata _initData
123:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {
```

### [N-11] Use of `override` is unnecessary

[Starting from Solidity 0.8.8](https://docs.soliditylang.org/en/v0.8.20/contracts.html#function-overriding), the override keyword is not required when overriding an interface function, except for the case where the function is defined in multiple bases.

<details>
<summary>There are 53 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [184-189](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L184-L189), [234-238](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L234-L238), [279-289](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L279-L289), [387-394](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L387-L394), [556-564](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L556-L564), [617-623](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L617-L623), [646-655](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L646-L655) ):

```solidity
184:     function bridgehubDeposit(
185:         uint256 _chainId,
186:         address _prevMsgSender,
187:         uint256, // l2Value, needed for Weth deposits in the future
188:         bytes calldata _data
189:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) {

234:     function bridgehubConfirmL2Transaction(
235:         uint256 _chainId,
236:         bytes32 _txDataHash,
237:         bytes32 _txHash
238:     ) external override onlyBridgehub {

279:     function claimFailedDeposit(
280:         uint256 _chainId,
281:         address _depositSender,
282:         address _l1Token,
283:         uint256 _amount,
284:         bytes32 _l2TxHash,
285:         uint256 _l2BatchNumber,
286:         uint256 _l2MessageIndex,
287:         uint16 _l2TxNumberInBatch,
288:         bytes32[] calldata _merkleProof
289:     ) external override {

387:     function finalizeWithdrawal(
388:         uint256 _chainId,
389:         uint256 _l2BatchNumber,
390:         uint256 _l2MessageIndex,
391:         uint16 _l2TxNumberInBatch,
392:         bytes calldata _message,
393:         bytes32[] calldata _merkleProof
394:     ) external override {

556:     function depositLegacyErc20Bridge(
557:         address _prevMsgSender,
558:         address _l2Receiver,
559:         address _l1Token,
560:         uint256 _amount,
561:         uint256 _l2TxGasLimit,
562:         uint256 _l2TxGasPerPubdataByte,
563:         address _refundRecipient
564:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) {

617:     function finalizeWithdrawalLegacyErc20Bridge(
618:         uint256 _l2BatchNumber,
619:         uint256 _l2MessageIndex,
620:         uint16 _l2TxNumberInBatch,
621:         bytes calldata _message,
622:         bytes32[] calldata _merkleProof
623:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount) {

646:     function claimFailedDepositLegacyErc20Bridge(
647:         address _depositSender,
648:         address _l1Token,
649:         uint256 _amount,
650:         bytes32 _l2TxHash,
651:         uint256 _l2BatchNumber,
652:         uint256 _l2MessageIndex,
653:         uint16 _l2TxNumberInBatch,
654:         bytes32[] calldata _merkleProof
655:     ) external override onlyLegacyBridge {
```

- *Bridgehub.sol* ( [154-160](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L154-L160), [166-172](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L166-L172), [178-186](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L178-L186), [219-221](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L219-L221), [264-266](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L264-L266) ):

```solidity
154:     function proveL2MessageInclusion(
155:         uint256 _chainId,
156:         uint256 _batchNumber,
157:         uint256 _index,
158:         L2Message calldata _message,
159:         bytes32[] calldata _proof
160:     ) external view override returns (bool) {

166:     function proveL2LogInclusion(
167:         uint256 _chainId,
168:         uint256 _batchNumber,
169:         uint256 _index,
170:         L2Log memory _log,
171:         bytes32[] calldata _proof
172:     ) external view override returns (bool) {

178:     function proveL1ToL2TransactionStatus(
179:         uint256 _chainId,
180:         bytes32 _l2TxHash,
181:         uint256 _l2BatchNumber,
182:         uint256 _l2MessageIndex,
183:         uint16 _l2TxNumberInBatch,
184:         bytes32[] calldata _merkleProof,
185:         TxStatus _status
186:     ) external view override returns (bool) {

219:     function requestL2TransactionDirect(
220:         L2TransactionRequestDirect calldata _request
221:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash) {

264:     function requestL2TransactionTwoBridges(
265:         L2TransactionRequestTwoBridgesOuter calldata _request
266:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash) {
```

- *StateTransitionManager.sol* ( [76-76](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L76-L76) ):

```solidity
76:     function getChainAdmin(uint256 _chainId) external view override returns (address) {
```

- *BaseZkSyncUpgradeGenesis.sol* ( [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L22-L22), [49-49](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L49-L49) ):

```solidity
22:     function _setNewProtocolVersion(uint256 _newProtocolVersion) internal override {

49:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual override returns (bytes32) {
```

- *DefaultUpgrade.sol* ( [15-15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L15-L15) ):

```solidity
15:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
```

- *L2SharedBridge.sol* ( [81-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L81-L87), [125-125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L125-L125), [151-151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L151-L151) ):

```solidity
81:     function finalizeDeposit(
82:         address _l1Sender,
83:         address _l2Receiver,
84:         address _l1Token,
85:         uint256 _amount,
86:         bytes calldata _data
87:     ) external payable override {

125:     function withdraw(address _l1Receiver, address _l2Token, uint256 _amount) external override {

151:     function l2TokenAddress(address _l1Token) public view override returns (address) {
```

- *L2StandardERC20.sol* ( [147-147](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L147-L147), [156-156](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L156-L156), [161-161](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L161-L161), [167-167](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L167-L167), [173-173](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L173-L173) ):

```solidity
147:     function bridgeMint(address _to, uint256 _amount) external override onlyBridge {

156:     function bridgeBurn(address _from, uint256 _amount) external override onlyBridge {

161:     function name() public view override returns (string memory) {

167:     function symbol() public view override returns (string memory) {

173:     function decimals() public view override returns (uint8) {
```

- *AccountCodeStorage.sol* ( [35-35](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L35-L35), [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L46-L46), [54-54](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L54-L54), [78-78](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L78-L78), [89-89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L89-L89), [117-117](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L117-L117) ):

```solidity
35:     function storeAccountConstructingCodeHash(address _address, bytes32 _hash) external override onlyDeployer {

46:     function storeAccountConstructedCodeHash(address _address, bytes32 _hash) external override onlyDeployer {

54:     function markAccountCodeHashAsConstructed(address _address) external override onlyDeployer {

78:     function getRawCodeHash(address _address) public view override returns (bytes32 codeHash) {

89:     function getCodeHash(uint256 _input) external view override returns (bytes32) {

117:     function getCodeSize(uint256 _input) external view override returns (uint256 codeSize) {
```

- *BootloaderUtilities.sol* ( [24-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L24-L26) ):

```solidity
24:     function getTransactionHashes(
25:         Transaction calldata _transaction
26:     ) external view override returns (bytes32 txHash, bytes32 signedTxHash) {
```

- *ContractDeployer.sol* ( [95-100](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L95-L100), [115-118](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L115-L118), [132-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L132-L136), [147-151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L147-L151), [162-167](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L162-L167), [182-187](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L182-L187) ):

```solidity
95:     function getNewAddressCreate2(
96:         address _sender,
97:         bytes32 _bytecodeHash,
98:         bytes32 _salt,
99:         bytes calldata _input
100:     ) public view override returns (address newAddress) {

115:     function getNewAddressCreate(
116:         address _sender,
117:         uint256 _senderNonce
118:     ) public pure override returns (address newAddress) {

132:     function create2(
133:         bytes32 _salt,
134:         bytes32 _bytecodeHash,
135:         bytes calldata _input
136:     ) external payable override returns (address) {

147:     function create(
148:         bytes32 _salt,
149:         bytes32 _bytecodeHash,
150:         bytes calldata _input
151:     ) external payable override returns (address) {

162:     function create2Account(
163:         bytes32 _salt,
164:         bytes32 _bytecodeHash,
165:         bytes calldata _input,
166:         AccountAbstractionVersion _aaVersion
167:     ) public payable override onlySystemCall returns (address) {

182:     function createAccount(
183:         bytes32, // salt
184:         bytes32 _bytecodeHash,
185:         bytes calldata _input,
186:         AccountAbstractionVersion _aaVersion
187:     ) public payable override onlySystemCall returns (address) {
```

- *DefaultAccount.sol* ( [67-71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L67-L71), [112-116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L112-L116), [125-125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L125-L125) ):

```solidity
67:     function validateTransaction(
68:         bytes32, // _txHash
69:         bytes32 _suggestedSignedHash,
70:         Transaction calldata _transaction
71:     ) external payable override ignoreNonBootloader ignoreInDelegateCall returns (bytes4 magic) {

112:     function executeTransaction(
113:         bytes32, // _txHash
114:         bytes32, // _suggestedSignedHash
115:         Transaction calldata _transaction
116:     ) external payable override ignoreNonBootloader ignoreInDelegateCall {

125:     function executeTransactionFromOutside(Transaction calldata _transaction) external payable override {
```

- *ImmutableSimulator.sol* ( [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L27-L27), [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L34-L34) ):

```solidity
27:     function getImmutable(address _dest, uint256 _index) external view override returns (bytes32) {

34:     function setImmutables(address _dest, ImmutableData[] calldata _immutables) external override {
```

- *KnownCodesStorage.sol* ( [65-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L65-L65) ):

```solidity
65:     function getMarker(bytes32 _hash) public view override returns (uint256 marker) {
```

- *L1Messenger.sol* ( [116-116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L116-L116), [161-163](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L161-L163) ):

```solidity
116:     function sendToL1(bytes calldata _message) external override returns (bytes32 hash) {

161:     function requestBytecodeL1Publication(
162:         bytes32 _bytecodeHash
163:     ) external override onlyCallFrom(address(KNOWN_CODE_STORAGE_CONTRACT)) {
```

- *L2BaseToken.sol* ( [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L32-L32), [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L56-L56), [64-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L64-L64), [72-72](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L72-L72), [85-85](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L85-L85), [128-128](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L128-L128), [134-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L134-L134), [140-140](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L140-L140) ):

```solidity
32:     function transferFromTo(address _from, address _to, uint256 _amount) external override {

56:     function balanceOf(uint256 _account) external view override returns (uint256) {

64:     function mint(address _account, uint256 _amount) external override onlyCallFromBootloader {

72:     function withdraw(address _l1Receiver) external payable override {

85:     function withdrawWithMessage(address _l1Receiver, bytes memory _additionalData) external payable override {

128:     function name() external pure override returns (string memory) {

134:     function symbol() external pure override returns (string memory) {

140:     function decimals() external pure override returns (uint8) {
```

</details>

### [N-12] Unused events

The following `event`s are defined but not used. It is recommended to check the code for logical omissions that cause them not to be used. If it's determined that they are not needed anywhere, it's best to remove them from the codebase to improve code clarity and minimize confusion.
Note that there may be cases where an event appears to be used because it has multiple definitions in different files. In such cases, the definitions should be moved to a separate file.

There are 5 instances:

- *IMailbox.sol* ( [136-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L136-L136) ):

```solidity
136:     event EthWithdrawalFinalized(address indexed to, uint256 amount);
```

- *IZkSyncStateTransition.sol* ( [19-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L19-L23) ):

```solidity
19:     event ProposeTransparentUpgrade(
20:         Diamond.DiamondCutData diamondCut,
21:         uint256 indexed proposalId,
22:         bytes32 proposalSalt
23:     );
```

- *IL2SharedBridge.sol* ( [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L24-L24) ):

```solidity
24:     event BaseTokenReceived(uint256 amount);
```

- *IL2StandardToken.sol* ( [6-6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L6-L6), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L8-L8) ):

```solidity
6:     event BridgeMint(address indexed _account, uint256 _amount);

8:     event BridgeBurn(address indexed _account, uint256 _amount);
```

### [N-13] Unused `struct`s

Note that there may be cases where a struct superficially appears to be used, but this is only because there are multiple definitions of the struct in different files. In such cases, the struct definition should be moved into a separate file. The instances below are the unused definitions.

There is 1 instance:

- *IDiamondInit.sol* ( [53](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L53) ):

```solidity
53: struct InitializeDataNewChain {
```

### [N-14] Custom errors should be used rather than `revert()`/`require()`

Custom errors are available from solidity version 0.8.4. Custom errors are more easily processed in try-catch blocks, and are easier to re-use and maintain.

<details>
<summary>There are 340 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [66-66](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L66-L66), [68-68](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L68-L68), [143-143](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L143-L143), [145-145](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L145-L145), [188-188](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L188-L188), [217-217](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L217-L217) ):

```solidity
66:         require(msg.sender == address(sharedBridge), "Not shared bridge");

68:         require(amount == _amount, "Incorrect amount");

143:         require(_amount != 0, "0T"); // empty deposit

145:         require(amount == _amount, "3T"); // The token has non-standard transfer logic

188:         require(amount != 0, "2T"); // empty deposit

217:         require(!isWithdrawalFinalized[_l2BatchNumber][_l2MessageIndex], "pw");
```

- *L1SharedBridge.sol* ( [71-71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L71-L71), [77-80](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L77-L80), [86-86](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L86-L86), [110-110](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L110-L110), [123-123](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L123-L123), [131-131](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L131-L131), [134-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L134-L134), [140-140](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L140-L140), [157-157](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L157-L157), [160-160](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L160-L160), [163-163](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L163-L163), [190-190](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L190-L190), [196-196](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L196-L196), [197-197](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L197-L197), [202-202](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L202-L202), [204-204](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L204-L204), [208-208](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L208-L208), [210-210](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L210-L210), [239-239](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L239-L239), [327-327](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L327-L327), [329-329](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L329-L329), [344-344](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L344-L344), [351-351](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L351-L351), [362-362](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L362-L362), [398-398](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L398-L398), [419-419](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L419-L419), [429-429](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L429-L429), [441-441](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L441-L441), [451-451](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L451-L451), [486-486](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L486-L486), [503-503](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L503-L503), [519-519](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L519-L519), [524-524](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L524-L524), [565-565](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L565-L565), [566-566](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L566-L566) ):

```solidity
71:         require(msg.sender == address(bridgehub), "ShB not BH");

77:         require(
78:             msg.sender == address(bridgehub) || (_chainId == ERA_CHAIN_ID && msg.sender == ERA_DIAMOND_PROXY),
79:             "L1SharedBridge: not bridgehub or era chain"
80:         );

86:         require(msg.sender == address(legacyBridge), "ShB not legacy bridge");

110:         require(_owner != address(0), "ShB owner 0");

123:             require(balanceAfter > balanceBefore, "ShB: 0 eth transferred");

131:             require(amount > 0, "ShB: 0 amount to transfer");

134:             require(balanceAfter - balanceBefore == amount, "ShB: wrong amount transferred");

140:         require(bridgehub.getStateTransition(_chainId) == msg.sender, "receiveEth not state transition");

157:             require(msg.value == _amount, "L1SharedBridge: msg.value not equal to amount");

160:             require(msg.value == 0, "ShB m.v > 0 b d.it");

163:             require(amount == _amount, "3T"); // The token has non-standard transfer logic

190:         require(l2BridgeAddress[_chainId] != address(0), "ShB l2 bridge not deployed");

196:         require(_l1Token != l1WethAddress, "ShB: WETH deposit not supported");

197:         require(bridgehub.baseToken(_chainId) != _l1Token, "ShB: baseToken deposit not supported");

202:             require(_depositAmount == 0, "ShB wrong withdraw amount");

204:             require(msg.value == 0, "ShB m.v > 0 for BH d.it 2");

208:             require(withdrawAmount == _depositAmount, "5T"); // The token has non-standard transfer logic

210:         require(amount != 0, "6T"); // empty deposit amount

239:         require(depositHappened[_chainId][_txHash] == 0x00, "ShB tx hap");

327:             require(proofValid, "yn");

329:         require(_amount > 0, "y1");

344:                 require(dataHash == txDataHash, "ShB: d.it not hap");

351:             require(chainBalance[_chainId][_l1Token] >= _amount, "ShB n funds");

362:             require(callSuccess, "ShB: claimFailedDeposit failed");

398:             require(!legacyBridge.isWithdrawalFinalized(_l2BatchNumber, _l2MessageIndex), "ShB: legacy withdrawal");

419:         require(!isWithdrawalFinalized[_chainId][_l2BatchNumber][_l2MessageIndex], "Withdrawal is already finalized");

429:             require(!alreadyFinalized, "Withdrawal is already finalized 2");

441:             require(chainBalance[_chainId][l1Token] >= amount, "ShB not enough funds 2"); // not enought funds

451:             require(callSuccess, "ShB: withdraw failed");

486:         require(success, "ShB withd w proof"); // withdrawal wrong proof

503:         require(_l2ToL1message.length >= 56, "ShB wrong msg len"); // wrong messsage length

519:             require(_l2ToL1message.length == 76, "ShB wrong msg len 2");

524:             revert("ShB Incorrect message function selector");

565:         require(l2BridgeAddress[ERA_CHAIN_ID] != address(0), "ShB b. n dep");

566:         require(_l1Token != l1WethAddress, "ShB: WETH deposit not supported 2");
```

- *Bridgehub.sol* ( [48-48](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L48-L48), [64-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L64-L64), [85-88](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L85-L88), [95-98](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L95-L98), [104-104](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L104-L104), [124-124](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L124-L124), [125-125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L125-L125), [127-130](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L127-L130), [131-131](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L131-L131), [132-132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L132-L132), [134-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L134-L134), [225-225](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L225-L225), [227-227](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L227-L227), [271-274](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L271-L274), [277-277](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L277-L277), [298-298](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L298-L298), [302-305](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L302-L305) ):

```solidity
48:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin");

64:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights

85:         require(
86:             !stateTransitionManagerIsRegistered[_stateTransitionManager],
87:             "Bridgehub: state transition already registered"
88:         );

95:         require(
96:             stateTransitionManagerIsRegistered[_stateTransitionManager],
97:             "Bridgehub: state transition not registered yet"
98:         );

104:         require(!tokenIsRegistered[_token], "Bridgehub: token already registered");

124:         require(_chainId != 0, "Bridgehub: chainId cannot be 0");

125:         require(_chainId <= type(uint48).max, "Bridgehub: chainId too large");

127:         require(
128:             stateTransitionManagerIsRegistered[_stateTransitionManager],
129:             "Bridgehub: state transition not registered"
130:         );

131:         require(tokenIsRegistered[_baseToken], "Bridgehub: token not registered");

132:         require(address(sharedBridge) != address(0), "Bridgehub: weth bridge not set");

134:         require(stateTransitionManager[_chainId] == address(0), "Bridgehub: chainId already registered");

225:                 require(msg.value == _request.mintValue, "Bridgehub: msg.value mismatch 1");

227:                 require(msg.value == 0, "Bridgehub: non-eth bridge with msg.value");

271:                 require(
272:                     msg.value == _request.mintValue + _request.secondBridgeValue,
273:                     "Bridgehub: msg.value mismatch 2"
274:                 );

277:                 require(msg.value == _request.secondBridgeValue, "Bridgehub: msg.value mismatch 3");

298:         require(outputRequest.magicValue == TWO_BRIDGES_MAGIC_VALUE, "Bridgehub: magic value mismatch");

302:         require(
303:             _request.secondBridgeAddress > BRIDGEHUB_MIN_SECOND_BRIDGE_ADDRESS,
304:             "Bridgehub: second bridge address too low"
305:         ); // to avoid calls to precompiles
```

- *ReentrancyGuard.sol* ( [60-60](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L60-L60), [77-77](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L77-L77) ):

```solidity
60:         require(lockSlotOldValue == 0, "1B");

77:         require(_status == _NOT_ENTERED, "r1");
```

- *L2ContractHelper.sol* ( [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L25-L25), [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L28-L28), [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L29-L29), [43-43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L43-L43), [45-45](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L45-L45) ):

```solidity
25:         require(_bytecode.length % 32 == 0, "pq");

28:         require(bytecodeLenInWords < 2 ** 16, "pp"); // bytecode length must be less than 2^16 words

29:         require(bytecodeLenInWords % 2 == 1, "ps"); // bytecode length in words must be odd

43:         require(version == 1 && _bytecodeHash[1] == bytes1(0), "zf"); // Incorrectly formatted bytecodeHash

45:         require(bytecodeLen(_bytecodeHash) % 2 == 1, "uy"); // Code length in words must be odd
```

- *Governance.sol* ( [44-44](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L44-L44), [61-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L61-L61), [67-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L67-L67), [73-76](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L73-L76), [157-157](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L157-L157), [174-174](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L174-L174), [179-179](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L179-L179), [193-193](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L193-L193), [198-198](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L198-L198), [218-218](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L218-L218), [219-219](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L219-L219), [242-242](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L242-L242) ):

```solidity
44:         require(_admin != address(0), "Admin should be non zero address");

61:         require(msg.sender == address(this), "Only governance contract itself is allowed to call this function");

67:         require(msg.sender == securityCouncil, "Only security council is allowed to call this function");

73:         require(
74:             msg.sender == owner() || msg.sender == securityCouncil,
75:             "Only the owner and security council are allowed to call this function"
76:         );

157:         require(isOperationPending(_id), "Operation must be pending");

174:         require(isOperationReady(id), "Operation must be ready before execution");

179:         require(isOperationReady(id), "Operation must be ready after execution");

193:         require(isOperationPending(id), "Operation must be pending before execution");

198:         require(isOperationPending(id), "Operation must be pending after execution");

218:         require(!isOperation(_id), "Operation with this proposal id already exists");

219:         require(_delay >= minDelay, "Proposed delay is less than minimum delay");

242:         require(_predecessorId == bytes32(0) || isOperationDone(_predecessorId), "Predecessor operation not completed");
```

- *StateTransitionManager.sol* ( [66-66](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L66-L66), [72-72](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L72-L72), [84-84](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L84-L84), [123-123](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L123-L123), [258-258](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L258-L258) ):

```solidity
66:         require(msg.sender == bridgehub, "StateTransition: only bridgehub");

72:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin");

84:         require(_initializeData.governor != address(0), "StateTransition: governor zero");

123:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights

258:         require(cutHashInput == initialCutHash, "StateTransition: initial cutHash mismatch");
```

- *ValidatorTimelock.sol* ( [64-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L64-L64), [70-70](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L70-L70), [197-197](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L197-L197), [219-219](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L219-L219) ):

```solidity
64:         require(msg.sender == stateTransitionManager.getChainAdmin(_chainId), "ValidatorTimelock: only chain admin");

70:         require(validators[_chainId][msg.sender] == true, "ValidatorTimelock: only validator");

197:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c"); // The delay is not passed

219:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c"); // The delay is not passed
```

- *DiamondInit.sol* ( [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L27-L27), [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L28-L28), [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L29-L29), [30-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L30-L30) ):

```solidity
27:         require(address(_initializeData.verifier) != address(0), "vt");

28:         require(_initializeData.admin != address(0), "vy");

29:         require(_initializeData.validatorTimelock != address(0), "hc");

30:         require(_initializeData.priorityTxMaxGasLimit <= MAX_GAS_PER_TRANSACTION, "vu");
```

- *DiamondProxy.sol* ( [16-16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L16-L16), [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L27-L27), [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L32-L32), [33-33](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L33-L33) ):

```solidity
16:         require(_chainId == block.chainid, "pr");

27:         require(msg.data.length >= 4 || msg.data.length == 0, "Ut");

32:         require(facetAddress != address(0), "F"); // Proxy has no facet for this selector

33:         require(!diamondStorage.isFrozen || !facet.isFreezable, "q1"); // Facet is frozen
```

- *Admin.sol* ( [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L36-L36), [61-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L61-L61), [72-72](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L72-L72), [92-92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L92-L92), [107-110](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L107-L110), [112-115](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L112-L115), [118-121](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L118-L121), [138-138](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L138-L138), [148-148](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L148-L148) ):

```solidity
36:         require(msg.sender == pendingAdmin, "n4"); // Only proposed by current admin address can claim the admin rights

61:         require(_newPriorityTxMaxGasLimit <= MAX_GAS_PER_TRANSACTION, "n5");

72:         require(_newFeeParams.maxPubdataPerBatch >= _newFeeParams.priorityTxMaxPubdata, "n6");

92:         require(s.totalBatchesCommitted == 0, "AdminFacet: set validium only after genesis"); // Validium mode can be set only before the first batch is committed

107:         require(
108:             cutHashInput == IStateTransitionManager(s.stateTransitionManager).upgradeCutHash(_oldProtocolVersion),
109:             "StateTransition: cutHash mismatch"
110:         );

112:         require(
113:             s.protocolVersion == _oldProtocolVersion,
114:             "StateTransition: protocolVersion mismatch in STC when upgrading"
115:         );

118:         require(
119:             s.protocolVersion > _oldProtocolVersion,
120:             "StateTransition: protocolVersion mismatch in STC after upgrading"
121:         );

138:         require(!diamondStorage.isFrozen, "a9"); // diamond proxy is frozen already

148:         require(diamondStorage.isFrozen, "a7"); // diamond proxy is not frozen
```

- *Executor.sol* ( [39-39](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L39-L39), [42-42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L42-L42), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L52-L52), [53-53](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L53-L53), [63-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L63-L67), [76-76](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L76-L76), [78-78](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L78-L78), [80-80](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L80-L80), [112-112](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L112-L112), [116-116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L116-L116), [124-124](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L124-L124), [125-125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L125-L125), [151-151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L151-L151), [156-156](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L156-L156), [159-159](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L159-L159), [162-162](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L162-L162), [165-165](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L165-L165), [168-168](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L168-L168), [171-171](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L171-L171), [174-174](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L174-L174), [177-177](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L177-L177), [180-180](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L180-L180), [183-183](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L183-L183), [184-184](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L184-L184), [186-186](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L186-L186), [194-194](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L194-L194), [196-196](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L196-L196), [228-231](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L228-L231), [233-233](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L233-L233), [235-235](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L235-L235), [286-286](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L286-L286), [325-325](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L325-L325), [326-329](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L326-L329), [332-332](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L332-L332), [360-360](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L360-L360), [404-404](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L404-L404), [409-412](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L409-L412), [423-423](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L423-L423), [440-440](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L440-L440), [447-447](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L447-L447), [480-480](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L480-L480), [481-481](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L481-L481), [541-541](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L541-L541), [565-565](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L565-L565), [566-566](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L566-L566), [614-614](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L614-L614), [616-616](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L616-L616), [629-629](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L629-L629), [630-630](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L630-L630), [631-631](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L631-L631), [637-637](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L637-L637), [661-661](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L661-L661), [666-670](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L666-L670), [679-679](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L679-L679) ):

```solidity
39:         require(_newBatch.batchNumber == _previousBatch.batchNumber + 1, "f"); // only commit next batch

42:         require(pubdataSource == uint8(PubdataSource.Calldata) || pubdataSource == uint8(PubdataSource.Blob), "us");

52:             require(logOutput.pubdataHash == 0x00, "v0h");

53:             require(_newBatch.pubdataCommitments.length == 1);

63:             require(
64:                 logOutput.pubdataHash ==
65:                     keccak256(_newBatch.pubdataCommitments[1:_newBatch.pubdataCommitments.length - 32]),
66:                 "wp"
67:             );

76:         require(_previousBatch.batchHash == logOutput.previousBatchHash, "l");

78:         require(logOutput.chainedPriorityTxsHash == _newBatch.priorityOperationsHash, "t");

80:         require(logOutput.numberOfLayer1Txs == _newBatch.numberOfLayer1Txs, "ta");

112:         require(batchTimestamp == _expectedBatchTimestamp, "tb");

116:         require(_previousBatchTimestamp < batchTimestamp, "h3");

124:         require(block.timestamp - COMMIT_TIMESTAMP_NOT_OLDER <= batchTimestamp, "h1"); // New batch timestamp is too small

125:         require(lastL2BlockTimestamp <= block.timestamp + COMMIT_TIMESTAMP_APPROXIMATION_DELTA, "h2"); // The last L2 block timestamp is too big

151:             require(!_checkBit(processedLogs, uint8(logKey)), "kp");

156:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "lm");

159:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "ln");

162:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "lb");

165:                 require(logSender == L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, "sc");

168:                 require(logSender == L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, "sv");

171:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bl");

174:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bk");

177:                 require(logSender == L2_PUBDATA_CHUNK_PUBLISHER_ADDR, "pc");

180:                 require(logSender == L2_PUBDATA_CHUNK_PUBLISHER_ADDR, "pd");

183:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bu");

184:                 require(_expectedSystemContractUpgradeTxHash == logValue, "ut");

186:                 revert("ul");

194:             require(processedLogs == 511, "b7");

196:             require(processedLogs == 1023, "b8");

228:         require(
229:             IStateTransitionManager(s.stateTransitionManager).protocolVersion() == s.protocolVersion,
230:             "Executor facet: wrong protocol version"
231:         );

233:         require(_newBatchesData.length == 1, "e4");

235:         require(s.storedBatchHashes[s.totalBatchesCommitted] == _hashStoredBatchInfo(_lastCommittedBatchData), "i"); // incorrect previous batch data

286:         require(s.l2SystemContractsUpgradeBatchNumber == 0, "ik");

325:         require(currentBatchNumber == s.totalBatchesExecuted + _executedBatchIdx + 1, "k"); // Execute batches in order

326:         require(
327:             _hashStoredBatchInfo(_storedBatch) == s.storedBatchHashes[currentBatchNumber],
328:             "exe10" // executing batch should be committed
329:         );

332:         require(priorityOperationsHash == _storedBatch.priorityOperationsHash, "x"); // priority operations hash does not match to expected

360:         require(newTotalBatchesExecuted <= s.totalBatchesVerified, "n"); // Can't execute batches more than committed and proven currently.

404:         require(_hashStoredBatchInfo(_prevBatch) == s.storedBatchHashes[currentTotalBatchesVerified], "t1");

409:             require(
410:                 _hashStoredBatchInfo(_committedBatches[i]) == s.storedBatchHashes[currentTotalBatchesVerified],
411:                 "o1"
412:             );

423:         require(currentTotalBatchesVerified <= s.totalBatchesCommitted, "q");

440:         require(proofPublicInput.length == 1, "t4");

447:         require(successVerifyProof, "p"); // Proof verification fail

480:         require(s.totalBatchesCommitted > _newLastBatch, "v1"); // The last committed batch is less than new last batch

481:         require(_newLastBatch >= s.totalBatchesExecuted, "v2"); // Already executed batches cannot be reverted

541:         require(_batch.systemLogs.length <= MAX_L2_TO_L1_LOGS_COMMITMENT_BYTES, "pu");

565:         require(_blobCommitments.length == MAX_NUMBER_OF_BLOBS, "b10");

566:         require(_blobHashes.length == MAX_NUMBER_OF_BLOBS, "b11");

614:         require(success, "failed to call point evaluation precompile");

616:         require(result == BLS_MODULUS, "precompile unexpected output");

629:         require(_pubdataCommitments.length > 0, "pl");

630:         require(_pubdataCommitments.length <= PUBDATA_COMMITMENT_SIZE * MAX_NUMBER_OF_BLOBS, "bd");

631:         require(_pubdataCommitments.length % PUBDATA_COMMITMENT_SIZE == 0, "bs");

637:             require(blobVersionedHash != bytes32(0), "vh");

661:         require(versionedHash == bytes32(0), "lh");

666:             require(
667:                 (_blobHashes[i] == bytes32(0) && blobCommitments[i] == bytes32(0)) ||
668:                     (_blobHashes[i] != bytes32(0) && blobCommitments[i] != bytes32(0)),
669:                 "bh"
670:             );

679:         require(success, "vc");
```

- *Getters.sol* ( [185-185](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L185-L185) ):

```solidity
185:         require(ds.selectorToFacet[_selector].facetAddress != address(0), "g2");
```

- *Mailbox.sol* ( [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L41-L41), [112-112](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L112-L112), [119-119](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L119-L119), [160-160](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L160-L160), [187-187](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L187-L187), [208-208](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L208-L208), [245-245](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L245-L245), [266-266](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L266-L266), [274-274](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L274-L274) ):

```solidity
41:         require(s.chainId == ERA_CHAIN_ID, "transferEthToSharedBridge only available for Era on mailbox");

112:         require(_batchNumber <= s.totalBatchesExecuted, "xx");

119:         require(hashedLog != L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH, "tw");

160:         require(s.baseTokenGasPriceMultiplierDenominator > 0, "Mailbox: baseTokenGasPriceDenominator not set");

187:         require(s.chainId == ERA_CHAIN_ID, "finalizeEthWithdrawal only available for Era on mailbox");

208:         require(s.chainId == ERA_CHAIN_ID, "legacy interface only available for era token");

245:         require(_request.l2GasPerPubdataByteLimit == REQUIRED_L2_GAS_PRICE_PER_PUBDATA, "qp");

266:         require(_factoryDeps.length <= MAX_NEW_FACTORY_DEPS, "uj");

274:         require(_mintValue >= baseCost + _params.l2Value, "mv"); // The `msg.value` doesn't cover the transaction cost
```

- *ZkSyncStateTransitionBase.sol* ( [18-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L18-L18), [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L24-L24), [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L29-L29), [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L34-L34), [39-42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L39-L42), [47-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L47-L50), [55-55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L55-L55) ):

```solidity
18:         require(msg.sender == s.admin, "StateTransition Chain: not admin");

24:         require(s.validators[msg.sender], "StateTransition Chain: not validator");

29:         require(msg.sender == s.stateTransitionManager, "StateTransition Chain: not state transition manager");

34:         require(msg.sender == s.bridgehub, "StateTransition Chain: not bridgehub");

39:         require(
40:             msg.sender == s.admin || msg.sender == s.stateTransitionManager,
41:             "StateTransition Chain: Only by admin or state transition manager"
42:         );

47:         require(
48:             s.validators[msg.sender] || msg.sender == s.stateTransitionManager,
49:             "StateTransition Chain: Only by validator or state transition manager"
50:         );

55:         require(msg.sender == s.baseTokenBridge, "Only shared bridge can call this function");
```

- *Diamond.sol* ( [109-109](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L109-L109), [118-118](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L118-L118), [134-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L134-L134), [143-143](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L143-L143), [157-157](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L157-L157), [163-163](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L163-L163), [177-177](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L177-L177), [183-183](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L183-L183), [217-217](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L217-L217), [282-282](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L282-L282), [289-289](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L289-L289), [299-299](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L299-L299), [300-300](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L300-L300) ):

```solidity
109:             require(selectors.length > 0, "B"); // no functions for diamond cut

118:                 revert("C"); // undefined diamond cut action

134:         require(_facet.code.length > 0, "G");

143:             require(oldFacet.facetAddress == address(0), "J"); // facet for this selector already exists

157:         require(_facet.code.length > 0, "K");

163:             require(oldFacet.facetAddress != address(0), "L"); // it is impossible to replace the facet with zero address

177:         require(_facet == address(0), "a1"); // facet address must be zero

183:             require(oldFacet.facetAddress != address(0), "a2"); // Can't delete a non-existent facet

217:             require(_isSelectorFreezable == ds.selectorToFacet[selector0].isFreezable, "J1");

282:             require(_calldata.length == 0, "H"); // Non-empty calldata for zero address

289:                     revert("I"); // delegatecall failed

299:             require(data.length == 32, "lp");

300:             require(abi.decode(data, (bytes32)) == DIAMOND_INIT_SUCCESS_RETURN_VALUE, "lp1");
```

- *Merkle.sol* ( [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L26-L26), [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L27-L27), [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L28-L28) ):

```solidity
26:         require(pathLength > 0, "xc");

27:         require(pathLength < 256, "bt");

28:         require(_index < (1 << pathLength), "px");
```

- *PriorityQueue.sol* ( [67-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L67-L67), [75-75](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L75-L75) ):

```solidity
67:         require(!_queue.isEmpty(), "D"); // priority queue is empty

75:         require(!_queue.isEmpty(), "s"); // priority queue is empty
```

- *TransactionValidator.sol* ( [30-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L30-L30), [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L32-L32), [36-43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L36-L43), [50-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L50-L50), [51-51](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L51-L51), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L52-L52), [53-53](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L53-L53), [54-54](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L54-L54), [55-55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L55-L55), [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L56-L56), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L57-L57), [58-58](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L58-L58), [59-59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L59-L59), [60-60](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L60-L60), [61-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L61-L61), [62-62](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L62-L62), [117-117](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L117-L117) ):

```solidity
30:         require(l2GasForTxBody <= _priorityTxMaxGasLimit, "ui");

32:         require(l2GasForTxBody / _transaction.gasPerPubdataByteLimit <= _priorityTxMaxPubdata, "uk");

36:         require(
37:             getMinimalPriorityTransactionGasLimit(
38:                 _encoded.length,
39:                 _transaction.factoryDeps.length,
40:                 _transaction.gasPerPubdataByteLimit
41:             ) <= l2GasForTxBody,
42:             "up"
43:         );

50:         require(_transaction.from <= type(uint16).max, "ua");

51:         require(_transaction.to <= type(uint160).max, "ub");

52:         require(_transaction.paymaster == 0, "uc");

53:         require(_transaction.value == 0, "ud");

54:         require(_transaction.maxFeePerGas == 0, "uq");

55:         require(_transaction.maxPriorityFeePerGas == 0, "ux");

56:         require(_transaction.reserved[0] == 0, "ue");

57:         require(_transaction.reserved[1] <= type(uint160).max, "uf");

58:         require(_transaction.reserved[2] == 0, "ug");

59:         require(_transaction.reserved[3] == 0, "uo");

60:         require(_transaction.signature.length == 0, "uh");

61:         require(_transaction.paymasterInput.length == 0, "ul1");

62:         require(_transaction.reservedDynamic.length == 0, "um");

117:         require(_totalGasLimit >= overhead, "my"); // provided gas limit doesn't cover transaction overhead
```

</details>

### [N-15] Use `uint256`/`int256` instead of `uint`/`int`

It is recommended to use `uint256`/`int256` instead of `uint`/`int` in function parameters, since they are used for function signatures.

There is 1 instance:

- *Executor.sol* ( [578-578](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L578-L578) ):

```solidity
/// @audit uint i
578:         for (uint i = 0; i < MAX_NUMBER_OF_BLOBS; i++) {
```

### [N-16] Large numeric literals should use underscores for readability

Large hardcoded numbers in code can be difficult to read. Consider using underscores for number literals to improve readability (e.g `1234567` -> `1_234_567`). Consider using an underscore for every third digit from the right.

<details>
<summary>There are 14 instances (click to show):</summary>

- *Config.sol* ( [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L52-L52), [59-59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L59-L59), [65-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L65-L65), [68-68](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L68-L68), [71-71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L71-L71), [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L94-L94), [109-109](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L109-L109) ):

```solidity
52: uint256 constant MAX_GAS_PER_TRANSACTION = 80000000;

59: uint256 constant L1_TX_INTRINSIC_L2_GAS = 167157;

65: uint256 constant L1_TX_MIN_L2_GAS_BASE = 173484;

68: uint256 constant L1_TX_DELTA_544_ENCODING_BYTES = 1656;

71: uint256 constant L1_TX_DELTA_FACTORY_DEPS_L2_GAS = 2473;

94: uint256 constant TX_SLOT_OVERHEAD_L2_GAS = 10000;

109: address constant ERA_ERC20_BRIDGE_ADDRESS = address(1233);
```

- *StateTransitionManager.sol* ( [188-188](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L188-L188) ):

```solidity
188:             gasLimit: 72000000,
```

- *Executor.sol* ( [196-196](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L196-L196) ):

```solidity
196:             require(processedLogs == 1023, "b8");
```

- *IExecutor.sol* ( [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L52-L52) ):

```solidity
52: uint256 constant BLS_MODULUS = 52435875175126190479447740508185965837690552500527637822603658699938581184513;
```

- *Constants.sol* ( [108-108](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L108-L108), [125-125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L125-L125) ):

```solidity
108: uint256 constant MAX_ALLOWED_PUBDATA_PER_BATCH = 520000;

125: uint256 constant L2_TO_L1_LOGS_MERKLE_TREE_LEAVES = 4096;
```

- *MsgValueSimulator.sol* ( [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L36-L36), [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L41-L41) ):

```solidity
36:     uint256 constant GAS_TO_PASS = 2300;

41:     uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000;
```

</details>

### [N-17] Add inline comments for unnamed parameters

`function func(address a, address)` -> `function func(address a, address /* b */)`

<details>
<summary>There are 9 instances (click to show):</summary>

- *ValidatorTimelock.sol* ( [110-113](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L110-L113), [128-132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L128-L132), [148-148](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L148-L148), [155-155](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L155-L155), [162-166](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L162-L166), [173-178](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L173-L178) ):

```solidity
110:     function commitBatches(
111:         StoredBatchInfo calldata,
112:         CommitBatchInfo[] calldata _newBatchesData
113:     ) external onlyValidator(ERA_CHAIN_ID) {

128:     function commitBatchesSharedBridge(
129:         uint256 _chainId,
130:         StoredBatchInfo calldata,
131:         CommitBatchInfo[] calldata _newBatchesData
132:     ) external onlyValidator(_chainId) {

148:     function revertBatches(uint256) external onlyValidator(ERA_CHAIN_ID) {

155:     function revertBatchesSharedBridge(uint256 _chainId, uint256) external onlyValidator(_chainId) {

162:     function proveBatches(
163:         StoredBatchInfo calldata,
164:         StoredBatchInfo[] calldata,
165:         ProofInput calldata
166:     ) external onlyValidator(ERA_CHAIN_ID) {

173:     function proveBatchesSharedBridge(
174:         uint256 _chainId,
175:         StoredBatchInfo calldata,
176:         StoredBatchInfo[] calldata,
177:         ProofInput calldata
178:     ) external onlyValidator(_chainId) {
```

- *Executor.sol* ( [339-342](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L339-L342), [475-475](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L475-L475) ):

```solidity
339:     function executeBatchesSharedBridge(
340:         uint256,
341:         StoredBatchInfo[] calldata _batchesData
342:     ) external nonReentrant onlyValidator {

475:     function revertBatchesSharedBridge(uint256, uint256 _newLastBatch) external nonReentrant onlyValidator {
```

- *IBaseToken.sol* ( [6-6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBaseToken.sol#L6-L6) ):

```solidity
6:     function balanceOf(uint256) external view returns (uint256);
```

</details>

### [N-18] Consider providing a ranged getter for array state variables

While the compiler automatically provides a getter for accessing single elements within a public state variable array, it doesn't provide a way to fetch the whole array, or subsets thereof. Consider adding a function to allow the fetching of slices of the array, especially if the contract doesn't already have multicall functionality.

There is 1 instance:

- *SystemContext.sol* ( [70-70](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L70-L70) ):

```solidity
70:     bytes32[MINIBLOCK_HASHES_TO_STORE] internal l2BlockHash;
```

### [N-19] Assembly blocks should have extensive comments

Assembly blocks take a lot more time to audit than normal Solidity code, and often have gotchas and side-effects that the Solidity versions of the same code do not. Consider adding more comments explaining what is being done in every step of the assembly code, and describe why assembly is being used instead of Solidity.

<details>
<summary>There are 60 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [359-361](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L359-L361), [448-450](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L448-L450) ):

```solidity
359:             assembly {
360:                 callSuccess := call(gas(), _depositSender, _amount, 0, 0, 0, 0)
361:             }

448:             assembly {
449:                 callSuccess := call(gas(), l1Receiver, amount, 0, 0, 0, 0)
450:             }
```

- *ReentrancyGuard.sol* ( [54-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L54-L57), [72-74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L72-L74), [80-82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L80-L82), [88-90](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L88-L90) ):

```solidity
54:         assembly {
55:             lockSlotOldValue := sload(LOCK_FLAG_ADDRESS)
56:             sstore(LOCK_FLAG_ADDRESS, _NOT_ENTERED)
57:         }

72:         assembly {
73:             _status := sload(LOCK_FLAG_ADDRESS)
74:         }

80:         assembly {
81:             sstore(LOCK_FLAG_ADDRESS, _ENTERED)
82:         }

88:         assembly {
89:             sstore(LOCK_FLAG_ADDRESS, _NOT_ENTERED)
90:         }
```

- *UnsafeBytes.sol* ( [22-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L22-L25), [29-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L29-L32), [36-39](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L36-L39), [43-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L43-L46) ):

```solidity
22:         assembly {
23:             offset := add(_start, 4)
24:             result := mload(add(_bytes, offset))
25:         }

29:         assembly {
30:             offset := add(_start, 20)
31:             result := mload(add(_bytes, offset))
32:         }

36:         assembly {
37:             offset := add(_start, 32)
38:             result := mload(add(_bytes, offset))
39:         }

43:         assembly {
44:             offset := add(_start, 32)
45:             result := mload(add(_bytes, offset))
46:         }
```

- *Governance.sol* ( [231-233](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L231-L233) ):

```solidity
231:                 assembly {
232:                     revert(add(returnData, 0x20), mload(returnData))
233:                 }
```

- *Mailbox.sol* ( [362-364](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L362-L364) ):

```solidity
362:             assembly {
363:                 mstore(add(hashedFactoryDeps, mul(add(i, 1), 32)), hashedBytecode)
364:             }
```

- *Diamond.sol* ( [91-93](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L91-L93), [292-294](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L292-L294) ):

```solidity
91:         assembly {
92:             diamondStorage.slot := position
93:         }

292:                 assembly {
293:                     revert(add(data, 0x20), mload(data))
294:                 }
```

- *Merkle.sol* ( [43-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L43-L47) ):

```solidity
43:         assembly {
44:             mstore(0x00, _lhs)
45:             mstore(0x20, _rhs)
46:             result := keccak256(0x00, 0x40)
47:         }
```

- *SystemContractsCaller.sol* ( [43-45](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L43-L45), [63-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L63-L65), [72-74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L72-L74), [87-89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L87-L89), [92-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L92-L94) ):

```solidity
43:         assembly {
44:             dataStart := add(data, 0x20)
45:         }

63:             assembly {
64:                 success := call(to, callAddr, 0, 0, farCallAbi, 0, 0)
65:             }

72:             assembly {
73:                 success := call(msgValueSimulator, callAddr, value, to, farCallAbi, forwardMask, 0)
74:             }

87:         assembly {
88:             size := returndatasize()
89:         }

92:         assembly {
93:             returndatacopy(add(returnData, 0x20), 0, size)
94:         }
```

- *AccountCodeStorage.sol* ( [70-72](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L70-L72), [81-83](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L81-L83) ):

```solidity
70:         assembly {
71:             sstore(addressAsKey, _hash)
72:         }

81:         assembly {
82:             codeHash := sload(addressAsKey)
83:         }
```

- *ComplexUpgrader.sol* ( [26-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol#L26-L30) ):

```solidity
26:         assembly {
27:             if iszero(success) {
28:                 revert(add(returnData, 0x20), mload(returnData))
29:             }
30:         }
```

- *DefaultAccount.sol* ( [31-33](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L31-L33), [49-51](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L49-L51), [168-172](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L168-L172) ):

```solidity
31:             assembly {
32:                 return(0, 0)
33:             }

49:             assembly {
50:                 return(0, 0)
51:             }

168:         assembly {
169:             r := mload(add(_signature, 0x20))
170:             s := mload(add(_signature, 0x40))
171:             v := and(mload(add(_signature, 0x41)), 0xff)
172:         }
```

- *KnownCodesStorage.sol* ( [55-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L55-L57), [66-68](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L66-L68) ):

```solidity
55:             assembly {
56:                 sstore(_bytecodeHash, 1)
57:             }

66:         assembly {
67:             marker := sload(_hash)
68:         }
```

- *MsgValueSimulator.sol* ( [69-71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L69-L71) ):

```solidity
69:                 assembly {
70:                     revert(0, 0)
71:                 }
```

- *EfficientCall.sol* ( [135-137](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L135-L137), [148-150](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L148-L150), [163-165](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L163-L165), [177-179](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L177-L179), [218-220](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L218-L220), [223-225](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L223-L225), [233-237](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L233-L237), [254-256](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L254-L256) ):

```solidity
135:             assembly {
136:                 success := call(_address, callAddr, 0, 0, 0xFFFF, 0, 0)
137:             }

148:             assembly {
149:                 success := call(msgValueSimulator, callAddr, _value, _address, 0xFFFF, forwardMask, 0)
150:             }

163:         assembly {
164:             success := staticcall(_address, callAddr, 0, 0xFFFF, 0, 0)
165:         }

177:         assembly {
178:             success := delegatecall(_address, callAddr, 0, 0xFFFF, 0, 0)
179:         }

218:             assembly {
219:                 size := returndatasize()
220:             }

223:             assembly {
224:                 returndatacopy(add(returnData, 0x20), 0, size)
225:             }

233:         assembly {
234:             let size := returndatasize()
235:             returndatacopy(0, 0, size)
236:             revert(0, size)
237:         }

254:         assembly {
255:             dataOffset := _data.offset
256:         }
```

- *RLPEncoder.sol* ( [39-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L39-L41), [74-76](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L74-L76) ):

```solidity
39:                 assembly {
40:                     mstore(add(encoded, 0x21), shiftedVal)
41:                 }

74:                 assembly {
75:                     mstore(add(encoded, 0x21), shiftedVal)
76:                 }
```

- *SystemContractHelper.sol* ( [65-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L65-L67), [76-78](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L76-L78), [87-89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L87-L89), [183-185](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L183-L185), [193-195](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L193-L195), [205-207](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L205-L207), [298-300](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L298-L300), [309-311](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L309-L311), [322-324](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L322-L324) ):

```solidity
65:         assembly {
66:             addr := staticcall(0, callAddr, 0, 0xFFFF, 0, 0)
67:         }

76:         assembly {
77:             pop(staticcall(0, callAddr, 0, 0xFFFF, 0, 0))
78:         }

87:         assembly {
88:             pop(staticcall(_farCallAbi, callAddr, 0, 0xFFFF, 0, 0))
89:         }

183:         assembly {
184:             pop(call(initializer, callAddr, value1, 0, 0xFFFF, 0, 0))
185:         }

193:         assembly {
194:             pop(call(value1, callAddr, value2, 0, 0xFFFF, 0, 0))
195:         }

205:         assembly {
206:             meta := staticcall(0, callAddr, 0, 0xFFFF, 0, 0)
207:         }

298:         assembly {
299:             callFlags := staticcall(0, callAddr, 0, 0xFFFF, 0, 0)
300:         }

309:         assembly {
310:             ptr := staticcall(0, callAddr, 0, 0xFFFF, 0, 0)
311:         }

322:         assembly {
323:             extraAbiData := staticcall(index, callAddr, 0, 0xFFFF, 0, 0)
324:         }
```

- *SystemContractsCaller.sol* ( [80-82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L80-L82), [100-102](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L100-L102), [109-111](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L109-L111), [132-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L132-L134), [137-139](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L137-L139), [160-163](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L160-L163) ):

```solidity
80:         assembly {
81:             dataStart := add(data, 0x20)
82:         }

100:             assembly {
101:                 success := call(to, callAddr, 0, 0, farCallAbi, 0, 0)
102:             }

109:             assembly {
110:                 success := call(msgValueSimulator, callAddr, value, to, farCallAbi, forwardMask, 0)
111:             }

132:         assembly {
133:             size := returndatasize()
134:         }

137:         assembly {
138:             returndatacopy(add(returnData, 0x20), 0, size)
139:         }

160:             assembly {
161:                 let size := mload(returnData)
162:                 revert(add(returnData, 0x20), size)
163:             }
```

- *TransactionHelper.sol* ( [399-401](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L399-L401) ):

```solidity
399:         assembly {
400:             success := call(gas(), bootloaderAddr, amount, 0, 0, 0, 0)
401:         }
```

- *UnsafeBytesCalldata.sol* ( [20-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L20-L23), [27-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L27-L30), [34-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L34-L37), [41-43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L41-L43), [47-49](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L47-L49) ):

```solidity
20:         assembly {
21:             let offset := sub(_bytes.offset, 30)
22:             result := calldataload(add(offset, _start))
23:         }

27:         assembly {
28:             let offset := sub(_bytes.offset, 28)
29:             result := calldataload(add(offset, _start))
30:         }

34:         assembly {
35:             let offset := sub(_bytes.offset, 24)
36:             result := calldataload(add(offset, _start))
37:         }

41:         assembly {
42:             result := calldataload(add(_bytes.offset, _start))
43:         }

47:         assembly {
48:             result := calldataload(add(_bytes.offset, _start))
49:         }
```

</details>

### [N-20] Consider splitting complex checks into multiple steps

Assign the expression's parts to intermediate local variables, and check against those instead.

<details>
<summary>There are 5 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [78-78](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L78-L78) ):

```solidity
78:             msg.sender == address(bridgehub) || (_chainId == ERA_CHAIN_ID && msg.sender == ERA_DIAMOND_PROXY),
```

- *BaseZkSyncUpgrade.sol* ( [150-152](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L150-L152) ):

```solidity
150:             _newVerifierParams.recursionNodeLevelVkHash == bytes32(0) &&
151:             _newVerifierParams.recursionLeafLevelVkHash == bytes32(0) &&
152:             _newVerifierParams.recursionCircuitsSetVksHash == bytes32(0)
```

- *L2SharedBridge.sol* ( [90-91](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L90-L91) ):

```solidity
90:             AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1Bridge ||
91:                 AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1LegacyBridge,
```

- *AccountCodeStorage.sol* ( [132-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L132-L134) ):

```solidity
132:             uint160(account) > CURRENT_MAX_PRECOMPILE_ADDRESS &&
133:             codeHash != 0x00 &&
134:             !Utils.isContractConstructing(codeHash)
```

- *L2BaseToken.sol* ( [34-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L34-L36) ):

```solidity
34:             msg.sender == MSG_VALUE_SYSTEM_CONTRACT ||
35:                 msg.sender == address(DEPLOYER_SYSTEM_CONTRACT) ||
36:                 msg.sender == BOOTLOADER_FORMAL_ADDRESS,
```

</details>

### [N-21] Consider moving `msg.sender` checks to `modifier`s

If some functions are only allowed to be called by some specific users, consider using a modifier instead of checking with a require statement, especially if this check is done in multiple functions.

<details>
<summary>There are 13 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [66-66](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L66-L66) ):

```solidity
66:         require(msg.sender == address(sharedBridge), "Not shared bridge");
```

- *L1SharedBridge.sol* ( [140-140](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L140-L140) ):

```solidity
140:         require(bridgehub.getStateTransition(_chainId) == msg.sender, "receiveEth not state transition");
```

- *Bridgehub.sol* ( [64-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L64-L64) ):

```solidity
64:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights
```

- *StateTransitionManager.sol* ( [123-123](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L123-L123) ):

```solidity
123:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights
```

- *Admin.sol* ( [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L36-L36) ):

```solidity
36:         require(msg.sender == pendingAdmin, "n4"); // Only proposed by current admin address can claim the admin rights
```

- *L2SharedBridge.sol* ( [89-93](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L89-L93) ):

```solidity
89:         require(
90:             AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1Bridge ||
91:                 AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1LegacyBridge,
92:             "mq"
93:         );
```

- *L2StandardERC20.sol* ( [122-122](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L122-L122) ):

```solidity
122:         require(msg.sender == UpgradeableBeacon(beaconAddress).owner(), "tt");
```

- *ComplexUpgrader.sol* ( [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol#L22-L22) ):

```solidity
22:         require(msg.sender == FORCE_DEPLOYER, "Can only be called by FORCE_DEPLOYER");
```

- *ContractDeployer.sol* ( [239-242](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L239-L242) ):

```solidity
239:         require(
240:             msg.sender == FORCE_DEPLOYER || msg.sender == address(COMPLEX_UPGRADER_CONTRACT),
241:             "Can only be called by FORCE_DEPLOYER or COMPLEX_UPGRADER_CONTRACT"
242:         );
```

- *ImmutableSimulator.sol* ( [35-35](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L35-L35) ):

```solidity
35:         require(msg.sender == address(DEPLOYER_SYSTEM_CONTRACT), "Callable only by the deployer system contract");
```

- *L2BaseToken.sol* ( [33-38](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L33-L38) ):

```solidity
33:         require(
34:             msg.sender == MSG_VALUE_SYSTEM_CONTRACT ||
35:                 msg.sender == address(DEPLOYER_SYSTEM_CONTRACT) ||
36:                 msg.sender == BOOTLOADER_FORMAL_ADDRESS,
37:             "Only system contracts with special access can call this method"
38:         );
```

- *NonceHolder.sol* ( [89-89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L89-L89), [136-139](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L136-L139) ):

```solidity
89:             require(isNonceUsed(msg.sender, _key - 1), "Previous nonce has not been used");

136:         require(
137:             msg.sender == address(DEPLOYER_SYSTEM_CONTRACT),
138:             "Only the contract deployer can increment the deployment nonce"
139:         );
```

</details>

### [N-22] Missing checks for empty bytes when updating bytes state variables

Unless the code is attempting to `delete` the state variable, the caller shouldn't have to write `""` to the state variable

There are 3 instances:

- *L1SharedBridge.sol* ( [240-240](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L240-L240) ):

```solidity
240:         depositHappened[_chainId][_txHash] = _txDataHash;
```

- *SystemContext.sol* ( [213-213](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L213-L213), [456-456](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L456-L456) ):

```solidity
213:         l2BlockHash[_block % MINIBLOCK_HASHES_TO_STORE] = _hash;

456:         batchHashes[previousBatchNumber] = _prevBatchHash;
```

### [N-23] Complex casting

Consider whether the number of casts is really necessary, or whether using a different type would be more appropriate. Alternatively, add comments to explain in detail why the casts are necessary, and any implicit reasons why the cast does not introduce an overflow.

<details>
<summary>There are 26 instances (click to show):</summary>

- *L2ContractHelper.sol* ( [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L52-L52), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L52-L52) ):

```solidity
52:         codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3]));

52:         codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3]));
```

- *StateTransitionManager.sol* ( [186-186](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L186-L186), [187-187](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L187-L187) ):

```solidity
186:             from: uint256(uint160(L2_FORCE_DEPLOYER_ADDR)),

187:             to: uint256(uint160(L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR)),
```

- *Mailbox.sol* ( [298-298](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L298-L298), [299-299](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L299-L299), [308-308](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L308-L308) ):

```solidity
298:             from: uint256(uint160(_priorityOpParams.sender)),

299:             to: uint256(uint160(_priorityOpParams.contractAddressL2)),

308:             reserved: [_priorityOpParams.valueToMint, uint256(uint160(_priorityOpParams.refundRecipient)), 0, 0],
```

- *AccountCodeStorage.sol* ( [69-69](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L69-L69), [79-79](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L79-L79) ):

```solidity
69:         uint256 addressAsKey = uint256(uint160(_address));

79:         uint256 addressAsKey = uint256(uint160(_address));
```

- *BootloaderUtilities.sol* ( [91-91](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L91-L91), [190-190](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L190-L190), [285-285](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L285-L285) ):

```solidity
91:             uint256 vInt = uint256(uint8(_transaction.signature[64]));

190:             uint256 vInt = uint256(uint8(_transaction.signature[64]));

285:             uint256 vInt = uint256(uint8(_transaction.signature[64]));
```

- *ContractDeployer.sol* ( [269-269](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L269-L269) ):

```solidity
269:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.getCodeHash(uint256(uint160(_newAddress))) == 0x0,
```

- *ImmutableSimulator.sol* ( [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L28-L28), [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L41-L41) ):

```solidity
28:         return immutableDataStorage[uint256(uint160(_dest))][_index];

41:                 immutableDataStorage[uint256(uint160(_dest))][index] = value;
```

- *NonceHolder.sol* ( [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L47-L47), [58-58](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L58-L58), [68-68](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L68-L68), [92-92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L92-L92), [103-103](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L103-L103), [111-111](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L111-L111), [126-126](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L126-L126), [140-140](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L140-L140), [155-155](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L155-L155) ):

```solidity
47:         uint256 addressAsKey = uint256(uint160(_address));

58:         uint256 addressAsKey = uint256(uint160(_address));

68:         uint256 addressAsKey = uint256(uint160(msg.sender));

92:         uint256 addressAsKey = uint256(uint160(msg.sender));

103:         uint256 addressAsKey = uint256(uint160(msg.sender));

111:         uint256 addressAsKey = uint256(uint160(msg.sender));

126:         uint256 addressAsKey = uint256(uint160(_address));

140:         uint256 addressAsKey = uint256(uint160(_address));

155:         uint256 addressAsKey = uint256(uint160(_address));
```

- *Utils.sol* ( [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L46-L46), [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L46-L46) ):

```solidity
46:             codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3]));

46:             codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3]));
```

</details>

### [N-24] Complex math should be split into multiple steps

Consider splitting long arithmetic calculations into multiple steps to improve the code readability.

<details>
<summary>There are 5 instances (click to show):</summary>

- *BootloaderUtilities.sol* ( [105-113](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L105-L113), [198-204](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L198-L204), [293-299](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L293-L299) ):

```solidity
105:             uint256 listLength = encodedNonce.length +
106:                 encodedGasParam.length +
107:                 encodedTo.length +
108:                 encodedValue.length +
109:                 encodedDataLength.length +
110:                 _transaction.data.length +
111:                 rEncoded.length +
112:                 sEncoded.length +
113:                 vEncoded.length;

198:             uint256 listLength = encodedFixedLengthParams.length +
199:                 encodedDataLength.length +
200:                 _transaction.data.length +
201:                 encodedAccessListLength.length +
202:                 rEncoded.length +
203:                 sEncoded.length +
204:                 vEncoded.length;

293:             uint256 listLength = encodedFixedLengthParams.length +
294:                 encodedDataLength.length +
295:                 _transaction.data.length +
296:                 encodedAccessListLength.length +
297:                 rEncoded.length +
298:                 sEncoded.length +
299:                 vEncoded.length;
```

- *L1Messenger.sol* ( [148-153](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L148-L153) ):

```solidity
148:         uint256 gasToPay = keccakGasCost(L2_TO_L1_LOG_SERIALIZE_SIZE) +
149:             3 *
150:             keccakGasCost(64) +
151:             gasSpentOnMessageHashing +
152:             COMPUTATIONAL_PRICE_FOR_PUBDATA *
153:             pubdataLen;
```

- *TransactionHelper.sol* ( [190-196](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L190-L196) ):

```solidity
190:             uint256 listLength = encodedNonce.length +
191:                 encodedGasParam.length +
192:                 encodedTo.length +
193:                 encodedValue.length +
194:                 encodedDataLength.length +
195:                 _transaction.data.length +
196:                 encodedChainId.length;
```

</details>

### [N-25] Consider adding a block/deny-list

Doing so will significantly increase centralization, but will help to prevent hackers from using stolen tokens

<details>
<summary>There are 21 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L21) ):

```solidity
21: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard {
```

- *L1SharedBridge.sol* ( [32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L32) ):

```solidity
32: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step {
```

- *ForceDeployUpgrader.sol* ( [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L12) ):

```solidity
12: contract ForceDeployUpgrader {
```

- *L2SharedBridge.sol* ( [25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L25) ):

```solidity
25: contract L2SharedBridge is IL2SharedBridge, Initializable {
```

- *L2StandardERC20.sol* ( [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L17) ):

```solidity
17: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade {
```

- *AccountCodeStorage.sol* ( [22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L22) ):

```solidity
22: contract AccountCodeStorage is IAccountCodeStorage {
```

- *BootloaderUtilities.sol* ( [16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L16) ):

```solidity
16: contract BootloaderUtilities is IBootloaderUtilities {
```

- *ComplexUpgrader.sol* ( [14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol#L14) ):

```solidity
14: contract ComplexUpgrader is IComplexUpgrader {
```

- *Compressor.sol* ( [22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L22) ):

```solidity
22: contract Compressor is ICompressor, ISystemContract {
```

- *ContractDeployer.sol* ( [23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L23) ):

```solidity
23: contract ContractDeployer is IContractDeployer, ISystemContract {
```

- *DefaultAccount.sol* ( [19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L19) ):

```solidity
19: contract DefaultAccount is IAccount {
```

- *EmptyContract.sol* ( [10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/EmptyContract.sol#L10) ):

```solidity
10: contract EmptyContract {
```

- *ImmutableSimulator.sol* ( [18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L18) ):

```solidity
18: contract ImmutableSimulator is IImmutableSimulator {
```

- *KnownCodesStorage.sol* ( [18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L18) ):

```solidity
18: contract KnownCodesStorage is IKnownCodesStorage, ISystemContract {
```

- *L1Messenger.sol* ( [25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L25) ):

```solidity
25: contract L1Messenger is IL1Messenger, ISystemContract {
```

- *L2BaseToken.sol* ( [18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L18) ):

```solidity
18: contract L2BaseToken is IBaseToken, ISystemContract {
```

- *MsgValueSimulator.sol* ( [19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L19) ):

```solidity
19: contract MsgValueSimulator is ISystemContract {
```

- *NonceHolder.sol* ( [27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L27) ):

```solidity
27: contract NonceHolder is INonceHolder, ISystemContract {
```

- *PubdataChunkPublisher.sol* ( [16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L16) ):

```solidity
16: contract PubdataChunkPublisher is IPubdataChunkPublisher, ISystemContract {
```

- *SystemContext.sol* ( [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L17) ):

```solidity
17: contract SystemContext is ISystemContext, ISystemContextDeprecated, ISystemContract {
```

- *ISystemContract.sol* ( [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContract.sol#L17) ):

```solidity
17: abstract contract ISystemContract {
```

</details>

### [N-26] Constants/Immutables redefined elsewhere

Consider defining in only one contract so that values cannot become out of sync when only one location is updated. A [cheap way](https://medium.com/coinmonks/gas-cost-of-solidity-library-functions-dbe0cedd4678) to store constants/immutables in a single location is to create an `internal constant` in a `library`. If the variable is a local cache of another contract's value, consider making the cache variable internal or private, which will require external users to query the contract with the source of truth, so that callers don't get out of sync.

<details>
<summary>There are 7 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [39-39](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L39-L39) ):

```solidity
/// @audit Seen in contracts/state-transition/StateTransitionManager.sol#29
39:     IBridgehub public immutable override bridgehub;
```

- *StateTransitionManager.sol* ( [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L29-L29) ):

```solidity
/// @audit Seen in contracts/bridge/L1SharedBridge.sol#39
29:     address public immutable bridgehub;
```

- *ValidatorTimelock.sol* ( [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L28-L28) ):

```solidity
/// @audit Seen in contracts/state-transition/chain-deps/facets/Admin.sol#22
28:     string public constant override getName = "ValidatorTimelock";
```

- *Admin.sol* ( [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L22-L22) ):

```solidity
/// @audit Seen in contracts/state-transition/ValidatorTimelock.sol#28
22:     string public constant override getName = "AdminFacet";
```

- *Executor.sol* ( [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L29-L29) ):

```solidity
/// @audit Seen in contracts/state-transition/chain-deps/facets/Admin.sol#22
29:     string public constant override getName = "ExecutorFacet";
```

- *Getters.sol* ( [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L27-L27) ):

```solidity
/// @audit Seen in contracts/state-transition/chain-deps/facets/Executor.sol#29
27:     string public constant override getName = "GettersFacet";
```

- *Mailbox.sol* ( [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L37-L37) ):

```solidity
/// @audit Seen in contracts/state-transition/chain-deps/facets/Getters.sol#27
37:     string public constant override getName = "MailboxFacet";
```

</details>

### [N-27] Convert simple `if`-statements to ternary expressions

Converting some if statements to ternaries (such as `z = (a < b) ? x : y`) can make the code more concise and easier to read.

<details>
<summary>There are 3 instances (click to show):</summary>

- *Bridgehub.sol* ( [331-336](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L331-L336) ):

```solidity
331:         } else if (_refundRecipient.code.length > 0) {
332:             // If the `_refundRecipient` is a smart contract, we apply the L1 to L2 alias to prevent foot guns.
333:             _recipient = AddressAliasHelper.applyL1ToL2Alias(_refundRecipient);
334:         } else {
335:             _recipient = _refundRecipient;
336:         }
```

- *SystemContext.sol* ( [150-160](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L150-L160) ):

```solidity
150:         } else if (
151:             _block >= currentVirtualBlockUpgradeInfo.virtualBlockFinishL2Block &&
152:             currentVirtualBlockUpgradeInfo.virtualBlockFinishL2Block > 0
153:         ) {
154:             hash = _getLatest257L2blockHash(_block);
155:         } else {
156:             // Important: we do not want this number to ever collide with the L2 block hash (either new or old one) and so
157:             // that's why the legacy L2 blocks' hashes are keccak256(abi.encodePacked(uint32(_block))), while these are equivalent to
158:             // keccak256(abi.encodePacked(_block))
159:             hash = keccak256(abi.encode(_block));
160:         }
```

- *TransactionHelper.sol* ( [406-412](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L406-L412) ):

```solidity
406:         if (address(uint160(_transaction.paymaster)) != address(0)) {
407:             // Paymaster pays for the fee
408:             requiredBalance = _transaction.value;
409:         } else {
410:             // The user should have enough balance for both the fee and the value of the transaction
411:             requiredBalance = _transaction.maxFeePerGas * _transaction.gasLimit + _transaction.value;
412:         }
```

</details>

### [N-28] Contracts should each be defined in separate files

Keeping each contract in a separate file makes it easier to work with multiple people, makes the code easier to maintain, and is a common practice on most projects. The following files each contains more than one contract/library/interface.

There are 2 instances:

- [*L2ContractHelper.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol)

- [*SystemContractsCaller.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol)

### [N-29] Contract name does not match its filename

According to the [Solidity Style Guide](https://docs.soliditylang.org/en/latest/style-guide.html#contract-and-library-names), contract and library names should also match their filenames.

There are 4 instances:

- *Admin.sol* ( [20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L20) ):

```solidity
/// @audit Not match filename `Admin.sol`
20: contract AdminFacet is ZkSyncStateTransitionBase, IAdmin {
```

- *Executor.sol* ( [24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L24) ):

```solidity
/// @audit Not match filename `Executor.sol`
24: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor {
```

- *Getters.sol* ( [22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L22) ):

```solidity
/// @audit Not match filename `Getters.sol`
22: contract GettersFacet is ZkSyncStateTransitionBase, IGetters, ILegacyGetters {
```

- *Mailbox.sol* ( [32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L32) ):

```solidity
/// @audit Not match filename `Mailbox.sol`
32: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox {
```

### [N-30] Do not use literal numbers for array indexes

Indexing arrays using enums or meaningfully named constants instead of literals can make code easier to read and maintain.

<details>
<summary>There are 41 instances (click to show):</summary>

- *L2ContractHelper.sol* ( [42-42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L42-L42), [43-43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L43-L43), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L52-L52), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L52-L52) ):

```solidity
42:         uint8 version = uint8(_bytecodeHash[0]);

43:         require(version == 1 && _bytecodeHash[1] == bytes1(0), "zf"); // Incorrectly formatted bytecodeHash

52:         codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3]));

52:         codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3]));
```

- *DiamondInit.sol* ( [43-43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L43-L43) ):

```solidity
43:         s.storedBatchHashes[0] = _initializeData.storedBatchZero;
```

- *Executor.sol* ( [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L41-L41), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L57-L57), [58-58](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L58-L58), [68-68](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L68-L68), [69-69](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L69-L69), [289-289](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L289-L289) ):

```solidity
41:         uint8 pubdataSource = uint8(bytes1(_newBatch.pubdataCommitments[0]));

57:             blobHashes[0] = logOutput.blob1Hash;

58:             blobHashes[1] = logOutput.blob2Hash;

68:             blobHashes[0] = logOutput.blob1Hash;

69:             blobCommitments[0] = bytes32(

289:         s.l2SystemContractsUpgradeBatchNumber = _newBatchesData[0].batchNumber;
```

- *Getters.sol* ( [172-172](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L172-L172) ):

```solidity
172:             bytes4 selector0 = ds.facetToSelectors[_facet].selectors[0];
```

- *Diamond.sol* ( [216-216](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L216-L216) ):

```solidity
216:             bytes4 selector0 = ds.facetToSelectors[_facet].selectors[0];
```

- *TransactionValidator.sol* ( [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L56-L56), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L57-L57), [58-58](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L58-L58), [59-59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L59-L59) ):

```solidity
56:         require(_transaction.reserved[0] == 0, "ue");

57:         require(_transaction.reserved[1] <= type(uint160).max, "uf");

58:         require(_transaction.reserved[2] == 0, "ug");

59:         require(_transaction.reserved[3] == 0, "uo");
```

- *BootloaderUtilities.sol* ( [72-72](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L72-L72), [91-91](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L91-L91), [96-96](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L96-L96), [168-168](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L168-L168), [190-190](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L190-L190), [263-263](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L263-L263), [285-285](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L285-L285) ):

```solidity
72:             } else if (_transaction.data[0] >= 0x80) {

91:             uint256 vInt = uint256(uint8(_transaction.signature[64]));

96:             if (_transaction.reserved[0] != 0) {

168:             } else if (_transaction.data[0] >= 0x80) {

190:             uint256 vInt = uint256(uint8(_transaction.signature[64]));

263:             } else if (_transaction.data[0] >= 0x80) {

285:             uint256 vInt = uint256(uint8(_transaction.signature[64]));
```

- *KnownCodesStorage.sol* ( [75-75](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L75-L75), [76-76](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L76-L76) ):

```solidity
75:         uint8 version = uint8(_bytecodeHash[0]);

76:         require(version == 1 && _bytecodeHash[1] == bytes1(0), "Incorrectly formatted bytecodeHash");
```

- *L1Messenger.sol* ( [230-230](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L230-L230) ):

```solidity
230:         bytes32 l2ToL1LogsTreeRoot = l2ToL1LogsTreeArray[0];
```

- *PubdataChunkPublisher.sol* ( [55-55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L55-L55), [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L56-L56) ):

```solidity
55:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_ONE_HASH_KEY)), blobHashes[0]);

56:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_TWO_HASH_KEY)), blobHashes[1]);
```

- *RLPEncoder.sol* ( [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L29-L29), [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L34-L34), [64-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L64-L64), [69-69](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L69-L69) ):

```solidity
29:                 encoded[0] = (_val == 0) ? bytes1(uint8(128)) : bytes1(uint8(_val));

34:                 encoded[0] = bytes1(uint8(hbs + 0x81));

64:                 encoded[0] = bytes1(uint8(_len + _offset));

69:                 encoded[0] = bytes1(uint8(_offset + hbs + 56));
```

- *TransactionHelper.sol* ( [175-175](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L175-L175), [184-184](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L184-L184), [253-253](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L253-L253), [325-325](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L325-L325) ):

```solidity
175:             } else if (_transaction.data[0] >= 0x80) {

184:         if (_transaction.reserved[0] != 0) {

253:             } else if (_transaction.data[0] >= 0x80) {

325:             } else if (_transaction.data[0] >= 0x80) {
```

- *Utils.sol* ( [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L46-L46), [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L46-L46), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L52-L52), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L57-L57) ):

```solidity
46:             codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3]));

46:             codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3]));

52:         return _bytecodeHash[1] == 0x00;

57:         return _bytecodeHash[1] == 0x01;
```

</details>

### [N-31] Contract timekeeping will break earlier than the Ethereum network itself will stop working

When a timestamp is downcast from `uint256` to `uint32`, the value will wrap in the year 2106, and the contracts will break. Other downcasts will have different endpoints. Consider whether your contract is intended to live past the size of the type being used.

There are 2 instances:

- *ValidatorTimelock.sol* ( [117-117](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L117-L117), [136-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L136-L136) ):

```solidity
117:             uint32 timestamp = uint32(block.timestamp);

136:             uint32 timestamp = uint32(block.timestamp);
```

### [N-32] Consider emitting an event at the end of the constructor

This will allow users to easily exactly pinpoint when and by whom a contract was constructed.

<details>
<summary>There are 9 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L57-L57) ):

```solidity
57:     constructor(IL1SharedBridge _sharedBridge) reentrancyGuardInitializer {
```

- *L1SharedBridge.sol* ( [92-96](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L92-L96) ):

```solidity
92:     constructor(
93:         address _l1WethAddress,
94:         IBridgehub _bridgehub,
95:         IL1ERC20Bridge _legacyBridge
96:     ) reentrancyGuardInitializer {
```

- *Bridgehub.sol* ( [40-40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L40-L40) ):

```solidity
40:     constructor() reentrancyGuardInitializer {}
```

- *StateTransitionManager.sol* ( [60-60](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L60-L60) ):

```solidity
60:     constructor(address _bridgehub) reentrancyGuardInitializer {
```

- *ValidatorTimelock.sol* ( [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L57-L57) ):

```solidity
57:     constructor(address _initialOwner, uint32 _executionDelay) {
```

- *DiamondInit.sol* ( [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L21-L21) ):

```solidity
21:     constructor() reentrancyGuardInitializer {}
```

- *DiamondProxy.sol* ( [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L13-L13) ):

```solidity
13:     constructor(uint256 _chainId, Diamond.DiamondCutData memory _diamondCut) {
```

- *L2SharedBridge.sol* ( [43-43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L43-L43) ):

```solidity
43:     constructor() {
```

- *L2StandardERC20.sol* ( [42-42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L42-L42) ):

```solidity
42:     constructor() {
```

</details>

### [N-33] Empty function body without comments

Empty function body in solidity is not recommended, consider adding some comments to the body.

<details>
<summary>There are 8 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [62-62](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L62-L62) ):

```solidity
62:     function initialize() external reentrancyGuardInitializer {}
```

- *Bridgehub.sol* ( [40-40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L40-L40) ):

```solidity
40:     constructor() reentrancyGuardInitializer {}
```

- *Governance.sol* ( [264-264](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L264-L264) ):

```solidity
264:     receive() external payable {}
```

- *DiamondInit.sol* ( [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L21-L21) ):

```solidity
21:     constructor() reentrancyGuardInitializer {}
```

- *BaseZkSyncUpgrade.sol* ( [265-265](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L265-L265), [271-271](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L271-L271) ):

```solidity
265:     function _upgradeL1Contract(bytes calldata _customCallDataForUpgrade) internal virtual {}

271:     function _postUpgrade(bytes calldata _customCallDataForUpgrade) internal virtual {}
```

- *EmptyContract.sol* ( [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/EmptyContract.sol#L11-L11), [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/EmptyContract.sol#L13-L13) ):

```solidity
11:     fallback() external payable {}

13:     receive() external payable {}
```

</details>

### [N-34] `require()` / `revert()` statements should have descriptive reason strings

Consider adding a descriptive reason string to `require()`/`revert()` statements.

There are 5 instances:

- *Executor.sol* ( [53-53](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L53-L53) ):

```solidity
53:             require(_newBatch.pubdataCommitments.length == 1);
```

- *L2StandardERC20.sol* ( [163-163](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L163-L163), [169-169](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L169-L169), [175-175](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L175-L175) ):

```solidity
163:         if (availableGetters.ignoreName) revert();

169:         if (availableGetters.ignoreSymbol) revert();

175:         if (availableGetters.ignoreDecimals) revert();
```

- *ISystemContract.sol* ( [55-55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContract.sol#L55-L55) ):

```solidity
55:         require(msg.sender == FORCE_DEPLOYER);
```

### [N-35] Events are emitted without the sender information

When an action is triggered based on a user's action, not being able to filter based on who triggered the action makes event processing a lot more cumbersome. Including the `msg.sender` the events of these types of action will make events much more useful to end users, especially when `msg.sender` is not `tx.origin`.

<details>
<summary>There are 19 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [227-227](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L227-L227) ):

```solidity
227:         emit WithdrawalFinalized(l1Receiver, l1Token, amount);
```

- *L1SharedBridge.sol* ( [241-241](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L241-L241) ):

```solidity
241:         emit BridgehubDepositFinalized(_chainId, _txDataHash, _txHash);
```

- *Bridgehub.sol* ( [70-70](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L70-L70), [71-71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L71-L71) ):

```solidity
70:         emit NewPendingAdmin(currentPendingAdmin, address(0));

71:         emit NewAdmin(previousAdmin, pendingAdmin);
```

- *Governance.sol* ( [201-201](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L201-L201), [252-252](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L252-L252), [259-259](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L259-L259) ):

```solidity
201:         emit OperationExecuted(id);

252:         emit ChangeMinDelay(minDelay, _newDelay);

259:         emit ChangeSecurityCouncil(securityCouncil, _newSecurityCouncil);
```

- *StateTransitionManager.sol* ( [129-129](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L129-L129), [130-130](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L130-L130), [289-289](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L289-L289) ):

```solidity
129:         emit NewPendingAdmin(currentPendingAdmin, address(0));

130:         emit NewAdmin(previousAdmin, pendingAdmin);

289:         emit StateTransitionNewChain(_chainId, stateTransitionAddress);
```

- *Admin.sol* ( [42-42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L42-L42), [43-43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L43-L43) ):

```solidity
42:         emit NewPendingAdmin(pendingAdmin, address(0));

43:         emit NewAdmin(previousAdmin, pendingAdmin);
```

- *BaseZkSyncUpgrade.sol* ( [89-89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L89-L89) ):

```solidity
89:         emit UpgradeComplete(_proposedUpgrade.newProtocolVersion, txHash, _proposedUpgrade);
```

- *BaseZkSyncUpgradeGenesis.sol* ( [69-69](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L69-L69) ):

```solidity
69:         emit UpgradeComplete(_proposedUpgrade.newProtocolVersion, txHash, _proposedUpgrade);
```

- *L2StandardERC20.sol* ( [128-128](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L128-L128), [149-149](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L149-L149), [158-158](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L158-L158) ):

```solidity
128:         emit BridgeInitialize(l1Address, _newName, _newSymbol, decimals_);

149:         emit BridgeMint(_to, _amount);

158:         emit BridgeBurn(_from, _amount);
```

- *L1Messenger.sol* ( [181-181](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L181-L181) ):

```solidity
181:         emit BytecodeL1PublicationRequested(_bytecodeHash);
```

- *L2BaseToken.sol* ( [67-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L67-L67) ):

```solidity
67:         emit Mint(_account, _amount);
```

</details>

### [N-36] Event is missing `indexed` fields

Index event fields makes the field more quickly accessible to [off-chain tools](https://ethereum.stackexchange.com/questions/40396/can-somebody-please-explain-the-concept-of-event-indexing) that parse events. However, note that each indexed field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

<details>
<summary>There are 18 instances (click to show):</summary>

- *IL1SharedBridge.sol* ( [33-38](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L33-L38) ):

```solidity
33:     event BridgehubDepositBaseTokenInitiated(
34:         uint256 indexed chainId,
35:         address indexed from,
36:         address l1Token,
37:         uint256 amount
38:     );
```

- *IBridgehub.sol* ( [135-135](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L135-L135) ):

```solidity
135:     event NewChain(uint256 indexed chainId, address stateTransitionManager, address indexed chainGovernance);
```

- *IGovernance.sol* ( [79-79](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L79-L79) ):

```solidity
79:     event ChangeSecurityCouncil(address _securityCouncilBefore, address _securityCouncilAfter);
```

- *ValidatorTimelock.sol* ( [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L34-L34), [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L37-L37) ):

```solidity
34:     event ValidatorAdded(uint256 _chainId, address _addedValidator);

37:     event ValidatorRemoved(uint256 _chainId, address _removedValidator);
```

- *IAdmin.sol* ( [63-63](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L63-L63), [66-66](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L66-L66), [82-82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L82-L82) ):

```solidity
63:     event IsPorterAvailableStatusUpdate(bool isPorterAvailable);

66:     event ValidatorStatusUpdate(address indexed validatorAddress, bool isActive);

82:     event ValidiumModeStatusUpdate(PubdataPricingMode validiumMode);
```

- *IMailbox.sol* ( [125-131](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L125-L131) ):

```solidity
125:     event NewPriorityRequest(
126:         uint256 txId,
127:         bytes32 txHash,
128:         uint64 expirationTimestamp,
129:         L2CanonicalTransaction transaction,
130:         bytes[] factoryDeps
131:     );
```

- *IZkSyncStateTransition.sol* ( [19-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L19-L23) ):

```solidity
19:     event ProposeTransparentUpgrade(
20:         Diamond.DiamondCutData diamondCut,
21:         uint256 indexed proposalId,
22:         bytes32 proposalSalt
23:     );
```

- *Diamond.sol* ( [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L26-L26) ):

```solidity
26:     event DiamondCut(FacetCut[] facetCuts, address initAddress, bytes initCalldata);
```

- *IL2SharedBridge.sol* ( [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L24-L24) ):

```solidity
24:     event BaseTokenReceived(uint256 amount);
```

- *IL2StandardToken.sol* ( [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L8-L8), [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L10-L10), [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L12-L12) ):

```solidity
8:     event BridgeInitialize(address indexed l1Token, string name, string symbol, uint8 decimals);

10:     event BridgeMint(address indexed _account, uint256 _amount);

12:     event BridgeBurn(address indexed _account, uint256 _amount);
```

- *IContractDeployer.sol* ( [39-39](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L39-L39), [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L41-L41) ):

```solidity
39:     event AccountNonceOrderingUpdated(address indexed accountAddress, AccountNonceOrdering nonceOrdering);

41:     event AccountVersionUpdated(address indexed accountAddress, AccountAbstractionVersion aaVersion);
```

- *IL1Messenger.sol* ( [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L47-L47) ):

```solidity
47:     event BytecodeL1PublicationRequested(bytes32 _bytecodeHash);
```

</details>

### [N-37] Imports could be organized more systematically

The contract's interface should be imported first, followed by each of the interfaces it uses, followed by all other files. The examples below do not follow this layout.

<details>
<summary>There are 46 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L10-L10) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
10: import {IL1ERC20Bridge} from "./interfaces/IL1ERC20Bridge.sol";
```

- *L1SharedBridge.sol* ( [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L10-L10), [14-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L14-L14), [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L24-L24) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
10: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol";

/// @audit Out of order with the prev import️ ⬆
14: import {IL1ERC20Bridge} from "./interfaces/IL1ERC20Bridge.sol";

/// @audit Out of order with the prev import️ ⬆
24: import {IBridgehub, L2TransactionRequestTwoBridgesInner, L2TransactionRequestDirect} from "../bridgehub/IBridgehub.sol";
```

- *IL1SharedBridge.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L7-L7) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
7: import {L2TransactionRequestTwoBridgesInner} from "../../bridgehub/IBridgehub.sol";
```

- *Bridgehub.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L9-L9), [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L13-L13) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
9: import "./IBridgehub.sol";

/// @audit Out of order with the prev import️ ⬆
13: import "../state-transition/chain-interfaces/IZkSyncStateTransition.sol";
```

- *IBridgehub.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L9-L9) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
9: import "../state-transition/IStateTransitionManager.sol";
```

- *Governance.sol* ( [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L8-L8) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
8: import {IGovernance} from "./IGovernance.sol";
```

- *StateTransitionManager.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L9-L9), [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L13-L13), [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L22-L22) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
9: import {IAdmin} from "./chain-interfaces/IAdmin.sol";

/// @audit Out of order with the prev import️ ⬆
13: import {IStateTransitionManager, StateTransitionManagerInitializeData} from "./IStateTransitionManager.sol";

/// @audit Out of order with the prev import️ ⬆
22: import {VerifierParams} from "./chain-interfaces/IVerifier.sol";
```

- *ValidatorTimelock.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L9-L9) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
9: import {IExecutor} from "./chain-interfaces/IExecutor.sol";
```

- *DiamondInit.sol* ( [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L11-L11), [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L12-L12) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
11: import {InitializeData, IDiamondInit} from "../chain-interfaces/IDiamondInit.sol";

/// @audit Out of order with the prev import️ ⬆
12: import {VerifierParams} from "../chain-interfaces/IVerifier.sol";
```

- *ZkSyncStateTransitionStorage.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L7-L7) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
7: import {IVerifier, VerifierParams} from "../chain-interfaces/IVerifier.sol";
```

- *Admin.sol* ( [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L12-L12) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
12: import {IStateTransitionManager} from "../../IStateTransitionManager.sol";
```

- *Executor.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L9-L9), [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L13-L13), [16-16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L16-L16) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
9: import {IExecutor, L2_LOG_ADDRESS_OFFSET, L2_LOG_KEY_OFFSET, L2_LOG_VALUE_OFFSET, SystemLogKey, LogProcessingOutput, PubdataSource, BLS_MODULUS, PUBDATA_COMMITMENT_SIZE, PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET, PUBDATA_COMMITMENT_COMMITMENT_OFFSET, MAX_NUMBER_OF_BLOBS, TOTAL_BLOBS_IN_COMMITMENT} from "../../chain-interfaces/IExecutor.sol";

/// @audit Out of order with the prev import️ ⬆
13: import {VerifierParams} from "../../chain-interfaces/IVerifier.sol";

/// @audit Out of order with the prev import️ ⬆
16: import {IStateTransitionManager} from "../../IStateTransitionManager.sol";
```

- *Getters.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L9-L9), [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L13-L13) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
9: import {VerifierParams} from "../../../state-transition/chain-interfaces/IVerifier.sol";

/// @audit Out of order with the prev import️ ⬆
13: import {IGetters} from "../../chain-interfaces/IGetters.sol";
```

- *Mailbox.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L9-L9), [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L23-L23) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
9: import {IMailbox} from "../../chain-interfaces/IMailbox.sol";

/// @audit Out of order with the prev import️ ⬆
23: import {IBridgehub} from "../../../bridgehub/IBridgehub.sol";
```

- *IDiamondInit.sol* ( [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L8-L8) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
8: import {IVerifier, VerifierParams} from "./IVerifier.sol";
```

- *IGetters.sol* ( [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L8-L8), [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L10-L10) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
8: import {VerifierParams} from "../chain-interfaces/IVerifier.sol";

/// @audit Out of order with the prev import️ ⬆
10: import {IZkSyncStateTransitionBase} from "./IZkSyncStateTransitionBase.sol";
```

- *IZkSyncStateTransition.sol* ( [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L12-L12) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
12: import {VerifierParams} from "./IVerifier.sol";
```

- *BaseZkSyncUpgrade.sol* ( [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L8-L8), [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L9-L9) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
8: import {IMailbox} from "../state-transition/chain-interfaces/IMailbox.sol";

/// @audit Out of order with the prev import️ ⬆
9: import {VerifierParams} from "../state-transition/chain-interfaces/IVerifier.sol";
```

- *BaseZkSyncUpgradeGenesis.sol* ( [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L8-L8) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
8: import "../state-transition/chain-interfaces/IMailbox.sol";
```

- *GenesisUpgrade.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L9-L9) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
9: import "./IDefaultUpgrade.sol";
```

- *L2SharedBridge.sol* ( [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L11-L11), [17-17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L17-L17) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
11: import {IL1ERC20Bridge} from "./interfaces/IL1ERC20Bridge.sol";

/// @audit Out of order with the prev import️ ⬆
17: import {L2ContractHelper, DEPLOYER_SYSTEM_CONTRACT, L2_BASE_TOKEN_ADDRESS, IContractDeployer} from "../L2ContractHelper.sol";
```

- *L2StandardERC20.sol* ( [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L11-L11) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
11: import {IL2StandardToken} from "./interfaces/IL2StandardToken.sol";
```

- *Compressor.sol* ( [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L5-L5), [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L10-L10) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
5: import {ICompressor, OPERATION_BITMASK, LENGTH_BITS_OFFSET, MAX_ENUMERATION_INDEX_SIZE} from "./interfaces/ICompressor.sol";

/// @audit Out of order with the prev import️ ⬆
10: import {L1_MESSENGER_CONTRACT, INITIAL_WRITE_STARTING_POSITION, COMPRESSED_INITIAL_WRITE_SIZE, STATE_DIFF_ENTRY_SIZE, STATE_DIFF_ENUM_INDEX_OFFSET, STATE_DIFF_FINAL_VALUE_OFFSET, STATE_DIFF_DERIVED_KEY_OFFSET, DERIVED_KEY_LENGTH, VALUE_LENGTH, ENUM_INDEX_LENGTH, KNOWN_CODE_STORAGE_CONTRACT} from "./Constants.sol";
```

- *ContractDeployer.sol* ( [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L5-L5), [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L7-L7), [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L12-L12) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
5: import {ImmutableData} from "./interfaces/IImmutableSimulator.sol";

/// @audit Out of order with the prev import️ ⬆
7: import {CREATE2_PREFIX, CREATE_PREFIX, NONCE_HOLDER_SYSTEM_CONTRACT, ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT, FORCE_DEPLOYER, MAX_SYSTEM_CONTRACT_ADDRESS, KNOWN_CODE_STORAGE_CONTRACT, BASE_TOKEN_SYSTEM_CONTRACT, IMMUTABLE_SIMULATOR_SYSTEM_CONTRACT, COMPLEX_UPGRADER_CONTRACT, KECCAK256_SYSTEM_CONTRACT} from "./Constants.sol";

/// @audit Out of order with the prev import️ ⬆
12: import {ISystemContract} from "./interfaces/ISystemContract.sol";
```

- *DefaultAccount.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L9-L9) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
9: import {BOOTLOADER_FORMAL_ADDRESS, NONCE_HOLDER_SYSTEM_CONTRACT, DEPLOYER_SYSTEM_CONTRACT, INonceHolder} from "./Constants.sol";
```

- *ImmutableSimulator.sol* ( [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L5-L5) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
5: import {IImmutableSimulator, ImmutableData} from "./interfaces/IImmutableSimulator.sol";
```

- *L1Messenger.sol* ( [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L5-L5) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
5: import {IL1Messenger, L2ToL1Log, L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH, L2_TO_L1_LOG_SERIALIZE_SIZE, STATE_DIFF_COMPRESSION_VERSION_NUMBER} from "./interfaces/IL1Messenger.sol";
```

- *L2BaseToken.sol* ( [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L8-L8) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
8: import {IMailbox} from "./interfaces/IMailbox.sol";
```

- *MsgValueSimulator.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L7-L7) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
7: import {ISystemContract} from "./interfaces/ISystemContract.sol";
```

- *TransactionHelper.sol* ( [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L8-L8) ):

```solidity
/// @audit Out of order with the prev import️ ⬆
8: import "../interfaces/IPaymasterFlow.sol";
```

</details>

### [N-38] @openzeppelin/contracts should be upgraded to a newer version

These contracts import contracts from `@openzeppelin/contracts`, but they are not using [the latest version](https://github.com/OpenZeppelin/openzeppelin-contracts/releases). Using the latest version ensures contract security with fixes for known vulnerabilities, access to the latest feature updates, and enhanced community support and engagement.

The imported version is `4.9.5`.
The imported version is `4.9.5`.

<details>
<summary>There are 20 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L7), [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L8) ):

```solidity
7: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol";

8: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
```

- *L1SharedBridge.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L7), [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L8), [10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L10), [11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L11), [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L12) ):

```solidity
7: import {Initializable} from "@openzeppelin/contracts/proxy/utils/Initializable.sol";

8: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";

10: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol";

11: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol";

12: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
```

- *Bridgehub.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L7) ):

```solidity
7: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";
```

- *Governance.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L7) ):

```solidity
7: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";
```

- *StateTransitionManager.sol* ( [18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L18) ):

```solidity
18: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";
```

- *ValidatorTimelock.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L7) ):

```solidity
7: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";
```

- *Mailbox.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L7) ):

```solidity
7: import {Math} from "@openzeppelin/contracts/utils/math/Math.sol";
```

- *Diamond.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L7) ):

```solidity
7: import {SafeCast} from "@openzeppelin/contracts/utils/math/SafeCast.sol";
```

- *TransactionValidator.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L7) ):

```solidity
7: import {Math} from "@openzeppelin/contracts/utils/math/Math.sol";
```

- *L2SharedBridge.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L7), [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L8), [9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L9) ):

```solidity
7: import {Initializable} from "@openzeppelin/contracts/proxy/utils/Initializable.sol";

8: import {BeaconProxy} from "@openzeppelin/contracts/proxy/beacon/BeaconProxy.sol";

9: import {UpgradeableBeacon} from "@openzeppelin/contracts/proxy/beacon/UpgradeableBeacon.sol";
```

- *L2StandardERC20.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L7), [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L8), [9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L9) ):

```solidity
7: import {ERC20PermitUpgradeable} from "@openzeppelin/contracts-upgradeable/token/ERC20/extensions/draft-ERC20PermitUpgradeable.sol";

8: import {UpgradeableBeacon} from "@openzeppelin/contracts/proxy/beacon/UpgradeableBeacon.sol";

9: import {ERC1967Upgrade} from "@openzeppelin/contracts/proxy/ERC1967/ERC1967Upgrade.sol";
```

</details>

### [N-39] Lib @openzeppelin/contracts-upgradeable should be upgraded to a newer version

These contracts import contracts from `@openzeppelin/contracts-upgradeable`, but they are not using [the latest version](https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable/releases). Using the latest version ensures contract security with fixes for known vulnerabilities, access to the latest feature updates, and enhanced community support and engagement.

The imported version is `4.9.5`.
The imported version is `4.9.5`.

There are 2 instances:

- Global finding

- *L2StandardERC20.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L7) ):

```solidity
7: import {ERC20PermitUpgradeable} from "@openzeppelin/contracts-upgradeable/token/ERC20/extensions/draft-ERC20PermitUpgradeable.sol";
```

### [N-40] Lines are too long

The [solidity style guide](https://docs.soliditylang.org/en/v0.8.17/style-guide.html#maximum-line-length) recommends a maximum line length of 120 characters. Lines of code that are longer than 120 should be wrapped.

<details>
<summary>There are 164 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [33](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L33) ):

```solidity
33:     /// @dev Used for saving the number of deposited funds, to claim them in case the deposit transaction will fail in zkSync Era.
```

- *L1SharedBridge.sol* ( [23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L23), [45](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L45), [49](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L49), [59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L59), [105](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L105), [162](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L162), [169](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L169), [232](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L232), [334](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L334), [496](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L496), [517](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L517), [589](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L589), [590](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L590) ):

```solidity
23: import {ERA_CHAIN_ID, ERA_ERC20_BRIDGE_ADDRESS, ETH_TOKEN_ADDRESS, ERA_DIAMOND_PROXY, TWO_BRIDGES_MAGIC_VALUE} from "../common/Config.sol";

45:     /// This variable is used to differentiate between pre-upgrade and post-upgrade withdrawals. Withdrawals from batches older

49:     /// @dev A mapping chainId => bridgeProxy. Used to store the bridge proxy's address, and to see if it has been deployed yet.

59:     mapping(uint256 chainId => mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized)))

105:     /// implementation. The owner is the Governor and separate from the ProxyAdmin from now on, so that the Governor can call the bridge.

162:             uint256 amount = _depositFunds(_prevMsgSender, IERC20(_l1Token), _amount); // note if _prevMsgSender is this contract, this will return 0. This does not happen.

169:         // Note that we don't save the deposited amount, as this is for the base token, which gets sent to the refundRecipient if the tx fails

232:     /// @notice Confirms the acceptance of a transaction by the Mailbox, as part of the L2 transaction process within Bridgehub.

334:                 // Deposits that happened before the upgrade cannot be checked here, they have to be claimed and checked in the legacyBridge

496:         // It should be equal to the length of the bytes4 function signature + address l1Receiver + uint256 amount = 4 + 20 + 32 = 56 (bytes).

517:             // It should be equal to the length of the function signature + address + address + uint256 = 4 + 20 + 20 + 32 =

589:                 mintValue: msg.value, // l2 gas + l2 msg.Value the bridgehub will withdraw the mintValue from the base token bridge for gas

590:                 l2Value: 0, // L2 msg.value, this contract doesn't support base token deposits or wrapping functionality, for direct deposits use bridgehub
```

- *Bridgehub.sol* ( [64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L64), [218](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L218) ):

```solidity
64:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights

218:     /// This means this is not ideal for contract calls, as the contract would have to handle token allowance of the base Token
```

- *ReentrancyGuard.sol* ( [34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L34) ):

```solidity
34:     // https://github.com/OpenZeppelin/openzeppelin-contracts/blob/566a774222707e424896c0c390a84dc3c13bdcb2/contracts/security/ReentrancyGuard.sol
```

- *UnsafeBytes.sol* ( [11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L11) ):

```solidity
11:  * @dev Each of the functions accepts the `bytes memory` and the offset where data should be read and returns a value of a certain type.
```

- *StateTransitionManager.sol* ( [21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L21), [123](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L123) ):

```solidity
21: import {REQUIRED_L2_GAS_PRICE_PER_PUBDATA, L2_TO_L1_LOG_SERIALIZE_SIZE, DEFAULT_L2_LOGS_TREE_ROOT_HASH, EMPTY_STRING_KECCAK, SYSTEM_UPGRADE_L2_TX_TYPE, ERA_DIAMOND_PROXY, ERA_CHAIN_ID} from "../common/Config.sol";

123:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights
```

- *ValidatorTimelock.sol* ( [15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L15), [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L17) ):

```solidity
15: /// @notice Intermediate smart contract between the validator EOA account and the hyperchains state transition diamond smart contract.

17: /// modifying the main hyperchain diamond contract. As such, even if this contract is compromised, it will not impact the main
```

- *ZkSyncStateTransitionStorage.sol* ( [71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L71), [151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L151) ):

```solidity
71:     /// @notice Address which will exercise critical changes to the Diamond Proxy (upgrades, freezing & unfreezing). Replaced by STM

151:     /// @notice gasPriceMultiplier for each baseToken, so that each L1->L2 transaction pays for its transaction on the destination
```

- *Admin.sol* ( [92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L92) ):

```solidity
92:         require(s.totalBatchesCommitted == 0, "AdminFacet: set validium only after genesis"); // Validium mode can be set only before the first batch is committed
```

- *Executor.sol* ( [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L8), [9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L9), [14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L14), [59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L59), [62](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L62), [102](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L102), [124](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L124), [125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L125), [223](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L223), [224](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L224), [225](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L225), [226](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L226), [227](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L227), [232](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L232), [235](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L235), [284](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L284), [332](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L332), [360](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L360), [530](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L530), [613](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L613), [619](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L619), [622](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L622) ):

```solidity
8: import {COMMIT_TIMESTAMP_NOT_OLDER, COMMIT_TIMESTAMP_APPROXIMATION_DELTA, EMPTY_STRING_KECCAK, L2_TO_L1_LOG_SERIALIZE_SIZE, MAX_L2_TO_L1_LOGS_COMMITMENT_BYTES, PACKED_L2_BLOCK_TIMESTAMP_MASK, PUBLIC_INPUT_SHIFT, POINT_EVALUATION_PRECOMPILE_ADDR} from "../../../common/Config.sol";

9: import {IExecutor, L2_LOG_ADDRESS_OFFSET, L2_LOG_KEY_OFFSET, L2_LOG_VALUE_OFFSET, SystemLogKey, LogProcessingOutput, PubdataSource, BLS_MODULUS, PUBDATA_COMMITMENT_SIZE, PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET, PUBDATA_COMMITMENT_COMMITMENT_OFFSET, MAX_NUMBER_OF_BLOBS, TOTAL_BLOBS_IN_COMMITMENT} from "../../chain-interfaces/IExecutor.sol";

14: import {L2_BOOTLOADER_ADDRESS, L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, L2_PUBDATA_CHUNK_PUBLISHER_ADDR} from "../../../common/L2ContractAddresses.sol";

59:             // In this scenario, pubdataCommitments is a list of: opening point (16 bytes) || claimed value (32 bytes) || commitment (48 bytes) || proof (48 bytes)) = 144 bytes

62:             // In this scenario pubdataCommitments is actual pubdata consisting of l2 to l1 logs, l2 to l1 message, compressed smart contract bytecode, and compressed state diffs

102:     /// @param _packedBatchAndL2BlockTimestamp - packed batch and L2 block timestamp in a format of batchTimestamp * 2**128 + l2BatchTimestamp

124:         require(block.timestamp - COMMIT_TIMESTAMP_NOT_OLDER <= batchTimestamp, "h1"); // New batch timestamp is too small

125:         require(lastL2BlockTimestamp <= block.timestamp + COMMIT_TIMESTAMP_APPROXIMATION_DELTA, "h2"); // The last L2 block timestamp is too big

223:         // 1. A chain has to keep their protocol version up to date, as processing a block requires the latest or previous protocol version

224:         // to solve this we will need to add the feature to create batches with only the protocol upgrade tx, without any other txs.

225:         // 2. A chain might become out of sync if it launches while we are in the middle of a protocol upgrade. This would mean they cannot process their genesis upgrade

226:         // as thier protocolversion would be outdated, and they also cannot process the protocol upgrade tx as they have a pending upgrade.

227:         // 3. The protocol upgrade is increased in the BaseZkSyncUpgrade, in the executor only the systemContractsUpgradeTxHash is checked

232:         // With the new changes for EIP-4844, namely the restriction on number of blobs per block, we only allow for a single batch to be committed at a time.

235:         require(s.storedBatchHashes[s.totalBatchesCommitted] == _hashStoredBatchInfo(_lastCommittedBatchData), "i"); // incorrect previous batch data

284:         // While the logic of the contract ensures that the s.l2SystemContractsUpgradeBatchNumber is 0 when this function is called,

332:         require(priorityOperationsHash == _storedBatch.priorityOperationsHash, "x"); // priority operations hash does not match to expected

360:         require(newTotalBatchesExecuted <= s.totalBatchesVerified, "n"); // Can't execute batches more than committed and proven currently.

530:                 // VM 1.5.0 requires us to pass the EVM simulator code hash. For now it is the same as the default account.

613:         // response is equal to BLS_MODULUS as defined in https://eips.ethereum.org/EIPS/eip-4844#point-evaluation-precompile

619:     /// @dev Verifies that the blobs contain the correct data by calling the point evaluation precompile. For the precompile we need:

622:     /// pubdataCommitments is a list of: opening point (16 bytes) || claimed value (32 bytes) || commitment (48 bytes) || proof (48 bytes)) = 144 bytes
```

- *Mailbox.sol* ( [13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L13), [20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L20), [21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L21), [92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L92), [234](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L234), [241](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L241), [242](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L242) ):

```solidity
13: import {WritePriorityOpParams, L2CanonicalTransaction, L2Message, L2Log, TxStatus, BridgehubL2TransactionRequest} from "../../../common/Messaging.sol";

20: import {REQUIRED_L2_GAS_PRICE_PER_PUBDATA, L1_GAS_PER_PUBDATA_BYTE, L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH, PRIORITY_OPERATION_L2_TX_TYPE, PRIORITY_EXPIRATION, MAX_NEW_FACTORY_DEPS, ETH_TOKEN_ADDRESS, ERA_CHAIN_ID} from "../../../common/Config.sol";

21: import {L2_BOOTLOADER_ADDRESS, L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, L2_BASE_TOKEN_SYSTEM_CONTRACT_ADDR} from "../../../common/L2ContractAddresses.sol";

92:         // - l2ShardId = 0 (means that L1 -> L2 transaction was processed in a rollup shard, other shards are not available yet anyway)

234:         // Please note, currently zkSync address derivation is different from Ethereum one, but it may be changed in the future.

241:         // to ensure that users do not get used to using "exotic" numbers for _request.l2GasPerPubdataByteLimit, e.g. 1-2, etc.

242:         // VERY IMPORTANT: nobody should rely on this constant to be fixed and every contract should give their users the ability to provide the
```

- *IExecutor.sol* ( [23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L23), [47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L47), [55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L55), [79](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L79), [99](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L99), [103](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L103), [104](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L104), [107](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L107), [108](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L108), [110](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L110), [112](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L112), [198](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L198) ):

```solidity
23: /// @dev Enum used to determine the source of pubdata. At first we will support calldata and blobs but this can be extended.

47: /// @dev Offset used to pull Value From Log. Equal to 4 (bytes for isService) + 20 (bytes for address) + 32 (bytes for key)

55: /// @dev Format: list of: opening point (16 bytes) || claimed value (32 bytes) || commitment (48 bytes) || proof (48 bytes)) = 144 bytes

79:     /// @param indexRepeatedStorageChanges The serial number of the shortcut index that's used as a unique identifier for storage keys that were used twice or more

99:     /// @param indexRepeatedStorageChanges The serial number of the shortcut index that's used as a unique identifier for storage keys that were used twice or more

103:     /// @param bootloaderHeapInitialContentsHash Hash of the initial contents of the bootloader heap. In practice it serves as the commitment to the transactions in the batch.

104:     /// @param eventsQueueStateHash Hash of the events queue state. In practice it serves as the commitment to the events in the batch.

107:     /// @dev pubdataCommitments format: This will always start with a 1 byte pubdataSource flag. Current allowed values are 0 (calldata) or 1 (blobs)

108:     ///                             kzg: list of: opening point (16 bytes) || claimed value (32 bytes) || commitment (48 bytes) || proof (48 bytes) = 144 bytes

110:     ///                                       and 32 bytes appended to serve as the blob commitment part for the aux output part of the batch commitment

112:     /// @dev When using calldata, we only need to send one blob commitment since the max number of bytes in calldata fits in a single blob and we can pull the

198:     /// @dev It has the name "BlocksVerification" and not "BatchesVerification" due to backward compatibility considerations
```

- *IGetters.sol* ( [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L12), [50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L50), [56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L56), [113](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L113), [116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L116) ):

```solidity
12: /// @title The interface of the Getters Contract that implements functions for getting contract state from outside the blockchain.

50:     /// @return The total number of priority operations that were added to the priority queue, including all processed ones

56:     /// in case exactly *unprocessed* transactions are needed, one should check that getPriorityQueueSize() is greater than 0.

113:     /// @return the baseTokenGasPriceMultiplierNominator, used to compare the baseTokenPrice to ether for L1->L2 transactions

116:     /// @return the baseTokenGasPriceMultiplierDenominator, used to compare the baseTokenPrice to ether for L1->L2 transactions
```

- *IMailbox.sol* ( [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L8), [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L17), [48](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L48), [77](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L77), [81](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L81), [83](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L83), [84](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L84), [85](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L85), [87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L87), [89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L89), [107](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L107) ):

```solidity
8: import {L2CanonicalTransaction, L2Log, L2Message, TxStatus, BridgehubL2TransactionRequest} from "../../common/Messaging.sol";

17:     /// @param _message Information about the sent message: sender address, the message itself, tx index in the L2 batch where the message was sent

48:     /// NOTE: It may return `false` for incorrect proof, but it doesn't mean that the L1 -> L2 transaction has an opposite status!

77:     /// @param _l2GasPerPubdataByteLimit The maximum amount L2 gas that the operator may charge the user for single byte of pubdata.

81:     /// Please note, the contract may change the refund recipient's address to eliminate sending funds to addresses out of control.

83:     /// - If `_refundRecipient` is set to `address(0)` and the sender has NO deployed bytecode on L1, the refund will be sent to the `msg.sender` address.

84:     /// - If `_refundRecipient` is set to `address(0)` and the sender has deployed bytecode on L1, the refund will be sent to the aliased `msg.sender` address.

85:     /// @dev The address aliasing of L1 contracts as refund recipient on L2 is necessary to guarantee that the funds are controllable,

87:     /// Without address aliasing for L1 contracts as refund recipients they would not be able to make proper L2 tx requests

89:     /// @return canonicalTxHash The hash of the requested L2 transaction. This hash can be used to follow the transaction status

107:     /// @param _l2GasPerPubdataByteLimit The maximum amount of L2 gas that the operator may charge the user for a single byte of pubdata.
```

- *Diamond.sol* ( [18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L18), [24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L24), [163](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L163) ):

```solidity
18:     /// @dev Used to distinguish calls to contracts that were supposed to be used as diamond initializer from other contracts.

24:         0xc8fcad8db84d3cc18b4c41d551ea0ee66dd599cde068d998e57d5e09332c131b; // keccak256("diamond.standard.diamond.storage") - 1;

163:             require(oldFacet.facetAddress != address(0), "L"); // it is impossible to replace the facet with zero address
```

- *LibMap.sol* ( [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L8), [62](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L62) ):

```solidity
8: /// @dev This library is an adaptation of the corresponding Solady library (https://github.com/vectorized/solady/blob/main/src/utils/LibMap.sol)

62:             // shifted to its proper position. The XOR operation will effectively replace the old value with the new value.
```

- *Merkle.sol* ( [15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L15) ):

```solidity
15:     /// NOTE: When using this function, check that the _path length is equal to the tree height to prevent shorter/longer paths attack
```

- *PriorityQueue.sol* ( [41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L41) ):

```solidity
41:     /// @return The total number of priority operations that were added to the priority queue, including all processed ones
```

- *TransactionValidator.sol* ( [10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L10), [70](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L70), [109](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L109) ):

```solidity
10: import {TX_SLOT_OVERHEAD_L2_GAS, MEMORY_OVERHEAD_GAS, L1_TX_INTRINSIC_L2_GAS, L1_TX_DELTA_544_ENCODING_BYTES, L1_TX_DELTA_FACTORY_DEPS_L2_GAS, L1_TX_MIN_L2_GAS_BASE, L1_TX_INTRINSIC_PUBDATA, L1_TX_DELTA_FACTORY_DEPS_PUBDATA} from "../../common/Config.sol";

70:     /// Note: The calculation includes the main cost of the priority transaction, however, in reality, the operator can spend a little more gas on overheads.

109:     /// and the L2 gas needed to process the transaction itself (i.e. the actual l2GasLimit that will be used for the transaction).
```

- *BaseZkSyncUpgrade.sol* ( [13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L13), [145](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L145), [147](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L147) ):

```solidity
13: import {MAX_NEW_FACTORY_DEPS, SYSTEM_UPGRADE_L2_TX_TYPE, MAX_ALLOWED_PROTOCOL_VERSION_DELTA} from "../common/Config.sol";

145:         // An upgrade to the verifier params must be done carefully to ensure there aren't batches in the committed state

147:         // Batches committed expecting the old verifier params will fail. Ensure all commited batches are finalized before the
```

- *BaseZkSyncUpgradeGenesis.sol* ( [13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L13) ):

```solidity
13: import {MAX_NEW_FACTORY_DEPS, SYSTEM_UPGRADE_L2_TX_TYPE, MAX_ALLOWED_PROTOCOL_VERSION_DELTA} from "../common/Config.sol";
```

- *L2SharedBridge.sol* ( [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L17), [145](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L145), [164](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L164) ):

```solidity
17: import {L2ContractHelper, DEPLOYER_SYSTEM_CONTRACT, L2_BASE_TOKEN_ADDRESS, IContractDeployer} from "../L2ContractHelper.sol";

145:         // note we use the IL1ERC20Bridge.finalizeWithdrawal function selector to specify the selector for L1<>L2 messages,

164:     /// @dev This function uses raw call to ContractDeployer to make sure that exactly `l2TokenProxyBytecodeHash` is used
```

- *L2StandardERC20.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L7), [21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L21) ):

```solidity
7: import {ERC20PermitUpgradeable} from "@openzeppelin/contracts-upgradeable/token/ERC20/extensions/draft-ERC20PermitUpgradeable.sol";

21:     /// @notice Our goal is to store all the getters that L1 token implements, and for others, we keep it as an unimplemented method.
```

- *AccountCodeStorage.sol* ( [14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L14), [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L17) ):

```solidity
14:  * the second byte denotes whether the contract is constructed, and the next two bytes denote the length in 32-byte words.

17:  * @dev The length of each bytecode MUST be odd.  It's internal code format requirements, due to padding of SHA256 function.
```

- *BootloaderUtilities.sol* ( [6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L6), [21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L21) ):

```solidity
6: import {Transaction, TransactionHelper, EIP_712_TX_TYPE, LEGACY_TX_TYPE, EIP_2930_TX_TYPE, EIP_1559_TX_TYPE} from "./libraries/TransactionHelper.sol";

21:     /// @return txHash and signedTxHash of the transaction, i.e. the transaction hash to be used in the explorer and commits to all
```

- *ComplexUpgrader.sol* ( [11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol#L11) ):

```solidity
11:  * @notice Upgrader which should be used to perform complex multistep upgrades on L2. In case some custom logic for an upgrade is needed
```

- *Compressor.sol* ( [5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L5), [10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L10), [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L17), [41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L41), [43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L43), [82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L82), [85](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L85), [87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L87), [208](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L208), [213](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L213), [214](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L214) ):

```solidity
5: import {ICompressor, OPERATION_BITMASK, LENGTH_BITS_OFFSET, MAX_ENUMERATION_INDEX_SIZE} from "./interfaces/ICompressor.sol";

10: import {L1_MESSENGER_CONTRACT, INITIAL_WRITE_STARTING_POSITION, COMPRESSED_INITIAL_WRITE_SIZE, STATE_DIFF_ENTRY_SIZE, STATE_DIFF_ENUM_INDEX_OFFSET, STATE_DIFF_FINAL_VALUE_OFFSET, STATE_DIFF_DERIVED_KEY_OFFSET, DERIVED_KEY_LENGTH, VALUE_LENGTH, ENUM_INDEX_LENGTH, KNOWN_CODE_STORAGE_CONTRACT} from "./Constants.sol";

17:  * @dev Every deployed bytecode/published state diffs in zkEVM should be publicly restorable from the L1 data availability.

41:     /// @dev Currently, the method may be called only from the bootloader because the server is not ready to publish bytecodes

43:     /// @dev Read more about the compression: https://github.com/matter-labs/zksync-era/blob/main/docs/guides/advanced/compression.md

82:     /// @dev We don't verify that the size of {_stateDiffs} is equivalent to {_numberOfStateDiffs} * STATE_DIFF_ENTRY_SIZE since that check is

85:     /// @dev This check assumes that the ordering of state diffs are sorted by (address, key) for the encoded state diffs and

87:     /// @dev state diff:   [20bytes address][32bytes key][32bytes derived key][8bytes enum index][32bytes initial value][32bytes final value]

208:     /// @notice Verify value compression was done correct given initial value, final value, operation, and compressed value

213:     /// value or difference between initial and final value. It should be of arbitrary length less than or equal to 32 bytes.

214:     /// @dev It is the responsibility of the caller of this function to ensure that the `_compressedValue` has length no longer than 32 bytes.
```

- *Constants.sol* ( [40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L40), [74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L74), [78](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L78), [103](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L103), [106](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L106) ):

```solidity
40: /// - That it is not possible that the pubdata counter grows too high without spending proportional amount of computation.

74: ISystemContext constant REAL_SYSTEM_CONTEXT_CONTRACT = ISystemContext(payable(address(REAL_SYSTEM_CONTRACTS_OFFSET + 0x0b)));

78: // It will be a different value for tests, while shouldn't. But for now, this constant is not used by other contracts, so that's fine.

103: /// @dev Each state diff consists of 156 bytes of actual data and 116 bytes of unused padding, needed for circuit efficiency.

106: /// @dev While the "real" amount of pubdata that can be sent rarely exceeds the BLOB_SIZE_BYTES * MAX_NUMBER_OF_BLOBS, it is better to
```

- *ContractDeployer.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L7), [216](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L216), [217](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L217) ):

```solidity
7: import {CREATE2_PREFIX, CREATE_PREFIX, NONCE_HOLDER_SYSTEM_CONTRACT, ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT, FORCE_DEPLOYER, MAX_SYSTEM_CONTRACT_ADDRESS, KNOWN_CODE_STORAGE_CONTRACT, BASE_TOKEN_SYSTEM_CONTRACT, IMMUTABLE_SIMULATOR_SYSTEM_CONTRACT, COMPLEX_UPGRADER_CONTRACT, KECCAK256_SYSTEM_CONTRACT} from "./Constants.sol";

216:         // Since the `forceDeployOnAddress` function is called only during upgrades, the Governance is trusted to correctly select

217:         // the addresses to deploy the new bytecodes to and to assess whether overriding the AccountInfo for the "force-deployed"
```

- *DefaultAccount.sol* ( [9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L9) ):

```solidity
9: import {BOOTLOADER_FORMAL_ADDRESS, NONCE_HOLDER_SYSTEM_CONTRACT, DEPLOYER_SYSTEM_CONTRACT, INonceHolder} from "./Constants.sol";
```

- *KnownCodesStorage.sol* ( [15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L15) ):

```solidity
15:  * the second byte denotes whether the contract is constructed, and the next two bytes denote the length in 32-byte words.
```

- *L1Messenger.sol* ( [5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L5), [10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L10), [187](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L187), [190](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L190), [277](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L277), [278](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L278) ):

```solidity
5: import {IL1Messenger, L2ToL1Log, L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH, L2_TO_L1_LOG_SERIALIZE_SIZE, STATE_DIFF_COMPRESSION_VERSION_NUMBER} from "./interfaces/IL1Messenger.sol";

10: import {SystemLogKey, SYSTEM_CONTEXT_CONTRACT, KNOWN_CODE_STORAGE_CONTRACT, COMPRESSOR_CONTRACT, STATE_DIFF_ENTRY_SIZE, MAX_ALLOWED_PUBDATA_PER_BATCH, L2_TO_L1_LOGS_MERKLE_TREE_LEAVES, PUBDATA_CHUNK_PUBLISHER, COMPUTATIONAL_PRICE_FOR_PUBDATA} from "./Constants.sol";

187:     ///        processed in the current L1 Batch. Pubdata consists of L2 to L1 Logs, messages, deployed bytecode, and state diffs.

190:     /// @dev The data passed in also contains the encoded state diffs to be checked again, however this is aux data that is not

277:         /// body (`compressedStateDiffSize` bytes, 4 bytes number of state diffs, `numberOfStateDiffs` * `STATE_DIFF_ENTRY_SIZE` bytes for the uncompressed state diffs)

278:         /// encoded state diffs: [20bytes address][32bytes key][32bytes derived key][8bytes enum index][32bytes initial value][32bytes final value]
```

- *L2BaseToken.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L7), [14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L14), [82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L82) ):

```solidity
7: import {MSG_VALUE_SYSTEM_CONTRACT, DEPLOYER_SYSTEM_CONTRACT, BOOTLOADER_FORMAL_ADDRESS, L1_MESSENGER_CONTRACT} from "./Constants.sol";

14:  * @dev It does NOT provide interfaces for personal interaction with tokens like `transfer`, `approve`, and `transferFrom`.

82:     /// @notice Initiate the ETH withdrawal, with the sent message. The funds will be available to claim on L1 `finalizeEthWithdrawal` method.
```

- *MsgValueSimulator.sol* ( [40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L40) ):

```solidity
40:     /// It is equal to the following constant: https://github.com/matter-labs/era-zkevm_opcode_defs/blob/7bf8016f5bb13a73289f321ad6ea8f614540ece9/src/system_params.rs#L96.
```

- *NonceHolder.sol* ( [24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L24) ):

```solidity
24:  * @dev The behavior of some of the methods depends on the nonce ordering of the account. Nonce ordering is a mere suggestion and all the checks that are present
```

- *PubdataChunkPublisher.sol* ( [20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L20) ):

```solidity
20:     /// @dev We always publish 2 system logs even if our pubdata fits into a single blob. This makes processing logs on L1 easier.
```

- *SystemContext.sol* ( [21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L21), [65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L65), [67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L67), [69](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L69), [74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L74), [79](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L79), [139](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L139), [142](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L142), [156](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L156), [157](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L157), [281](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L281), [299](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L299), [340](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L340) ):

```solidity
21:     /// - Store the latest 256 hashes (and strictly rely that we do not accidentally override the hash of the block 256 blocks ago)

65:     /// of the miniblocks cheaper, we only store the previous MINIBLOCK_HASHES_TO_STORE ones. Since whenever we need to publish a state

67:     /// By having this data in a cyclic array of MINIBLOCK_HASHES_TO_STORE blocks, we bring the costs down by 40% (i.e. 40 bytes per miniblock instead of 64 bytes).

69:     /// @dev Hashes of the blocks older than the ones which are stored here can be calculated as _calculateLegacyL2BlockHash(blockNumber).

74:     /// - Their number will start from being equal to the number of the batch and it will increase until it reaches the L2 block number.

79:     /// @notice The information about the virtual blocks upgrade, which tracks when the migration to the L2 blocks has started and finished.

139:         // 2. If the block was created before the upgrade for the virtual blocks (i.e. there we used to use hashes of the batches),

142:         // all the information which is returned for users should be for L2 blocks, we return the hash of the corresponding L2 block.

156:             // Important: we do not want this number to ever collide with the L2 block hash (either new or old one) and so

157:             // that's why the legacy L2 blocks' hashes are keccak256(abi.encodePacked(uint32(_block))), while these are equivalent to

281:             // Note, that when setting the virtual block number we use the batch number to make a smoother upgrade from batch number to

299:         // We do not use a `require` here, since the virtual blocks are a temporary solution to let the Solidity's `block.number`

340:     /// @dev It is also enforced that the number of the current virtual L2 block can not exceed the number of the L2 block.
```

- *IL1Messenger.sol* ( [6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L6), [24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L24) ):

```solidity
6: /// @param l2ShardId The shard identifier, 0 - rollup, 1 - porter. All other values are not used but are reserved for the future

24: /// @dev Equal to the bytes size of the tuple - (uint8 ShardId, bool isService, uint16 txNumberInBlock, address sender, bytes32 key, bytes32 value)
```

- *ISystemContext.sol* ( [25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContext.sol#L25) ):

```solidity
25:         /// all the information returned to users for block.timestamp/number, etc should be the information about the L2 blocks and
```

- *ISystemContextDeprecated.sol* ( [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContextDeprecated.sol#L8) ):

```solidity
8:  * @notice The interface with deprecated functions of the SystemContext contract. It is aimed for backward compatibility.
```

- *EfficientCall.sol* ( [16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L16), [25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L25) ):

```solidity
16:  * In turn, zkEVM operates over a fat pointer, which is a set of (memory page, offset, start, length) in the memory/calldata/returndata.

25:  * 3. `ptr.pack` - Do the concatenation between the lowest 128 bits of the pointer itself and the highest 128 bits of `_value`. It is typically used to prepare the ABI for external calls.
```

- *SystemContractHelper.sol* ( [7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L7), [105](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L105) ):

```solidity
7: import {SystemContractsCaller, CalldataForwardingMode, CALLFLAGS_CALL_ADDRESS, CODE_ADDRESS_CALL_ADDRESS, EVENT_WRITE_ADDRESS, EVENT_INITIALIZE_ADDRESS, GET_EXTRA_ABI_DATA_ADDRESS, LOAD_CALLDATA_INTO_ACTIVE_PTR_CALL_ADDRESS, META_CODE_SHARD_ID_OFFSET, META_CALLER_SHARD_ID_OFFSET, META_SHARD_ID_OFFSET, META_AUX_HEAP_SIZE_OFFSET, META_HEAP_SIZE_OFFSET, META_GAS_PER_PUBDATA_BYTE_OFFSET, MIMIC_CALL_BY_REF_CALL_ADDRESS, META_CALL_ADDRESS, MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT, PTR_CALLDATA_CALL_ADDRESS, PTR_ADD_INTO_ACTIVE_CALL_ADDRESS, PTR_SHRINK_INTO_ACTIVE_CALL_ADDRESS, PTR_PACK_INTO_ACTIVE_CALL_ADDRESS, RAW_FAR_CALL_BY_REF_CALL_ADDRESS, PRECOMPILE_CALL_ADDRESS, SET_CONTEXT_VALUE_CALL_ADDRESS, SYSTEM_CALL_BY_REF_CALL_ADDRESS, TO_L1_CALL_ADDRESS} from "./SystemContractsCaller.sol";

105:     /// @dev Transforms `ACTIVE_PTR.length` into `ACTIVE_PTR.length - u32(_shrink)`. If underflow happens then it panics.
```

- *TransactionHelper.sol* ( [86](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L86), [291](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L291) ):

```solidity
86:             "Transaction(uint256 txType,uint256 from,uint256 to,uint256 gasLimit,uint256 gasPerPubdataByteLimit,uint256 maxFeePerGas,uint256 maxPriorityFeePerGas,uint256 paymaster,uint256 nonce,uint256 value,bytes data,bytes32[] factoryDeps,bytes paymasterInput)"

291:         // H(0x02 || RLP(chain_id, nonce, max_priority_fee_per_gas, max_fee_per_gas, gas_limit, destination, amount, data, access_list))
```

- *UnsafeBytesCalldata.sol* ( [9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L9) ):

```solidity
9:  * @dev Each of the functions accepts the `bytes calldata` and the offset where data should be read and returns a value of a certain type.
```

- *Utils.sol* ( [55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L55) ):

```solidity
55:     /// @notice Denotes whether bytecode hash corresponds to a contract that is on constructor or has already been constructed
```

</details>

### [N-41] Magic numbers should be replaced with constants

Magic numbers are hard-coded values in code that can make it difficult for developers and maintainers to understand the code, and can also cause confusion or errors. To improve the readability and maintainability of code, it is recommended to replace magic numbers with constants that have good readability.

<details>
<summary>There are 180 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [239-239](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L239-L239), [503-503](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L503-L503), [519-519](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L519-L519) ):

```solidity
239:         require(depositHappened[_chainId][_txHash] == 0x00, "ShB tx hap");

503:         require(_l2ToL1message.length >= 56, "ShB wrong msg len"); // wrong messsage length

519:             require(_l2ToL1message.length == 76, "ShB wrong msg len 2");
```

- *L2ContractHelper.sol* ( [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L25-L25), [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L27-L27), [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L28-L28), [30-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L30-L30), [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L32-L32), [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L34-L34), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L52-L52) ):

```solidity
25:         require(_bytecode.length % 32 == 0, "pq");

27:         uint256 bytecodeLenInWords = _bytecode.length / 32;

28:         require(bytecodeLenInWords < 2 ** 16, "pp"); // bytecode length must be less than 2^16 words

30:         hashedBytecode = sha256(_bytecode) & 0x00000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF;

32:         hashedBytecode = (hashedBytecode | bytes32(uint256(1 << 248)));

34:         hashedBytecode = hashedBytecode | bytes32(bytecodeLenInWords << 224);

52:         codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3]));
```

- *StateTransitionManager.sol* ( [108-108](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L108-L108), [188-188](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L188-L188) ):

```solidity
108:         assert(L2_TO_L1_LOG_SERIALIZE_SIZE != 2 * 32);

188:             gasLimit: 72000000,
```

- *DiamondInit.sol* ( [53-53](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L53-L53) ):

```solidity
53:         assert(L2_TO_L1_LOG_SERIALIZE_SIZE != 2 * 32);
```

- *DiamondProxy.sol* ( [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L27-L27) ):

```solidity
27:         require(msg.data.length >= 4 || msg.data.length == 0, "Ut");
```

- *Executor.sol* ( [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L52-L52), [65-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L65-L65), [70-70](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L70-L70), [111-111](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L111-L111), [194-194](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L194-L194), [196-196](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L196-L196) ):

```solidity
52:             require(logOutput.pubdataHash == 0x00, "v0h");

65:                     keccak256(_newBatch.pubdataCommitments[1:_newBatch.pubdataCommitments.length - 32]),

70:                 _newBatch.pubdataCommitments[_newBatch.pubdataCommitments.length - 32:_newBatch

111:         uint256 batchTimestamp = _packedBatchAndL2BlockTimestamp >> 128;

194:             require(processedLogs == 511, "b7");

196:             require(processedLogs == 1023, "b8");
```

- *Diamond.sol* ( [288-288](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L288-L288), [299-299](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L299-L299) ):

```solidity
288:                 if (data.length <= 4) {

299:             require(data.length == 32, "lp");
```

- *LibMap.sol* ( [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L25-L25), [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L29-L29), [45-45](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L45-L45), [50-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L50-L50) ):

```solidity
25:             uint256 mapValue = _map.map[_index / 8];

29:             uint256 bitOffset = (_index & 7) * 32;

45:             uint256 mapIndex = _index / 8;

50:             uint256 bitOffset = (_index & 7) * 32;
```

- *Merkle.sol* ( [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L27-L27) ):

```solidity
27:         require(pathLength < 256, "bt");
```

- *TransactionValidator.sol* ( [59-59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L59-L59), [85-85](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L85-L85) ):

```solidity
59:         require(_transaction.reserved[3] == 0, "uo");

85:             costForComputation += Math.ceilDiv(_encodingLength * L1_TX_DELTA_544_ENCODING_BYTES, 544);
```

- *SystemContractsCaller.sol* ( [118-118](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L118-L118), [119-119](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L119-L119), [120-120](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L120-L120), [130-130](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L130-L130), [131-131](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L131-L131), [132-132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L132-L132), [134-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L134-L134), [137-137](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L137-L137) ):

```solidity
118:         farCallAbi |= (uint256(memoryPage) << 32);

119:         farCallAbi |= (uint256(dataStart) << 64);

120:         farCallAbi |= (uint256(dataLength) << 96);

130:         farCallAbiWithEmptyFatPtr |= (uint256(gasPassed) << 192);

131:         farCallAbiWithEmptyFatPtr |= (uint256(forwardingMode) << 224);

132:         farCallAbiWithEmptyFatPtr |= (uint256(shardId) << 232);

134:             farCallAbiWithEmptyFatPtr |= (1 << 240);

137:             farCallAbiWithEmptyFatPtr |= (1 << 248);
```

- *AccountCodeStorage.sol* ( [102-102](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L102-L102), [133-133](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L133-L133) ):

```solidity
102:         if (codeHash == 0x00 && NONCE_HOLDER_SYSTEM_CONTRACT.getRawNonce(account) > 0) {

133:             codeHash != 0x00 &&
```

- *BootloaderUtilities.sol* ( [72-72](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L72-L72), [81-81](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L81-L81), [86-86](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L86-L86), [91-91](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L91-L91), [92-92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L92-L92), [97-97](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L97-L97), [168-168](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L168-L168), [180-180](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L180-L180), [185-185](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L185-L185), [190-190](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L190-L190), [191-191](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L191-L191), [193-193](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L193-L193), [263-263](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L263-L263), [275-275](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L275-L275), [280-280](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L280-L280), [285-285](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L285-L285), [286-286](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L286-L286), [288-288](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L288-L288) ):

```solidity
72:             } else if (_transaction.data[0] >= 0x80) {

81:             uint256 rInt = uint256(bytes32(_transaction.signature[0:32]));

86:             uint256 sInt = uint256(bytes32(_transaction.signature[32:64]));

91:             uint256 vInt = uint256(uint8(_transaction.signature[64]));

92:             require(vInt == 27 || vInt == 28, "Invalid v value");

97:                 vInt += 8 + block.chainid * 2;

168:             } else if (_transaction.data[0] >= 0x80) {

180:             uint256 rInt = uint256(bytes32(_transaction.signature[0:32]));

185:             uint256 sInt = uint256(bytes32(_transaction.signature[32:64]));

190:             uint256 vInt = uint256(uint8(_transaction.signature[64]));

191:             require(vInt == 27 || vInt == 28, "Invalid v value");

193:             vEncoded = RLPEncoder.encodeUint256(vInt - 27);

263:             } else if (_transaction.data[0] >= 0x80) {

275:             uint256 rInt = uint256(bytes32(_transaction.signature[0:32]));

280:             uint256 sInt = uint256(bytes32(_transaction.signature[32:64]));

285:             uint256 vInt = uint256(uint8(_transaction.signature[64]));

286:             require(vInt == 27 || vInt == 28, "Invalid v value");

288:             vEncoded = RLPEncoder.encodeUint256(vInt - 27);
```

- *Compressor.sol* ( [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L52-L52), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L57-L57), [62-62](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L62-L62), [66-66](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L66-L66), [129-129](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L129-L129), [137-137](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L137-L137), [138-138](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L138-L138), [139-139](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L139-L139), [141-141](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L141-L141), [146-146](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L146-L146), [161-161](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L161-L161), [166-166](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L166-L166), [167-167](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L167-L167), [177-177](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L177-L177), [203-203](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L203-L203), [204-204](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L204-L204), [229-229](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L229-L229), [253-253](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L253-L253) ):

```solidity
52:                 encodedData.length * 4 == _bytecode.length,

57:                 dictionary.length / 8 <= encodedData.length / 2,

62:                 uint256 indexOfEncodedChunk = uint256(encodedData.readUint16(encodedDataPointer)) * 8;

66:                 uint64 realChunk = _bytecode.readUint64(encodedDataPointer * 4);

129:             uint64 enumIndex = stateDiff.readUint64(84);

137:             bytes32 derivedKey = stateDiff.readBytes32(52);

138:             uint256 initValue = stateDiff.readUint256(92);

139:             uint256 finalValue = stateDiff.readUint256(124);

141:             stateDiffPtr += 32;

146:             uint8 len = operation == 0 ? 32 : metadata >> LENGTH_BITS_OFFSET;

161:             uint64 enumIndex = stateDiff.readUint64(84);

166:             uint256 initValue = stateDiff.readUint256(92);

167:             uint256 finalValue = stateDiff.readUint256(124);

177:             uint8 len = operation == 0 ? 32 : metadata >> LENGTH_BITS_OFFSET;

203:             dictionary = _rawCompressedData[2:2 + dictionaryLen * 8];

204:             encodedData = _rawCompressedData[2 + dictionaryLen * 8:];

229:             if (_operation == 0 || _operation == 3) {

253:         number >>= (256 - (_calldataSlice.length * 8));
```

- *ContractDeployer.sol* ( [264-264](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L264-L264), [269-269](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L269-L269), [273-273](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L273-L273) ):

```solidity
264:         require(_bytecodeHash != bytes32(0x0), "BytecodeHash cannot be zero");

269:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.getCodeHash(uint256(uint160(_newAddress))) == 0x0,

273:         require(NONCE_HOLDER_SYSTEM_CONTRACT.getRawNonce(_newAddress) == 0x00, "Account is occupied");
```

- *DefaultAccount.sol* ( [139-139](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L139-L139), [140-140](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L140-L140), [160-160](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L160-L160), [173-173](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L173-L173), [184-184](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L184-L184) ):

```solidity
139:         if (to == address(DEPLOYER_SYSTEM_CONTRACT) && data.length >= 4) {

140:             bytes4 selector = bytes4(data[:4]);

160:         require(_signature.length == 65, "Signature length is incorrect");

173:         require(v == 27 || v == 28, "v is neither 27 nor 28");

184:         require(uint256(s) <= 0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF5D576E7357A4501DDFE92F46681B20A0, "Invalid s");
```

- *L1Messenger.sol* ( [62-62](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L62-L62), [89-89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L89-L89), [140-140](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L140-L140), [149-149](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L149-L149), [150-150](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L150-L150), [171-171](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L171-L171), [176-176](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L176-L176), [200-200](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L200-L200), [202-202](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L202-L202), [233-233](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L233-L233), [234-234](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L234-L234), [237-237](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L237-L237), [238-238](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L238-L238), [251-251](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L251-L251), [252-252](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L252-L252), [256-256](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L256-L256), [258-258](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L258-L258), [286-286](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L286-L286), [287-287](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L287-L287), [300-300](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L300-L300), [301-301](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L301-L301) ):

```solidity
62:         return SHA256_ROUND_GAS_COST * ((_length + 8) / SHA256_ROUND_NUMBER_OF_BYTES + 1);

89:         uint256 gasToPay = keccakGasCost(L2_TO_L1_LOG_SERIALIZE_SIZE) + 2 * keccakGasCost(64);

140:             pubdataLen = 4 + _message.length + L2_TO_L1_LOG_SERIALIZE_SIZE;

149:             3 *

150:             keccakGasCost(64) +

171:             pubdataLen = 4 + bytecodeLen;

176:             keccakGasCost(64) +

200:         uint32 numberOfL2ToL1Logs = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));

202:         calldataPtr += 4;

233:         uint32 numberOfMessages = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));

234:         calldataPtr += 4;

237:             uint32 currentMessageLength = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));

238:             calldataPtr += 4;

251:         uint32 numberOfBytecodes = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));

252:         calldataPtr += 4;

256:                 bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4])

258:             calldataPtr += 4;

286:         uint24 compressedStateDiffSize = uint24(bytes3(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 3]));

287:         calldataPtr += 3;

300:         uint32 numberOfStateDiffs = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));

301:         calldataPtr += 4;
```

- *SystemContext.sol* ( [44-44](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L44-L44), [144-144](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L144-L144), [416-416](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L416-L416), [498-498](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L498-L498) ):

```solidity
44:     uint256 public difficulty = 2.5e15;

144:         if (blockNumber <= _block || blockNumber - _block > 256) {

416:         uint256 packedTimestamps = (uint256(currentBatchTimestamp) << 128) | currentL2BlockTimestamp;

498:         blockInfo = (uint256(blockNumber) << 128) | uint256(blockTimestamp);
```

- *EfficientCall.sol* ( [38-38](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L38-L38), [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L47-L47) ):

```solidity
38:         require(returnData.length == 32, "keccak256 returned invalid data");

47:         require(returnData.length == 32, "sha returned invalid data");
```

- *RLPEncoder.sol* ( [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L13-L13), [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L26-L26), [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L29-L29), [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L34-L34), [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L36-L36), [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L37-L37), [51-51](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L51-L51), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L57-L57), [62-62](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L62-L62), [69-69](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L69-L69), [71-71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L71-L71), [72-72](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L72-L72), [87-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L87-L87), [88-88](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L88-L88), [91-91](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L91-L91), [92-92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L92-L92), [95-95](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L95-L95), [96-96](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L96-L96), [99-99](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L99-L99) ):

```solidity
13:         encoded = new bytes(0x15);

26:             if (_val < 128) {

29:                 encoded[0] = (_val == 0) ? bytes1(uint8(128)) : bytes1(uint8(_val));

34:                 encoded[0] = bytes1(uint8(hbs + 0x81));

36:                 uint256 lbs = 31 - hbs;

37:                 uint256 shiftedVal = _val << (lbs * 8);

51:         return _encodeLength(_len, 0x80);

57:         return _encodeLength(_len, 0xc0);

62:             if (_len < 56) {

69:                 encoded[0] = bytes1(uint8(_offset + hbs + 56));

71:                 uint256 lbs = 31 - hbs;

72:                 uint256 shiftedVal = uint256(_len) << (lbs * 8);

87:                 _number >>= 128;

88:                 hbs += 16;

91:                 _number >>= 64;

92:                 hbs += 8;

95:                 _number >>= 32;

96:                 hbs += 4;

99:                 _number >>= 16;
```

- *SystemContractHelper.sol* ( [132-132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L132-L132), [133-133](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L133-L133), [134-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L134-L134), [135-135](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L135-L135), [155-155](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L155-L155), [217-217](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L217-L217), [219-219](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L219-L219), [228-228](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L228-L228), [238-238](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L238-L238), [247-247](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L247-L247), [255-255](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L255-L255), [264-264](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L264-L264), [273-273](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L273-L273) ):

```solidity
132:         rawParams |= uint256(_inputMemoryLength) << 32;

133:         rawParams |= uint256(_outputMemoryOffset) << 64;

134:         rawParams |= uint256(_outputMemoryLength) << 96;

135:         rawParams |= uint256(_perPrecompileInterpreted) << 192;

155:         uint256 params = uint256(_gasToBurn) + (uint256(_pubdataToSpend) << 32);

217:         uint256 shifted = (meta << (256 - size - offset));

219:         result = (shifted >> (256 - size));

228:         pubdataPublished = uint32(extractNumberFromMeta(meta, META_GAS_PER_PUBDATA_BYTE_OFFSET, 32));

238:         heapSize = uint32(extractNumberFromMeta(meta, META_HEAP_SIZE_OFFSET, 32));

247:         auxHeapSize = uint32(extractNumberFromMeta(meta, META_AUX_HEAP_SIZE_OFFSET, 32));

255:         shardId = uint8(extractNumberFromMeta(meta, META_SHARD_ID_OFFSET, 8));

264:         callerShardId = uint8(extractNumberFromMeta(meta, META_CALLER_SHARD_ID_OFFSET, 8));

273:         codeShardId = uint8(extractNumberFromMeta(meta, META_CODE_SHARD_ID_OFFSET, 8));
```

- *SystemContractsCaller.sol* ( [235-235](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L235-L235), [236-236](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L236-L236), [237-237](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L237-L237), [257-257](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L257-L257), [258-258](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L258-L258), [259-259](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L259-L259), [261-261](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L261-L261), [264-264](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L264-L264) ):

```solidity
235:         farCallAbi |= (uint256(memoryPage) << 32);

236:         farCallAbi |= (uint256(dataStart) << 64);

237:         farCallAbi |= (uint256(dataLength) << 96);

257:         farCallAbiWithEmptyFatPtr |= (uint256(gasPassed) << 192);

258:         farCallAbiWithEmptyFatPtr |= (uint256(forwardingMode) << 224);

259:         farCallAbiWithEmptyFatPtr |= (uint256(shardId) << 232);

261:             farCallAbiWithEmptyFatPtr |= (1 << 240);

264:             farCallAbiWithEmptyFatPtr |= (1 << 248);
```

- *TransactionHelper.sol* ( [175-175](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L175-L175), [253-253](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L253-L253), [325-325](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L325-L325), [363-363](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L363-L363), [365-365](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L365-L365), [368-368](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L368-L368), [374-374](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L374-L374) ):

```solidity
175:             } else if (_transaction.data[0] >= 0x80) {

253:             } else if (_transaction.data[0] >= 0x80) {

325:             } else if (_transaction.data[0] >= 0x80) {

363:         require(_transaction.paymasterInput.length >= 4, "The standard paymaster input must be at least 4 bytes long");

365:         bytes4 paymasterInputSelector = bytes4(_transaction.paymasterInput[0:4]);

368:                 _transaction.paymasterInput.length >= 68,

374:             (address token, uint256 minAllowance) = abi.decode(_transaction.paymasterInput[4:68], (address, uint256));
```

- *Utils.sol* ( [40-40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L40-L40), [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L46-L46), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L52-L52), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L57-L57), [84-84](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L84-L84), [86-86](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L86-L86), [87-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L87-L87), [91-91](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L91-L91), [93-93](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L93-L93), [95-95](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L95-L95) ):

```solidity
40:         codeLength = bytecodeLenInWords(_bytecodeHash) << 5; // _bytecodeHash * 32

46:             codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3]));

52:         return _bytecodeHash[1] == 0x00;

57:         return _bytecodeHash[1] == 0x01;

84:         require(_bytecode.length % 32 == 0, "po");

86:         uint256 lengthInWords = _bytecode.length / 32;

87:         require(lengthInWords < 2 ** 16, "pp"); // bytecode length must be less than 2^16 words

91:             0x00000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF;

93:         hashedBytecode = (hashedBytecode | bytes32(uint256(1 << 248)));

95:         hashedBytecode = hashedBytecode | bytes32(lengthInWords << 224);
```

</details>

### [N-42] Expressions for constant values should use `immutable` rather than `constant`

While it doesn't save any gas because the compiler knows that developers often make this mistake, it's still best to use the right tool for the task at hand. There is a difference between `constant` variables and `immutable` variables, and they should each be used in their appropriate contexts. `constants` should be used for literal values written into the code, and `immutable` variables should be used for expressions, or values calculated in, or passed into the constructor.

<details>
<summary>There are 36 instances (click to show):</summary>

- *Config.sol* ( [114-114](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L114-L114) ):

```solidity
114: bytes32 constant TWO_BRIDGES_MAGIC_VALUE = bytes32(uint256(keccak256("TWO_BRIDGES_MAGIC_VALUE")) - 1);
```

- *L2ContractHelper.sol* ( [14-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L14-L14) ):

```solidity
14:     bytes32 private constant CREATE2_PREFIX = keccak256("zksyncCreate2");
```

- *L2ContractHelper.sol* ( [87-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L87-L87) ):

```solidity
87:     bytes32 private constant CREATE2_PREFIX = keccak256("zksyncCreate2");
```

- *SystemContractsCaller.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L9-L9) ):

```solidity
9: address constant SYSTEM_CALL_CALL_ADDRESS = address((1 << 16) - 11);
```

- *IPaymaster.sol* ( [14-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L14-L14) ):

```solidity
14: bytes4 constant PAYMASTER_VALIDATION_SUCCESS_MAGIC = IPaymaster.validateAndPayForPaymasterTransaction.selector;
```

- *IAccount.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IAccount.sol#L7-L7) ):

```solidity
7: bytes4 constant ACCOUNT_VALIDATION_SUCCESS_MAGIC = IAccount.validateTransaction.selector;
```

- *IPaymaster.sol* ( [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L12-L12) ):

```solidity
12: bytes4 constant PAYMASTER_VALIDATION_SUCCESS_MAGIC = IPaymaster.validateAndPayForPaymasterTransaction.selector;
```

- *SystemContractsCaller.sol* ( [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L12-L12), [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L13-L13), [14-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L14-L14), [15-15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L15-L15), [16-16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L16-L16), [17-17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L17-L17), [18-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L18-L18), [19-19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L19-L19), [20-20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L20-L20), [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L21-L21), [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L22-L22), [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L23-L23), [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L24-L24), [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L25-L25), [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L26-L26), [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L27-L27), [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L28-L28), [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L29-L29), [30-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L30-L30), [31-31](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L31-L31), [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L32-L32), [33-33](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L33-L33), [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L34-L34), [35-35](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L35-L35), [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L36-L36), [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L37-L37), [38-38](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L38-L38) ):

```solidity
12: address constant TO_L1_CALL_ADDRESS = address((1 << 16) - 1);

13: address constant CODE_ADDRESS_CALL_ADDRESS = address((1 << 16) - 2);

14: address constant PRECOMPILE_CALL_ADDRESS = address((1 << 16) - 3);

15: address constant META_CALL_ADDRESS = address((1 << 16) - 4);

16: address constant MIMIC_CALL_CALL_ADDRESS = address((1 << 16) - 5);

17: address constant SYSTEM_MIMIC_CALL_CALL_ADDRESS = address((1 << 16) - 6);

18: address constant MIMIC_CALL_BY_REF_CALL_ADDRESS = address((1 << 16) - 7);

19: address constant SYSTEM_MIMIC_CALL_BY_REF_CALL_ADDRESS = address((1 << 16) - 8);

20: address constant RAW_FAR_CALL_CALL_ADDRESS = address((1 << 16) - 9);

21: address constant RAW_FAR_CALL_BY_REF_CALL_ADDRESS = address((1 << 16) - 10);

22: address constant SYSTEM_CALL_CALL_ADDRESS = address((1 << 16) - 11);

23: address constant SYSTEM_CALL_BY_REF_CALL_ADDRESS = address((1 << 16) - 12);

24: address constant SET_CONTEXT_VALUE_CALL_ADDRESS = address((1 << 16) - 13);

25: address constant SET_PUBDATA_PRICE_CALL_ADDRESS = address((1 << 16) - 14);

26: address constant INCREMENT_TX_COUNTER_CALL_ADDRESS = address((1 << 16) - 15);

27: address constant PTR_CALLDATA_CALL_ADDRESS = address((1 << 16) - 16);

28: address constant CALLFLAGS_CALL_ADDRESS = address((1 << 16) - 17);

29: address constant PTR_RETURNDATA_CALL_ADDRESS = address((1 << 16) - 18);

30: address constant EVENT_INITIALIZE_ADDRESS = address((1 << 16) - 19);

31: address constant EVENT_WRITE_ADDRESS = address((1 << 16) - 20);

32: address constant LOAD_CALLDATA_INTO_ACTIVE_PTR_CALL_ADDRESS = address((1 << 16) - 21);

33: address constant LOAD_LATEST_RETURNDATA_INTO_ACTIVE_PTR_CALL_ADDRESS = address((1 << 16) - 22);

34: address constant PTR_ADD_INTO_ACTIVE_CALL_ADDRESS = address((1 << 16) - 23);

35: address constant PTR_SHRINK_INTO_ACTIVE_CALL_ADDRESS = address((1 << 16) - 24);

36: address constant PTR_PACK_INTO_ACTIVE_CALL_ADDRESS = address((1 << 16) - 25);

37: address constant MULTIPLICATION_HIGH_ADDRESS = address((1 << 16) - 26);

38: address constant GET_EXTRA_ABI_DATA_ADDRESS = address((1 << 16) - 27);
```

- *TransactionHelper.sol* ( [82-82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L82-L82), [84-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L84-L87) ):

```solidity
82:     bytes32 constant EIP712_DOMAIN_TYPEHASH = keccak256("EIP712Domain(string name,string version,uint256 chainId)");

84:     bytes32 constant EIP712_TRANSACTION_TYPE_HASH =
85:         keccak256(
86:             "Transaction(uint256 txType,uint256 from,uint256 to,uint256 gasLimit,uint256 gasPerPubdataByteLimit,uint256 maxFeePerGas,uint256 maxPriorityFeePerGas,uint256 paymaster,uint256 nonce,uint256 value,bytes data,bytes32[] factoryDeps,bytes paymasterInput)"
87:         );
```

</details>

### [N-43] Consider moving duplicated strings to constants

Moving duplicate strings to constants can improve code maintainability and readability.

<details>
<summary>There are 34 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [145-145](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L145-L145) ):

```solidity
145:         require(amount == _amount, "3T"); // The token has non-standard transfer logic
```

- *L1SharedBridge.sol* ( [163-163](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L163-L163) ):

```solidity
163:             require(amount == _amount, "3T"); // The token has non-standard transfer logic
```

- *Bridgehub.sol* ( [48-48](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L48-L48), [64-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L64-L64) ):

```solidity
48:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin");

64:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights
```

- *StateTransitionManager.sol* ( [72-72](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L72-L72), [123-123](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L123-L123) ):

```solidity
72:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin");

123:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights
```

- *ValidatorTimelock.sol* ( [197-197](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L197-L197), [219-219](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L219-L219) ):

```solidity
197:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c"); // The delay is not passed

219:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c"); // The delay is not passed
```

- *BaseZkSyncUpgrade.sol* ( [74-74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L74-L74), [242-242](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L242-L242), [246-246](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L246-L246), [251-251](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L251-L251), [254-254](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L254-L254) ):

```solidity
74:         require(block.timestamp >= _proposedUpgrade.upgradeTimestamp, "Upgrade is not ready yet");

242:             "New protocol version is not greater than the current one"

246:             "Too big protocol version difference"

251:         require(s.l2SystemContractsUpgradeTxHash == bytes32(0), "Previous upgrade has not been finalized");

254:             "The batch number of the previous upgrade has not been cleaned"
```

- *BaseZkSyncUpgradeGenesis.sol* ( [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L27-L27), [31-31](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L31-L31), [35-35](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L35-L35), [38-38](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L38-L38), [54-54](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L54-L54) ):

```solidity
27:             "New protocol version is not greater than the current one"

31:             "Too big protocol version difference"

35:         require(s.l2SystemContractsUpgradeTxHash == bytes32(0), "Previous upgrade has not been finalized");

38:             "The batch number of the previous upgrade has not been cleaned"

54:         require(block.timestamp >= _proposedUpgrade.upgradeTimestamp, "Upgrade is not ready yet");
```

- *L2SharedBridge.sol* ( [58-58](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L58-L58), [60-60](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L60-L60) ):

```solidity
58:         require(_l2TokenProxyBytecodeHash != bytes32(0), "df");

60:         require(_l2TokenProxyBytecodeHash != bytes32(0), "df");
```

- *AccountCodeStorage.sol* ( [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L26-L26), [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L37-L37), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L57-L57) ):

```solidity
26:         require(msg.sender == address(DEPLOYER_SYSTEM_CONTRACT), "Callable only by the deployer system contract");

37:         require(Utils.isContractConstructing(_hash), "Code hash is not for a contract on constructor");

57:         require(Utils.isContractConstructing(codeHash), "Code hash is not for a contract on constructor");
```

- *BootloaderUtilities.sol* ( [92-92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L92-L92), [191-191](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L191-L191), [213-213](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L213-L213), [286-286](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L286-L286), [308-308](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L308-L308) ):

```solidity
92:             require(vInt == 27 || vInt == 28, "Invalid v value");

191:             require(vInt == 27 || vInt == 28, "Invalid v value");

213:                     "\x01",

286:             require(vInt == 27 || vInt == 28, "Invalid v value");

308:                     "\x02",
```

- *ImmutableSimulator.sol* ( [35-35](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L35-L35) ):

```solidity
35:         require(msg.sender == address(DEPLOYER_SYSTEM_CONTRACT), "Callable only by the deployer system contract");
```

- *TransactionHelper.sol* ( [277-277](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L277-L277), [349-349](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L349-L349) ):

```solidity
277:                     "\x01",

349:                     "\x02",
```

- *Utils.sol* ( [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L21-L21), [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L27-L27), [33-33](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L33-L33) ):

```solidity
21:         require(_x <= type(uint128).max, "Overflow");

27:         require(_x <= type(uint32).max, "Overflow");

33:         require(_x <= type(uint24).max, "Overflow");
```

</details>

### [N-44] Functions not used internally could be marked external

If desired, sub contracts can change the visibility from `external` to `public` by [overriding](https://docs.soliditylang.org/en/v0.8.20/contracts.html#function-overriding) the functions of their parents.

<details>
<summary>There are 15 instances (click to show):</summary>

- *Mailbox.sol* ( [56-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L56-L61), [76-83](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L76-L83), [145-149](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L145-L149) ):

```solidity
56:     function proveL2MessageInclusion(
57:         uint256 _batchNumber,
58:         uint256 _index,
59:         L2Message memory _message,
60:         bytes32[] calldata _proof
61:     ) public view returns (bool) {

76:     function proveL1ToL2TransactionStatus(
77:         bytes32 _l2TxHash,
78:         uint256 _l2BatchNumber,
79:         uint256 _l2MessageIndex,
80:         uint16 _l2TxNumberInBatch,
81:         bytes32[] calldata _merkleProof,
82:         TxStatus _status
83:     ) public view returns (bool) {

145:     function l2TransactionBaseCost(
146:         uint256 _gasPrice,
147:         uint256 _l2GasLimit,
148:         uint256 _l2GasPerPubdataByteLimit
149:     ) public view returns (uint256) {
```

- *DefaultUpgrade.sol* ( [15-15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L15-L15) ):

```solidity
15:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
```

- *GenesisUpgrade.sol* ( [16-16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L16-L16) ):

```solidity
16:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
```

- *L2StandardERC20.sol* ( [161-161](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L161-L161), [167-167](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L167-L167), [173-173](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L173-L173) ):

```solidity
161:     function name() public view override returns (string memory) {

167:     function symbol() public view override returns (string memory) {

173:     function decimals() public view override returns (uint8) {
```

- *ContractDeployer.sol* ( [40-40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L40-L40) ):

```solidity
40:     function extendedAccountVersion(address _address) public view returns (AccountAbstractionVersion) {
```

- *NonceHolder.sol* ( [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L57-L57), [65-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L65-L65), [82-82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L82-L82), [102-102](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L102-L102) ):

```solidity
57:     function getRawNonce(address _address) public view returns (uint256) {

65:     function increaseMinNonce(uint256 _value) public onlySystemCall returns (uint256 oldMinNonce) {

82:     function setValueUnderNonce(uint256 _key, uint256 _value) public onlySystemCall {

102:     function getValueUnderNonce(uint256 _key) public view returns (uint256) {
```

- *SystemContext.sol* ( [190-190](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L190-L190), [198-198](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L198-L198) ):

```solidity
190:     function getBlockNumber() public view returns (uint128) {

198:     function getBlockTimestamp() public view returns (uint128) {
```

</details>

### [N-45] Contracts containing only utility functions should be made into libraries

Consider using a `library` instead of a `contract` to provide utility functions.

<details>
<summary>There are 7 instances (click to show):</summary>

- *ReentrancyGuard.sol* ( [27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L27) ):

```solidity
27: abstract contract ReentrancyGuard {
```

- *AccountCodeStorage.sol* ( [22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L22) ):

```solidity
22: contract AccountCodeStorage is IAccountCodeStorage {
```

- *BootloaderUtilities.sol* ( [16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L16) ):

```solidity
16: contract BootloaderUtilities is IBootloaderUtilities {
```

- *KnownCodesStorage.sol* ( [18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L18) ):

```solidity
18: contract KnownCodesStorage is IKnownCodesStorage, ISystemContract {
```

- *MsgValueSimulator.sol* ( [19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L19) ):

```solidity
19: contract MsgValueSimulator is ISystemContract {
```

- *PubdataChunkPublisher.sol* ( [16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L16) ):

```solidity
16: contract PubdataChunkPublisher is IPubdataChunkPublisher, ISystemContract {
```

- *ISystemContract.sol* ( [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContract.sol#L17) ):

```solidity
17: abstract contract ISystemContract {
```

</details>

### [N-46] Contract uses both `require()`/`revert()` as well as custom errors

Consider using just one method in a single file.

There is 1 instance:

- *ValidatorTimelock.sol* ( [24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L24) ):

```solidity
24: contract ValidatorTimelock is IExecutor, Ownable2Step {
```

### [N-47] Functions should be named in mixedCase style

As the [Solidity Style Guide](https://docs.soliditylang.org/en/v0.8.21/style-guide.html#function-names) suggests: functions should be named in mixedCase style.

There are 6 instances:

- *Mailbox.sol* ( [132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L132) ):

```solidity
132:     function _L2MessageToLog(L2Message memory _message) internal pure returns (L2Log memory) {
```

- *SystemContractsCaller.sol* ( [97](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L97), [123](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L123) ):

```solidity
97:     function getFarCallABI(

123:     function getFarCallABIWithEmptyFatPointer(
```

- *EfficientCall.sol* ( [245](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L245) ):

```solidity
245:     function _loadFarCallABIIntoActivePtr(
```

- *SystemContractsCaller.sol* ( [214](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L214), [250](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L250) ):

```solidity
214:     function getFarCallABI(

250:     function getFarCallABIWithEmptyFatPointer(
```

### [N-48] Variable names for `immutable`s should use UPPER_CASE_WITH_UNDERSCORES

For `immutable` variable names, each word should use all capital letters, with underscores separating each word (UPPER_CASE_WITH_UNDERSCORES)

There are 5 instances:

- *L1ERC20Bridge.sol* ( [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L25-L25) ):

```solidity
25:     IL1SharedBridge public immutable override sharedBridge;
```

- *L1SharedBridge.sol* ( [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L36-L36), [39-39](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L39-L39), [42-42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L42-L42) ):

```solidity
36:     address public immutable override l1WethAddress;

39:     IBridgehub public immutable override bridgehub;

42:     IL1ERC20Bridge public immutable override legacyBridge;
```

- *StateTransitionManager.sol* ( [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L29-L29) ):

```solidity
29:     address public immutable bridgehub;
```

### [N-49] Order of contract layout does not follow the Solidity Style Guide

As suggested by the [Solidity Style Guide](https://docs.soliditylang.org/en/v0.8.20/style-guide.html#order-of-layout):
- Layout contract elements in the following order: `pragma statements`, `import statements`, `interfaces`, `libraries`, `contracts`.
- Inside each contract, library or interface, use the following order: `type declarations`, `state variables`, `events`, `errors`, `modifiers`, `functions`.

<details>
<summary>There are 17 instances (click to show):</summary>

- *Bridgehub.sol* ( [47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L47) ):

```solidity
/// @audit ↑ Out of order with function initialize()
47:     modifier onlyOwnerOrAdmin() {
```

- *IBridgehub.sol* ( [135](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L135) ):

```solidity
/// @audit ↑ Out of order with function setSharedBridge()
135:     event NewChain(uint256 indexed chainId, address stateTransitionManager, address indexed chainGovernance);
```

- *ReentrancyGuard.sol* ( [70](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L70) ):

```solidity
/// @audit ↑ Out of order with function _initializeReentrancyGuard()
70:     modifier nonReentrant() {
```

- *Governance.sol* ( [60](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L60) ):

```solidity
/// @audit ↑ Out of order with constructor ()
60:     modifier onlySelf() {
```

- *IGovernance.sol* ( [70](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L70) ):

```solidity
/// @audit ↑ Out of order with function updateSecurityCouncil()
70:     event TransparentOperationScheduled(bytes32 indexed _id, uint256 delay, Operation _operation);
```

- *StateTransitionManager.sol* ( [65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L65) ):

```solidity
/// @audit ↑ Out of order with constructor ()
65:     modifier onlyBridgehub() {
```

- *ValidatorTimelock.sol* ( [46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L46), [63](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L63) ):

```solidity
/// @audit ↑ Out of order with error ValidatorDoesNotExist
46:     IStateTransitionManager public stateTransitionManager;

/// @audit ↑ Out of order with constructor ()
63:     modifier onlyChainAdmin(uint256 _chainId) {
```

- *IAdmin.sol* ( [63](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L63) ):

```solidity
/// @audit ↑ Out of order with function unfreezeDiamond()
63:     event IsPorterAvailableStatusUpdate(bool isPorterAvailable);
```

- *IExecutor.sol* ( [193](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L193) ):

```solidity
/// @audit ↑ Out of order with function revertBatchesSharedBridge()
193:     event BlockCommit(uint256 indexed batchNumber, bytes32 indexed batchHash, bytes32 indexed commitment);
```

- *IMailbox.sol* ( [125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L125) ):

```solidity
/// @audit ↑ Out of order with function transferEthToSharedBridge()
125:     event NewPriorityRequest(
```

- *Diamond.sol* ( [82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L82) ):

```solidity
/// @audit ↑ Out of order with event DiamondCut
82:     enum Action {
```

- *L2StandardERC20.sol* ( [131](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L131) ):

```solidity
/// @audit ↑ Out of order with function reinitializeToken()
131:     modifier onlyBridge() {
```

- *L1Messenger.sol* ( [55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L55) ):

```solidity
/// @audit ↑ Out of order with function keccakGasCost()
55:     uint256 internal constant SHA256_ROUND_GAS_COST = 7;
```

- *MsgValueSimulator.sol* ( [36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L36) ):

```solidity
/// @audit ↑ Out of order with function _getAbiParams()
36:     uint256 constant GAS_TO_PASS = 2300;
```

- *SystemContext.sol* ( [89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L89) ):

```solidity
/// @audit ↑ Out of order with function setChainId()
89:     uint16 public txNumberInBlock;
```

- *IBaseToken.sol* ( [24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBaseToken.sol#L24) ):

```solidity
/// @audit ↑ Out of order with function withdrawWithMessage()
24:     event Mint(address indexed account, uint256 amount);
```

</details>

### [N-50] Consider adding validation of user inputs

There are no validations done on the arguments below. Consider that the Solidity [documentation](https://docs.soliditylang.org/en/latest/control-structures.html#panic-via-assert-and-error-via-require) states that `Properly functioning code should never create a Panic, not even on invalid external input. If this happens, then there is a bug in your contract which you should fix`. This means that there should be explicit checks for expected ranges of inputs. Underflows/overflows result in panics should not be used as range checks, and allowing funds to be sent to  `0x0`, which is the default value of address variables and has many gotchas, should be avoided.

<details>
<summary>There are 58 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [65-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L65-L65), [100-106](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L100-L106), [135-142](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L135-L142), [178-186](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L178-L186) ):

```solidity
/// @audit `_token not checked`
65:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external {

/// @audit `_l2Receiver not checked`
/// @audit `_l1Token not checked`
100:     function deposit(
101:         address _l2Receiver,
102:         address _l1Token,
103:         uint256 _amount,
104:         uint256 _l2TxGasLimit,
105:         uint256 _l2TxGasPerPubdataByte
106:     ) external payable returns (bytes32 l2TxHash) {

/// @audit `_l2Receiver not checked`
/// @audit `_l1Token not checked`
/// @audit `_refundRecipient not checked`
135:     function deposit(
136:         address _l2Receiver,
137:         address _l1Token,
138:         uint256 _amount,
139:         uint256 _l2TxGasLimit,
140:         uint256 _l2TxGasPerPubdataByte,
141:         address _refundRecipient
142:     ) public payable nonReentrant returns (bytes32 l2TxHash) {

/// @audit `_depositSender not checked`
/// @audit `_l1Token not checked`
178:     function claimFailedDeposit(
179:         address _depositSender,
180:         address _l1Token,
181:         bytes32 _l2TxHash,
182:         uint256 _l2BatchNumber,
183:         uint256 _l2MessageIndex,
184:         uint16 _l2TxNumberInBatch,
185:         bytes32[] calldata _merkleProof
186:     ) external nonReentrant {
```

- *L1SharedBridge.sol* ( [118-118](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L118-L118), [144-144](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L144-L144), [150-155](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L150-L155), [184-189](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L184-L189), [279-289](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L279-L289), [556-564](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L556-L564), [646-655](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L646-L655) ):

```solidity
/// @audit `_target not checked`
118:     function transferFundsFromLegacy(address _token, address _target, uint256 _targetChainId) external onlyOwner {

/// @audit `_l2BridgeAddress not checked`
144:     function initializeChainGovernance(uint256 _chainId, address _l2BridgeAddress) external onlyOwner {

/// @audit `_prevMsgSender not checked`
150:     function bridgehubDepositBaseToken(
151:         uint256 _chainId,
152:         address _prevMsgSender,
153:         address _l1Token,
154:         uint256 _amount
155:     ) external payable virtual onlyBridgehubOrEra(_chainId) {

/// @audit `_prevMsgSender not checked`
184:     function bridgehubDeposit(
185:         uint256 _chainId,
186:         address _prevMsgSender,
187:         uint256, // l2Value, needed for Weth deposits in the future
188:         bytes calldata _data
189:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) {

/// @audit `_depositSender not checked`
/// @audit `_l1Token not checked`
279:     function claimFailedDeposit(
280:         uint256 _chainId,
281:         address _depositSender,
282:         address _l1Token,
283:         uint256 _amount,
284:         bytes32 _l2TxHash,
285:         uint256 _l2BatchNumber,
286:         uint256 _l2MessageIndex,
287:         uint16 _l2TxNumberInBatch,
288:         bytes32[] calldata _merkleProof
289:     ) external override {

/// @audit `_l2Receiver not checked`
556:     function depositLegacyErc20Bridge(
557:         address _prevMsgSender,
558:         address _l2Receiver,
559:         address _l1Token,
560:         uint256 _amount,
561:         uint256 _l2TxGasLimit,
562:         uint256 _l2TxGasPerPubdataByte,
563:         address _refundRecipient
564:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) {

/// @audit `_depositSender not checked`
/// @audit `_l1Token not checked`
646:     function claimFailedDepositLegacyErc20Bridge(
647:         address _depositSender,
648:         address _l1Token,
649:         uint256 _amount,
650:         bytes32 _l2TxHash,
651:         uint256 _l2BatchNumber,
652:         uint256 _l2MessageIndex,
653:         uint16 _l2TxNumberInBatch,
654:         bytes32[] calldata _merkleProof
655:     ) external override onlyLegacyBridge {
```

- *Bridgehub.sol* ( [53-53](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L53-L53), [84-84](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L84-L84), [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L94-L94), [103-103](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L103-L103), [110-110](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L110-L110), [116-123](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L116-L123) ):

```solidity
/// @audit `_newPendingAdmin not checked`
53:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin {

/// @audit `_stateTransitionManager not checked`
84:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner {

/// @audit `_stateTransitionManager not checked`
94:     function removeStateTransitionManager(address _stateTransitionManager) external onlyOwner {

/// @audit `_token not checked`
103:     function addToken(address _token) external onlyOwner {

/// @audit `_sharedBridge not checked`
110:     function setSharedBridge(address _sharedBridge) external onlyOwner {

/// @audit `_stateTransitionManager not checked`
/// @audit `_baseToken not checked`
/// @audit `_admin not checked`
116:     function createNewChain(
117:         uint256 _chainId,
118:         address _stateTransitionManager,
119:         address _baseToken,
120:         uint256, //_salt
121:         address _admin,
122:         bytes calldata _initData
123:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {
```

- *Governance.sol* ( [258-258](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L258-L258) ):

```solidity
/// @audit `_newSecurityCouncil not checked`
258:     function updateSecurityCouncil(address _newSecurityCouncil) external onlySelf {
```

- *StateTransitionManager.sol* ( [112-112](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L112-L112), [134-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L134-L134), [232-235](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L232-L235), [241-247](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L241-L247) ):

```solidity
/// @audit `_newPendingAdmin not checked`
112:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin {

/// @audit `_validatorTimelock not checked`
134:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin {

/// @audit `_stateTransitionContract not checked`
232:     function registerAlreadyDeployedStateTransition(
233:         uint256 _chainId,
234:         address _stateTransitionContract
235:     ) external onlyOwner {

/// @audit `_baseToken not checked`
/// @audit `_sharedBridge not checked`
/// @audit `_admin not checked`
241:     function createNewChain(
242:         uint256 _chainId,
243:         address _baseToken,
244:         address _sharedBridge,
245:         address _admin,
246:         bytes calldata _diamondCut
247:     ) external onlyBridgehub {
```

- *ValidatorTimelock.sol* ( [75-75](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L75-L75), [80-80](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L80-L80), [89-89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L89-L89) ):

```solidity
/// @audit `_stateTransitionManager not checked`
75:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner {

/// @audit `_newValidator not checked`
80:     function addValidator(uint256 _chainId, address _newValidator) external onlyChainAdmin(_chainId) {

/// @audit `_validator not checked`
89:     function removeValidator(uint256 _chainId, address _validator) external onlyChainAdmin(_chainId) {
```

- *Admin.sol* ( [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L25-L25), [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L47-L47) ):

```solidity
/// @audit `_newPendingAdmin not checked`
25:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin {

/// @audit `_validator not checked`
47:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager {
```

- *Mailbox.sol* ( [199-207](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L199-L207) ):

```solidity
/// @audit `_contractL2 not checked`
/// @audit `_refundRecipient not checked`
199:     function requestL2Transaction(
200:         address _contractL2,
201:         uint256 _l2Value,
202:         bytes calldata _calldata,
203:         uint256 _l2GasLimit,
204:         uint256 _l2GasPerPubdataByteLimit,
205:         bytes[] calldata _factoryDeps,
206:         address _refundRecipient
207:     ) external payable returns (bytes32 canonicalTxHash) {
```

- *L2SharedBridge.sol* ( [81-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L81-L87), [125-125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L125-L125) ):

```solidity
/// @audit `_l1Sender not checked`
/// @audit `_l2Receiver not checked`
81:     function finalizeDeposit(
82:         address _l1Sender,
83:         address _l2Receiver,
84:         address _l1Token,
85:         uint256 _amount,
86:         bytes calldata _data
87:     ) external payable override {

/// @audit `_l1Receiver not checked`
/// @audit `_l2Token not checked`
125:     function withdraw(address _l1Receiver, address _l2Token, uint256 _amount) external override {
```

- *L2StandardERC20.sol* ( [147-147](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L147-L147), [156-156](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L156-L156) ):

```solidity
/// @audit `_to not checked`
147:     function bridgeMint(address _to, uint256 _amount) external override onlyBridge {

/// @audit `_from not checked`
156:     function bridgeBurn(address _from, uint256 _amount) external override onlyBridge {
```

- *AccountCodeStorage.sol* ( [35-35](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L35-L35), [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L46-L46), [54-54](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L54-L54) ):

```solidity
/// @audit `_address not checked`
35:     function storeAccountConstructingCodeHash(address _address, bytes32 _hash) external override onlyDeployer {

/// @audit `_address not checked`
46:     function storeAccountConstructedCodeHash(address _address, bytes32 _hash) external override onlyDeployer {

/// @audit `_address not checked`
54:     function markAccountCodeHashAsConstructed(address _address) external override onlyDeployer {
```

- *ComplexUpgrader.sol* ( [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol#L21-L21) ):

```solidity
/// @audit `_delegateTo not checked`
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable {
```

- *ContractDeployer.sol* ( [213-213](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L213-L213) ):

```solidity
/// @audit `_sender not checked`
213:     function forceDeployOnAddress(ForceDeployment calldata _deployment, address _sender) external payable onlySelf {
```

- *ImmutableSimulator.sol* ( [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L34-L34) ):

```solidity
/// @audit `_dest not checked`
34:     function setImmutables(address _dest, ImmutableData[] calldata _immutables) external override {
```

- *L2BaseToken.sol* ( [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L32-L32), [64-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L64-L64), [72-72](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L72-L72), [85-85](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L85-L85) ):

```solidity
/// @audit `_from not checked`
/// @audit `_to not checked`
32:     function transferFromTo(address _from, address _to, uint256 _amount) external override {

/// @audit `_account not checked`
64:     function mint(address _account, uint256 _amount) external override onlyCallFromBootloader {

/// @audit `_l1Receiver not checked`
72:     function withdraw(address _l1Receiver) external payable override {

/// @audit `_l1Receiver not checked`
85:     function withdrawWithMessage(address _l1Receiver, bytes memory _additionalData) external payable override {
```

- *NonceHolder.sol* ( [135-135](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L135-L135) ):

```solidity
/// @audit `_address not checked`
135:     function incrementDeploymentNonce(address _address) external returns (uint256 prevDeploymentNonce) {
```

- *SystemContext.sol* ( [99-99](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L99-L99) ):

```solidity
/// @audit `_newOrigin not checked`
99:     function setTxOrigin(address _newOrigin) external onlyCallFromBootloader {
```

</details>

### [N-51] Named imports of parent contracts are missing

Consider adding named imports for all parent contracts.

There are 5 instances:

- *Bridgehub.sol* ( [18-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L18-L18) ):

```solidity
/// @audit IBridgehub
/// @audit ReentrancyGuard
18: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step {
```

- *GenesisUpgrade.sol* ( [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L13-L13) ):

```solidity
/// @audit BaseZkSyncUpgradeGenesis
13: contract GenesisUpgrade is BaseZkSyncUpgradeGenesis {
```

- *AccountCodeStorage.sol* ( [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L22-L22) ):

```solidity
/// @audit IAccountCodeStorage
22: contract AccountCodeStorage is IAccountCodeStorage {
```

- *DefaultAccount.sol* ( [19-19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L19-L19) ):

```solidity
/// @audit IAccount
19: contract DefaultAccount is IAccount {
```

### [N-52] Each interfaces should be defined in a separate file

Each interface should be defined in a separate file, making it easier to import, and easier to develop and maintain. This is the strategy adopted by most popular libraries.

There are 3 instances:

- *L2ContractHelper.sol* ( [20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L20), [32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L32), [63](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L63) ):

```solidity
20: interface IL2Messenger {

32: interface IContractDeployer {

63: interface IBaseToken {
```

### [N-53] Libraries should be defined in separate files

The libraries below should be defined in separate files, so that it's easier for future projects to import them, and to avoid duplication later on if they need to be used elsewhere in the project.

There are 3 instances:

- *L2ContractHelper.sol* ( [85](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L85) ):

```solidity
85: library L2ContractHelper {
```

- *SystemContractsCaller.sol* ( [28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L28), [38](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L38) ):

```solidity
28: library Utils {

38: library SystemContractsCaller {
```

### [N-54] Put all system-wide constants in one file

Putting all the system-wide constants in a single file improves code readability, makes it easier to understand the basic configuration and limitations of the system, and makes maintenance easier.

<details>
<summary>There are 125 instances (click to show):</summary>

- *ValidatorTimelock.sol* ( [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L28-L28) ):

```solidity
28:     string public constant override getName = "ValidatorTimelock";
```

- *Admin.sol* ( [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L22-L22) ):

```solidity
22:     string public constant override getName = "AdminFacet";
```

- *Executor.sol* ( [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L29-L29) ):

```solidity
29:     string public constant override getName = "ExecutorFacet";
```

- *Getters.sol* ( [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L27-L27) ):

```solidity
27:     string public constant override getName = "GettersFacet";
```

- *Mailbox.sol* ( [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L37-L37) ):

```solidity
37:     string public constant override getName = "MailboxFacet";
```

- *L2ContractHelper.sol* ( [70-70](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L70-L70), [72-72](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L72-L72), [73-73](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L73-L73), [74-74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L74-L74), [76-76](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L76-L76), [78-78](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L78-L78), [87-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L87-L87) ):

```solidity
70: uint160 constant SYSTEM_CONTRACTS_OFFSET = 0x8000; // 2^15

72: address constant BOOTLOADER_ADDRESS = address(SYSTEM_CONTRACTS_OFFSET + 0x01);

73: address constant MSG_VALUE_SYSTEM_CONTRACT = address(SYSTEM_CONTRACTS_OFFSET + 0x09);

74: address constant DEPLOYER_SYSTEM_CONTRACT = address(SYSTEM_CONTRACTS_OFFSET + 0x06);

76: IL2Messenger constant L2_MESSENGER = IL2Messenger(address(SYSTEM_CONTRACTS_OFFSET + 0x08));

78: IBaseToken constant L2_BASE_TOKEN_ADDRESS = IBaseToken(address(SYSTEM_CONTRACTS_OFFSET + 0x0a));

87:     bytes32 private constant CREATE2_PREFIX = keccak256("zksyncCreate2");
```

- *SystemContractsCaller.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L9-L9), [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L12-L12) ):

```solidity
9: address constant SYSTEM_CALL_CALL_ADDRESS = address((1 << 16) - 11);

12: uint256 constant MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT = 1;
```

- *IPaymaster.sol* ( [14-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L14-L14) ):

```solidity
14: bytes4 constant PAYMASTER_VALIDATION_SUCCESS_MAGIC = IPaymaster.validateAndPayForPaymasterTransaction.selector;
```

- *AddressAliasHelper.sol* ( [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L24-L24) ):

```solidity
24:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
```

- *AccountCodeStorage.sol* ( [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L23-L23) ):

```solidity
23:     bytes32 constant EMPTY_STRING_KECCAK = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470;
```

- *Constants.sol* ( [20-20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L20-L20), [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L25-L25), [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L29-L29), [31-31](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L31-L31), [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L32-L32), [33-33](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L33-L33), [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L34-L34), [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L41-L41), [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L46-L46), [48-48](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L48-L48), [49-51](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L49-L51), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L52-L52), [53-53](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L53-L53), [54-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L54-L56), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L57-L57), [61-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L61-L61), [62-62](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L62-L62), [63-63](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L63-L63), [65-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L65-L65), [66-66](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L66-L66), [71-71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L71-L71), [73-73](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L73-L73), [74-74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L74-L74), [76-76](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L76-L76), [79-79](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L79-L79), [81-81](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L81-L81), [83-83](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L83-L83), [85-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L85-L87), [91-91](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L91-L91), [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L94-L94), [98-98](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L98-L98), [101-101](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L101-L101), [104-104](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L104-L104), [108-108](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L108-L108), [125-125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L125-L125), [128-128](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L128-L128), [130-130](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L130-L130), [132-132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L132-L132), [135-135](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L135-L135), [137-137](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L137-L137), [140-140](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L140-L140), [145-145](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L145-L145), [147-147](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L147-L147), [149-149](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L149-L149), [154-154](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L154-L154), [157-157](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L157-L157) ):

```solidity
20: uint160 constant SYSTEM_CONTRACTS_OFFSET = 0x8000; // 2^15

25: uint160 constant REAL_SYSTEM_CONTRACTS_OFFSET = 0x8000;

29: uint160 constant MAX_SYSTEM_CONTRACT_ADDRESS = 0xffff; // 2^16 - 1

31: address constant ECRECOVER_SYSTEM_CONTRACT = address(0x01);

32: address constant SHA256_SYSTEM_CONTRACT = address(0x02);

33: address constant ECADD_SYSTEM_CONTRACT = address(0x06);

34: address constant ECMUL_SYSTEM_CONTRACT = address(0x07);

41: uint256 constant COMPUTATIONAL_PRICE_FOR_PUBDATA = 80;

46: uint256 constant CURRENT_MAX_PRECOMPILE_ADDRESS = 0xff;

48: address payable constant BOOTLOADER_FORMAL_ADDRESS = payable(address(SYSTEM_CONTRACTS_OFFSET + 0x01));

49: IAccountCodeStorage constant ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT = IAccountCodeStorage(
50:     address(SYSTEM_CONTRACTS_OFFSET + 0x02)
51: );

52: INonceHolder constant NONCE_HOLDER_SYSTEM_CONTRACT = INonceHolder(address(SYSTEM_CONTRACTS_OFFSET + 0x03));

53: IKnownCodesStorage constant KNOWN_CODE_STORAGE_CONTRACT = IKnownCodesStorage(address(SYSTEM_CONTRACTS_OFFSET + 0x04));

54: IImmutableSimulator constant IMMUTABLE_SIMULATOR_SYSTEM_CONTRACT = IImmutableSimulator(
55:     address(SYSTEM_CONTRACTS_OFFSET + 0x05)
56: );

57: IContractDeployer constant DEPLOYER_SYSTEM_CONTRACT = IContractDeployer(address(SYSTEM_CONTRACTS_OFFSET + 0x06));

61: address constant FORCE_DEPLOYER = address(SYSTEM_CONTRACTS_OFFSET + 0x07);

62: IL1Messenger constant L1_MESSENGER_CONTRACT = IL1Messenger(address(SYSTEM_CONTRACTS_OFFSET + 0x08));

63: address constant MSG_VALUE_SYSTEM_CONTRACT = address(SYSTEM_CONTRACTS_OFFSET + 0x09);

65: IBaseToken constant BASE_TOKEN_SYSTEM_CONTRACT = IBaseToken(address(SYSTEM_CONTRACTS_OFFSET + 0x0a));

66: IBaseToken constant REAL_BASE_TOKEN_SYSTEM_CONTRACT = IBaseToken(address(REAL_SYSTEM_CONTRACTS_OFFSET + 0x0a));

71: address constant KECCAK256_SYSTEM_CONTRACT = address(0x8010);

73: ISystemContext constant SYSTEM_CONTEXT_CONTRACT = ISystemContext(payable(address(SYSTEM_CONTRACTS_OFFSET + 0x0b)));

74: ISystemContext constant REAL_SYSTEM_CONTEXT_CONTRACT = ISystemContext(payable(address(REAL_SYSTEM_CONTRACTS_OFFSET + 0x0b)));

76: IBootloaderUtilities constant BOOTLOADER_UTILITIES = IBootloaderUtilities(address(SYSTEM_CONTRACTS_OFFSET + 0x0c));

79: address constant EVENT_WRITER_CONTRACT = address(SYSTEM_CONTRACTS_OFFSET + 0x0d);

81: ICompressor constant COMPRESSOR_CONTRACT = ICompressor(address(SYSTEM_CONTRACTS_OFFSET + 0x0e));

83: IComplexUpgrader constant COMPLEX_UPGRADER_CONTRACT = IComplexUpgrader(address(SYSTEM_CONTRACTS_OFFSET + 0x0f));

85: IPubdataChunkPublisher constant PUBDATA_CHUNK_PUBLISHER = IPubdataChunkPublisher(
86:     address(SYSTEM_CONTRACTS_OFFSET + 0x11)
87: );

91: uint256 constant MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT = 1;

94: uint256 constant MAX_MSG_VALUE = 2 ** 128 - 1;

98: bytes32 constant CREATE2_PREFIX = 0x2020dba91b30cc0006188af794c2fb30dd8520db7e2c088b7fc7c103c00ca494;

101: bytes32 constant CREATE_PREFIX = 0x63bae3a9951d38e8a3fbb7b70909afc1200610fc5bc55ade242f815974674f23;

104: uint256 constant STATE_DIFF_ENTRY_SIZE = 272;

108: uint256 constant MAX_ALLOWED_PUBDATA_PER_BATCH = 520000;

125: uint256 constant L2_TO_L1_LOGS_MERKLE_TREE_LEAVES = 4096;

128: uint256 constant DERIVED_KEY_LENGTH = 32;

130: uint256 constant ENUM_INDEX_LENGTH = 8;

132: uint256 constant VALUE_LENGTH = 32;

135: uint256 constant COMPRESSED_INITIAL_WRITE_SIZE = DERIVED_KEY_LENGTH + VALUE_LENGTH;

137: uint256 constant COMPRESSED_REPEATED_WRITE_SIZE = ENUM_INDEX_LENGTH + VALUE_LENGTH;

140: uint256 constant INITIAL_WRITE_STARTING_POSITION = 4;

145: uint256 constant STATE_DIFF_DERIVED_KEY_OFFSET = 52;

147: uint256 constant STATE_DIFF_ENUM_INDEX_OFFSET = 84;

149: uint256 constant STATE_DIFF_FINAL_VALUE_OFFSET = 124;

154: uint256 constant BLOB_SIZE_BYTES = 126_976;

157: uint256 constant MAX_NUMBER_OF_BLOBS = 2;
```

- *L1Messenger.sol* ( [44-44](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L44-L44), [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L47-L47), [55-55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L55-L55), [58-58](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L58-L58) ):

```solidity
44:     uint256 internal constant KECCAK_ROUND_GAS_COST = 40;

47:     uint256 internal constant KECCAK_ROUND_NUMBER_OF_BYTES = 136;

55:     uint256 internal constant SHA256_ROUND_GAS_COST = 7;

58:     uint256 internal constant SHA256_ROUND_NUMBER_OF_BYTES = 64;
```

- *MsgValueSimulator.sol* ( [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L36-L36), [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L41-L41) ):

```solidity
36:     uint256 constant GAS_TO_PASS = 2300;

41:     uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000;
```

- *NonceHolder.sol* ( [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L28-L28), [31-31](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L31-L31) ):

```solidity
28:     uint256 private constant DEPLOY_NONCE_MULTIPLIER = 2 ** 128;

31:     uint256 private constant MAXIMAL_MIN_NONCE_INCREMENT = 2 ** 32;
```

- *SystemContext.sol* ( [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L23-L23) ):

```solidity
23:     uint256 internal constant MINIBLOCK_HASHES_TO_STORE = 257;
```

- *IAccount.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IAccount.sol#L7-L7) ):

```solidity
7: bytes4 constant ACCOUNT_VALIDATION_SUCCESS_MAGIC = IAccount.validateTransaction.selector;
```

- *ICompressor.sol* ( [6-6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ICompressor.sol#L6-L6), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ICompressor.sol#L8-L8), [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ICompressor.sol#L10-L10) ):

```solidity
6: uint8 constant OPERATION_BITMASK = 7;

8: uint8 constant LENGTH_BITS_OFFSET = 3;

10: uint8 constant MAX_ENUMERATION_INDEX_SIZE = 8;
```

- *IL1Messenger.sol* ( [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L25-L25), [30-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L30-L30), [33-33](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L33-L33) ):

```solidity
25: uint256 constant L2_TO_L1_LOG_SERIALIZE_SIZE = 88;

30: bytes32 constant L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH = 0x72abee45b59e344af8a6e520241c4744aff26ed411f4c4b00f8af09adada43ba;

33: uint256 constant STATE_DIFF_COMPRESSION_VERSION_NUMBER = 1;
```

- *IPaymaster.sol* ( [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L12-L12) ):

```solidity
12: bytes4 constant PAYMASTER_VALIDATION_SUCCESS_MAGIC = IPaymaster.validateAndPayForPaymasterTransaction.selector;
```

- *SystemContractHelper.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L9-L9), [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L10-L10), [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L11-L11), [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L12-L12) ):

```solidity
9: uint256 constant UINT32_MASK = type(uint32).max;

10: uint256 constant UINT64_MASK = type(uint64).max;

11: uint256 constant UINT128_MASK = type(uint128).max;

12: uint256 constant ADDRESS_MASK = type(uint160).max;
```

- *SystemContractsCaller.sol* ( [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L12-L12), [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L13-L13), [14-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L14-L14), [15-15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L15-L15), [16-16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L16-L16), [17-17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L17-L17), [18-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L18-L18), [19-19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L19-L19), [20-20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L20-L20), [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L21-L21), [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L22-L22), [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L23-L23), [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L24-L24), [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L25-L25), [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L26-L26), [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L27-L27), [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L28-L28), [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L29-L29), [30-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L30-L30), [31-31](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L31-L31), [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L32-L32), [33-33](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L33-L33), [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L34-L34), [35-35](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L35-L35), [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L36-L36), [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L37-L37), [38-38](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L38-L38), [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L41-L41), [42-42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L42-L42), [43-43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L43-L43), [44-44](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L44-L44), [45-45](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L45-L45), [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L46-L46) ):

```solidity
12: address constant TO_L1_CALL_ADDRESS = address((1 << 16) - 1);

13: address constant CODE_ADDRESS_CALL_ADDRESS = address((1 << 16) - 2);

14: address constant PRECOMPILE_CALL_ADDRESS = address((1 << 16) - 3);

15: address constant META_CALL_ADDRESS = address((1 << 16) - 4);

16: address constant MIMIC_CALL_CALL_ADDRESS = address((1 << 16) - 5);

17: address constant SYSTEM_MIMIC_CALL_CALL_ADDRESS = address((1 << 16) - 6);

18: address constant MIMIC_CALL_BY_REF_CALL_ADDRESS = address((1 << 16) - 7);

19: address constant SYSTEM_MIMIC_CALL_BY_REF_CALL_ADDRESS = address((1 << 16) - 8);

20: address constant RAW_FAR_CALL_CALL_ADDRESS = address((1 << 16) - 9);

21: address constant RAW_FAR_CALL_BY_REF_CALL_ADDRESS = address((1 << 16) - 10);

22: address constant SYSTEM_CALL_CALL_ADDRESS = address((1 << 16) - 11);

23: address constant SYSTEM_CALL_BY_REF_CALL_ADDRESS = address((1 << 16) - 12);

24: address constant SET_CONTEXT_VALUE_CALL_ADDRESS = address((1 << 16) - 13);

25: address constant SET_PUBDATA_PRICE_CALL_ADDRESS = address((1 << 16) - 14);

26: address constant INCREMENT_TX_COUNTER_CALL_ADDRESS = address((1 << 16) - 15);

27: address constant PTR_CALLDATA_CALL_ADDRESS = address((1 << 16) - 16);

28: address constant CALLFLAGS_CALL_ADDRESS = address((1 << 16) - 17);

29: address constant PTR_RETURNDATA_CALL_ADDRESS = address((1 << 16) - 18);

30: address constant EVENT_INITIALIZE_ADDRESS = address((1 << 16) - 19);

31: address constant EVENT_WRITE_ADDRESS = address((1 << 16) - 20);

32: address constant LOAD_CALLDATA_INTO_ACTIVE_PTR_CALL_ADDRESS = address((1 << 16) - 21);

33: address constant LOAD_LATEST_RETURNDATA_INTO_ACTIVE_PTR_CALL_ADDRESS = address((1 << 16) - 22);

34: address constant PTR_ADD_INTO_ACTIVE_CALL_ADDRESS = address((1 << 16) - 23);

35: address constant PTR_SHRINK_INTO_ACTIVE_CALL_ADDRESS = address((1 << 16) - 24);

36: address constant PTR_PACK_INTO_ACTIVE_CALL_ADDRESS = address((1 << 16) - 25);

37: address constant MULTIPLICATION_HIGH_ADDRESS = address((1 << 16) - 26);

38: address constant GET_EXTRA_ABI_DATA_ADDRESS = address((1 << 16) - 27);

41: uint256 constant META_GAS_PER_PUBDATA_BYTE_OFFSET = 0 * 8;

42: uint256 constant META_HEAP_SIZE_OFFSET = 8 * 8;

43: uint256 constant META_AUX_HEAP_SIZE_OFFSET = 12 * 8;

44: uint256 constant META_SHARD_ID_OFFSET = 28 * 8;

45: uint256 constant META_CALLER_SHARD_ID_OFFSET = 29 * 8;

46: uint256 constant META_CODE_SHARD_ID_OFFSET = 30 * 8;
```

- *TransactionHelper.sol* ( [15-15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L15-L15), [18-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L18-L18), [20-20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L20-L20), [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L22-L22), [82-82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L82-L82), [84-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L84-L87) ):

```solidity
15: uint8 constant EIP_712_TX_TYPE = 0x71;

18: uint8 constant LEGACY_TX_TYPE = 0x0;

20: uint8 constant EIP_2930_TX_TYPE = 0x01;

22: uint8 constant EIP_1559_TX_TYPE = 0x02;

82:     bytes32 constant EIP712_DOMAIN_TYPEHASH = keccak256("EIP712Domain(string name,string version,uint256 chainId)");

84:     bytes32 constant EIP712_TRANSACTION_TYPE_HASH =
85:         keccak256(
86:             "Transaction(uint256 txType,uint256 from,uint256 to,uint256 gasLimit,uint256 gasPerPubdataByteLimit,uint256 maxFeePerGas,uint256 maxPriorityFeePerGas,uint256 paymaster,uint256 nonce,uint256 value,bytes data,bytes32[] factoryDeps,bytes paymasterInput)"
87:         );
```

- *Utils.sol* ( [13-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L13-L14), [17-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L17-L18) ):

```solidity
13:     bytes32 constant IS_CONSTRUCTOR_BYTECODE_HASH_BIT_MASK =
14:         0x00ff000000000000000000000000000000000000000000000000000000000000;

17:     bytes32 constant SET_IS_CONSTRUCTOR_MARKER_BIT_MASK =
18:         0x0001000000000000000000000000000000000000000000000000000000000000;
```

</details>

### [N-55] `else`-block not required

One level of nesting can be removed by not having an `else` block when the `if`-block always jumps at the end. For example:
```solidity
if (condition) {
    body1...
    return x;
} else {
    body2...
}
```
can be changed to:
```solidity
if (condition) {
    body1...
    return x;
}
body2...
```

There are 3 instances:

- *Governance.sol* ( [109-111](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L109-L111), [111-113](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L111-L113), [113-115](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L113-L115) ):

```solidity
109:         if (timestamp == 0) {
110:             return OperationState.Unset;
111:         } else if (timestamp == EXECUTED_PROPOSAL_TIMESTAMP) {

111:         } else if (timestamp == EXECUTED_PROPOSAL_TIMESTAMP) {
112:             return OperationState.Done;
113:         } else if (timestamp > block.timestamp) {

113:         } else if (timestamp > block.timestamp) {
114:             return OperationState.Waiting;
115:         } else {
```

### [N-56] Redundant return statement in a function with named return variables

Because the return variable (or its default value) has been assigned, explicit return at the end of the function is unnecessary, as it is returned automatically.

There is 1 instance:

- *NonceHolder.sol* ( [125-130](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L125-L130) ):

```solidity
125:     function getDeploymentNonce(address _address) external view returns (uint256 deploymentNonce) {
126:         uint256 addressAsKey = uint256(uint160(_address));
127:         (deploymentNonce, ) = _splitRawNonce(rawNonces[addressAsKey]);
128: 
129:         return deploymentNonce;
130:     }
```

### [N-57] `assert()` should be replaced with `require()` or `revert()`

In versions of Solidity prior to 0.8.0, when encountering an assert all the remaining gas will be consumed.
Even after solidity 0.8.0, the assert function is still not recommended, as described in the [documentation](https://docs.soliditylang.org/en/v0.8.20/control-structures.html#panic-via-assert-and-error-via-require):
> Assert should only be used to test for internal errors, and to check invariants. Properly functioning code should never create a Panic, not even on invalid external input. If this happens, then there is a bug in your contract which you should fix.

There are 5 instances:

- *StateTransitionManager.sol* ( [108](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L108) ):

```solidity
108:         assert(L2_TO_L1_LOG_SERIALIZE_SIZE != 2 * 32);
```

- *DiamondInit.sol* ( [53](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L53) ):

```solidity
53:         assert(L2_TO_L1_LOG_SERIALIZE_SIZE != 2 * 32);
```

- *Executor.sol* ( [427](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L427) ):

```solidity
427:         assert(block.chainid != 1);
```

- *DefaultAccount.sol* ( [222](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L222) ):

```solidity
222:         assert(msg.sender != BOOTLOADER_FORMAL_ADDRESS);
```

- *RLPEncoder.sol* ( [50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L50) ):

```solidity
50:         assert(_len != 1);
```

### [N-58] Large multiples of ten should use scientific notation

Use a scientific notation rather than decimal literals (e.g. `1e6` instead of `1000000`), for better code readability.

There are 5 instances:

- *Config.sol* ( [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L52-L52), [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L94-L94) ):

```solidity
/// @audit 80000000 -> 8e7
52: uint256 constant MAX_GAS_PER_TRANSACTION = 80000000;

/// @audit 10000 -> 1e4
94: uint256 constant TX_SLOT_OVERHEAD_L2_GAS = 10000;
```

- *StateTransitionManager.sol* ( [188-188](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L188-L188) ):

```solidity
/// @audit 72000000 -> 72e6
188:             gasLimit: 72000000,
```

- *Constants.sol* ( [108-108](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L108-L108) ):

```solidity
/// @audit 520000 -> 52e4
108: uint256 constant MAX_ALLOWED_PUBDATA_PER_BATCH = 520000;
```

- *MsgValueSimulator.sol* ( [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L41-L41) ):

```solidity
/// @audit 27000 -> 27e3
41:     uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000;
```

### [N-59] SPDX identifier should be the in the first line of a solidity file

SPDX identifier should be the in the first line of a solidity file.

<details>
<summary>There are 62 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *L1SharedBridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL1ERC20Bridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL1SharedBridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL2Bridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IWETH9.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Bridgehub.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IBridgehub.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Config.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *L2ContractAddresses.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/L2ContractAddresses.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Messaging.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Messaging.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ReentrancyGuard.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL2ContractDeployer.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/interfaces/IL2ContractDeployer.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *L2ContractHelper.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *UncheckedMath.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *UnsafeBytes.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Governance.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IGovernance.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IStateTransitionManager.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *StateTransitionManager.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ValidatorTimelock.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *DiamondInit.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *DiamondProxy.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ZkSyncStateTransitionStorage.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Admin.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Executor.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Getters.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Mailbox.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ZkSyncStateTransitionBase.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IAdmin.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IDiamondInit.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IExecutor.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IGetters.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ILegacyGetters.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/ILegacyGetters.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IMailbox.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IVerifier.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IVerifier.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IZkSyncStateTransition.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IZkSyncStateTransitionBase.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransitionBase.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ISystemContext.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol#L1) ):

```solidity
1: pragma solidity ^0.8.0;
```

- *Diamond.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *LibMap.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Merkle.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *PriorityQueue.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *TransactionValidator.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *BaseZkSyncUpgrade.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *BaseZkSyncUpgradeGenesis.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *DefaultUpgrade.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *GenesisUpgrade.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IDefaultUpgrade.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *AddressAliasHelper.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ForceDeployUpgrader.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *L2ContractHelper.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *SystemContractsCaller.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *L2SharedBridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *L2StandardERC20.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL1ERC20Bridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL1SharedBridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL1SharedBridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL2SharedBridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL2StandardToken.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IPaymaster.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IPaymasterFlow.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymasterFlow.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *AddressAliasHelper.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

</details>

### [N-60] `TODO`s left in the code

TODOs may signal that a feature is missing or not ready for audit, consider resolving the issue and removing the TODO comment

There are 3 instances:

- *Config.sol* ( [23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L23) ):

```solidity
23: // TODO: change constant to the real root hash of empty Merkle tree (SMA-184)
```

- *Mailbox.sol* ( [340](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L340) ):

```solidity
340:                 layer2Tip: uint192(0) // TODO: Restore after fee modeling will be stable. (SMA-1230)
```

- *IZkSyncStateTransition.sol* ( [18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L18) ):

```solidity
18:     // KL todo: need this in the server for now
```

### [N-61] High cyclomatic complexity

Consider breaking down these blocks into more manageable units, by splitting things into utility functions, by reducing nesting, and by using early returns.

<details>
<summary>There are 5 instances (click to show):</summary>

- *Executor.sol* ( [132-198](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L132-L198) ):

```solidity
132:     function _processL2Logs(
133:         CommitBatchInfo calldata _newBatch,
134:         bytes32 _expectedSystemContractUpgradeTxHash
135:     ) internal pure returns (LogProcessingOutput memory logOutput) {
136:         // Copy L2 to L1 logs into memory.
137:         bytes memory emittedL2Logs = _newBatch.systemLogs;
138: 
139:         // Used as bitmap to set/check log processing happens exactly once.
140:         // See SystemLogKey enum in Constants.sol for ordering.
141:         uint256 processedLogs;
142: 
143:         // linear traversal of the logs
144:         for (uint256 i = 0; i < emittedL2Logs.length; i = i.uncheckedAdd(L2_TO_L1_LOG_SERIALIZE_SIZE)) {
145:             // Extract the values to be compared to/used such as the log sender, key, and value
146:             (address logSender, ) = UnsafeBytes.readAddress(emittedL2Logs, i + L2_LOG_ADDRESS_OFFSET);
147:             (uint256 logKey, ) = UnsafeBytes.readUint256(emittedL2Logs, i + L2_LOG_KEY_OFFSET);
148:             (bytes32 logValue, ) = UnsafeBytes.readBytes32(emittedL2Logs, i + L2_LOG_VALUE_OFFSET);
149: 
150:             // Ensure that the log hasn't been processed already
151:             require(!_checkBit(processedLogs, uint8(logKey)), "kp");
152:             processedLogs = _setBit(processedLogs, uint8(logKey));
153: 
154:             // Need to check that each log was sent by the correct address.
155:             if (logKey == uint256(SystemLogKey.L2_TO_L1_LOGS_TREE_ROOT_KEY)) {
156:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "lm");
...... OMITTED ......
174:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bk");
175:                 logOutput.numberOfLayer1Txs = uint256(logValue);
176:             } else if (logKey == uint256(SystemLogKey.BLOB_ONE_HASH_KEY)) {
177:                 require(logSender == L2_PUBDATA_CHUNK_PUBLISHER_ADDR, "pc");
178:                 logOutput.blob1Hash = logValue;
179:             } else if (logKey == uint256(SystemLogKey.BLOB_TWO_HASH_KEY)) {
180:                 require(logSender == L2_PUBDATA_CHUNK_PUBLISHER_ADDR, "pd");
181:                 logOutput.blob2Hash = logValue;
182:             } else if (logKey == uint256(SystemLogKey.EXPECTED_SYSTEM_CONTRACT_UPGRADE_TX_HASH_KEY)) {
183:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bu");
184:                 require(_expectedSystemContractUpgradeTxHash == logValue, "ut");
185:             } else {
186:                 revert("ul");
187:             }
188:         }
189: 
190:         // We only require 9 logs to be checked, the 10th is if we are expecting a protocol upgrade
191:         // Without the protocol upgrade we expect 9 logs: 2^9 - 1 = 511
192:         // With the protocol upgrade we expect 8 logs: 2^10 - 1 = 1023
193:         if (_expectedSystemContractUpgradeTxHash == bytes32(0)) {
194:             require(processedLogs == 511, "b7");
195:         } else {
196:             require(processedLogs == 1023, "b8");
197:         }
198:     }
```

- *L2StandardERC20.sol* ( [52-104](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L52-L104) ):

```solidity
52:     function bridgeInitialize(address _l1Address, bytes memory _data) external initializer {
53:         require(_l1Address != address(0), "in6"); // Should be non-zero address
54:         l1Address = _l1Address;
55: 
56:         l2Bridge = msg.sender;
57: 
58:         // We parse the data exactly as they were created on the L1 bridge
59:         (bytes memory nameBytes, bytes memory symbolBytes, bytes memory decimalsBytes) = abi.decode(
60:             _data,
61:             (bytes, bytes, bytes)
62:         );
63: 
64:         ERC20Getters memory getters;
65:         string memory decodedName;
66:         string memory decodedSymbol;
67: 
68:         // L1 bridge didn't check if the L1 token return values with proper types for `name`/`symbol`/`decimals`
69:         // That's why we need to try to decode them, and if it works out, set the values as getters.
70: 
71:         // NOTE: Solidity doesn't have a convenient way to try to decode a value:
72:         // - Decode them manually, i.e. write a function that will validate that data in the correct format
73:         // and return decoded value and a boolean value - whether it was possible to decode.
74:         // - Use the standard abi.decode method, but wrap it into an external call in which error can be handled.
75:         // We use the second option here.
76: 
...... OMITTED ......
80:             getters.ignoreName = true;
81:         }
82: 
83:         try this.decodeString(symbolBytes) returns (string memory symbolString) {
84:             decodedSymbol = symbolString;
85:         } catch {
86:             getters.ignoreSymbol = true;
87:         }
88: 
89:         // Set decoded values for name and symbol.
90:         __ERC20_init_unchained(decodedName, decodedSymbol);
91: 
92:         // Set the name for EIP-712 signature.
93:         __ERC20Permit_init(decodedName);
94: 
95:         try this.decodeUint8(decimalsBytes) returns (uint8 decimalsUint8) {
96:             // Set decoded value for decimals.
97:             decimals_ = decimalsUint8;
98:         } catch {
99:             getters.ignoreDecimals = true;
100:         }
101: 
102:         availableGetters = getters;
103:         emit BridgeInitialize(_l1Address, decodedName, decodedSymbol, decimals_);
104:     }
```

- *Compressor.sol* ( [220-245](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L220-L245) ):

```solidity
220:     function _verifyValueCompression(
221:         uint256 _initialValue,
222:         uint256 _finalValue,
223:         uint256 _operation,
224:         bytes calldata _compressedValue
225:     ) internal pure {
226:         uint256 convertedValue = _sliceToUint256(_compressedValue);
227: 
228:         unchecked {
229:             if (_operation == 0 || _operation == 3) {
230:                 require(convertedValue == _finalValue, "transform or no compression: compressed and final mismatch");
231:             } else if (_operation == 1) {
232:                 require(
233:                     _initialValue + convertedValue == _finalValue,
234:                     "add: initial plus converted not equal to final"
235:                 );
236:             } else if (_operation == 2) {
237:                 require(
238:                     _initialValue - convertedValue == _finalValue,
239:                     "sub: initial minus converted not equal to final"
240:                 );
241:             } else {
242:                 revert("unsupported operation");
243:             }
244:         }
245:     }
```

- *L1Messenger.sol* ( [194-333](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L194-L333) ):

```solidity
194:     function publishPubdataAndClearState(
195:         bytes calldata _totalL2ToL1PubdataAndStateDiffs
196:     ) external onlyCallFromBootloader {
197:         uint256 calldataPtr = 0;
198: 
199:         /// Check logs
200:         uint32 numberOfL2ToL1Logs = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));
201:         require(numberOfL2ToL1Logs <= L2_TO_L1_LOGS_MERKLE_TREE_LEAVES, "Too many L2->L1 logs");
202:         calldataPtr += 4;
203: 
204:         bytes32[] memory l2ToL1LogsTreeArray = new bytes32[](L2_TO_L1_LOGS_MERKLE_TREE_LEAVES);
205:         bytes32 reconstructedChainedLogsHash;
206:         for (uint256 i = 0; i < numberOfL2ToL1Logs; ++i) {
207:             bytes32 hashedLog = EfficientCall.keccak(
208:                 _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + L2_TO_L1_LOG_SERIALIZE_SIZE]
209:             );
210:             calldataPtr += L2_TO_L1_LOG_SERIALIZE_SIZE;
211:             l2ToL1LogsTreeArray[i] = hashedLog;
212:             reconstructedChainedLogsHash = keccak256(abi.encode(reconstructedChainedLogsHash, hashedLog));
213:         }
214:         require(
215:             reconstructedChainedLogsHash == chainedLogsHash,
216:             "reconstructedChainedLogsHash is not equal to chainedLogsHash"
217:         );
218:         for (uint256 i = numberOfL2ToL1Logs; i < L2_TO_L1_LOGS_MERKLE_TREE_LEAVES; ++i) {
...... OMITTED ......
309:             enumerationIndexSize,
310:             stateDiffs,
311:             compressedStateDiffs
312:         );
313: 
314:         /// Check for calldata strict format
315:         require(calldataPtr == _totalL2ToL1PubdataAndStateDiffs.length, "Extra data in the totalL2ToL1Pubdata array");
316: 
317:         PUBDATA_CHUNK_PUBLISHER.chunkAndPublishPubdata(totalL2ToL1Pubdata);
318: 
319:         /// Native (VM) L2 to L1 log
320:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.L2_TO_L1_LOGS_TREE_ROOT_KEY)), l2ToL1LogsTreeRoot);
321:         SystemContractHelper.toL1(
322:             true,
323:             bytes32(uint256(SystemLogKey.TOTAL_L2_TO_L1_PUBDATA_KEY)),
324:             EfficientCall.keccak(totalL2ToL1Pubdata)
325:         );
326:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.STATE_DIFF_HASH_KEY)), stateDiffHash);
327: 
328:         /// Clear logs state
329:         chainedLogsHash = bytes32(0);
330:         numberOfLogsToProcess = 0;
331:         chainedMessagesHash = bytes32(0);
332:         chainedL1BytecodesRevealDataHash = bytes32(0);
333:     }
```

- *SystemContext.sol* ( [132-161](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L132-L161) ):

```solidity
132:     function getBlockHashEVM(uint256 _block) external view returns (bytes32 hash) {
133:         uint128 blockNumber = currentVirtualL2BlockInfo.number;
134: 
135:         VirtualBlockUpgradeInfo memory currentVirtualBlockUpgradeInfo = virtualBlockUpgradeInfo;
136: 
137:         // Due to virtual blocks upgrade, we'll have to use the following logic for retreiving the blockhash:
138:         // 1. If the block number is out of the 256-block supported range, return 0.
139:         // 2. If the block was created before the upgrade for the virtual blocks (i.e. there we used to use hashes of the batches),
140:         // we return the hash of the batch.
141:         // 3. If the block was created after the day when the virtual blocks have caught up with the L2 blocks, i.e.
142:         // all the information which is returned for users should be for L2 blocks, we return the hash of the corresponding L2 block.
143:         // 4. If the block queried is a virtual blocks, calculate it on the fly.
144:         if (blockNumber <= _block || blockNumber - _block > 256) {
145:             hash = bytes32(0);
146:         } else if (_block < currentVirtualBlockUpgradeInfo.virtualBlockStartBatch) {
147:             // Note, that we will get into this branch only for a brief moment of time, right after the upgrade
148:             // for virtual blocks before 256 virtual blocks are produced.
149:             hash = batchHashes[_block];
150:         } else if (
151:             _block >= currentVirtualBlockUpgradeInfo.virtualBlockFinishL2Block &&
152:             currentVirtualBlockUpgradeInfo.virtualBlockFinishL2Block > 0
153:         ) {
154:             hash = _getLatest257L2blockHash(_block);
155:         } else {
156:             // Important: we do not want this number to ever collide with the L2 block hash (either new or old one) and so
157:             // that's why the legacy L2 blocks' hashes are keccak256(abi.encodePacked(uint32(_block))), while these are equivalent to
158:             // keccak256(abi.encodePacked(_block))
159:             hash = keccak256(abi.encode(_block));
160:         }
161:     }
```

</details>

### [N-62] Typos

All typos should be corrected.

<details>
<summary>There are 26 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L65) ):

```solidity
/// @audit tranfer
65:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external {
```

- *L1SharedBridge.sol* ( [117](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L117), [132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L132), [441](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L441), [503](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L503) ):

```solidity
/// @audit tranfer
117:     /// @dev tranfer tokens from legacy erc20 bridge or mailbox and set chainBalance as part of migration process

/// @audit tranfer
132:             IL1ERC20Bridge(_target).tranferTokenToSharedBridge(_token, amount);

/// @audit enought
441:             require(chainBalance[_chainId][l1Token] >= amount, "ShB not enough funds 2"); // not enought funds

/// @audit messsage
503:         require(_l2ToL1message.length >= 56, "ShB wrong msg len"); // wrong messsage length
```

- *IL1ERC20Bridge.sol* ( [77](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L77) ):

```solidity
/// @audit tranfer
77:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external;
```

- *IStateTransitionManager.sol* ( [67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L67) ):

```solidity
/// @audit initalize
67:     function initialize(StateTransitionManagerInitializeData calldata _initalizeData) external;
```

- *Executor.sol* ( [226](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L226), [551](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L551), [559](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L559) ):

```solidity
/// @audit thier
226:         // as thier protocolversion would be outdated, and they also cannot process the protocol upgrade tx as they have a pending upgrade.

/// @audit Auxilary
551:                 _encodeBlobAuxilaryOutput(_blobCommitments, _blobHashes)

/// @audit Auxilary
559:     function _encodeBlobAuxilaryOutput(
```

- *IMailbox.sol* ( [115](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L115) ):

```solidity
/// @audit tranfer
115:     /// @notice tranfer Eth to shared bridge as part of migration process
```

- *TransactionValidator.sol* ( [56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L56) ):

```solidity
/// @audit ue
56:         require(_transaction.reserved[0] == 0, "ue");
```

- *BaseZkSyncUpgrade.sol* ( [131](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L131), [147](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L147) ):

```solidity
/// @audit commited
131:         // Batches committed expecting the old verifier will fail. Ensure all commited batches are finalized before the

/// @audit commited
147:         // Batches committed expecting the old verifier params will fail. Ensure all commited batches are finalized before the
```

- *IPaymaster.sol* ( [42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L42) ):

```solidity
/// @audit amout
42:     /// @param _maxRefundedGas, the upper bound on the amout of gas that could be refunded to the paymaster.
```

- *IPaymasterFlow.sol* ( [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymasterFlow.sol#L12) ):

```solidity
/// @audit implementated
12:  * @notice This is NOT an interface to be implementated
```

- *DefaultAccount.sol* ( [65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L65) ):

```solidity
/// @audit paramter
65:     /// @dev Besides the params above, it also accepts unused first paramter "_txHash", which
```

- *SystemContext.sol* ( [137](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L137), [321](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L321) ):

```solidity
/// @audit retreiving
137:         // Due to virtual blocks upgrade, we'll have to use the following logic for retreiving the blockhash:

/// @audit Reseting
321:         // Reseting the rolling hash
```

- *IPaymaster.sol* ( [40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L40) ):

```solidity
/// @audit amout
40:     /// @param _maxRefundedGas, the upper bound on the amout of gas that could be refunded to the paymaster.
```

- *IPaymasterFlow.sol* ( [9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymasterFlow.sol#L9) ):

```solidity
/// @audit implementated
9:  * @notice This is NOT an interface to be implementated
```

- *SystemContractHelper.sol* ( [38](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L38), [242](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L242), [244](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L244), [245](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L245), [327](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L327) ):

```solidity
/// @audit possilbe
38:  * methods won't work for non-system contracts and also breaking changes at short notice are possilbe.

/// @audit auxilary
242:     /// of the auxilary heap in bytes.

/// @audit auxilary
244:     /// @return auxHeapSize The size of the auxilary memory in bytes byte.

/// @audit auxilary
245:     /// @dev You can read more on auxilary memory in the VM1.2 documentation.

/// @audit Retuns
327:     /// @notice Retuns whether the current call is a system call.
```

</details>

### [N-63] Consider bounding input array length

The functions below take in an unbounded array, and make function calls for entries in the array. While the function will revert if it eventually runs out of gas, it may be a nicer user experience to require() that the length of the array is below some reasonable maximum, so that the user doesn't have to use up a full transaction's gas only to see that the transaction reverts.

<details>
<summary>There are 18 instances (click to show):</summary>

- *Governance.sol* ( [227](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L227) ):

```solidity
227:         for (uint256 i = 0; i < _calls.length; ++i) {
```

- *ValidatorTimelock.sol* ( [118](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L118), [137](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L137), [187](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L187), [211](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L211) ):

```solidity
118:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {

137:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {

187:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {

211:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {
```

- *Executor.sol* ( [259](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L259), [291](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L291), [353](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L353), [407](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L407), [578](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L578), [634](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L634), [665](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L665) ):

```solidity
259:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) {

291:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) {

353:         for (uint256 i = 0; i < nBatches; i = i.uncheckedInc()) {

407:         for (uint256 i = 0; i < committedBatchesLength; i = i.uncheckedInc()) {

578:         for (uint i = 0; i < MAX_NUMBER_OF_BLOBS; i++) {

634:         for (uint256 i = 0; i < _pubdataCommitments.length; i += PUBDATA_COMMITMENT_SIZE) {

665:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) {
```

- *Mailbox.sol* ( [358](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L358) ):

```solidity
358:         for (uint256 i = 0; i < factoryDepsLen; i = i.uncheckedInc()) {
```

- *BaseZkSyncUpgrade.sol* ( [228](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L228) ):

```solidity
228:         for (uint256 i = 0; i < _factoryDeps.length; ++i) {
```

- *ContractDeployer.sol* ( [248](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L248), [253](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L253) ):

```solidity
248:         for (uint256 i = 0; i < deploymentsLength; ++i) {

253:         for (uint256 i = 0; i < deploymentsLength; ++i) {
```

- *ImmutableSimulator.sol* ( [38](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L38) ):

```solidity
38:             for (uint256 i = 0; i < immutablesLength; ++i) {
```

- *KnownCodesStorage.sol* ( [30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L30) ):

```solidity
30:             for (uint256 i = 0; i < hashesLen; ++i) {
```

</details>

### [N-64] Unnecessary casting

Unnecessary castings can be removed.

<details>
<summary>There are 17 instances (click to show):</summary>

- *StateTransitionManager.sol* ( [268-268](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L268-L268), [273-273](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L273-L273) ):

```solidity
/// @audit uint256(protocolVersion)
268:             bytes32(uint256(protocolVersion)),

/// @audit bytes32(storedBatchZero)
273:             bytes32(storedBatchZero),
```

- *Executor.sol* ( [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L41-L41) ):

```solidity
/// @audit bytes1(_newBatch.pubdataCommitments[0])
41:         uint8 pubdataSource = uint8(bytes1(_newBatch.pubdataCommitments[0]));
```

- *Getters.sol* ( [50-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L50-L50), [55-55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L55-L55), [60-60](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L60-L60), [65-65](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L65-L65) ):

```solidity
/// @audit address(s.bridgehub)
50:         return address(s.bridgehub);

/// @audit address(s.stateTransitionManager)
55:         return address(s.stateTransitionManager);

/// @audit address(s.baseToken)
60:         return address(s.baseToken);

/// @audit address(s.baseTokenBridge)
65:         return address(s.baseTokenBridge);
```

- *Mailbox.sol* ( [302-302](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L302-L302), [306-306](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L306-L306) ):

```solidity
/// @audit uint256(_priorityOpParams.l2GasPrice)
302:             maxFeePerGas: uint256(_priorityOpParams.l2GasPrice),

/// @audit uint256(_priorityOpParams.txId)
306:             nonce: uint256(_priorityOpParams.txId),
```

- *PriorityQueue.sol* ( [48-48](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L48-L48) ):

```solidity
/// @audit uint256(_queue.tail - _queue.head)
48:         return uint256(_queue.tail - _queue.head);
```

- *SystemContractsCaller.sol* ( [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L46-L46) ):

```solidity
/// @audit uint32(Utils.safeCastToU32(data.length))
46:         uint32 dataLength = uint32(Utils.safeCastToU32(data.length));
```

- *Compressor.sol* ( [143-143](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L143-L143), [174-174](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L174-L174) ):

```solidity
/// @audit bytes1(_compressedStateDiffs[stateDiffPtr])
143:             uint8 metadata = uint8(bytes1(_compressedStateDiffs[stateDiffPtr]));

/// @audit bytes1(_compressedStateDiffs[stateDiffPtr])
174:             uint8 metadata = uint8(bytes1(_compressedStateDiffs[stateDiffPtr]));
```

- *L1Messenger.sol* ( [280-280](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L280-L280), [289-289](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L289-L289) ):

```solidity
/// @audit bytes1(_totalL2ToL1PubdataAndStateDiffs[calldataPtr])
280:             uint256(uint8(bytes1(_totalL2ToL1PubdataAndStateDiffs[calldataPtr]))) ==

/// @audit bytes1(_totalL2ToL1PubdataAndStateDiffs[calldataPtr])
289:         uint8 enumerationIndexSize = uint8(bytes1(_totalL2ToL1PubdataAndStateDiffs[calldataPtr]));
```

- *SystemContractHelper.sol* ( [339-339](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L339-L339) ):

```solidity
/// @audit uint160(MAX_SYSTEM_CONTRACT_ADDRESS)
339:         return uint160(_address) <= uint160(MAX_SYSTEM_CONTRACT_ADDRESS);
```

- *SystemContractsCaller.sol* ( [83-83](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L83-L83) ):

```solidity
/// @audit uint32(Utils.safeCastToU32(data.length))
83:         uint32 dataLength = uint32(Utils.safeCastToU32(data.length));
```

</details>

### [N-65] Unused contract variables

The following state variables are defined but not used.
It is recommended to check the code for logical omissions that cause them not to be used. If it's determined that they are not needed anywhere, it's best to remove them from the codebase to improve code clarity and minimize confusion.

<details>
<summary>There are 8 instances (click to show):</summary>

- *ValidatorTimelock.sol* ( [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L28-L28) ):

```solidity
28:     string public constant override getName = "ValidatorTimelock";
```

- *Admin.sol* ( [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L22-L22) ):

```solidity
22:     string public constant override getName = "AdminFacet";
```

- *Executor.sol* ( [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L29-L29) ):

```solidity
29:     string public constant override getName = "ExecutorFacet";
```

- *Getters.sol* ( [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L27-L27) ):

```solidity
27:     string public constant override getName = "GettersFacet";
```

- *Mailbox.sol* ( [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L37-L37) ):

```solidity
37:     string public constant override getName = "MailboxFacet";
```

- *SystemContext.sol* ( [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L37-L37), [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L41-L41), [44-44](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L44-L44) ):

```solidity
37:     uint256 public blockGasLimit = type(uint32).max;

41:     address public coinbase = BOOTLOADER_FORMAL_ADDRESS;

44:     uint256 public difficulty = 2.5e15;
```

</details>

### [N-66] Unused function parameters

Function parameters that are defined but not used may be logical errors and need to be checked to see if any logic is missing.
If the parameter is not really needed, it should be removed, otherwise it will repeatedly cause confusion and make code maintenance difficult.
If the parameter cannot be removed directly (for example, if it is an override function), its name should be removed and some comment can be appended.

There are 3 instances:

- *BaseZkSyncUpgrade.sol* ( [265-265](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L265-L265), [271-271](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L271-L271) ):

```solidity
/// @audit _customCallDataForUpgrade
265:     function _upgradeL1Contract(bytes calldata _customCallDataForUpgrade) internal virtual {}

/// @audit _customCallDataForUpgrade
271:     function _postUpgrade(bytes calldata _customCallDataForUpgrade) internal virtual {}
```

- *DefaultAccount.sol* ( [125-125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L125-L125) ):

```solidity
/// @audit _transaction
125:     function executeTransactionFromOutside(Transaction calldata _transaction) external payable override {
```

### [N-67] Unused import

The identifier is imported but never used within the file.

<details>
<summary>There are 164 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L8-L8), [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L10-L10), [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L11-L11), [14-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L14-L14) ):

```solidity
/// @audit SafeERC20
8: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";

/// @audit IL1ERC20Bridge
10: import {IL1ERC20Bridge} from "./interfaces/IL1ERC20Bridge.sol";

/// @audit IL1SharedBridge
11: import {IL1SharedBridge} from "./interfaces/IL1SharedBridge.sol";

/// @audit ReentrancyGuard
14: import {ReentrancyGuard} from "../common/ReentrancyGuard.sol";
```

- *L1SharedBridge.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L8-L8), [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L12-L12), [15-15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L15-L15), [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L21-L21), [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L24-L24) ):

```solidity
/// @audit Initializable
7: import {Initializable} from "@openzeppelin/contracts/proxy/utils/Initializable.sol";

/// @audit Ownable2Step
8: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";

/// @audit SafeERC20
12: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";

/// @audit IL1SharedBridge
15: import {IL1SharedBridge} from "./interfaces/IL1SharedBridge.sol";

/// @audit ReentrancyGuard
21: import {ReentrancyGuard} from "../common/ReentrancyGuard.sol";

/// @audit IBridgehub
24: import {IBridgehub, L2TransactionRequestTwoBridgesInner, L2TransactionRequestDirect} from "../bridgehub/IBridgehub.sol";
```

- *IL1SharedBridge.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L8-L8), [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L9-L9) ):

```solidity
/// @audit L2TransactionRequestTwoBridgesInner
7: import {L2TransactionRequestTwoBridgesInner} from "../../bridgehub/IBridgehub.sol";

/// @audit IBridgehub
8: import {IBridgehub} from "../../bridgehub/IBridgehub.sol";

/// @audit IL1ERC20Bridge
9: import {IL1ERC20Bridge} from "./IL1ERC20Bridge.sol";
```

- *Bridgehub.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L7-L7) ):

```solidity
/// @audit Ownable2Step
7: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";
```

- *IBridgehub.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L7-L7) ):

```solidity
/// @audit IL1SharedBridge
7: import {IL1SharedBridge} from "../bridge/interfaces/IL1SharedBridge.sol";
```

- *Governance.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L8-L8) ):

```solidity
/// @audit Ownable2Step
7: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";

/// @audit IGovernance
8: import {IGovernance} from "./IGovernance.sol";
```

- *IStateTransitionManager.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L8-L8) ):

```solidity
/// @audit Diamond
7: import {Diamond} from "./libraries/Diamond.sol";

/// @audit L2CanonicalTransaction
8: import {L2CanonicalTransaction} from "../common/Messaging.sol";
```

- *StateTransitionManager.sol* ( [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L8-L8), [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L13-L13), [18-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L18-L18), [20-20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L20-L20), [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L21-L21) ):

```solidity
/// @audit DiamondProxy
8: import {DiamondProxy} from "./chain-deps/DiamondProxy.sol";

/// @audit IStateTransitionManager
/// @audit StateTransitionManagerInitializeData
13: import {IStateTransitionManager, StateTransitionManagerInitializeData} from "./IStateTransitionManager.sol";

/// @audit Ownable2Step
18: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";

/// @audit ReentrancyGuard
20: import {ReentrancyGuard} from "../common/ReentrancyGuard.sol";

/// @audit ERA_DIAMOND_PROXY
/// @audit ERA_CHAIN_ID
21: import {REQUIRED_L2_GAS_PRICE_PER_PUBDATA, L2_TO_L1_LOG_SERIALIZE_SIZE, DEFAULT_L2_LOGS_TREE_ROOT_HASH, EMPTY_STRING_KECCAK, SYSTEM_UPGRADE_L2_TX_TYPE, ERA_DIAMOND_PROXY, ERA_CHAIN_ID} from "../common/Config.sol";
```

- *ValidatorTimelock.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L8-L8), [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L9-L9), [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L10-L10) ):

```solidity
/// @audit Ownable2Step
7: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";

/// @audit LibMap
8: import {LibMap} from "./libraries/LibMap.sol";

/// @audit IExecutor
9: import {IExecutor} from "./chain-interfaces/IExecutor.sol";

/// @audit IStateTransitionManager
10: import {IStateTransitionManager} from "./IStateTransitionManager.sol";
```

- *DiamondInit.sol* ( [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L8-L8), [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L9-L9), [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L11-L11), [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L12-L12) ):

```solidity
/// @audit ZkSyncStateTransitionBase
8: import {ZkSyncStateTransitionBase} from "./facets/ZkSyncStateTransitionBase.sol";

/// @audit FeeParams
9: import {FeeParams} from "./ZkSyncStateTransitionStorage.sol";

/// @audit InitializeData
/// @audit IDiamondInit
11: import {InitializeData, IDiamondInit} from "../chain-interfaces/IDiamondInit.sol";

/// @audit VerifierParams
12: import {VerifierParams} from "../chain-interfaces/IVerifier.sol";
```

- *ZkSyncStateTransitionStorage.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L8-L8) ):

```solidity
/// @audit IVerifier
/// @audit VerifierParams
7: import {IVerifier, VerifierParams} from "../chain-interfaces/IVerifier.sol";

/// @audit PriorityQueue
8: import {PriorityQueue} from "../../state-transition/libraries/PriorityQueue.sol";
```

- *Admin.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L7-L7), [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L10-L10), [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L11-L11), [15-15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L15-L15) ):

```solidity
/// @audit IAdmin
7: import {IAdmin} from "../../chain-interfaces/IAdmin.sol";

/// @audit FeeParams
/// @audit PubdataPricingMode
10: import {FeeParams, PubdataPricingMode} from "../ZkSyncStateTransitionStorage.sol";

/// @audit ZkSyncStateTransitionBase
11: import {ZkSyncStateTransitionBase} from "./ZkSyncStateTransitionBase.sol";

/// @audit IZkSyncStateTransitionBase
15: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol";
```

- *Executor.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L7-L7), [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L9-L9), [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L10-L10), [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L11-L11), [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L13-L13), [19-19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L19-L19) ):

```solidity
/// @audit ZkSyncStateTransitionBase
7: import {ZkSyncStateTransitionBase} from "./ZkSyncStateTransitionBase.sol";

/// @audit IExecutor
/// @audit LogProcessingOutput
9: import {IExecutor, L2_LOG_ADDRESS_OFFSET, L2_LOG_KEY_OFFSET, L2_LOG_VALUE_OFFSET, SystemLogKey, LogProcessingOutput, PubdataSource, BLS_MODULUS, PUBDATA_COMMITMENT_SIZE, PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET, PUBDATA_COMMITMENT_COMMITMENT_OFFSET, MAX_NUMBER_OF_BLOBS, TOTAL_BLOBS_IN_COMMITMENT} from "../../chain-interfaces/IExecutor.sol";

/// @audit PriorityQueue
/// @audit PriorityOperation
10: import {PriorityQueue, PriorityOperation} from "../../libraries/PriorityQueue.sol";

/// @audit UncheckedMath
11: import {UncheckedMath} from "../../../common/libraries/UncheckedMath.sol";

/// @audit VerifierParams
13: import {VerifierParams} from "../../chain-interfaces/IVerifier.sol";

/// @audit IZkSyncStateTransitionBase
19: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol";
```

- *Getters.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L8-L8), [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L9-L9), [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L11-L11), [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L12-L12), [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L13-L13), [14-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L14-L14), [17-17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L17-L17) ):

```solidity
/// @audit ZkSyncStateTransitionBase
7: import {ZkSyncStateTransitionBase} from "./ZkSyncStateTransitionBase.sol";

/// @audit PubdataPricingMode
8: import {PubdataPricingMode} from "../ZkSyncStateTransitionStorage.sol";

/// @audit VerifierParams
9: import {VerifierParams} from "../../../state-transition/chain-interfaces/IVerifier.sol";

/// @audit PriorityQueue
/// @audit PriorityOperation
11: import {PriorityQueue, PriorityOperation} from "../../../state-transition/libraries/PriorityQueue.sol";

/// @audit UncheckedMath
12: import {UncheckedMath} from "../../../common/libraries/UncheckedMath.sol";

/// @audit IGetters
13: import {IGetters} from "../../chain-interfaces/IGetters.sol";

/// @audit ILegacyGetters
14: import {ILegacyGetters} from "../../chain-interfaces/ILegacyGetters.sol";

/// @audit IZkSyncStateTransitionBase
17: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol";
```

- *Mailbox.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L9-L9), [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L11-L11), [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L13-L13), [14-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L14-L14), [15-15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L15-L15), [16-16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L16-L16), [19-19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L19-L19), [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L21-L21), [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L23-L23), [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L27-L27) ):

```solidity
/// @audit IMailbox
9: import {IMailbox} from "../../chain-interfaces/IMailbox.sol";

/// @audit PriorityQueue
11: import {PriorityQueue, PriorityOperation} from "../../libraries/PriorityQueue.sol";

/// @audit WritePriorityOpParams
/// @audit L2Message
/// @audit TxStatus
13: import {WritePriorityOpParams, L2CanonicalTransaction, L2Message, L2Log, TxStatus, BridgehubL2TransactionRequest} from "../../../common/Messaging.sol";

/// @audit FeeParams
14: import {FeeParams, PubdataPricingMode} from "../ZkSyncStateTransitionStorage.sol";

/// @audit UncheckedMath
15: import {UncheckedMath} from "../../../common/libraries/UncheckedMath.sol";

/// @audit UnsafeBytes
16: import {UnsafeBytes} from "../../../common/libraries/UnsafeBytes.sol";

/// @audit ZkSyncStateTransitionBase
19: import {ZkSyncStateTransitionBase} from "./ZkSyncStateTransitionBase.sol";

/// @audit L2_BASE_TOKEN_SYSTEM_CONTRACT_ADDR
21: import {L2_BOOTLOADER_ADDRESS, L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, L2_BASE_TOKEN_SYSTEM_CONTRACT_ADDR} from "../../../common/L2ContractAddresses.sol";

/// @audit IBridgehub
23: import {IBridgehub} from "../../../bridgehub/IBridgehub.sol";

/// @audit IZkSyncStateTransitionBase
27: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol";
```

- *ZkSyncStateTransitionBase.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L8-L8) ):

```solidity
/// @audit ZkSyncStateTransitionStorage
7: import {ZkSyncStateTransitionStorage} from "../ZkSyncStateTransitionStorage.sol";

/// @audit ReentrancyGuard
8: import {ReentrancyGuard} from "../../../common/ReentrancyGuard.sol";
```

- *IAdmin.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L7-L7), [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L9-L9), [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L10-L10) ):

```solidity
/// @audit IZkSyncStateTransitionBase
7: import {IZkSyncStateTransitionBase} from "../chain-interfaces/IZkSyncStateTransitionBase.sol";

/// @audit Diamond
9: import {Diamond} from "../libraries/Diamond.sol";

/// @audit FeeParams
/// @audit PubdataPricingMode
10: import {FeeParams, PubdataPricingMode} from "../chain-deps/ZkSyncStateTransitionStorage.sol";
```

- *IDiamondInit.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L8-L8), [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L9-L9) ):

```solidity
/// @audit L2CanonicalTransaction
7: import {L2CanonicalTransaction} from "../../common/Messaging.sol";

/// @audit IVerifier
/// @audit VerifierParams
8: import {IVerifier, VerifierParams} from "./IVerifier.sol";

/// @audit FeeParams
9: import {FeeParams} from "../chain-deps/ZkSyncStateTransitionStorage.sol";
```

- *IExecutor.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L7-L7) ):

```solidity
/// @audit IZkSyncStateTransitionBase
7: import {IZkSyncStateTransitionBase} from "./IZkSyncStateTransitionBase.sol";
```

- *IGetters.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L8-L8), [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L9-L9), [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L10-L10) ):

```solidity
/// @audit PriorityOperation
7: import {PriorityOperation} from "../libraries/PriorityQueue.sol";

/// @audit VerifierParams
8: import {VerifierParams} from "../chain-interfaces/IVerifier.sol";

/// @audit PubdataPricingMode
9: import {PubdataPricingMode} from "../chain-deps/ZkSyncStateTransitionStorage.sol";

/// @audit IZkSyncStateTransitionBase
10: import {IZkSyncStateTransitionBase} from "./IZkSyncStateTransitionBase.sol";
```

- *ILegacyGetters.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/ILegacyGetters.sol#L7-L7) ):

```solidity
/// @audit IZkSyncStateTransitionBase
7: import {IZkSyncStateTransitionBase} from "./IZkSyncStateTransitionBase.sol";
```

- *IMailbox.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L8-L8) ):

```solidity
/// @audit IZkSyncStateTransitionBase
7: import {IZkSyncStateTransitionBase} from "./IZkSyncStateTransitionBase.sol";

/// @audit L2CanonicalTransaction
/// @audit L2Log
/// @audit L2Message
/// @audit TxStatus
/// @audit BridgehubL2TransactionRequest
8: import {L2CanonicalTransaction, L2Log, L2Message, TxStatus, BridgehubL2TransactionRequest} from "../../common/Messaging.sol";
```

- *IZkSyncStateTransition.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L8-L8), [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L9-L9), [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L10-L10), [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L11-L11), [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L12-L12) ):

```solidity
/// @audit IAdmin
7: import {IAdmin} from "./IAdmin.sol";

/// @audit IExecutor
8: import {IExecutor} from "./IExecutor.sol";

/// @audit IGetters
9: import {IGetters} from "./IGetters.sol";

/// @audit IMailbox
10: import {IMailbox} from "./IMailbox.sol";

/// @audit Verifier
11: import {Verifier} from "../Verifier.sol";

/// @audit VerifierParams
12: import {VerifierParams} from "./IVerifier.sol";
```

- *Diamond.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L8-L8) ):

```solidity
/// @audit SafeCast
7: import {SafeCast} from "@openzeppelin/contracts/utils/math/SafeCast.sol";

/// @audit UncheckedMath
8: import {UncheckedMath} from "../../common/libraries/UncheckedMath.sol";
```

- *Merkle.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L7-L7) ):

```solidity
/// @audit UncheckedMath
7: import {UncheckedMath} from "../../common/libraries/UncheckedMath.sol";
```

- *TransactionValidator.sol* ( [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L9-L9) ):

```solidity
/// @audit L2CanonicalTransaction
9: import {L2CanonicalTransaction} from "../../common/Messaging.sol";
```

- *BaseZkSyncUpgrade.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L7-L7), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L8-L8), [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L9-L9), [14-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L14-L14) ):

```solidity
/// @audit ZkSyncStateTransitionBase
7: import {ZkSyncStateTransitionBase} from "../state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol";

/// @audit IMailbox
8: import {IMailbox} from "../state-transition/chain-interfaces/IMailbox.sol";

/// @audit VerifierParams
9: import {VerifierParams} from "../state-transition/chain-interfaces/IVerifier.sol";

/// @audit L2CanonicalTransaction
14: import {L2CanonicalTransaction} from "../common/Messaging.sol";
```

- *BaseZkSyncUpgradeGenesis.sol* ( [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L13-L13), [14-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L14-L14) ):

```solidity
/// @audit MAX_NEW_FACTORY_DEPS
/// @audit SYSTEM_UPGRADE_L2_TX_TYPE
13: import {MAX_NEW_FACTORY_DEPS, SYSTEM_UPGRADE_L2_TX_TYPE, MAX_ALLOWED_PROTOCOL_VERSION_DELTA} from "../common/Config.sol";

/// @audit ProposedUpgrade
/// @audit BaseZkSyncUpgrade
14: import {ProposedUpgrade, BaseZkSyncUpgrade} from "./BaseZkSyncUpgrade.sol";
```

- *DefaultUpgrade.sol* ( [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L8-L8) ):

```solidity
/// @audit BaseZkSyncUpgrade
/// @audit ProposedUpgrade
8: import {BaseZkSyncUpgrade, ProposedUpgrade} from "./BaseZkSyncUpgrade.sol";
```

- *IDefaultUpgrade.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol#L7-L7) ):

```solidity
/// @audit ProposedUpgrade
7: import {ProposedUpgrade} from "./BaseZkSyncUpgrade.sol";
```

- *L2SharedBridge.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L7-L7), [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L9-L9), [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L12-L12), [17-17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L17-L17), [19-19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L19-L19) ):

```solidity
/// @audit Initializable
7: import {Initializable} from "@openzeppelin/contracts/proxy/utils/Initializable.sol";

/// @audit UpgradeableBeacon
9: import {UpgradeableBeacon} from "@openzeppelin/contracts/proxy/beacon/UpgradeableBeacon.sol";

/// @audit IL2SharedBridge
12: import {IL2SharedBridge} from "./interfaces/IL2SharedBridge.sol";

/// @audit L2_BASE_TOKEN_ADDRESS
17: import {L2ContractHelper, DEPLOYER_SYSTEM_CONTRACT, L2_BASE_TOKEN_ADDRESS, IContractDeployer} from "../L2ContractHelper.sol";

/// @audit ERA_WETH_ADDRESS
19: import {ERA_CHAIN_ID, ERA_WETH_ADDRESS} from "../Config.sol";
```

- *L2StandardERC20.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L7-L7), [9-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L9-L9), [11-11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L11-L11) ):

```solidity
/// @audit ERC20PermitUpgradeable
7: import {ERC20PermitUpgradeable} from "@openzeppelin/contracts-upgradeable/token/ERC20/extensions/draft-ERC20PermitUpgradeable.sol";

/// @audit ERC1967Upgrade
9: import {ERC1967Upgrade} from "@openzeppelin/contracts/proxy/ERC1967/ERC1967Upgrade.sol";

/// @audit IL2StandardToken
11: import {IL2StandardToken} from "./interfaces/IL2StandardToken.sol";
```

- *BootloaderUtilities.sol* ( [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L5-L5), [6-6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L6-L6) ):

```solidity
/// @audit IBootloaderUtilities
5: import {IBootloaderUtilities} from "./interfaces/IBootloaderUtilities.sol";

/// @audit Transaction
/// @audit TransactionHelper
6: import {Transaction, TransactionHelper, EIP_712_TX_TYPE, LEGACY_TX_TYPE, EIP_2930_TX_TYPE, EIP_1559_TX_TYPE} from "./libraries/TransactionHelper.sol";
```

- *ComplexUpgrader.sol* ( [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol#L5-L5) ):

```solidity
/// @audit IComplexUpgrader
5: import {IComplexUpgrader} from "./interfaces/IComplexUpgrader.sol";
```

- *Compressor.sol* ( [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L5-L5), [6-6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L6-L6), [8-8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L8-L8), [10-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L10-L10) ):

```solidity
/// @audit ICompressor
5: import {ICompressor, OPERATION_BITMASK, LENGTH_BITS_OFFSET, MAX_ENUMERATION_INDEX_SIZE} from "./interfaces/ICompressor.sol";

/// @audit ISystemContract
6: import {ISystemContract} from "./interfaces/ISystemContract.sol";

/// @audit UnsafeBytesCalldata
8: import {UnsafeBytesCalldata} from "./libraries/UnsafeBytesCalldata.sol";

/// @audit INITIAL_WRITE_STARTING_POSITION
/// @audit COMPRESSED_INITIAL_WRITE_SIZE
/// @audit STATE_DIFF_ENUM_INDEX_OFFSET
/// @audit STATE_DIFF_FINAL_VALUE_OFFSET
/// @audit STATE_DIFF_DERIVED_KEY_OFFSET
/// @audit DERIVED_KEY_LENGTH
/// @audit VALUE_LENGTH
/// @audit ENUM_INDEX_LENGTH
10: import {L1_MESSENGER_CONTRACT, INITIAL_WRITE_STARTING_POSITION, COMPRESSED_INITIAL_WRITE_SIZE, STATE_DIFF_ENTRY_SIZE, STATE_DIFF_ENUM_INDEX_OFFSET, STATE_DIFF_FINAL_VALUE_OFFSET, STATE_DIFF_DERIVED_KEY_OFFSET, DERIVED_KEY_LENGTH, VALUE_LENGTH, ENUM_INDEX_LENGTH, KNOWN_CODE_STORAGE_CONTRACT} from "./Constants.sol";
```

- *ContractDeployer.sol* ( [6-6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L6-L6), [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L7-L7), [12-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L12-L12) ):

```solidity
/// @audit IContractDeployer
6: import {IContractDeployer} from "./interfaces/IContractDeployer.sol";

/// @audit KECCAK256_SYSTEM_CONTRACT
7: import {CREATE2_PREFIX, CREATE_PREFIX, NONCE_HOLDER_SYSTEM_CONTRACT, ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT, FORCE_DEPLOYER, MAX_SYSTEM_CONTRACT_ADDRESS, KNOWN_CODE_STORAGE_CONTRACT, BASE_TOKEN_SYSTEM_CONTRACT, IMMUTABLE_SIMULATOR_SYSTEM_CONTRACT, COMPLEX_UPGRADER_CONTRACT, KECCAK256_SYSTEM_CONTRACT} from "./Constants.sol";

/// @audit ISystemContract
12: import {ISystemContract} from "./interfaces/ISystemContract.sol";
```

- *ImmutableSimulator.sol* ( [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L5-L5) ):

```solidity
/// @audit IImmutableSimulator
/// @audit ImmutableData
5: import {IImmutableSimulator, ImmutableData} from "./interfaces/IImmutableSimulator.sol";
```

- *KnownCodesStorage.sol* ( [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L5-L5), [6-6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L6-L6) ):

```solidity
/// @audit IKnownCodesStorage
5: import {IKnownCodesStorage} from "./interfaces/IKnownCodesStorage.sol";

/// @audit ISystemContract
6: import {ISystemContract} from "./interfaces/ISystemContract.sol";
```

- *L1Messenger.sol* ( [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L5-L5), [6-6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L6-L6) ):

```solidity
/// @audit IL1Messenger
5: import {IL1Messenger, L2ToL1Log, L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH, L2_TO_L1_LOG_SERIALIZE_SIZE, STATE_DIFF_COMPRESSION_VERSION_NUMBER} from "./interfaces/IL1Messenger.sol";

/// @audit ISystemContract
6: import {ISystemContract} from "./interfaces/ISystemContract.sol";
```

- *L2BaseToken.sol* ( [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L5-L5), [6-6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L6-L6) ):

```solidity
/// @audit IBaseToken
5: import {IBaseToken} from "./interfaces/IBaseToken.sol";

/// @audit ISystemContract
6: import {ISystemContract} from "./interfaces/ISystemContract.sol";
```

- *MsgValueSimulator.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L7-L7) ):

```solidity
/// @audit ISystemContract
7: import {ISystemContract} from "./interfaces/ISystemContract.sol";
```

- *NonceHolder.sol* ( [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L5-L5), [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L7-L7) ):

```solidity
/// @audit INonceHolder
5: import {INonceHolder} from "./interfaces/INonceHolder.sol";

/// @audit ISystemContract
7: import {ISystemContract} from "./interfaces/ISystemContract.sol";
```

- *PubdataChunkPublisher.sol* ( [4-4](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L4-L4), [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L5-L5), [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L7-L7) ):

```solidity
/// @audit IPubdataChunkPublisher
4: import {IPubdataChunkPublisher} from "./interfaces/IPubdataChunkPublisher.sol";

/// @audit ISystemContract
5: import {ISystemContract} from "./interfaces/ISystemContract.sol";

/// @audit EfficientCall
7: import {EfficientCall} from "./libraries/EfficientCall.sol";
```

- *SystemContext.sol* ( [5-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L5-L5), [6-6](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L6-L6), [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L7-L7) ):

```solidity
/// @audit ISystemContext
5: import {ISystemContext} from "./interfaces/ISystemContext.sol";

/// @audit ISystemContract
6: import {ISystemContract} from "./interfaces/ISystemContract.sol";

/// @audit ISystemContextDeprecated
7: import {ISystemContextDeprecated} from "./interfaces/ISystemContextDeprecated.sol";
```

- *SystemContractHelper.sol* ( [7-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L7-L7) ):

```solidity
/// @audit SystemContractsCaller
/// @audit CalldataForwardingMode
/// @audit MIMIC_CALL_BY_REF_CALL_ADDRESS
/// @audit MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT
/// @audit RAW_FAR_CALL_BY_REF_CALL_ADDRESS
/// @audit SYSTEM_CALL_BY_REF_CALL_ADDRESS
7: import {SystemContractsCaller, CalldataForwardingMode, CALLFLAGS_CALL_ADDRESS, CODE_ADDRESS_CALL_ADDRESS, EVENT_WRITE_ADDRESS, EVENT_INITIALIZE_ADDRESS, GET_EXTRA_ABI_DATA_ADDRESS, LOAD_CALLDATA_INTO_ACTIVE_PTR_CALL_ADDRESS, META_CODE_SHARD_ID_OFFSET, META_CALLER_SHARD_ID_OFFSET, META_SHARD_ID_OFFSET, META_AUX_HEAP_SIZE_OFFSET, META_HEAP_SIZE_OFFSET, META_GAS_PER_PUBDATA_BYTE_OFFSET, MIMIC_CALL_BY_REF_CALL_ADDRESS, META_CALL_ADDRESS, MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT, PTR_CALLDATA_CALL_ADDRESS, PTR_ADD_INTO_ACTIVE_CALL_ADDRESS, PTR_SHRINK_INTO_ACTIVE_CALL_ADDRESS, PTR_PACK_INTO_ACTIVE_CALL_ADDRESS, RAW_FAR_CALL_BY_REF_CALL_ADDRESS, PRECOMPILE_CALL_ADDRESS, SET_CONTEXT_VALUE_CALL_ADDRESS, SYSTEM_CALL_BY_REF_CALL_ADDRESS, TO_L1_CALL_ADDRESS} from "./SystemContractsCaller.sol";
```

</details>

### [N-68] Unused local variables

The following local variables are not used. It is recommended to check the code for logical omissions that cause them not to be used. If it's determined that they are not needed anywhere, it's best to remove them from the codebase to improve code clarity and minimize confusion.

There is 1 instance:

- *SystemContractHelper.sol* ( [55-55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L55-L55) ):

```solidity
55:             let success := call(_isService, callAddr, _key, _value, 0xFFFF, 0, 0)
```

### [N-69] Unused named return

Declaring named returns, but not using them, is confusing to the reader. Consider either completely removing them (by declaring just the type without a name), or remove the return statement and do a variable assignment. This would improve the readability of the code, and it may also help reduce regressions during future code refactors.

There are 3 instances:

- *Bridgehub.sol* ( [116-123](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L116-L123) ):

```solidity
/// @audit chainId
116:     function createNewChain(
117:         uint256 _chainId,
118:         address _stateTransitionManager,
119:         address _baseToken,
120:         uint256, //_salt
121:         address _admin,
122:         bytes calldata _initData
123:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {
```

- *BootloaderUtilities.sol* ( [44-44](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L44-L44) ):

```solidity
/// @audit txHash
44:     function encodeLegacyTransactionHash(Transaction calldata _transaction) internal view returns (bytes32 txHash) {
```

- *ContractDeployer.sol* ( [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L34-L34) ):

```solidity
/// @audit info
34:     function getAccountInfo(address _address) external view returns (AccountInfo memory info) {
```

### [N-70] Use delete instead of assigning values to `false`

The `delete` keyword more closely matches the semantics of what is being done, and draws more attention to the changing of state, which may lead to a more thorough audit of its associated logic.

There are 3 instances:

- *Bridgehub.sol* ( [99-99](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L99-L99) ):

```solidity
99:         stateTransitionManagerIsRegistered[_stateTransitionManager] = false;
```

- *ValidatorTimelock.sol* ( [93-93](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L93-L93) ):

```solidity
93:         validators[_chainId][_validator] = false;
```

- *Admin.sol* ( [149-149](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L149-L149) ):

```solidity
149:         diamondStorage.isFrozen = false;
```

### [N-71] Consider using `delete` rather than assigning zero to clear values

The `delete` keyword more closely matches the semantics of what is being done, and draws more attention to the changing of state, which may lead to a more thorough audit of its associated logic.

There are 8 instances:

- *Bridgehub.sol* ( [278-278](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L278-L278) ):

```solidity
278:                 baseTokenMsgValue = 0;
```

- *L1Messenger.sol* ( [329-329](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L329-L329), [330-330](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L330-L330), [331-331](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L331-L331), [332-332](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L332-L332) ):

```solidity
329:         chainedLogsHash = bytes32(0);

330:         numberOfLogsToProcess = 0;

331:         chainedMessagesHash = bytes32(0);

332:         chainedL1BytecodesRevealDataHash = bytes32(0);
```

- *SystemContext.sol* ( [145-145](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L145-L145), [322-322](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L322-L322), [487-487](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L487-L487) ):

```solidity
145:             hash = bytes32(0);

322:         currentL2BlockTxsRollingHash = bytes32(0);

487:         txNumberInBlock = 0;
```

### [N-72] Use the latest Solidity version

Upgrading to the [latest solidity version](https://github.com/ethereum/solc-js/tags) (0.8.19 for L2s) can optimize gas usage, take advantage of new features and improve overall contract efficiency. Where possible, based on compatibility requirements, it is recommended to use newer/latest solidity version to take advantage of the latest optimizations and features.

<details>
<summary>There are 103 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *L1SharedBridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL1ERC20Bridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL1SharedBridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL2Bridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IWETH9.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Bridgehub.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IBridgehub.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Config.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *L2ContractAddresses.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/L2ContractAddresses.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Messaging.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Messaging.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ReentrancyGuard.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL2ContractDeployer.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/interfaces/IL2ContractDeployer.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *L2ContractHelper.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *UncheckedMath.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *UnsafeBytes.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Governance.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IGovernance.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IStateTransitionManager.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *StateTransitionManager.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ValidatorTimelock.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *DiamondInit.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *DiamondProxy.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ZkSyncStateTransitionStorage.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Admin.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Executor.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Getters.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Mailbox.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ZkSyncStateTransitionBase.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IAdmin.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IDiamondInit.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IExecutor.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IGetters.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ILegacyGetters.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/ILegacyGetters.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IMailbox.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IVerifier.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IVerifier.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IZkSyncStateTransition.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IZkSyncStateTransitionBase.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransitionBase.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Diamond.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *LibMap.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Merkle.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *PriorityQueue.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *TransactionValidator.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *BaseZkSyncUpgrade.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *BaseZkSyncUpgradeGenesis.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *DefaultUpgrade.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *GenesisUpgrade.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IDefaultUpgrade.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *AddressAliasHelper.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ForceDeployUpgrader.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *L2ContractHelper.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *SystemContractsCaller.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *L2SharedBridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *L2StandardERC20.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL1ERC20Bridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL1SharedBridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL1SharedBridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL2SharedBridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL2StandardToken.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IPaymaster.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IPaymasterFlow.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymasterFlow.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *AddressAliasHelper.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *AccountCodeStorage.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *BootloaderUtilities.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *ComplexUpgrader.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *Compressor.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *Constants.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *ContractDeployer.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *DefaultAccount.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *EmptyContract.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/EmptyContract.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *ImmutableSimulator.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *KnownCodesStorage.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *L1Messenger.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *L2BaseToken.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *MsgValueSimulator.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *NonceHolder.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *PubdataChunkPublisher.sol* ( [2](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L2) ):

```solidity
2: pragma solidity 0.8.20;
```

- *SystemContext.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IAccount.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IAccount.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IAccountCodeStorage.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IAccountCodeStorage.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IBaseToken.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBaseToken.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IBootloaderUtilities.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBootloaderUtilities.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IComplexUpgrader.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IComplexUpgrader.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *ICompressor.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ICompressor.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IContractDeployer.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IImmutableSimulator.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IImmutableSimulator.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IKnownCodesStorage.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IKnownCodesStorage.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IL1Messenger.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IL2StandardToken.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IMailbox.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IMailbox.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *INonceHolder.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/INonceHolder.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IPaymaster.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IPaymasterFlow.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymasterFlow.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IPubdataChunkPublisher.sol* ( [2](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPubdataChunkPublisher.sol#L2) ):

```solidity
2: pragma solidity 0.8.20;
```

- *ISystemContext.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContext.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *ISystemContextDeprecated.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContextDeprecated.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *ISystemContract.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContract.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *EfficientCall.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *RLPEncoder.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *SystemContractHelper.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *SystemContractsCaller.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *TransactionHelper.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

</details>

### [N-73] Consider using named function arguments

When calling functions with multiple arguments, consider using [named function parameters](https://docs.soliditylang.org/en/latest/control-structures.html#function-calls-with-named-parameters), rather than positional ones.

<details>
<summary>There are 22 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [147-155](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L147-L155), [191-200](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L191-L200), [220-226](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L220-L226) ):

```solidity
147:         l2TxHash = sharedBridge.depositLegacyErc20Bridge{value: msg.value}(
148:             msg.sender,
149:             _l2Receiver,
150:             _l1Token,
151:             _amount,
152:             _l2TxGasLimit,
153:             _l2TxGasPerPubdataByte,
154:             _refundRecipient
155:         );

191:         sharedBridge.claimFailedDepositLegacyErc20Bridge(
192:             _depositSender,
193:             _l1Token,
194:             amount,
195:             _l2TxHash,
196:             _l2BatchNumber,
197:             _l2MessageIndex,
198:             _l2TxNumberInBatch,
199:             _merkleProof
200:         );

220:         (address l1Receiver, address l1Token, uint256 amount) = sharedBridge.finalizeWithdrawalLegacyErc20Bridge(
221:             _l2BatchNumber,
222:             _l2MessageIndex,
223:             _l2TxNumberInBatch,
224:             _message,
225:             _merkleProof
226:         );
```

- *L1SharedBridge.sol* ( [318-326](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L318-L326), [479-485](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L479-L485) ):

```solidity
318:             bool proofValid = bridgehub.proveL1ToL2TransactionStatus(
319:                 _chainId,
320:                 _l2TxHash,
321:                 _l2BatchNumber,
322:                 _l2MessageIndex,
323:                 _l2TxNumberInBatch,
324:                 _merkleProof,
325:                 TxStatus.Failure
326:             );

479:         bool success = bridgehub.proveL2MessageInclusion(
480:             _chainId,
481:             _messageParams.l2BatchNumber,
482:             _messageParams.l2MessageIndex,
483:             l2ToL1Message,
484:             _merkleProof
485:         );
```

- *Bridgehub.sol* ( [139-145](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L139-L145), [162-162](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L162-L162), [174-174](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L174-L174), [189-196](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L189-L196), [208-212](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L208-L212), [230-235](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L230-L235), [280-285](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L280-L285), [290-296](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L290-L296), [320-324](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L320-L324) ):

```solidity
139:         IStateTransitionManager(_stateTransitionManager).createNewChain(
140:             _chainId,
141:             _baseToken,
142:             address(sharedBridge),
143:             _admin,
144:             _initData
145:         );

162:         return IZkSyncStateTransition(stateTransition).proveL2MessageInclusion(_batchNumber, _index, _message, _proof);

174:         return IZkSyncStateTransition(stateTransition).proveL2LogInclusion(_batchNumber, _index, _log, _proof);

189:             IZkSyncStateTransition(stateTransition).proveL1ToL2TransactionStatus(
190:                 _l2TxHash,
191:                 _l2BatchNumber,
192:                 _l2MessageIndex,
193:                 _l2TxNumberInBatch,
194:                 _merkleProof,
195:                 _status
196:             );

208:             IZkSyncStateTransition(stateTransition).l2TransactionBaseCost(
209:                 _gasPrice,
210:                 _l2GasLimit,
211:                 _l2GasPerPubdataByteLimit
212:             );

230:             sharedBridge.bridgehubDepositBaseToken{value: msg.value}(
231:                 _request.chainId,
232:                 msg.sender,
233:                 token,
234:                 _request.mintValue
235:             );

280:             sharedBridge.bridgehubDepositBaseToken{value: baseTokenMsgValue}(
281:                 _request.chainId,
282:                 msg.sender,
283:                 token,
284:                 _request.mintValue
285:             );

290:         L2TransactionRequestTwoBridgesInner memory outputRequest = IL1SharedBridge(_request.secondBridgeAddress)
291:             .bridgehubDeposit{value: _request.secondBridgeValue}(
292:             _request.chainId,
293:             msg.sender,
294:             _request.l2Value,
295:             _request.secondBridgeCalldata
296:         );

320:         IL1SharedBridge(_request.secondBridgeAddress).bridgehubConfirmL2Transaction(
321:             _request.chainId,
322:             outputRequest.txDataHash,
323:             canonicalTxHash
324:         );
```

- *Executor.sol* ( [442-446](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L442-L446) ):

```solidity
442:         bool successVerifyProof = s.verifier.verify(
443:             proofPublicInput,
444:             _proof.serializedProof,
445:             _proof.recursiveAggregationInput
446:         );
```

- *Mailbox.sol* ( [188-195](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L188-L195), [222-227](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L222-L227) ):

```solidity
188:         IL1SharedBridge(s.baseTokenBridge).finalizeWithdrawal(
189:             ERA_CHAIN_ID,
190:             _l2BatchNumber,
191:             _l2MessageIndex,
192:             _l2TxNumberInBatch,
193:             _message,
194:             _merkleProof
195:         );

222:         IL1SharedBridge(s.baseTokenBridge).bridgehubDepositBaseToken{value: msg.value}(
223:             s.chainId,
224:             msg.sender,
225:             ETH_TOKEN_ADDRESS,
226:             msg.value
227:         );
```

- *L2SharedBridge.sol* ( [106-106](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L106-L106), [115-115](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L115-L115), [128-128](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L128-L128) ):

```solidity
106:         IL2StandardToken(expectedL2Token).bridgeMint(_l2Receiver, _amount);

115:         L2StandardERC20(address(l2Token)).bridgeInitialize(_l1Token, _data);

128:         IL2StandardToken(_l2Token).bridgeBurn(msg.sender, _amount);
```

- *ContractDeployer.sol* ( [333-333](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L333-L333) ):

```solidity
333:                 BASE_TOKEN_SYSTEM_CONTRACT.transferFromTo(address(this), _newAddress, value);
```

- *L1Messenger.sol* ( [307-312](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L307-L312) ):

```solidity
307:         bytes32 stateDiffHash = COMPRESSOR_CONTRACT.verifyCompressedStateDiffs(
308:             numberOfStateDiffs,
309:             enumerationIndexSize,
310:             stateDiffs,
311:             compressedStateDiffs
312:         );
```

</details>

### [N-74] Named mappings are recommended

[Named mappings](https://docs.soliditylang.org/en/v0.8.18/types.html#mapping-types) (with syntax `mapping(KeyType KeyName? => ValueType ValueName?)`) are recommended.It can make the mapping variables clearer, more readable and easier to maintain.

<details>
<summary>There are 23 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L29-L29), [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L34-L34), [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L34-L34), [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L47-L47), [50-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L50-L50), [53-53](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L53-L53), [53-53](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L53-L53) ):

```solidity
29:     mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized))

34:     mapping(address account => mapping(address l1Token => mapping(bytes32 depositL2TxHash => uint256 amount)))

34:     mapping(address account => mapping(address l1Token => mapping(bytes32 depositL2TxHash => uint256 amount)))

47:     mapping(address => uint256) private __DEPRECATED_lastWithdrawalLimitReset;

50:     mapping(address => uint256) private __DEPRECATED_withdrawnAmountInWindow;

53:     mapping(address => mapping(address => uint256)) private __DEPRECATED_totalDepositedAmountPerUser;

53:     mapping(address => mapping(address => uint256)) private __DEPRECATED_totalDepositedAmountPerUser;
```

- *L1SharedBridge.sol* ( [54-54](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L54-L54), [59-59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L59-L59), [59-59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L59-L59), [67-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L67-L67) ):

```solidity
54:     mapping(uint256 chainId => mapping(bytes32 l2DepositTxHash => bytes32 depositDataHash))

59:     mapping(uint256 chainId => mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized)))

59:     mapping(uint256 chainId => mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized)))

67:     mapping(uint256 chainId => mapping(address l1Token => uint256 balance)) internal chainBalance;
```

- *Bridgehub.sol* ( [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L23-L23), [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L25-L25), [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L28-L28), [31-31](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L31-L31) ):

```solidity
23:     mapping(address _stateTransitionManager => bool) public stateTransitionManagerIsRegistered;

25:     mapping(address _token => bool) public tokenIsRegistered;

28:     mapping(uint256 _chainId => address) public stateTransitionManager;

31:     mapping(uint256 _chainId => address) public baseToken;
```

- *StateTransitionManager.sol* ( [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L32-L32), [50-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L50-L50) ):

```solidity
32:     mapping(uint256 => address) public stateTransition;

50:     mapping(uint256 => bytes32) public upgradeCutHash;
```

- *ValidatorTimelock.sol* ( [49-49](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L49-L49), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L52-L52), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L52-L52) ):

```solidity
49:     mapping(uint256 => LibMap.Uint32Map) internal committedBatchTimestamp;

52:     mapping(uint256 _chainId => mapping(address _validator => bool)) public validators;

52:     mapping(uint256 _chainId => mapping(address _validator => bool)) public validators;
```

- *ContractDeployer.sol* ( [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L26-L26) ):

```solidity
26:     mapping(address => AccountInfo) internal accountInfo;
```

- *ImmutableSimulator.sol* ( [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L21-L21) ):

```solidity
21:     mapping(uint256 contractAddress => mapping(uint256 index => bytes32 value)) internal immutableDataStorage;
```

- *NonceHolder.sol* ( [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L41-L41) ):

```solidity
41:     mapping(uint256 account => mapping(uint256 nonceKey => uint256 value)) internal nonceValues;
```

</details>

### [N-75] Named returns are recommended

Using named returns makes the code more self-documenting, makes it easier to fill out NatSpec, and in some cases can save gas. The cases below are where there currently is at most one return statement, which is ideal for named returns.

<details>
<summary>There are 145 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [77-77](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L77-L77), [162-162](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L162-L162) ):

```solidity
77:     function l2TokenAddress(address _l1Token) external view returns (address) {

162:     function _depositFundsToSharedBridge(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) {
```

- *L1SharedBridge.sol* ( [175-175](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L175-L175), [245-250](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L245-L250), [256-256](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L256-L256), [376-376](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L376-L376) ):

```solidity
175:     function _depositFunds(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) {

245:     function _getDepositL2Calldata(
246:         address _l1Sender,
247:         address _l2Receiver,
248:         address _l1Token,
249:         uint256 _amount
250:     ) internal view returns (bytes memory) {

256:     function _getERC20Getters(address _token) internal view returns (bytes memory) {

376:     function _isEraLegacyWithdrawal(uint256 _chainId, uint256 _l2BatchNumber) internal view returns (bool) {
```

- *Bridgehub.sol* ( [77-77](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L77-L77), [154-160](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L154-L160), [166-172](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L166-L172), [178-186](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L178-L186), [200-205](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L200-L205) ):

```solidity
77:     function getStateTransition(uint256 _chainId) public view returns (address) {

154:     function proveL2MessageInclusion(
155:         uint256 _chainId,
156:         uint256 _batchNumber,
157:         uint256 _index,
158:         L2Message calldata _message,
159:         bytes32[] calldata _proof
160:     ) external view override returns (bool) {

166:     function proveL2LogInclusion(
167:         uint256 _chainId,
168:         uint256 _batchNumber,
169:         uint256 _index,
170:         L2Log memory _log,
171:         bytes32[] calldata _proof
172:     ) external view override returns (bool) {

178:     function proveL1ToL2TransactionStatus(
179:         uint256 _chainId,
180:         bytes32 _l2TxHash,
181:         uint256 _l2BatchNumber,
182:         uint256 _l2MessageIndex,
183:         uint16 _l2TxNumberInBatch,
184:         bytes32[] calldata _merkleProof,
185:         TxStatus _status
186:     ) external view override returns (bool) {

200:     function l2TransactionBaseCost(
201:         uint256 _chainId,
202:         uint256 _gasPrice,
203:         uint256 _l2GasLimit,
204:         uint256 _l2GasPerPubdataByteLimit
205:     ) external view returns (uint256) {
```

- *L2ContractHelper.sol* ( [62-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L62-L67) ):

```solidity
62:     function computeCreate2Address(
63:         address _sender,
64:         bytes32 _salt,
65:         bytes32 _bytecodeHash,
66:         bytes32 _constructorInputHash
67:     ) internal pure returns (address) {
```

- *UncheckedMath.sol* ( [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L13-L13), [19-19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L19-L19) ):

```solidity
13:     function uncheckedInc(uint256 _number) internal pure returns (uint256) {

19:     function uncheckedAdd(uint256 _lhs, uint256 _rhs) internal pure returns (uint256) {
```

- *Governance.sol* ( [86-86](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L86-L86), [91-91](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L91-L91), [97-97](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L97-L97), [102-102](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L102-L102), [107-107](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L107-L107), [206-206](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L206-L206) ):

```solidity
86:     function isOperation(bytes32 _id) public view returns (bool) {

91:     function isOperationPending(bytes32 _id) public view returns (bool) {

97:     function isOperationReady(bytes32 _id) public view returns (bool) {

102:     function isOperationDone(bytes32 _id) public view returns (bool) {

107:     function getOperationState(bytes32 _id) public view returns (OperationState) {

206:     function hashOperation(Operation calldata _operation) public pure returns (bytes32) {
```

- *StateTransitionManager.sol* ( [76-76](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L76-L76) ):

```solidity
76:     function getChainAdmin(uint256 _chainId) external view override returns (address) {
```

- *ValidatorTimelock.sol* ( [104-104](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L104-L104) ):

```solidity
104:     function getCommittedBatchTimestamp(uint256 _chainId, uint256 _l2BatchNumber) external view returns (uint256) {
```

- *DiamondInit.sol* ( [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L26-L26) ):

```solidity
26:     function initialize(InitializeData calldata _initializeData) external reentrancyGuardInitializer returns (bytes32) {
```

- *Executor.sol* ( [34-38](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L34-L38), [451-455](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L451-L455), [498-503](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L498-L503), [513-513](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L513-L513), [523-523](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L523-L523), [535-540](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L535-L540), [585-585](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L585-L585), [590-590](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L590-L590), [595-595](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L595-L595) ):

```solidity
34:     function _commitOneBatch(
35:         StoredBatchInfo memory _previousBatch,
36:         CommitBatchInfo calldata _newBatch,
37:         bytes32 _expectedSystemContractUpgradeTxHash
38:     ) internal view returns (StoredBatchInfo memory) {

451:     function _getBatchProofPublicInput(
452:         bytes32 _prevBatchCommitment,
453:         bytes32 _currentBatchCommitment,
454:         VerifierParams memory _verifierParams
455:     ) internal pure returns (uint256) {

498:     function _createBatchCommitment(
499:         CommitBatchInfo calldata _newBatchData,
500:         bytes32 _stateDiffHash,
501:         bytes32[] memory _blobCommitments,
502:         bytes32[] memory _blobHashes
503:     ) internal view returns (bytes32) {

513:     function _batchPassThroughData(CommitBatchInfo calldata _batch) internal pure returns (bytes memory) {

523:     function _batchMetaParameters() internal view returns (bytes memory) {

535:     function _batchAuxiliaryOutput(
536:         CommitBatchInfo calldata _batch,
537:         bytes32 _stateDiffHash,
538:         bytes32[] memory _blobCommitments,
539:         bytes32[] memory _blobHashes
540:     ) internal pure returns (bytes memory) {

585:     function _hashStoredBatchInfo(StoredBatchInfo memory _storedBatchInfo) internal pure returns (bytes32) {

590:     function _checkBit(uint256 _bitMap, uint8 _index) internal pure returns (bool) {

595:     function _setBit(uint256 _bitMap, uint8 _index) internal pure returns (uint256) {
```

- *Getters.sol* ( [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L34-L34), [39-39](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L39-L39), [44-44](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L44-L44), [49-49](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L49-L49), [54-54](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L54-L54), [59-59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L59-L59), [64-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L64-L64), [69-69](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L69-L69), [74-74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L74-L74), [79-79](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L79-L79), [84-84](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L84-L84), [89-89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L89-L89), [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L94-L94), [99-99](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L99-L99), [104-104](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L104-L104), [109-109](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L109-L109), [114-114](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L114-L114), [119-119](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L119-L119), [124-124](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L124-L124), [129-129](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L129-L129), [134-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L134-L134), [139-139](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L139-L139), [144-144](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L144-L144), [149-149](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L149-L149), [154-154](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L154-L154), [159-159](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L159-L159), [178-178](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L178-L178), [183-183](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L183-L183), [190-190](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L190-L190), [195-195](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L195-L195), [219-219](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L219-L219), [225-225](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L225-L225), [231-231](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L231-L231), [241-241](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L241-L241), [246-246](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L246-L246), [251-251](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L251-L251), [256-256](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L256-L256), [261-261](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L261-L261) ):

```solidity
34:     function getVerifier() external view returns (address) {

39:     function getAdmin() external view returns (address) {

44:     function getPendingAdmin() external view returns (address) {

49:     function getBridgehub() external view returns (address) {

54:     function getStateTransitionManager() external view returns (address) {

59:     function getBaseToken() external view returns (address) {

64:     function getBaseTokenBridge() external view returns (address) {

69:     function baseTokenGasPriceMultiplierNominator() external view returns (uint128) {

74:     function baseTokenGasPriceMultiplierDenominator() external view returns (uint128) {

79:     function getTotalBatchesCommitted() external view returns (uint256) {

84:     function getTotalBatchesVerified() external view returns (uint256) {

89:     function getTotalBatchesExecuted() external view returns (uint256) {

94:     function getTotalPriorityTxs() external view returns (uint256) {

99:     function getFirstUnprocessedPriorityTx() external view returns (uint256) {

104:     function getPriorityQueueSize() external view returns (uint256) {

109:     function priorityQueueFrontOperation() external view returns (PriorityOperation memory) {

114:     function isValidator(address _address) external view returns (bool) {

119:     function l2LogsRootHash(uint256 _batchNumber) external view returns (bytes32) {

124:     function storedBatchHash(uint256 _batchNumber) external view returns (bytes32) {

129:     function getL2BootloaderBytecodeHash() external view returns (bytes32) {

134:     function getL2DefaultAccountBytecodeHash() external view returns (bytes32) {

139:     function getVerifierParams() external view returns (VerifierParams memory) {

144:     function getProtocolVersion() external view returns (uint256) {

149:     function getL2SystemContractsUpgradeTxHash() external view returns (bytes32) {

154:     function getL2SystemContractsUpgradeBatchNumber() external view returns (uint256) {

159:     function isDiamondStorageFrozen() external view returns (bool) {

178:     function getPriorityTxMaxGasLimit() external view returns (uint256) {

183:     function isFunctionFreezable(bytes4 _selector) external view returns (bool) {

190:     function isEthWithdrawalFinalized(uint256 _l2BatchNumber, uint256 _l2MessageIndex) external view returns (bool) {

195:     function getPubdataPricingMode() external view returns (PubdataPricingMode) {

219:     function facetFunctionSelectors(address _facet) external view returns (bytes4[] memory) {

225:     function facetAddresses() external view returns (address[] memory) {

231:     function facetAddress(bytes4 _selector) external view returns (address) {

241:     function getTotalBlocksCommitted() external view returns (uint256) {

246:     function getTotalBlocksVerified() external view returns (uint256) {

251:     function getTotalBlocksExecuted() external view returns (uint256) {

256:     function storedBlockHash(uint256 _batchNumber) external view returns (bytes32) {

261:     function getL2SystemContractsUpgradeBlockNumber() external view returns (uint256) {
```

- *Mailbox.sol* ( [56-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L56-L61), [66-71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L66-L71), [76-83](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L76-L83), [106-111](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L106-L111), [132-132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L132-L132), [145-149](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L145-L149), [158-158](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L158-L158) ):

```solidity
56:     function proveL2MessageInclusion(
57:         uint256 _batchNumber,
58:         uint256 _index,
59:         L2Message memory _message,
60:         bytes32[] calldata _proof
61:     ) public view returns (bool) {

66:     function proveL2LogInclusion(
67:         uint256 _batchNumber,
68:         uint256 _index,
69:         L2Log memory _log,
70:         bytes32[] calldata _proof
71:     ) external view returns (bool) {

76:     function proveL1ToL2TransactionStatus(
77:         bytes32 _l2TxHash,
78:         uint256 _l2BatchNumber,
79:         uint256 _l2MessageIndex,
80:         uint16 _l2TxNumberInBatch,
81:         bytes32[] calldata _merkleProof,
82:         TxStatus _status
83:     ) public view returns (bool) {

106:     function _proveL2LogInclusion(
107:         uint256 _batchNumber,
108:         uint256 _index,
109:         L2Log memory _log,
110:         bytes32[] calldata _proof
111:     ) internal view returns (bool) {

132:     function _L2MessageToLog(L2Message memory _message) internal pure returns (L2Log memory) {

145:     function l2TransactionBaseCost(
146:         uint256 _gasPrice,
147:         uint256 _l2GasLimit,
148:         uint256 _l2GasPerPubdataByteLimit
149:     ) public view returns (uint256) {

158:     function _deriveL2GasPrice(uint256 _l1GasPrice, uint256 _gasPerPubdata) internal view returns (uint256) {
```

- *Merkle.sol* ( [20-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L20-L24) ):

```solidity
20:     function calculateRoot(
21:         bytes32[] calldata _path,
22:         uint256 _index,
23:         bytes32 _itemHash
24:     ) internal pure returns (bytes32) {
```

- *PriorityQueue.sol* ( [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L37-L37), [42-42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L42-L42), [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L47-L47), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L52-L52), [66-66](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L66-L66) ):

```solidity
37:     function getFirstUnprocessedPriorityTx(Queue storage _queue) internal view returns (uint256) {

42:     function getTotalPriorityTxs(Queue storage _queue) internal view returns (uint256) {

47:     function getSize(Queue storage _queue) internal view returns (uint256) {

52:     function isEmpty(Queue storage _queue) internal view returns (bool) {

66:     function front(Queue storage _queue) internal view returns (PriorityOperation memory) {
```

- *TransactionValidator.sol* ( [71-75](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L71-L75) ):

```solidity
71:     function getMinimalPriorityTransactionGasLimit(
72:         uint256 _encodingLength,
73:         uint256 _numberOfFactoryDependencies,
74:         uint256 _l2GasPricePerPubdata
75:     ) internal pure returns (uint256) {
```

- *BaseZkSyncUpgrade.sol* ( [182-186](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L182-L186) ):

```solidity
182:     function _setL2SystemContractUpgrade(
183:         L2CanonicalTransaction calldata _l2ProtocolUpgradeTx,
184:         bytes[] calldata _factoryDeps,
185:         uint256 _newProtocolVersion
186:     ) internal returns (bytes32) {
```

- *BaseZkSyncUpgradeGenesis.sol* ( [49-49](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L49-L49) ):

```solidity
49:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual override returns (bytes32) {
```

- *DefaultUpgrade.sol* ( [15-15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L15-L15) ):

```solidity
15:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
```

- *GenesisUpgrade.sol* ( [16-16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L16-L16) ):

```solidity
16:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
```

- *L2ContractHelper.sol* ( [92-92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L92-L92), [103-108](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L103-L108) ):

```solidity
92:     function sendMessageToL1(bytes memory _message) internal returns (bytes32) {

103:     function computeCreate2Address(
104:         address _sender,
105:         bytes32 _salt,
106:         bytes32 _bytecodeHash,
107:         bytes32 _constructorInputHash
108:     ) internal pure returns (address) {
```

- *SystemContractsCaller.sol* ( [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L29-L29) ):

```solidity
29:     function safeCastToU32(uint256 _x) internal pure returns (uint32) {
```

- *L2SharedBridge.sol* ( [111-111](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L111-L111), [140-144](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L140-L144), [151-151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L151-L151) ):

```solidity
111:     function _deployL2Token(address _l1Token, bytes calldata _data) internal returns (address) {

140:     function _getL1WithdrawMessage(
141:         address _to,
142:         address _l1Token,
143:         uint256 _amount
144:     ) internal pure returns (bytes memory) {

151:     function l2TokenAddress(address _l1Token) public view override returns (address) {
```

- *L2StandardERC20.sol* ( [161-161](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L161-L161), [167-167](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L167-L167), [173-173](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L173-L173) ):

```solidity
161:     function name() public view override returns (string memory) {

167:     function symbol() public view override returns (string memory) {

173:     function decimals() public view override returns (uint8) {
```

- *AccountCodeStorage.sol* ( [89-89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L89-L89) ):

```solidity
89:     function getCodeHash(uint256 _input) external view override returns (bytes32) {
```

- *BootloaderUtilities.sol* ( [139-139](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L139-L139), [229-229](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L229-L229) ):

```solidity
139:     function encodeEIP2930TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) {

229:     function encodeEIP1559TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) {
```

- *ContractDeployer.sol* ( [40-40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L40-L40), [132-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L132-L136), [147-151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L147-L151), [162-167](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L162-L167), [182-187](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L182-L187) ):

```solidity
40:     function extendedAccountVersion(address _address) public view returns (AccountAbstractionVersion) {

132:     function create2(
133:         bytes32 _salt,
134:         bytes32 _bytecodeHash,
135:         bytes calldata _input
136:     ) external payable override returns (address) {

147:     function create(
148:         bytes32 _salt,
149:         bytes32 _bytecodeHash,
150:         bytes calldata _input
151:     ) external payable override returns (address) {

162:     function create2Account(
163:         bytes32 _salt,
164:         bytes32 _bytecodeHash,
165:         bytes calldata _input,
166:         AccountAbstractionVersion _aaVersion
167:     ) public payable override onlySystemCall returns (address) {

182:     function createAccount(
183:         bytes32, // salt
184:         bytes32 _bytecodeHash,
185:         bytes calldata _input,
186:         AccountAbstractionVersion _aaVersion
187:     ) public payable override onlySystemCall returns (address) {
```

- *DefaultAccount.sol* ( [159-159](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L159-L159) ):

```solidity
159:     function _isValidSignature(bytes32 _hash, bytes memory _signature) internal view returns (bool) {
```

- *ImmutableSimulator.sol* ( [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L27-L27) ):

```solidity
27:     function getImmutable(address _dest, uint256 _index) external view override returns (bytes32) {
```

- *L1Messenger.sol* ( [50-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L50-L50), [61-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L61-L61) ):

```solidity
50:     function keccakGasCost(uint256 _length) internal pure returns (uint256) {

61:     function sha256GasCost(uint256 _length) internal pure returns (uint256) {
```

- *L2BaseToken.sol* ( [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L56-L56), [112-112](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L112-L112), [117-122](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L117-L122), [128-128](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L128-L128), [134-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L134-L134), [140-140](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L140-L140) ):

```solidity
56:     function balanceOf(uint256 _account) external view override returns (uint256) {

112:     function _getL1WithdrawMessage(address _to, uint256 _amount) internal pure returns (bytes memory) {

117:     function _getExtendedWithdrawMessage(
118:         address _to,
119:         uint256 _amount,
120:         address _sender,
121:         bytes memory _additionalData
122:     ) internal pure returns (bytes memory) {

128:     function name() external pure override returns (string memory) {

134:     function symbol() external pure override returns (string memory) {

140:     function decimals() external pure override returns (uint8) {
```

- *MsgValueSimulator.sol* ( [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L47-L47) ):

```solidity
47:     fallback(bytes calldata _data) external onlySystemCall returns (bytes memory) {
```

- *NonceHolder.sol* ( [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L46-L46), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L57-L57), [102-102](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L102-L102), [154-154](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L154-L154) ):

```solidity
46:     function getMinNonce(address _address) public view returns (uint256) {

57:     function getRawNonce(address _address) public view returns (uint256) {

102:     function getValueUnderNonce(uint256 _key) public view returns (uint256) {

154:     function isNonceUsed(address _address, uint256 _nonce) public view returns (bool) {
```

- *SystemContext.sol* ( [117-117](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L117-L117), [122-122](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L122-L122), [190-190](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L190-L190), [198-198](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L198-L198), [205-205](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L205-L205), [221-226](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L221-L226), [233-233](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L233-L233) ):

```solidity
117:     function getCurrentPubdataSpent() public view returns (uint256) {

122:     function getCurrentPubdataCost() external view returns (uint256) {

190:     function getBlockNumber() public view returns (uint128) {

198:     function getBlockTimestamp() public view returns (uint128) {

205:     function _getLatest257L2blockHash(uint256 _block) internal view returns (bytes32) {

221:     function _calculateL2BlockHash(
222:         uint128 _blockNumber,
223:         uint128 _blockTimestamp,
224:         bytes32 _prevL2BlockHash,
225:         bytes32 _blockTxsRollingHash
226:     ) internal pure returns (bytes32) {

233:     function _calculateLegacyL2BlockHash(uint128 _blockNumber) internal pure returns (bytes32) {
```

- *EfficientCall.sol* ( [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L36-L36), [45-45](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L45-L45) ):

```solidity
36:     function keccak(bytes calldata _data) internal view returns (bytes32) {

45:     function sha(bytes calldata _data) internal view returns (bytes32) {
```

- *RLPEncoder.sol* ( [49-49](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L49-L49), [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L56-L56) ):

```solidity
49:     function encodeNonSingleBytesLen(uint64 _len) internal pure returns (bytes memory) {

56:     function encodeListLen(uint64 _len) internal pure returns (bytes memory) {
```

- *SystemContractHelper.sol* ( [329-329](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L329-L329), [338-338](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L338-L338) ):

```solidity
329:     function isSystemCall() internal view returns (bool) {

338:     function isSystemContract(address _address) internal pure returns (bool) {
```

- *TransactionHelper.sol* ( [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L94-L94), [118-118](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L118-L118), [147-147](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L147-L147), [219-219](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L219-L219), [289-289](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L289-L289) ):

```solidity
94:     function isEthToken(uint256 _addr) internal pure returns (bool) {

118:     function _encodeHashEIP712Transaction(Transaction calldata _transaction) private view returns (bytes32) {

147:     function _encodeHashLegacyTransaction(Transaction calldata _transaction) private view returns (bytes32) {

219:     function _encodeHashEIP2930Transaction(Transaction calldata _transaction) private view returns (bytes32) {

289:     function _encodeHashEIP1559Transaction(Transaction calldata _transaction) private view returns (bytes32) {
```

- *Utils.sol* ( [20-20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L20-L20), [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L26-L26), [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L32-L32), [51-51](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L51-L51), [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L56-L56), [63-63](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L63-L63), [71-71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L71-L71) ):

```solidity
20:     function safeCastToU128(uint256 _x) internal pure returns (uint128) {

26:     function safeCastToU32(uint256 _x) internal pure returns (uint32) {

32:     function safeCastToU24(uint256 _x) internal pure returns (uint24) {

51:     function isContractConstructed(bytes32 _bytecodeHash) internal pure returns (bool) {

56:     function isContractConstructing(bytes32 _bytecodeHash) internal pure returns (bool) {

63:     function constructingBytecodeHash(bytes32 _bytecodeHash) internal pure returns (bytes32) {

71:     function constructedBytecodeHash(bytes32 _bytecodeHash) internal pure returns (bytes32) {
```

</details>

### [N-76] Use transfer libraries instead of low level calls to transfer native tokens

Consider using [`SafeTransferLib.safeTransferETH`](https://github.com/transmissions11/solmate/blob/fadb2e2778adbf01c80275bfb99e5c14969d964b/src/utils/SafeTransferLib.sol#L15) or [`Address.sendValue`](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/9e3f4d60c581010c4a3979480e07cc7752f124cc/contracts/utils/Address.sol#L41) for clearer semantic meaning instead of using a low level `call`.

There are 3 instances:

- *L1SharedBridge.sol* ( [360-360](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L360-L360), [449-449](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L449-L449) ):

```solidity
360:                 callSuccess := call(gas(), _depositSender, _amount, 0, 0, 0, 0)

449:                 callSuccess := call(gas(), l1Receiver, amount, 0, 0, 0, 0)
```

- *TransactionHelper.sol* ( [400-400](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L400-L400) ):

```solidity
400:             success := call(gas(), bootloaderAddr, amount, 0, 0, 0, 0)
```

### [N-77] Use `type(X).max` instead of constant formulas like `2**n`

Earlier versions of solidity can use `uint<n>(-1)` instead. Expressions `2**n -1` can often be rewritten to accommodate the change (e.g. by using a `>` instead of a `>=`, which will also saves gas).

There are 5 instances:

- *L2ContractHelper.sol* ( [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol#L28-L28) ):

```solidity
28:         require(bytecodeLenInWords < 2 ** 16, "pp"); // bytecode length must be less than 2^16 words
```

- *Constants.sol* ( [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L94-L94) ):

```solidity
94: uint256 constant MAX_MSG_VALUE = 2 ** 128 - 1;
```

- *NonceHolder.sol* ( [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L28-L28), [31-31](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L31-L31) ):

```solidity
28:     uint256 private constant DEPLOY_NONCE_MULTIPLIER = 2 ** 128;

31:     uint256 private constant MAXIMAL_MIN_NONCE_INCREMENT = 2 ** 32;
```

- *Utils.sol* ( [87-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L87-L87) ):

```solidity
87:         require(lengthInWords < 2 ** 16, "pp"); // bytecode length must be less than 2^16 words
```

### [N-78] Consider using the `using`-`for` syntax

The `using`-`for` [syntax](https://docs.soliditylang.org/en/latest/contracts.html#using-for) is the more common way of calling library functions.

<details>
<summary>There are 169 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [81-81](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L81-L81) ):

```solidity
81:         return L2ContractHelper.computeCreate2Address(l2Bridge, salt, l2TokenProxyBytecodeHash, constructorInputHash);
```

- *L1SharedBridge.sol* ( [505-505](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L505-L505), [508-508](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L508-L508), [509-509](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L509-L509), [520-520](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L520-L520), [521-521](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L521-L521), [522-522](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L522-L522), [582-582](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L582-L582) ):

```solidity
505:         (uint32 functionSignature, uint256 offset) = UnsafeBytes.readUint32(_l2ToL1message, 0);

508:             (l1Receiver, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset);

509:             (amount, offset) = UnsafeBytes.readUint256(_l2ToL1message, offset);

520:             (l1Receiver, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset);

521:             (l1Token, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset);

522:             (amount, offset) = UnsafeBytes.readUint256(_l2ToL1message, offset);

582:                     ? AddressAliasHelper.applyL1ToL2Alias(_prevMsgSender)
```

- *Bridgehub.sol* ( [330-330](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L330-L330), [333-333](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L333-L333) ):

```solidity
330:             _recipient = msg.sender == tx.origin ? msg.sender : AddressAliasHelper.applyL1ToL2Alias(msg.sender);

333:             _recipient = AddressAliasHelper.applyL1ToL2Alias(_refundRecipient);
```

- *DiamondProxy.sol* ( [17-17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L17-L17), [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L23-L23) ):

```solidity
17:         Diamond.diamondCut(_diamondCut);

23:         Diamond.DiamondStorage storage diamondStorage = Diamond.getDiamondStorage();
```

- *Admin.sol* ( [116-116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L116-L116), [126-126](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L126-L126), [136-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L136-L136), [146-146](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L146-L146) ):

```solidity
116:         Diamond.diamondCut(_diamondCut);

126:         Diamond.diamondCut(_diamondCut);

136:         Diamond.DiamondStorage storage diamondStorage = Diamond.getDiamondStorage();

146:         Diamond.DiamondStorage storage diamondStorage = Diamond.getDiamondStorage();
```

- *Executor.sol* ( [146-146](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L146-L146), [147-147](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L147-L147), [148-148](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L148-L148) ):

```solidity
146:             (address logSender, ) = UnsafeBytes.readAddress(emittedL2Logs, i + L2_LOG_ADDRESS_OFFSET);

147:             (uint256 logKey, ) = UnsafeBytes.readUint256(emittedL2Logs, i + L2_LOG_KEY_OFFSET);

148:             (bytes32 logValue, ) = UnsafeBytes.readBytes32(emittedL2Logs, i + L2_LOG_VALUE_OFFSET);
```

- *Getters.sol* ( [160-160](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L160-L160), [166-166](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L166-L166), [184-184](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L184-L184), [205-205](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L205-L205), [220-220](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L220-L220), [226-226](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L226-L226), [232-232](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L232-L232) ):

```solidity
160:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage();

166:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage();

184:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage();

205:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage();

220:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage();

226:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage();

232:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage();
```

- *Mailbox.sol* ( [125-125](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L125-L125), [176-176](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L176-L176), [237-237](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L237-L237), [280-280](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L280-L280), [327-332](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L327-L332), [359-359](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L359-L359) ):

```solidity
125:         bytes32 calculatedRootHash = Merkle.calculateRoot(_proof, _index, hashedLog);

176:         return Math.max(l2GasPrice, minL2GasPriceBaseToken);

237:             l2Sender = AddressAliasHelper.applyL1ToL2Alias(_request.sender);

280:             refundRecipient = AddressAliasHelper.applyL1ToL2Alias(refundRecipient);

327:         TransactionValidator.validateL1ToL2Transaction(
328:             transaction,
329:             transactionEncoding,
330:             s.priorityTxMaxGasLimit,
331:             s.feeParams.priorityTxMaxPubdata
332:         );

359:             bytes32 hashedBytecode = L2ContractHelper.hashL2Bytecode(_factoryDeps[i]);
```

- *TransactionValidator.sol* ( [85-85](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L85-L85), [91-91](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L91-L91), [138-138](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L138-L138) ):

```solidity
85:             costForComputation += Math.ceilDiv(_encodingLength * L1_TX_DELTA_544_ENCODING_BYTES, 544);

91:             costForComputation = Math.max(costForComputation, L1_TX_MIN_L2_GAS_BASE);

138:         batchOverheadForTransaction = Math.max(batchOverheadForTransaction, overheadForLength);
```

- *BaseZkSyncUpgrade.sol* ( [99-99](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L99-L99), [116-116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L116-L116), [196-201](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L196-L201), [203-203](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L203-L203), [230-230](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L230-L230) ):

```solidity
99:         L2ContractHelper.validateBytecodeHash(_l2DefaultAccountBytecodeHash);

116:         L2ContractHelper.validateBytecodeHash(_l2BootloaderBytecodeHash);

196:         TransactionValidator.validateL1ToL2Transaction(
197:             _l2ProtocolUpgradeTx,
198:             encodedTransaction,
199:             s.priorityTxMaxGasLimit,
200:             s.feeParams.priorityTxMaxPubdata
201:         );

203:         TransactionValidator.validateUpgradeTransaction(_l2ProtocolUpgradeTx);

230:                 L2ContractHelper.hashL2Bytecode(_factoryDeps[i]) == bytes32(_expectedHashes[i]),
```

- *SystemContractsCaller.sol* ( [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L46-L46) ):

```solidity
46:         uint32 dataLength = uint32(Utils.safeCastToU32(data.length));
```

- *L2SharedBridge.sol* ( [90-90](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L90-L90), [91-91](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L91-L91), [134-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L134-L134), [155-155](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L155-L155), [167-175](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L167-L175) ):

```solidity
90:             AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1Bridge ||

91:                 AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1LegacyBridge,

134:         L2ContractHelper.sendMessageToL1(message);

155:             L2ContractHelper.computeCreate2Address(address(this), salt, l2TokenProxyBytecodeHash, constructorInputHash);

167:         (bool success, bytes memory returndata) = SystemContractsCaller.systemCallWithReturndata(
168:             uint32(gasleft()),
169:             DEPLOYER_SYSTEM_CONTRACT,
170:             0,
171:             abi.encodeCall(
172:                 IContractDeployer.create2,
173:                 (salt, l2TokenProxyBytecodeHash, abi.encode(address(l2TokenBeacon), ""))
174:             )
175:         );
```

- *AccountCodeStorage.sol* ( [37-37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L37-L37), [48-48](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L48-L48), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L57-L57), [60-60](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L60-L60), [107-107](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L107-L107), [134-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L134-L134), [136-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L136-L136) ):

```solidity
37:         require(Utils.isContractConstructing(_hash), "Code hash is not for a contract on constructor");

48:         require(Utils.isContractConstructed(_hash), "Code hash is not for a constructed contract");

57:         require(Utils.isContractConstructing(codeHash), "Code hash is not for a contract on constructor");

60:         bytes32 constructedBytecodeHash = Utils.constructedBytecodeHash(codeHash);

107:         else if (Utils.isContractConstructing(codeHash)) {

134:             !Utils.isContractConstructing(codeHash)

136:             codeSize = Utils.bytecodeLenInBytes(codeHash);
```

- *BootloaderUtilities.sol* ( [29-29](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L29-L29), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L52-L52), [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L56-L56), [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L57-L57), [61-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L61-L61), [62-62](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L62-L62), [71-71](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L71-L71), [82-82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L82-L82), [87-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L87-L87), [100-100](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L100-L100), [116-116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L116-L116), [143-143](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L143-L143), [144-144](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L144-L144), [145-145](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L145-L145), [146-146](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L146-L146), [147-147](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L147-L147), [148-148](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L148-L148), [167-167](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L167-L167), [176-176](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L176-L176), [181-181](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L181-L181), [186-186](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L186-L186), [193-193](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L193-L193), [207-207](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L207-L207), [236-236](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L236-L236), [237-237](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L237-L237), [238-238](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L238-L238), [239-239](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L239-L239), [240-240](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L240-L240), [241-241](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L241-L241), [242-242](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L242-L242), [262-262](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L262-L262), [271-271](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L271-L271), [276-276](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L276-L276), [281-281](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L281-L281), [288-288](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L288-L288), [302-302](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L302-L302) ):

```solidity
29:             txHash = keccak256(bytes.concat(signedTxHash, EfficientCall.keccak(_transaction.signature)));

52:         bytes memory encodedNonce = RLPEncoder.encodeUint256(_transaction.nonce);

56:             bytes memory encodedGasPrice = RLPEncoder.encodeUint256(_transaction.maxFeePerGas);

57:             bytes memory encodedGasLimit = RLPEncoder.encodeUint256(_transaction.gasLimit);

61:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));

62:         bytes memory encodedValue = RLPEncoder.encodeUint256(_transaction.value);

71:                 encodedDataLength = RLPEncoder.encodeNonSingleBytesLen(txDataLen);

82:             rEncoded = RLPEncoder.encodeUint256(rInt);

87:             sEncoded = RLPEncoder.encodeUint256(sInt);

100:             vEncoded = RLPEncoder.encodeUint256(vInt);

116:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength));

143:             bytes memory encodedChainId = RLPEncoder.encodeUint256(block.chainid);

144:             bytes memory encodedNonce = RLPEncoder.encodeUint256(_transaction.nonce);

145:             bytes memory encodedGasPrice = RLPEncoder.encodeUint256(_transaction.maxFeePerGas);

146:             bytes memory encodedGasLimit = RLPEncoder.encodeUint256(_transaction.gasLimit);

147:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));

148:             bytes memory encodedValue = RLPEncoder.encodeUint256(_transaction.value);

167:                 encodedDataLength = RLPEncoder.encodeNonSingleBytesLen(txDataLen);

176:         bytes memory encodedAccessListLength = RLPEncoder.encodeListLen(0);

181:             rEncoded = RLPEncoder.encodeUint256(rInt);

186:             sEncoded = RLPEncoder.encodeUint256(sInt);

193:             vEncoded = RLPEncoder.encodeUint256(vInt - 27);

207:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength));

236:             bytes memory encodedChainId = RLPEncoder.encodeUint256(block.chainid);

237:             bytes memory encodedNonce = RLPEncoder.encodeUint256(_transaction.nonce);

238:             bytes memory encodedMaxPriorityFeePerGas = RLPEncoder.encodeUint256(_transaction.maxPriorityFeePerGas);

239:             bytes memory encodedMaxFeePerGas = RLPEncoder.encodeUint256(_transaction.maxFeePerGas);

240:             bytes memory encodedGasLimit = RLPEncoder.encodeUint256(_transaction.gasLimit);

241:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));

242:             bytes memory encodedValue = RLPEncoder.encodeUint256(_transaction.value);

262:                 encodedDataLength = RLPEncoder.encodeNonSingleBytesLen(txDataLen);

271:         bytes memory encodedAccessListLength = RLPEncoder.encodeListLen(0);

276:             rEncoded = RLPEncoder.encodeUint256(rInt);

281:             sEncoded = RLPEncoder.encodeUint256(sInt);

288:             vEncoded = RLPEncoder.encodeUint256(vInt - 27);

302:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength));
```

- *Compressor.sol* ( [72-72](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L72-L72), [189-189](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L189-L189) ):

```solidity
72:         bytecodeHash = Utils.hashL2Bytecode(_bytecode);

189:         stateDiffHash = EfficientCall.keccak(_stateDiffs);
```

- *ContractDeployer.sol* ( [103-103](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L103-L103), [311-311](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L311-L311), [341-341](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L341-L341), [343-343](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L343-L343) ):

```solidity
103:         bytes32 constructorInputHash = EfficientCall.keccak(_input);

311:         bytes32 constructingBytecodeHash = Utils.constructingBytecodeHash(_bytecodeHash);

341:                 SystemContractHelper.setValueForNextFarCall(uint128(value));

343:             bytes memory returnData = EfficientCall.mimicCall(gasleft(), _newAddress, _input, _sender, true, _isSystem);
```

- *DefaultAccount.sol* ( [46-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L46-L46), [83-88](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L83-L88), [133-133](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L133-L133), [135-135](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L135-L135), [149-149](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L149-L149), [151-151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L151-L151) ):

```solidity
46:         address codeAddress = SystemContractHelper.getCodeAddress();

83:         SystemContractsCaller.systemCallWithPropagatedRevert(
84:             uint32(gasleft()),
85:             address(NONCE_HOLDER_SYSTEM_CONTRACT),
86:             0,
87:             abi.encodeCall(INonceHolder.incrementMinNonceIfEquals, (_transaction.nonce))
88:         );

133:         uint128 value = Utils.safeCastToU128(_transaction.value);

135:         uint32 gas = Utils.safeCastToU32(gasleft());

149:         bool success = EfficientCall.rawCall(gas, to, value, data, isSystemCall);

151:             EfficientCall.propagateRevert();
```

- *KnownCodesStorage.sol* ( [78-78](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L78-L78) ):

```solidity
78:         require(Utils.bytecodeLenInWords(_bytecodeHash) % 2 == 1, "Code length in words must be odd");
```

- *L1Messenger.sol* ( [90-90](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L90-L90), [90-90](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L90-L90), [118-118](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L118-L118), [154-154](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L154-L154), [154-154](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L154-L154), [166-166](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L166-L166), [179-179](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L179-L179), [179-179](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L179-L179), [207-209](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L207-L209), [239-241](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L239-L241), [262-264](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L262-L264), [320-320](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L320-L320), [321-325](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L321-L325), [324-324](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L324-L324), [326-326](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L326-L326) ):

```solidity
90:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), 0);

90:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), 0);

118:         hash = EfficientCall.keccak(_message);

154:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), uint32(pubdataLen));

154:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), uint32(pubdataLen));

166:         uint256 bytecodeLen = Utils.bytecodeLenInBytes(_bytecodeHash);

179:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), uint32(pubdataLen));

179:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), uint32(pubdataLen));

207:             bytes32 hashedLog = EfficientCall.keccak(
208:                 _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + L2_TO_L1_LOG_SERIALIZE_SIZE]
209:             );

239:             bytes32 hashedMessage = EfficientCall.keccak(
240:                 _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + currentMessageLength]
241:             );

262:                     Utils.hashL2Bytecode(
263:                         _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + currentBytecodeLength]
264:                     )

320:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.L2_TO_L1_LOGS_TREE_ROOT_KEY)), l2ToL1LogsTreeRoot);

321:         SystemContractHelper.toL1(
322:             true,
323:             bytes32(uint256(SystemLogKey.TOTAL_L2_TO_L1_PUBDATA_KEY)),
324:             EfficientCall.keccak(totalL2ToL1Pubdata)
325:         );

324:             EfficientCall.keccak(totalL2ToL1Pubdata)

326:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.STATE_DIFF_HASH_KEY)), stateDiffHash);
```

- *MsgValueSimulator.sol* ( [26-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L26-L26), [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L27-L27), [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L28-L28), [79-79](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L79-L79), [79-79](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L79-L79), [81-81](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L81-L81) ):

```solidity
26:         value = SystemContractHelper.getExtraAbiData(0);

27:         uint256 addressAsUint = SystemContractHelper.getExtraAbiData(1);

28:         uint256 mask = SystemContractHelper.getExtraAbiData(2);

79:         SystemContractHelper.setValueForNextFarCall(Utils.safeCastToU128(value));

79:         SystemContractHelper.setValueForNextFarCall(Utils.safeCastToU128(value));

81:         return EfficientCall.mimicCall(userGas, to, _data, msg.sender, false, isSystemCall);
```

- *PubdataChunkPublisher.sol* ( [55-55](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L55-L55), [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L56-L56) ):

```solidity
55:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_ONE_HASH_KEY)), blobHashes[0]);

56:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_TWO_HASH_KEY)), blobHashes[1]);
```

- *SystemContext.sol* ( [118-118](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L118-L118), [418-422](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L418-L422), [466-466](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L466-L466) ):

```solidity
118:         uint256 pubdataPublished = SystemContractHelper.getZkSyncMeta().pubdataPublished;

418:         SystemContractHelper.toL1(
419:             false,
420:             bytes32(uint256(SystemLogKey.PACKED_BATCH_AND_L2_BLOCK_TIMESTAMP_KEY)),
421:             bytes32(packedTimestamps)
422:         );

466:         SystemContractHelper.toL1(false, bytes32(uint256(SystemLogKey.PREV_BATCH_HASH_KEY)), _prevBatchHash);
```

- *ISystemContract.sol* ( [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContract.sol#L22-L22), [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContract.sol#L22-L22), [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContract.sol#L32-L32) ):

```solidity
22:             SystemContractHelper.isSystemCall() || SystemContractHelper.isSystemContract(msg.sender),

22:             SystemContractHelper.isSystemCall() || SystemContractHelper.isSystemContract(msg.sender),

32:             SystemContractHelper.isSystemContract(msg.sender),
```

- *EfficientCall.sol* ( [251-251](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L251-L251), [259-259](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L259-L259), [262-262](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L262-L262), [264-264](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L264-L264), [265-272](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L265-L272), [273-273](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L273-L273) ):

```solidity
251:         SystemContractHelper.loadCalldataIntoActivePtr();

259:         SystemContractHelper.ptrAddIntoActive(uint32(dataOffset));

262:         SystemContractHelper.ptrShrinkIntoActive(shrinkTo);

264:         uint32 gas = Utils.safeCastToU32(_gas);

265:         uint256 farCallAbi = SystemContractsCaller.getFarCallABIWithEmptyFatPointer(
266:             gas,
267:             // Only rollup is supported for now
268:             0,
269:             CalldataForwardingMode.ForwardFatPointer,
270:             _isConstructor,
271:             _isSystem
272:         );

273:         SystemContractHelper.ptrPackIntoActivePtr(farCallAbi);
```

- *SystemContractsCaller.sol* ( [83-83](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L83-L83), [85-96](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L85-L96) ):

```solidity
83:         uint32 dataLength = uint32(Utils.safeCastToU32(data.length));

85:         uint256 farCallAbi = SystemContractsCaller.getFarCallABI(
86:             0,
87:             0,
88:             dataStart,
89:             dataLength,
90:             gasLimit,
91:             // Only rollup is supported for now
92:             0,
93:             CalldataForwardingMode.UseHeap,
94:             false,
95:             true
96:         );
```

- *TransactionHelper.sol* ( [132-132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L132-L132), [134-134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L134-L134), [155-155](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L155-L155), [159-159](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L159-L159), [160-160](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L160-L160), [164-164](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L164-L164), [165-165](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L165-L165), [174-174](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L174-L174), [185-185](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L185-L185), [199-199](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L199-L199), [228-228](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L228-L228), [229-229](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L229-L229), [230-230](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L230-L230), [231-231](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L231-L231), [232-232](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L232-L232), [233-233](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L233-L233), [252-252](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L252-L252), [261-261](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L261-L261), [271-271](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L271-L271), [298-298](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L298-L298), [299-299](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L299-L299), [300-300](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L300-L300), [301-301](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L301-L301), [302-302](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L302-L302), [303-303](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L303-L303), [304-304](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L304-L304), [324-324](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L324-L324), [333-333](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L333-L333), [343-343](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L343-L343) ):

```solidity
132:                 EfficientCall.keccak(_transaction.data),

134:                 EfficientCall.keccak(_transaction.paymasterInput)

155:         bytes memory encodedNonce = RLPEncoder.encodeUint256(_transaction.nonce);

159:             bytes memory encodedGasPrice = RLPEncoder.encodeUint256(_transaction.maxFeePerGas);

160:             bytes memory encodedGasLimit = RLPEncoder.encodeUint256(_transaction.gasLimit);

164:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));

165:         bytes memory encodedValue = RLPEncoder.encodeUint256(_transaction.value);

174:                 encodedDataLength = RLPEncoder.encodeNonSingleBytesLen(txDataLen);

185:             encodedChainId = bytes.concat(RLPEncoder.encodeUint256(block.chainid), hex"80_80");

199:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength));

228:             bytes memory encodedChainId = RLPEncoder.encodeUint256(block.chainid);

229:             bytes memory encodedNonce = RLPEncoder.encodeUint256(_transaction.nonce);

230:             bytes memory encodedGasPrice = RLPEncoder.encodeUint256(_transaction.maxFeePerGas);

231:             bytes memory encodedGasLimit = RLPEncoder.encodeUint256(_transaction.gasLimit);

232:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));

233:             bytes memory encodedValue = RLPEncoder.encodeUint256(_transaction.value);

252:                 encodedDataLength = RLPEncoder.encodeNonSingleBytesLen(txDataLen);

261:         bytes memory encodedAccessListLength = RLPEncoder.encodeListLen(0);

271:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength));

298:             bytes memory encodedChainId = RLPEncoder.encodeUint256(block.chainid);

299:             bytes memory encodedNonce = RLPEncoder.encodeUint256(_transaction.nonce);

300:             bytes memory encodedMaxPriorityFeePerGas = RLPEncoder.encodeUint256(_transaction.maxPriorityFeePerGas);

301:             bytes memory encodedMaxFeePerGas = RLPEncoder.encodeUint256(_transaction.maxFeePerGas);

302:             bytes memory encodedGasLimit = RLPEncoder.encodeUint256(_transaction.gasLimit);

303:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));

304:             bytes memory encodedValue = RLPEncoder.encodeUint256(_transaction.value);

324:                 encodedDataLength = RLPEncoder.encodeNonSingleBytesLen(txDataLen);

333:         bytes memory encodedAccessListLength = RLPEncoder.encodeListLen(0);

343:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength));
```

- *Utils.sol* ( [90-90](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L90-L90) ):

```solidity
90:             EfficientCall.sha(_bytecode) &
```

</details>

### [N-79] Using underscore at the end of variable name

The use of the underscore at the end of the variable name is unusual, consider refactoring it.

There is 1 instance:

- *L2StandardERC20.sol* ( [33-33](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L33-L33) ):

```solidity
/// @audit decimals_
33:     uint8 private decimals_;
```

### [N-80] Use a struct to encapsulate multiple function parameters

If a function has too many parameters, replacing them with a struct can improve code readability and maintainability, increase reusability, and reduce the likelihood of errors when passing the parameters.

<details>
<summary>There are 17 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [100-106](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L100-L106), [135-142](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L135-L142), [178-186](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L178-L186), [210-216](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L210-L216) ):

```solidity
100:     function deposit(
101:         address _l2Receiver,
102:         address _l1Token,
103:         uint256 _amount,
104:         uint256 _l2TxGasLimit,
105:         uint256 _l2TxGasPerPubdataByte
106:     ) external payable returns (bytes32 l2TxHash) {

135:     function deposit(
136:         address _l2Receiver,
137:         address _l1Token,
138:         uint256 _amount,
139:         uint256 _l2TxGasLimit,
140:         uint256 _l2TxGasPerPubdataByte,
141:         address _refundRecipient
142:     ) public payable nonReentrant returns (bytes32 l2TxHash) {

178:     function claimFailedDeposit(
179:         address _depositSender,
180:         address _l1Token,
181:         bytes32 _l2TxHash,
182:         uint256 _l2BatchNumber,
183:         uint256 _l2MessageIndex,
184:         uint16 _l2TxNumberInBatch,
185:         bytes32[] calldata _merkleProof
186:     ) external nonReentrant {

210:     function finalizeWithdrawal(
211:         uint256 _l2BatchNumber,
212:         uint256 _l2MessageIndex,
213:         uint16 _l2TxNumberInBatch,
214:         bytes calldata _message,
215:         bytes32[] calldata _merkleProof
216:     ) external nonReentrant {
```

- *L1SharedBridge.sol* ( [279-289](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L279-L289), [305-316](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L305-L316), [387-394](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L387-L394), [411-418](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L411-L418) ):

```solidity
279:     function claimFailedDeposit(
280:         uint256 _chainId,
281:         address _depositSender,
282:         address _l1Token,
283:         uint256 _amount,
284:         bytes32 _l2TxHash,
285:         uint256 _l2BatchNumber,
286:         uint256 _l2MessageIndex,
287:         uint16 _l2TxNumberInBatch,
288:         bytes32[] calldata _merkleProof
289:     ) external override {

305:     function _claimFailedDeposit(
306:         bool _checkedInLegacyBridge,
307:         uint256 _chainId,
308:         address _depositSender,
309:         address _l1Token,
310:         uint256 _amount,
311:         bytes32 _l2TxHash,
312:         uint256 _l2BatchNumber,
313:         uint256 _l2MessageIndex,
314:         uint16 _l2TxNumberInBatch,
315:         bytes32[] calldata _merkleProof
316:     ) internal nonReentrant {

387:     function finalizeWithdrawal(
388:         uint256 _chainId,
389:         uint256 _l2BatchNumber,
390:         uint256 _l2MessageIndex,
391:         uint16 _l2TxNumberInBatch,
392:         bytes calldata _message,
393:         bytes32[] calldata _merkleProof
394:     ) external override {

411:     function _finalizeWithdrawal(
412:         uint256 _chainId,
413:         uint256 _l2BatchNumber,
414:         uint256 _l2MessageIndex,
415:         uint16 _l2TxNumberInBatch,
416:         bytes calldata _message,
417:         bytes32[] calldata _merkleProof
418:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount) {
```

- *L2SharedBridge.sol* ( [81-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L81-L87) ):

```solidity
81:     function finalizeDeposit(
82:         address _l1Sender,
83:         address _l2Receiver,
84:         address _l1Token,
85:         uint256 _amount,
86:         bytes calldata _data
87:     ) external payable override {
```

- *IL1ERC20Bridge.sol* ( [11-17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L11-L17) ):

```solidity
11:     function finalizeWithdrawal(
12:         uint256 _l2BatchNumber,
13:         uint256 _l2MessageIndex,
14:         uint16 _l2TxNumberInBatch,
15:         bytes calldata _message,
16:         bytes32[] calldata _merkleProof
17:     ) external;
```

- *IL1SharedBridge.sol* ( [11-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL1SharedBridge.sol#L11-L18) ):

```solidity
11:     function finalizeWithdrawal(
12:         uint256 _chainId,
13:         uint256 _l2BatchNumber,
14:         uint256 _l2MessageIndex,
15:         uint16 _l2TxNumberInBatch,
16:         bytes calldata _message,
17:         bytes32[] calldata _merkleProof
18:     ) external;
```

- *IL2SharedBridge.sol* ( [26-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L26-L32) ):

```solidity
26:     function finalizeDeposit(
27:         address _l1Sender,
28:         address _l2Receiver,
29:         address _l1Token,
30:         uint256 _amount,
31:         bytes calldata _data
32:     ) external payable;
```

- *IPaymaster.sol* ( [45-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L45-L52) ):

```solidity
45:     function postTransaction(
46:         bytes calldata _context,
47:         Transaction calldata _transaction,
48:         bytes32 _txHash,
49:         bytes32 _suggestedSignedHash,
50:         ExecutionResult _txResult,
51:         uint256 _maxRefundedGas
52:     ) external payable;
```

- *ContractDeployer.sol* ( [321-328](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L321-L328) ):

```solidity
321:     function _constructContract(
322:         address _sender,
323:         address _newAddress,
324:         bytes32 _bytecodeHash,
325:         bytes calldata _input,
326:         bool _isSystem,
327:         bool _callConstructor
328:     ) internal {
```

- *SystemContext.sol* ( [341-347](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L341-L347) ):

```solidity
341:     function setL2Block(
342:         uint128 _l2BlockNumber,
343:         uint128 _l2BlockTimestamp,
344:         bytes32 _expectedPrevL2BlockHash,
345:         bool _isFirstInBatch,
346:         uint128 _maxVirtualBlocksToCreate
347:     ) external onlyCallFromBootloader {
```

- *IMailbox.sol* ( [6-12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IMailbox.sol#L6-L12) ):

```solidity
6:     function finalizeEthWithdrawal(
7:         uint256 _l2BatchNumber,
8:         uint256 _l2MessageIndex,
9:         uint16 _l2TxNumberInBlock,
10:         bytes calldata _message,
11:         bytes32[] calldata _merkleProof
12:     ) external;
```

- *IPaymaster.sol* ( [43-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L43-L50) ):

```solidity
43:     function postTransaction(
44:         bytes calldata _context,
45:         Transaction calldata _transaction,
46:         bytes32 _txHash,
47:         bytes32 _suggestedSignedHash,
48:         ExecutionResult _txResult,
49:         uint256 _maxRefundedGas
50:     ) external payable;
```

</details>

### [N-81] Returning a struct instead of a bunch of variables is better

If a function returns [too many variables](https://docs.soliditylang.org/en/v0.8.21/contracts.html#returning-multiple-values), replacing them with a struct can improve code readability, maintainability and reusability.

<details>
<summary>There are 18 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [411-418](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L411-L418), [460-465](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L460-L465), [489-492](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L489-L492), [617-623](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L617-L623) ):

```solidity
411:     function _finalizeWithdrawal(
412:         uint256 _chainId,
413:         uint256 _l2BatchNumber,
414:         uint256 _l2MessageIndex,
415:         uint16 _l2TxNumberInBatch,
416:         bytes calldata _message,
417:         bytes32[] calldata _merkleProof
418:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount) {

460:     function _checkWithdrawal(
461:         uint256 _chainId,
462:         MessageParams memory _messageParams,
463:         bytes calldata _message,
464:         bytes32[] calldata _merkleProof
465:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {

489:     function _parseL2WithdrawalMessage(
490:         uint256 _chainId,
491:         bytes memory _l2ToL1message
492:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {

617:     function finalizeWithdrawalLegacyErc20Bridge(
618:         uint256 _l2BatchNumber,
619:         uint256 _l2MessageIndex,
620:         uint16 _l2TxNumberInBatch,
621:         bytes calldata _message,
622:         bytes32[] calldata _merkleProof
623:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount) {
```

- *IL1SharedBridge.sol* ( [99-105](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L99-L105) ):

```solidity
99:     function finalizeWithdrawalLegacyErc20Bridge(
100:         uint256 _l2BatchNumber,
101:         uint256 _l2MessageIndex,
102:         uint16 _l2TxNumberInBatch,
103:         bytes calldata _message,
104:         bytes32[] calldata _merkleProof
105:     ) external returns (address l1Receiver, address l1Token, uint256 amount);
```

- *IPaymaster.sol* ( [30-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L30-L34) ):

```solidity
30:     function validateAndPayForPaymasterTransaction(
31:         bytes32 _txHash,
32:         bytes32 _suggestedSignedHash,
33:         Transaction calldata _transaction
34:     ) external payable returns (bytes4 magic, bytes memory context);
```

- *BootloaderUtilities.sol* ( [24-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L24-L26) ):

```solidity
24:     function getTransactionHashes(
25:         Transaction calldata _transaction
26:     ) external view override returns (bytes32 txHash, bytes32 signedTxHash) {
```

- *Compressor.sol* ( [197-199](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L197-L199) ):

```solidity
197:     function _decodeRawBytecode(
198:         bytes calldata _rawCompressedData
199:     ) internal pure returns (bytes calldata dictionary, bytes calldata encodedData) {
```

- *MsgValueSimulator.sol* ( [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L25-L25) ):

```solidity
25:     function _getAbiParams() internal view returns (uint256 value, bool isSystemCall, address to) {
```

- *NonceHolder.sol* ( [179-179](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L179-L179) ):

```solidity
179:     function _splitRawNonce(uint256 _rawMinNonce) internal pure returns (uint256 deploymentNonce, uint256 minNonce) {
```

- *SystemContext.sol* ( [172-172](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L172-L172), [180-180](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L180-L180), [503-503](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L503-L503) ):

```solidity
172:     function getBatchNumberAndTimestamp() public view returns (uint128 batchNumber, uint128 batchTimestamp) {

180:     function getL2BlockNumberAndTimestamp() public view returns (uint128 blockNumber, uint128 blockTimestamp) {

503:     function getBlockNumberAndTimestamp() external view returns (uint256 blockNumber, uint256 blockTimestamp) {
```

- *IBootloaderUtilities.sol* ( [8-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBootloaderUtilities.sol#L8-L10) ):

```solidity
8:     function getTransactionHashes(
9:         Transaction calldata _transaction
10:     ) external view returns (bytes32 txHash, bytes32 signedTxHash);
```

- *IPaymaster.sol* ( [28-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L28-L32) ):

```solidity
28:     function validateAndPayForPaymasterTransaction(
29:         bytes32 _txHash,
30:         bytes32 _suggestedSignedHash,
31:         Transaction calldata _transaction
32:     ) external payable returns (bytes4 magic, bytes memory context);
```

- *ISystemContext.sol* ( [54-54](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContext.sol#L54-L54), [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContext.sol#L56-L56) ):

```solidity
54:     function getBatchNumberAndTimestamp() external view returns (uint128 blockNumber, uint128 blockTimestamp);

56:     function getL2BlockNumberAndTimestamp() external view returns (uint128 blockNumber, uint128 blockTimestamp);
```

- *ISystemContextDeprecated.sol* ( [13-13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContextDeprecated.sol#L13-L13) ):

```solidity
13:     function getBlockNumberAndTimestamp() external view returns (uint256 blockNumber, uint256 blockTimestamp);
```

</details>

### [N-82] Events that mark critical parameter changes should contain both the old and the new value

This should especially be done if the new value is not required to be different from the old value.

<details>
<summary>There are 10 instances (click to show):</summary>

- *StateTransitionManager.sol* ( [229-229](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L229-L229) ):

```solidity
229:         emit SetChainIdUpgrade(_chainContract, l2ProtocolUpgradeTx, protocolVersion);
```

- *Admin.sol* ( [49-49](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L49-L49), [56-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L56-L56), [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L94-L94), [117-117](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L117-L117), [127-127](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L127-L127) ):

```solidity
49:         emit ValidatorStatusUpdate(_validator, _active);

56:         emit IsPorterAvailableStatusUpdate(_zkPorterIsAvailable);

94:         emit ValidiumModeStatusUpdate(_validiumMode);

117:         emit ExecuteUpgrade(_diamondCut);

127:         emit ExecuteUpgrade(_diamondCut);
```

- *BaseZkSyncUpgrade.sol* ( [89-89](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L89-L89) ):

```solidity
89:         emit UpgradeComplete(_proposedUpgrade.newProtocolVersion, txHash, _proposedUpgrade);
```

- *BaseZkSyncUpgradeGenesis.sol* ( [69-69](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L69-L69) ):

```solidity
69:         emit UpgradeComplete(_proposedUpgrade.newProtocolVersion, txHash, _proposedUpgrade);
```

- *ContractDeployer.sol* ( [68-68](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L68-L68), [86-86](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L86-L86) ):

```solidity
68:         emit AccountVersionUpdated(msg.sender, _version);

86:         emit AccountNonceOrderingUpdated(msg.sender, _nonceOrdering);
```

</details>

### [N-83] Contract variables should have comments

Consider adding some comments on non-public contract variables to explain what they are supposed to do. This will help for future code reviews.

<details>
<summary>There are 6 instances (click to show):</summary>

- *ZkSyncStateTransitionBase.sol* ( [14-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L14-L14) ):

```solidity
14:     ZkSyncStateTransitionStorage internal s;
```

- *L2SharedBridge.sol* ( [39-39](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L39-L39) ):

```solidity
39:     address private l1LegacyBridge;
```

- *L2StandardERC20.sol* ( [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L28-L28) ):

```solidity
28:     ERC20Getters private availableGetters;
```

- *AccountCodeStorage.sol* ( [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L23-L23) ):

```solidity
23:     bytes32 constant EMPTY_STRING_KECCAK = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470;
```

- *NonceHolder.sol* ( [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L28-L28) ):

```solidity
28:     uint256 private constant DEPLOY_NONCE_MULTIPLIER = 2 ** 128;
```

- *TransactionHelper.sol* ( [84-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L84-L87) ):

```solidity
84:     bytes32 constant EIP712_TRANSACTION_TYPE_HASH =
85:         keccak256(
86:             "Transaction(uint256 txType,uint256 from,uint256 to,uint256 gasLimit,uint256 gasPerPubdataByteLimit,uint256 maxFeePerGas,uint256 maxPriorityFeePerGas,uint256 paymaster,uint256 nonce,uint256 value,bytes data,bytes32[] factoryDeps,bytes paymasterInput)"
87:         );
```

</details>

### [N-84] Missing event when a state variables is set in constructor

The initial states set in a constructor are important and should be recorded in the event.

There are 3 instances:

- *Governance.sol* ( [48](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L48), [51](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L51) ):

```solidity
48:         securityCouncil = _securityCouncil;

51:         minDelay = _minDelay;
```

- *ValidatorTimelock.sol* ( [59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L59) ):

```solidity
59:         executionDelay = _executionDelay;
```

### [N-85] Empty bytes check is missing

Passing empty bytes to a function can cause unexpected behavior, such as certain operations failing, producing incorrect results, or wasting gas. It is recommended to check that all byte parameters are not empty.

<details>
<summary>There are 20 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [210-216](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L210-L216) ):

```solidity
/// @audit _message
210:     function finalizeWithdrawal(
211:         uint256 _l2BatchNumber,
212:         uint256 _l2MessageIndex,
213:         uint16 _l2TxNumberInBatch,
214:         bytes calldata _message,
215:         bytes32[] calldata _merkleProof
216:     ) external nonReentrant {
```

- *L1SharedBridge.sol* ( [184-189](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L184-L189), [387-394](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L387-L394), [617-623](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L617-L623) ):

```solidity
/// @audit _data
184:     function bridgehubDeposit(
185:         uint256 _chainId,
186:         address _prevMsgSender,
187:         uint256, // l2Value, needed for Weth deposits in the future
188:         bytes calldata _data
189:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) {

/// @audit _message
387:     function finalizeWithdrawal(
388:         uint256 _chainId,
389:         uint256 _l2BatchNumber,
390:         uint256 _l2MessageIndex,
391:         uint16 _l2TxNumberInBatch,
392:         bytes calldata _message,
393:         bytes32[] calldata _merkleProof
394:     ) external override {

/// @audit _message
617:     function finalizeWithdrawalLegacyErc20Bridge(
618:         uint256 _l2BatchNumber,
619:         uint256 _l2MessageIndex,
620:         uint16 _l2TxNumberInBatch,
621:         bytes calldata _message,
622:         bytes32[] calldata _merkleProof
623:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount) {
```

- *Bridgehub.sol* ( [116-123](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L116-L123) ):

```solidity
/// @audit _initData
116:     function createNewChain(
117:         uint256 _chainId,
118:         address _stateTransitionManager,
119:         address _baseToken,
120:         uint256, //_salt
121:         address _admin,
122:         bytes calldata _initData
123:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {
```

- *StateTransitionManager.sol* ( [241-247](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L241-L247) ):

```solidity
/// @audit _diamondCut
241:     function createNewChain(
242:         uint256 _chainId,
243:         address _baseToken,
244:         address _sharedBridge,
245:         address _admin,
246:         bytes calldata _diamondCut
247:     ) external onlyBridgehub {
```

- *Mailbox.sol* ( [180-186](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L180-L186), [199-207](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L199-L207) ):

```solidity
/// @audit _message
180:     function finalizeEthWithdrawal(
181:         uint256 _l2BatchNumber,
182:         uint256 _l2MessageIndex,
183:         uint16 _l2TxNumberInBatch,
184:         bytes calldata _message,
185:         bytes32[] calldata _merkleProof
186:     ) external nonReentrant {

/// @audit _calldata
199:     function requestL2Transaction(
200:         address _contractL2,
201:         uint256 _l2Value,
202:         bytes calldata _calldata,
203:         uint256 _l2GasLimit,
204:         uint256 _l2GasPerPubdataByteLimit,
205:         bytes[] calldata _factoryDeps,
206:         address _refundRecipient
207:     ) external payable returns (bytes32 canonicalTxHash) {
```

- *L2SharedBridge.sol* ( [81-87](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L81-L87) ):

```solidity
/// @audit _data
81:     function finalizeDeposit(
82:         address _l1Sender,
83:         address _l2Receiver,
84:         address _l1Token,
85:         uint256 _amount,
86:         bytes calldata _data
87:     ) external payable override {
```

- *L2StandardERC20.sol* ( [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L52-L52) ):

```solidity
/// @audit _data
52:     function bridgeInitialize(address _l1Address, bytes memory _data) external initializer {
```

- *ComplexUpgrader.sol* ( [21-21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol#L21-L21) ):

```solidity
/// @audit _calldata
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable {
```

- *Compressor.sol* ( [44-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L44-L47), [110-115](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L110-L115) ):

```solidity
/// @audit _rawCompressedData
44:     function publishCompressedBytecode(
45:         bytes calldata _bytecode,
46:         bytes calldata _rawCompressedData
47:     ) external payable onlyCallFromBootloader returns (bytes32 bytecodeHash) {

/// @audit _stateDiffs
110:     function verifyCompressedStateDiffs(
111:         uint256 _numberOfStateDiffs,
112:         uint256 _enumerationIndexSize,
113:         bytes calldata _stateDiffs,
114:         bytes calldata _compressedStateDiffs
115:     ) external payable onlyCallFrom(address(L1_MESSENGER_CONTRACT)) returns (bytes32 stateDiffHash) {
```

- *ContractDeployer.sol* ( [132-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L132-L136), [147-151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L147-L151), [162-167](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L162-L167), [182-187](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L182-L187) ):

```solidity
/// @audit _input
132:     function create2(
133:         bytes32 _salt,
134:         bytes32 _bytecodeHash,
135:         bytes calldata _input
136:     ) external payable override returns (address) {

/// @audit _input
147:     function create(
148:         bytes32 _salt,
149:         bytes32 _bytecodeHash,
150:         bytes calldata _input
151:     ) external payable override returns (address) {

/// @audit _input
162:     function create2Account(
163:         bytes32 _salt,
164:         bytes32 _bytecodeHash,
165:         bytes calldata _input,
166:         AccountAbstractionVersion _aaVersion
167:     ) public payable override onlySystemCall returns (address) {

/// @audit _input
182:     function createAccount(
183:         bytes32, // salt
184:         bytes32 _bytecodeHash,
185:         bytes calldata _input,
186:         AccountAbstractionVersion _aaVersion
187:     ) public payable override onlySystemCall returns (address) {
```

- *L1Messenger.sol* ( [116-116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L116-L116) ):

```solidity
/// @audit _message
116:     function sendToL1(bytes calldata _message) external override returns (bytes32 hash) {
```

- *L2BaseToken.sol* ( [85-85](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L85-L85) ):

```solidity
/// @audit _additionalData
85:     function withdrawWithMessage(address _l1Receiver, bytes memory _additionalData) external payable override {
```

- *MsgValueSimulator.sol* ( [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L47-L47) ):

```solidity
/// @audit _data
47:     fallback(bytes calldata _data) external onlySystemCall returns (bytes memory) {
```

</details>

### [N-86] Don't define functions with the same name in a contract

In Solidity, while function overriding allows for functions with the same name to coexist, it is advisable to avoid this practice to enhance code readability and maintainability. Having multiple functions with the same name, even with different parameters or in inherited contracts, can cause confusion and increase the likelihood of errors during development, testing, and debugging. Using distinct and descriptive function names not only clarifies the purpose and behavior of each function, but also helps prevent unintended function calls or incorrect overriding. By adopting a clear and consistent naming convention, developers can create more comprehensible and maintainable smart contracts.

There are 2 instances:

- *L1ERC20Bridge.sol* ( [135](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L135) ):

```solidity
/// @audit Different function with same name found on line 100
135:     function deposit(
```

- *IL1ERC20Bridge.sol* ( [37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L37) ):

```solidity
/// @audit Different function with same name found on line 28
37:     function deposit(
```

### [N-87] Interface files should not use fixed compiler versions

Interfaces should not use fixed compiler versions, since they may be used by projects using a different version.

<details>
<summary>There are 47 instances (click to show):</summary>

- *IL1ERC20Bridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL1SharedBridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL2Bridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IWETH9.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IBridgehub.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Config.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *L2ContractAddresses.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/L2ContractAddresses.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Messaging.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Messaging.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL2ContractDeployer.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/interfaces/IL2ContractDeployer.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IGovernance.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IStateTransitionManager.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ZkSyncStateTransitionStorage.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IAdmin.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IDiamondInit.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IExecutor.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IGetters.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *ILegacyGetters.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/ILegacyGetters.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IMailbox.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IVerifier.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IVerifier.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IZkSyncStateTransition.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IZkSyncStateTransitionBase.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransitionBase.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IDefaultUpgrade.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL1ERC20Bridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL1ERC20Bridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL1SharedBridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL1SharedBridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL2SharedBridge.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IL2StandardToken.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IPaymaster.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *IPaymasterFlow.sol* ( [1](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymasterFlow.sol#L1) ):

```solidity
1: pragma solidity 0.8.20;
```

- *Constants.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IAccount.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IAccount.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IAccountCodeStorage.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IAccountCodeStorage.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IBaseToken.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBaseToken.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IBootloaderUtilities.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBootloaderUtilities.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IComplexUpgrader.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IComplexUpgrader.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *ICompressor.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ICompressor.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IContractDeployer.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IImmutableSimulator.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IImmutableSimulator.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IKnownCodesStorage.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IKnownCodesStorage.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IL1Messenger.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IL2StandardToken.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IMailbox.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IMailbox.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *INonceHolder.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/INonceHolder.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IPaymaster.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IPaymasterFlow.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymasterFlow.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *IPubdataChunkPublisher.sol* ( [2](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPubdataChunkPublisher.sol#L2) ):

```solidity
2: pragma solidity 0.8.20;
```

- *ISystemContext.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContext.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

- *ISystemContextDeprecated.sol* ( [3](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContextDeprecated.sol#L3) ):

```solidity
3: pragma solidity 0.8.20;
```

</details>

### [N-88] Addresses shouldn't be hard-coded

It is often better to declare `address`es as `constant` or `immutable` which can be assigned in constructor. This allows the code to remain the same across deployments on different networks, and avoids recompilation when addresses need to change.

There are 3 instances:

- *Config.sol* ( [112](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol#L112) ):

```solidity
112: address constant ERA_DIAMOND_PROXY = 0x77AE03789270Ad12d3d47FCAf7234241FceeC532;
```

- *AddressAliasHelper.sol* ( [24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol#L24) ):

```solidity
24:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
```

- *AddressAliasHelper.sol* ( [24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L24) ):

```solidity
24:     uint160 constant offset = uint160(0x1111000000000000000000000000000000001111);
```

### [N-89] Assembly block creates dirty bits

Writing data to the free memory pointer without later updating the free memory pointer will cause there to be dirty bits at that memory location. Not updating the free memory pointer will make it [harder](https://docs.soliditylang.org/en/latest/ir-breaking-changes.html#cleanup) for the optimizer to reason about whether the memory needs to be cleaned before use, which will lead to worse optimizations. Update the free memory pointer and annotate the block (`assembly ("memory-safe") { ... }`) to avoid this issue.

<details>
<summary>There are 2 instances (click to show):</summary>

- *DiamondProxy.sol* ( [35-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L35-L56) ):

```solidity
35:         assembly {
36:             // The pointer to the free memory slot
37:             let ptr := mload(0x40)
38:             // Copy function signature and arguments from calldata at zero position into memory at pointer position
39:             calldatacopy(ptr, 0, calldatasize())
40:             // Delegatecall method of the implementation contract returns 0 on error
41:             let result := delegatecall(gas(), facetAddress, ptr, calldatasize(), 0, 0)
42:             // Get the size of the last return data
43:             let size := returndatasize()
44:             // Copy the size length of bytes from return data at zero position to pointer position
45:             returndatacopy(ptr, 0, size)
46:             // Depending on the result value
47:             switch result
48:             case 0 {
49:                 // End execution and revert state changes
50:                 revert(ptr, size)
51:             }
52:             default {
53:                 // Return data with length of size at pointers position
54:                 return(ptr, size)
55:             }
56:         }
```

- *DefaultAccount.sol* ( [168-172](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L168-L172) ):

```solidity
168:         assembly {
169:             r := mload(add(_signature, 0x20))
170:             s := mload(add(_signature, 0x40))
171:             v := and(mload(add(_signature, 0x41)), 0xff)
172:         }
```

</details>

### [N-90] Multiple mappings with same keys can be combined into a single struct mapping for readability

Well-organized data structures make code reviews easier, which may lead to fewer bugs. Consider combining related mappings into mappings to structs, so it's clear what data is related.

<details>
<summary>There are 19 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [34-34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L34-L34), [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L47-L47), [50-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L50-L50), [53-53](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L53-L53) ):

```solidity
34:     mapping(address account => mapping(address l1Token => mapping(bytes32 depositL2TxHash => uint256 amount)))

47:     mapping(address => uint256) private __DEPRECATED_lastWithdrawalLimitReset;

50:     mapping(address => uint256) private __DEPRECATED_withdrawnAmountInWindow;

53:     mapping(address => mapping(address => uint256)) private __DEPRECATED_totalDepositedAmountPerUser;
```

- *L1SharedBridge.sol* ( [50-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L50-L50), [54-54](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L54-L54), [59-59](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L59-L59), [63-63](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L63-L63), [67-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L67-L67) ):

```solidity
50:     mapping(uint256 chainId => address l2Bridge) public override l2BridgeAddress;

54:     mapping(uint256 chainId => mapping(bytes32 l2DepositTxHash => bytes32 depositDataHash))

59:     mapping(uint256 chainId => mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized)))

63:     mapping(uint256 chainId => bool enabled) internal hyperbridgingEnabled;

67:     mapping(uint256 chainId => mapping(address l1Token => uint256 balance)) internal chainBalance;
```

- *Bridgehub.sol* ( [23-23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L23-L23), [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L25-L25), [28-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L28-L28), [31-31](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L31-L31) ):

```solidity
23:     mapping(address _stateTransitionManager => bool) public stateTransitionManagerIsRegistered;

25:     mapping(address _token => bool) public tokenIsRegistered;

28:     mapping(uint256 _chainId => address) public stateTransitionManager;

31:     mapping(uint256 _chainId => address) public baseToken;
```

- *StateTransitionManager.sol* ( [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L32-L32), [50-50](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L50-L50) ):

```solidity
32:     mapping(uint256 => address) public stateTransition;

50:     mapping(uint256 => bytes32) public upgradeCutHash;
```

- *ValidatorTimelock.sol* ( [49-49](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L49-L49), [52-52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L52-L52) ):

```solidity
49:     mapping(uint256 => LibMap.Uint32Map) internal committedBatchTimestamp;

52:     mapping(uint256 _chainId => mapping(address _validator => bool)) public validators;
```

- *NonceHolder.sol* ( [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L36-L36), [41-41](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L41-L41) ):

```solidity
36:     mapping(uint256 account => uint256 packedMinAndDeploymentNonce) internal rawNonces;

41:     mapping(uint256 account => mapping(uint256 nonceKey => uint256 value)) internal nonceValues;
```

</details>

### [N-91] Control structures do not follow the Solidity Style Guide

Refer to the [Solidity style guide - Control Structures](https://docs.soliditylang.org/en/v0.8.20/style-guide.html#control-structures).

<details>
<summary>There are 9 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [62-62](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L62-L62) ):

```solidity
62:     function initialize() external reentrancyGuardInitializer {}
```

- *BaseZkSyncUpgrade.sol* ( [149-149](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L149-L149), [265-265](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L265-L265), [271-271](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L271-L271) ):

```solidity
149:         if (

265:     function _upgradeL1Contract(bytes calldata _customCallDataForUpgrade) internal virtual {}

271:     function _postUpgrade(bytes calldata _customCallDataForUpgrade) internal virtual {}
```

- *L2StandardERC20.sol* ( [163-163](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L163-L163), [169-169](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L169-L169), [175-175](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L175-L175) ):

```solidity
163:         if (availableGetters.ignoreName) revert();

169:         if (availableGetters.ignoreSymbol) revert();

175:         if (availableGetters.ignoreDecimals) revert();
```

- *AccountCodeStorage.sol* ( [131-131](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L131-L131) ):

```solidity
131:         if (
```

- *ContractDeployer.sol* ( [47-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L47-L47) ):

```solidity
47:         if (
```

</details>

### [N-92] Do not cache constants

Instead of caching constants, using the defined constants directly can make code more consistent and less prone to errors.

There is 1 instance:

- *L1Messenger.sol* ( [221-221](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L221-L221) ):

```solidity
/// @audit L2_TO_L1_LOGS_MERKLE_TREE_LEAVES
221:         uint256 nodesOnCurrentLevel = L2_TO_L1_LOGS_MERKLE_TREE_LEAVES;
```

### [N-93] Too long functions should be refactored

Functions with too many lines are difficult to understand. It is recommended to refactor complex functions into multiple shorter and easier to understand functions.

There are 5 instances:

- *L1SharedBridge.sol* ( [305](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L305) ):

```solidity
/// @audit 66 lines
305:     function _claimFailedDeposit(
```

- *Executor.sol* ( [34](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L34), [132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L132) ):

```solidity
/// @audit 66 lines
34:     function _commitOneBatch(

/// @audit 67 lines
132:     function _processL2Logs(
```

- *L2StandardERC20.sol* ( [52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L52) ):

```solidity
/// @audit 53 lines
52:     function bridgeInitialize(address _l1Address, bytes memory _data) external initializer {
```

- *L1Messenger.sol* ( [194](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L194) ):

```solidity
/// @audit 140 lines
194:     function publishPubdataAndClearState(
```

### [N-94] Inconsistent spacing in comments

The comments below are in the `//x` format, which differs from the commonly used idiomatic comment syntax of `//<space>x`. It is recommended to use a consistent comment syntax throughout.

<details>
<summary>There are 38 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L74), [86](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L86) ):

```solidity
74:     //////////////////////////////////////////////////////////////*/

86:     //////////////////////////////////////////////////////////////*/
```

- *L1SharedBridge.sol* ( [530](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L530), [613](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L613), [637](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L637) ):

```solidity
530:     //////////////////////////////////////////////////////////////*/

613:     ///

637:     ///
```

- *Bridgehub.sol* ( [74](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L74), [81](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L81), [120](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L120), [151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L151) ):

```solidity
74:     ///// Getters

81:     //// Registry

120:         uint256, //_salt

151:     //// Mailbox forwarder
```

- *IBridgehub.sol* ( [116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L116) ):

```solidity
116:     //// Registry
```

- *Governance.sol* ( [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L17), [57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L57), [82](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L82), [122](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L122), [151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L151), [164](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L164), [212](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L212), [247](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L247) ):

```solidity
17: ///

57:     //////////////////////////////////////////////////////////////*/

82:     //////////////////////////////////////////////////////////////*/

122:     //////////////////////////////////////////////////////////////*/

151:     //////////////////////////////////////////////////////////////*/

164:     //////////////////////////////////////////////////////////////*/

212:     //////////////////////////////////////////////////////////////*/

247:     //////////////////////////////////////////////////////////////*/
```

- *Admin.sol* ( [99](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L99), [132](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L132) ):

```solidity
99:     //////////////////////////////////////////////////////////////*/

132:     //////////////////////////////////////////////////////////////*/
```

- *Executor.sol* ( [572](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L572), [602](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L602) ):

```solidity
572:         //

602:     ///
```

- *Getters.sol* ( [31](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L31), [201](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L201), [238](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L238) ):

```solidity
31:     //////////////////////////////////////////////////////////////*/

201:      //////////////////////////////////////////////////////////////*/

238:     //////////////////////////////////////////////////////////////*/
```

- *Mailbox.sol* ( [86](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L86) ):

```solidity
86:         //
```

- *IGetters.sol* ( [18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L18), [121](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L121) ):

```solidity
18:     //////////////////////////////////////////////////////////////*/

121:     //////////////////////////////////////////////////////////////*/
```

- *BootloaderUtilities.sol* ( [48](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L48) ):

```solidity
48:         //
```

- *DefaultAccount.sol* ( [179](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L179) ):

```solidity
179:         //
```

- *SystemContext.sol* ( [492](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L492) ):

```solidity
492:     //////////////////////////////////////////////////////////////*/
```

- *SystemContractsCaller.sol* ( [192](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L192), [194](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L194), [201](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L201), [203](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L203) ):

```solidity
192:     ///

194:     ///

201:     ///

203:     ///
```

- *TransactionHelper.sol* ( [151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L151), [222](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L222), [292](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L292) ):

```solidity
151:         //

222:         //

292:         //
```

</details>

### [N-95] Missing event for critical changes

Events should be emitted when critical changes are made to the contracts.

<details>
<summary>There are 18 instances (click to show):</summary>

- *Bridgehub.sol* ( [84-90](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L84-L90), [94-100](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L94-L100), [103-106](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L103-L106), [110-112](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L110-L112) ):

```solidity
84:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner {
85:         require(
86:             !stateTransitionManagerIsRegistered[_stateTransitionManager],
87:             "Bridgehub: state transition already registered"
88:         );
89:         stateTransitionManagerIsRegistered[_stateTransitionManager] = true;
90:     }

94:     function removeStateTransitionManager(address _stateTransitionManager) external onlyOwner {
95:         require(
96:             stateTransitionManagerIsRegistered[_stateTransitionManager],
97:             "Bridgehub: state transition not registered yet"
98:         );
99:         stateTransitionManagerIsRegistered[_stateTransitionManager] = false;
100:     }

103:     function addToken(address _token) external onlyOwner {
104:         require(!tokenIsRegistered[_token], "Bridgehub: token already registered");
105:         tokenIsRegistered[_token] = true;
106:     }

110:     function setSharedBridge(address _sharedBridge) external onlyOwner {
111:         sharedBridge = IL1SharedBridge(_sharedBridge);
112:     }
```

- *StateTransitionManager.sol* ( [134-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L134-L136), [139-141](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L139-L141), [144-151](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L144-L151), [154-159](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L154-L159) ):

```solidity
134:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin {
135:         validatorTimelock = _validatorTimelock;
136:     }

139:     function setInitialCutHash(Diamond.DiamondCutData calldata _diamondCut) external onlyOwner {
140:         initialCutHash = keccak256(abi.encode(_diamondCut));
141:     }

144:     function setNewVersionUpgrade(
145:         Diamond.DiamondCutData calldata _cutData,
146:         uint256 _oldProtocolVersion,
147:         uint256 _newProtocolVersion
148:     ) external onlyOwner {
149:         upgradeCutHash[_oldProtocolVersion] = keccak256(abi.encode(_cutData));
150:         protocolVersion = _newProtocolVersion;
151:     }

154:     function setUpgradeDiamondCut(
155:         Diamond.DiamondCutData calldata _cutData,
156:         uint256 _oldProtocolVersion
157:     ) external onlyOwner {
158:         upgradeCutHash[_oldProtocolVersion] = keccak256(abi.encode(_cutData));
159:     }
```

- *ValidatorTimelock.sol* ( [75-77](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L75-L77) ):

```solidity
75:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner {
76:         stateTransitionManager = _stateTransitionManager;
77:     }
```

- *ImmutableSimulator.sol* ( [34-44](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L34-L44) ):

```solidity
34:     function setImmutables(address _dest, ImmutableData[] calldata _immutables) external override {
35:         require(msg.sender == address(DEPLOYER_SYSTEM_CONTRACT), "Callable only by the deployer system contract");
36:         unchecked {
37:             uint256 immutablesLength = _immutables.length;
38:             for (uint256 i = 0; i < immutablesLength; ++i) {
39:                 uint256 index = _immutables[i].index;
40:                 bytes32 value = _immutables[i].value;
41:                 immutableDataStorage[uint256(uint160(_dest))][index] = value;
42:             }
43:         }
44:     }
```

- *SystemContext.sol* ( [84-86](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L84-L86), [99-101](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L99-L101), [105-107](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L105-L107), [112-115](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L112-L115), [212-214](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L212-L214), [263-267](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L263-L267), [314-323](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L314-L323), [444-449](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L444-L449) ):

```solidity
84:     function setChainId(uint256 _newChainId) external onlyCallFromForceDeployer {
85:         chainId = _newChainId;
86:     }

99:     function setTxOrigin(address _newOrigin) external onlyCallFromBootloader {
100:         origin = _newOrigin;
101:     }

105:     function setGasPrice(uint256 _gasPrice) external onlyCallFromBootloader {
106:         gasPrice = _gasPrice;
107:     }

112:     function setPubdataInfo(uint256 _gasPerPubdataByte, uint256 _basePubdataSpent) external onlyCallFromBootloader {
113:         basePubdataSpent = _basePubdataSpent;
114:         gasPerPubdataByte = _gasPerPubdataByte;
115:     }

212:     function _setL2BlockHash(uint256 _block, bytes32 _hash) internal {
213:         l2BlockHash[_block % MINIBLOCK_HASHES_TO_STORE] = _hash;
214:     }

263:     function _setVirtualBlock(
264:         uint128 _l2BlockNumber,
265:         uint128 _maxVirtualBlocksToCreate,
266:         uint128 _newTimestamp
267:     ) internal {

314:     function _setNewL2BlockData(uint128 _l2BlockNumber, uint128 _l2BlockTimestamp, bytes32 _prevL2BlockHash) internal {
315:         // In the unsafe version we do not check that the block data is correct
316:         currentL2BlockInfo = BlockInfo({number: _l2BlockNumber, timestamp: _l2BlockTimestamp});
317: 
318:         // It is always assumed in production that _l2BlockNumber > 0
319:         _setL2BlockHash(_l2BlockNumber - 1, _prevL2BlockHash);
320: 
321:         // Reseting the rolling hash
322:         currentL2BlockTxsRollingHash = bytes32(0);
323:     }

444:     function setNewBatch(
445:         bytes32 _prevBatchHash,
446:         uint128 _newTimestamp,
447:         uint128 _expectedNewNumber,
448:         uint256 _baseFee
449:     ) external onlyCallFromBootloader {
```

</details>

### [N-96] Non-assembly method available

There are some automated tools that will flag a project as having higher complexity if there is inline-assembly, so it's best to avoid using it where it's not necessary. In addition, most assembly methods can be replaced by non-assembly methods, for example:
- `assembly{ g := gas() }` => `uint256 g = gasleft()`
- `assembly{ id := chainid() }` => `uint256 id = block.chainid`
- `assembly { r := mulmod(a, b, d) }` => `uint256 m = mulmod(x, y, k)`
- `assembly { size := extcodesize() }` => `uint256 size = address(a).code.length`
- etc.

<details>
<summary>There are 19 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [360-360](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L360-L360), [449-449](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L449-L449) ):

```solidity
360:                 callSuccess := call(gas(), _depositSender, _amount, 0, 0, 0, 0)

449:                 callSuccess := call(gas(), l1Receiver, amount, 0, 0, 0, 0)
```

- *Governance.sol* ( [232-232](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L232-L232) ):

```solidity
232:                     revert(add(returnData, 0x20), mload(returnData))
```

- *Diamond.sol* ( [293-293](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L293-L293) ):

```solidity
293:                     revert(add(data, 0x20), mload(data))
```

- *SystemContractsCaller.sol* ( [64-64](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L64-L64), [73-73](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L73-L73) ):

```solidity
64:                 success := call(to, callAddr, 0, 0, farCallAbi, 0, 0)

73:                 success := call(msgValueSimulator, callAddr, value, to, farCallAbi, forwardMask, 0)
```

- *MsgValueSimulator.sol* ( [70-70](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L70-L70) ):

```solidity
70:                     revert(0, 0)
```

- *EfficientCall.sol* ( [136-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L136-L136), [149-149](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L149-L149), [164-164](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L164-L164), [178-178](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L178-L178) ):

```solidity
136:                 success := call(_address, callAddr, 0, 0, 0xFFFF, 0, 0)

149:                 success := call(msgValueSimulator, callAddr, _value, _address, 0xFFFF, forwardMask, 0)

164:             success := staticcall(_address, callAddr, 0, 0xFFFF, 0, 0)

178:             success := delegatecall(_address, callAddr, 0, 0xFFFF, 0, 0)
```

- *SystemContractHelper.sol* ( [66-66](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L66-L66), [206-206](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L206-L206), [299-299](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L299-L299), [310-310](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L310-L310), [323-323](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L323-L323) ):

```solidity
66:             addr := staticcall(0, callAddr, 0, 0xFFFF, 0, 0)

206:             meta := staticcall(0, callAddr, 0, 0xFFFF, 0, 0)

299:             callFlags := staticcall(0, callAddr, 0, 0xFFFF, 0, 0)

310:             ptr := staticcall(0, callAddr, 0, 0xFFFF, 0, 0)

323:             extraAbiData := staticcall(index, callAddr, 0, 0xFFFF, 0, 0)
```

- *SystemContractsCaller.sol* ( [101-101](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L101-L101), [110-110](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L110-L110) ):

```solidity
101:                 success := call(to, callAddr, 0, 0, farCallAbi, 0, 0)

110:                 success := call(msgValueSimulator, callAddr, value, to, farCallAbi, forwardMask, 0)
```

- *TransactionHelper.sol* ( [400-400](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L400-L400) ):

```solidity
400:             success := call(gas(), bootloaderAddr, amount, 0, 0, 0, 0)
```

</details>

### [N-97] Duplicated `require()`/`revert()` checks should be refactored

Refactoring duplicate `require()`/`revert()` checks into a modifier or function can make the code more concise, readable and maintainable, and less likely to make errors or omissions when modifying the `require()` or `revert()`.

There are 4 instances:

- *ValidatorTimelock.sol* ( [197-197](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L197-L197) ):

```solidity
/// @audit Duplicated on line 219
197:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c"); // The delay is not passed
```

- *L2SharedBridge.sol* ( [58-58](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L58-L58) ):

```solidity
/// @audit Duplicated on line 60
58:         require(_l2TokenProxyBytecodeHash != bytes32(0), "df");
```

- *BootloaderUtilities.sol* ( [92-92](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L92-L92) ):

```solidity
/// @audit Duplicated on line 191, 286
92:             require(vInt == 27 || vInt == 28, "Invalid v value");
```

### [N-98] Consider adding emergency-stop functionality

Adding a way to quickly halt protocol functionality in an emergency, rather than having to pause individual contracts one-by-one, will make in-progress hack mitigation faster and much less stressful.

<details>
<summary>There are 10 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [32-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L32-L32) ):

```solidity
32: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step {
```

- *Bridgehub.sol* ( [18-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L18-L18) ):

```solidity
18: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step {
```

- *Governance.sol* ( [22-22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L22-L22) ):

```solidity
22: contract Governance is IGovernance, Ownable2Step {
```

- *StateTransitionManager.sol* ( [27-27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L27-L27) ):

```solidity
27: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step {
```

- *ValidatorTimelock.sol* ( [24-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L24-L24) ):

```solidity
24: contract ValidatorTimelock is IExecutor, Ownable2Step {
```

- *Admin.sol* ( [20-20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L20-L20) ):

```solidity
20: contract AdminFacet is ZkSyncStateTransitionBase, IAdmin {
```

- *ForceDeployUpgrader.sol* ( [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L12) ):

```solidity
12: contract ForceDeployUpgrader {
```

- *L2SharedBridge.sol* ( [25-25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L25-L25) ):

```solidity
25: contract L2SharedBridge is IL2SharedBridge, Initializable {
```

- *L2StandardERC20.sol* ( [17-17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L17-L17) ):

```solidity
17: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade {
```

- *KnownCodesStorage.sol* ( [18-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L18-L18) ):

```solidity
18: contract KnownCodesStorage is IKnownCodesStorage, ISystemContract {
```

</details>

### [N-99] Avoid the use of sensitive terms

Use [alternative variants](https://www.zdnet.com/article/mysql-drops-master-slave-and-blacklist-whitelist-terminology/), e.g. allowlist/denylist instead of whitelist/blacklist.

<details>
<summary>There are 81 instances (click to show):</summary>

- *Messaging.sol* ( [88](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Messaging.sol#L88), [98](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Messaging.sol#L98), [108](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Messaging.sol#L108), [123](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Messaging.sol#L123) ):

```solidity
88: /// @param paymaster The address of the EIP-4337 paymaster, that will pay fees for the

98: /// @param paymasterInput The arbitrary-length data that is used as a calldata to the paymaster pre-call

108:     uint256 paymaster;

123:     bytes paymasterInput;
```

- *StateTransitionManager.sol* ( [192](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L192), [200](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L200) ):

```solidity
192:             paymaster: uint256(0),

200:             paymasterInput: new bytes(0),
```

- *Mailbox.sol* ( [304](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L304), [312](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L312) ):

```solidity
304:             paymaster: uint256(0),

312:             paymasterInput: new bytes(0),
```

- *TransactionValidator.sol* ( [52](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L52), [61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L61) ):

```solidity
52:         require(_transaction.paymaster == 0, "uc");

61:         require(_transaction.paymasterInput.length == 0, "ul1");
```

- *L2ContractHelper.sol* ( [137](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L137), [138](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L138), [160](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L160), [161](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol#L161) ):

```solidity
137:     // The transaction's paymaster. If there is no paymaster, it is equal to 0.

138:     uint256 paymaster;

160:     // The input to the paymaster.

161:     bytes paymasterInput;
```

- *IPaymaster.sol* ( [14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L14), [16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L16), [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L17), [23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L23), [24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L24), [30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L30), [39](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L39), [42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L42) ):

```solidity
14: bytes4 constant PAYMASTER_VALIDATION_SUCCESS_MAGIC = IPaymaster.validateAndPayForPaymasterTransaction.selector;

16: interface IPaymaster {

17:     /// @dev Called by the bootloader to verify that the paymaster agrees to pay for the

23:     /// @return magic The value that should be equal to the signature of the validateAndPayForPaymasterTransaction

24:     /// if the paymaster agrees to pay for the transaction.

30:     function validateAndPayForPaymasterTransaction(

39:     /// @param _context, the context of the execution, returned by the "validateAndPayForPaymasterTransaction" method.

42:     /// @param _maxRefundedGas, the upper bound on the amout of gas that could be refunded to the paymaster.
```

- *IPaymasterFlow.sol* ( [11](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymasterFlow.sol#L11), [15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymasterFlow.sol#L15) ):

```solidity
11:  * different types of paymaster flows.

15: interface IPaymasterFlow {
```

- *BootloaderUtilities.sol* ( [231](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L231) ):

```solidity
231:         // https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1559.md
```

- *DefaultAccount.sol* ( [206](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L206), [212](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L212), [217](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L217) ):

```solidity
206:     /// paid for by a paymaster.

212:     function prepareForPaymaster(

217:         _transaction.processPaymasterInput();
```

- *IAccount.sol* ( [42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IAccount.sol#L42) ):

```solidity
42:     function prepareForPaymaster(
```

- *IPaymaster.sol* ( [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L12), [14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L14), [15](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L15), [21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L21), [22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L22), [28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L28), [37](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L37), [40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L40) ):

```solidity
12: bytes4 constant PAYMASTER_VALIDATION_SUCCESS_MAGIC = IPaymaster.validateAndPayForPaymasterTransaction.selector;

14: interface IPaymaster {

15:     /// @dev Called by the bootloader to verify that the paymaster agrees to pay for the

21:     /// @return magic The value that should be equal to the signature of the validateAndPayForPaymasterTransaction

22:     /// if the paymaster agrees to pay for the transaction.

28:     function validateAndPayForPaymasterTransaction(

37:     /// @param _context, the context of the execution, returned by the "validateAndPayForPaymasterTransaction" method.

40:     /// @param _maxRefundedGas, the upper bound on the amout of gas that could be refunded to the paymaster.
```

- *IPaymasterFlow.sol* ( [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymasterFlow.sol#L8), [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymasterFlow.sol#L12) ):

```solidity
8:  * different types of paymaster flows.

12: interface IPaymasterFlow {
```

- *TransactionHelper.sol* ( [8](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L8), [43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L43), [44](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L44), [66](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L66), [67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L67), [86](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L86), [129](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L129), [134](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L134), [359](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L359), [361](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L361), [362](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L362), [363](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L363), [365](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L365), [366](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L366), [368](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L368), [369](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L369), [373](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L373), [374](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L374), [375](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L375), [377](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L377), [382](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L382), [383](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L383), [385](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L385), [386](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L386), [388](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L388), [406](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L406), [407](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L407) ):

```solidity
8: import "../interfaces/IPaymasterFlow.sol";

43:     // The transaction's paymaster. If there is no paymaster, it is equal to 0.

44:     uint256 paymaster;

66:     // The input to the paymaster.

67:     bytes paymasterInput;

86:             "Transaction(uint256 txType,uint256 from,uint256 to,uint256 gasLimit,uint256 gasPerPubdataByteLimit,uint256 maxFeePerGas,uint256 maxPriorityFeePerGas,uint256 paymaster,uint256 nonce,uint256 value,bytes data,bytes32[] factoryDeps,bytes paymasterInput)"

129:                 _transaction.paymaster,

134:                 EfficientCall.keccak(_transaction.paymasterInput)

359:     /// @notice Processes the common paymaster flows, e.g. setting proper allowance

361:     /// the "Paymaster flows" section in the documentation.

362:     function processPaymasterInput(Transaction calldata _transaction) internal {

363:         require(_transaction.paymasterInput.length >= 4, "The standard paymaster input must be at least 4 bytes long");

365:         bytes4 paymasterInputSelector = bytes4(_transaction.paymasterInput[0:4]);

366:         if (paymasterInputSelector == IPaymasterFlow.approvalBased.selector) {

368:                 _transaction.paymasterInput.length >= 68,

369:                 "The approvalBased paymaster input must be at least 68 bytes long"

373:             // the data is needed only for the paymaster, so we ignore it here for the sake of optimization

374:             (address token, uint256 minAllowance) = abi.decode(_transaction.paymasterInput[4:68], (address, uint256));

375:             address paymaster = address(uint160(_transaction.paymaster));

377:             uint256 currentAllowance = IERC20(token).allowance(address(this), paymaster);

382:                 IERC20(token).safeApprove(paymaster, 0);

383:                 IERC20(token).safeApprove(paymaster, minAllowance);

385:         } else if (paymasterInputSelector == IPaymasterFlow.general.selector) {

386:             // Do nothing. general(bytes) paymaster flow means that the paymaster must interpret these bytes on his own.

388:             revert("Unsupported paymaster flow");

406:         if (address(uint160(_transaction.paymaster)) != address(0)) {

407:             // Paymaster pays for the fee
```

</details>

### [N-100] Missing checks for uint state variable assignments

Consider whether reasonable bounds checks for variables would be useful.

<details>
<summary>There are 12 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [113-113](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L113-L113) ):

```solidity
113:         eraFirstPostUpgradeBatch = _eraFirstPostUpgradeBatch;
```

- *Governance.sol* ( [253-253](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L253-L253) ):

```solidity
253:         minDelay = _newDelay;
```

- *StateTransitionManager.sol* ( [88-88](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L88-L88), [150-150](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L150-L150) ):

```solidity
88:         protocolVersion = _initializeData.protocolVersion;

150:         protocolVersion = _newProtocolVersion;
```

- *ValidatorTimelock.sol* ( [99-99](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L99-L99) ):

```solidity
99:         executionDelay = _executionDelay;
```

- *L2StandardERC20.sol* ( [97-97](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L97-L97) ):

```solidity
97:             decimals_ = decimalsUint8;
```

- *SystemContext.sol* ( [85-85](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L85-L85), [106-106](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L106-L106), [113-113](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L113-L113), [114-114](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L114-L114), [463-463](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L463-L463), [479-479](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L479-L479) ):

```solidity
85:         chainId = _newChainId;

106:         gasPrice = _gasPrice;

113:         basePubdataSpent = _basePubdataSpent;

114:         gasPerPubdataByte = _gasPerPubdataByte;

463:         baseFee = _baseFee;

479:         baseFee = _baseFee;
```

</details>

### [N-101] Use the Modern Upgradeable Contract Paradigm

Modern smart contract development often employs upgradeable contract structures, utilizing proxy patterns like OpenZeppelin’s Upgradeable Contracts. This paradigm separates logic and state, allowing developers to amend and enhance the contract's functionality without altering its state or the deployed contract address. Transitioning to this approach enhances long-term maintainability.
Resolution: Adopt a well-established proxy pattern for upgradeability, ensuring proper initialization and employing transparent proxies to mitigate potential risks. Embrace comprehensive testing and audit practices, particularly when updating contract logic, to ensure state consistency and security are preserved across upgrades. This ensures your contract remains robust and adaptable to future requirements.

<details>
<summary>There are 28 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L21) ):

```solidity
21: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard {
```

- *Bridgehub.sol* ( [18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L18) ):

```solidity
18: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step {
```

- *Governance.sol* ( [22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L22) ):

```solidity
22: contract Governance is IGovernance, Ownable2Step {
```

- *StateTransitionManager.sol* ( [27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L27) ):

```solidity
27: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step {
```

- *ValidatorTimelock.sol* ( [24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L24) ):

```solidity
24: contract ValidatorTimelock is IExecutor, Ownable2Step {
```

- *DiamondInit.sol* ( [19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L19) ):

```solidity
19: contract DiamondInit is ZkSyncStateTransitionBase, IDiamondInit {
```

- *Admin.sol* ( [20](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L20) ):

```solidity
20: contract AdminFacet is ZkSyncStateTransitionBase, IAdmin {
```

- *Executor.sol* ( [24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L24) ):

```solidity
24: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor {
```

- *Getters.sol* ( [22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L22) ):

```solidity
22: contract GettersFacet is ZkSyncStateTransitionBase, IGetters, ILegacyGetters {
```

- *Mailbox.sol* ( [32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L32) ):

```solidity
32: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox {
```

- *ZkSyncStateTransitionBase.sol* ( [13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L13) ):

```solidity
13: contract ZkSyncStateTransitionBase is ReentrancyGuard {
```

- *DefaultUpgrade.sol* ( [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L12) ):

```solidity
12: contract DefaultUpgrade is BaseZkSyncUpgrade {
```

- *GenesisUpgrade.sol* ( [13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L13) ):

```solidity
13: contract GenesisUpgrade is BaseZkSyncUpgradeGenesis {
```

- *ForceDeployUpgrader.sol* ( [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L12) ):

```solidity
12: contract ForceDeployUpgrader {
```

- *AccountCodeStorage.sol* ( [22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L22) ):

```solidity
22: contract AccountCodeStorage is IAccountCodeStorage {
```

- *BootloaderUtilities.sol* ( [16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L16) ):

```solidity
16: contract BootloaderUtilities is IBootloaderUtilities {
```

- *ComplexUpgrader.sol* ( [14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol#L14) ):

```solidity
14: contract ComplexUpgrader is IComplexUpgrader {
```

- *Compressor.sol* ( [22](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L22) ):

```solidity
22: contract Compressor is ICompressor, ISystemContract {
```

- *DefaultAccount.sol* ( [19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L19) ):

```solidity
19: contract DefaultAccount is IAccount {
```

- *EmptyContract.sol* ( [10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/EmptyContract.sol#L10) ):

```solidity
10: contract EmptyContract {
```

- *ImmutableSimulator.sol* ( [18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L18) ):

```solidity
18: contract ImmutableSimulator is IImmutableSimulator {
```

- *KnownCodesStorage.sol* ( [18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L18) ):

```solidity
18: contract KnownCodesStorage is IKnownCodesStorage, ISystemContract {
```

- *L1Messenger.sol* ( [25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L25) ):

```solidity
25: contract L1Messenger is IL1Messenger, ISystemContract {
```

- *L2BaseToken.sol* ( [18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L18) ):

```solidity
18: contract L2BaseToken is IBaseToken, ISystemContract {
```

- *MsgValueSimulator.sol* ( [19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L19) ):

```solidity
19: contract MsgValueSimulator is ISystemContract {
```

- *NonceHolder.sol* ( [27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L27) ):

```solidity
27: contract NonceHolder is INonceHolder, ISystemContract {
```

- *PubdataChunkPublisher.sol* ( [16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L16) ):

```solidity
16: contract PubdataChunkPublisher is IPubdataChunkPublisher, ISystemContract {
```

- *SystemContext.sol* ( [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L17) ):

```solidity
17: contract SystemContext is ISystemContext, ISystemContextDeprecated, ISystemContract {
```

</details>

### [N-102] Large or complicated code bases should implement invariant tests

This includes: large code bases, or code with lots of inline-assembly, complicated math, or complicated interactions between multiple contracts.
Invariant fuzzers such as Echidna require the test writer to come up with invariants which should not be violated under any circumstances, and the fuzzer tests various inputs and function calls to ensure that the invariants always hold.
Even code with 100% code coverage can still have bugs due to the order of the operations a user performs, and invariant fuzzers may help significantly.

There are 3 instances:

- Global finding

- Global finding

- Global finding

### [N-103] The default value is manually set when it is declared

In instances where a new variable is defined, there is no need to set it to it's default value.

<details>
<summary>There are 38 instances (click to show):</summary>

- *Governance.sol* ( [227-227](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L227-L227) ):

```solidity
227:         for (uint256 i = 0; i < _calls.length; ++i) {
```

- *ValidatorTimelock.sol* ( [118-118](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L118-L118), [137-137](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L137-L137), [187-187](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L187-L187), [211-211](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L211-L211) ):

```solidity
118:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {

137:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {

187:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {

211:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {
```

- *Executor.sol* ( [144-144](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L144-L144), [259-259](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L259-L259), [291-291](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L291-L291), [313-313](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L313-L313), [353-353](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L353-L353), [407-407](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L407-L407), [578-578](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L578-L578), [627-627](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L627-L627), [634-634](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L634-L634), [665-665](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L665-L665) ):

```solidity
144:         for (uint256 i = 0; i < emittedL2Logs.length; i = i.uncheckedAdd(L2_TO_L1_LOG_SERIALIZE_SIZE)) {

259:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) {

291:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) {

313:         for (uint256 i = 0; i < _nPriorityOps; i = i.uncheckedInc()) {

353:         for (uint256 i = 0; i < nBatches; i = i.uncheckedInc()) {

407:         for (uint256 i = 0; i < committedBatchesLength; i = i.uncheckedInc()) {

578:         for (uint i = 0; i < MAX_NUMBER_OF_BLOBS; i++) {

627:         uint256 versionedHashIndex = 0;

634:         for (uint256 i = 0; i < _pubdataCommitments.length; i += PUBDATA_COMMITMENT_SIZE) {

665:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) {
```

- *Getters.sol* ( [210-210](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L210-L210) ):

```solidity
210:         for (uint256 i = 0; i < facetsLen; i = i.uncheckedInc()) {
```

- *Mailbox.sol* ( [358-358](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L358-L358) ):

```solidity
358:         for (uint256 i = 0; i < factoryDepsLen; i = i.uncheckedInc()) {
```

- *Diamond.sol* ( [103-103](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L103-L103), [140-140](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L140-L140), [160-160](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L160-L160), [180-180](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L180-L180) ):

```solidity
103:         for (uint256 i = 0; i < facetCutsLength; i = i.uncheckedInc()) {

140:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) {

160:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) {

180:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) {
```

- *TransactionValidator.sol* ( [94-94](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L94-L94) ):

```solidity
94:         uint256 costForPubdata = 0;
```

- *BaseZkSyncUpgrade.sol* ( [228-228](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L228-L228) ):

```solidity
228:         for (uint256 i = 0; i < _factoryDeps.length; ++i) {
```

- *Compressor.sol* ( [61-61](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L61-L61), [124-124](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L124-L124), [127-127](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L127-L127), [159-159](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L159-L159) ):

```solidity
61:             for (uint256 encodedDataPointer = 0; encodedDataPointer < encodedData.length; encodedDataPointer += 2) {

124:         uint256 numInitialWritesProcessed = 0;

127:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) {

159:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) {
```

- *ContractDeployer.sol* ( [247-247](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L247-L247), [248-248](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L248-L248), [253-253](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L253-L253) ):

```solidity
247:         uint256 sumOfValues = 0;

248:         for (uint256 i = 0; i < deploymentsLength; ++i) {

253:         for (uint256 i = 0; i < deploymentsLength; ++i) {
```

- *ImmutableSimulator.sol* ( [38-38](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L38-L38) ):

```solidity
38:             for (uint256 i = 0; i < immutablesLength; ++i) {
```

- *KnownCodesStorage.sol* ( [30-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L30-L30) ):

```solidity
30:             for (uint256 i = 0; i < hashesLen; ++i) {
```

- *L1Messenger.sol* ( [197-197](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L197-L197), [206-206](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L206-L206), [224-224](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L224-L224), [236-236](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L236-L236), [254-254](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L254-L254) ):

```solidity
197:         uint256 calldataPtr = 0;

206:         for (uint256 i = 0; i < numberOfL2ToL1Logs; ++i) {

224:             for (uint256 i = 0; i < nodesOnCurrentLevel; ++i) {

236:         for (uint256 i = 0; i < numberOfMessages; ++i) {

254:         for (uint256 i = 0; i < numberOfBytecodes; ++i) {
```

- *PubdataChunkPublisher.sol* ( [36-36](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L36-L36) ):

```solidity
36:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) {
```

</details>

### [N-104] Contracts should have all `public`/`external` functions exposed by `interface`s

All `external`/`public` functions should extend an `interface`. This is useful to ensure that the whole API is extracted and can be more easily integrated by other projects.

<details>
<summary>There are 13 instances (click to show):</summary>

- *L1ERC20Bridge.sol* ( [21](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L21) ):

```solidity
21: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard {
```

- *L1SharedBridge.sol* ( [32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L32) ):

```solidity
32: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step {
```

- *Bridgehub.sol* ( [18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L18) ):

```solidity
18: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step {
```

- *StateTransitionManager.sol* ( [27](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L27) ):

```solidity
27: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step {
```

- *ValidatorTimelock.sol* ( [24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L24) ):

```solidity
24: contract ValidatorTimelock is IExecutor, Ownable2Step {
```

- *DefaultUpgrade.sol* ( [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L12) ):

```solidity
12: contract DefaultUpgrade is BaseZkSyncUpgrade {
```

- *GenesisUpgrade.sol* ( [13](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L13) ):

```solidity
13: contract GenesisUpgrade is BaseZkSyncUpgradeGenesis {
```

- *ForceDeployUpgrader.sol* ( [12](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L12) ):

```solidity
12: contract ForceDeployUpgrader {
```

- *L2SharedBridge.sol* ( [25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L25) ):

```solidity
25: contract L2SharedBridge is IL2SharedBridge, Initializable {
```

- *L2StandardERC20.sol* ( [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L17) ):

```solidity
17: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade {
```

- *ContractDeployer.sol* ( [23](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L23) ):

```solidity
23: contract ContractDeployer is IContractDeployer, ISystemContract {
```

- *L1Messenger.sol* ( [25](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L25) ):

```solidity
25: contract L1Messenger is IL1Messenger, ISystemContract {
```

- *SystemContext.sol* ( [17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L17) ):

```solidity
17: contract SystemContext is ISystemContext, ISystemContextDeprecated, ISystemContract {
```

</details>

### [N-105] Top-level declarations should be separated by at least two lines

-

<details>
<summary>There are 97 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [137-139](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L137-L139), [487-489](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L487-L489) ):

```solidity
137:     }
138: 
139:     function receiveEth(uint256 _chainId) external payable {

487:     }
488: 
489:     function _parseL2WithdrawalMessage(
```

- *Bridgehub.sol* ( [16-18](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16-L18), [45-47](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L45-L47), [325-327](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L325-L327) ):

```solidity
16: import "../vendor/AddressAliasHelper.sol";
17: 
18: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step {

45:     }
46: 
47:     modifier onlyOwnerOrAdmin() {

325:     }
326: 
327:     function _actualRefundRecipient(address _refundRecipient) internal view returns (address _recipient) {
```

- *IBridgehub.sol* ( [42-44](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L42-L44) ):

```solidity
42: }
43: 
44: interface IBridgehub {
```

- *ReentrancyGuard.sol* ( [46-48](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L46-L48) ):

```solidity
46:     }
47: 
48:     function _initializeReentrancyGuard() private {
```

- *UncheckedMath.sol* ( [17-19](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L17-L19) ):

```solidity
17:     }
18: 
19:     function uncheckedAdd(uint256 _lhs, uint256 _rhs) internal pure returns (uint256) {
```

- *UnsafeBytes.sol* ( [26-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L26-L28), [33-35](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L33-L35), [40-42](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L40-L42) ):

```solidity
26:     }
27: 
28:     function readAddress(bytes memory _bytes, uint256 _start) internal pure returns (address result, uint256 offset) {

33:     }
34: 
35:     function readUint256(bytes memory _bytes, uint256 _start) internal pure returns (uint256 result, uint256 offset) {

40:     }
41: 
42:     function readBytes32(bytes memory _bytes, uint256 _start) internal pure returns (bytes32 result, uint256 offset) {
```

- *IGovernance.sol* ( [41-43](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol#L41-L43) ):

```solidity
41:     }
42: 
43:     function isOperation(bytes32 _id) external view returns (bool);
```

- *IStateTransitionManager.sol* ( [26-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L26-L28) ):

```solidity
26: }
27: 
28: interface IStateTransitionManager {
```

- *StateTransitionManager.sol* ( [74-76](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L74-L76), [230-232](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L230-L232) ):

```solidity
74:     }
75: 
76:     function getChainAdmin(uint256 _chainId) external view override returns (address) {

230:     }
231: 
232:     function registerAlreadyDeployedStateTransition(
```

- *Admin.sol* ( [89-91](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L89-L91) ):

```solidity
89:     }
90: 
91:     function setValidiumMode(PubdataPricingMode _validiumMode) external onlyAdmin {
```

- *Executor.sol* ( [215-217](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L215-L217), [349-351](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L349-L351), [386-388](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L386-L388), [436-438](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L436-L438), [477-479](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L477-L479), [511-513](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L511-L513), [521-523](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L521-L523), [533-535](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L533-L535) ):

```solidity
215:     }
216: 
217:     function _commitBatches(

349:     }
350: 
351:     function _executeBatches(StoredBatchInfo[] calldata _batchesData) internal {

386:     }
387: 
388:     function _proveBatches(

436:     }
437: 
438:     function _verifyProof(uint256[] memory proofPublicInput, ProofInput calldata _proof) internal view {

477:     }
478: 
479:     function _revertBatches(uint256 _newLastBatch) internal {

511:     }
512: 
513:     function _batchPassThroughData(CommitBatchInfo calldata _batch) internal pure returns (bytes memory) {

521:     }
522: 
523:     function _batchMetaParameters() internal view returns (bytes memory) {

533:     }
534: 
535:     function _batchAuxiliaryOutput(
```

- *Mailbox.sol* ( [228-230](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L228-L230), [258-260](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L258-L260), [289-291](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L289-L291) ):

```solidity
228:     }
229: 
230:     function _requestL2TransactionSender(

258:     }
259: 
260:     function _requestL2Transaction(

289:     }
290: 
291:     function _serializeL2Transaction(
```

- *ZkSyncStateTransitionBase.sol* ( [26-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L26-L28), [31-33](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L31-L33), [36-38](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L36-L38), [44-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L44-L46), [52-54](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L52-L54) ):

```solidity
26:     }
27: 
28:     modifier onlyStateTransitionManager() {

31:     }
32: 
33:     modifier onlyBridgehub() {

36:     }
37: 
38:     modifier onlyAdminOrStateTransitionManager() {

44:     }
45: 
46:     modifier onlyValidatorOrStateTransitionManager() {

52:     }
53: 
54:     modifier onlyBaseTokenBridge() {
```

- *IDiamondInit.sol* ( [61-63](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L61-L63) ):

```solidity
61: }
62: 
63: interface IDiamondInit {
```

- *IZkSyncStateTransition.sol* ( [15-17](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L15-L17) ):

```solidity
15: import "../libraries/Diamond.sol";
16: 
17: interface IZkSyncStateTransition is IAdmin, IExecutor, IGetters, IMailbox {
```

- *IDefaultUpgrade.sol* ( [7-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol#L7-L9) ):

```solidity
7: import {ProposedUpgrade} from "./BaseZkSyncUpgrade.sol";
8: 
9: interface IDefaultUpgrade {
```

- *SystemContractsCaller.sol* ( [26-28](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L26-L28), [76-78](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L76-L78), [95-97](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L95-L97), [121-123](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol#L121-L123) ):

```solidity
26: }
27: 
28: library Utils {

76:     }
77: 
78:     function systemCallWithReturndata(

95:     }
96: 
97:     function getFarCallABI(

121:     }
122: 
123:     function getFarCallABIWithEmptyFatPointer(
```

- *L2StandardERC20.sol* ( [129-131](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L129-L131), [134-136](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L134-L136), [159-161](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L159-L161), [165-167](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L165-L167), [171-173](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L171-L173) ):

```solidity
129:     }
130: 
131:     modifier onlyBridge() {

134:     }
135: 
136:     modifier onlyNextVersion(uint8 _version) {

159:     }
160: 
161:     function name() public view override returns (string memory) {

165:     }
166: 
167:     function symbol() public view override returns (string memory) {

171:     }
172: 
173:     function decimals() public view override returns (uint8) {
```

- *IPaymaster.sol* ( [14-16](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L14-L16) ):

```solidity
14: bytes4 constant PAYMASTER_VALIDATION_SUCCESS_MAGIC = IPaymaster.validateAndPayForPaymasterTransaction.selector;
15: 
16: interface IPaymaster {
```

- *AccountCodeStorage.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import "./interfaces/IAccountCodeStorage.sol";
```

- *BootloaderUtilities.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {IBootloaderUtilities} from "./interfaces/IBootloaderUtilities.sol";
```

- *ComplexUpgrader.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {IComplexUpgrader} from "./interfaces/IComplexUpgrader.sol";
```

- *Compressor.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {ICompressor, OPERATION_BITMASK, LENGTH_BITS_OFFSET, MAX_ENUMERATION_INDEX_SIZE} from "./interfaces/ICompressor.sol";
```

- *Constants.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {IAccountCodeStorage} from "./interfaces/IAccountCodeStorage.sol";
```

- *ContractDeployer.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L3-L5), [256-258](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol#L256-L258) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {ImmutableData} from "./interfaces/IImmutableSimulator.sol";

256:     }
257: 
258:     function _nonSystemDeployOnAddress(
```

- *DefaultAccount.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import "./interfaces/IAccount.sol";
```

- *ImmutableSimulator.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {IImmutableSimulator, ImmutableData} from "./interfaces/IImmutableSimulator.sol";
```

- *KnownCodesStorage.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {IKnownCodesStorage} from "./interfaces/IKnownCodesStorage.sol";
```

- *L1Messenger.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {IL1Messenger, L2ToL1Log, L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH, L2_TO_L1_LOG_SERIALIZE_SIZE, STATE_DIFF_COMPRESSION_VERSION_NUMBER} from "./interfaces/IL1Messenger.sol";
```

- *L2BaseToken.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {IBaseToken} from "./interfaces/IBaseToken.sol";
```

- *MsgValueSimulator.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {Utils} from "./libraries/Utils.sol";
```

- *NonceHolder.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {INonceHolder} from "./interfaces/INonceHolder.sol";
```

- *PubdataChunkPublisher.sol* ( [2-4](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol#L2-L4) ):

```solidity
2: pragma solidity 0.8.20;
3: 
4: import {IPubdataChunkPublisher} from "./interfaces/IPubdataChunkPublisher.sol";
```

- *SystemContext.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L3-L5), [115-117](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L115-L117), [120-122](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L120-L122), [480-482](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L480-L482), [484-486](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L484-L486) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {ISystemContext} from "./interfaces/ISystemContext.sol";

115:     }
116: 
117:     function getCurrentPubdataSpent() public view returns (uint256) {

120:     }
121: 
122:     function getCurrentPubdataCost() external view returns (uint256) {

480:     }
481: 
482:     function incrementTxNumberInBatch() external onlyCallFromBootloader {

484:     }
485: 
486:     function resetTxNumberInBatch() external onlyCallFromBootloader {
```

- *IAccount.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IAccount.sol#L3-L5), [7-9](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IAccount.sol#L7-L9) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import "../libraries/TransactionHelper.sol";

7: bytes4 constant ACCOUNT_VALIDATION_SUCCESS_MAGIC = IAccount.validateTransaction.selector;
8: 
9: interface IAccount {
```

- *IAccountCodeStorage.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IAccountCodeStorage.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: interface IAccountCodeStorage {
```

- *IBaseToken.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBaseToken.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: interface IBaseToken {
```

- *IBootloaderUtilities.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBootloaderUtilities.sol#L3-L5), [5-7](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBootloaderUtilities.sol#L5-L7) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import "../libraries/TransactionHelper.sol";

5: import "../libraries/TransactionHelper.sol";
6: 
7: interface IBootloaderUtilities {
```

- *IContractDeployer.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: interface IContractDeployer {
```

- *IImmutableSimulator.sol* ( [8-10](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IImmutableSimulator.sol#L8-L10) ):

```solidity
8: }
9: 
10: interface IImmutableSimulator {
```

- *IL2StandardToken.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL2StandardToken.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: interface IL2StandardToken {
```

- *IMailbox.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IMailbox.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: interface IMailbox {
```

- *IPaymaster.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L3-L5), [12-14](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol#L12-L14) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import "../libraries/TransactionHelper.sol";

12: bytes4 constant PAYMASTER_VALIDATION_SUCCESS_MAGIC = IPaymaster.validateAndPayForPaymasterTransaction.selector;
13: 
14: interface IPaymaster {
```

- *ISystemContext.sol* ( [28-30](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContext.sol#L28-L30) ):

```solidity
28:     }
29: 
30:     function chainId() external view returns (uint256);
```

- *ISystemContract.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContract.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {SystemContractHelper} from "../libraries/SystemContractHelper.sol";
```

- *EfficientCall.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import "./SystemContractHelper.sol";
```

- *RLPEncoder.sol* ( [22-24](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L22-L24), [58-60](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol#L58-L60) ):

```solidity
22:     }
23: 
24:     function encodeUint256(uint256 _val) internal pure returns (bytes memory encoded) {

58:     }
59: 
60:     function _encodeLength(uint64 _len, uint256 _offset) private pure returns (bytes memory encoded) {
```

- *SystemContractHelper.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {MAX_SYSTEM_CONTRACT_ADDRESS} from "../Constants.sol";
```

- *SystemContractsCaller.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import {MSG_VALUE_SYSTEM_CONTRACT, MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT} from "../Constants.sol";
```

- *TransactionHelper.sol* ( [3-5](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L3-L5) ):

```solidity
3: pragma solidity 0.8.20;
4: 
5: import "../openzeppelin/token/ERC20/IERC20.sol";
```

- *UnsafeBytesCalldata.sol* ( [24-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L24-L26), [31-33](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L31-L33), [38-40](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L38-L40), [44-46](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L44-L46) ):

```solidity
24:     }
25: 
26:     function readUint32(bytes calldata _bytes, uint256 _start) internal pure returns (uint32 result) {

31:     }
32: 
33:     function readUint64(bytes calldata _bytes, uint256 _start) internal pure returns (uint64 result) {

38:     }
39: 
40:     function readBytes32(bytes calldata _bytes, uint256 _start) internal pure returns (bytes32 result) {

44:     }
45: 
46:     function readUint256(bytes calldata _bytes, uint256 _start) internal pure returns (uint256 result) {
```

- *Utils.sol* ( [2-4](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L2-L4), [24-26](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L24-L26), [30-32](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/Utils.sol#L30-L32) ):

```solidity
2: pragma solidity 0.8.20;
3: 
4: import "./EfficientCall.sol";

24:     }
25: 
26:     function safeCastToU32(uint256 _x) internal pure returns (uint32) {

30:     }
31: 
32:     function safeCastToU24(uint256 _x) internal pure returns (uint24) {
```

</details>

### [N-106] Consider adding formal verification proofs

Formal verification is the act of proving or disproving the correctness of intended algorithms underlying a system with respect to a certain formal specification/property/invariant, using formal methods of mathematics.

Some tools that are currently available to perform these tests on smart contracts are [SMTChecker](https://docs.soliditylang.org/en/latest/smtchecker.html) and [Certora Prover](https://www.certora.com/).

<details>
<summary>There are 104 instances (click to show):</summary>

- [*L1ERC20Bridge.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol)

- [*L1SharedBridge.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol)

- [*IL1ERC20Bridge.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1ERC20Bridge.sol)

- [*IL1SharedBridge.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL1SharedBridge.sol)

- [*IL2Bridge.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IL2Bridge.sol)

- [*IWETH9.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol)

- [*Bridgehub.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol)

- [*IBridgehub.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol)

- [*Config.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Config.sol)

- [*L2ContractAddresses.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/L2ContractAddresses.sol)

- [*Messaging.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/Messaging.sol)

- [*ReentrancyGuard.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol)

- [*IL2ContractDeployer.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/interfaces/IL2ContractDeployer.sol)

- [*L2ContractHelper.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/L2ContractHelper.sol)

- [*UncheckedMath.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol)

- [*UnsafeBytes.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol)

- [*Governance.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol)

- [*IGovernance.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/IGovernance.sol)

- [*IStateTransitionManager.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol)

- [*StateTransitionManager.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol)

- [*ValidatorTimelock.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol)

- [*DiamondInit.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol)

- [*DiamondProxy.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol)

- [*ZkSyncStateTransitionStorage.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol)

- [*Admin.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol)

- [*Executor.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol)

- [*Getters.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol)

- [*Mailbox.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol)

- [*ZkSyncStateTransitionBase.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol)

- [*IAdmin.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol)

- [*IDiamondInit.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol)

- [*IExecutor.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol)

- [*IGetters.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol)

- [*ILegacyGetters.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/ILegacyGetters.sol)

- [*IMailbox.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IMailbox.sol)

- [*IVerifier.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IVerifier.sol)

- [*IZkSyncStateTransition.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol)

- [*IZkSyncStateTransitionBase.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransitionBase.sol)

- [*ISystemContext.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/l2-deps/ISystemContext.sol)

- [*Diamond.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol)

- [*LibMap.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol)

- [*Merkle.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol)

- [*PriorityQueue.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol)

- [*TransactionValidator.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol)

- [*BaseZkSyncUpgrade.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol)

- [*BaseZkSyncUpgradeGenesis.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol)

- [*DefaultUpgrade.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol)

- [*GenesisUpgrade.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol)

- [*IDefaultUpgrade.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol)

- [*AddressAliasHelper.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/vendor/AddressAliasHelper.sol)

- [*ForceDeployUpgrader.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/ForceDeployUpgrader.sol)

- [*L2ContractHelper.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/L2ContractHelper.sol)

- [*SystemContractsCaller.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/SystemContractsCaller.sol)

- [*L2SharedBridge.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol)

- [*L2StandardERC20.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol)

- [*IL1ERC20Bridge.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL1ERC20Bridge.sol)

- [*IL1SharedBridge.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL1SharedBridge.sol)

- [*IL2SharedBridge.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2SharedBridge.sol)

- [*IL2StandardToken.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol)

- [*IPaymaster.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymaster.sol)

- [*IPaymasterFlow.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/interfaces/IPaymasterFlow.sol)

- [*AddressAliasHelper.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol)

- [*AccountCodeStorage.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/AccountCodeStorage.sol)

- [*BootloaderUtilities.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol)

- [*ComplexUpgrader.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ComplexUpgrader.sol)

- [*Compressor.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Compressor.sol)

- [*Constants.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/Constants.sol)

- [*ContractDeployer.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ContractDeployer.sol)

- [*DefaultAccount.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/DefaultAccount.sol)

- [*EmptyContract.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/EmptyContract.sol)

- [*ImmutableSimulator.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/ImmutableSimulator.sol)

- [*KnownCodesStorage.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/KnownCodesStorage.sol)

- [*L1Messenger.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol)

- [*L2BaseToken.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L2BaseToken.sol)

- [*MsgValueSimulator.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/MsgValueSimulator.sol)

- [*NonceHolder.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/NonceHolder.sol)

- [*PubdataChunkPublisher.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/PubdataChunkPublisher.sol)

- [*SystemContext.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol)

- [*IAccount.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IAccount.sol)

- [*IAccountCodeStorage.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IAccountCodeStorage.sol)

- [*IBaseToken.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBaseToken.sol)

- [*IBootloaderUtilities.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IBootloaderUtilities.sol)

- [*IComplexUpgrader.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IComplexUpgrader.sol)

- [*ICompressor.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ICompressor.sol)

- [*IContractDeployer.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IContractDeployer.sol)

- [*IImmutableSimulator.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IImmutableSimulator.sol)

- [*IKnownCodesStorage.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IKnownCodesStorage.sol)

- [*IL1Messenger.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL1Messenger.sol)

- [*IL2StandardToken.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IL2StandardToken.sol)

- [*IMailbox.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IMailbox.sol)

- [*INonceHolder.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/INonceHolder.sol)

- [*IPaymaster.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymaster.sol)

- [*IPaymasterFlow.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPaymasterFlow.sol)

- [*IPubdataChunkPublisher.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/IPubdataChunkPublisher.sol)

- [*ISystemContext.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContext.sol)

- [*ISystemContextDeprecated.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContextDeprecated.sol)

- [*ISystemContract.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/interfaces/ISystemContract.sol)

- [*EfficientCall.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/EfficientCall.sol)

- [*RLPEncoder.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/RLPEncoder.sol)

- [*SystemContractHelper.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractHelper.sol)

- [*SystemContractsCaller.sol*](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/SystemContractsCaller.sol)

</details>

### [N-107] Use scopes sparingly

The use of scoped blocks, denoted by `{}` without a preceding control structure like `if`, `for`, etc., allows for the creation of isolated scopes within a function. While this can be useful for managing memory and preventing naming conflicts, it should be used sparingly. Excessive use of these scope blocks can obscure the code's logic flow and make it more difficult to understand, impeding code maintainability. As a best practice, only employ scoped blocks when necessary for memory management or to avoid clear naming conflicts. Otherwise, aim for clarity and simplicity in your code structure for optimal readability and maintainability.

<details>
<summary>There are 31 instances (click to show):</summary>

- *L1SharedBridge.sol* ( [217-218](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L217-L218), [317-318](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L317-L318), [331-332](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L331-L332), [333-334](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L333-L334), [468-469](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L468-L469), [575-576](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L575-L576) ):

```solidity
217:         {
218:             // Request the finalization of the deposit on the L2 side

317:         {
318:             bool proofValid = bridgehub.proveL1ToL2TransactionStatus(

331:         {
332:             bool notCheckedInLegacyBridgeOrWeCanCheckDeposit;

333:             {
334:                 // Deposits that happened before the upgrade cannot be checked here, they have to be claimed and checked in the legacyBridge

468:         {
469:             bool baseTokenWithdrawal = (l1Token == bridgehub.baseToken(_chainId));

575:         {
576:             // If the refund recipient is not specified, the refund will be sent to the sender of the transaction.
```

- *Bridgehub.sol* ( [222-223](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L222-L223), [267-268](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L267-L268) ):

```solidity
222:         {
223:             address token = baseToken[_request.chainId];

267:         {
268:             address token = baseToken[_request.chainId];
```

- *TransactionValidator.sol* ( [77-78](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L77-L78), [95-96](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L95-L96) ):

```solidity
77:         {
78:             // Adding the intrinsic cost for the transaction, i.e. auxiliary prices which cannot be easily accounted for

95:         {
96:             // Adding the intrinsic cost for the transaction, i.e. auxiliary prices which cannot be easily accounted for
```

- *BootloaderUtilities.sol* ( [55-56](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L55-L56), [66-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L66-L67), [80-81](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L80-L81), [85-86](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L85-L86), [90-91](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L90-L91), [142-143](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L142-L143), [162-163](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L162-L163), [179-180](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L179-L180), [184-185](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L184-L185), [189-190](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L189-L190), [235-236](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L235-L236), [257-258](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L257-L258), [274-275](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L274-L275), [279-280](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L279-L280), [284-285](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/BootloaderUtilities.sol#L284-L285) ):

```solidity
55:         {
56:             bytes memory encodedGasPrice = RLPEncoder.encodeUint256(_transaction.maxFeePerGas);

66:         {
67:             // Safe cast, because the length of the transaction data can't be so large.

80:         {
81:             uint256 rInt = uint256(bytes32(_transaction.signature[0:32]));

85:         {
86:             uint256 sInt = uint256(bytes32(_transaction.signature[32:64]));

90:         {
91:             uint256 vInt = uint256(uint8(_transaction.signature[64]));

142:         {
143:             bytes memory encodedChainId = RLPEncoder.encodeUint256(block.chainid);

162:         {
163:             // Safe cast, because the length of the transaction data can't be so large.

179:         {
180:             uint256 rInt = uint256(bytes32(_transaction.signature[0:32]));

184:         {
185:             uint256 sInt = uint256(bytes32(_transaction.signature[32:64]));

189:         {
190:             uint256 vInt = uint256(uint8(_transaction.signature[64]));

235:         {
236:             bytes memory encodedChainId = RLPEncoder.encodeUint256(block.chainid);

257:         {
258:             // Safe cast, because the length of the transaction data can't be so large.

274:         {
275:             uint256 rInt = uint256(bytes32(_transaction.signature[0:32]));

279:         {
280:             uint256 sInt = uint256(bytes32(_transaction.signature[32:64]));

284:         {
285:             uint256 vInt = uint256(uint8(_transaction.signature[64]));
```

- *TransactionHelper.sol* ( [158-159](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L158-L159), [169-170](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L169-L170), [227-228](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L227-L228), [247-248](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L247-L248), [297-298](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L297-L298), [319-320](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/libraries/TransactionHelper.sol#L319-L320) ):

```solidity
158:         {
159:             bytes memory encodedGasPrice = RLPEncoder.encodeUint256(_transaction.maxFeePerGas);

169:         {
170:             // Safe cast, because the length of the transaction data can't be so large.

227:         {
228:             bytes memory encodedChainId = RLPEncoder.encodeUint256(block.chainid);

247:         {
248:             // Safe cast, because the length of the transaction data can't be so large.

297:         {
298:             bytes memory encodedChainId = RLPEncoder.encodeUint256(block.chainid);

319:         {
320:             // Safe cast, because the length of the transaction data can't be so large.
```

</details>

### [N-108] Prevent re-setting a state variable with the same value

This especially problematic when the setter also emits the same value, which may be confusing to offline parsers.

<details>
<summary>There are 23 instances (click to show):</summary>

- *Bridgehub.sol* ( [57-57](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L57-L57), [67-67](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L67-L67), [111-111](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L111-L111) ):

```solidity
57:         pendingAdmin = _newPendingAdmin;

67:         admin = currentPendingAdmin;

111:         sharedBridge = IL1SharedBridge(_sharedBridge);
```

- *Governance.sol* ( [253-253](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L253-L253), [260-260](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/governance/Governance.sol#L260-L260) ):

```solidity
253:         minDelay = _newDelay;

260:         securityCouncil = _newSecurityCouncil;
```

- *StateTransitionManager.sol* ( [116-116](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L116-L116), [126-126](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L126-L126), [135-135](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L135-L135), [140-140](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L140-L140), [150-150](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L150-L150) ):

```solidity
116:         pendingAdmin = _newPendingAdmin;

126:         admin = currentPendingAdmin;

135:         validatorTimelock = _validatorTimelock;

140:         initialCutHash = keccak256(abi.encode(_diamondCut));

150:         protocolVersion = _newProtocolVersion;
```

- *ValidatorTimelock.sol* ( [76-76](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L76-L76), [99-99](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L99-L99) ):

```solidity
76:         stateTransitionManager = _stateTransitionManager;

99:         executionDelay = _executionDelay;
```

- *L1Messenger.sol* ( [106-106](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L106-L106), [122-122](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L122-L122), [164-164](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/L1Messenger.sol#L164-L164) ):

```solidity
106:         chainedLogsHash = keccak256(abi.encode(chainedLogsHash, hashedLog));

122:         chainedMessagesHash = keccak256(abi.encode(chainedMessagesHash, hash));

164:         chainedL1BytecodesRevealDataHash = keccak256(abi.encode(chainedL1BytecodesRevealDataHash, _bytecodeHash));
```

- *SystemContext.sol* ( [85-85](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L85-L85), [100-100](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L100-L100), [106-106](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L106-L106), [113-113](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L113-L113), [114-114](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L114-L114), [403-403](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L403-L403), [463-463](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L463-L463), [479-479](https://github.com/code-423n4/2024-03-zksync/blob/4f0ba34f34a864c354c7e8c47643ed8f4a250e13/code/system-contracts/contracts/SystemContext.sol#L479-L479) ):

```solidity
85:         chainId = _newChainId;

100:         origin = _newOrigin;

106:         gasPrice = _gasPrice;

113:         basePubdataSpent = _basePubdataSpent;

114:         gasPerPubdataByte = _gasPerPubdataByte;

403:         currentL2BlockTxsRollingHash = keccak256(abi.encode(currentL2BlockTxsRollingHash, _txHash));

463:         baseFee = _baseFee;

479:         baseFee = _baseFee;
```

</details>
