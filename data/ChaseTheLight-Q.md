## LightChaser-V3

### Generated for: Code4rena : ZkSync

### Generated on: 2024-03-28

## Total findings: 157

### Total Low findings: 35

### Total NonCritical findings: 122

# Summary for Low findings

| Number | Details | Instances |
|----------|----------|----------|
| [Low-1] | Solidity version 0.8.20 won't work on all chains due to PUSH0  | 1 |
| [Low-2] | Missing checks for address(0x0) when updating address state variables  | 6 |
| [Low-3] | Contracts with multiple onlyXYZ modifiers where XYZ is a role can introduce complexities when managing privileges  | 5 |
| [Low-4] | Code does not follow the best practice of check-effects-interaction  | 2 |
| [Low-5] | Some tokens may revert when zero value transfers are made  | 4 |
| [Low-6] | Comparisons against msg.sender and address(this) can easily be bypassed  | 2 |
| [Low-7] | Function which returns data from a call has no validation | 1 |
| [Low-8] | Int casting block.timestamp can reduce the lifespan of a contract | 1 |
| [Low-9] | Empty receive functions can cause gas issues | 3 |
| [Low-10] | Upgradable contracts should have a __gap variable | 3 |
| [Low-11] | Empty fallback functions can cause gas issues | 1 |
| [Low-12] | The nonReentrant modifier should be first in a function declaration | 2 |
| [Low-13] | Missing zero address check in constructor | 3 |
| [Low-14] | Use of onlyOwner functions can be lost | 5 |
| [Low-15] | safeApprove is deprecated | 2 |
| [Low-16] | Draft imports may break in new minor versions | 1 |
| [Low-17] | Revert on Transfer to the Zero Address | 4 |
| [Low-18] | Bridge function must check for native token | 1 |
| [Low-19] | Missing zero address check in initializer | 2 |
| [Low-20] | Critical functions should have a timelock | 14 |
| [Low-21] | Consider implementing two-step procedure for updating protocol addresses | 22 |
| [Low-22] | No limits when setting price values | 1 |
| [Low-23] | Uses of EIP712 does not include a verifyingContract | 1 |
| [Low-24] | Prefer skip over revert model in iteration | 2 |
| [Low-25] | Missing contract-existence checks before low-level calls | 2 |
| [Low-26] | Address collision possible due to upcast | 1 |
| [Low-27] | Pure function storage pointer bug | 1 |
| [Low-28] | Low Level Calls to Custom Addresses | 2 |
| [Low-29] | Use of abi.encodePacked with dynamic types inside keccak256 | 1 |
| [Low-30] | Division in comparison | 2 |
| [Low-31] | Contract contains payable functions but no withdraw/sweep function | 13 |
| [Low-32] | State variables not capped at reasonable values | 7 |
| [Low-33] | Solidity file is susceptible to .selector-related optimizer bug due to the version used | 3 |
| [Low-34] | Large transfers may not work with some ERC20 tokens | 3 |
| [Low-35] | Functions calling contracts/addresses with transfer hooks are missing reentrancy guards | 2 |
# Summary for NonCritical findings

| Number | Details | Instances |
|----------|----------|----------|
| [NonCritical-1] | Having chainId as a parameter can introduce cross chain replay attacks  | 37 |
| [NonCritical-2] | Some if-statement can be converted to a ternary  | 51 |
| [NonCritical-3] | Subtraction may underflow if multiplication is too large  | 1 |
| [NonCritical-4] | Events may be emitted out of order due to code not follow the best practice of check-effects-interaction  | 6 |
| [NonCritical-5] | Superfluous parameter can only be one value  | 1 |
| [NonCritical-6] | Tautology when checking address value  | 1 |
| [NonCritical-7] | Unnecessary struct attribute prefix  | 7 |
| [NonCritical-8] | Contracts should have all public/external functions exposed by interfaces  | 183 |
| [NonCritical-9] | Using abi.encodePacked can result in hash collision when used in hashing functions  | 5 |
| [NonCritical-10] | Getting a bool return value does not confirm the existence of a function in an external call  | 3 |
| [NonCritical-11] | Non constant/immutable state variables are missing a setter post deployment  | 5 |
| [NonCritical-12] | Require statements should have error string | 2 |
| [NonCritical-13] | Function calls within for loops | 16 |
| [NonCritical-14] | For loops in public or external functions should be avoided due to high gas costs and possible DOS | 11 |
| [NonCritical-15] | Using zero as a parameter | 9 |
| [NonCritical-16] | No license selected for project | 1 |
| [NonCritical-17] | Pure function accesses storage | 4 |
| [NonCritical-18] | Events regarding state variable changes should emit the previous state variable value | 1 |
| [NonCritical-19] | In functions which accept an address as a parameter, there should be a zero address check to prevent bugs | 92 |
| [NonCritical-20] | Enum values should be used in place of constant array indexes | 27 |
| [NonCritical-21] | Max should be used in place of 2**n - 1 | 1 |
| [NonCritical-22] | Revert statements within external and public functions can be used to perform DOS attacks | 9 |
| [NonCritical-23] | Reverts should use custom errors instead of strings | 11 |
| [NonCritical-24] | Functions which are either private or internal should have a preceding _ in their name | 98 |
| [NonCritical-25] | Private and internal state variables should have a preceding _ in their name unless they are constants | 17 |
| [NonCritical-26] | Contract lines should not be longer than 120 characters for readability | 133 |
| [NonCritical-27] | Avoid updating storage when the value hasn't changed | 15 |
| [NonCritical-28] | Specific imports should be used where possible so only used code is imported | 33 |
| [NonCritical-29] | Not all event definitions are utilizing indexed variables. | 3 |
| [NonCritical-30] | Functions within contracts are not ordered according to the solidity style guide | 20 |
| [NonCritical-31] | Double type casts create complexity within the code | 27 |
| [NonCritical-32] | Emits without msg.sender parameter | 6 |
| [NonCritical-33] | Functions with array parameters should have length checks in place | 31 |
| [NonCritical-34] | Interface imports should be declared first | 24 |
| [NonCritical-35] | Upgradable contract constructor should have the initialize modifier | 3 |
| [NonCritical-36] | All interfaces used within a project should be imported | 4 |
| [NonCritical-37] | A function which defines named returns in it's declaration doesn't need to use return | 2 |
| [NonCritical-38] | Multiple mappings can be replaced with a single struct mapping | 6 |
| [NonCritical-39] | Unused state variables present | 5 |
| [NonCritical-40] | Unused mappings present | 3 |
| [NonCritical-41] | Constants should be on the left side of the comparison | 33 |
| [NonCritical-42] | Defined named returns not used within function  | 1 |
| [NonCritical-43] | Initialize functions do not emit an event | 6 |
| [NonCritical-44] | Both immutable and constant state variables should be CONSTANT_CASE | 10 |
| [NonCritical-45] | Use type(uint<n>).max in place of 2 ** n - 1 | 1 |
| [NonCritical-46] | Uses of EIP712 does not include a salt | 1 |
| [NonCritical-47] | Overly complicated arithmetic | 1 |
| [NonCritical-48] | Use a single file for system wide constants | 12 |
| [NonCritical-49] | Consider using modifiers for address control | 12 |
| [NonCritical-50] | Off-by-one timestamp error | 5 |
| [NonCritical-51] | Use of non-named numeric constants | 82 |
| [NonCritical-52] | Long powers of ten should use scientific notation 1eX | 1 |
| [NonCritical-53] | Redundant else statement | 1 |
| [NonCritical-54] | Inconsistent usage of int/uint with int256/uint256 in contract/abstract/library/interface | 1 |
| [NonCritical-55] | Contract existence is not checked before low level call | 15 |
| [NonCritical-56] | Employ Explicit Casting to Bytes or Bytes32 for Enhanced Code Clarity and Meaning | 13 |
| [NonCritical-57] | Event emit should emit a parameter | 2 |
| [NonCritical-58] | Overridden function has no body | 1 |
| [NonCritical-59] | Unused structs present | 1 |
| [NonCritical-60] | Empty bytes check is missing | 98 |
| [NonCritical-61] | Consider adding a time delay to upgrade implementation functions | 3 |
| [NonCritical-62] | Redundant inheritance of ERC20 | 1 |
| [NonCritical-63] | Remove unnecessary solhint-disable | 1 |
| [NonCritical-64] | Do not use underscore at the end of variable name | 1 |
| [NonCritical-65] | Top level declarations should be separated by two blank lines | 21 |
| [NonCritical-66] | Use OpenZeppelin's ReentrancyGuard/ReentrancyGuardUpgradeable rather than writing your own | 1 |
| [NonCritical-67] | Assembly block creates dirty bits | 3 |
| [NonCritical-68] | Using XOR (^) and AND (&) bitwise equivalents | 1 |
| [NonCritical-69] | Lack Of Brace Spacing | 169 |
| [NonCritical-70] | .call bypasses function existence check, type checking and argument packing | 18 |
| [NonCritical-71] | No access control on receive/payable fallback | 4 |
| [NonCritical-72] | Cyclomatic complexity in functions | 18 |
| [NonCritical-73] | Incorrect withdraw declaration | 2 |
| [NonCritical-74] | Contract does not follow the Solidity style guide's suggested layout ordering | 5 |
| [NonCritical-75] | Contract uses both require()/revert() as well as custom errors | 1 |
| [NonCritical-76] | Unused import | 6 |
| [NonCritical-77] | Consider bounding input array length | 7 |
| [NonCritical-78] | Missing events in sensitive functions | 21 |
| [NonCritical-79] | Unchecked increments can overflow | 1 |
| [NonCritical-80] | Consider implementing EIP-5267 to securely describe EIP-712 domains being used | 1 |
| [NonCritical-81] | Unused local variable | 1 |
| [NonCritical-82] | Ensure block.timestamp is only used in long time intervals | 3 |
| [NonCritical-83] | Don't assume specific ETH balance | 5 |
| [NonCritical-84] | Avoid mutating function parameters | 3 |
| [NonCritical-85] | Don't only depend on Solidity's arithmetic ordering. | 8 |
| [NonCritical-86] | Contracts with only unimplemented functions can be labeled as abstract | 24 |
| [NonCritical-87] | A event should be emitted if a non immutable state variable is set in a constructor | 2 |
| [NonCritical-88] | Uint casted addresses used in conditional checks can be bypassed | 2 |
| [NonCritical-89] | gasLimit should be uint64 | 31 |
| [NonCritical-90] | Inconstant use of 0x0 and 0x00 for 0 bytes | 1 |
| [NonCritical-91] | The I name prefix should only be used for interfaces | 1 |
| [NonCritical-92] | Consider only defining one library/interface/contract per sol file | 5 |
| [NonCritical-93] | Avoid hard coding gasLimit values | 21 |
| [NonCritical-94] | Contracts use both += 1 and ++ (-- and -= 1) | 2 |
| [NonCritical-95] | Immutable and constant integer state variables should not be casted | 10 |
| [NonCritical-96] | Numbers downcast to addresses may result in collisions | 13 |
| [NonCritical-97] | Empty revert statement | 3 |
| [NonCritical-98] | Use the Modern Upgradeable Contract Paradigm | 31 |
| [NonCritical-99] | Long numbers should include underscores to improve readability and prevent typos | 4 |
| [NonCritical-100] | Delegate call can fail | 1 |
| [NonCritical-101] | Use 'using' keyword when using specific imports rather than calling the specific import directly | 125 |
| [NonCritical-102] | Try catch statement without human readable error | 1 |
| [NonCritical-103] | Avoid revertible function calls in a constructor | 1 |
| [NonCritical-104] | Inconsistent checks of address params against address(0) | 8 |
| [NonCritical-105] | Avoid declaring variables with the names of defined functions within the project | 14 |
| [NonCritical-106] | All verbatim blocks are considered identical by deduplicator and can incorrectly be unified | 1 |
| [NonCritical-107] | Simplify complex require statements | 1 |
| [NonCritical-108] | Constructors should emit an event | 7 |
| [NonCritical-109] | Struct fields should be mixedCase | 1 |
| [NonCritical-110] | int/uint passed into abi.encodePacked without casting to a string. | 5 |
| [NonCritical-111] | Consider validating all user inputs | 114 |
| [NonCritical-112] | Modifier checks msg.sender against two addresses. Consider using multiple modifiers for more control | 6 |
| [NonCritical-113] | Consider providing a ranged getter for array state variables | 1 |
| [NonCritical-114] | Consider using named returns | 136 |
| [NonCritical-115] | Events should have parameters | 2 |
| [NonCritical-116] | Avoid using 'owner' or '_owner' as a parameter name | 2 |
| [NonCritical-117] | Consider migrating from Ownable to AccessControl | 5 |
| [NonCritical-118] | Redundant check for v == 27/28 when used with ecrecover | 1 |
| [NonCritical-119] | Avoid arithmetic directly within array indices | 23 |
| [NonCritical-120] | Memory-safe annotation missing | 13 |
| [NonCritical-121] | Modifier checks msg.sender against two addresses. Consider using multiple modifiers for more control | 6 |
| [NonCritical-122] | ERC777 tokens can introduce reentrancy risks | 2 |
## [Low-1] Solidity version 0.8.20 won't work on all chains due to PUSH0 

### Resolution 
Solidity version 0.8.20 uses the new Shanghai EVM which introduces the PUSH0 opcode, this may not be implemented on all chains and L2 thus reducing the portability and compatability of the code. Consider using a earlier solidity version.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L3-L3)']
```solidity
3: pragma solidity 0.8.20; // <= FOUND

```


</details>

## [Low-2] Missing checks for address(0x0) when updating address state variables 

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin {
52:         
53:         address oldPendingAdmin = pendingAdmin;
54:         
55:         pendingAdmin = _newPendingAdmin;
56:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
57:     }

```
['[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108-L108)']
```solidity
108:     function setSharedBridge(address _sharedBridge) external onlyOwner {
109:         sharedBridge = IL1SharedBridge(_sharedBridge);
110:     }

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin {
52:         
53:         address oldPendingAdmin = pendingAdmin;
54:         
55:         pendingAdmin = _newPendingAdmin;
56:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
57:     }

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132-L132)']
```solidity
132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin {
133:         validatorTimelock = _validatorTimelock;
134:     }

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L45-L45)']
```solidity
45:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager {
46:         s.validators[_validator] = _active;
47:         emit ValidatorStatusUpdate(_validator, _active);
48:     }

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L23-L23)']
```solidity
23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin {
24:         
25:         address oldPendingAdmin = s.pendingAdmin;
26:         
27:         s.pendingAdmin = _newPendingAdmin;
28:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
29:     }

```


</details>

## [Low-3] Contracts with multiple onlyXYZ modifiers where XYZ is a role can introduce complexities when managing privileges 

### Resolution 
In smart contracts, using multiple `onlyXYZ` modifiers for different roles can complicate privilege management. OpenZeppelin's AccessControl offers a streamlined solution, enabling easier and more flexible role-based permission handling. It simplifies the assignment and revocation of roles compared to multiple individual modifiers, reducing potential errors and improving contract maintainability. This modular approach to access management makes it more straightforward to define, manage, and audit roles and permissions within a contract.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L68-L83)']
```solidity
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step {
31:     using SafeERC20 for IERC20;
32: 
68:     modifier onlyBridgehub() { // <= FOUND
69:         require(msg.sender == address(bridgehub), "ShB not BH");
70:         _;
71:     }
72: 
74:     modifier onlyBridgehubOrEra(uint256 _chainId) { // <= FOUND
75:         require(

74:     modifier onlyBridgehubOrEra(uint256 _chainId) { // <= FOUND
75:         require(
76:             msg.sender == address(bridgehub) || (_chainId == ERA_CHAIN_ID && msg.sender == ERA_DIAMOND_PROXY),
77:             "L1SharedBridge: not bridgehub or era chain"
78:         );
79:         _;
80:     }

83:     modifier onlyLegacyBridge() { // <= FOUND
84:         require(msg.sender == address(legacyBridge), "ShB not legacy bridge");
85:         _;
86:     }
87: 
90:     constructor(
91:         address _l1WethAddress,


```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L58-L70)']
```solidity
20: contract Governance is IGovernance, Ownable2Step {
21:     
22:     uint256 internal constant EXECUTED_PROPOSAL_TIMESTAMP = uint256(1);
58:     modifier onlySelf() { // <= FOUND
59:         require(msg.sender == address(this), "Only governance contract itself is allowed to call this function");
60:         _;
61:     }
62: 
64:     modifier onlySecurityCouncil() { // <= FOUND
65:         require(msg.sender == securityCouncil, "Only security council is allowed to call this function");

64:     modifier onlySecurityCouncil() { // <= FOUND
65:         require(msg.sender == securityCouncil, "Only security council is allowed to call this function");
66:         _;
67:     }
68: 
70:     modifier onlyOwnerOrSecurityCouncil() { // <= FOUND
71:         require(

70:     modifier onlyOwnerOrSecurityCouncil() { // <= FOUND
71:         require(
72:             msg.sender == owner() || msg.sender == securityCouncil,
73:             "Only the owner and security council are allowed to call this function"
74:         );
75:         _;
76:     }


```
['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L63-L69)']
```solidity
25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step {
26:     
27:     address public immutable bridgehub;
63:     modifier onlyBridgehub() { // <= FOUND
64:         require(msg.sender == bridgehub, "StateTransition: only bridgehub");
65:         _;
66:     }
67: 
69:     modifier onlyOwnerOrAdmin() { // <= FOUND
70:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin");

69:     modifier onlyOwnerOrAdmin() { // <= FOUND
70:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin");
71:         _;
72:     }
73: 
74:     function getChainAdmin(uint256 _chainId) external view override returns (address) {
75:         return IZkSyncStateTransition(stateTransition[_chainId]).getAdmin();


```
['[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L61-L67)']
```solidity
22: contract ValidatorTimelock is IExecutor, Ownable2Step {
23:     using LibMap for LibMap.Uint32Map;
24: 
61:     modifier onlyChainAdmin(uint256 _chainId) { // <= FOUND
62:         require(msg.sender == stateTransitionManager.getChainAdmin(_chainId), "ValidatorTimelock: only chain admin");
63:         _;
64:     }
65: 
67:     modifier onlyValidator(uint256 _chainId) { // <= FOUND
68:         require(validators[_chainId][msg.sender] == true, "ValidatorTimelock: only validator");

67:     modifier onlyValidator(uint256 _chainId) { // <= FOUND
68:         require(validators[_chainId][msg.sender] == true, "ValidatorTimelock: only validator");
69:         _;
70:     }
71: 
73:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner {
74:         stateTransitionManager = _stateTransitionManager;


```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L15-L52)']
```solidity
11: contract ZkSyncStateTransitionBase is ReentrancyGuard {
12:     ZkSyncStateTransitionStorage internal s;
13: 
15:     modifier onlyAdmin() { // <= FOUND
16:         require(msg.sender == s.admin, "StateTransition Chain: not admin");
17:         _;
18:     }
19: 
21:     modifier onlyValidator() { // <= FOUND
22:         require(s.validators[msg.sender], "StateTransition Chain: not validator");

21:     modifier onlyValidator() { // <= FOUND
22:         require(s.validators[msg.sender], "StateTransition Chain: not validator");
23:         _;
24:     }
25: 
26:     modifier onlyStateTransitionManager() { // <= FOUND
27:         require(msg.sender == s.stateTransitionManager, "StateTransition Chain: not state transition manager");

26:     modifier onlyStateTransitionManager() { // <= FOUND
27:         require(msg.sender == s.stateTransitionManager, "StateTransition Chain: not state transition manager");
28:         _;
29:     }
30: 
31:     modifier onlyBridgehub() { // <= FOUND
32:         require(msg.sender == s.bridgehub, "StateTransition Chain: not bridgehub");

31:     modifier onlyBridgehub() { // <= FOUND
32:         require(msg.sender == s.bridgehub, "StateTransition Chain: not bridgehub");
33:         _;
34:     }
35: 
36:     modifier onlyAdminOrStateTransitionManager() { // <= FOUND
37:         require(

36:     modifier onlyAdminOrStateTransitionManager() { // <= FOUND
37:         require(
38:             msg.sender == s.admin || msg.sender == s.stateTransitionManager,
39:             "StateTransition Chain: Only by admin or state transition manager"
40:         );
41:         _;
42:     }

44:     modifier onlyValidatorOrStateTransitionManager() { // <= FOUND
45:         require(
46:             s.validators[msg.sender] || msg.sender == s.stateTransitionManager,
47:             "StateTransition Chain: Only by validator or state transition manager"
48:         );
49:         _;
50:     }

52:     modifier onlyBaseTokenBridge() { // <= FOUND
53:         require(msg.sender == s.baseTokenBridge, "Only shared bridge can call this function");
54:         _;
55:     }
56: }


```


</details>

## [Low-4] Code does not follow the best practice of check-effects-interaction 

### Resolution 
The "check-effects-interaction" pattern is a best practice in smart contract development, emphasizing the order of operations in functions to prevent reentrancy attacks. Violations arise when a function interacts with external contracts before settling internal state changes or checks. This misordering can expose the contract to potential threats. To adhere to this pattern, first ensure all conditions or checks are satisfied, then update any internal states, and only after these steps, interact with external contracts or addresses. Rearranging operations to this recommended sequence bolsters contract security and aligns with established best practices in the Ethereum community.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L116-L131)']
```solidity
116:     function transferFundsFromLegacy(address _token, address _target, uint256 _targetChainId) external onlyOwner { // <= FOUND
117:         if (_token == ETH_TOKEN_ADDRESS) {
118:             uint256 balanceBefore = address(this).balance;
119:             IMailbox(_target).transferEthToSharedBridge();
120:             uint256 balanceAfter = address(this).balance;
121:             require(balanceAfter > balanceBefore, "ShB: 0 eth transferred");
122:             chainBalance[_targetChainId][ETH_TOKEN_ADDRESS] =
123:                 chainBalance[_targetChainId][ETH_TOKEN_ADDRESS] +
124:                 balanceAfter -
125:                 balanceBefore;
126:         } else {
127:             uint256 balanceBefore = IERC20(_token).balanceOf(address(this)); // <= FOUND
128:             uint256 amount = IERC20(_token).balanceOf(address(legacyBridge)); // <= FOUND
129:             require(amount > 0, "ShB: 0 amount to transfer");
130:             IL1ERC20Bridge(_target).tranferTokenToSharedBridge(_token, amount);
131:             uint256 balanceAfter = IERC20(_token).balanceOf(address(this)); // <= FOUND
132:             require(balanceAfter - balanceBefore == amount, "ShB: wrong amount transferred");
133:             chainBalance[_targetChainId][_token] = chainBalance[_targetChainId][_token] + amount;
134:         }
135:     }

```
['[111](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L111-L120)']
```solidity
111:     function reinitializeToken(
112:         ERC20Getters calldata _availableGetters,
113:         string memory _newName,
114:         string memory _newSymbol,
115:         uint8 _version
116:     ) external onlyNextVersion(_version) reinitializer(_version) {
117:         
118:         
119:         address beaconAddress = _getBeacon();
120:         require(msg.sender == UpgradeableBeacon(beaconAddress).owner(), "tt"); // <= FOUND
121: 
122:         __ERC20_init_unchained(_newName, _newSymbol);
123:         __ERC20Permit_init(_newName);
124:         availableGetters = _availableGetters;
125: 
126:         emit BridgeInitialize(l1Address, _newName, _newSymbol, decimals_);
127:     }

```


</details>

## [Low-5] Some tokens may revert when zero value transfers are made 

### Resolution 
Reason: In Solidity, ERC20 token transfers of value 0 can sometimes lead to unexpected issues. This is particularly relevant when dealing with fractional token amounts that round to 0 when less than 1 of the smallest unit is transferred, leading to an effective transfer of nothing while still consuming gas. Furthermore, some ERC20 token implementations may revert on attempts to transfer a value of 0. However, note that this issue doesn't generally apply to wrapper native tokens like WETH.

Resolution: It's advisable to include a condition before any transfer operation to bypass the transaction if the transfer amount is 0. This saves unnecessary gas expenditure and prevents potential function reverts. For handling fractions, ensure token decimals are appropriately assigned and contemplate setting a minimum transfer threshold to avoid rounding down to 0. When dealing with wrapped tokens like WETH, special consideration should be given to their unique characteristics.

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63-L67)']
```solidity
63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external { // <= FOUND
64:         require(msg.sender == address(sharedBridge), "Not shared bridge");
65:         uint256 amount = IERC20(_token).balanceOf(address(this));
66:         require(amount == _amount, "Incorrect amount");
67:         IERC20(_token).safeTransfer(address(sharedBridge), amount); // <= FOUND
68:     }

```
['[160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L160-L162)']
```solidity
160:     function _depositFundsToSharedBridge(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) { // <= FOUND
161:         uint256 balanceBefore = _token.balanceOf(address(sharedBridge));
162:         _token.safeTransferFrom(_from, address(sharedBridge), _amount); // <= FOUND
163:         uint256 balanceAfter = _token.balanceOf(address(sharedBridge));
164: 
165:         return balanceAfter - balanceBefore;
166:     }

```
['[173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L173-L175)']
```solidity
173:     function _depositFunds(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) { // <= FOUND
174:         uint256 balanceBefore = _token.balanceOf(address(this));
175:         _token.safeTransferFrom(_from, address(this), _amount); // <= FOUND
176:         uint256 balanceAfter = _token.balanceOf(address(this));
177: 
178:         return balanceAfter - balanceBefore;
179:     }

```
['[409](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L409-L452)']
```solidity
409:     function _finalizeWithdrawal(
410:         uint256 _chainId,
411:         uint256 _l2BatchNumber,
412:         uint256 _l2MessageIndex,
413:         uint16 _l2TxNumberInBatch,
414:         bytes calldata _message,
415:         bytes32[] calldata _merkleProof
416:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount) {
417:         require(!isWithdrawalFinalized[_chainId][_l2BatchNumber][_l2MessageIndex], "Withdrawal is already finalized");
418:         isWithdrawalFinalized[_chainId][_l2BatchNumber][_l2MessageIndex] = true;
419: 
420:         
421:         if (_isEraLegacyWithdrawal(_chainId, _l2BatchNumber)) {
422:             
423:             bool alreadyFinalized = IGetters(ERA_DIAMOND_PROXY).isEthWithdrawalFinalized(
424:                 _l2BatchNumber,
425:                 _l2MessageIndex
426:             );
427:             require(!alreadyFinalized, "Withdrawal is already finalized 2");
428:         }
429: 
430:         MessageParams memory messageParams = MessageParams({
431:             l2BatchNumber: _l2BatchNumber,
432:             l2MessageIndex: _l2MessageIndex,
433:             l2TxNumberInBatch: _l2TxNumberInBatch
434:         });
435:         (l1Receiver, l1Token, amount) = _checkWithdrawal(_chainId, messageParams, _message, _merkleProof);
436: 
437:         if (!hyperbridgingEnabled[_chainId]) {
438:             
439:             require(chainBalance[_chainId][l1Token] >= amount, "ShB not enough funds 2"); 
440:             chainBalance[_chainId][l1Token] -= amount;
441:         }
442: 
443:         if (l1Token == ETH_TOKEN_ADDRESS) {
444:             bool callSuccess;
445:             
446:             assembly {
447:                 callSuccess := call(gas(), l1Receiver, amount, 0, 0, 0, 0)
448:             }
449:             require(callSuccess, "ShB: withdraw failed");
450:         } else {
451:             
452:             IERC20(l1Token).safeTransfer(l1Receiver, amount); // <= FOUND
453:         }
454:         emit WithdrawalFinalizedSharedBridge(_chainId, l1Receiver, l1Token, amount);
455:     }

```


</details>

## [Low-6] Comparisons against msg.sender and address(this) can easily be bypassed 

### Resolution 
Comparisons using `msg.sender` and `address(this)` can be exploited when contracts call their own functions. If an attacker influences the `calldata` during such a self-call, they can bypass checks expecting `msg.sender` to be an external address. Instead, `msg.sender` becomes the contract's own address. This can circumvent security checks designed for external calls or disrupt logic that uses `msg.sender` for accounting or differentiation. To counter this, contracts should not solely rely on `msg.sender` checks and should be wary of potential recursive calls. It's crucial to implement additional validation mechanisms and conduct thorough tests to prevent unintended call behaviors.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[59](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L59-L59)']
```solidity
59:         require(msg.sender == address(this), "Only governance contract itself is allowed to call this function"); // <= FOUND

```
['[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L29-L29)']
```solidity
29:         require(msg.sender == address(this), "Callable only by self"); // <= FOUND

```


</details>

## [Low-7] Function which returns data from a call has no validation

### Resolution 
In Solidity, when `call` or `delegatecall` is used to interact with another contract, it's possible that the called contract function doesn't return any data. This could be due to various reasons, such as the function is not implemented, or the function encountered an error. If the calling contract then tries to directly access elements in the returned data without first checking the length of the returned data, it could lead to a runtime error, or in some cases, incorrect logic execution.

Therefore, it's advisable to have a length check and revert the transaction if `results.length` is 0. This ensures the function doesn't proceed with potentially unsafe or invalid data. It also provides a clear error message to the caller, indicating that the called function did not return any data, which assists in troubleshooting.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L254-L265)']
```solidity
254:     function _getERC20Getters(address _token) internal view returns (bytes memory) { // <= FOUND
255:         if (_token == ETH_TOKEN_ADDRESS) {
256:             bytes memory name = bytes("Ether");
257:             bytes memory symbol = bytes("ETH");
258:             bytes memory decimals = abi.encode(uint8(18));
259:             return abi.encode(name, symbol, decimals); 
260:         }
261: 
262:         (, bytes memory data1) = _token.staticcall(abi.encodeCall(IERC20Metadata.name, ()));
263:         (, bytes memory data2) = _token.staticcall(abi.encodeCall(IERC20Metadata.symbol, ()));
264:         (, bytes memory data3) = _token.staticcall(abi.encodeCall(IERC20Metadata.decimals, ()));
265:         return abi.encode(data1, data2, data3); // <= FOUND
266:     }

```


</details>

## [Low-8] Int casting block.timestamp can reduce the lifespan of a contract

### Resolution 
Casting `block.timestamp` (a Unix epoch time in seconds) to an integer type with a smaller size in Solidity can potentially reduce the lifespan of a smart contract. The `block.timestamp` returns a value that increases over time and can eventually exceed the maximum value storable in smaller integer types. For example, casting `block.timestamp` to an `int32` could lead to an overflow by the year 2038 (the year when Unix time exceeds the maximum value storable in a 32-bit integer). This overflow would result in incorrect timestamp values, potentially disrupting the contract's logic or rendering it unusable. Therefore, it's important to use an integer type that can accommodate the range of expected timestamp values throughout the contract's intended lifespan.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[117](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L117-L117)']
```solidity
115:             
116:             
117:             uint32 timestamp = uint32(block.timestamp); // <= FOUND

```


</details>

## [Low-9] Empty receive functions can cause gas issues

### Resolution 
In Solidity, functions that receive Ether without corresponding functionality to utilize or withdraw these funds can inadvertently lead to a permanent loss of value. This is because if someone sends Ether to the contract, they may be unable to retrieve it. To avoid this, functions receiving Ether should be accompanied by additional methods that process or allow the withdrawal of these funds. If the intent is to use the received Ether, it should trigger a separate function; if not, it should revert the transaction (for instance, via `require(msg.sender == address(weth))`). Access control checks can also prevent unintended Ether transfers, despite the slight gas cost they entail. If concerns over gas costs persist, at minimum, include a rescue function to recover unused Ether. Missteps in handling Ether in smart contracts can lead to irreversible financial losses, hence these precautions are crucial.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L262-L262)']
```solidity
262:     receive() external payable {}

```
['[227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L227-L227)']
```solidity
227:     receive() external payable {
228:         
229:     }

```
['[262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L262-L262)']
```solidity
262:     receive() external payable {}

```


</details>

## [Low-10] Upgradable contracts should have a __gap variable

### Resolution 
This is to ensure the team can add new state variables without compromising compatability.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30-L30)']
```solidity
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step 

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L23-L23)']
```solidity
23: contract L2SharedBridge is IL2SharedBridge, Initializable 

```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L15-L15)']
```solidity
15: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade 

```


</details>

## [Low-11] Empty fallback functions can cause gas issues

### Resolution 
An empty fallback() function in a Solidity contract can cause issues, as it might inadvertently accept Ether transfers without any mechanism to manage or allocate the received funds. Consequently, Ether could become permanently locked within the contract, causing potential financial losses and diminishing user trust.

To rectify this situation, developers should implement appropriate logic within the fallback() function to handle incoming Ether transfers. This may include updating internal balances, emitting events for transparency, or implementing access control mechanisms to restrict Ether transfers to authorized parties

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L11-L11)']
```solidity
11:     fallback() external payable {}

```


</details>

## [Low-12] The nonReentrant modifier should be first in a function declaration

### Resolution 
In Solidity, the `nonReentrant` modifier is essential for securing smart contracts against reentrancy attacks. It should be positioned first in a function declaration. This placement is critical because it ensures that the modifier's protection is applied before any other code or modifiers in the function. If placed later, other modifiers could potentially be executed in a reentrant manner before `nonReentrant` has a chance to lock the function, leaving the contract vulnerable. Thus, prioritizing `nonReentrant` as the first modifier is a best practice for robust smart contract security, effectively guarding against unintended reentries and related exploits.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[554](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L554-L562)']
```solidity
554:     function depositLegacyErc20Bridge(
555:         address _prevMsgSender,
556:         address _l2Receiver,
557:         address _l1Token,
558:         uint256 _amount,
559:         uint256 _l2TxGasLimit,
560:         uint256 _l2TxGasPerPubdataByte,
561:         address _refundRecipient
562:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) { // <= FOUND
563:         require(l2BridgeAddress[ERA_CHAIN_ID] != address(0), "ShB b. n dep");
564:         require(_l1Token != l1WethAddress, "ShB: WETH deposit not supported 2");
565: 
566:         
567:         if (!hyperbridgingEnabled[ERA_CHAIN_ID]) {
568:             chainBalance[ERA_CHAIN_ID][_l1Token] += _amount;
569:         }
570: 
571:         bytes memory l2TxCalldata = _getDepositL2Calldata(_prevMsgSender, _l2Receiver, _l1Token, _amount);
572: 
573:         {
574:             
575:             
576:             
577:             address refundRecipient = _refundRecipient;
578:             if (_refundRecipient == address(0)) {
579:                 refundRecipient = _prevMsgSender != tx.origin
580:                     ? AddressAliasHelper.applyL1ToL2Alias(_prevMsgSender)
581:                     : _prevMsgSender;
582:             }
583: 
584:             L2TransactionRequestDirect memory request = L2TransactionRequestDirect({
585:                 chainId: ERA_CHAIN_ID,
586:                 l2Contract: l2BridgeAddress[ERA_CHAIN_ID],
587:                 mintValue: msg.value, 
588:                 l2Value: 0, 
589:                 l2Calldata: l2TxCalldata,
590:                 l2GasLimit: _l2TxGasLimit,
591:                 l2GasPerPubdataByteLimit: _l2TxGasPerPubdataByte,
592:                 factoryDeps: new bytes[](0),
593:                 refundRecipient: refundRecipient
594:             });
595:             l2TxHash = bridgehub.requestL2TransactionDirect{value: msg.value}(request);
596:         }
597: 
598:         bytes32 txDataHash = keccak256(abi.encode(_prevMsgSender, _l1Token, _amount));
599:         
600:         depositHappened[ERA_CHAIN_ID][l2TxHash] = txDataHash;
601: 
602:         emit LegacyDepositInitiated(ERA_CHAIN_ID, l2TxHash, _prevMsgSender, _l2Receiver, _l1Token, _amount);
603:     }

```
['[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L121)']
```solidity
114:     function createNewChain(
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, 
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) { // <= FOUND
122:         require(_chainId != 0, "Bridgehub: chainId cannot be 0");
123:         require(_chainId <= type(uint48).max, "Bridgehub: chainId too large");
124: 
125:         require(
126:             stateTransitionManagerIsRegistered[_stateTransitionManager],
127:             "Bridgehub: state transition not registered"
128:         );
129:         require(tokenIsRegistered[_baseToken], "Bridgehub: token not registered");
130:         require(address(sharedBridge) != address(0), "Bridgehub: weth bridge not set");
131: 
132:         require(stateTransitionManager[_chainId] == address(0), "Bridgehub: chainId already registered");
133: 
134:         stateTransitionManager[_chainId] = _stateTransitionManager;
135:         baseToken[_chainId] = _baseToken;
136: 
137:         IStateTransitionManager(_stateTransitionManager).createNewChain(
138:             _chainId,
139:             _baseToken,
140:             address(sharedBridge),
141:             _admin,
142:             _initData
143:         );
144: 
145:         emit NewChain(_chainId, _stateTransitionManager, _admin);
146:         return _chainId;
147:     }

```


</details>

## [Low-13] Missing zero address check in constructor

### Resolution 
In Solidity, constructors often take address parameters to initialize important components of a contract, such as owner or linked contracts. However, without a check, there's a risk that an address parameter could be mistakenly set to the zero address (0x0). This could occur due to a mistake or oversight during contract deployment. A zero address in a crucial role can cause serious issues, as it cannot perform actions like a normal address, and any funds sent to it are irretrievable. Therefore, it's crucial to include a zero address check in constructors to prevent such potential problems. If a zero address is detected, the constructor should revert the transaction.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[91](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L91-L91)']
```solidity
90:     constructor(
91:         address _l1WethAddress, // <= FOUND
92:         IBridgehub _bridgehub,
93:         IL1ERC20Bridge _legacyBridge
94:     ) reentrancyGuardInitializer {
95:         _disableInitializers();
96:         l1WethAddress = _l1WethAddress;
97:         bridgehub = _bridgehub;
98:         legacyBridge = _legacyBridge;
99:     }

```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L58-L58)']
```solidity
58:     constructor(address _bridgehub) reentrancyGuardInitializer { // <= FOUND
59:         bridgehub = _bridgehub;
60:     }

```
['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L55-L55)']
```solidity
55:     constructor(address _initialOwner, uint32 _executionDelay) { // <= FOUND
56:         _transferOwnership(_initialOwner);
57:         executionDelay = _executionDelay;
58:     }

```


</details>

## [Low-14] Use of onlyOwner functions can be lost

### Resolution 
In Solidity, renouncing ownership of a contract essentially transfers ownership to the zero address. This is an irreversible operation and has considerable security implications. If the renounceOwnership function is used, the contract will lose the ability to perform any operations that are limited to the owner. This can be problematic if there are any bugs, flaws, or unexpected events that require owner intervention to resolve. Therefore, in some instances, it is better to disable or omit the renounceOwnership function, and instead implement a secure transferOwnership function. This way, if necessary, ownership can be transferred to a new, trusted party without losing the potential for administrative intervention.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30-L30)']
```solidity
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step  // <= FOUND

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16-L16)']
```solidity
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step  // <= FOUND

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L20-L20)']
```solidity
20: contract Governance is IGovernance, Ownable2Step  // <= FOUND

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L25-L25)']
```solidity
25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step  // <= FOUND

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L22-L22)']
```solidity
22: contract ValidatorTimelock is IExecutor, Ownable2Step  // <= FOUND

```


</details>

## [Low-15] safeApprove is deprecated

### Resolution 
The use of safeApprove has been deprecated in favour of safeIncreaseAllowance and safeDecreaseAllowance. Transition to these to ensure compatibility and functionality (if a bug is found) for the future.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[382](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L382-L385)']
```solidity
382:                 
383:                 
384: 
385:                 IERC20(token).safeApprove(paymaster, 0); // <= FOUND

```
['[383](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L383-L383)']
```solidity
383:                 IERC20(token).safeApprove(paymaster, minAllowance); // <= FOUND

```


</details>

## [Low-16] Draft imports may break in new minor versions

### Resolution 
Utilizing draft contracts from OpenZeppelin, despite their audit, carries potential risks due to their 'draft' status. These contracts are based on non-finalized EIPs, potentially leading to unforeseen changes in even minor updates. In case a flaw surfaces in this OpenZeppelin version, and the necessary upgrade version introduces breaking changes, this could result in unexpected delays in developing and testing replacement contracts. To mitigate this, ensure comprehensive test coverage, enabling automated detection of differences, and establish a contingency plan for thoroughly testing a new version if changes occur. It may be advisable to create a forked file version instead of importing directly from the package, permitting manual updates to your fork as necessary.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L5-L5)']
```solidity
5: import {ERC20PermitUpgradeable} from "@openzeppelin/contracts-upgradeable/token/ERC20/extensions/draft-ERC20PermitUpgradeable.sol"; // <= FOUND

```


</details>

## [Low-17] Revert on Transfer to the Zero Address

### Resolution 
Many ERC-20 and ERC-721 token contracts implement a safeguard that reverts transactions which attempt to transfer tokens to the zero address. This is because such transfers are often the result of programming errors. The OpenZeppelin library, a popular choice for implementing these standards, includes this safeguard. For token contract developers who want to avoid unintentional transfers to the zero address, it's good practice to include a condition that reverts the transaction if the recipient's address is the zero address. 

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L160-L162)']
```solidity
160:     function _depositFundsToSharedBridge(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) {
161:         uint256 balanceBefore = _token.balanceOf(address(sharedBridge));
162:         _token.safeTransferFrom(_from, address(sharedBridge), _amount); // <= FOUND
163:         uint256 balanceAfter = _token.balanceOf(address(sharedBridge));
164: 
165:         return balanceAfter - balanceBefore;
166:     }

```
['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63-L67)']
```solidity
63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external {
64:         require(msg.sender == address(sharedBridge), "Not shared bridge");
65:         uint256 amount = IERC20(_token).balanceOf(address(this));
66:         require(amount == _amount, "Incorrect amount");
67:         IERC20(_token).safeTransfer(address(sharedBridge), amount); // <= FOUND
68:     }

```
['[303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L303-L362)']
```solidity
303:     function _claimFailedDeposit(
304:         bool _checkedInLegacyBridge,
305:         uint256 _chainId,
306:         address _depositSender,
307:         address _l1Token,
308:         uint256 _amount,
309:         bytes32 _l2TxHash,
310:         uint256 _l2BatchNumber,
311:         uint256 _l2MessageIndex,
312:         uint16 _l2TxNumberInBatch,
313:         bytes32[] calldata _merkleProof
314:     ) internal nonReentrant {
315:         {
316:             bool proofValid = bridgehub.proveL1ToL2TransactionStatus(
317:                 _chainId,
318:                 _l2TxHash,
319:                 _l2BatchNumber,
320:                 _l2MessageIndex,
321:                 _l2TxNumberInBatch,
322:                 _merkleProof,
323:                 TxStatus.Failure
324:             );
325:             require(proofValid, "yn");
326:         }
327:         require(_amount > 0, "y1");
328: 
329:         {
330:             bool notCheckedInLegacyBridgeOrWeCanCheckDeposit;
331:             {
332:                 
333:                 bool weCanCheckDepositHere = !_isEraLegacyWithdrawal(_chainId, _l2BatchNumber);
334:                 
335:                 
336:                 
337:                 notCheckedInLegacyBridgeOrWeCanCheckDeposit = (!_checkedInLegacyBridge) || weCanCheckDepositHere;
338:             }
339:             if (notCheckedInLegacyBridgeOrWeCanCheckDeposit) {
340:                 bytes32 dataHash = depositHappened[_chainId][_l2TxHash];
341:                 bytes32 txDataHash = keccak256(abi.encode(_depositSender, _l1Token, _amount));
342:                 require(dataHash == txDataHash, "ShB: d.it not hap");
343:                 delete depositHappened[_chainId][_l2TxHash];
344:             }
345:         }
346: 
347:         if (!hyperbridgingEnabled[_chainId]) {
348:             
349:             require(chainBalance[_chainId][_l1Token] >= _amount, "ShB n funds");
350:             chainBalance[_chainId][_l1Token] -= _amount;
351:         }
352: 
353:         
354:         if (_l1Token == ETH_TOKEN_ADDRESS) {
355:             bool callSuccess;
356:             
357:             assembly {
358:                 callSuccess := call(gas(), _depositSender, _amount, 0, 0, 0, 0)
359:             }
360:             require(callSuccess, "ShB: claimFailedDeposit failed");
361:         } else {
362:             IERC20(_l1Token).safeTransfer(_depositSender, _amount); // <= FOUND
363:             
364:             
365:         }
366: 
367:         emit ClaimedFailedDepositSharedBridge(_chainId, _depositSender, _l1Token, _amount);
368:     }

```
['[409](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L409-L452)']
```solidity
409:     function _finalizeWithdrawal(
410:         uint256 _chainId,
411:         uint256 _l2BatchNumber,
412:         uint256 _l2MessageIndex,
413:         uint16 _l2TxNumberInBatch,
414:         bytes calldata _message,
415:         bytes32[] calldata _merkleProof
416:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount) {
417:         require(!isWithdrawalFinalized[_chainId][_l2BatchNumber][_l2MessageIndex], "Withdrawal is already finalized");
418:         isWithdrawalFinalized[_chainId][_l2BatchNumber][_l2MessageIndex] = true;
419: 
420:         
421:         if (_isEraLegacyWithdrawal(_chainId, _l2BatchNumber)) {
422:             
423:             bool alreadyFinalized = IGetters(ERA_DIAMOND_PROXY).isEthWithdrawalFinalized(
424:                 _l2BatchNumber,
425:                 _l2MessageIndex
426:             );
427:             require(!alreadyFinalized, "Withdrawal is already finalized 2");
428:         }
429: 
430:         MessageParams memory messageParams = MessageParams({
431:             l2BatchNumber: _l2BatchNumber,
432:             l2MessageIndex: _l2MessageIndex,
433:             l2TxNumberInBatch: _l2TxNumberInBatch
434:         });
435:         (l1Receiver, l1Token, amount) = _checkWithdrawal(_chainId, messageParams, _message, _merkleProof);
436: 
437:         if (!hyperbridgingEnabled[_chainId]) {
438:             
439:             require(chainBalance[_chainId][l1Token] >= amount, "ShB not enough funds 2"); 
440:             chainBalance[_chainId][l1Token] -= amount;
441:         }
442: 
443:         if (l1Token == ETH_TOKEN_ADDRESS) {
444:             bool callSuccess;
445:             
446:             assembly {
447:                 callSuccess := call(gas(), l1Receiver, amount, 0, 0, 0, 0)
448:             }
449:             require(callSuccess, "ShB: withdraw failed");
450:         } else {
451:             
452:             IERC20(l1Token).safeTransfer(l1Receiver, amount); // <= FOUND
453:         }
454:         emit WithdrawalFinalizedSharedBridge(_chainId, l1Receiver, l1Token, amount);
455:     }

```


</details>

## [Low-18] Bridge function must check for native token

### Resolution 
Functions that bridge ERC20 tokens often do not interact with Ether (ETH), the native cryptocurrency of Ethereum. In these functions, `msg.value` represents the amount of Ether sent in the transaction. 

When a function is marked as `payable`, it indicates that the function is allowed to receive Ether. However, if these functions are not designed to handle Ether, and someone unintentionally or intentionally sends Ether to these functions, the Ether could be locked in the contract forever, leading to a loss of funds. This is because if the contract does not have a specific function to withdraw or refund this Ether, there's no way to retrieve it.

To mitigate this issue, these functions should explicitly require that `msg.value == 0`. This statement ensures that no Ether is being sent in the transaction. If `msg.value` is not equal to zero, the transaction will revert, thereby preventing accidental loss of Ether. 

In conclusion, requiring `msg.value == 0` in functions that bridge ERC20 tokens ensures that only token transactions are processed, and prevents inadvertent loss of Ether, thereby increasing the security of the contract.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L47-L47)']
```solidity
47:     function bridgehubRequestL2Transaction(
48:         BridgehubL2TransactionRequest memory _request
49:     ) external payable onlyBridgehub returns (bytes32 canonicalTxHash) {
50:         canonicalTxHash = _requestL2TransactionSender(_request);
51:     }

```


</details>

## [Low-19] Missing zero address check in initializer

### Resolution 
Initializer functions in contracts often set important parameters or addresses. Failing to check for the zero address (0x0000000000000000000000000000000000000000) in initializers can lead to unintended behavior, as this address typically signifies an unset or default value. Transfers to or interactions with the zero address can result in permanent loss of assets or broken functionality. It's crucial to add checks using `require(targetAddress != address(0), "Address cannot be zero")` in initializers to prevent accidentally setting important state variables or parameters to this address, ensuring the system's integrity and user asset safety.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L142-L142)']
```solidity
142:     function initializeChainGovernance(uint256 _chainId, address _l2BridgeAddress) external onlyOwner {
143:         l2BridgeAddress[_chainId] = _l2BridgeAddress;
144:     }

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L41-L41)']
```solidity
41:     function initialize(address _owner) external reentrancyGuardInitializer {
42:         _transferOwnership(_owner);
43:     }

```


</details>

## [Low-20] Critical functions should have a timelock

### Resolution 
Critical functions, especially those affecting protocol parameters or user funds, are potential points of failure or exploitation. To mitigate risks, incorporating a timelock on such functions can be beneficial. A timelock requires a waiting period between the time an action is initiated and when it's executed, giving stakeholders time to react, potentially vetoing malicious or erroneous changes. To implement, integrate a smart contract like OpenZeppelin's `TimelockController` or build a custom mechanism. This ensures governance decisions or administrative changes are transparent and allows for community or multi-signature interventions, enhancing protocol security and trustworthiness.

Num of instances: 14

### Findings 


<details><summary>Click to show findings</summary>

['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin  // <= FOUND

```
['[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108-L108)']
```solidity
108:     function setSharedBridge(address _sharedBridge) external onlyOwner  // <= FOUND

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin  // <= FOUND

```
['[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L137-L137)']
```solidity
137:     function setInitialCutHash(Diamond.DiamondCutData calldata _diamondCut) external onlyOwner  // <= FOUND

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L142-L142)']
```solidity
142:     function setNewVersionUpgrade( // <= FOUND
143:         Diamond.DiamondCutData calldata _cutData,
144:         uint256 _oldProtocolVersion,
145:         uint256 _newProtocolVersion
146:     ) external onlyOwner 

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L152-L152)']
```solidity
152:     function setUpgradeDiamondCut( // <= FOUND
153:         Diamond.DiamondCutData calldata _cutData,
154:         uint256 _oldProtocolVersion
155:     ) external onlyOwner 

```
['[73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L73-L73)']
```solidity
73:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner  // <= FOUND

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L96-L96)']
```solidity
96:     function setExecutionDelay(uint32 _executionDelay) external onlyOwner  // <= FOUND

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L45-L45)']
```solidity
45:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager  // <= FOUND

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L51-L51)']
```solidity
51:     function setPorterAvailability(bool _zkPorterIsAvailable) external onlyStateTransitionManager  // <= FOUND

```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L58-L58)']
```solidity
58:     function setPriorityTxMaxGasLimit(uint256 _newPriorityTxMaxGasLimit) external onlyStateTransitionManager  // <= FOUND

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L79-L79)']
```solidity
79:     function setTokenMultiplier(uint128 _nominator, uint128 _denominator) external onlyAdminOrStateTransitionManager  // <= FOUND

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L23-L23)']
```solidity
23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin  // <= FOUND

```
['[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L89-L89)']
```solidity
89:     function setValidiumMode(PubdataPricingMode _validiumMode) external onlyAdmin  // <= FOUND

```


</details>

## [Low-21] Consider implementing two-step procedure for updating protocol addresses

### Resolution 
Implementing a two-step procedure for updating protocol addresses adds an extra layer of security. In such a system, the first step initiates the change, and the second step, after a predefined delay, confirms and finalizes it. This delay allows stakeholders or monitoring tools to observe and react to unintended or malicious changes. If an unauthorized change is detected, corrective actions can be taken before the change is finalized. To achieve this, introduce a "proposed address" state variable and a "delay period". Upon an update request, set the "proposed address". After the delay, if not contested, the main protocol address can be updated.

Num of instances: 22

### Findings 


<details><summary>Click to show findings</summary>

['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L53)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { // <= FOUND
52:         
53:         address oldPendingAdmin = pendingAdmin; // <= FOUND
54:         
55:         pendingAdmin = _newPendingAdmin;
56:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
57:     }

```
['[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108-L108)']
```solidity
108:     function setSharedBridge(address _sharedBridge) external onlyOwner { // <= FOUND
109:         sharedBridge = IL1SharedBridge(_sharedBridge);
110:     }

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L53)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin { // <= FOUND
52:         
53:         address oldPendingAdmin = pendingAdmin; // <= FOUND
54:         
55:         pendingAdmin = _newPendingAdmin;
56:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
57:     }

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132-L132)']
```solidity
132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin { // <= FOUND
133:         validatorTimelock = _validatorTimelock;
134:     }

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L45-L45)']
```solidity
45:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager { // <= FOUND
46:         s.validators[_validator] = _active;
47:         emit ValidatorStatusUpdate(_validator, _active);
48:     }

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L23-L25)']
```solidity
23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin { // <= FOUND
24:         
25:         address oldPendingAdmin = s.pendingAdmin; // <= FOUND
26:         
27:         s.pendingAdmin = _newPendingAdmin;
28:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
29:     }

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin  // <= FOUND

```
['[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108-L108)']
```solidity
108:     function setSharedBridge(address _sharedBridge) external onlyOwner  // <= FOUND

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin  // <= FOUND

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132-L132)']
```solidity
132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin  // <= FOUND

```
['[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L137-L137)']
```solidity
137:     function setInitialCutHash(Diamond.DiamondCutData calldata _diamondCut) external onlyOwner  // <= FOUND

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L142-L142)']
```solidity
142:     function setNewVersionUpgrade( // <= FOUND
143:         Diamond.DiamondCutData calldata _cutData,
144:         uint256 _oldProtocolVersion,
145:         uint256 _newProtocolVersion
146:     ) external onlyOwner 

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L152-L152)']
```solidity
152:     function setUpgradeDiamondCut( // <= FOUND
153:         Diamond.DiamondCutData calldata _cutData,
154:         uint256 _oldProtocolVersion
155:     ) external onlyOwner 

```
['[73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L73-L73)']
```solidity
73:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner  // <= FOUND

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L96-L96)']
```solidity
96:     function setExecutionDelay(uint32 _executionDelay) external onlyOwner  // <= FOUND

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L45-L45)']
```solidity
45:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager  // <= FOUND

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L51-L51)']
```solidity
51:     function setPorterAvailability(bool _zkPorterIsAvailable) external onlyStateTransitionManager  // <= FOUND

```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L58-L58)']
```solidity
58:     function setPriorityTxMaxGasLimit(uint256 _newPriorityTxMaxGasLimit) external onlyStateTransitionManager  // <= FOUND

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L79-L79)']
```solidity
79:     function setTokenMultiplier(uint128 _nominator, uint128 _denominator) external onlyAdminOrStateTransitionManager  // <= FOUND

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L23-L23)']
```solidity
23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin  // <= FOUND

```
['[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L89-L89)']
```solidity
89:     function setValidiumMode(PubdataPricingMode _validiumMode) external onlyAdmin  // <= FOUND

```
['[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L67-L67)']
```solidity
67:     function changeFeeParams(FeeParams calldata _newFeeParams) external onlyAdminOrStateTransitionManager  // <= FOUND

```


</details>

## [Low-22] No limits when setting price values

### Resolution 
When setting price values without defined upper or lower bounds, it can lead to unpredictable behavior or potential vulnerabilities. For instance, overly high or low prices could be set maliciously or accidentally, disrupting platform functionality or enabling manipulative profit schemes. It's crucial to enforce constraints on price values to ensure they remain within a reasonable range. As a solution, implement checks to cap the minimum and maximum permissible price values. Additionally, consider implementing a governance mechanism or multi-signature approval process for significant price adjustments, ensuring an added layer of security and oversight.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L105-L106)']
```solidity
105:     function setGasPrice(uint256 _gasPrice) external onlyCallFromBootloader { // <= FOUND
106:         gasPrice = _gasPrice; // <= FOUND
107:     }

```


</details>

## [Low-23] Uses of EIP712 does not include a verifyingContract

### Resolution 
It is standard for uses of EIP712 to include a verifyingContract, not doing so can cause future incompatibilities. Verifying contract is used to protect users from phishing attacks so not including this can make users more vulnerable to such attacks.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L82-L83)']
```solidity
82:     
83:     bytes32 constant EIP712_DOMAIN_TYPEHASH = keccak256("EIP712Domain(string name,string version,uint256 chainId)"); // <= FOUND

```


</details>

## [Low-24] Prefer skip over revert model in iteration

### Resolution 
It is preferable to skip operations on an array index when a condition is not met rather than reverting the whole transaction as reverting can introduce the possiblity of malicous actors purposefully introducing array objects which fail conditional checks within for/while loops so group operations fail. As such it is recommended to simply skip such array indices over reverting unless there is a valid security or logic reason behind not doing so.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[405](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L405-L407)']
```solidity
405:        for (uint256 i = 0; i < committedBatchesLength; i = i.uncheckedInc()) { // <= FOUND
406:             currentTotalBatchesVerified = currentTotalBatchesVerified.uncheckedInc();
407:             require( // <= FOUND
408:                 _hashStoredBatchInfo(_committedBatches[i]) == s.storedBatchHashes[currentTotalBatchesVerified],
409:                 "o1"
410:             );
411: 
412:             bytes32 currentBatchCommitment = _committedBatches[i].commitment;
413:             proofPublicInput[i] = _getBatchProofPublicInput(
414:                 prevBatchCommitment,
415:                 currentBatchCommitment,
416:                 verifierParams
417:             );
418: 
419:             prevBatchCommitment = currentBatchCommitment;
420:         }

```
['[226](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L226-L227)']
```solidity
226:        for (uint256 i = 0; i < _factoryDeps.length; ++i) { // <= FOUND
227:             require( // <= FOUND
228:                 L2ContractHelper.hashL2Bytecode(_factoryDeps[i]) == bytes32(_expectedHashes[i]),
229:                 "Wrong factory dep hash"
230:             );
231:         }

```


</details>

## [Low-25] Missing contract-existence checks before low-level calls

### Resolution 
Low-level calls in Solidity, when made to addresses without contract code, don't fail but return a successful status. This behavior can be misleading, leading to unintended consequences in dApps. Ignoring this can potentially mean acting on false positive results. To address this, apart from the conventional zero-address check, developers should verify the existence of contract code at the target address by ensuring that the code length at the specified address (`<address>.code.length`) is greater than zero. By doing so, it provides a more robust validation before executing low-level calls, safeguarding against unintentional interactions with empty addresses.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L35-L57)']
```solidity
35:     function gasBoundCall(address _to, uint256 _maxTotalGas, bytes calldata _data) external payable {
36:         
37:         
38:         
39:         
40:         uint256 expectedForCompute = gasleft() + CALL_ENTRY_OVERHEAD;
41: 
42:         
43:         
44:         
45:         
46:         require(_maxTotalGas >= gasleft(), "Gas limit is too low");
47: 
48:         
49:         uint256 pubdataAllowance = _maxTotalGas > expectedForCompute ? _maxTotalGas - expectedForCompute : 0;
50: 
51:         uint256 pubdataPublishedBefore = REAL_SYSTEM_CONTEXT_CONTRACT.getCurrentPubdataSpent();
52: 
53:         
54:         
55:         
56:         
57:         bytes memory returnData = EfficientCall.call(gasleft(), _to, msg.value, _data, false); // <= FOUND
58: 
59:         uint256 pubdataPublishedAfter = REAL_SYSTEM_CONTEXT_CONTRACT.getCurrentPubdataSpent();
60: 
61:         
62:         
63:         uint256 pubdataSpent = pubdataPublishedAfter > pubdataPublishedBefore
64:             ? pubdataPublishedAfter - pubdataPublishedBefore
65:             : 0;
66: 
67:         uint256 pubdataPrice = REAL_SYSTEM_CONTEXT_CONTRACT.gasPerPubdataByte();
68: 
69:         
70:         
71:         uint256 pubdataCost = pubdataPrice * pubdataSpent;
72: 
73:         if (pubdataCost != 0) {
74:             
75:             
76:             require(pubdataAllowance + gasleft() >= pubdataCost + CALL_RETURN_OVERHEAD, "Not enough gas for pubdata");
77:         }
78: 
79:         assembly {
80:             
81:             return(add(returnData, 0x20), mload(returnData))
82:         }
83:     }

```
['[224](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L224-L226)']
```solidity
224:     function _execute(Call[] calldata _calls) internal {
225:         for (uint256 i = 0; i < _calls.length; ++i) {
226:             (bool success, bytes memory returnData) = _calls[i].target.call{value: _calls[i].value}(_calls[i].data); // <= FOUND
227:             if (!success) {
228:                 
229:                 assembly {
230:                     revert(add(returnData, 0x20), mload(returnData))
231:                 }
232:             }
233:         }
234:     }

```


</details>

## [Low-26] Address collision possible due to upcast

### Resolution 
Upcasting addresses and comparing them to larger uint types can risk address collisions in smart contracts, potentially introducing vulnerabilities. Specifically, if a uint160 address is upcast to a uint256 and compared with larger values, the comparison may pass incorrectly if the larger value, when cast back down, matches the address. Therefore, checks designed to gate access to certain addresses might erroneously permit access when larger values are used. To mitigate this, ensure type consistency during comparisonscompare uint160 to uint160 and utilize explicit type conversions cautiously.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L95-L95)']
```solidity
95:         return _addr == uint256(uint160(address(BASE_TOKEN_SYSTEM_CONTRACT))) || _addr == 0; // <= FOUND

```


</details>

## [Low-27] Pure function storage pointer bug

### Resolution 
In Solidity, a function marked as `pure` is expected not to read from or modify the state of the blockchain, meaning it shouldn't access or alter any state variables. However, a common oversight occurs when such functions inadvertently use storage pointers. A storage pointer in Solidity refers directly to a state variable, and a pure function using these pointers may end up interacting with the contract's state, contradicting its pure designation. This can lead to subtle bugs because the compiler doesn't flag this misuse, as it expects no state interaction in pure functions. The resolution is to thoroughly review pure functions to ensure they don't use storage pointers, or if necessary, reclassify them as `view` functions if they must read (but not modify) the contract's state. This distinction is crucial for both accurate representation of the function's behavior and for maintaining contract integrity and security.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L87-L87)']
```solidity
87:     function getDiamondStorage() internal pure returns (DiamondStorage storage diamondStorage) { // <= FOUND
88:         bytes32 position = DIAMOND_STORAGE_POSITION;
89:         assembly {
90:             diamondStorage.slot := position
91:         }
92:     }

```


</details>

## [Low-28] Low Level Calls to Custom Addresses

### Resolution 
Low-level calls (such as `.call()`, `.delegatecall()`, or `.callcode()`) in Solidity provide a way to interact with other contracts or addresses. However, when these calls are made to addresses that are provided as parameters or are not well-validated, they pose a significant security risk. Untrusted addresses might contain malicious code leading to unexpected behavior, loss of funds, or vulnerabilities.

**Resolution**: Prefer using high-level Solidity function calls or interface-based interactions with known contracts to ensure security. If low-level calls are necessary, rigorously validate the addresses and test all possible interactions. Implementing additional checks and fail-safes can help mitigate potential risks associated with low-level calls.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[278](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L278-L283)']
```solidity
278:     function _initializeDiamondCut(address _init, bytes memory _calldata) private { // <= FOUND
279:         if (_init == address(0)) {
280:             require(_calldata.length == 0, "H"); 
281:         } else {
282:             
283:             (bool success, bytes memory data) = _init.delegatecall(_calldata); // <= FOUND
284:             if (!success) {
285:                 
286:                 if (data.length <= 4) {
287:                     revert("I"); 
288:                 }
289: 
290:                 assembly {
291:                     revert(add(data, 0x20), mload(data))
292:                 }
293:             }
294: 
295:             
296:             
297:             require(data.length == 32, "lp");
298:             require(abi.decode(data, (bytes32)) == DIAMOND_INIT_SUCCESS_RETURN_VALUE, "lp1");
299:         }
300:     }

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L21-L25)']
```solidity
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable { // <= FOUND
22:         require(msg.sender == FORCE_DEPLOYER, "Can only be called by FORCE_DEPLOYER");
23: 
24:         require(_delegateTo.code.length > 0, "Delegatee is an EOA");
25:         (bool success, bytes memory returnData) = _delegateTo.delegatecall(_calldata); // <= FOUND
26:         assembly {
27:             if iszero(success) {
28:                 revert(add(returnData, 0x20), mload(returnData))
29:             }
30:         }
31:     }

```


</details>

## [Low-29] Use of abi.encodePacked with dynamic types inside keccak256

### Resolution 
Using abi.encodePacked with dynamic types for hashing functions like keccak256 can be risky due to the potential for hash collisions. This function concatenates arguments tightly, without padding, which might lead to different inputs producing the same hash. This is especially problematic with dynamic types, where the boundaries between inputs can blur. To mitigate this, use abi.encode instead. abi.encode pads its arguments to 32 bytes, creating clear distinctions between different inputs and significantly reducing the chance of hash collisions. This approach ensures more reliable and collision-resistant hashing, crucial for maintaining data integrity and security in smart contracts.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L142-L142)']
```solidity
142:         return keccak256(abi.encodePacked("\x19\x01", domainSeparator, structHash)); // <= FOUND

```


</details>

## [Low-30] Division in comparison

### Resolution 
To ensure accuracy in comparisons within programming, especially when dealing with integers, it's often more efficient to use multiplication rather than division. This approach stems from the fact that division operations are generally slower and more complex than multiplication. And in the context of solidity they can cause precision errors.

Suppose you want to compare if a/b is greater than c/d (where a, b, c, and d are integers). Instead of performing division, which is prone to precision errors, you can cross-multiply to avoid division. The comparison a/b > c/d is equivalent to a*d > b*c. This way, you only use multiplication, which is faster and avoids potential inaccuracies or complexities associated with division.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L30-L31)']
```solidity
30:         
31:         require(l2GasForTxBody / _transaction.gasPerPubdataByteLimit <= _priorityTxMaxPubdata, "uk"); // <= FOUND

```
['[56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L56-L57)']
```solidity
56:             require(
57:                 dictionary.length / 8 <= encodedData.length / 2, // <= FOUND
58:                 "Dictionary should have at most the same number of entries as the encoded data"
59:             );

```


</details>

## [Low-31] Contract contains payable functions but no withdraw/sweep function

### Resolution 
In smart contract development, particularly for Ethereum, having payable functions without a corresponding withdraw or sweep function can lead to potential issues. Payable functions allow the contract to receive Ether, but without a mechanism to withdraw these funds, the Ether can become locked within the contract indefinitely. This situation might be intentional in some cases (like a burn function), but generally, its a design oversight. A withdraw or sweep function is necessary to transfer Ether out of the contract to a specific address, typically the owner's or a designated recipient. Without this, the contract lacks flexibility in managing its funds, potentially leading to lost or inaccessible Ether.

Num of instances: 13

### Findings 


<details><summary>Click to show findings</summary>

['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L19-L19)']
```solidity
19: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard 

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30-L30)']
```solidity
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step 

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16-L16)']
```solidity
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step 

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L20-L20)']
```solidity
20: contract Governance is IGovernance, Ownable2Step 

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L10-L10)']
```solidity
10: contract DiamondProxy 

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L30-L30)']
```solidity
30: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox 

```
['[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L14-L14)']
```solidity
14: contract ComplexUpgrader is IComplexUpgrader 

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L22-L22)']
```solidity
22: contract Compressor is ICompressor, ISystemContract 

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L23-L23)']
```solidity
23: contract ContractDeployer is IContractDeployer, ISystemContract 

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L19-L19)']
```solidity
19: contract DefaultAccount is IAccount 

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L10-L10)']
```solidity
10: contract EmptyContract 

```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L15-L15)']
```solidity
15: contract GasBoundCaller 

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L10-L10)']
```solidity
10: contract ForceDeployUpgrader 

```


</details>

## [Low-32] State variables not capped at reasonable values

### Resolution 
Setting boundaries on state variables in smart contracts is essential for maintaining system integrity and user protection. Without caps on values, variables could reach extremes that exploit or disrupt contract functionality, leading to potential loss or unintended consequences for users. Implementing checks for minimum and maximum permissible values can prevent such issues, ensuring variables remain within a safe and reasonable range. This practice guards against attacks aimed at destabilizing the contract, such as griefing, where attackers intentionally cause distress by exploiting vulnerabilities. Proper validation promotes contract reliability, user trust, and a healthier ecosystem by mitigating risks associated with unbounded state changes.

Num of instances: 7

### Findings 


<details><summary>Click to show findings</summary>

['[251](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L251-L251)']
```solidity
249:     function updateDelay(uint256 _newDelay) external onlySelf {
250:         emit ChangeMinDelay(minDelay, _newDelay);
251:         minDelay = _newDelay; // <= FOUND
252:     }

```
['[148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L148-L148)']
```solidity
142:     function setNewVersionUpgrade(
143:         Diamond.DiamondCutData calldata _cutData,
144:         uint256 _oldProtocolVersion,
145:         uint256 _newProtocolVersion
146:     ) external onlyOwner {
147:         upgradeCutHash[_oldProtocolVersion] = keccak256(abi.encode(_cutData));
148:         protocolVersion = _newProtocolVersion; // <= FOUND
149:     }

```
['[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L85-L85)']
```solidity
84:     function setChainId(uint256 _newChainId) external onlyCallFromForceDeployer {
85:         chainId = _newChainId; // <= FOUND
86:     }

```
['[106](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L106-L106)']
```solidity
105:     function setGasPrice(uint256 _gasPrice) external onlyCallFromBootloader {
106:         gasPrice = _gasPrice; // <= FOUND
107:     }

```
['[463](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L463-L463)']
```solidity
444:     function setNewBatch(
445:         bytes32 _prevBatchHash,
446:         uint128 _newTimestamp,
447:         uint128 _expectedNewNumber,
448:         uint256 _baseFee
449:     ) external onlyCallFromBootloader {
450:         (uint128 previousBatchNumber, uint128 previousBatchTimestamp) = getBatchNumberAndTimestamp();
451:         require(_newTimestamp > previousBatchTimestamp, "Timestamps should be incremental");
452:         require(previousBatchNumber + 1 == _expectedNewNumber, "The provided block number is not correct");
453: 
454:         _ensureBatchConsistentWithL2Block(_newTimestamp);
455: 
456:         batchHashes[previousBatchNumber] = _prevBatchHash;
457: 
458:         
459:         BlockInfo memory newBlockInfo = BlockInfo({number: previousBatchNumber + 1, timestamp: _newTimestamp});
460: 
461:         currentBatchInfo = newBlockInfo;
462: 
463:         baseFee = _baseFee; // <= FOUND
464: 
465:         
466:         SystemContractHelper.toL1(false, bytes32(uint256(SystemLogKey.PREV_BATCH_HASH_KEY)), _prevBatchHash);
467:     }

```
['[271](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L271-L307)']
```solidity
263:     function _setVirtualBlock(
264:         uint128 _l2BlockNumber,
265:         uint128 _maxVirtualBlocksToCreate,
266:         uint128 _newTimestamp
267:     ) internal {
268:         if (virtualBlockUpgradeInfo.virtualBlockFinishL2Block != 0) {
269:             
270:             
271:             currentVirtualL2BlockInfo = currentL2BlockInfo; // <= FOUND
272:             return;
273:         }
274: 
275:         BlockInfo memory virtualBlockInfo = currentVirtualL2BlockInfo;
276: 
277:         if (currentVirtualL2BlockInfo.number == 0 && virtualBlockInfo.timestamp == 0) {
278:             uint128 currentBatchNumber = currentBatchInfo.number;
279: 
280:             
281:             
282:             
283:             virtualBlockInfo.number = currentBatchNumber;
284:             
285:             virtualBlockUpgradeInfo.virtualBlockStartBatch = currentBatchNumber;
286: 
287:             require(_maxVirtualBlocksToCreate > 0, "Can't initialize the first virtual block");
288:             _maxVirtualBlocksToCreate -= 1;
289:         } else if (_maxVirtualBlocksToCreate == 0) {
290:             
291:             
292:             return;
293:         }
294: 
295:         virtualBlockInfo.number += _maxVirtualBlocksToCreate;
296:         virtualBlockInfo.timestamp = _newTimestamp;
297: 
298:         
299:         
300:         
301:         
302:         if (virtualBlockInfo.number >= _l2BlockNumber) {
303:             virtualBlockUpgradeInfo.virtualBlockFinishL2Block = _l2BlockNumber;
304:             virtualBlockInfo.number = _l2BlockNumber;
305:         }
306: 
307:         currentVirtualL2BlockInfo = virtualBlockInfo; // <= FOUND
308:     }

```
['[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L114-L114)']
```solidity
112:     function setPubdataInfo(uint256 _gasPerPubdataByte, uint256 _basePubdataSpent) external onlyCallFromBootloader {
113:         basePubdataSpent = _basePubdataSpent;
114:         gasPerPubdataByte = _gasPerPubdataByte; // <= FOUND
115:     }

```


</details>

## [Low-33] Solidity file is susceptible to .selector-related optimizer bug due to the version used

### Resolution 
In Solidity versions prior to 0.8.21, a bug related to the .selector usage in optimizer settings could lead to incorrect code generation, where function evaluations using .selector might not execute as intended. This issue is classified as low-severity, mainly affecting uncommon code patterns where a function call is used instead of a direct contract name for selector lookup. Files using .selector with affected Solidity versions should be reviewed and updated to mitigate potential issues, ensuring contracts function correctly and securely.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[504](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L504-L509)']
```solidity
487:     function _parseL2WithdrawalMessage(
488:         uint256 _chainId,
489:         bytes memory _l2ToL1message
490:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {
491:         
492:         
493:         
494:         
495:         
496:         
497:         
498:         
499: 
500:         
501:         require(_l2ToL1message.length >= 56, "ShB wrong msg len"); 
502: 
503:         (uint32 functionSignature, uint256 offset) = UnsafeBytes.readUint32(_l2ToL1message, 0);
504:         if (bytes4(functionSignature) == IMailbox.finalizeEthWithdrawal.selector) { // <= FOUND
505:             
506:             (l1Receiver, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset);
507:             (amount, offset) = UnsafeBytes.readUint256(_l2ToL1message, offset);
508:             l1Token = bridgehub.baseToken(_chainId);
509:         } else if (bytes4(functionSignature) == IL1ERC20Bridge.finalizeWithdrawal.selector) { // <= FOUND
510:             
511: 
512:             
513: 
514:             
515:             
516:             
517:             require(_l2ToL1message.length == 76, "ShB wrong msg len 2");
518:             (l1Receiver, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset);
519:             (l1Token, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset);
520:             (amount, offset) = UnsafeBytes.readUint256(_l2ToL1message, offset);
521:         } else {
522:             revert("ShB Incorrect message function selector");
523:         }
524:     }

```
['[262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L262-L262)']
```solidity
239:     function createNewChain(
240:         uint256 _chainId,
241:         address _baseToken,
242:         address _sharedBridge,
243:         address _admin,
244:         bytes calldata _diamondCut
245:     ) external onlyBridgehub {
246:         if (stateTransition[_chainId] != address(0)) {
247:             
248:             return;
249:         }
250: 
251:         
252:         Diamond.DiamondCutData memory diamondCut = abi.decode(_diamondCut, (Diamond.DiamondCutData));
253: 
254:         
255:         bytes32 cutHashInput = keccak256(_diamondCut);
256:         require(cutHashInput == initialCutHash, "StateTransition: initial cutHash mismatch");
257: 
258:         
259:         bytes memory initData;
260:         
261:         initData = bytes.concat(
262:             IDiamondInit.initialize.selector, // <= FOUND
263:             bytes32(_chainId),
264:             bytes32(uint256(uint160(bridgehub))),
265:             bytes32(uint256(uint160(address(this)))),
266:             bytes32(uint256(protocolVersion)),
267:             bytes32(uint256(uint160(_admin))),
268:             bytes32(uint256(uint160(validatorTimelock))),
269:             bytes32(uint256(uint160(_baseToken))),
270:             bytes32(uint256(uint160(_sharedBridge))),
271:             bytes32(storedBatchZero),
272:             diamondCut.initCalldata
273:         );
274: 
275:         diamondCut.initCalldata = initData;
276:         
277:         DiamondProxy stateTransitionContract = new DiamondProxy{salt: bytes32(0)}(block.chainid, diamondCut);
278: 
279:         
280:         address stateTransitionAddress = address(stateTransitionContract);
281: 
282:         stateTransition[_chainId] = stateTransitionAddress;
283: 
284:         
285:         _setChainIdUpgrade(_chainId, stateTransitionAddress);
286: 
287:         emit StateTransitionNewChain(_chainId, stateTransitionAddress);
288:     }

```
['[168](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L168-L171)']
```solidity
163:     function isFacetFreezable(address _facet) external view returns (bool isFreezable) {
164:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage();
165: 
166:         
167:         
168:         uint256 selectorsArrayLen = ds.facetToSelectors[_facet].selectors.length; // <= FOUND
169:         if (selectorsArrayLen != 0) {
170:             bytes4 selector0 = ds.facetToSelectors[_facet].selectors[0]; // <= FOUND
171:             isFreezable = ds.selectorToFacet[selector0].isFreezable; // <= FOUND
172:         }
173:     }

```


</details>

## [Low-34] Large transfers may not work with some ERC20 tokens

### Resolution 
Large transfers with some ERC20 tokens may not work due to various reasons. Some tokens may have transfer restrictions built into the contract, such as daily transfer limits or maximum transfer sizes per transaction, to comply with regulatory requirements or to mitigate risks. Others may face issues with rounding errors when dealing with large quantities, especially if they have a high number of decimal places. Resolution involves carefully reading the token's contract to understand its constraints and behaviors and performing transfers accordingly. It may also be necessary to split large transfers into smaller increments if the token enforces specific transfer limits.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63-L67)']
```solidity
63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external { // <= FOUND
64:         require(msg.sender == address(sharedBridge), "Not shared bridge");
65:         uint256 amount = IERC20(_token).balanceOf(address(this));
66:         require(amount == _amount, "Incorrect amount");
67:         IERC20(_token).safeTransfer(address(sharedBridge), amount); // <= FOUND
68:     }

```
['[160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L160-L162)']
```solidity
160:     function _depositFundsToSharedBridge(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) { // <= FOUND
161:         uint256 balanceBefore = _token.balanceOf(address(sharedBridge));
162:         _token.safeTransferFrom(_from, address(sharedBridge), _amount); // <= FOUND
163:         uint256 balanceAfter = _token.balanceOf(address(sharedBridge));
164: 
165:         return balanceAfter - balanceBefore;
166:     }

```
['[173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L173-L175)']
```solidity
173:     function _depositFunds(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) { // <= FOUND
174:         uint256 balanceBefore = _token.balanceOf(address(this));
175:         _token.safeTransferFrom(_from, address(this), _amount); // <= FOUND
176:         uint256 balanceAfter = _token.balanceOf(address(this));
177: 
178:         return balanceAfter - balanceBefore;
179:     }

```


</details>

## [Low-35] Functions calling contracts/addresses with transfer hooks are missing reentrancy guards

### Resolution 
While adherence to the check-effects-interaction pattern is commendable, the absence of a reentrancy guard in functions, especially where transfer hooks might be present, can expose the protocol users to risks of read-only reentrancies. Such reentrancy vulnerabilities can be exploited to execute malicious actions even without altering the contract state. Without a reentrancy guard, the only potential mitigation would be to blocklist the entire protocol - an extreme and disruptive measure. Therefore, incorporating a reentrancy guard into these functions is vital to bolster security, as it helps protect against both traditional reentrancy attacks and read-only reentrancies, ensuring robust and safe protocol operations.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63-L67)']
```solidity
63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external { // <= FOUND
64:         require(msg.sender == address(sharedBridge), "Not shared bridge");
65:         uint256 amount = IERC20(_token).balanceOf(address(this));
66:         require(amount == _amount, "Incorrect amount");
67:         IERC20(_token).safeTransfer(address(sharedBridge), amount); // <= FOUND
68:     }

```
['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63-L67)']
```solidity
63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external {
64:         require(msg.sender == address(sharedBridge), "Not shared bridge");
65:         uint256 amount = IERC20(_token).balanceOf(address(this));
66:         require(amount == _amount, "Incorrect amount");
67:         IERC20(_token).safeTransfer(address(sharedBridge), amount); // <= FOUND
68:     }

```


</details>

## [NonCritical-1] Having chainId as a parameter can introduce cross chain replay attacks 

### Resolution 
Accepting chainId as a parameter in a Solidity contract could open up possibilities for cross-chain replay attacks. An attacker could execute a transaction on one chain, then 'replay' it on another chain where the contract has been deployed, leading to unintended consequences. It's crucial to get the chainId within the contract using `block.chainId` to ensure that the transactions are valid and specific to the chain the contract resides on. The `block.chainId` value is provided by the EVM and can be trusted, as it's difficult to manipulate and is unique to each Ethereum-based network. This enhances the security of cross-chain operations.

Num of instances: 37

### Findings 


<details><summary>Click to show findings</summary>

['[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L137-L137)']
```solidity
137:     function receiveEth(uint256 _chainId) external payable  // <= FOUND

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L142-L142)']
```solidity
142:     function initializeChainGovernance(uint256 _chainId, address _l2BridgeAddress) external onlyOwner  // <= FOUND

```
['[149](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L149-L153)']
```solidity
148:     function bridgehubDepositBaseToken(
149:         uint256 _chainId, // <= FOUND
150:         address _prevMsgSender,
151:         address _l1Token,
152:         uint256 _amount
153:     ) external payable virtual onlyBridgehubOrEra(_chainId)  // <= FOUND

```
['[183](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L183-L183)']
```solidity
182:     function bridgehubDeposit(
183:         uint256 _chainId, // <= FOUND
184:         address _prevMsgSender,
185:         uint256, 
186:         bytes calldata _data
187:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) 

```
['[233](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L233-L233)']
```solidity
232:     function bridgehubConfirmL2Transaction(
233:         uint256 _chainId, // <= FOUND
234:         bytes32 _txDataHash,
235:         bytes32 _txHash
236:     ) external override onlyBridgehub 

```
['[278](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L278-L278)']
```solidity
277:     function claimFailedDeposit(
278:         uint256 _chainId, // <= FOUND
279:         address _depositSender,
280:         address _l1Token,
281:         uint256 _amount,
282:         bytes32 _l2TxHash,
283:         uint256 _l2BatchNumber,
284:         uint256 _l2MessageIndex,
285:         uint16 _l2TxNumberInBatch,
286:         bytes32[] calldata _merkleProof
287:     ) external override 

```
['[305](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L305-L305)']
```solidity
303:     function _claimFailedDeposit(
304:         bool _checkedInLegacyBridge,
305:         uint256 _chainId, // <= FOUND
306:         address _depositSender,
307:         address _l1Token,
308:         uint256 _amount,
309:         bytes32 _l2TxHash,
310:         uint256 _l2BatchNumber,
311:         uint256 _l2MessageIndex,
312:         uint16 _l2TxNumberInBatch,
313:         bytes32[] calldata _merkleProof
314:     ) internal nonReentrant 

```
['[374](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L374-L374)']
```solidity
374:     function _isEraLegacyWithdrawal(uint256 _chainId, uint256 _l2BatchNumber) internal view returns (bool)  // <= FOUND

```
['[386](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L386-L386)']
```solidity
385:     function finalizeWithdrawal(
386:         uint256 _chainId, // <= FOUND
387:         uint256 _l2BatchNumber,
388:         uint256 _l2MessageIndex,
389:         uint16 _l2TxNumberInBatch,
390:         bytes calldata _message,
391:         bytes32[] calldata _merkleProof
392:     ) external override 

```
['[410](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L410-L410)']
```solidity
409:     function _finalizeWithdrawal(
410:         uint256 _chainId, // <= FOUND
411:         uint256 _l2BatchNumber,
412:         uint256 _l2MessageIndex,
413:         uint16 _l2TxNumberInBatch,
414:         bytes calldata _message,
415:         bytes32[] calldata _merkleProof
416:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount) 

```
['[459](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L459-L459)']
```solidity
458:     function _checkWithdrawal(
459:         uint256 _chainId, // <= FOUND
460:         MessageParams memory _messageParams,
461:         bytes calldata _message,
462:         bytes32[] calldata _merkleProof
463:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) 

```
['[488](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L488-L488)']
```solidity
487:     function _parseL2WithdrawalMessage(
488:         uint256 _chainId, // <= FOUND
489:         bytes memory _l2ToL1message
490:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) 

```
['[75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L75-L75)']
```solidity
75:     function getStateTransition(uint256 _chainId) public view returns (address)  // <= FOUND

```
['[115](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L115-L121)']
```solidity
114:     function createNewChain(
115:         uint256 _chainId, // <= FOUND
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, 
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId)  // <= FOUND

```
['[153](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L153-L153)']
```solidity
152:     function proveL2MessageInclusion(
153:         uint256 _chainId, // <= FOUND
154:         uint256 _batchNumber,
155:         uint256 _index,
156:         L2Message calldata _message,
157:         bytes32[] calldata _proof
158:     ) external view override returns (bool) 

```
['[165](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L165-L165)']
```solidity
164:     function proveL2LogInclusion(
165:         uint256 _chainId, // <= FOUND
166:         uint256 _batchNumber,
167:         uint256 _index,
168:         L2Log memory _log,
169:         bytes32[] calldata _proof
170:     ) external view override returns (bool) 

```
['[177](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L177-L177)']
```solidity
176:     function proveL1ToL2TransactionStatus(
177:         uint256 _chainId, // <= FOUND
178:         bytes32 _l2TxHash,
179:         uint256 _l2BatchNumber,
180:         uint256 _l2MessageIndex,
181:         uint16 _l2TxNumberInBatch,
182:         bytes32[] calldata _merkleProof,
183:         TxStatus _status
184:     ) external view override returns (bool) 

```
['[199](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L199-L199)']
```solidity
198:     function l2TransactionBaseCost(
199:         uint256 _chainId, // <= FOUND
200:         uint256 _gasPrice,
201:         uint256 _l2GasLimit,
202:         uint256 _l2GasPerPubdataByteLimit
203:     ) external view returns (uint256) 

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L74-L74)']
```solidity
74:     function getChainAdmin(uint256 _chainId) external view override returns (address)  // <= FOUND

```
['[160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L160-L160)']
```solidity
160:     function freezeChain(uint256 _chainId) external onlyOwner  // <= FOUND

```
['[165](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L165-L165)']
```solidity
165:     function unfreezeChain(uint256 _chainId) external onlyOwner  // <= FOUND

```
['[170](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L170-L170)']
```solidity
170:     function revertBatches(uint256 _chainId, uint256 _newLastBatch) external onlyOwnerOrAdmin  // <= FOUND

```
['[177](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L177-L177)']
```solidity
177:     function _setChainIdUpgrade(uint256 _chainId, address _chainContract) internal  // <= FOUND

```
['[231](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L231-L231)']
```solidity
230:     function registerAlreadyDeployedStateTransition(
231:         uint256 _chainId, // <= FOUND
232:         address _stateTransitionContract
233:     ) external onlyOwner 

```
['[240](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L240-L240)']
```solidity
239:     function createNewChain(
240:         uint256 _chainId, // <= FOUND
241:         address _baseToken,
242:         address _sharedBridge,
243:         address _admin,
244:         bytes calldata _diamondCut
245:     ) external onlyBridgehub 

```
['[78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L78-L78)']
```solidity
78:     function addValidator(uint256 _chainId, address _newValidator) external onlyChainAdmin(_chainId)  // <= FOUND

```
['[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L87-L87)']
```solidity
87:     function removeValidator(uint256 _chainId, address _validator) external onlyChainAdmin(_chainId)  // <= FOUND

```
['[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L102-L102)']
```solidity
102:     function getCommittedBatchTimestamp(uint256 _chainId, uint256 _l2BatchNumber) external view returns (uint256)  // <= FOUND

```
['[127](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L127-L130)']
```solidity
126:     function commitBatchesSharedBridge(
127:         uint256 _chainId, // <= FOUND
128:         StoredBatchInfo calldata,
129:         CommitBatchInfo[] calldata _newBatchesData
130:     ) external onlyValidator(_chainId)  // <= FOUND

```
['[153](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L153-L153)']
```solidity
153:     function revertBatchesSharedBridge(uint256 _chainId, uint256) external onlyValidator(_chainId)  // <= FOUND

```
['[172](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L172-L176)']
```solidity
171:     function proveBatchesSharedBridge(
172:         uint256 _chainId, // <= FOUND
173:         StoredBatchInfo calldata,
174:         StoredBatchInfo[] calldata,
175:         ProofInput calldata
176:     ) external onlyValidator(_chainId)  // <= FOUND

```
['[204](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L204-L206)']
```solidity
203:     function executeBatchesSharedBridge(
204:         uint256 _chainId, // <= FOUND
205:         StoredBatchInfo[] calldata _newBatchesData
206:     ) external onlyValidator(_chainId)  // <= FOUND

```
['[225](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L225-L225)']
```solidity
225:     function _propagateToZkSyncStateTransition(uint256 _chainId) internal  // <= FOUND

```
[]
```solidity
58: all

```
[]
```solidity
58: all

```
[]
```solidity
58: all

```
[]
```solidity
58: all

```


</details>

## [NonCritical-2] Some if-statement can be converted to a ternary 

### Resolution 
Improving code readability and compactness is an integral part of optimal programming practices. The use of ternary operators in place of if-else conditions is one such measure. Ternary operators allow us to write conditional statements in a more concise manner, thereby enhancing readability and simplicity. They follow the syntax `condition ? exprIfTrue : exprIfFalse`, which interprets as "if the condition is true, evaluate to `exprIfTrue`, else evaluate to `exprIfFalse`". By adopting this approach, we make our code more streamlined and intuitive, which could potentially aid in better understanding and maintenance of the codebase.

Num of instances: 51

### Findings 


<details><summary>Click to show findings</summary>

['[164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L164-L165)']
```solidity
164:         if (!hyperbridgingEnabled[_chainId]) {
165:             chainBalance[_chainId][_l1Token] += _amount; // <= FOUND
166:         }

```
['[211](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L211-L212)']
```solidity
211:         if (!hyperbridgingEnabled[_chainId]) {
212:             chainBalance[_chainId][_l1Token] += amount; // <= FOUND
213:         }

```
['[567](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L567-L568)']
```solidity
567:         if (!hyperbridgingEnabled[ERA_CHAIN_ID]) {
568:             chainBalance[ERA_CHAIN_ID][_l1Token] += _amount; // <= FOUND
569:         }

```
['[578](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L578-L579)']
```solidity
578:             if (_refundRecipient == address(0)) {
579:                 refundRecipient = _prevMsgSender != tx.origin // <= FOUND
580:                     ? AddressAliasHelper.applyL1ToL2Alias(_prevMsgSender)
581:                     : _prevMsgSender;
582:             }

```
['[326](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L326-L328)']
```solidity
326:        if (_refundRecipient == address(0)) {
327:             
328:             _recipient = msg.sender == tx.origin ? msg.sender : AddressAliasHelper.applyL1ToL2Alias(msg.sender); // <= FOUND
329:         }

```
['[485](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L485-L486)']
```solidity
485:         if (_newLastBatch < s.totalBatchesVerified) {
486:             s.totalBatchesVerified = _newLastBatch; // <= FOUND
487:         }

```
['[162](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L162-L163)']
```solidity
162:         if (feeParams.pubdataPricingMode == PubdataPricingMode.Rollup) {
163:             pubdataPriceBaseToken = L1_GAS_PER_PUBDATA_BYTE * l1GasPriceConverted; // <= FOUND
164:         }

```
['[234](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L234-L235)']
```solidity
234:         if (l2Sender != tx.origin) {
235:             l2Sender = AddressAliasHelper.applyL1ToL2Alias(_request.sender); // <= FOUND
236:         }

```
['[277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L277-L278)']
```solidity
277:         if (refundRecipient.code.length > 0) {
278:             refundRecipient = AddressAliasHelper.applyL1ToL2Alias(refundRecipient); // <= FOUND
279:         }

```
['[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L102-L103)']
```solidity
102:         if (codeHash == 0x00 && NONCE_HOLDER_SYSTEM_CONTRACT.getRawNonce(account) > 0) {
103:             codeHash = EMPTY_STRING_KECCAK; // <= FOUND
104:         }

```
['[131](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L131-L136)']
```solidity
131:         if (
132:             uint160(account) > CURRENT_MAX_PRECOMPILE_ADDRESS &&
133:             codeHash != 0x00 &&
134:             !Utils.isContractConstructing(codeHash)
135:         ) {
136:             codeSize = Utils.bytecodeLenInBytes(codeHash); // <= FOUND
137:         }

```
['[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L69-L71)']
```solidity
69:             if (txDataLen != 1) {
70:                 
71:                 encodedDataLength = RLPEncoder.encodeNonSingleBytesLen(txDataLen); // <= FOUND
72:             }

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L96-L97)']
```solidity
96:             if (_transaction.reserved[0] != 0) {
97:                 vInt += 8 + block.chainid * 2; // <= FOUND
98:             }

```
['[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L102-L103)']
```solidity
102:         if (_isValidSignature(txHash, _transaction.signature)) {
103:             magic = ACCOUNT_VALIDATION_SUCCESS_MAGIC; // <= FOUND
104:         }

```
['[144](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L144-L145)']
```solidity
144:         if (blockNumber <= _block || blockNumber - _block > 256) {
145:             hash = bytes32(0); // <= FOUND
146:         }

```
['[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L101-L102)']
```solidity
101:        if (_transaction.txType == LEGACY_TX_TYPE) {
102:             resultHash = _encodeHashLegacyTransaction(_transaction); // <= FOUND
103:         }

```
['[406](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L406-L408)']
```solidity
406:        if (address(uint160(_transaction.paymaster)) != address(0)) {
407:             
408:             requiredBalance = _transaction.value; // <= FOUND
409:         }

```
['[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L102-L103)']
```solidity
102:             if (_number > type(uint8).max) {
103:                 hbs += 1; // <= FOUND
104:             }

```
['[154](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L154-L155)']
```solidity
154:        if (_l1Token == ETH_TOKEN_ADDRESS) { // <= FOUND
155:             require(msg.value == _amount, "L1SharedBridge: msg.value not equal to amount"); // <= FOUND
156:         }

```
['[164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L164-L164)']
```solidity
164:         if (!hyperbridgingEnabled[_chainId]) { // <= FOUND
165:             chainBalance[_chainId][_l1Token] += _amount;
166:         }

```
['[211](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L211-L211)']
```solidity
211:         if (!hyperbridgingEnabled[_chainId]) { // <= FOUND
212:             chainBalance[_chainId][_l1Token] += amount;
213:         }

```
['[395](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L395-L396)']
```solidity
395:         if (_isEraLegacyWithdrawal(_chainId, _l2BatchNumber)) { // <= FOUND
396:             require(!legacyBridge.isWithdrawalFinalized(_l2BatchNumber, _l2MessageIndex), "ShB: legacy withdrawal"); // <= FOUND
397:         }

```
['[567](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L567-L567)']
```solidity
567:         if (!hyperbridgingEnabled[ERA_CHAIN_ID]) { // <= FOUND
568:             chainBalance[ERA_CHAIN_ID][_l1Token] += _amount;
569:         }

```
['[107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L107-L107)']
```solidity
107:         if (timestamp == 0) { // <= FOUND
108:             return OperationState.Unset;
109:         }

```
['[246](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L246-L246)']
```solidity
246:        if (stateTransition[_chainId] != address(0)) { // <= FOUND
247:             
248:             return;
249:         }

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L79-L80)']
```solidity
79:        if (validators[_chainId][_newValidator]) { // <= FOUND
80:             revert AddressAlreadyValidator(_chainId); // <= FOUND
81:         }

```
['[88](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L88-L89)']
```solidity
88:        if (!validators[_chainId][_validator]) { // <= FOUND
89:             revert ValidatorDoesNotExist(_chainId); // <= FOUND
90:         }

```
['[191](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L191-L192)']
```solidity
191:         if (_expectedSystemContractUpgradeTxHash == bytes32(0)) { // <= FOUND
192:             require(processedLogs == 511, "b7"); // <= FOUND
193:         }

```
['[429](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L429-L430)']
```solidity
429:         if (_proof.serializedProof.length > 0) { // <= FOUND
430:             _verifyProof(proofPublicInput, _proof); // <= FOUND
431:         }

```
['[492](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L492-L492)']
```solidity
492:         if (s.l2SystemContractsUpgradeBatchNumber > _newLastBatch) { // <= FOUND
493:             delete s.l2SystemContractsUpgradeBatchNumber;
494:         }

```
['[93](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L93-L93)']
```solidity
93:        if (_l2DefaultAccountBytecodeHash == bytes32(0)) { // <= FOUND
94:             return;
95:         }

```
['[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L110-L110)']
```solidity
110:        if (_l2BootloaderBytecodeHash == bytes32(0)) { // <= FOUND
111:             return;
112:         }

```
['[131](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L131-L131)']
```solidity
131:         if (_newVerifier == IVerifier(address(0))) { // <= FOUND
132:             return;
133:         }

```
['[186](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L186-L187)']
```solidity
186:         if (_l2ProtocolUpgradeTx.txType == 0) { // <= FOUND
187:             return bytes32(0); // <= FOUND
188:         }

```
['[250](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L250-L251)']
```solidity
250:         if (lastSelectorPosition == 0) { // <= FOUND
251:             _removeFacet(_facet); // <= FOUND
252:         }

```
['[279](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L279-L280)']
```solidity
279:        if (_init == address(0)) { // <= FOUND
280:             require(_calldata.length == 0, "H");  // <= FOUND
281:         }

```
['[93](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L93-L93)']
```solidity
93:         if (uint160(account) <= CURRENT_MAX_PRECOMPILE_ADDRESS) { // <= FOUND
94:             return EMPTY_STRING_KECCAK;
95:         }

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L96-L96)']
```solidity
96:             if (_transaction.reserved[0] != 0) { // <= FOUND
97:                 vInt += 8 + block.chainid * 2;
98:             }

```
['[42](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L42-L42)']
```solidity
42:         if (info.supportedAAVersion != AccountAbstractionVersion.None) { // <= FOUND
43:             return info.supportedAAVersion;
44:         }

```
['[150](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L150-L151)']
```solidity
150:         if (!success) { // <= FOUND
151:             EfficientCall.propagateRevert(); // <= FOUND
152:         }

```
['[73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L73-L76)']
```solidity
73:         if (pubdataCost != 0) { // <= FOUND
74:             
75:             
76:             require(pubdataAllowance + gasleft() >= pubdataCost + CALL_RETURN_OVERHEAD, "Not enough gas for pubdata"); // <= FOUND
77:         }

```
['[131](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L131-L132)']
```solidity
131:         if (isConstructorCall) { // <= FOUND
132:             farCallAbiWithEmptyFatPtr |= (1 << 240); // <= FOUND
133:         }

```
['[134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L134-L135)']
```solidity
134:         if (isSystemCall) { // <= FOUND
135:             farCallAbiWithEmptyFatPtr |= (1 << 248); // <= FOUND
136:         }

```
['[354](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L354-L358)']
```solidity
354:         if (_l1Token == ETH_TOKEN_ADDRESS) { // <= FOUND
355:             bool callSuccess;
356:             
357:             assembly {
358:                 callSuccess := call(gas(), _depositSender, _amount, 0, 0, 0, 0) // <= FOUND
359:             }

```
['[443](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L443-L447)']
```solidity
443:         if (l1Token == ETH_TOKEN_ADDRESS) { // <= FOUND
444:             bool callSuccess;
445:             
446:             assembly {
447:                 callSuccess := call(gas(), l1Receiver, amount, 0, 0, 0, 0) // <= FOUND
448:             }

```
['[222](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L222-L223)']
```solidity
222:            if (token == ETH_TOKEN_ADDRESS) { // <= FOUND
223:                 require(msg.value == _request.mintValue, "Bridgehub: msg.value mismatch 1"); // <= FOUND
224:             }

```
['[286](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L286-L287)']
```solidity
286:                 if (data.length <= 4) { // <= FOUND
287:                     revert("I");  // <= FOUND
288:                 }

```
['[332](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L332-L333)']
```solidity
332:             if (value > 0) { // <= FOUND
333:                 BASE_TOKEN_SYSTEM_CONTRACT.transferFromTo(address(this), _newAddress, value); // <= FOUND
334:             }

```
['[339](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L339-L341)']
```solidity
339:             if (value > 0) { // <= FOUND
340:                 
341:                 SystemContractHelper.setValueForNextFarCall(uint128(value)); // <= FOUND
342:             }

```
['[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L50-L51)']
```solidity
50:            if (_shouldSendToL1) { // <= FOUND
51:                 L1_MESSENGER_CONTRACT.requestBytecodeL1Publication(_bytecodeHash); // <= FOUND
52:             }

```
['[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L102-L102)']
```solidity
102:             if (_number > type(uint8).max) { // <= FOUND
103:                 hbs += 1;
104:             }

```


</details>

## [NonCritical-3] Subtraction may underflow if multiplication is too large 

### Resolution 
In arithmetic operations involving subtraction and multiplication, an underflow may occur if a subtraction result is negative, or if a multiplication result exceeds the maximum value representable in the data type. For instance, if a large multiplication precedes a subtraction, it may create a value too large to subtract from, causing an underflow. This could lead to unexpected and incorrect results in the calculation.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[251](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L251-L253)']
```solidity
251:     function _sliceToUint256(bytes calldata _calldataSlice) internal pure returns (uint256 number) { // <= FOUND
252:         number = uint256(bytes32(_calldataSlice));
253:         number >>= (256 - (_calldataSlice.length * 8)); // <= FOUND
254:     }

```


</details>

## [NonCritical-4] Events may be emitted out of order due to code not follow the best practice of check-effects-interaction 

### Resolution 
The "check-effects-interaction" pattern also impacts event ordering. When a contract doesn't adhere to this pattern, events might be emitted in a sequence that doesn't reflect the actual logical flow of operations. This can cause confusion during event tracking, potentially leading to erroneous off-chain interpretations. To rectify this, always ensure that checks are performed first, state modifications come next, and interactions with external contracts or addresses are done last. This will ensure events are emitted in a logical, consistent manner, providing a clear and accurate chronological record of on-chain actions for off-chain systems and observers.

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L303-L367)']
```solidity
303:     function _claimFailedDeposit(
304:         bool _checkedInLegacyBridge,
305:         uint256 _chainId,
306:         address _depositSender,
307:         address _l1Token,
308:         uint256 _amount,
309:         bytes32 _l2TxHash,
310:         uint256 _l2BatchNumber,
311:         uint256 _l2MessageIndex,
312:         uint16 _l2TxNumberInBatch,
313:         bytes32[] calldata _merkleProof
314:     ) internal nonReentrant {
315:         {
316:             bool proofValid = bridgehub.proveL1ToL2TransactionStatus(
317:                 _chainId,
318:                 _l2TxHash,
319:                 _l2BatchNumber,
320:                 _l2MessageIndex,
321:                 _l2TxNumberInBatch,
322:                 _merkleProof,
323:                 TxStatus.Failure
324:             );
325:             require(proofValid, "yn");
326:         }
327:         require(_amount > 0, "y1");
328: 
329:         {
330:             bool notCheckedInLegacyBridgeOrWeCanCheckDeposit;
331:             {
332:                 
333:                 bool weCanCheckDepositHere = !_isEraLegacyWithdrawal(_chainId, _l2BatchNumber);
334:                 
335:                 
336:                 
337:                 notCheckedInLegacyBridgeOrWeCanCheckDeposit = (!_checkedInLegacyBridge) || weCanCheckDepositHere;
338:             }
339:             if (notCheckedInLegacyBridgeOrWeCanCheckDeposit) {
340:                 bytes32 dataHash = depositHappened[_chainId][_l2TxHash];
341:                 bytes32 txDataHash = keccak256(abi.encode(_depositSender, _l1Token, _amount));
342:                 require(dataHash == txDataHash, "ShB: d.it not hap");
343:                 delete depositHappened[_chainId][_l2TxHash];
344:             }
345:         }
346: 
347:         if (!hyperbridgingEnabled[_chainId]) {
348:             
349:             require(chainBalance[_chainId][_l1Token] >= _amount, "ShB n funds");
350:             chainBalance[_chainId][_l1Token] -= _amount;
351:         }
352: 
353:         
354:         if (_l1Token == ETH_TOKEN_ADDRESS) {
355:             bool callSuccess;
356:             
357:             assembly {
358:                 callSuccess := call(gas(), _depositSender, _amount, 0, 0, 0, 0)
359:             }
360:             require(callSuccess, "ShB: claimFailedDeposit failed");
361:         } else {
362:             IERC20(_l1Token).safeTransfer(_depositSender, _amount); // <= FOUND
363:             
364:             
365:         }
366: 
367:         emit ClaimedFailedDepositSharedBridge(_chainId, _depositSender, _l1Token, _amount); // <= FOUND
368:     }

```
['[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L145)']
```solidity
114:     function createNewChain(
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, 
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {
122:         require(_chainId != 0, "Bridgehub: chainId cannot be 0");
123:         require(_chainId <= type(uint48).max, "Bridgehub: chainId too large");
124: 
125:         require(
126:             stateTransitionManagerIsRegistered[_stateTransitionManager],
127:             "Bridgehub: state transition not registered"
128:         );
129:         require(tokenIsRegistered[_baseToken], "Bridgehub: token not registered");
130:         require(address(sharedBridge) != address(0), "Bridgehub: weth bridge not set");
131: 
132:         require(stateTransitionManager[_chainId] == address(0), "Bridgehub: chainId already registered");
133: 
134:         stateTransitionManager[_chainId] = _stateTransitionManager;
135:         baseToken[_chainId] = _baseToken;
136: 
137:         IStateTransitionManager(_stateTransitionManager).createNewChain( // <= FOUND
138:             _chainId,
139:             _baseToken,
140:             address(sharedBridge),
141:             _admin,
142:             _initData
143:         );
144: 
145:         emit NewChain(_chainId, _stateTransitionManager, _admin); // <= FOUND
146:         return _chainId;
147:     }

```
['[177](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L177-L227)']
```solidity
177:     function _setChainIdUpgrade(uint256 _chainId, address _chainContract) internal { // <= FOUND
178:         bytes memory systemContextCalldata = abi.encodeCall(ISystemContext.setChainId, (_chainId));
179:         uint256[] memory uintEmptyArray;
180:         bytes[] memory bytesEmptyArray;
181: 
182:         L2CanonicalTransaction memory l2ProtocolUpgradeTx = L2CanonicalTransaction({
183:             txType: SYSTEM_UPGRADE_L2_TX_TYPE,
184:             from: uint256(uint160(L2_FORCE_DEPLOYER_ADDR)),
185:             to: uint256(uint160(L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR)),
186:             gasLimit: $(PRIORITY_TX_MAX_GAS_LIMIT),
187:             gasPerPubdataByteLimit: REQUIRED_L2_GAS_PRICE_PER_PUBDATA,
188:             maxFeePerGas: uint256(0),
189:             maxPriorityFeePerGas: uint256(0),
190:             paymaster: uint256(0),
191:             
192:             nonce: protocolVersion,
193:             value: 0,
194:             reserved: [uint256(0), 0, 0, 0],
195:             data: systemContextCalldata,
196:             signature: new bytes(0),
197:             factoryDeps: uintEmptyArray,
198:             paymasterInput: new bytes(0),
199:             reservedDynamic: new bytes(0)
200:         });
201: 
202:         ProposedUpgrade memory proposedUpgrade = ProposedUpgrade({
203:             l2ProtocolUpgradeTx: l2ProtocolUpgradeTx,
204:             factoryDeps: bytesEmptyArray,
205:             bootloaderHash: bytes32(0),
206:             defaultAccountHash: bytes32(0),
207:             verifier: address(0),
208:             verifierParams: VerifierParams({
209:                 recursionNodeLevelVkHash: bytes32(0),
210:                 recursionLeafLevelVkHash: bytes32(0),
211:                 recursionCircuitsSetVksHash: bytes32(0)
212:             }),
213:             l1ContractsUpgradeCalldata: new bytes(0),
214:             postUpgradeCalldata: new bytes(0),
215:             upgradeTimestamp: 0,
216:             newProtocolVersion: protocolVersion
217:         });
218: 
219:         Diamond.FacetCut[] memory emptyArray;
220:         Diamond.DiamondCutData memory cutData = Diamond.DiamondCutData({
221:             facetCuts: emptyArray,
222:             initAddress: genesisUpgrade,
223:             initCalldata: abi.encodeCall(IDefaultUpgrade.upgrade, (proposedUpgrade))
224:         });
225: 
226:         IAdmin(_chainContract).executeUpgrade(cutData); // <= FOUND
227:         emit SetChainIdUpgrade(_chainContract, l2ProtocolUpgradeTx, protocolVersion); // <= FOUND
228:     }

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L79-L105)']
```solidity
79:     function finalizeDeposit(
80:         address _l1Sender,
81:         address _l2Receiver,
82:         address _l1Token,
83:         uint256 _amount,
84:         bytes calldata _data
85:     ) external payable override {
86:         
87:         require(
88:             AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1Bridge ||
89:                 AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1LegacyBridge,
90:             "mq"
91:         );
92:         require(msg.value == 0, "Value should be 0 for ERC20 bridge");
93: 
94:         address expectedL2Token = l2TokenAddress(_l1Token);
95:         address currentL1Token = l1TokenAddress[expectedL2Token];
96:         if (currentL1Token == address(0)) {
97:             address deployedToken = _deployL2Token(_l1Token, _data);
98:             require(deployedToken == expectedL2Token, "mt");
99:             l1TokenAddress[expectedL2Token] = _l1Token;
100:         } else {
101:             require(currentL1Token == _l1Token, "gg"); 
102:         }
103: 
104:         IL2StandardToken(expectedL2Token).bridgeMint(_l2Receiver, _amount); // <= FOUND
105:         emit FinalizeDeposit(_l1Sender, _l2Receiver, expectedL2Token, _amount); // <= FOUND
106:     }

```
['[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L123-L134)']
```solidity
123:     function withdraw(address _l1Receiver, address _l2Token, uint256 _amount) external override { // <= FOUND
124:         require(_amount > 0, "Amount cannot be zero");
125: 
126:         IL2StandardToken(_l2Token).bridgeBurn(msg.sender, _amount); // <= FOUND
127: 
128:         address l1Token = l1TokenAddress[_l2Token];
129:         require(l1Token != address(0), "yh");
130: 
131:         bytes memory message = _getL1WithdrawMessage(_l1Receiver, l1Token, _amount);
132:         L2ContractHelper.sendMessageToL1(message);
133: 
134:         emit WithdrawalInitiated(msg.sender, _l1Receiver, _l2Token, _amount); // <= FOUND
135:     }

```
['[111](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L111-L126)']
```solidity
111:     function reinitializeToken(
112:         ERC20Getters calldata _availableGetters,
113:         string memory _newName,
114:         string memory _newSymbol,
115:         uint8 _version
116:     ) external onlyNextVersion(_version) reinitializer(_version) {
117:         
118:         
119:         address beaconAddress = _getBeacon();
120:         require(msg.sender == UpgradeableBeacon(beaconAddress).owner(), "tt"); // <= FOUND
121: 
122:         __ERC20_init_unchained(_newName, _newSymbol);
123:         __ERC20Permit_init(_newName);
124:         availableGetters = _availableGetters;
125: 
126:         emit BridgeInitialize(l1Address, _newName, _newSymbol, decimals_); // <= FOUND
127:     }

```


</details>

## [NonCritical-5] Superfluous parameter can only be one value 

### Resolution 
Using redundant parameters in smart contracts can lead to unnecessary complexity and potential vulnerabilities. When a function parameter is always constrained to a specific value due to an `if` or `require` statement, it renders the parameter superfluous. Including such parameters can be misleading to developers or users, suggesting a flexibility that doesn't exist in reality. Additionally, unnecessary parameters increase the gas cost for transactions. Resolution: Analyze the contract to identify parameters that are rendered static by conditional checks. Remove these parameters from the function signature and update the function logic accordingly. This simplifies the code, reduces gas costs, and enhances clarity and security.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[239](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L239-L240)']
```solidity
239:     function _checkPredecessorDone(bytes32 _predecessorId) internal view { // <= FOUND
240:         require(_predecessorId == bytes32(0) || isOperationDone(_predecessorId), "Predecessor operation not completed"); // <= FOUND
241:     }

```


</details>

## [NonCritical-6] Tautology when checking address value 

### Resolution 
In the condition `if (msg.sender == owner && msg.sender != poolAddress)`, if `owner` and `poolAddress` are ever the same, the condition becomes tautological for that particular state. Essentially, it becomes: if `msg.sender` is this address, then it can't be the same address, which is logically inconsistent. This redundancy could obfuscate the real intent or mask underlying vulnerabilities. **Resolution**: Ensure clarity in conditions. If `owner` and `poolAddress` can ever be the same, reevaluate the logic. Consider separating the conditions or adding clarifying comments. Regular code reviews can identify and rectify such logical inconsistencies.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[159](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L159-L188)']
```solidity
159:     function _isValidSignature(bytes32 _hash, bytes memory _signature) internal view returns (bool) { // <= FOUND
160:         require(_signature.length == 65, "Signature length is incorrect");
161:         uint8 v;
162:         bytes32 r;
163:         bytes32 s;
164:         
165:         
166:         
167:         
168:         assembly {
169:             r := mload(add(_signature, 0x20))
170:             s := mload(add(_signature, 0x40))
171:             v := and(mload(add(_signature, 0x41)), 0xff)
172:         }
173:         require(v == 27 || v == 28, "v is neither 27 nor 28");
174: 
175:         
176:         
177:         
178:         
179:         
180:         
181:         
182:         
183:         
184:         require(uint256(s) <= 0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF5D576E7357A4501DDFE92F46681B20A0, "Invalid s");
185: 
186:         address recoveredAddress = ecrecover(_hash, v, r, s);
187: 
188:         return recoveredAddress == address(this) && recoveredAddress != address(0); // <= FOUND
189:     }

```


</details>

## [NonCritical-7] Unnecessary struct attribute prefix 

### Resolution 
In struct definitions, using redundant prefixes for attributes is unnecessary. For instance, in a struct named Employee, attributes like employeeName, employeeID, and employeeEmail can be simplified to name, ID, and email respectively, since they are already inherently associated with Employee. By removing these repetitive prefixes, the code becomes more concise and easier to read, maintaining its contextual clarity.

Num of instances: 7

### Findings 


<details><summary>Click to show findings</summary>

['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L10-L17)']
```solidity
10: struct L2TransactionRequestDirect {
11:     uint256 chainId;
12:     uint256 mintValue;
13:     address l2Contract; // <= FOUND
14:     uint256 l2Value; // <= FOUND
15:     bytes l2Calldata; // <= FOUND
16:     uint256 l2GasLimit; // <= FOUND
17:     uint256 l2GasPerPubdataByteLimit; // <= FOUND
18:     bytes[] factoryDeps;
19:     address refundRecipient;
20: }

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L22-L27)']
```solidity
22: struct L2TransactionRequestTwoBridgesOuter {
23:     uint256 chainId;
24:     uint256 mintValue;
25:     uint256 l2Value; // <= FOUND
26:     uint256 l2GasLimit; // <= FOUND
27:     uint256 l2GasPerPubdataByteLimit; // <= FOUND
28:     address refundRecipient;
29:     address secondBridgeAddress;
30:     uint256 secondBridgeValue;
31:     bytes secondBridgeCalldata;
32: }

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L34-L37)']
```solidity
34: struct L2TransactionRequestTwoBridgesInner {
35:     bytes32 magicValue;
36:     address l2Contract; // <= FOUND
37:     bytes l2Calldata; // <= FOUND
38:     bytes[] factoryDeps;
39:     bytes32 txDataHash;
40: }

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Messaging.sol#L23-L24)']
```solidity
23: struct L2Log {
24:     uint8 l2ShardId; // <= FOUND
25:     bool isService;
26:     uint16 txNumberInBatch;
27:     address sender;
28:     bytes32 key;
29:     bytes32 value;
30: }

```
['[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L14-L15)']
```solidity
14: struct L2ToL1Log {
15:     uint8 l2ShardId; // <= FOUND
16:     bool isService;
17:     uint16 txNumberInBlock;
18:     address sender;
19:     bytes32 key;
20:     bytes32 value;
21: }

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L30-L32)']
```solidity
30:     struct SelectorToFacet {
31:         address facetAddress; // <= FOUND
32:         uint16 selectorPosition; // <= FOUND
33:         bool isFreezable;
34:     }

```
['[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L39-L41)']
```solidity
39:     struct FacetToSelectors {
40:         bytes4[] selectors; // <= FOUND
41:         uint16 facetPosition; // <= FOUND
42:     }

```


</details>

## [NonCritical-8] Contracts should have all public/external functions exposed by interfaces 

### Resolution 
Contracts should expose all public and external functions through interfaces. This practice ensures a clear and consistent definition of how the contract can be interacted with, promoting better transparency and integration.

Num of instances: 183

### Findings 


<details><summary>Click to show findings</summary>

['[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L60-L60)']
```solidity
60:     function initialize() external reentrancyGuardInitializer 

```
['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63-L63)']
```solidity
63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external 

```
['[75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L75-L75)']
```solidity
75:     function l2TokenAddress(address _l1Token) external view returns (address) 

```
['[98](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L98-L98)']
```solidity
98:     function deposit(
99:         address _l2Receiver,
100:         address _l1Token,
101:         uint256 _amount,
102:         uint256 _l2TxGasLimit,
103:         uint256 _l2TxGasPerPubdataByte
104:     ) external payable returns (bytes32 l2TxHash) 

```
['[176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L176-L176)']
```solidity
176:     function claimFailedDeposit(
177:         address _depositSender,
178:         address _l1Token,
179:         bytes32 _l2TxHash,
180:         uint256 _l2BatchNumber,
181:         uint256 _l2MessageIndex,
182:         uint16 _l2TxNumberInBatch,
183:         bytes32[] calldata _merkleProof
184:     ) external nonReentrant 

```
['[208](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L208-L208)']
```solidity
208:     function finalizeWithdrawal(
209:         uint256 _l2BatchNumber,
210:         uint256 _l2MessageIndex,
211:         uint16 _l2TxNumberInBatch,
212:         bytes calldata _message,
213:         bytes32[] calldata _merkleProof
214:     ) external nonReentrant 

```
['[104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L104-L104)']
```solidity
104:     function initialize(
105:         address _owner,
106:         uint256 _eraFirstPostUpgradeBatch
107:     ) external reentrancyGuardInitializer initializer 

```
['[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L116-L116)']
```solidity
116:     function transferFundsFromLegacy(address _token, address _target, uint256 _targetChainId) external onlyOwner 

```
['[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L137-L137)']
```solidity
137:     function receiveEth(uint256 _chainId) external payable 

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L142-L142)']
```solidity
142:     function initializeChainGovernance(uint256 _chainId, address _l2BridgeAddress) external onlyOwner 

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L41-L41)']
```solidity
41:     function initialize(address _owner) external reentrancyGuardInitializer 

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin 

```
['[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L60-L60)']
```solidity
60:     function acceptAdmin() external 

```
['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L82-L82)']
```solidity
82:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner 

```
['[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L92-L92)']
```solidity
92:     function removeStateTransitionManager(address _stateTransitionManager) external onlyOwner 

```
['[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L101-L101)']
```solidity
101:     function addToken(address _token) external onlyOwner 

```
['[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108-L108)']
```solidity
108:     function setSharedBridge(address _sharedBridge) external onlyOwner 

```
['[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L114)']
```solidity
114:     function createNewChain(
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, 
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) 

```
['[198](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L198-L198)']
```solidity
198:     function l2TransactionBaseCost(
199:         uint256 _chainId,
200:         uint256 _gasPrice,
201:         uint256 _l2GasLimit,
202:         uint256 _l2GasPerPubdataByteLimit
203:     ) external view returns (uint256) 

```
['[129](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L129-L129)']
```solidity
129:     function scheduleTransparent(Operation calldata _operation, uint256 _delay) external onlyOwner 

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L142-L142)']
```solidity
142:     function scheduleShadow(bytes32 _id, uint256 _delay) external onlyOwner 

```
['[154](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L154-L154)']
```solidity
154:     function cancel(bytes32 _id) external onlyOwner 

```
['[167](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L167-L167)']
```solidity
167:     function execute(Operation calldata _operation) external payable onlyOwnerOrSecurityCouncil 

```
['[186](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L186-L186)']
```solidity
186:     function executeInstant(Operation calldata _operation) external payable onlySecurityCouncil 

```
['[249](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L249-L249)']
```solidity
249:     function updateDelay(uint256 _newDelay) external onlySelf 

```
['[256](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L256-L256)']
```solidity
256:     function updateSecurityCouncil(address _newSecurityCouncil) external onlySelf 

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L79-L79)']
```solidity
79:     function initialize(
80:         StateTransitionManagerInitializeData calldata _initializeData
81:     ) external reentrancyGuardInitializer 

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin 

```
['[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L60-L60)']
```solidity
60:     function acceptAdmin() external 

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132-L132)']
```solidity
132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin 

```
['[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L137-L137)']
```solidity
137:     function setInitialCutHash(Diamond.DiamondCutData calldata _diamondCut) external onlyOwner 

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L142-L142)']
```solidity
142:     function setNewVersionUpgrade(
143:         Diamond.DiamondCutData calldata _cutData,
144:         uint256 _oldProtocolVersion,
145:         uint256 _newProtocolVersion
146:     ) external onlyOwner 

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L152-L152)']
```solidity
152:     function setUpgradeDiamondCut(
153:         Diamond.DiamondCutData calldata _cutData,
154:         uint256 _oldProtocolVersion
155:     ) external onlyOwner 

```
['[160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L160-L160)']
```solidity
160:     function freezeChain(uint256 _chainId) external onlyOwner 

```
['[165](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L165-L165)']
```solidity
165:     function unfreezeChain(uint256 _chainId) external onlyOwner 

```
['[170](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L170-L170)']
```solidity
170:     function revertBatches(uint256 _chainId, uint256 _newLastBatch) external onlyOwnerOrAdmin 

```
['[230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L230-L230)']
```solidity
230:     function registerAlreadyDeployedStateTransition(
231:         uint256 _chainId,
232:         address _stateTransitionContract
233:     ) external onlyOwner 

```
['[239](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L239-L239)']
```solidity
239:     function createNewChain(
240:         uint256 _chainId,
241:         address _baseToken,
242:         address _sharedBridge,
243:         address _admin,
244:         bytes calldata _diamondCut
245:     ) external onlyBridgehub 

```
['[73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L73-L73)']
```solidity
73:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner 

```
['[78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L78-L78)']
```solidity
78:     function addValidator(uint256 _chainId, address _newValidator) external onlyChainAdmin(_chainId) 

```
['[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L87-L87)']
```solidity
87:     function removeValidator(uint256 _chainId, address _validator) external onlyChainAdmin(_chainId) 

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L96-L96)']
```solidity
96:     function setExecutionDelay(uint32 _executionDelay) external onlyOwner 

```
['[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L102-L102)']
```solidity
102:     function getCommittedBatchTimestamp(uint256 _chainId, uint256 _l2BatchNumber) external view returns (uint256) 

```
['[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L108-L108)']
```solidity
108:     function commitBatches(
109:         StoredBatchInfo calldata,
110:         CommitBatchInfo[] calldata _newBatchesData
111:     ) external onlyValidator(ERA_CHAIN_ID) 

```
['[126](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L126-L126)']
```solidity
126:     function commitBatchesSharedBridge(
127:         uint256 _chainId,
128:         StoredBatchInfo calldata,
129:         CommitBatchInfo[] calldata _newBatchesData
130:     ) external onlyValidator(_chainId) 

```
['[146](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L146-L146)']
```solidity
146:     function revertBatches(uint256) external onlyValidator(ERA_CHAIN_ID) 

```
['[153](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L153-L153)']
```solidity
153:     function revertBatchesSharedBridge(uint256 _chainId, uint256) external onlyValidator(_chainId) 

```
['[160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L160-L160)']
```solidity
160:     function proveBatches(
161:         StoredBatchInfo calldata,
162:         StoredBatchInfo[] calldata,
163:         ProofInput calldata
164:     ) external onlyValidator(ERA_CHAIN_ID) 

```
['[171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L171-L171)']
```solidity
171:     function proveBatchesSharedBridge(
172:         uint256 _chainId,
173:         StoredBatchInfo calldata,
174:         StoredBatchInfo[] calldata,
175:         ProofInput calldata
176:     ) external onlyValidator(_chainId) 

```
['[182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L182-L182)']
```solidity
182:     function executeBatches(StoredBatchInfo[] calldata _newBatchesData) external onlyValidator(ERA_CHAIN_ID) 

```
['[203](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L203-L203)']
```solidity
203:     function executeBatchesSharedBridge(
204:         uint256 _chainId,
205:         StoredBatchInfo[] calldata _newBatchesData
206:     ) external onlyValidator(_chainId) 

```
['[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L24-L24)']
```solidity
24:     function initialize(InitializeData calldata _initializeData) external reentrancyGuardInitializer returns (bytes32) 

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L23-L23)']
```solidity
23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin 

```
['[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L60-L60)']
```solidity
60:     function acceptAdmin() external 

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L45-L45)']
```solidity
45:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager 

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L51-L51)']
```solidity
51:     function setPorterAvailability(bool _zkPorterIsAvailable) external onlyStateTransitionManager 

```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L58-L58)']
```solidity
58:     function setPriorityTxMaxGasLimit(uint256 _newPriorityTxMaxGasLimit) external onlyStateTransitionManager 

```
['[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L67-L67)']
```solidity
67:     function changeFeeParams(FeeParams calldata _newFeeParams) external onlyAdminOrStateTransitionManager 

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L79-L79)']
```solidity
79:     function setTokenMultiplier(uint128 _nominator, uint128 _denominator) external onlyAdminOrStateTransitionManager 

```
['[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L89-L89)']
```solidity
89:     function setValidiumMode(PubdataPricingMode _validiumMode) external onlyAdmin 

```
['[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L100-L100)']
```solidity
100:     function upgradeChainFromVersion(
101:         uint256 _oldProtocolVersion,
102:         Diamond.DiamondCutData calldata _diamondCut
103:     ) external onlyAdminOrStateTransitionManager 

```
['[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L123-L123)']
```solidity
123:     function executeUpgrade(Diamond.DiamondCutData calldata _diamondCut) external onlyStateTransitionManager 

```
['[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L133-L133)']
```solidity
133:     function freezeDiamond() external onlyAdminOrStateTransitionManager 

```
['[143](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L143-L143)']
```solidity
143:     function unfreezeDiamond() external onlyAdminOrStateTransitionManager 

```
['[199](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L199-L199)']
```solidity
199:     function commitBatches(
200:         StoredBatchInfo memory _lastCommittedBatchData,
201:         CommitBatchInfo[] calldata _newBatchesData
202:     ) external nonReentrant onlyValidator 

```
['[207](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L207-L207)']
```solidity
207:     function commitBatchesSharedBridge(
208:         uint256, 
209:         StoredBatchInfo memory _lastCommittedBatchData,
210:         CommitBatchInfo[] calldata _newBatchesData
211:     ) external nonReentrant onlyValidator 

```
['[337](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L337-L337)']
```solidity
337:     function executeBatchesSharedBridge(
338:         uint256,
339:         StoredBatchInfo[] calldata _batchesData
340:     ) external nonReentrant onlyValidator 

```
['[345](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L345-L345)']
```solidity
345:     function executeBatches(StoredBatchInfo[] calldata _batchesData) external nonReentrant onlyValidator 

```
['[368](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L368-L368)']
```solidity
368:     function proveBatches(
369:         StoredBatchInfo calldata _prevBatch,
370:         StoredBatchInfo[] calldata _committedBatches,
371:         ProofInput calldata _proof
372:     ) external nonReentrant onlyValidator 

```
['[377](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L377-L377)']
```solidity
377:     function proveBatchesSharedBridge(
378:         uint256, 
379:         StoredBatchInfo calldata _prevBatch,
380:         StoredBatchInfo[] calldata _committedBatches,
381:         ProofInput calldata _proof
382:     ) external nonReentrant onlyValidator 

```
['[472](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L472-L472)']
```solidity
472:     function revertBatches(uint256 _newLastBatch) external nonReentrant onlyValidatorOrStateTransitionManager 

```
['[477](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L477-L477)']
```solidity
477:     function revertBatchesSharedBridge(uint256, uint256 _newLastBatch) external nonReentrant onlyValidator 

```
['[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L32-L32)']
```solidity
32:     function getVerifier() external view returns (address) 

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L37-L37)']
```solidity
37:     function getAdmin() external view returns (address) 

```
['[42](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L42-L42)']
```solidity
42:     function getPendingAdmin() external view returns (address) 

```
['[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L47-L47)']
```solidity
47:     function getBridgehub() external view returns (address) 

```
['[52](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L52-L52)']
```solidity
52:     function getStateTransitionManager() external view returns (address) 

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L57-L57)']
```solidity
57:     function getBaseToken() external view returns (address) 

```
['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L62-L62)']
```solidity
62:     function getBaseTokenBridge() external view returns (address) 

```
['[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L67-L67)']
```solidity
67:     function baseTokenGasPriceMultiplierNominator() external view returns (uint128) 

```
['[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L72-L72)']
```solidity
72:     function baseTokenGasPriceMultiplierDenominator() external view returns (uint128) 

```
['[77](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L77-L77)']
```solidity
77:     function getTotalBatchesCommitted() external view returns (uint256) 

```
['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L82-L82)']
```solidity
82:     function getTotalBatchesVerified() external view returns (uint256) 

```
['[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L87-L87)']
```solidity
87:     function getTotalBatchesExecuted() external view returns (uint256) 

```
['[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L92-L92)']
```solidity
92:     function getTotalPriorityTxs() external view returns (uint256) 

```
['[97](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L97-L97)']
```solidity
97:     function getFirstUnprocessedPriorityTx() external view returns (uint256) 

```
['[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L102-L102)']
```solidity
102:     function getPriorityQueueSize() external view returns (uint256) 

```
['[107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L107-L107)']
```solidity
107:     function priorityQueueFrontOperation() external view returns (PriorityOperation memory) 

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L112-L112)']
```solidity
112:     function isValidator(address _address) external view returns (bool) 

```
['[117](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L117-L117)']
```solidity
117:     function l2LogsRootHash(uint256 _batchNumber) external view returns (bytes32) 

```
['[122](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L122-L122)']
```solidity
122:     function storedBatchHash(uint256 _batchNumber) external view returns (bytes32) 

```
['[127](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L127-L127)']
```solidity
127:     function getL2BootloaderBytecodeHash() external view returns (bytes32) 

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L132-L132)']
```solidity
132:     function getL2DefaultAccountBytecodeHash() external view returns (bytes32) 

```
['[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L137-L137)']
```solidity
137:     function getVerifierParams() external view returns (VerifierParams memory) 

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L142-L142)']
```solidity
142:     function getProtocolVersion() external view returns (uint256) 

```
['[147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L147-L147)']
```solidity
147:     function getL2SystemContractsUpgradeTxHash() external view returns (bytes32) 

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L152-L152)']
```solidity
152:     function getL2SystemContractsUpgradeBatchNumber() external view returns (uint256) 

```
['[157](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L157-L157)']
```solidity
157:     function isDiamondStorageFrozen() external view returns (bool) 

```
['[163](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L163-L163)']
```solidity
163:     function isFacetFreezable(address _facet) external view returns (bool isFreezable) 

```
['[176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L176-L176)']
```solidity
176:     function getPriorityTxMaxGasLimit() external view returns (uint256) 

```
['[181](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L181-L181)']
```solidity
181:     function isFunctionFreezable(bytes4 _selector) external view returns (bool) 

```
['[188](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L188-L188)']
```solidity
188:     function isEthWithdrawalFinalized(uint256 _l2BatchNumber, uint256 _l2MessageIndex) external view returns (bool) 

```
['[193](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L193-L193)']
```solidity
193:     function getPubdataPricingMode() external view returns (PubdataPricingMode) 

```
['[202](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L202-L202)']
```solidity
202:     function facets() external view returns (Facet[] memory result) 

```
['[217](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L217-L217)']
```solidity
217:     function facetFunctionSelectors(address _facet) external view returns (bytes4[] memory) 

```
['[223](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L223-L223)']
```solidity
223:     function facetAddresses() external view returns (address[] memory) 

```
['[229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L229-L229)']
```solidity
229:     function facetAddress(bytes4 _selector) external view returns (address) 

```
['[239](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L239-L239)']
```solidity
239:     function getTotalBlocksCommitted() external view returns (uint256) 

```
['[244](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L244-L244)']
```solidity
244:     function getTotalBlocksVerified() external view returns (uint256) 

```
['[249](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L249-L249)']
```solidity
249:     function getTotalBlocksExecuted() external view returns (uint256) 

```
['[254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L254-L254)']
```solidity
254:     function storedBlockHash(uint256 _batchNumber) external view returns (bytes32) 

```
['[259](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L259-L259)']
```solidity
259:     function getL2SystemContractsUpgradeBlockNumber() external view returns (uint256) 

```
['[38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L38-L38)']
```solidity
38:     function transferEthToSharedBridge() external onlyBaseTokenBridge 

```
['[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L47-L47)']
```solidity
47:     function bridgehubRequestL2Transaction(
48:         BridgehubL2TransactionRequest memory _request
49:     ) external payable onlyBridgehub returns (bytes32 canonicalTxHash) 

```
['[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L64-L64)']
```solidity
64:     function proveL2LogInclusion(
65:         uint256 _batchNumber,
66:         uint256 _index,
67:         L2Log memory _log,
68:         bytes32[] calldata _proof
69:     ) external view returns (bool) 

```
['[178](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L178-L178)']
```solidity
178:     function finalizeEthWithdrawal(
179:         uint256 _l2BatchNumber,
180:         uint256 _l2MessageIndex,
181:         uint16 _l2TxNumberInBatch,
182:         bytes calldata _message,
183:         bytes32[] calldata _merkleProof
184:     ) external nonReentrant 

```
['[197](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L197-L197)']
```solidity
197:     function requestL2Transaction(
198:         address _contractL2,
199:         uint256 _l2Value,
200:         bytes calldata _calldata,
201:         uint256 _l2GasLimit,
202:         uint256 _l2GasPerPubdataByteLimit,
203:         bytes[] calldata _factoryDeps,
204:         address _refundRecipient
205:     ) external payable returns (bytes32 canonicalTxHash) 

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L21-L21)']
```solidity
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable 

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L44-L44)']
```solidity
44:     function publishCompressedBytecode(
45:         bytes calldata _bytecode,
46:         bytes calldata _rawCompressedData
47:     ) external payable onlyCallFromBootloader returns (bytes32 bytecodeHash) 

```
['[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L110-L110)']
```solidity
110:     function verifyCompressedStateDiffs(
111:         uint256 _numberOfStateDiffs,
112:         uint256 _enumerationIndexSize,
113:         bytes calldata _stateDiffs,
114:         bytes calldata _compressedStateDiffs
115:     ) external payable onlyCallFrom(address(L1_MESSENGER_CONTRACT)) returns (bytes32 stateDiffHash) 

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L34-L34)']
```solidity
34:     function getAccountInfo(address _address) external view returns (AccountInfo memory info) 

```
['[65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L65-L65)']
```solidity
65:     function updateAccountVersion(AccountAbstractionVersion _version) external onlySystemCall 

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L74-L74)']
```solidity
74:     function updateNonceOrdering(AccountNonceOrdering _nonceOrdering) external onlySystemCall 

```
['[213](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L213-L213)']
```solidity
213:     function forceDeployOnAddress(ForceDeployment calldata _deployment, address _sender) external payable onlySelf 

```
['[238](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L238-L238)']
```solidity
238:     function forceDeployOnAddresses(ForceDeployment[] calldata _deployments) external payable 

```
['[196](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L196-L196)']
```solidity
196:     function payForTransaction(
197:         bytes32, 
198:         bytes32, 
199:         Transaction calldata _transaction
200:     ) external payable ignoreNonBootloader ignoreInDelegateCall 

```
['[212](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L212-L212)']
```solidity
212:     function prepareForPaymaster(
213:         bytes32, 
214:         bytes32, 
215:         Transaction calldata _transaction
216:     ) external payable ignoreNonBootloader ignoreInDelegateCall 

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L27-L27)']
```solidity
27:     function markFactoryDeps(bool _shouldSendToL1, bytes32[] calldata _hashes) external onlyCallFromBootloader 

```
['[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L39-L39)']
```solidity
39:     function markBytecodeAsPublished(bytes32 _bytecodeHash) external onlyCompressor 

```
['[70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L70-L70)']
```solidity
70:     function sendL2ToL1Log(
71:         bool _isService,
72:         bytes32 _key,
73:         bytes32 _value
74:     ) external onlyCallFromSystemContract returns (uint256 logIdInMerkleTree) 

```
['[194](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L194-L194)']
```solidity
194:     function publishPubdataAndClearState(
195:         bytes calldata _totalL2ToL1PubdataAndStateDiffs
196:     ) external onlyCallFromBootloader 

```
['[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L110-L110)']
```solidity
110:     function incrementMinNonceIfEquals(uint256 _expectedNonce) external onlySystemCall 

```
['[125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L125-L125)']
```solidity
125:     function getDeploymentNonce(address _address) external view returns (uint256 deploymentNonce) 

```
['[135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L135-L135)']
```solidity
135:     function incrementDeploymentNonce(address _address) external returns (uint256 prevDeploymentNonce) 

```
['[166](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L166-L166)']
```solidity
166:     function validateNonceUsage(address _address, uint256 _key, bool _shouldBeUsed) external view 

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L21-L21)']
```solidity
21:     function chunkAndPublishPubdata(bytes calldata _pubdata) external onlyCallFrom(address(L1_MESSENGER_CONTRACT)) 

```
['[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L84-L84)']
```solidity
84:     function setChainId(uint256 _newChainId) external onlyCallFromForceDeployer 

```
['[99](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L99-L99)']
```solidity
99:     function setTxOrigin(address _newOrigin) external onlyCallFromBootloader 

```
['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L105-L105)']
```solidity
105:     function setGasPrice(uint256 _gasPrice) external onlyCallFromBootloader 

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L112-L112)']
```solidity
112:     function setPubdataInfo(uint256 _gasPerPubdataByte, uint256 _basePubdataSpent) external onlyCallFromBootloader 

```
['[122](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L122-L122)']
```solidity
122:     function getCurrentPubdataCost() external view returns (uint256) 

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L132-L132)']
```solidity
132:     function getBlockHashEVM(uint256 _block) external view returns (bytes32 hash) 

```
['[166](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L166-L166)']
```solidity
166:     function getBatchHash(uint256 _batchNumber) external view returns (bytes32 hash) 

```
['[341](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L341-L341)']
```solidity
341:     function setL2Block(
342:         uint128 _l2BlockNumber,
343:         uint128 _l2BlockTimestamp,
344:         bytes32 _expectedPrevL2BlockHash,
345:         bool _isFirstInBatch,
346:         uint128 _maxVirtualBlocksToCreate
347:     ) external onlyCallFromBootloader 

```
['[402](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L402-L402)']
```solidity
402:     function appendTransactionToCurrentL2Block(bytes32 _txHash) external onlyCallFromBootloader 

```
['[408](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L408-L408)']
```solidity
408:     function publishTimestampDataToL1() external onlyCallFromBootloader 

```
['[444](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L444-L444)']
```solidity
444:     function setNewBatch(
445:         bytes32 _prevBatchHash,
446:         uint128 _newTimestamp,
447:         uint128 _expectedNewNumber,
448:         uint256 _baseFee
449:     ) external onlyCallFromBootloader 

```
['[471](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L471-L471)']
```solidity
471:     function unsafeOverrideBatch(
472:         uint256 _newTimestamp,
473:         uint256 _number,
474:         uint256 _baseFee
475:     ) external onlyCallFromBootloader 

```
['[482](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L482-L482)']
```solidity
482:     function incrementTxNumberInBatch() external onlyCallFromBootloader 

```
['[486](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L486-L486)']
```solidity
486:     function resetTxNumberInBatch() external onlyCallFromBootloader 

```
['[496](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L496-L496)']
```solidity
496:     function currentBlockInfo() external view returns (uint256 blockInfo) 

```
['[503](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L503-L503)']
```solidity
503:     function getBlockNumberAndTimestamp() external view returns (uint256 blockNumber, uint256 blockTimestamp) 

```
['[509](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L509-L509)']
```solidity
509:     function blockHash(uint256 _blockNumber) external view returns (bytes32 hash) 

```
['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L35-L35)']
```solidity
35:     function gasBoundCall(address _to, uint256 _maxTotalGas, bytes calldata _data) external payable 

```
['[49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L49-L49)']
```solidity
49:     function initialize(
50:         address _l1Bridge,
51:         address _l1LegecyBridge,
52:         bytes32 _l2TokenProxyBytecodeHash,
53:         address _aliasedOwner
54:     ) external reinitializer(2) 

```
['[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L50-L50)']
```solidity
50:     function bridgeInitialize(address _l1Address, bytes memory _data) external initializer 

```
['[111](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L111-L111)']
```solidity
111:     function reinitializeToken(
112:         ERC20Getters calldata _availableGetters,
113:         string memory _newName,
114:         string memory _newSymbol,
115:         uint8 _version
116:     ) external onlyNextVersion(_version) reinitializer(_version) 

```
['[178](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L178-L178)']
```solidity
178:     function decodeString(bytes memory _input) external pure returns (string memory result) 

```
['[183](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L183-L183)']
```solidity
183:     function decodeUint8(bytes memory _input) external pure returns (uint8 result) 

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L13-L13)']
```solidity
13:     function forceDeploy(IContractDeployer.ForceDeployment[] calldata _forceDeployments) external payable 

```
['[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L133-L133)']
```solidity
133:     function deposit(
134:         address _l2Receiver,
135:         address _l1Token,
136:         uint256 _amount,
137:         uint256 _l2TxGasLimit,
138:         uint256 _l2TxGasPerPubdataByte,
139:         address _refundRecipient
140:     ) public payable nonReentrant returns (bytes32 l2TxHash) 

```
['[75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L75-L75)']
```solidity
75:     function getStateTransition(uint256 _chainId) public view returns (address) 

```
['[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L84-L84)']
```solidity
84:     function isOperation(bytes32 _id) public view returns (bool) 

```
['[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L89-L89)']
```solidity
89:     function isOperationPending(bytes32 _id) public view returns (bool) 

```
['[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L95-L95)']
```solidity
95:     function isOperationReady(bytes32 _id) public view returns (bool) 

```
['[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L100-L100)']
```solidity
100:     function isOperationDone(bytes32 _id) public view returns (bool) 

```
['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L105-L105)']
```solidity
105:     function getOperationState(bytes32 _id) public view returns (OperationState) 

```
['[204](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L204-L204)']
```solidity
204:     function hashOperation(Operation calldata _operation) public pure returns (bytes32) 

```
['[54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L54-L54)']
```solidity
54:     function proveL2MessageInclusion(
55:         uint256 _batchNumber,
56:         uint256 _index,
57:         L2Message memory _message,
58:         bytes32[] calldata _proof
59:     ) public view returns (bool) 

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L74-L74)']
```solidity
74:     function proveL1ToL2TransactionStatus(
75:         bytes32 _l2TxHash,
76:         uint256 _l2BatchNumber,
77:         uint256 _l2MessageIndex,
78:         uint16 _l2TxNumberInBatch,
79:         bytes32[] calldata _merkleProof,
80:         TxStatus _status
81:     ) public view returns (bool) 

```
['[143](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L143-L143)']
```solidity
143:     function l2TransactionBaseCost(
144:         uint256 _gasPrice,
145:         uint256 _l2GasLimit,
146:         uint256 _l2GasPerPubdataByteLimit
147:     ) public view returns (uint256) 

```
['[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L40-L40)']
```solidity
40:     function extendedAccountVersion(address _address) public view returns (AccountAbstractionVersion) 

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L46-L46)']
```solidity
46:     function getMinNonce(address _address) public view returns (uint256) 

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L57-L57)']
```solidity
57:     function getRawNonce(address _address) public view returns (uint256) 

```
['[65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L65-L65)']
```solidity
65:     function increaseMinNonce(uint256 _value) public onlySystemCall returns (uint256 oldMinNonce) 

```
['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L82-L82)']
```solidity
82:     function setValueUnderNonce(uint256 _key, uint256 _value) public onlySystemCall 

```
['[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L102-L102)']
```solidity
102:     function getValueUnderNonce(uint256 _key) public view returns (uint256) 

```
['[154](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L154-L154)']
```solidity
154:     function isNonceUsed(address _address, uint256 _nonce) public view returns (bool) 

```
['[117](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L117-L117)']
```solidity
117:     function getCurrentPubdataSpent() public view returns (uint256) 

```
['[172](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L172-L172)']
```solidity
172:     function getBatchNumberAndTimestamp() public view returns (uint128 batchNumber, uint128 batchTimestamp) 

```
['[180](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L180-L180)']
```solidity
180:     function getL2BlockNumberAndTimestamp() public view returns (uint128 blockNumber, uint128 blockTimestamp) 

```
['[190](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L190-L190)']
```solidity
190:     function getBlockNumber() public view returns (uint128) 

```
['[198](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L198-L198)']
```solidity
198:     function getBlockTimestamp() public view returns (uint128) 

```


</details>

## [NonCritical-9] Using abi.encodePacked can result in hash collision when used in hashing functions 

### Resolution 
Consider using abi.encode as this pads data to 32 byte segments

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[461](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L461-L461)']
```solidity
458:         return
459:             uint256(
460:                 keccak256(
461:                     abi.encodePacked( // <= FOUND
462:                         _prevBatchCommitment,
463:                         _currentBatchCommitment,
464:                         _verifierParams.recursionNodeLevelVkHash,
465:                         _verifierParams.recursionLeafLevelVkHash
466:                     )
467:                 )
468:             ) >> PUBLIC_INPUT_SHIFT;

```
['[656](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L656-L656)']
```solidity
654:             
655:             blobCommitments[versionedHashIndex] = keccak256(
656:                 abi.encodePacked(blobVersionedHash, _pubdataCommitments[i:i + PUBDATA_COMMITMENT_COMMITMENT_OFFSET]) // <= FOUND
657:             );

```
['[113](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L113-L113)']
```solidity
112:         bytes32 hashedLog = keccak256(
113:             abi.encodePacked(_log.l2ShardId, _log.isService, _log.txNumberInBatch, _log.sender, _log.key, _log.value) // <= FOUND
114:         );

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L96-L96)']
```solidity
95:         bytes32 hashedLog = keccak256(
96:             abi.encodePacked( // <= FOUND
97:                 _l2ToL1Log.l2ShardId,
98:                 _l2ToL1Log.isService,
99:                 _l2ToL1Log.txNumberInBlock,
100:                 _l2ToL1Log.sender,
101:                 _l2ToL1Log.key,
102:                 _l2ToL1Log.value
103:             )
104:         );

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L142-L142)']
```solidity
142:         return keccak256(abi.encodePacked("\x19\x01", domainSeparator, structHash)); // <= FOUND

```


</details>

## [NonCritical-10] Getting a bool return value does not confirm the existence of a function in an external call 

### Resolution 
External calls to contracts using `address.call()` might return a boolean indicating success or failure. However, this boolean doesn't guarantee the existence of a called function. If a function isn't present, the call won't revert but will simply return `false`. This behavior might lead developers into mistakenly believing they're interacting with a legitimate or expected function, whereas it might not exist at alla scenario sometimes termed as "phantom functions". Resolution: Instead of solely relying on the boolean, further validate the contract you're interacting with, or use interfaces or abstract contracts to enforce the existence of expected functions.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[224](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L224-L226)']
```solidity
224:     function _execute(Call[] calldata _calls) internal { // <= FOUND
225:         for (uint256 i = 0; i < _calls.length; ++i) {
226:             (bool success, bytes memory returnData) = _calls[i].target.call{value: _calls[i].value}(_calls[i].data); // <= FOUND
227:             if (!success) {
228:                 
229:                 assembly {
230:                     revert(add(returnData, 0x20), mload(returnData))
231:                 }
232:             }
233:         }
234:     }

```
['[605](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L605-L612)']
```solidity
605:     function _pointEvaluationPrecompile(
606:         bytes32 _versionedHash,
607:         bytes32 _openingPoint,
608:         bytes calldata _openingValueCommitmentProof
609:     ) internal view {
610:         bytes memory precompileInput = abi.encodePacked(_versionedHash, _openingPoint, _openingValueCommitmentProof);
611: 
612:         (bool success, bytes memory data) = POINT_EVALUATION_PRECOMPILE_ADDR.staticcall(precompileInput); // <= FOUND
613: 
614:         
615:         
616:         require(success, "failed to call point evaluation precompile");
617:         (, uint256 result) = abi.decode(data, (uint256, uint256));
618:         require(result == BLS_MODULUS, "precompile unexpected output");
619:     }

```
['[679](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L679-L680)']
```solidity
679:     function _getBlobVersionedHash(uint256 _index) internal view returns (bytes32 versionedHash) { // <= FOUND
680:         (bool success, bytes memory data) = s.blobVersionedHashRetriever.staticcall(abi.encode(_index)); // <= FOUND
681:         require(success, "vc");
682:         versionedHash = abi.decode(data, (bytes32));
683:     }

```


</details>

## [NonCritical-11] Non constant/immutable state variables are missing a setter post deployment 

### Resolution 
Non-constant or non-immutable state variables lacking a setter function can create inflexibility in contract operations. If there's no way to update these variables post-deployment, the contract might not adapt to changing conditions or requirements, which can be a significant drawback, especially in upgradable or long-lived contracts. To resolve this, implement setter functions guarded by appropriate access controls, like `onlyOwner` or similar modifiers, so that these variables can be updated as required while maintaining security. This enables smoother contract maintenance and feature upgrades.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L37-L37)']
```solidity
37: uint256 public blockGasLimit = type(uint32).max;

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L41-L41)']
```solidity
41: address public coinbase = BOOTLOADER_FORMAL_ADDRESS;

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L44-L44)']
```solidity
44: uint256 public difficulty = 2.5e15;

```
['[70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L70-L70)']
```solidity
70: bytes32[MINIBLOCK_HASHES_TO_STORE] internal l2BlockHash;

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L37-L37)']
```solidity
37: address private l1LegacyBridge;

```


</details>

## [NonCritical-12] Require statements should have error string

### Resolution 
Adding error strings to require statements in Solidity contracts, although not mandatory, enhances error handling, debugging, and overall contract maintainability. Providing a descriptive error message with each require statement helps identify the specific reason for a transaction failure, making it easier for developers to troubleshoot issues and for users to understand the cause of a revert. Including error strings improves code readability and fosters transparency, as the logic and conditions behind each requirement are clearly communicated

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L51-L51)']
```solidity
51: require(_newBatch.pubdataCommitments.length == 1);

```
['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L55-L55)']
```solidity
55: require(msg.sender == FORCE_DEPLOYER);

```


</details>

## [NonCritical-13] Function calls within for loops

### Resolution 
Making function calls or external calls within loops in Solidity can lead to inefficient gas usage, potential bottlenecks, and increased vulnerability to attacks. Each function call or external call consumes gas, and when executed within a loop, the gas cost multiplies, potentially causing the transaction to run out of gas or exceed block gas limits. This can result in transaction failure or unpredictable behavior.

Num of instances: 16

### Findings 


<details><summary>Click to show findings</summary>

['[257](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L257-L258)']
```solidity
257:        for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) {
258:             _lastCommittedBatchData = _commitOneBatch(_lastCommittedBatchData, _newBatchesData[i], bytes32(0)); // <= FOUND
259: 
260:             s.storedBatchHashes[_lastCommittedBatchData.batchNumber] = _hashStoredBatchInfo(_lastCommittedBatchData);
261:             emit BlockCommit(
262:                 _lastCommittedBatchData.batchNumber,
263:                 _lastCommittedBatchData.batchHash,
264:                 _lastCommittedBatchData.commitment
265:             );
266:         }

```
['[289](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L289-L292)']
```solidity
289:        for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) {
290:             
291:             bytes32 expectedUpgradeTxHash = i == 0 ? _systemContractUpgradeTxHash : bytes32(0);
292:             _lastCommittedBatchData = _commitOneBatch( // <= FOUND
293:                 _lastCommittedBatchData,
294:                 _newBatchesData[i],
295:                 expectedUpgradeTxHash
296:             );
297: 
298:             s.storedBatchHashes[_lastCommittedBatchData.batchNumber] = _hashStoredBatchInfo(_lastCommittedBatchData);
299:             emit BlockCommit(
300:                 _lastCommittedBatchData.batchNumber,
301:                 _lastCommittedBatchData.batchHash,
302:                 _lastCommittedBatchData.commitment
303:             );
304:         }

```
['[351](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L351-L352)']
```solidity
351:        for (uint256 i = 0; i < nBatches; i = i.uncheckedInc()) {
352:             _executeOneBatch(_batchesData[i], i); // <= FOUND
353:             emit BlockExecution(_batchesData[i].batchNumber, _batchesData[i].batchHash, _batchesData[i].commitment);
354:         }

```
['[405](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L405-L413)']
```solidity
405:        for (uint256 i = 0; i < committedBatchesLength; i = i.uncheckedInc()) {
406:             currentTotalBatchesVerified = currentTotalBatchesVerified.uncheckedInc();
407:             require(
408:                 _hashStoredBatchInfo(_committedBatches[i]) == s.storedBatchHashes[currentTotalBatchesVerified],
409:                 "o1"
410:             );
411: 
412:             bytes32 currentBatchCommitment = _committedBatches[i].commitment;
413:             proofPublicInput[i] = _getBatchProofPublicInput( // <= FOUND
414:                 prevBatchCommitment,
415:                 currentBatchCommitment,
416:                 verifierParams
417:             );
418: 
419:             prevBatchCommitment = currentBatchCommitment;
420:         }

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L142-L149)']
```solidity
142:        for (uint256 i = 0; i < emittedL2Logs.length; i = i.uncheckedAdd(L2_TO_L1_LOG_SERIALIZE_SIZE)) {
143:             
144:             (address logSender, ) = UnsafeBytes.readAddress(emittedL2Logs, i + L2_LOG_ADDRESS_OFFSET);
145:             (uint256 logKey, ) = UnsafeBytes.readUint256(emittedL2Logs, i + L2_LOG_KEY_OFFSET); // <= FOUND
146:             (bytes32 logValue, ) = UnsafeBytes.readBytes32(emittedL2Logs, i + L2_LOG_VALUE_OFFSET);
147: 
148:             
149:             require(!_checkBit(processedLogs, uint8(logKey)), "kp"); // <= FOUND
150:             processedLogs = _setBit(processedLogs, uint8(logKey));
151: 
152:             
153:             if (logKey == uint256(SystemLogKey.L2_TO_L1_LOGS_TREE_ROOT_KEY)) {
154:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "lm");
155:                 logOutput.l2LogsTreeRoot = logValue;
156:             } else if (logKey == uint256(SystemLogKey.TOTAL_L2_TO_L1_PUBDATA_KEY)) {
157:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "ln");
158:                 logOutput.pubdataHash = logValue;
159:             } else if (logKey == uint256(SystemLogKey.STATE_DIFF_HASH_KEY)) {
160:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "lb");
161:                 logOutput.stateDiffHash = logValue;
162:             } else if (logKey == uint256(SystemLogKey.PACKED_BATCH_AND_L2_BLOCK_TIMESTAMP_KEY)) {
163:                 require(logSender == L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, "sc");
164:                 logOutput.packedBatchAndL2BlockTimestamp = uint256(logValue);
165:             } else if (logKey == uint256(SystemLogKey.PREV_BATCH_HASH_KEY)) {
166:                 require(logSender == L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, "sv");
167:                 logOutput.previousBatchHash = logValue;
168:             } else if (logKey == uint256(SystemLogKey.CHAINED_PRIORITY_TXN_HASH_KEY)) {
169:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bl");
170:                 logOutput.chainedPriorityTxsHash = logValue;
171:             } else if (logKey == uint256(SystemLogKey.NUMBER_OF_LAYER_1_TXS_KEY)) {
172:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bk");
173:                 logOutput.numberOfLayer1Txs = uint256(logValue);
174:             } else if (logKey == uint256(SystemLogKey.BLOB_ONE_HASH_KEY)) {
175:                 require(logSender == L2_PUBDATA_CHUNK_PUBLISHER_ADDR, "pc");
176:                 logOutput.blob1Hash = logValue;
177:             } else if (logKey == uint256(SystemLogKey.BLOB_TWO_HASH_KEY)) {
178:                 require(logSender == L2_PUBDATA_CHUNK_PUBLISHER_ADDR, "pd");
179:                 logOutput.blob2Hash = logValue;
180:             } else if (logKey == uint256(SystemLogKey.EXPECTED_SYSTEM_CONTRACT_UPGRADE_TX_HASH_KEY)) {
181:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bu");
182:                 require(_expectedSystemContractUpgradeTxHash == logValue, "ut");
183:             } else {
184:                 revert("ul");
185:             }
186:         }

```
['[636](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L636-L647)']
```solidity
636:        for (uint256 i = 0; i < _pubdataCommitments.length; i += PUBDATA_COMMITMENT_SIZE) {
637:             bytes32 blobVersionedHash = _getBlobVersionedHash(versionedHashIndex);
638: 
639:             require(blobVersionedHash != bytes32(0), "vh");
640: 
641:             
642:             
643:             bytes32 openingPoint = bytes32(
644:                 uint256(uint128(bytes16(_pubdataCommitments[i:i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET])))
645:             );
646: 
647:             _pointEvaluationPrecompile( // <= FOUND
648:                 blobVersionedHash,
649:                 openingPoint,
650:                 _pubdataCommitments[i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET:i + PUBDATA_COMMITMENT_SIZE]
651:             );
652: 
653:             
654:             blobCommitments[versionedHashIndex] = keccak256(
655:                 abi.encodePacked(blobVersionedHash, _pubdataCommitments[i:i + PUBDATA_COMMITMENT_COMMITMENT_OFFSET])
656:             );
657:             versionedHashIndex += 1;
658:         }

```
['[127](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L127-L139)']
```solidity
127:        for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) {
128:             bytes calldata stateDiff = _stateDiffs[i:i + STATE_DIFF_ENTRY_SIZE];
129:             uint64 enumIndex = stateDiff.readUint64(84);
130:             if (enumIndex != 0) {
131:                 
132:                 continue;
133:             }
134: 
135:             numInitialWritesProcessed++;
136: 
137:             bytes32 derivedKey = stateDiff.readBytes32(52);
138:             uint256 initValue = stateDiff.readUint256(92); // <= FOUND
139:             uint256 finalValue = stateDiff.readUint256(124); // <= FOUND
140:             require(derivedKey == _compressedStateDiffs.readBytes32(stateDiffPtr), "iw: initial key mismatch");
141:             stateDiffPtr += 32;
142: 
143:             uint8 metadata = uint8(bytes1(_compressedStateDiffs[stateDiffPtr]));
144:             stateDiffPtr++;
145:             uint8 operation = metadata & OPERATION_BITMASK;
146:             uint8 len = operation == 0 ? 32 : metadata >> LENGTH_BITS_OFFSET;
147:             _verifyValueCompression(
148:                 initValue,
149:                 finalValue,
150:                 operation,
151:                 _compressedStateDiffs[stateDiffPtr:stateDiffPtr + len]
152:             );
153:             stateDiffPtr += len;
154:         }

```
['[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L101-L110)']
```solidity
101:        for (uint256 i = 0; i < facetCutsLength; i = i.uncheckedInc()) {
102:             Action action = facetCuts[i].action;
103:             address facet = facetCuts[i].facet;
104:             bool isFacetFreezable = facetCuts[i].isFreezable;
105:             bytes4[] memory selectors = facetCuts[i].selectors;
106: 
107:             require(selectors.length > 0, "B"); 
108: 
109:             if (action == Action.Add) {
110:                 _addFunctions(facet, selectors, isFacetFreezable); // <= FOUND
111:             } else if (action == Action.Replace) {
112:                 _replaceFunctions(facet, selectors, isFacetFreezable);
113:             } else if (action == Action.Remove) {
114:                 _removeFunctions(facet, selectors);
115:             } else {
116:                 revert("C"); 
117:             }
118:         }

```
['[158](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L158-L166)']
```solidity
158:        for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) {
159:             bytes4 selector = _selectors[i];
160:             SelectorToFacet memory oldFacet = ds.selectorToFacet[selector];
161:             require(oldFacet.facetAddress != address(0), "L"); 
162: 
163:             _removeOneFunction(oldFacet.facetAddress, selector); // <= FOUND
164:             
165:             _saveFacetIfNew(_facet); // <= FOUND
166:             _addOneFunction(_facet, selector, _isFacetFreezable); // <= FOUND
167:         }

```
['[138](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L138-L143)']
```solidity
138:        for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) {
139:             bytes4 selector = _selectors[i];
140:             SelectorToFacet memory oldFacet = ds.selectorToFacet[selector];
141:             require(oldFacet.facetAddress == address(0), "J"); 
142: 
143:             _addOneFunction(_facet, selector, _isFacetFreezable); // <= FOUND
144:         }

```
['[178](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L178-L183)']
```solidity
178:        for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) {
179:             bytes4 selector = _selectors[i];
180:             SelectorToFacet memory oldFacet = ds.selectorToFacet[selector];
181:             require(oldFacet.facetAddress != address(0), "a2"); 
182: 
183:             _removeOneFunction(oldFacet.facetAddress, selector); // <= FOUND
184:         }

```
['[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L29-L32)']
```solidity
29:        for (uint256 i; i < pathLength; i = i.uncheckedInc()) {
30:             currentHash = (_index % 2 == 0)
31:                 ? _efficientHash(currentHash, _path[i]) // <= FOUND
32:                 : _efficientHash(_path[i], currentHash); // <= FOUND
33:             _index /= 2;
34:         }

```
['[311](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L311-L312)']
```solidity
311:        for (uint256 i = 0; i < _nPriorityOps; i = i.uncheckedInc()) {
312:             PriorityOperation memory priorityOp = s.priorityQueue.popFront(); // <= FOUND
313:             concatHash = keccak256(abi.encode(concatHash, priorityOp.canonicalTxHash));
314:         }

```
['[206](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L206-L207)']
```solidity
206:        for (uint256 i = 0; i < numberOfL2ToL1Logs; ++i) {
207:             bytes32 hashedLog = EfficientCall.keccak( // <= FOUND
208:                 _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + L2_TO_L1_LOG_SERIALIZE_SIZE]
209:             );
210:             calldataPtr += L2_TO_L1_LOG_SERIALIZE_SIZE;
211:             l2ToL1LogsTreeArray[i] = hashedLog;
212:             reconstructedChainedLogsHash = keccak256(abi.encode(reconstructedChainedLogsHash, hashedLog));
213:         }

```
['[356](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L356-L357)']
```solidity
356:        for (uint256 i = 0; i < factoryDepsLen; i = i.uncheckedInc()) {
357:             bytes32 hashedBytecode = L2ContractHelper.hashL2Bytecode(_factoryDeps[i]); // <= FOUND
358: 
359:             
360:             assembly {
361:                 mstore(add(hashedFactoryDeps, mul(add(i, 1), 32)), hashedBytecode)
362:             }
363:         }

```
['[226](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L226-L228)']
```solidity
226:        for (uint256 i = 0; i < _factoryDeps.length; ++i) {
227:             require(
228:                 L2ContractHelper.hashL2Bytecode(_factoryDeps[i]) == bytes32(_expectedHashes[i]), // <= FOUND
229:                 "Wrong factory dep hash"
230:             );
231:         }

```


</details>

## [NonCritical-14] For loops in public or external functions should be avoided due to high gas costs and possible DOS

### Resolution 
In Solidity, for loops can potentially cause Denial of Service (DoS) attacks if not handled carefully. DoS attacks can occur when an attacker intentionally exploits the gas cost of a function, causing it to run out of gas or making it too expensive for other users to call. Below are some scenarios where for loops can lead to DoS attacks: Nested for loops can become exceptionally gas expensive and should be used sparingly

Num of instances: 11

### Findings 


<details><summary>Click to show findings</summary>

['[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L116-L116)']
```solidity
108:     function commitBatches(
109:         StoredBatchInfo calldata,
110:         CommitBatchInfo[] calldata _newBatchesData
111:     ) external onlyValidator(ERA_CHAIN_ID) {
112:         unchecked {
113:             
114:             
115:             uint32 timestamp = uint32(block.timestamp);
116:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { // <= FOUND
117:                 committedBatchTimestamp[ERA_CHAIN_ID].set(_newBatchesData[i].batchNumber, timestamp);
118:             }
119:         }
120: 
121:         _propagateToZkSyncStateTransition(ERA_CHAIN_ID);
122:     }

```
['[135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L135-L135)']
```solidity
126:     function commitBatchesSharedBridge(
127:         uint256 _chainId,
128:         StoredBatchInfo calldata,
129:         CommitBatchInfo[] calldata _newBatchesData
130:     ) external onlyValidator(_chainId) {
131:         unchecked {
132:             
133:             
134:             uint32 timestamp = uint32(block.timestamp);
135:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { // <= FOUND
136:                 committedBatchTimestamp[_chainId].set(_newBatchesData[i].batchNumber, timestamp);
137:             }
138:         }
139: 
140:         _propagateToZkSyncStateTransition(_chainId);
141:     }

```
['[185](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L185-L185)']
```solidity
182:     function executeBatches(StoredBatchInfo[] calldata _newBatchesData) external onlyValidator(ERA_CHAIN_ID) {
183:         uint256 delay = executionDelay; 
184:         unchecked {
185:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { // <= FOUND
186:                 uint256 commitBatchTimestamp = committedBatchTimestamp[ERA_CHAIN_ID].get(
187:                     _newBatchesData[i].batchNumber
188:                 );
189: 
190:                 
191:                 
192:                 
193:                 
194: 
195:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c"); 
196:             }
197:         }
198:         _propagateToZkSyncStateTransition(ERA_CHAIN_ID);
199:     }

```
['[209](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L209-L209)']
```solidity
203:     function executeBatchesSharedBridge(
204:         uint256 _chainId,
205:         StoredBatchInfo[] calldata _newBatchesData
206:     ) external onlyValidator(_chainId) {
207:         uint256 delay = executionDelay; 
208:         unchecked {
209:             for (uint256 i = 0; i < _newBatchesData.length; ++i) { // <= FOUND
210:                 uint256 commitBatchTimestamp = committedBatchTimestamp[_chainId].get(_newBatchesData[i].batchNumber);
211: 
212:                 
213:                 
214:                 
215:                 
216: 
217:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c"); 
218:             }
219:         }
220:         _propagateToZkSyncStateTransition(_chainId);
221:     }

```
['[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L61-L61)']
```solidity
44:     function publishCompressedBytecode(
45:         bytes calldata _bytecode,
46:         bytes calldata _rawCompressedData
47:     ) external payable onlyCallFromBootloader returns (bytes32 bytecodeHash) {
48:         unchecked {
49:             (bytes calldata dictionary, bytes calldata encodedData) = _decodeRawBytecode(_rawCompressedData);
50: 
51:             require(
52:                 encodedData.length * 4 == _bytecode.length,
53:                 "Encoded data length should be 4 times shorter than the original bytecode"
54:             );
55: 
56:             require(
57:                 dictionary.length / 8 <= encodedData.length / 2,
58:                 "Dictionary should have at most the same number of entries as the encoded data"
59:             );
60: 
61:             for (uint256 encodedDataPointer = 0; encodedDataPointer < encodedData.length; encodedDataPointer += 2) { // <= FOUND
62:                 uint256 indexOfEncodedChunk = uint256(encodedData.readUint16(encodedDataPointer)) * 8;
63:                 require(indexOfEncodedChunk < dictionary.length, "Encoded chunk index is out of bounds");
64: 
65:                 uint64 encodedChunk = dictionary.readUint64(indexOfEncodedChunk);
66:                 uint64 realChunk = _bytecode.readUint64(encodedDataPointer * 4);
67: 
68:                 require(encodedChunk == realChunk, "Encoded chunk does not match the original bytecode");
69:             }
70:         }
71: 
72:         bytecodeHash = Utils.hashL2Bytecode(_bytecode);
73:         L1_MESSENGER_CONTRACT.sendToL1(_rawCompressedData);
74:         KNOWN_CODE_STORAGE_CONTRACT.markBytecodeAsPublished(bytecodeHash);
75:     }

```
['[127](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L127-L159)']
```solidity
110:     function verifyCompressedStateDiffs(
111:         uint256 _numberOfStateDiffs,
112:         uint256 _enumerationIndexSize,
113:         bytes calldata _stateDiffs,
114:         bytes calldata _compressedStateDiffs
115:     ) external payable onlyCallFrom(address(L1_MESSENGER_CONTRACT)) returns (bytes32 stateDiffHash) {
116:         
117:         
118:         
119:         require(_enumerationIndexSize <= MAX_ENUMERATION_INDEX_SIZE, "enumeration index size is too large");
120: 
121:         uint256 numberOfInitialWrites = uint256(_compressedStateDiffs.readUint16(0));
122: 
123:         uint256 stateDiffPtr = 2;
124:         uint256 numInitialWritesProcessed = 0;
125: 
126:         
127:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) { // <= FOUND
128:             bytes calldata stateDiff = _stateDiffs[i:i + STATE_DIFF_ENTRY_SIZE];
129:             uint64 enumIndex = stateDiff.readUint64(84);
130:             if (enumIndex != 0) {
131:                 
132:                 continue;
133:             }
134: 
135:             numInitialWritesProcessed++;
136: 
137:             bytes32 derivedKey = stateDiff.readBytes32(52);
138:             uint256 initValue = stateDiff.readUint256(92);
139:             uint256 finalValue = stateDiff.readUint256(124);
140:             require(derivedKey == _compressedStateDiffs.readBytes32(stateDiffPtr), "iw: initial key mismatch");
141:             stateDiffPtr += 32;
142: 
143:             uint8 metadata = uint8(bytes1(_compressedStateDiffs[stateDiffPtr]));
144:             stateDiffPtr++;
145:             uint8 operation = metadata & OPERATION_BITMASK;
146:             uint8 len = operation == 0 ? 32 : metadata >> LENGTH_BITS_OFFSET;
147:             _verifyValueCompression(
148:                 initValue,
149:                 finalValue,
150:                 operation,
151:                 _compressedStateDiffs[stateDiffPtr:stateDiffPtr + len]
152:             );
153:             stateDiffPtr += len;
154:         }
155: 
156:         require(numInitialWritesProcessed == numberOfInitialWrites, "Incorrect number of initial storage diffs");
157: 
158:         
159:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) { // <= FOUND
160:             bytes calldata stateDiff = _stateDiffs[i:i + STATE_DIFF_ENTRY_SIZE];
161:             uint64 enumIndex = stateDiff.readUint64(84);
162:             if (enumIndex == 0) {
163:                 continue;
164:             }
165: 
166:             uint256 initValue = stateDiff.readUint256(92);
167:             uint256 finalValue = stateDiff.readUint256(124);
168:             uint256 compressedEnumIndex = _sliceToUint256(
169:                 _compressedStateDiffs[stateDiffPtr:stateDiffPtr + _enumerationIndexSize]
170:             );
171:             require(enumIndex == compressedEnumIndex, "rw: enum key mismatch");
172:             stateDiffPtr += _enumerationIndexSize;
173: 
174:             uint8 metadata = uint8(bytes1(_compressedStateDiffs[stateDiffPtr]));
175:             stateDiffPtr += 1;
176:             uint8 operation = metadata & OPERATION_BITMASK;
177:             uint8 len = operation == 0 ? 32 : metadata >> LENGTH_BITS_OFFSET;
178:             _verifyValueCompression(
179:                 initValue,
180:                 finalValue,
181:                 operation,
182:                 _compressedStateDiffs[stateDiffPtr:stateDiffPtr + len]
183:             );
184:             stateDiffPtr += len;
185:         }
186: 
187:         require(stateDiffPtr == _compressedStateDiffs.length, "Extra data in _compressedStateDiffs");
188: 
189:         stateDiffHash = EfficientCall.keccak(_stateDiffs);
190:     }

```
['[248](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L248-L253)']
```solidity
238:     function forceDeployOnAddresses(ForceDeployment[] calldata _deployments) external payable {
239:         require(
240:             msg.sender == FORCE_DEPLOYER || msg.sender == address(COMPLEX_UPGRADER_CONTRACT),
241:             "Can only be called by FORCE_DEPLOYER or COMPLEX_UPGRADER_CONTRACT"
242:         );
243: 
244:         uint256 deploymentsLength = _deployments.length;
245:         
246:         
247:         uint256 sumOfValues = 0;
248:         for (uint256 i = 0; i < deploymentsLength; ++i) { // <= FOUND
249:             sumOfValues += _deployments[i].value;
250:         }
251:         require(msg.value == sumOfValues, "`value` provided is not equal to the combined `value`s of deployments");
252: 
253:         for (uint256 i = 0; i < deploymentsLength; ++i) { // <= FOUND
254:             this.forceDeployOnAddress{value: _deployments[i].value}(_deployments[i], msg.sender);
255:         }
256:     }

```
['[38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L38-L38)']
```solidity
34:     function setImmutables(address _dest, ImmutableData[] calldata _immutables) external override {
35:         require(msg.sender == address(DEPLOYER_SYSTEM_CONTRACT), "Callable only by the deployer system contract");
36:         unchecked {
37:             uint256 immutablesLength = _immutables.length;
38:             for (uint256 i = 0; i < immutablesLength; ++i) { // <= FOUND
39:                 uint256 index = _immutables[i].index;
40:                 bytes32 value = _immutables[i].value;
41:                 immutableDataStorage[uint256(uint160(_dest))][index] = value;
42:             }
43:         }
44:     }

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L30-L30)']
```solidity
27:     function markFactoryDeps(bool _shouldSendToL1, bytes32[] calldata _hashes) external onlyCallFromBootloader {
28:         unchecked {
29:             uint256 hashesLen = _hashes.length;
30:             for (uint256 i = 0; i < hashesLen; ++i) { // <= FOUND
31:                 _markBytecodeAsPublished(_hashes[i], _shouldSendToL1);
32:             }
33:         }
34:     }

```
['[206](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L206-L254)']
```solidity
194:     function publishPubdataAndClearState(
195:         bytes calldata _totalL2ToL1PubdataAndStateDiffs
196:     ) external onlyCallFromBootloader {
197:         uint256 calldataPtr = 0;
198: 
199:         
200:         uint32 numberOfL2ToL1Logs = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));
201:         require(numberOfL2ToL1Logs <= L2_TO_L1_LOGS_MERKLE_TREE_LEAVES, "Too many L2->L1 logs");
202:         calldataPtr += 4;
203: 
204:         bytes32[] memory l2ToL1LogsTreeArray = new bytes32[](L2_TO_L1_LOGS_MERKLE_TREE_LEAVES);
205:         bytes32 reconstructedChainedLogsHash;
206:         for (uint256 i = 0; i < numberOfL2ToL1Logs; ++i) { // <= FOUND
207:             bytes32 hashedLog = EfficientCall.keccak(
208:                 _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + L2_TO_L1_LOG_SERIALIZE_SIZE]
209:             );
210:             calldataPtr += L2_TO_L1_LOG_SERIALIZE_SIZE;
211:             l2ToL1LogsTreeArray[i] = hashedLog;
212:             reconstructedChainedLogsHash = keccak256(abi.encode(reconstructedChainedLogsHash, hashedLog));
213:         }
214:         require(
215:             reconstructedChainedLogsHash == chainedLogsHash,
216:             "reconstructedChainedLogsHash is not equal to chainedLogsHash"
217:         );
218:         for (uint256 i = numberOfL2ToL1Logs; i < L2_TO_L1_LOGS_MERKLE_TREE_LEAVES; ++i) { // <= FOUND
219:             l2ToL1LogsTreeArray[i] = L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH;
220:         }
221:         uint256 nodesOnCurrentLevel = L2_TO_L1_LOGS_MERKLE_TREE_LEAVES;
222:         while (nodesOnCurrentLevel > 1) {
223:             nodesOnCurrentLevel /= 2;
224:             for (uint256 i = 0; i < nodesOnCurrentLevel; ++i) { // <= FOUND
225:                 l2ToL1LogsTreeArray[i] = keccak256(
226:                     abi.encode(l2ToL1LogsTreeArray[2 * i], l2ToL1LogsTreeArray[2 * i + 1])
227:                 );
228:             }
229:         }
230:         bytes32 l2ToL1LogsTreeRoot = l2ToL1LogsTreeArray[0];
231: 
232:         
233:         uint32 numberOfMessages = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));
234:         calldataPtr += 4;
235:         bytes32 reconstructedChainedMessagesHash;
236:         for (uint256 i = 0; i < numberOfMessages; ++i) { // <= FOUND
237:             uint32 currentMessageLength = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));
238:             calldataPtr += 4;
239:             bytes32 hashedMessage = EfficientCall.keccak(
240:                 _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + currentMessageLength]
241:             );
242:             calldataPtr += currentMessageLength;
243:             reconstructedChainedMessagesHash = keccak256(abi.encode(reconstructedChainedMessagesHash, hashedMessage));
244:         }
245:         require(
246:             reconstructedChainedMessagesHash == chainedMessagesHash,
247:             "reconstructedChainedMessagesHash is not equal to chainedMessagesHash"
248:         );
249: 
250:         
251:         uint32 numberOfBytecodes = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));
252:         calldataPtr += 4;
253:         bytes32 reconstructedChainedL1BytecodesRevealDataHash;
254:         for (uint256 i = 0; i < numberOfBytecodes; ++i) { // <= FOUND
255:             uint32 currentBytecodeLength = uint32(
256:                 bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4])
257:             );
258:             calldataPtr += 4;
259:             reconstructedChainedL1BytecodesRevealDataHash = keccak256(
260:                 abi.encode(
261:                     reconstructedChainedL1BytecodesRevealDataHash,
262:                     Utils.hashL2Bytecode(
263:                         _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + currentBytecodeLength]
264:                     )
265:                 )
266:             );
267:             calldataPtr += currentBytecodeLength;
268:         }
269:         require(
270:             reconstructedChainedL1BytecodesRevealDataHash == chainedL1BytecodesRevealDataHash,
271:             "reconstructedChainedL1BytecodesRevealDataHash is not equal to chainedL1BytecodesRevealDataHash"
272:         );
273: 
274:         
275:         
276:         
277:         
278:         
279:         require(
280:             uint256(uint8(bytes1(_totalL2ToL1PubdataAndStateDiffs[calldataPtr]))) ==
281:                 STATE_DIFF_COMPRESSION_VERSION_NUMBER,
282:             "state diff compression version mismatch"
283:         );
284:         calldataPtr++;
285: 
286:         uint24 compressedStateDiffSize = uint24(bytes3(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 3]));
287:         calldataPtr += 3;
288: 
289:         uint8 enumerationIndexSize = uint8(bytes1(_totalL2ToL1PubdataAndStateDiffs[calldataPtr]));
290:         calldataPtr++;
291: 
292:         bytes calldata compressedStateDiffs = _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr +
293:             compressedStateDiffSize];
294:         calldataPtr += compressedStateDiffSize;
295: 
296:         bytes calldata totalL2ToL1Pubdata = _totalL2ToL1PubdataAndStateDiffs[:calldataPtr];
297: 
298:         require(calldataPtr <= MAX_ALLOWED_PUBDATA_PER_BATCH, "L1 Messenger pubdata is too long");
299: 
300:         uint32 numberOfStateDiffs = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]));
301:         calldataPtr += 4;
302: 
303:         bytes calldata stateDiffs = _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr +

```
['[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L36-L36)']
```solidity
21:     function chunkAndPublishPubdata(bytes calldata _pubdata) external onlyCallFrom(address(L1_MESSENGER_CONTRACT)) {
22:         require(_pubdata.length <= BLOB_SIZE_BYTES * MAX_NUMBER_OF_BLOBS, "pubdata should fit in 2 blobs");
23: 
24:         bytes32[] memory blobHashes = new bytes32[](MAX_NUMBER_OF_BLOBS);
25: 
26:         
27:         
28:         bytes memory totalBlobs = new bytes(BLOB_SIZE_BYTES * MAX_NUMBER_OF_BLOBS);
29: 
30:         assembly {
31:             
32:             let ptr := add(totalBlobs, 0x20)
33:             calldatacopy(ptr, _pubdata.offset, _pubdata.length)
34:         }
35: 
36:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) { // <= FOUND
37:             uint256 start = BLOB_SIZE_BYTES * i;
38: 
39:             
40:             
41:             if (start >= _pubdata.length) {
42:                 break;
43:             }
44: 
45:             bytes32 blobHash;
46:             assembly {
47:                 
48:                 let ptr := add(totalBlobs, 0x20)
49:                 blobHash := keccak256(add(ptr, start), BLOB_SIZE_BYTES)
50:             }
51: 
52:             blobHashes[i] = blobHash;
53:         }
54: 
55:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_ONE_HASH_KEY)), blobHashes[0]);
56:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_TWO_HASH_KEY)), blobHashes[1]);
57:     }

```


</details>

## [NonCritical-15] Using zero as a parameter

### Resolution 
Taking 0 as a valid argument in Solidity without checks can lead to severe security issues. A historical example is the infamous 0x0 address bug where numerous tokens were lost. This happens because '0' can be interpreted as an uninitialized address, leading to transfers to the '0x0' address, effectively burning tokens. Moreover, 0 as a denominator in division operations would cause a runtime exception. It's also often indicative of a logical error in the caller's code. It's important to always validate input and handle edge cases like 0 appropriately. Use `require()` statements to enforce conditions and provide clear error messages to facilitate debugging and safer code.

Num of instances: 9

### Findings 


<details><summary>Click to show findings</summary>

['[98](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L98-L105)']
```solidity
98:     function deposit(
99:         address _l2Receiver,
100:         address _l1Token,
101:         uint256 _amount,
102:         uint256 _l2TxGasLimit,
103:         uint256 _l2TxGasPerPubdataByte
104:     ) external payable returns (bytes32 l2TxHash) {
105:         l2TxHash = deposit(_l2Receiver, _l1Token, _amount, _l2TxGasLimit, _l2TxGasPerPubdataByte, address(0)); // <= FOUND
106:     }

```
['[487](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L487-L503)']
```solidity
487:     function _parseL2WithdrawalMessage(
488:         uint256 _chainId,
489:         bytes memory _l2ToL1message
490:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {
491:         
492:         
493:         
494:         
495:         
496:         
497:         
498:         
499: 
500:         
501:         require(_l2ToL1message.length >= 56, "ShB wrong msg len"); 
502: 
503:         (uint32 functionSignature, uint256 offset) = UnsafeBytes.readUint32(_l2ToL1message, 0); // <= FOUND
504:         if (bytes4(functionSignature) == IMailbox.finalizeEthWithdrawal.selector) {
505:             
506:             (l1Receiver, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset);
507:             (amount, offset) = UnsafeBytes.readUint256(_l2ToL1message, offset);
508:             l1Token = bridgehub.baseToken(_chainId);
509:         } else if (bytes4(functionSignature) == IL1ERC20Bridge.finalizeWithdrawal.selector) {
510:             
511: 
512:             
513: 
514:             
515:             
516:             
517:             require(_l2ToL1message.length == 76, "ShB wrong msg len 2");
518:             (l1Receiver, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset);
519:             (l1Token, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset);
520:             (amount, offset) = UnsafeBytes.readUint256(_l2ToL1message, offset);
521:         } else {
522:             revert("ShB Incorrect message function selector");
523:         }
524:     }

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L79-L79)']
```solidity
79:     function initialize(
80:         StateTransitionManagerInitializeData calldata _initializeData
81:     ) external reentrancyGuardInitializer {
82:         require(_initializeData.governor != address(0), "StateTransition: governor zero");
83:         _transferOwnership(_initializeData.governor);
84: 
85:         genesisUpgrade = _initializeData.genesisUpgrade;
86:         protocolVersion = _initializeData.protocolVersion;
87:         validatorTimelock = _initializeData.validatorTimelock;
88: 
89:         
90:         IExecutor.StoredBatchInfo memory batchZero = IExecutor.StoredBatchInfo(
91:             0,
92:             _initializeData.genesisBatchHash,
93:             _initializeData.genesisIndexRepeatedStorageChanges,
94:             0,
95:             EMPTY_STRING_KECCAK,
96:             DEFAULT_L2_LOGS_TREE_ROOT_HASH,
97:             0,
98:             _initializeData.genesisBatchCommitment
99:         );
100:         storedBatchZero = keccak256(abi.encode(batchZero));
101: 
102:         initialCutHash = keccak256(abi.encode(_initializeData.diamondCut));
103: 
104:         
105:         
106:         assert(L2_TO_L1_LOG_SERIALIZE_SIZE != 2 * 32);
107:     }

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L74-L93)']
```solidity
74:     function proveL1ToL2TransactionStatus(
75:         bytes32 _l2TxHash,
76:         uint256 _l2BatchNumber,
77:         uint256 _l2MessageIndex,
78:         uint16 _l2TxNumberInBatch,
79:         bytes32[] calldata _merkleProof,
80:         TxStatus _status
81:     ) public view returns (bool) {
82:         
83:         
84:         
85:         
86:         
87:         
88:         
89:         
90:         
91:         
92:         L2Log memory l2Log = L2Log({
93:             l2ShardId: 0, // <= FOUND
94:             isService: true,
95:             txNumberInBatch: _l2TxNumberInBatch,
96:             sender: L2_BOOTLOADER_ADDRESS,
97:             key: _l2TxHash,
98:             value: bytes32(uint256(_status))
99:         });
100:         return _proveL2LogInclusion(_l2BatchNumber, _l2MessageIndex, l2Log, _merkleProof);
101:     }

```
['[130](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L130-L133)']
```solidity
130:     function _L2MessageToLog(L2Message memory _message) internal pure returns (L2Log memory) { // <= FOUND
131:         return
132:             L2Log({
133:                 l2ShardId: 0, // <= FOUND
134:                 isService: true,
135:                 txNumberInBatch: _message.txNumberInBatch,
136:                 sender: L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR,
137:                 key: bytes32(uint256(uint160(_message.sender))),
138:                 value: keccak256(_message.data)
139:             });
140:     }

```
['[78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L78-L78)']
```solidity
78:     function _validateTransaction(
79:         bytes32 _suggestedSignedHash,
80:         Transaction calldata _transaction
81:     ) internal returns (bytes4 magic) {
82:         
83:         SystemContractsCaller.systemCallWithPropagatedRevert(
84:             uint32(gasleft()),
85:             address(NONCE_HOLDER_SYSTEM_CONTRACT),
86:             0,
87:             abi.encodeCall(INonceHolder.incrementMinNonceIfEquals, (_transaction.nonce))
88:         );
89: 
90:         
91:         
92:         
93:         
94:         bytes32 txHash = _suggestedSignedHash != bytes32(0) ? _suggestedSignedHash : _transaction.encodeHash();
95: 
96:         
97:         
98:         
99:         uint256 totalRequiredBalance = _transaction.totalRequiredBalance();
100:         require(totalRequiredBalance <= address(this).balance, "Not enough balance for fee + value");
101: 
102:         if (_isValidSignature(txHash, _transaction.signature)) {
103:             magic = ACCOUNT_VALIDATION_SUCCESS_MAGIC;
104:         }
105:     }

```
['[70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L70-L76)']
```solidity
70:     function sendL2ToL1Log(
71:         bool _isService,
72:         bytes32 _key,
73:         bytes32 _value
74:     ) external onlyCallFromSystemContract returns (uint256 logIdInMerkleTree) {
75:         L2ToL1Log memory l2ToL1Log = L2ToL1Log({
76:             l2ShardId: 0, // <= FOUND
77:             isService: _isService,
78:             txNumberInBlock: SYSTEM_CONTEXT_CONTRACT.txNumberInBlock(),
79:             sender: msg.sender,
80:             key: _key,
81:             value: _value
82:         });
83:         logIdInMerkleTree = _processL2ToL1Log(l2ToL1Log);
84: 
85:         
86:         
87:         
88:         
89:         uint256 gasToPay = keccakGasCost(L2_TO_L1_LOG_SERIALIZE_SIZE) + 2 * keccakGasCost(64);
90:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), 0);
91:     }

```
['[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L116-L126)']
```solidity
116:     function sendToL1(bytes calldata _message) external override returns (bytes32 hash) { // <= FOUND
117:         uint256 gasBeforeMessageHashing = gasleft();
118:         hash = EfficientCall.keccak(_message);
119:         uint256 gasSpentOnMessageHashing = gasBeforeMessageHashing - gasleft();
120: 
121:         
122:         chainedMessagesHash = keccak256(abi.encode(chainedMessagesHash, hash));
123: 
124:         
125:         L2ToL1Log memory l2ToL1Log = L2ToL1Log({
126:             l2ShardId: 0, // <= FOUND
127:             isService: true,
128:             txNumberInBlock: SYSTEM_CONTEXT_CONTRACT.txNumberInBlock(),
129:             sender: address(this),
130:             key: bytes32(uint256(uint160(msg.sender))),
131:             value: hash
132:         });
133:         _processL2ToL1Log(l2ToL1Log);
134: 
135:         
136:         uint256 pubdataLen;
137:         unchecked {
138:             
139:             
140:             pubdataLen = 4 + _message.length + L2_TO_L1_LOG_SERIALIZE_SIZE;
141:         }
142: 
143:         
144:         
145:         
146:         
147:         
148:         uint256 gasToPay = keccakGasCost(L2_TO_L1_LOG_SERIALIZE_SIZE) +
149:             3 *
150:             keccakGasCost(64) +
151:             gasSpentOnMessageHashing +
152:             COMPUTATIONAL_PRICE_FOR_PUBDATA *
153:             pubdataLen;
154:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), uint32(pubdataLen));
155: 
156:         emit L1MessageSent(msg.sender, hash, _message);
157:     }

```
['[344](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L344-L345)']
```solidity
344:     function burnGas(uint32 _gasToPay, uint32 _pubdataToSpend) internal view { // <= FOUND
345:         bool precompileCallSuccess = unsafePrecompileCall( // <= FOUND
346:             0, 
347:             _gasToPay,
348:             _pubdataToSpend
349:         );
350:         require(precompileCallSuccess, "Failed to charge gas");
351:     }

```


</details>

## [NonCritical-16] No license selected for project

### Resolution 
Not selecting a license for a software project, particularly in the context of blockchain and smart contracts, poses significant risks and uncertainties. A license explicitly defines how others can use, modify, distribute, and contribute to your code. Without it, the legal status of a project remains unclear, potentially deterring usage and contributions, and raising concerns about intellectual property rights. To mitigate these risks, it is advisable to choose an appropriate open-source license. This fosters a clear understanding of how your project can be utilized and encourages collaboration and adoption within the community, aligning with the open and collaborative nature of blockchain technology.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[1](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransitionBase.sol#L1-L1)']
```solidity
1: // SPDX-License-Identifier: UNLICENSED // <= FOUND

```


</details>

## [NonCritical-17] Pure function accesses storage

### Resolution 
Pure functions by definition should not read or write to storage (state variables), however due to a bug with storage pointers this can slip past the compiler and thus a pure function can at times read storage whilst being declared as pure. Below are such instances

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L51-L51)']
```solidity
50:     function keccakGasCost(uint256 _length) internal pure returns (uint256) {
51:         return KECCAK_ROUND_GAS_COST * (_length / KECCAK_ROUND_NUMBER_OF_BYTES + 1); // <= FOUND
52:     }

```
['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L62-L62)']
```solidity
61:     function sha256GasCost(uint256 _length) internal pure returns (uint256) {
62:         return SHA256_ROUND_GAS_COST * ((_length + 8) / SHA256_ROUND_NUMBER_OF_BYTES + 1); // <= FOUND
63:     }

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L37-L39)']
```solidity
37:     function undoL1ToL2Alias(address l2Address) internal pure returns (address l1Address) { // <= FOUND
38:         unchecked {
39:             l1Address = address(uint160(l2Address) - offset); // <= FOUND
40:         }
41:     }

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L27-L27)']
```solidity
27:     function applyL1ToL2Alias(address l1Address) internal pure returns (address l2Address) { // <= FOUND
28:         unchecked {
29:             l2Address = address(uint160(l1Address) + offset);
30:         }
31:     }

```


</details>

## [NonCritical-18] Events regarding state variable changes should emit the previous state variable value

### Resolution 
Modify such events to contain the previous value of the state variable as demonstrated in the example below

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L29-L29)']
```solidity
29: event NewExecutionDelay(uint256 _newExecutionDelay);

```


</details>

## [NonCritical-19] In functions which accept an address as a parameter, there should be a zero address check to prevent bugs

### Resolution 
In smart contract development, especially with Solidity, it's crucial to validate inputs to functions. When a function accepts an Ethereum address as a parameter, implementing a zero address check (i.e., ensuring the address is not `0x0`) is a best practice to prevent potential bugs and vulnerabilities. The zero address (`0x0`) is a default value and generally indicates an uninitialized or invalid state. Passing the zero address to certain functions can lead to unintended behaviors, like funds getting locked permanently or transactions failing silently. By checking for and rejecting the zero address, developers can ensure that the function operates as intended and interacts only with valid Ethereum addresses. This check enhances the contract's robustness and security.

Num of instances: 92

### Findings 


<details><summary>Click to show findings</summary>

['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63-L63)']
```solidity
63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external 

```
['[75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L75-L75)']
```solidity
75:     function l2TokenAddress(address _l1Token) external view returns (address) 

```
['[98](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L98-L98)']
```solidity
98:     function deposit(
99:         address _l2Receiver,
100:         address _l1Token,
101:         uint256 _amount,
102:         uint256 _l2TxGasLimit,
103:         uint256 _l2TxGasPerPubdataByte
104:     ) external payable returns (bytes32 l2TxHash) 

```
['[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L133-L133)']
```solidity
133:     function deposit(
134:         address _l2Receiver,
135:         address _l1Token,
136:         uint256 _amount,
137:         uint256 _l2TxGasLimit,
138:         uint256 _l2TxGasPerPubdataByte,
139:         address _refundRecipient
140:     ) public payable nonReentrant returns (bytes32 l2TxHash) 

```
['[160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L160-L160)']
```solidity
160:     function _depositFundsToSharedBridge(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) 

```
['[176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L176-L176)']
```solidity
176:     function claimFailedDeposit(
177:         address _depositSender,
178:         address _l1Token,
179:         bytes32 _l2TxHash,
180:         uint256 _l2BatchNumber,
181:         uint256 _l2MessageIndex,
182:         uint16 _l2TxNumberInBatch,
183:         bytes32[] calldata _merkleProof
184:     ) external nonReentrant 

```
['[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L116-L116)']
```solidity
116:     function transferFundsFromLegacy(address _token, address _target, uint256 _targetChainId) external onlyOwner 

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L142-L142)']
```solidity
142:     function initializeChainGovernance(uint256 _chainId, address _l2BridgeAddress) external onlyOwner 

```
['[148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L148-L148)']
```solidity
148:     function bridgehubDepositBaseToken(
149:         uint256 _chainId,
150:         address _prevMsgSender,
151:         address _l1Token,
152:         uint256 _amount
153:     ) external payable virtual onlyBridgehubOrEra(_chainId) 

```
['[173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L173-L173)']
```solidity
173:     function _depositFunds(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) 

```
['[243](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L243-L243)']
```solidity
243:     function _getDepositL2Calldata(
244:         address _l1Sender,
245:         address _l2Receiver,
246:         address _l1Token,
247:         uint256 _amount
248:     ) internal view returns (bytes memory) 

```
['[254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L254-L254)']
```solidity
254:     function _getERC20Getters(address _token) internal view returns (bytes memory) 

```
['[277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L277-L277)']
```solidity
277:     function claimFailedDeposit(
278:         uint256 _chainId,
279:         address _depositSender,
280:         address _l1Token,
281:         uint256 _amount,
282:         bytes32 _l2TxHash,
283:         uint256 _l2BatchNumber,
284:         uint256 _l2MessageIndex,
285:         uint16 _l2TxNumberInBatch,
286:         bytes32[] calldata _merkleProof
287:     ) external override 

```
['[303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L303-L303)']
```solidity
303:     function _claimFailedDeposit(
304:         bool _checkedInLegacyBridge,
305:         uint256 _chainId,
306:         address _depositSender,
307:         address _l1Token,
308:         uint256 _amount,
309:         bytes32 _l2TxHash,
310:         uint256 _l2BatchNumber,
311:         uint256 _l2MessageIndex,
312:         uint16 _l2TxNumberInBatch,
313:         bytes32[] calldata _merkleProof
314:     ) internal nonReentrant 

```
['[644](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L644-L644)']
```solidity
644:     function claimFailedDepositLegacyErc20Bridge(
645:         address _depositSender,
646:         address _l1Token,
647:         uint256 _amount,
648:         bytes32 _l2TxHash,
649:         uint256 _l2BatchNumber,
650:         uint256 _l2MessageIndex,
651:         uint16 _l2TxNumberInBatch,
652:         bytes32[] calldata _merkleProof
653:     ) external override onlyLegacyBridge 

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L41-L41)']
```solidity
41:     function initialize(address _owner) external reentrancyGuardInitializer 

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin 

```
['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L82-L82)']
```solidity
82:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner 

```
['[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L92-L92)']
```solidity
92:     function removeStateTransitionManager(address _stateTransitionManager) external onlyOwner 

```
['[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L101-L101)']
```solidity
101:     function addToken(address _token) external onlyOwner 

```
['[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108-L108)']
```solidity
108:     function setSharedBridge(address _sharedBridge) external onlyOwner 

```
['[256](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L256-L256)']
```solidity
256:     function updateSecurityCouncil(address _newSecurityCouncil) external onlySelf 

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin 

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132-L132)']
```solidity
132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin 

```
['[177](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L177-L177)']
```solidity
177:     function _setChainIdUpgrade(uint256 _chainId, address _chainContract) internal 

```
['[230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L230-L230)']
```solidity
230:     function registerAlreadyDeployedStateTransition(
231:         uint256 _chainId,
232:         address _stateTransitionContract
233:     ) external onlyOwner 

```
['[78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L78-L78)']
```solidity
78:     function addValidator(uint256 _chainId, address _newValidator) external onlyChainAdmin(_chainId) 

```
['[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L87-L87)']
```solidity
87:     function removeValidator(uint256 _chainId, address _validator) external onlyChainAdmin(_chainId) 

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L23-L23)']
```solidity
23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin 

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L45-L45)']
```solidity
45:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager 

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L112-L112)']
```solidity
112:     function isValidator(address _address) external view returns (bool) 

```
['[163](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L163-L163)']
```solidity
163:     function isFacetFreezable(address _facet) external view returns (bool isFreezable) 

```
['[217](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L217-L217)']
```solidity
217:     function facetFunctionSelectors(address _facet) external view returns (bytes4[] memory) 

```
['[197](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L197-L197)']
```solidity
197:     function requestL2Transaction(
198:         address _contractL2,
199:         uint256 _l2Value,
200:         bytes calldata _calldata,
201:         uint256 _l2GasLimit,
202:         uint256 _l2GasPerPubdataByteLimit,
203:         bytes[] calldata _factoryDeps,
204:         address _refundRecipient
205:     ) external payable returns (bytes32 canonicalTxHash) 

```
['[163](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L163-L163)']
```solidity
163:     function _upgradeVerifier(address _newVerifier, VerifierParams calldata _verifierParams) internal 

```
['[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L101-L101)']
```solidity
101:     function computeCreate2Address(
102:         address _sender,
103:         bytes32 _salt,
104:         bytes32 _bytecodeHash,
105:         bytes32 _constructorInputHash
106:     ) internal pure returns (address) 

```
['[189](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L189-L189)']
```solidity
189:     function _saveFacetIfNew(address _facet) private 

```
['[205](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L205-L205)']
```solidity
205:     function _addOneFunction(address _facet, bytes4 _selector, bool _isSelectorFreezable) private 

```
['[228](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L228-L228)']
```solidity
228:     function _removeOneFunction(address _facet, bytes4 _selector) private 

```
['[257](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L257-L257)']
```solidity
257:     function _removeFacet(address _facet) private 

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L27-L27)']
```solidity
27:     function applyL1ToL2Alias(address l1Address) internal pure returns (address l2Address) 

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L37-L37)']
```solidity
37:     function undoL1ToL2Alias(address l2Address) internal pure returns (address l1Address) 

```
['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L35-L35)']
```solidity
35:     function storeAccountConstructingCodeHash(address _address, bytes32 _hash) external override onlyDeployer 

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L46-L46)']
```solidity
46:     function storeAccountConstructedCodeHash(address _address, bytes32 _hash) external override onlyDeployer 

```
['[54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L54-L54)']
```solidity
54:     function markAccountCodeHashAsConstructed(address _address) external override onlyDeployer 

```
['[68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L68-L68)']
```solidity
68:     function _storeCodeHash(address _address, bytes32 _hash) internal 

```
['[78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L78-L78)']
```solidity
78:     function getRawCodeHash(address _address) public view override returns (bytes32 codeHash) 

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L21-L21)']
```solidity
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable 

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L34-L34)']
```solidity
34:     function getAccountInfo(address _address) external view returns (AccountInfo memory info) 

```
['[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L40-L40)']
```solidity
40:     function extendedAccountVersion(address _address) public view returns (AccountAbstractionVersion) 

```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L58-L58)']
```solidity
58:     function _storeAccountInfo(address _address, AccountInfo memory _newInfo) internal 

```
['[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L95-L95)']
```solidity
95:     function getNewAddressCreate2(
96:         address _sender,
97:         bytes32 _bytecodeHash,
98:         bytes32 _salt,
99:         bytes calldata _input
100:     ) public view override returns (address newAddress) 

```
['[115](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L115-L115)']
```solidity
115:     function getNewAddressCreate(
116:         address _sender,
117:         uint256 _senderNonce
118:     ) public pure override returns (address newAddress) 

```
['[213](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L213-L213)']
```solidity
213:     function forceDeployOnAddress(ForceDeployment calldata _deployment, address _sender) external payable onlySelf 

```
['[258](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L258-L258)']
```solidity
258:     function _nonSystemDeployOnAddress(
259:         bytes32 _bytecodeHash,
260:         address _newAddress,
261:         AccountAbstractionVersion _aaVersion,
262:         bytes calldata _input
263:     ) internal 

```
['[283](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L283-L283)']
```solidity
283:     function _performDeployOnAddress(
284:         bytes32 _bytecodeHash,
285:         address _newAddress,
286:         AccountAbstractionVersion _aaVersion,
287:         bytes calldata _input
288:     ) internal 

```
['[309](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L309-L309)']
```solidity
309:     function _storeConstructingByteCodeHashOnAddress(address _newAddress, bytes32 _bytecodeHash) internal 

```
['[321](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L321-L321)']
```solidity
321:     function _constructContract(
322:         address _sender,
323:         address _newAddress,
324:         bytes32 _bytecodeHash,
325:         bytes calldata _input,
326:         bool _isSystem,
327:         bool _callConstructor
328:     ) internal 

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L27-L27)']
```solidity
27:     function getImmutable(address _dest, uint256 _index) external view override returns (bytes32) 

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L34-L34)']
```solidity
34:     function setImmutables(address _dest, ImmutableData[] calldata _immutables) external override 

```
['[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L32-L32)']
```solidity
32:     function transferFromTo(address _from, address _to, uint256 _amount) external override 

```
['[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L64-L64)']
```solidity
64:     function mint(address _account, uint256 _amount) external override onlyCallFromBootloader 

```
['[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L72-L72)']
```solidity
72:     function withdraw(address _l1Receiver) external payable override 

```
['[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L85-L85)']
```solidity
85:     function withdrawWithMessage(address _l1Receiver, bytes memory _additionalData) external payable override 

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L112-L112)']
```solidity
112:     function _getL1WithdrawMessage(address _to, uint256 _amount) internal pure returns (bytes memory) 

```
['[117](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L117-L117)']
```solidity
117:     function _getExtendedWithdrawMessage(
118:         address _to,
119:         uint256 _amount,
120:         address _sender,
121:         bytes memory _additionalData
122:     ) internal pure returns (bytes memory) 

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L46-L46)']
```solidity
46:     function getMinNonce(address _address) public view returns (uint256) 

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L57-L57)']
```solidity
57:     function getRawNonce(address _address) public view returns (uint256) 

```
['[125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L125-L125)']
```solidity
125:     function getDeploymentNonce(address _address) external view returns (uint256 deploymentNonce) 

```
['[135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L135-L135)']
```solidity
135:     function incrementDeploymentNonce(address _address) external returns (uint256 prevDeploymentNonce) 

```
['[154](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L154-L154)']
```solidity
154:     function isNonceUsed(address _address, uint256 _nonce) public view returns (bool) 

```
['[166](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L166-L166)']
```solidity
166:     function validateNonceUsage(address _address, uint256 _key, bool _shouldBeUsed) external view 

```
['[99](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L99-L99)']
```solidity
99:     function setTxOrigin(address _newOrigin) external onlyCallFromBootloader 

```
['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L35-L35)']
```solidity
35:     function gasBoundCall(address _to, uint256 _maxTotalGas, bytes calldata _data) external payable 

```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L58-L58)']
```solidity
58:     function call(
59:         uint256 _gas,
60:         address _address,
61:         uint256 _value,
62:         bytes calldata _data,
63:         bool _isSystem
64:     ) internal returns (bytes memory returnData) 

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L74-L74)']
```solidity
74:     function staticCall(
75:         uint256 _gas,
76:         address _address,
77:         bytes calldata _data
78:     ) internal view returns (bytes memory returnData) 

```
['[88](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L88-L88)']
```solidity
88:     function delegateCall(
89:         uint256 _gas,
90:         address _address,
91:         bytes calldata _data
92:     ) internal returns (bytes memory returnData) 

```
['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L105-L105)']
```solidity
105:     function mimicCall(
106:         uint256 _gas,
107:         address _address,
108:         bytes calldata _data,
109:         address _whoToMimic,
110:         bool _isConstructor,
111:         bool _isSystem
112:     ) internal returns (bytes memory returnData) 

```
['[124](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L124-L124)']
```solidity
124:     function rawCall(
125:         uint256 _gas,
126:         address _address,
127:         uint256 _value,
128:         bytes calldata _data,
129:         bool _isSystem
130:     ) internal returns (bool success) 

```
['[159](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L159-L159)']
```solidity
159:     function rawStaticCall(uint256 _gas, address _address, bytes calldata _data) internal view returns (bool success) 

```
['[173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L173-L173)']
```solidity
173:     function rawDelegateCall(uint256 _gas, address _address, bytes calldata _data) internal returns (bool success) 

```
['[191](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L191-L191)']
```solidity
191:     function rawMimicCall(
192:         uint256 _gas,
193:         address _address,
194:         bytes calldata _data,
195:         address _whoToMimic,
196:         bool _isConstructor,
197:         bool _isSystem
198:     ) internal returns (bool success) 

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L11-L11)']
```solidity
11:     function encodeAddress(address _val) internal pure returns (bytes memory encoded) 

```
['[338](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L338-L338)']
```solidity
338:     function isSystemContract(address _address) internal pure returns (bool) 

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L37-L37)']
```solidity
37:     function systemCall(uint32 gasLimit, address to, uint256 value, bytes memory data) internal returns (bool success) 

```
['[76](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L76-L76)']
```solidity
76:     function systemCallWithReturndata(
77:         uint32 gasLimit,
78:         address to,
79:         uint128 value,
80:         bytes memory data
81:     ) internal returns (bool success, bytes memory returnData) 

```
['[109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L109-L109)']
```solidity
109:     function _deployL2Token(address _l1Token, bytes calldata _data) internal returns (address) 

```
['[138](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L138-L138)']
```solidity
138:     function _getL1WithdrawMessage(
139:         address _to,
140:         address _l1Token,
141:         uint256 _amount
142:     ) internal pure returns (bytes memory) 

```
['[149](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L149-L149)']
```solidity
149:     function l2TokenAddress(address _l1Token) public view override returns (address) 

```
['[157](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L157-L157)']
```solidity
157:     function _getCreate2Salt(address _l1Token) internal pure returns (bytes32 salt) 

```
['[145](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L145-L145)']
```solidity
145:     function bridgeMint(address _to, uint256 _amount) external override onlyBridge 

```
['[154](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L154-L154)']
```solidity
154:     function bridgeBurn(address _from, uint256 _amount) external override onlyBridge 

```


</details>

## [NonCritical-20] Enum values should be used in place of constant array indexes

### Resolution 
Create a commented enum value to use in place of constant array indexes, this makes the code far easier to understand

Num of instances: 27

### Findings 


<details><summary>Click to show findings</summary>

['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L41-L41)']
```solidity
41:         s.storedBatchHashes[0] = _initializeData.storedBatchZero; // <= FOUND

```
['[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L39-L39)']
```solidity
39:         uint8 pubdataSource = uint8(bytes1(_newBatch.pubdataCommitments[0])); // <= FOUND

```
['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L55-L57)']
```solidity
55:             
56:             
57:             blobHashes[0] = logOutput.blob1Hash; // <= FOUND

```
['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L55-L55)']
```solidity
55:             blobHashes[0] = logOutput.blob1Hash; // <= FOUND

```
['[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L67-L67)']
```solidity
67:             blobCommitments[0] = bytes32( // <= FOUND
68:                 _newBatch.pubdataCommitments[_newBatch.pubdataCommitments.length - 32:_newBatch
69:                     .pubdataCommitments
70:                     .length]
71:             );

```
['[287](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L287-L288)']
```solidity
287:         
288:         s.l2SystemContractsUpgradeBatchNumber = _newBatchesData[0].batchNumber; // <= FOUND

```
['[214](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L214-L214)']
```solidity
214:             bytes4 selector0 = ds.facetToSelectors[_facet].selectors[0]; // <= FOUND

```
['[54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L54-L54)']
```solidity
54:         require(_transaction.reserved[0] == 0, "ue"); // <= FOUND

```
['[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L72-L72)']
```solidity
72:             } else if (_transaction.data[0] >= 0x80) { // <= FOUND

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L96-L98)']
```solidity
96:             
97:             
98:             if (_transaction.reserved[0] != 0) { // <= FOUND

```
['[75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L75-L75)']
```solidity
75:         uint8 version = uint8(_bytecodeHash[0]); // <= FOUND

```
['[230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L230-L230)']
```solidity
230:         bytes32 l2ToL1LogsTreeRoot = l2ToL1LogsTreeArray[0]; // <= FOUND

```
['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L55-L55)']
```solidity
55:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_ONE_HASH_KEY)), blobHashes[0]); // <= FOUND

```
['[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L29-L30)']
```solidity
29:                 
30:                 encoded[0] = (_val == 0) ? bytes1(uint8(128)) : bytes1(uint8(_val)); // <= FOUND

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L34-L34)']
```solidity
34:                 encoded[0] = bytes1(uint8(hbs + 0x81)); // <= FOUND

```
['[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L64-L64)']
```solidity
64:                 encoded[0] = bytes1(uint8(_len + _offset)); // <= FOUND

```
['[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L69-L69)']
```solidity
69:                 encoded[0] = bytes1(uint8(_offset + hbs + 56)); // <= FOUND

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L96-L96)']
```solidity
96:         if (_transaction.reserved[0] != 0) { // <= FOUND

```
['[56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L56-L56)']
```solidity
56:             blobHashes[1] = logOutput.blob2Hash; // <= FOUND

```
['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L55-L55)']
```solidity
55:         require(_transaction.reserved[1] <= type(uint160).max, "uf"); // <= FOUND

```
['[76](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L76-L76)']
```solidity
76:         require(version == 1 && _bytecodeHash[1] == bytes1(0), "Incorrectly formatted bytecodeHash"); // <= FOUND

```
['[56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L56-L56)']
```solidity
56:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_TWO_HASH_KEY)), blobHashes[1]); // <= FOUND

```
['[52](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L52-L52)']
```solidity
52:         return _bytecodeHash[1] == 0x00; // <= FOUND

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L57-L57)']
```solidity
57:         return _bytecodeHash[1] == 0x01; // <= FOUND

```
['[56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L56-L56)']
```solidity
56:         require(_transaction.reserved[2] == 0, "ug"); // <= FOUND

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L46-L46)']
```solidity
46:             codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3])); // <= FOUND

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L57-L57)']
```solidity
57:         require(_transaction.reserved[3] == 0, "uo"); // <= FOUND

```


</details>

## [NonCritical-21] Max should be used in place of 2**n - 1

### Resolution 
In Solidity, using .max instead of the expression 2**<n> - 1 to represent the maximum value of a number type leads to improved code readability and maintainability. By employing the built-in .max property, developers can easily convey their intent to use the highest possible value for a given type, such as uint256.max. This enhances code clarity and reduces the likelihood of mistakes caused by misinterpreting the meaning of the expression 2**<n> - 1. Adopting .max also simplifies code updates, as it eliminates the need to manually adjust the expression when changing the number type or bit length, promoting more robust and maintainable smart contracts.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[94](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L94-L94)']
```solidity
94: uint256 constant MAX_MSG_VALUE = 2 ** 128 - 1; // <= FOUND

```


</details>

## [NonCritical-22] Revert statements within external and public functions can be used to perform DOS attacks

### Resolution 
In Solidity, 'revert' statements are used to undo changes and throw an exception when certain conditions are not met. However, in public and external functions, improper use of `revert` can be exploited for Denial of Service (DoS) attacks. An attacker can intentionally trigger these 'revert' conditions, causing legitimate transactions to consistently fail. For example, if a function relies on specific conditions from user input or contract state, an attacker could manipulate these to continually force reverts, blocking the function's execution. Therefore, it's crucial to design contract logic to handle exceptions properly and avoid scenarios where `revert` can be predictably triggered by malicious actors. This includes careful input validation and considering alternative design patterns that are less susceptible to such abuses.

Num of instances: 9

### Findings 


<details><summary>Click to show findings</summary>

['[80](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L80-L80)']
```solidity
78:     function addValidator(uint256 _chainId, address _newValidator) external onlyChainAdmin(_chainId) {
79:         if (validators[_chainId][_newValidator]) {
80:             revert AddressAlreadyValidator(_chainId); // <= FOUND
81:         }
82:         validators[_chainId][_newValidator] = true;
83:         emit ValidatorAdded(_chainId, _newValidator);
84:     }

```
['[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L89-L89)']
```solidity
87:     function removeValidator(uint256 _chainId, address _validator) external onlyChainAdmin(_chainId) {
88:         if (!validators[_chainId][_validator]) {
89:             revert ValidatorDoesNotExist(_chainId); // <= FOUND
90:         }
91:         validators[_chainId][_validator] = false;
92:         emit ValidatorRemoved(_chainId, _validator);
93:     }

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L37-L37)']
```solidity
24:     function getTransactionHashes(
25:         Transaction calldata _transaction
26:     ) external view override returns (bytes32 txHash, bytes32 signedTxHash) {
27:         signedTxHash = _transaction.encodeHash();
28:         if (_transaction.txType == EIP_712_TX_TYPE) {
29:             txHash = keccak256(bytes.concat(signedTxHash, EfficientCall.keccak(_transaction.signature)));
30:         } else if (_transaction.txType == LEGACY_TX_TYPE) {
31:             txHash = encodeLegacyTransactionHash(_transaction);
32:         } else if (_transaction.txType == EIP_1559_TX_TYPE) {
33:             txHash = encodeEIP1559TransactionHash(_transaction);
34:         } else if (_transaction.txType == EIP_2930_TX_TYPE) {
35:             txHash = encodeEIP2930TransactionHash(_transaction);
36:         } else {
37:             revert("Unsupported tx type"); // <= FOUND
38:         }
39:     }

```
['[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L28-L28)']
```solidity
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable {
22:         require(msg.sender == FORCE_DEPLOYER, "Can only be called by FORCE_DEPLOYER");
23: 
24:         require(_delegateTo.code.length > 0, "Delegatee is an EOA");
25:         (bool success, bytes memory returnData) = _delegateTo.delegatecall(_calldata);
26:         assembly {
27:             if iszero(success) {
28:                 revert(add(returnData, 0x20), mload(returnData)) // <= FOUND
29:             }
30:         }
31:     }

```
['[170](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L170-L172)']
```solidity
166:     function validateNonceUsage(address _address, uint256 _key, bool _shouldBeUsed) external view {
167:         bool isUsed = isNonceUsed(_address, _key);
168: 
169:         if (isUsed && !_shouldBeUsed) {
170:             revert("Reusing the same nonce twice"); // <= FOUND
171:         } else if (!isUsed && _shouldBeUsed) {
172:             revert("The nonce was not set as used"); // <= FOUND
173:         }
174:     }

```
['[394](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L394-L394)']
```solidity
341:     function setL2Block(
342:         uint128 _l2BlockNumber,
343:         uint128 _l2BlockTimestamp,
344:         bytes32 _expectedPrevL2BlockHash,
345:         bool _isFirstInBatch,
346:         uint128 _maxVirtualBlocksToCreate
347:     ) external onlyCallFromBootloader {
348:         
349:         if (_isFirstInBatch) {
350:             uint128 currentBatchTimestamp = currentBatchInfo.timestamp;
351:             require(
352:                 _l2BlockTimestamp >= currentBatchTimestamp,
353:                 "The timestamp of the L2 block must be greater than or equal to the timestamp of the current batch"
354:             );
355:             require(_maxVirtualBlocksToCreate > 0, "There must be a virtual block created at the start of the batch");
356:         }
357: 
358:         (uint128 currentL2BlockNumber, uint128 currentL2BlockTimestamp) = getL2BlockNumberAndTimestamp();
359: 
360:         if (currentL2BlockNumber == 0 && currentL2BlockTimestamp == 0) {
361:             
362:             
363:             _upgradeL2Blocks(_l2BlockNumber, _expectedPrevL2BlockHash, _isFirstInBatch);
364: 
365:             _setNewL2BlockData(_l2BlockNumber, _l2BlockTimestamp, _expectedPrevL2BlockHash);
366:         } else if (currentL2BlockNumber == _l2BlockNumber) {
367:             require(!_isFirstInBatch, "Can not reuse L2 block number from the previous batch");
368:             require(currentL2BlockTimestamp == _l2BlockTimestamp, "The timestamp of the same L2 block must be same");
369:             require(
370:                 _expectedPrevL2BlockHash == _getLatest257L2blockHash(_l2BlockNumber - 1),
371:                 "The previous hash of the same L2 block must be same"
372:             );
373:             require(_maxVirtualBlocksToCreate == 0, "Can not create virtual blocks in the middle of the miniblock");
374:         } else if (currentL2BlockNumber + 1 == _l2BlockNumber) {
375:             
376:             bytes32 prevL2BlockHash = _getLatest257L2blockHash(currentL2BlockNumber - 1);
377: 
378:             bytes32 pendingL2BlockHash = _calculateL2BlockHash(
379:                 currentL2BlockNumber,
380:                 currentL2BlockTimestamp,
381:                 prevL2BlockHash,
382:                 currentL2BlockTxsRollingHash
383:             );
384: 
385:             require(_expectedPrevL2BlockHash == pendingL2BlockHash, "The current L2 block hash is incorrect");
386:             require(
387:                 _l2BlockTimestamp > currentL2BlockTimestamp,
388:                 "The timestamp of the new L2 block must be greater than the timestamp of the previous L2 block"
389:             );
390: 
391:             
392:             _setNewL2BlockData(_l2BlockNumber, _l2BlockTimestamp, _expectedPrevL2BlockHash);
393:         } else {
394:             revert("Invalid new L2 block number"); // <= FOUND
395:         }
396: 
397:         _setVirtualBlock(_l2BlockNumber, _maxVirtualBlocksToCreate, _l2BlockTimestamp);
398:     }

```
['[161](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L161-L161)']
```solidity
159:     function name() public view override returns (string memory) {
160:         
161:         if (availableGetters.ignoreName) revert(); // <= FOUND
162:         return super.name();
163:     }

```
['[167](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L167-L167)']
```solidity
165:     function symbol() public view override returns (string memory) {
166:         
167:         if (availableGetters.ignoreSymbol) revert(); // <= FOUND
168:         return super.symbol();
169:     }

```
['[173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L173-L173)']
```solidity
171:     function decimals() public view override returns (uint8) {
172:         
173:         if (availableGetters.ignoreDecimals) revert(); // <= FOUND
174:         return decimals_;
175:     }

```


</details>

## [NonCritical-23] Reverts should use custom errors instead of strings

### Resolution 
Custom error codes should be used in place of strings for revert statements in Solidity contracts to enhance efficiency and reduce gas costs. String-based error messages consume more bytecode and storage, increasing the overall gas consumption during contract deployment and execution

Num of instances: 11

### Findings 


<details><summary>Click to show findings</summary>

['[522](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L522-L522)']
```solidity
522:             revert("ShB Incorrect message function selector"); // <= FOUND

```
['[184](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L184-L184)']
```solidity
184:                 revert("ul"); // <= FOUND

```
['[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L116-L116)']
```solidity
116:                 revert("C");  // <= FOUND

```
['[287](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L287-L287)']
```solidity
287:                     revert("I");  // <= FOUND

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L37-L37)']
```solidity
37:             revert("Unsupported tx type"); // <= FOUND

```
['[242](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L242-L242)']
```solidity
242:                 revert("unsupported operation"); // <= FOUND

```
['[170](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L170-L170)']
```solidity
170:             revert("Reusing the same nonce twice"); // <= FOUND

```
['[172](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L172-L172)']
```solidity
172:             revert("The nonce was not set as used"); // <= FOUND

```
['[394](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L394-L394)']
```solidity
394:             revert("Invalid new L2 block number"); // <= FOUND

```
['[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L114-L114)']
```solidity
112:             
113:             
114:             revert("Encoding unsupported tx"); // <= FOUND

```
['[388](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L388-L388)']
```solidity
388:             revert("Unsupported paymaster flow"); // <= FOUND

```


</details>

## [NonCritical-24] Functions which are either private or internal should have a preceding _ in their name

### Resolution 
Add a preceding underscore to the function name, take care to refactor where there functions are called

Num of instances: 98

### Findings 


<details><summary>Click to show findings</summary>

['[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L90-L90)']
```solidity
90:     function sendMessageToL1(bytes memory _message) internal returns (bytes32) 

```
['[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L101-L101)']
```solidity
101:     function computeCreate2Address(
102:         address _sender,
103:         bytes32 _salt,
104:         bytes32 _bytecodeHash,
105:         bytes32 _constructorInputHash
106:     ) internal pure returns (address) 

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L11-L11)']
```solidity
11:     function uncheckedInc(uint256 _number) internal pure returns (uint256) 

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UncheckedMath.sol#L17-L17)']
```solidity
17:     function uncheckedAdd(uint256 _lhs, uint256 _rhs) internal pure returns (uint256) 

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L19-L19)']
```solidity
19:     function readUint32(bytes memory _bytes, uint256 _start) internal pure returns (uint32 result, uint256 offset) 

```
['[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L26-L26)']
```solidity
26:     function readAddress(bytes memory _bytes, uint256 _start) internal pure returns (address result, uint256 offset) 

```
['[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L33-L33)']
```solidity
33:     function readUint256(bytes memory _bytes, uint256 _start) internal pure returns (uint256 result, uint256 offset) 

```
['[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L40-L40)']
```solidity
40:     function readBytes32(bytes memory _bytes, uint256 _start) internal pure returns (bytes32 result, uint256 offset) 

```
['[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L87-L87)']
```solidity
87:     function getDiamondStorage() internal pure returns (DiamondStorage storage diamondStorage) 

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L96-L96)']
```solidity
96:     function diamondCut(DiamondCutData memory _diamondCut) internal 

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L18-L18)']
```solidity
18:     function get(Uint32Map storage _map, uint256 _index) internal view returns (uint32 result) 

```
['[38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L38-L38)']
```solidity
38:     function set(Uint32Map storage _map, uint256 _index, uint32 _value) internal 

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L18-L18)']
```solidity
18:     function calculateRoot(
19:         bytes32[] calldata _path,
20:         uint256 _index,
21:         bytes32 _itemHash
22:     ) internal pure returns (bytes32) 

```
['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L35-L35)']
```solidity
35:     function getFirstUnprocessedPriorityTx(Queue storage _queue) internal view returns (uint256) 

```
['[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L40-L40)']
```solidity
40:     function getTotalPriorityTxs(Queue storage _queue) internal view returns (uint256) 

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L45-L45)']
```solidity
45:     function getSize(Queue storage _queue) internal view returns (uint256) 

```
['[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L50-L50)']
```solidity
50:     function isEmpty(Queue storage _queue) internal view returns (bool) 

```
['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L55-L55)']
```solidity
55:     function pushBack(Queue storage _queue, PriorityOperation memory _operation) internal 

```
['[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L64-L64)']
```solidity
64:     function front(Queue storage _queue) internal view returns (PriorityOperation memory) 

```
['[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L72-L72)']
```solidity
72:     function popFront(Queue storage _queue) internal returns (PriorityOperation memory priorityOperation) 

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L19-L19)']
```solidity
19:     function validateL1ToL2Transaction(
20:         L2CanonicalTransaction memory _transaction,
21:         bytes memory _encoded,
22:         uint256 _priorityTxMaxGasLimit,
23:         uint256 _priorityTxMaxPubdata
24:     ) internal pure 

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L46-L46)']
```solidity
46:     function validateUpgradeTransaction(L2CanonicalTransaction memory _transaction) internal pure 

```
['[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L69-L69)']
```solidity
69:     function getMinimalPriorityTransactionGasLimit(
70:         uint256 _encodingLength,
71:         uint256 _numberOfFactoryDependencies,
72:         uint256 _l2GasPricePerPubdata
73:     ) internal pure returns (uint256) 

```
['[109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L109-L109)']
```solidity
109:     function getTransactionBodyGasLimit(
110:         uint256 _totalGasLimit,
111:         uint256 _encodingLength
112:     ) internal pure returns (uint256 txBodyGasLimit) 

```
['[128](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L128-L128)']
```solidity
128:     function getOverheadForTransaction(
129:         uint256 _encodingLength
130:     ) internal pure returns (uint256 batchOverheadForTransaction) 

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L27-L27)']
```solidity
27:     function applyL1ToL2Alias(address l1Address) internal pure returns (address l2Address) 

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L37-L37)']
```solidity
37:     function undoL1ToL2Alias(address l2Address) internal pure returns (address l1Address) 

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L44-L44)']
```solidity
44:     function encodeLegacyTransactionHash(Transaction calldata _transaction) internal view returns (bytes32 txHash) 

```
['[139](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L139-L139)']
```solidity
139:     function encodeEIP2930TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) 

```
['[229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L229-L229)']
```solidity
229:     function encodeEIP1559TransactionHash(Transaction calldata _transaction) internal view returns (bytes32) 

```
['[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L50-L50)']
```solidity
50:     function keccakGasCost(uint256 _length) internal pure returns (uint256) 

```
['[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L61-L61)']
```solidity
61:     function sha256GasCost(uint256 _length) internal pure returns (uint256) 

```
['[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L36-L36)']
```solidity
36:     function keccak(bytes calldata _data) internal view returns (bytes32) 

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L45-L45)']
```solidity
45:     function sha(bytes calldata _data) internal view returns (bytes32) 

```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L58-L58)']
```solidity
58:     function call(
59:         uint256 _gas,
60:         address _address,
61:         uint256 _value,
62:         bytes calldata _data,
63:         bool _isSystem
64:     ) internal returns (bytes memory returnData) 

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L74-L74)']
```solidity
74:     function staticCall(
75:         uint256 _gas,
76:         address _address,
77:         bytes calldata _data
78:     ) internal view returns (bytes memory returnData) 

```
['[88](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L88-L88)']
```solidity
88:     function delegateCall(
89:         uint256 _gas,
90:         address _address,
91:         bytes calldata _data
92:     ) internal returns (bytes memory returnData) 

```
['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L105-L105)']
```solidity
105:     function mimicCall(
106:         uint256 _gas,
107:         address _address,
108:         bytes calldata _data,
109:         address _whoToMimic,
110:         bool _isConstructor,
111:         bool _isSystem
112:     ) internal returns (bytes memory returnData) 

```
['[124](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L124-L124)']
```solidity
124:     function rawCall(
125:         uint256 _gas,
126:         address _address,
127:         uint256 _value,
128:         bytes calldata _data,
129:         bool _isSystem
130:     ) internal returns (bool success) 

```
['[159](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L159-L159)']
```solidity
159:     function rawStaticCall(uint256 _gas, address _address, bytes calldata _data) internal view returns (bool success) 

```
['[173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L173-L173)']
```solidity
173:     function rawDelegateCall(uint256 _gas, address _address, bytes calldata _data) internal returns (bool success) 

```
['[191](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L191-L191)']
```solidity
191:     function rawMimicCall(
192:         uint256 _gas,
193:         address _address,
194:         bytes calldata _data,
195:         address _whoToMimic,
196:         bool _isConstructor,
197:         bool _isSystem
198:     ) internal returns (bool success) 

```
['[232](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L232-L232)']
```solidity
232:     function propagateRevert() internal pure 

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L11-L11)']
```solidity
11:     function encodeAddress(address _val) internal pure returns (bytes memory encoded) 

```
['[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L24-L24)']
```solidity
24:     function encodeUint256(uint256 _val) internal pure returns (bytes memory encoded) 

```
['[49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L49-L49)']
```solidity
49:     function encodeNonSingleBytesLen(uint64 _len) internal pure returns (bytes memory) 

```
['[56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L56-L56)']
```solidity
56:     function encodeListLen(uint64 _len) internal pure returns (bytes memory) 

```
['[48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L48-L48)']
```solidity
48:     function toL1(bool _isService, bytes32 _key, bytes32 _value) internal 

```
['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L63-L63)']
```solidity
63:     function getCodeAddress() internal view returns (address addr) 

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L74-L74)']
```solidity
74:     function loadCalldataIntoActivePtr() internal view 

```
['[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L85-L85)']
```solidity
85:     function ptrPackIntoActivePtr(uint256 _farCallAbi) internal view 

```
['[94](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L94-L94)']
```solidity
94:     function ptrAddIntoActive(uint32 _value) internal view 

```
['[106](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L106-L106)']
```solidity
106:     function ptrShrinkIntoActive(uint32 _shrink) internal view 

```
['[124](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L124-L124)']
```solidity
124:     function packPrecompileParams(
125:         uint32 _inputMemoryOffset,
126:         uint32 _inputMemoryLength,
127:         uint32 _outputMemoryOffset,
128:         uint32 _outputMemoryLength,
129:         uint64 _perPrecompileInterpreted
130:     ) internal pure returns (uint256 rawParams) 

```
['[148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L148-L148)']
```solidity
148:     function unsafePrecompileCall(
149:         uint256 _rawParams,
150:         uint32 _gasToBurn,
151:         uint32 _pubdataToSpend
152:     ) internal view returns (bool success) 

```
['[168](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L168-L168)']
```solidity
168:     function setValueForNextFarCall(uint128 _value) internal returns (bool success) 

```
['[181](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L181-L181)']
```solidity
181:     function eventInitialize(uint256 initializer, uint256 value1) internal 

```
['[191](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L191-L191)']
```solidity
191:     function eventWrite(uint256 value1, uint256 value2) internal 

```
['[203](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L203-L203)']
```solidity
203:     function getZkSyncMetaBytes() internal view returns (uint256 meta) 

```
['[215](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L215-L215)']
```solidity
215:     function extractNumberFromMeta(uint256 meta, uint256 offset, uint256 size) internal pure returns (uint256 result) 

```
['[227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L227-L227)']
```solidity
227:     function getPubdataPublishedFromMeta(uint256 meta) internal pure returns (uint32 pubdataPublished) 

```
['[237](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L237-L237)']
```solidity
237:     function getHeapSizeFromMeta(uint256 meta) internal pure returns (uint32 heapSize) 

```
['[246](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L246-L246)']
```solidity
246:     function getAuxHeapSizeFromMeta(uint256 meta) internal pure returns (uint32 auxHeapSize) 

```
['[254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L254-L254)']
```solidity
254:     function getShardIdFromMeta(uint256 meta) internal pure returns (uint8 shardId) 

```
['[263](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L263-L263)']
```solidity
263:     function getCallerShardIdFromMeta(uint256 meta) internal pure returns (uint8 callerShardId) 

```
['[272](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L272-L272)']
```solidity
272:     function getCodeShardIdFromMeta(uint256 meta) internal pure returns (uint8 codeShardId) 

```
['[279](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L279-L279)']
```solidity
279:     function getZkSyncMeta() internal view returns (ZkSyncMeta memory meta) 

```
['[296](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L296-L296)']
```solidity
296:     function getCallFlags() internal view returns (uint256 callFlags) 

```
['[307](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L307-L307)']
```solidity
307:     function getCalldataPtr() internal view returns (uint256 ptr) 

```
['[318](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L318-L318)']
```solidity
318:     function getExtraAbiData(uint256 index) internal view returns (uint256 extraAbiData) 

```
['[329](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L329-L329)']
```solidity
329:     function isSystemCall() internal view returns (bool) 

```
['[338](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L338-L338)']
```solidity
338:     function isSystemContract(address _address) internal pure returns (bool) 

```
['[344](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L344-L344)']
```solidity
344:     function burnGas(uint32 _gasToPay, uint32 _pubdataToSpend) internal view 

```
['[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L26-L26)']
```solidity
26:     function safeCastToU32(uint256 _x) internal pure returns (uint32) 

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L37-L37)']
```solidity
37:     function systemCall(uint32 gasLimit, address to, uint256 value, bytes memory data) internal returns (bool success) 

```
['[76](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L76-L76)']
```solidity
76:     function systemCallWithReturndata(
77:         uint32 gasLimit,
78:         address to,
79:         uint128 value,
80:         bytes memory data
81:     ) internal returns (bool success, bytes memory returnData) 

```
['[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L95-L95)']
```solidity
95:     function getFarCallABI(
96:         uint32 dataOffset,
97:         uint32 memoryPage,
98:         uint32 dataStart,
99:         uint32 dataLength,
100:         uint32 gasPassed,
101:         uint8 shardId,
102:         CalldataForwardingMode forwardingMode,
103:         bool isConstructorCall,
104:         bool isSystemCall
105:     ) internal pure returns (uint256 farCallAbi) 

```
['[121](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L121-L121)']
```solidity
121:     function getFarCallABIWithEmptyFatPointer(
122:         uint32 gasPassed,
123:         uint8 shardId,
124:         CalldataForwardingMode forwardingMode,
125:         bool isConstructorCall,
126:         bool isSystemCall
127:     ) internal pure returns (uint256 farCallAbiWithEmptyFatPtr) 

```
['[94](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L94-L94)']
```solidity
94:     function isEthToken(uint256 _addr) internal pure returns (bool) 

```
['[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L100-L100)']
```solidity
100:     function encodeHash(Transaction calldata _transaction) internal view returns (bytes32 resultHash) 

```
['[362](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L362-L362)']
```solidity
362:     function processPaymasterInput(Transaction calldata _transaction) internal 

```
['[395](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L395-L395)']
```solidity
395:     function payToTheBootloader(Transaction calldata _transaction) internal returns (bool success) 

```
['[405](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L405-L405)']
```solidity
405:     function totalRequiredBalance(Transaction calldata _transaction) internal pure returns (uint256 requiredBalance) 

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L19-L19)']
```solidity
19:     function readUint16(bytes calldata _bytes, uint256 _start) internal pure returns (uint16 result) 

```
['[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L26-L26)']
```solidity
26:     function readUint32(bytes calldata _bytes, uint256 _start) internal pure returns (uint32 result) 

```
['[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L33-L33)']
```solidity
33:     function readUint64(bytes calldata _bytes, uint256 _start) internal pure returns (uint64 result) 

```
['[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L40-L40)']
```solidity
40:     function readBytes32(bytes calldata _bytes, uint256 _start) internal pure returns (bytes32 result) 

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L46-L46)']
```solidity
46:     function readUint256(bytes calldata _bytes, uint256 _start) internal pure returns (uint256 result) 

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L20-L20)']
```solidity
20:     function safeCastToU128(uint256 _x) internal pure returns (uint128) 

```
['[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L26-L26)']
```solidity
26:     function safeCastToU32(uint256 _x) internal pure returns (uint32) 

```
['[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L32-L32)']
```solidity
32:     function safeCastToU24(uint256 _x) internal pure returns (uint24) 

```
['[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L39-L39)']
```solidity
39:     function bytecodeLenInBytes(bytes32 _bytecodeHash) internal pure returns (uint256 codeLength) 

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L44-L44)']
```solidity
44:     function bytecodeLenInWords(bytes32 _bytecodeHash) internal pure returns (uint256 codeLengthInWords) 

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L51-L51)']
```solidity
51:     function isContractConstructed(bytes32 _bytecodeHash) internal pure returns (bool) 

```
['[56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L56-L56)']
```solidity
56:     function isContractConstructing(bytes32 _bytecodeHash) internal pure returns (bool) 

```
['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L63-L63)']
```solidity
63:     function constructingBytecodeHash(bytes32 _bytecodeHash) internal pure returns (bytes32) 

```
['[71](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L71-L71)']
```solidity
71:     function constructedBytecodeHash(bytes32 _bytecodeHash) internal pure returns (bytes32) 

```
['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L82-L82)']
```solidity
82:     function hashL2Bytecode(bytes calldata _bytecode) internal view returns (bytes32 hashedBytecode) 

```


</details>

## [NonCritical-25] Private and internal state variables should have a preceding _ in their name unless they are constants

### Resolution 
Add a preceding underscore to the state variable name, take care to refactor where there variables are read/wrote

Num of instances: 17

### Findings 


<details><summary>Click to show findings</summary>

['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L35-L35)']
```solidity
35: address private pendingAdmin; // <= FOUND

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L37-L37)']
```solidity
37: address private l1LegacyBridge; // <= FOUND

```
['[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L26-L26)']
```solidity
26: ERC20Getters private availableGetters; // <= FOUND

```
['[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L31-L31)']
```solidity
31: uint8 private decimals_; // <= FOUND

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L45-L45)']
```solidity
45: uint256 internal eraFirstPostUpgradeBatch; // <= FOUND

```
['[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L12-L12)']
```solidity
12: ZkSyncStateTransitionStorage internal s; // <= FOUND

```
['[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L28-L28)']
```solidity
28: bytes32 internal chainedLogsHash; // <= FOUND

```
['[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L32-L32)']
```solidity
32: uint256 internal numberOfLogsToProcess; // <= FOUND

```
['[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L36-L36)']
```solidity
36: bytes32 internal chainedMessagesHash; // <= FOUND

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L41-L41)']
```solidity
41: bytes32 internal chainedL1BytecodesRevealDataHash; // <= FOUND

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L51-L51)']
```solidity
51: BlockInfo internal currentBatchInfo; // <= FOUND

```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L58-L58)']
```solidity
58: BlockInfo internal currentL2BlockInfo; // <= FOUND

```
['[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L61-L61)']
```solidity
61: bytes32 internal currentL2BlockTxsRollingHash; // <= FOUND

```
['[70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L70-L70)']
```solidity
70: bytes32[MINIBLOCK_HASHES_TO_STORE] internal l2BlockHash; // <= FOUND

```
['[77](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L77-L77)']
```solidity
77: BlockInfo internal currentVirtualL2BlockInfo; // <= FOUND

```
['[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L95-L95)']
```solidity
95: uint256 internal basePubdataSpent; // <= FOUND

```
['[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L32-L32)']
```solidity
32: bytes32 internal l2TokenProxyBytecodeHash; // <= FOUND

```


</details>

## [NonCritical-26] Contract lines should not be longer than 120 characters for readability

### Resolution 
Consider spreading these lines over multiple lines to aid in readability and the support of VIM users everywhere.

Num of instances: 133

### Findings 


<details><summary>Click to show findings</summary>

['[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L90-L90)']
```solidity
90:         // - l2ShardId = 0 (means that L1 -> L2 transaction was processed in a rollup shard, other shards are not available yet anyway) // <= FOUND

```
['[232](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L232-L232)']
```solidity
232:         // Please note, currently zkSync address derivation is different from Ethereum one, but it may be changed in the future. // <= FOUND

```
['[239](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L239-L239)']
```solidity
239:         // to ensure that users do not get used to using "exotic" numbers for _request.l2GasPerPubdataByteLimit, e.g. 1-2, etc. // <= FOUND

```
['[240](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L240-L240)']
```solidity
240:         // VERY IMPORTANT: nobody should rely on this constant to be fixed and every contract should give their users the ability to provide the // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContextDeprecated.sol#L8-L8)']
```solidity
8:  * @notice The interface with deprecated functions of the SystemContext contract. It is aimed for backward compatibility. // <= FOUND

```
['[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L14-L14)']
```solidity
14:  * @dev It does NOT provide interfaces for personal interaction with tokens like `transfer`, `approve`, and `transferFrom`. // <= FOUND

```
['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L82-L82)']
```solidity
82:     /// @notice Initiate the ETH withdrawal, with the sent message. The funds will be available to claim on L1 `finalizeEthWithdrawal` method. // <= FOUND

```
['[143](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L143-L143)']
```solidity
143:         // note we use the IL1ERC20Bridge.finalizeWithdrawal function selector to specify the selector for L1<>L2 messages, // <= FOUND

```
['[162](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L162-L162)']
```solidity
162:     /// @dev This function uses raw call to ContractDeployer to make sure that exactly `l2TokenProxyBytecodeHash` is used // <= FOUND

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L13-L13)']
```solidity
13: /// @notice Intermediate smart contract between the validator EOA account and the hyperchains state transition diamond smart contract. // <= FOUND

```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L15-L15)']
```solidity
15: /// modifying the main hyperchain diamond contract. As such, even if this contract is compromised, it will not impact the main // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L6-L6)']
```solidity
6: /// @param l2ShardId The shard identifier, 0 - rollup, 1 - porter. All other values are not used but are reserved for the future // <= FOUND

```
['[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IL1Messenger.sol#L24-L24)']
```solidity
24: /// @dev Equal to the bytes size of the tuple - (uint8 ShardId, bool isService, uint16 txNumberInBlock, address sender, bytes32 key, bytes32 value) // <= FOUND

```
['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L62-L62)']
```solidity
62:         require(msg.sender == currentPendingAdmin, "n42"); // Only proposed by current admin address can claim the admin rights // <= FOUND

```
['[216](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L216-L216)']
```solidity
216:     /// This means this is not ideal for contract calls, as the contract would have to handle token allowance of the base Token // <= FOUND

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L13-L13)']
```solidity
13:     /// NOTE: When using this function, check that the _path length is equal to the tree height to prevent shorter/longer paths attack // <= FOUND

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L19-L19)']
```solidity
19:     /// @notice Our goal is to store all the getters that L1 token implements, and for others, we keep it as an unimplemented method. // <= FOUND

```
['[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L69-L69)']
```solidity
69:     /// @notice Address which will exercise critical changes to the Diamond Proxy (upgrades, freezing & unfreezing). Replaced by STM // <= FOUND

```
['[149](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L149-L149)']
```solidity
149:     /// @notice gasPriceMultiplier for each baseToken, so that each L1->L2 transaction pays for its transaction on the destination // <= FOUND

```
['[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L39-L39)']
```solidity
39:     /// @return The total number of priority operations that were added to the priority queue, including all processed ones // <= FOUND

```
['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L55-L55)']
```solidity
55:     /// @notice Denotes whether bytecode hash corresponds to a contract that is on constructor or has already been constructed // <= FOUND

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L10-L10)']
```solidity
10: /// @title The interface of the Getters Contract that implements functions for getting contract state from outside the blockchain. // <= FOUND

```
['[54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L54-L54)']
```solidity
54:     /// in case exactly *unprocessed* transactions are needed, one should check that getPriorityQueueSize() is greater than 0. // <= FOUND

```
['[111](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L111-L111)']
```solidity
111:     /// @return the baseTokenGasPriceMultiplierNominator, used to compare the baseTokenPrice to ether for L1->L2 transactions // <= FOUND

```
['[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L114-L114)']
```solidity
114:     /// @return the baseTokenGasPriceMultiplierDenominator, used to compare the baseTokenPrice to ether for L1->L2 transactions // <= FOUND

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L21-L21)']
```solidity
21:     /// @return txHash and signedTxHash of the transaction, i.e. the transaction hash to be used in the explorer and commits to all // <= FOUND

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L57-L57)']
```solidity
57:             // In this scenario, pubdataCommitments is a list of: opening point (16 bytes) || claimed value (32 bytes) || commitment (48 bytes) || proof (48 bytes)) = 144 bytes // <= FOUND

```
['[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L60-L60)']
```solidity
60:             // In this scenario pubdataCommitments is actual pubdata consisting of l2 to l1 logs, l2 to l1 message, compressed smart contract bytecode, and compressed state diffs // <= FOUND

```
['[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L100-L100)']
```solidity
100:     /// @param _packedBatchAndL2BlockTimestamp - packed batch and L2 block timestamp in a format of batchTimestamp * 2**128 + l2BatchTimestamp // <= FOUND

```
['[122](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L122-L122)']
```solidity
122:         require(block.timestamp - COMMIT_TIMESTAMP_NOT_OLDER <= batchTimestamp, "h1"); // New batch timestamp is too small // <= FOUND

```
['[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L123-L123)']
```solidity
123:         require(lastL2BlockTimestamp <= block.timestamp + COMMIT_TIMESTAMP_APPROXIMATION_DELTA, "h2"); // The last L2 block timestamp is too big // <= FOUND

```
['[221](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L221-L221)']
```solidity
221:         // 1. A chain has to keep their protocol version up to date, as processing a block requires the latest or previous protocol version // <= FOUND

```
['[222](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L222-L222)']
```solidity
222:         // to solve this we will need to add the feature to create batches with only the protocol upgrade tx, without any other txs. // <= FOUND

```
['[223](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L223-L223)']
```solidity
223:         // 2. A chain might become out of sync if it launches while we are in the middle of a protocol upgrade. This would mean they cannot process their genesis upgrade // <= FOUND

```
['[224](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L224-L224)']
```solidity
224:         // as thier protocolversion would be outdated, and they also cannot process the protocol upgrade tx as they have a pending upgrade. // <= FOUND

```
['[225](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L225-L225)']
```solidity
225:         // 3. The protocol upgrade is increased in the BaseZkSyncUpgrade, in the executor only the systemContractsUpgradeTxHash is checked // <= FOUND

```
['[230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L230-L230)']
```solidity
230:         // With the new changes for EIP-4844, namely the restriction on number of blobs per block, we only allow for a single batch to be committed at a time. // <= FOUND

```
['[233](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L233-L233)']
```solidity
233:         require(s.storedBatchHashes[s.totalBatchesCommitted] == _hashStoredBatchInfo(_lastCommittedBatchData), "i"); // incorrect previous batch data // <= FOUND

```
['[282](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L282-L282)']
```solidity
282:         // While the logic of the contract ensures that the s.l2SystemContractsUpgradeBatchNumber is 0 when this function is called, // <= FOUND

```
['[330](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L330-L330)']
```solidity
330:         require(priorityOperationsHash == _storedBatch.priorityOperationsHash, "x"); // priority operations hash does not match to expected // <= FOUND

```
['[358](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L358-L358)']
```solidity
358:         require(newTotalBatchesExecuted <= s.totalBatchesVerified, "n"); // Can't execute batches more than committed and proven currently. // <= FOUND

```
['[532](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L532-L532)']
```solidity
532:                 // VM 1.5.0 requires us to pass the EVM simulator code hash. For now it is the same as the default account. // <= FOUND

```
['[615](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L615-L615)']
```solidity
615:         // response is equal to BLS_MODULUS as defined in https://eips.ethereum.org/EIPS/eip-4844#point-evaluation-precompile // <= FOUND

```
['[621](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L621-L621)']
```solidity
621:     /// @dev Verifies that the blobs contain the correct data by calling the point evaluation precompile. For the precompile we need: // <= FOUND

```
['[624](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L624-L624)']
```solidity
624:     /// pubdataCommitments is a list of: opening point (16 bytes) || claimed value (32 bytes) || commitment (48 bytes) || proof (48 bytes)) = 144 bytes // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L9-L9)']
```solidity
9:  * @dev Each of the functions accepts the `bytes calldata` and the offset where data should be read and returns a value of a certain type. // <= FOUND

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L11-L11)']
```solidity
11:  * @notice Upgrader which should be used to perform complex multistep upgrades on L2. In case some custom logic for an upgrade is needed // <= FOUND

```
['[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L40-L40)']
```solidity
40:     /// It is equal to the following constant: https://github.com/matter-labs/era-zkevm_opcode_defs/blob/7bf8016f5bb13a73289f321ad6ea8f614540ece9/src/system_params.rs#L96. // <= FOUND

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L21-L21)']
```solidity
21: /// @dev Enum used to determine the source of pubdata. At first we will support calldata and blobs but this can be extended. // <= FOUND

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L45-L45)']
```solidity
45: /// @dev Offset used to pull Value From Log. Equal to 4 (bytes for isService) + 20 (bytes for address) + 32 (bytes for key) // <= FOUND

```
['[53](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L53-L53)']
```solidity
53: /// @dev Format: list of: opening point (16 bytes) || claimed value (32 bytes) || commitment (48 bytes) || proof (48 bytes)) = 144 bytes // <= FOUND

```
['[77](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L77-L77)']
```solidity
77:     /// @param indexRepeatedStorageChanges The serial number of the shortcut index that's used as a unique identifier for storage keys that were used twice or more // <= FOUND

```
['[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L101-L101)']
```solidity
101:     /// @param bootloaderHeapInitialContentsHash Hash of the initial contents of the bootloader heap. In practice it serves as the commitment to the transactions in the batch. // <= FOUND

```
['[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L102-L102)']
```solidity
102:     /// @param eventsQueueStateHash Hash of the events queue state. In practice it serves as the commitment to the events in the batch. // <= FOUND

```
['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L105-L105)']
```solidity
105:     /// @dev pubdataCommitments format: This will always start with a 1 byte pubdataSource flag. Current allowed values are 0 (calldata) or 1 (blobs) // <= FOUND

```
['[106](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L106-L106)']
```solidity
106:     ///                             kzg: list of: opening point (16 bytes) || claimed value (32 bytes) || commitment (48 bytes) || proof (48 bytes) = 144 bytes // <= FOUND

```
['[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L108-L108)']
```solidity
108:     ///                                       and 32 bytes appended to serve as the blob commitment part for the aux output part of the batch commitment // <= FOUND

```
['[110](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L110-L110)']
```solidity
110:     /// @dev When using calldata, we only need to send one blob commitment since the max number of bytes in calldata fits in a single blob and we can pull the // <= FOUND

```
['[196](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L196-L196)']
```solidity
196:     /// @dev It has the name "BlocksVerification" and not "BatchesVerification" due to backward compatibility considerations // <= FOUND

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L16-L16)']
```solidity
16:     /// @dev Used to distinguish calls to contracts that were supposed to be used as diamond initializer from other contracts. // <= FOUND

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L22-L22)']
```solidity
22:         0xc8fcad8db84d3cc18b4c41d551ea0ee66dd599cde068d998e57d5e09332c131b; // keccak256("diamond.standard.diamond.storage") - 1; // <= FOUND

```
['[161](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L161-L161)']
```solidity
161:             require(oldFacet.facetAddress != address(0), "L"); // it is impossible to replace the facet with zero address // <= FOUND

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L16-L16)']
```solidity
16:  * In turn, zkEVM operates over a fat pointer, which is a set of (memory page, offset, start, length) in the memory/calldata/returndata. // <= FOUND

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L25-L25)']
```solidity
25:  * 3. `ptr.pack` - Do the concatenation between the lowest 128 bits of the pointer itself and the highest 128 bits of `_value`. It is typically used to prepare the ABI for external calls. // <= FOUND

```
['[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L24-L24)']
```solidity
24:  * @dev The behavior of some of the methods depends on the nonce ordering of the account. Nonce ordering is a mere suggestion and all the checks that are present // <= FOUND

```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L15-L15)']
```solidity
15:  * the second byte denotes whether the contract is constructed, and the next two bytes denote the length in 32-byte words. // <= FOUND

```
['[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L40-L40)']
```solidity
40: /// - That it is not possible that the pubdata counter grows too high without spending proportional amount of computation. // <= FOUND

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L74-L74)']
```solidity
74: ISystemContext constant REAL_SYSTEM_CONTEXT_CONTRACT = ISystemContext(payable(address(REAL_SYSTEM_CONTRACTS_OFFSET + 0x0b))); // <= FOUND

```
['[78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L78-L78)']
```solidity
78: // It will be a different value for tests, while shouldn't. But for now, this constant is not used by other contracts, so that's fine. // <= FOUND

```
['[103](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L103-L103)']
```solidity
103: /// @dev Each state diff consists of 156 bytes of actual data and 116 bytes of unused padding, needed for circuit efficiency. // <= FOUND

```
['[106](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L106-L106)']
```solidity
106: /// @dev While the "real" amount of pubdata that can be sent rarely exceeds the BLOB_SIZE_BYTES * MAX_NUMBER_OF_BLOBS, it is better to // <= FOUND

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L17-L17)']
```solidity
17:  * @dev Every deployed bytecode/published state diffs in zkEVM should be publicly restorable from the L1 data availability. // <= FOUND

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L41-L41)']
```solidity
41:     /// @dev Currently, the method may be called only from the bootloader because the server is not ready to publish bytecodes // <= FOUND

```
['[43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L43-L43)']
```solidity
43:     /// @dev Read more about the compression: https://github.com/matter-labs/zksync-era/blob/main/docs/guides/advanced/compression.md // <= FOUND

```
['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L82-L82)']
```solidity
82:     /// @dev We don't verify that the size of {_stateDiffs} is equivalent to {_numberOfStateDiffs} * STATE_DIFF_ENTRY_SIZE since that check is // <= FOUND

```
['[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L85-L85)']
```solidity
85:     /// @dev This check assumes that the ordering of state diffs are sorted by (address, key) for the encoded state diffs and // <= FOUND

```
['[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L87-L87)']
```solidity
87:     /// @dev state diff:   [20bytes address][32bytes key][32bytes derived key][8bytes enum index][32bytes initial value][32bytes final value] // <= FOUND

```
['[208](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L208-L208)']
```solidity
208:     /// @notice Verify value compression was done correct given initial value, final value, operation, and compressed value // <= FOUND

```
['[213](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L213-L213)']
```solidity
213:     /// value or difference between initial and final value. It should be of arbitrary length less than or equal to 32 bytes. // <= FOUND

```
['[214](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L214-L214)']
```solidity
214:     /// @dev It is the responsibility of the caller of this function to ensure that the `_compressedValue` has length no longer than 32 bytes. // <= FOUND

```
['[86](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L86-L86)']
```solidity
86:             "Transaction(uint256 txType,uint256 from,uint256 to,uint256 gasLimit,uint256 gasPerPubdataByteLimit,uint256 maxFeePerGas,uint256 maxPriorityFeePerGas,uint256 paymaster,uint256 nonce,uint256 value,bytes data,bytes32[] factoryDeps,bytes paymasterInput)" // <= FOUND

```
['[291](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L291-L291)']
```solidity
291:         // H(0x02 || RLP(chain_id, nonce, max_priority_fee_per_gas, max_fee_per_gas, gas_limit, destination, amount, data, access_list)) // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L6-L6)']
```solidity
6: /// @dev This library is an adaptation of the corresponding Solady library (https://github.com/vectorized/solady/blob/main/src/utils/LibMap.sol) // <= FOUND

```
['[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L60-L60)']
```solidity
60:             // shifted to its proper position. The XOR operation will effectively replace the old value with the new value. // <= FOUND

```
['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L105-L105)']
```solidity
105:     /// @dev Transforms `ACTIVE_PTR.length` into `ACTIVE_PTR.length - u32(_shrink)`. If underflow happens then it panics. // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L9-L9)']
```solidity
9:  * @dev Each of the functions accepts the `bytes memory` and the offset where data should be read and returns a value of a certain type. // <= FOUND

```
['[187](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L187-L187)']
```solidity
187:     ///        processed in the current L1 Batch. Pubdata consists of L2 to L1 Logs, messages, deployed bytecode, and state diffs. // <= FOUND

```
['[190](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L190-L190)']
```solidity
190:     /// @dev The data passed in also contains the encoded state diffs to be checked again, however this is aux data that is not // <= FOUND

```
['[277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L277-L277)']
```solidity
277:         /// body (`compressedStateDiffSize` bytes, 4 bytes number of state diffs, `numberOfStateDiffs` * `STATE_DIFF_ENTRY_SIZE` bytes for the uncompressed state diffs) // <= FOUND

```
['[278](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L278-L278)']
```solidity
278:         /// encoded state diffs: [20bytes address][32bytes key][32bytes derived key][8bytes enum index][32bytes initial value][32bytes final value] // <= FOUND

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L17-L17)']
```solidity
17:  * @dev The length of each bytecode MUST be odd.  It's internal code format requirements, due to padding of SHA256 function. // <= FOUND

```
['[68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L68-L68)']
```solidity
68:     /// Note: The calculation includes the main cost of the priority transaction, however, in reality, the operator can spend a little more gas on overheads. // <= FOUND

```
['[107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L107-L107)']
```solidity
107:     /// and the L2 gas needed to process the transaction itself (i.e. the actual l2GasLimit that will be used for the transaction). // <= FOUND

```
['[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L90-L90)']
```solidity
90:         require(s.totalBatchesCommitted == 0, "AdminFacet: set validium only after genesis"); // Validium mode can be set only before the first batch is committed // <= FOUND

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L21-L21)']
```solidity
21:     /// - Store the latest 256 hashes (and strictly rely that we do not accidentally override the hash of the block 256 blocks ago) // <= FOUND

```
['[65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L65-L65)']
```solidity
65:     /// of the miniblocks cheaper, we only store the previous MINIBLOCK_HASHES_TO_STORE ones. Since whenever we need to publish a state // <= FOUND

```
['[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L67-L67)']
```solidity
67:     /// By having this data in a cyclic array of MINIBLOCK_HASHES_TO_STORE blocks, we bring the costs down by 40% (i.e. 40 bytes per miniblock instead of 64 bytes). // <= FOUND

```
['[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L69-L69)']
```solidity
69:     /// @dev Hashes of the blocks older than the ones which are stored here can be calculated as _calculateLegacyL2BlockHash(blockNumber). // <= FOUND

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L74-L74)']
```solidity
74:     /// - Their number will start from being equal to the number of the batch and it will increase until it reaches the L2 block number. // <= FOUND

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L79-L79)']
```solidity
79:     /// @notice The information about the virtual blocks upgrade, which tracks when the migration to the L2 blocks has started and finished. // <= FOUND

```
['[139](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L139-L139)']
```solidity
139:         // 2. If the block was created before the upgrade for the virtual blocks (i.e. there we used to use hashes of the batches), // <= FOUND

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L142-L142)']
```solidity
142:         // all the information which is returned for users should be for L2 blocks, we return the hash of the corresponding L2 block. // <= FOUND

```
['[156](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L156-L156)']
```solidity
156:             // Important: we do not want this number to ever collide with the L2 block hash (either new or old one) and so // <= FOUND

```
['[157](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L157-L157)']
```solidity
157:             // that's why the legacy L2 blocks' hashes are keccak256(abi.encodePacked(uint32(_block))), while these are equivalent to // <= FOUND

```
['[281](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L281-L281)']
```solidity
281:             // Note, that when setting the virtual block number we use the batch number to make a smoother upgrade from batch number to // <= FOUND

```
['[299](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L299-L299)']
```solidity
299:         // We do not use a `require` here, since the virtual blocks are a temporary solution to let the Solidity's `block.number` // <= FOUND

```
['[340](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L340-L340)']
```solidity
340:     /// @dev It is also enforced that the number of the current virtual L2 block can not exceed the number of the L2 block. // <= FOUND

```
['[43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L43-L43)']
```solidity
43:     /// This variable is used to differentiate between pre-upgrade and post-upgrade withdrawals. Withdrawals from batches older // <= FOUND

```
['[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L47-L47)']
```solidity
47:     /// @dev A mapping chainId => bridgeProxy. Used to store the bridge proxy's address, and to see if it has been deployed yet. // <= FOUND

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L57-L57)']
```solidity
57:     mapping(uint256 chainId => mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized))) // <= FOUND

```
['[103](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L103-L103)']
```solidity
103:     /// implementation. The owner is the Governor and separate from the ProxyAdmin from now on, so that the Governor can call the bridge. // <= FOUND

```
['[160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L160-L160)']
```solidity
160:             uint256 amount = _depositFunds(_prevMsgSender, IERC20(_l1Token), _amount); // note if _prevMsgSender is this contract, this will return 0. This does not happen. // <= FOUND

```
['[167](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L167-L167)']
```solidity
167:         // Note that we don't save the deposited amount, as this is for the base token, which gets sent to the refundRecipient if the tx fails // <= FOUND

```
['[230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L230-L230)']
```solidity
230:     /// @notice Confirms the acceptance of a transaction by the Mailbox, as part of the L2 transaction process within Bridgehub. // <= FOUND

```
['[332](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L332-L332)']
```solidity
332:                 // Deposits that happened before the upgrade cannot be checked here, they have to be claimed and checked in the legacyBridge // <= FOUND

```
['[494](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L494-L494)']
```solidity
494:         // It should be equal to the length of the bytes4 function signature + address l1Receiver + uint256 amount = 4 + 20 + 32 = 56 (bytes). // <= FOUND

```
['[515](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L515-L515)']
```solidity
515:             // It should be equal to the length of the function signature + address + address + uint256 = 4 + 20 + 20 + 32 = // <= FOUND

```
['[587](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L587-L587)']
```solidity
587:                 mintValue: msg.value, // l2 gas + l2 msg.Value the bridgehub will withdraw the mintValue from the base token bridge for gas // <= FOUND

```
['[588](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L588-L588)']
```solidity
588:                 l2Value: 0, // L2 msg.value, this contract doesn't support base token deposits or wrapping functionality, for direct deposits use bridgehub // <= FOUND

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L20-L20)']
```solidity
20:     /// @dev We always publish 2 system logs even if our pubdata fits into a single blob. This makes processing logs on L1 easier. // <= FOUND

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L19-L19)']
```solidity
19:     /// @notice We assume that no more than `CALL_RETURN_OVERHEAD` ergs are used for the O(1) operations at the end of the execution, // <= FOUND

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L27-L27)']
```solidity
27:     /// (`BOUND_CALL_OVERHEAD`) to ensure that the call will not exceed the limit, so it may actually spend a bit less than // <= FOUND

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L30-L30)']
```solidity
30:     /// of the `_maxTotalGas` parameter. In other words, `max(gas(), _maxTotalGas)` is the maximum amount of gas that can be spent by this function. // <= FOUND

```
['[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L31-L31)']
```solidity
31:     /// @dev The function relays the `returndata` returned by the callee. In case the `callee` reverts, it reverts with the same error. // <= FOUND

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L45-L45)']
```solidity
45:         // Ultimately, the entire `gas` sent to this call can be spent on compute regardless of the `_maxTotalGas` parameter. // <= FOUND

```
['[48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L48-L48)']
```solidity
48:         // This is the amount of gas that can be spent *exclusively* on pubdata in addition to the `gas` provided to this function. // <= FOUND

```
['[216](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L216-L216)']
```solidity
216:         // Since the `forceDeployOnAddress` function is called only during upgrades, the Governance is trusted to correctly select // <= FOUND

```
['[217](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L217-L217)']
```solidity
217:         // the addresses to deploy the new bytecodes to and to assess whether overriding the AccountInfo for the "force-deployed" // <= FOUND

```
['[143](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L143-L143)']
```solidity
143:         // An upgrade to the verifier params must be done carefully to ensure there aren't batches in the committed state // <= FOUND

```
['[145](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L145-L145)']
```solidity
145:         // Batches committed expecting the old verifier params will fail. Ensure all commited batches are finalized before the // <= FOUND

```
['[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L31-L31)']
```solidity
31:     /// @dev Used for saving the number of deposited funds, to claim them in case the deposit transaction will fail in zkSync Era. // <= FOUND

```
['[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L32-L32)']
```solidity
32:     // https://github.com/OpenZeppelin/openzeppelin-contracts/blob/566a774222707e424896c0c390a84dc3c13bdcb2/contracts/security/ReentrancyGuard.sol // <= FOUND

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContext.sol#L25-L25)']
```solidity
25:         /// all the information returned to users for block.timestamp/number, etc should be the information about the L2 blocks and // <= FOUND

```


</details>

## [NonCritical-27] Avoid updating storage when the value hasn't changed

### Resolution 
In Solidity, manipulating contract storage comes with significant gas costs. One can optimize gas usage by preventing unnecessary storage updates when the new value is the same as the existing one. If an existing value is the same as the new one, not reassigning it to the storage could potentially save substantial amounts of gas, notably 2900 gas for a 'Gsreset'. This saving may come at the expense of a cold storage load operation ('Gcoldsload'), which costs 2100 gas, or a warm storage access operation ('Gwarmaccess'), which costs 100 gas. Therefore, the gas efficiency of your contract can be significantly improved by adding a check that compares the new value with the current one before any storage update operation. If the values are the same, you can bypass the storage operation, thereby saving gas.

Num of instances: 15

### Findings 


<details><summary>Click to show findings</summary>

['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin {
52:         
53:         address oldPendingAdmin = pendingAdmin;
54:         
55:         pendingAdmin = _newPendingAdmin;
56:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
57:     }

```
['[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108-L108)']
```solidity
108:     function setSharedBridge(address _sharedBridge) external onlyOwner {
109:         sharedBridge = IL1SharedBridge(_sharedBridge);
110:     }

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin {
52:         
53:         address oldPendingAdmin = pendingAdmin;
54:         
55:         pendingAdmin = _newPendingAdmin;
56:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
57:     }

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132-L132)']
```solidity
132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin {
133:         validatorTimelock = _validatorTimelock;
134:     }

```
['[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L137-L137)']
```solidity
137:     function setInitialCutHash(Diamond.DiamondCutData calldata _diamondCut) external onlyOwner {
138:         initialCutHash = keccak256(abi.encode(_diamondCut));
139:     }

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L142-L142)']
```solidity
142:     function setNewVersionUpgrade(
143:         Diamond.DiamondCutData calldata _cutData,
144:         uint256 _oldProtocolVersion,
145:         uint256 _newProtocolVersion
146:     ) external onlyOwner {
147:         upgradeCutHash[_oldProtocolVersion] = keccak256(abi.encode(_cutData));
148:         protocolVersion = _newProtocolVersion;
149:     }

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L152-L152)']
```solidity
152:     function setUpgradeDiamondCut(
153:         Diamond.DiamondCutData calldata _cutData,
154:         uint256 _oldProtocolVersion
155:     ) external onlyOwner {
156:         upgradeCutHash[_oldProtocolVersion] = keccak256(abi.encode(_cutData));
157:     }

```
['[73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L73-L73)']
```solidity
73:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner {
74:         stateTransitionManager = _stateTransitionManager;
75:     }

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L96-L96)']
```solidity
96:     function setExecutionDelay(uint32 _executionDelay) external onlyOwner {
97:         executionDelay = _executionDelay;
98:         emit NewExecutionDelay(_executionDelay);
99:     }

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L45-L45)']
```solidity
45:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager {
46:         s.validators[_validator] = _active;
47:         emit ValidatorStatusUpdate(_validator, _active);
48:     }

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L51-L51)']
```solidity
51:     function setPorterAvailability(bool _zkPorterIsAvailable) external onlyStateTransitionManager {
52:         
53:         s.zkPorterIsAvailable = _zkPorterIsAvailable;
54:         emit IsPorterAvailableStatusUpdate(_zkPorterIsAvailable);
55:     }

```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L58-L58)']
```solidity
58:     function setPriorityTxMaxGasLimit(uint256 _newPriorityTxMaxGasLimit) external onlyStateTransitionManager {
59:         require(_newPriorityTxMaxGasLimit <= MAX_GAS_PER_TRANSACTION, "n5");
60: 
61:         uint256 oldPriorityTxMaxGasLimit = s.priorityTxMaxGasLimit;
62:         s.priorityTxMaxGasLimit = _newPriorityTxMaxGasLimit;
63:         emit NewPriorityTxMaxGasLimit(oldPriorityTxMaxGasLimit, _newPriorityTxMaxGasLimit);
64:     }

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L79-L79)']
```solidity
79:     function setTokenMultiplier(uint128 _nominator, uint128 _denominator) external onlyAdminOrStateTransitionManager {
80:         uint128 oldNominator = s.baseTokenGasPriceMultiplierNominator;
81:         uint128 oldDenominator = s.baseTokenGasPriceMultiplierDenominator;
82: 
83:         s.baseTokenGasPriceMultiplierNominator = _nominator;
84:         s.baseTokenGasPriceMultiplierDenominator = _denominator;
85: 
86:         emit NewBaseTokenMultiplier(oldNominator, oldDenominator, _nominator, _denominator);
87:     }

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L23-L23)']
```solidity
23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin {
24:         
25:         address oldPendingAdmin = s.pendingAdmin;
26:         
27:         s.pendingAdmin = _newPendingAdmin;
28:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
29:     }

```
['[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L67-L67)']
```solidity
67:     function changeFeeParams(FeeParams calldata _newFeeParams) external onlyAdminOrStateTransitionManager {
68:         
69:         
70:         require(_newFeeParams.maxPubdataPerBatch >= _newFeeParams.priorityTxMaxPubdata, "n6");
71: 
72:         FeeParams memory oldFeeParams = s.feeParams;
73:         s.feeParams = _newFeeParams;
74: 
75:         emit NewFeeParams(oldFeeParams, _newFeeParams);
76:     }

```


</details>

## [NonCritical-28] Specific imports should be used where possible so only used code is imported

### Resolution 
In many cases only some functionality is used from an import. In such cases it makes more sense to use {} to specify what to import and thus save gas whilst improving readability

Num of instances: 33

### Findings 


<details><summary>Click to show findings</summary>

['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L7-L7)']
```solidity
7: import "./IBridgehub.sol";

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L8-L8)']
```solidity
8: import "../bridge/interfaces/IL1SharedBridge.sol";

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L9-L9)']
```solidity
9: import "../state-transition/IStateTransitionManager.sol";

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L10-L10)']
```solidity
10: import "../common/ReentrancyGuard.sol";

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L11-L11)']
```solidity
11: import "../state-transition/chain-interfaces/IZkSyncStateTransition.sol";

```
['[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L14-L14)']
```solidity
14: import "../vendor/AddressAliasHelper.sol";

```
['[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L12-L12)']
```solidity
12: import "../l2-deps/ISystemContext.sol";

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L5-L5)']
```solidity
5: import "../state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol";

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L6-L6)']
```solidity
6: import "../state-transition/chain-interfaces/IMailbox.sol";

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L7-L7)']
```solidity
7: import "../state-transition/chain-interfaces/IVerifier.sol";

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L8-L8)']
```solidity
8: import "../common/libraries/L2ContractHelper.sol";

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L6-L6)']
```solidity
6: import "../common/Messaging.sol";

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L10-L10)']
```solidity
10: import "../state-transition/libraries/TransactionValidator.sol";

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L8-L8)']
```solidity
8: import "../state-transition/libraries/Diamond.sol";

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L6-L6)']
```solidity
6: import "./BaseZkSyncUpgradeGenesis.sol";

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L7-L7)']
```solidity
7: import "./IDefaultUpgrade.sol";

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L13-L13)']
```solidity
13: import "../libraries/Diamond.sol";

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L5-L5)']
```solidity
5: import "./interfaces/IAccountCodeStorage.sol";

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L6-L6)']
```solidity
6: import "./libraries/Utils.sol";

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L5-L5)']
```solidity
5: import "./interfaces/IAccount.sol";

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L6-L6)']
```solidity
6: import "./libraries/TransactionHelper.sol";

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L7-L7)']
```solidity
7: import "./libraries/SystemContractHelper.sol";

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L8-L8)']
```solidity
8: import "./libraries/EfficientCall.sol";

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L5-L5)']
```solidity
5: import "./SystemContractHelper.sol";

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L6-L6)']
```solidity
6: import "./Utils.sol";

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L5-L5)']
```solidity
5: import "../openzeppelin/token/ERC20/IERC20.sol";

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L6-L6)']
```solidity
6: import "../openzeppelin/token/ERC20/utils/SafeERC20.sol";

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L8-L8)']
```solidity
8: import "../interfaces/IPaymasterFlow.sol";

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L9-L9)']
```solidity
9: import "../interfaces/IContractDeployer.sol";

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L11-L11)']
```solidity
11: import "./RLPEncoder.sol";

```
['[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L4-L4)']
```solidity
4: import "./EfficientCall.sol";

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/IAccount.sol#L5-L5)']
```solidity
5: import "../libraries/TransactionHelper.sol";

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L5-L5)']
```solidity
5: import "../L2ContractHelper.sol";

```


</details>

## [NonCritical-29] Not all event definitions are utilizing indexed variables.

### Resolution 
Try to index as much as three variables in event declarations as this is more gas efficient when done on value type variables (uint, address etc) however not for bytes and string variables 

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L29-L29)']
```solidity
29: event NewExecutionDelay(uint256 _newExecutionDelay); // <= FOUND

```
['[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L32-L32)']
```solidity
32: event ValidatorAdded(uint256 _chainId, address _addedValidator); // <= FOUND

```
['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L35-L35)']
```solidity
35: event ValidatorRemoved(uint256 _chainId, address _removedValidator); // <= FOUND

```


</details>

## [NonCritical-30] Functions within contracts are not ordered according to the solidity style guide

### Resolution 
The following order should be used within contracts

constructor

receive function (if exists)

fallback function (if exists)

external

public

internal

private

Rearrange the contract functions and contructors to fit this ordering

Num of instances: 20

### Findings 


<details><summary>Click to show findings</summary>

['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L19-L19)']
```solidity
19: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard  // <= FOUND

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30-L30)']
```solidity
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step  // <= FOUND

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16-L16)']
```solidity
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step  // <= FOUND

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L20-L20)']
```solidity
20: contract Governance is IGovernance, Ownable2Step  // <= FOUND

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L25-L25)']
```solidity
25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step  // <= FOUND

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L22-L22)']
```solidity
22: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor  // <= FOUND

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L30-L30)']
```solidity
30: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox  // <= FOUND

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L22-L22)']
```solidity
22: contract AccountCodeStorage is IAccountCodeStorage  // <= FOUND

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L23-L23)']
```solidity
23: contract ContractDeployer is IContractDeployer, ISystemContract  // <= FOUND

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L19-L19)']
```solidity
19: contract DefaultAccount is IAccount  // <= FOUND

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L18-L18)']
```solidity
18: contract KnownCodesStorage is IKnownCodesStorage, ISystemContract  // <= FOUND

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L25-L25)']
```solidity
25: contract L1Messenger is IL1Messenger, ISystemContract  // <= FOUND

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L18-L18)']
```solidity
18: contract L2BaseToken is IBaseToken, ISystemContract  // <= FOUND

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L19-L19)']
```solidity
19: contract MsgValueSimulator is ISystemContract  // <= FOUND

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L27-L27)']
```solidity
27: contract NonceHolder is INonceHolder, ISystemContract  // <= FOUND

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L17-L17)']
```solidity
17: contract SystemContext is ISystemContext, ISystemContextDeprecated, ISystemContract  // <= FOUND

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L23-L23)']
```solidity
23: contract L2SharedBridge is IL2SharedBridge, Initializable  // <= FOUND

```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L15-L15)']
```solidity
15: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade  // <= FOUND

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L44-L44)']
```solidity
44: abstract contract BaseZkSyncUpgrade is ZkSyncStateTransitionBase  // <= FOUND

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L17-L17)']
```solidity
17: abstract contract BaseZkSyncUpgradeGenesis is BaseZkSyncUpgrade  // <= FOUND

```


</details>

## [NonCritical-31] Double type casts create complexity within the code

### Resolution 
Double type casting should be avoided in Solidity contracts to prevent unintended consequences and ensure accurate data representation. Performing multiple type casts in succession can lead to unexpected truncation, rounding errors, or loss of precision, potentially compromising the contract's functionality and reliability. Furthermore, double type casting can make the code less readable and harder to maintain, increasing the likelihood of errors and misunderstandings during development and debugging. To ensure precise and consistent data handling, developers should use appropriate data types and avoid unnecessary or excessive type casting, promoting a more robust and dependable contract execution.

Num of instances: 27

### Findings 


<details><summary>Click to show findings</summary>

['[77](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L77-L77)']
```solidity
77:         bytes32 salt = bytes32(uint256(uint160(_l1Token))); // <= FOUND

```
['[265](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L265-L265)']
```solidity
261:         
262:         initData = bytes.concat(
263:             IDiamondInit.initialize.selector,
264:             bytes32(_chainId),
265:             bytes32(uint256(uint160(bridgehub))), // <= FOUND
266:             bytes32(uint256(uint160(address(this)))),
267:             bytes32(uint256(protocolVersion)),
268:             bytes32(uint256(uint160(_admin))),
269:             bytes32(uint256(uint160(validatorTimelock))),
270:             bytes32(uint256(uint160(_baseToken))),
271:             bytes32(uint256(uint160(_sharedBridge))),
272:             bytes32(storedBatchZero),
273:             diamondCut.initCalldata
274:         );

```
['[646](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L646-L646)']
```solidity
643:             
644:             
645:             bytes32 openingPoint = bytes32(
646:                 uint256(uint128(bytes16(_pubdataCommitments[i:i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET]))) // <= FOUND
647:             );

```
['[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L108-L108)']
```solidity
92:         
93:         
94:         
95:         
96:         
97:         
98:         
99:         
100:         
101:         
102:         L2Log memory l2Log = L2Log({
103:             l2ShardId: 0,
104:             isService: true,
105:             txNumberInBatch: _l2TxNumberInBatch,
106:             sender: L2_BOOTLOADER_ADDRESS,
107:             key: _l2TxHash,
108:             value: bytes32(uint256(_status)) // <= FOUND
109:         });

```
['[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L137-L137)']
```solidity
131:         return
132:             L2Log({
133:                 l2ShardId: 0,
134:                 isService: true,
135:                 txNumberInBatch: _message.txNumberInBatch,
136:                 sender: L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR,
137:                 key: bytes32(uint256(uint160(_message.sender))), // <= FOUND
138:                 value: keccak256(_message.data)
139:             });

```
['[107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L107-L107)']
```solidity
107:         bytes32 senderBytes = bytes32(uint256(uint160(_sender))); // <= FOUND

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L112-L112)']
```solidity
112:         return address(uint160(uint256(data))); // <= FOUND

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Config.sol#L112-L112)']
```solidity
112: bytes32 constant TWO_BRIDGES_MAGIC_VALUE = bytes32(uint256(keccak256("TWO_BRIDGES_MAGIC_VALUE")) - 1); // <= FOUND

```
['[106](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L106-L106)']
```solidity
105:         bytes32 hash = keccak256(
106:             bytes.concat(CREATE2_PREFIX, bytes32(uint256(uint160(_sender))), _salt, _bytecodeHash, constructorInputHash) // <= FOUND
107:         );

```
['[109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L109-L109)']
```solidity
109:         newAddress = address(uint160(uint256(hash))); // <= FOUND

```
['[124](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L124-L124)']
```solidity
121:         
122:         
123:         bytes32 hash = keccak256(
124:             bytes.concat(CREATE_PREFIX, bytes32(uint256(uint160(_sender))), bytes32(_senderNonce)) // <= FOUND
125:         );

```
['[270](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L270-L270)']
```solidity
268:         
269:         require(
270:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.getCodeHash(uint256(uint160(_newAddress))) == 0x0, // <= FOUND
271:             "Code hash is non-zero"
272:         );

```
['[131](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L131-L131)']
```solidity
125:         
126:         L2ToL1Log memory l2ToL1Log = L2ToL1Log({
127:             l2ShardId: 0,
128:             isService: true,
129:             txNumberInBlock: SYSTEM_CONTEXT_CONTRACT.txNumberInBlock(),
130:             sender: address(this),
131:             key: bytes32(uint256(uint160(msg.sender))), // <= FOUND
132:             value: hash
133:         });

```
['[285](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L285-L285)']
```solidity
279:         
280:         
281:         
282:         
283:         
284:         require(
285:             uint256(uint8(bytes1(_totalL2ToL1PubdataAndStateDiffs[calldataPtr]))) == // <= FOUND
286:                 STATE_DIFF_COMPRESSION_VERSION_NUMBER,
287:             "state diff compression version mismatch"
288:         );

```
['[321](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L321-L321)']
```solidity
320:         
321:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.L2_TO_L1_LOGS_TREE_ROOT_KEY)), l2ToL1LogsTreeRoot); // <= FOUND

```
['[323](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L323-L323)']
```solidity
321:         SystemContractHelper.toL1(
322:             true,
323:             bytes32(uint256(SystemLogKey.TOTAL_L2_TO_L1_PUBDATA_KEY)), // <= FOUND
324:             EfficientCall.keccak(totalL2ToL1Pubdata)
325:         );

```
['[326](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L326-L326)']
```solidity
326:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.STATE_DIFF_HASH_KEY)), stateDiffHash); // <= FOUND

```
['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L55-L55)']
```solidity
55:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_ONE_HASH_KEY)), blobHashes[0]); // <= FOUND

```
['[56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L56-L56)']
```solidity
56:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_TWO_HASH_KEY)), blobHashes[1]); // <= FOUND

```
['[420](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L420-L420)']
```solidity
418:         SystemContractHelper.toL1(
419:             false,
420:             bytes32(uint256(SystemLogKey.PACKED_BATCH_AND_L2_BLOCK_TIMESTAMP_KEY)), // <= FOUND
421:             bytes32(packedTimestamps)
422:         );

```
['[467](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L467-L467)']
```solidity
466:         
467:         SystemContractHelper.toL1(false, bytes32(uint256(SystemLogKey.PREV_BATCH_HASH_KEY)), _prevBatchHash); // <= FOUND

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L30-L30)']
```solidity
29:                 
30:                 encoded[0] = (_val == 0) ? bytes1(uint8(128)) : bytes1(uint8(_val)); // <= FOUND

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L34-L34)']
```solidity
34:                 encoded[0] = bytes1(uint8(hbs + 0x81)); // <= FOUND

```
['[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L64-L64)']
```solidity
64:                 encoded[0] = bytes1(uint8(_len + _offset)); // <= FOUND

```
['[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L69-L69)']
```solidity
69:                 encoded[0] = bytes1(uint8(_offset + hbs + 56)); // <= FOUND

```
['[94](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L94-L94)']
```solidity
93:         
94:         hashedBytecode = (hashedBytecode | bytes32(uint256(1 << 248))); // <= FOUND

```
['[158](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L158-L158)']
```solidity
158:         salt = bytes32(uint256(uint160(_l1Token))); // <= FOUND

```


</details>

## [NonCritical-32] Emits without msg.sender parameter

### Resolution 
In Solidity, when `msg.sender` plays a crucial role in a function's logic, it's important for transparency and auditability that any events emitted by this function include `msg.sender` as a parameter. This practice enhances the traceability and accountability of transactions, allowing users and external observers to easily track who initiated a particular action. Including `msg.sender` in event logs helps in creating a clear and verifiable record of interactions with the contract, thereby increasing user trust and facilitating easier debugging and analysis of contract behavior. It's a key aspect of writing clear, transparent, and user-friendly smart contracts.

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L62-L62)']
```solidity
60:     function acceptAdmin() external {
61:         address currentPendingAdmin = pendingAdmin;
62:         require(msg.sender == currentPendingAdmin, "n42");  // <= FOUND
63: 
64:         address previousAdmin = admin;
65:         admin = currentPendingAdmin;
66:         delete pendingAdmin;
67: 
68:         emit NewPendingAdmin(currentPendingAdmin, address(0));
69:         emit NewAdmin(previousAdmin, pendingAdmin);
70:     }

```
['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L62-L62)']
```solidity
60:     function acceptAdmin() external {
61:         address currentPendingAdmin = pendingAdmin;
62:         require(msg.sender == currentPendingAdmin, "n42");  // <= FOUND
63: 
64:         address previousAdmin = admin;
65:         admin = currentPendingAdmin;
66:         delete pendingAdmin;
67: 
68:         emit NewPendingAdmin(currentPendingAdmin, address(0));
69:         emit NewAdmin(previousAdmin, pendingAdmin);
70:     }

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L34-L34)']
```solidity
32:     function acceptAdmin() external {
33:         address pendingAdmin = s.pendingAdmin;
34:         require(msg.sender == pendingAdmin, "n4");  // <= FOUND
35: 
36:         address previousAdmin = s.admin;
37:         s.admin = pendingAdmin;
38:         delete s.pendingAdmin;
39: 
40:         emit NewPendingAdmin(pendingAdmin, address(0));
41:         emit NewAdmin(previousAdmin, pendingAdmin);
42:     }

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L34-L36)']
```solidity
32:     function transferFromTo(address _from, address _to, uint256 _amount) external override {
33:         require(
34:             msg.sender == MSG_VALUE_SYSTEM_CONTRACT || // <= FOUND
35:                 msg.sender == address(DEPLOYER_SYSTEM_CONTRACT) || // <= FOUND
36:                 msg.sender == BOOTLOADER_FORMAL_ADDRESS, // <= FOUND
37:             "Only system contracts with special access can call this method"
38:         );
39: 
40:         uint256 fromBalance = balance[_from];
41:         require(fromBalance >= _amount, "Transfer amount exceeds balance");
42:         unchecked {
43:             balance[_from] = fromBalance - _amount;
44:             
45:             
46:             balance[_to] += _amount;
47:         }
48: 
49:         emit Transfer(_from, _to, _amount);
50:     }

```
['[88](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L88-L89)']
```solidity
79:     function finalizeDeposit(
80:         address _l1Sender,
81:         address _l2Receiver,
82:         address _l1Token,
83:         uint256 _amount,
84:         bytes calldata _data
85:     ) external payable override {
86:         
87:         require(
88:             AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1Bridge || // <= FOUND
89:                 AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1LegacyBridge, // <= FOUND
90:             "mq"
91:         );
92:         require(msg.value == 0, "Value should be 0 for ERC20 bridge");
93: 
94:         address expectedL2Token = l2TokenAddress(_l1Token);
95:         address currentL1Token = l1TokenAddress[expectedL2Token];
96:         if (currentL1Token == address(0)) {
97:             address deployedToken = _deployL2Token(_l1Token, _data);
98:             require(deployedToken == expectedL2Token, "mt");
99:             l1TokenAddress[expectedL2Token] = _l1Token;
100:         } else {
101:             require(currentL1Token == _l1Token, "gg"); 
102:         }
103: 
104:         IL2StandardToken(expectedL2Token).bridgeMint(_l2Receiver, _amount);
105:         emit FinalizeDeposit(_l1Sender, _l2Receiver, expectedL2Token, _amount);
106:     }

```
['[120](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L120-L120)']
```solidity
111:     function reinitializeToken(
112:         ERC20Getters calldata _availableGetters,
113:         string memory _newName,
114:         string memory _newSymbol,
115:         uint8 _version
116:     ) external onlyNextVersion(_version) reinitializer(_version) {
117:         
118:         
119:         address beaconAddress = _getBeacon();
120:         require(msg.sender == UpgradeableBeacon(beaconAddress).owner(), "tt"); // <= FOUND
121: 
122:         __ERC20_init_unchained(_newName, _newSymbol);
123:         __ERC20Permit_init(_newName);
124:         availableGetters = _availableGetters;
125: 
126:         emit BridgeInitialize(l1Address, _newName, _newSymbol, decimals_);
127:     }

```


</details>

## [NonCritical-33] Functions with array parameters should have length checks in place

### Resolution 
Functions in Solidity that accept array parameters should incorporate length checks as a security measure. This is to prevent potential overflow errors, unwanted gas consumption, and manipulation attempts. Without length checks, an attacker could pass excessively large arrays as input, causing excessive computation and potentially causing the function to exceed the block gas limit, leading to a denial-of-service. Additionally, unexpected array sizes could lead to logic errors within the function. As a resolution, always validate array length at the start of functions handling array inputs, ensuring it aligns with the expectations of the function logic. This makes the code more robust and predictable.

Num of instances: 31

### Findings 


<details><summary>Click to show findings</summary>

['[176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L176-L183)']
```solidity
176:     function claimFailedDeposit(
177:         address _depositSender,
178:         address _l1Token,
179:         bytes32 _l2TxHash,
180:         uint256 _l2BatchNumber,
181:         uint256 _l2MessageIndex,
182:         uint16 _l2TxNumberInBatch,
183:         bytes32[] calldata _merkleProof // <= FOUND
184:     ) external nonReentrant {
185:         uint256 amount = depositAmount[_depositSender][_l1Token][_l2TxHash];
186:         require(amount != 0, "2T"); 
187:         delete depositAmount[_depositSender][_l1Token][_l2TxHash];
188: 
189:         sharedBridge.claimFailedDepositLegacyErc20Bridge(
190:             _depositSender,
191:             _l1Token,
192:             amount,
193:             _l2TxHash,
194:             _l2BatchNumber,
195:             _l2MessageIndex,
196:             _l2TxNumberInBatch,
197:             _merkleProof
198:         );
199:         emit ClaimedFailedDeposit(_depositSender, _l1Token, amount);
200:     }

```
['[208](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L208-L213)']
```solidity
208:     function finalizeWithdrawal(
209:         uint256 _l2BatchNumber,
210:         uint256 _l2MessageIndex,
211:         uint16 _l2TxNumberInBatch,
212:         bytes calldata _message,
213:         bytes32[] calldata _merkleProof // <= FOUND
214:     ) external nonReentrant {
215:         require(!isWithdrawalFinalized[_l2BatchNumber][_l2MessageIndex], "pw");
216:         
217: 
218:         (address l1Receiver, address l1Token, uint256 amount) = sharedBridge.finalizeWithdrawalLegacyErc20Bridge(
219:             _l2BatchNumber,
220:             _l2MessageIndex,
221:             _l2TxNumberInBatch,
222:             _message,
223:             _merkleProof
224:         );
225:         emit WithdrawalFinalized(l1Receiver, l1Token, amount);
226:     }

```
['[277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L277-L286)']
```solidity
277:     function claimFailedDeposit(
278:         uint256 _chainId,
279:         address _depositSender,
280:         address _l1Token,
281:         uint256 _amount,
282:         bytes32 _l2TxHash,
283:         uint256 _l2BatchNumber,
284:         uint256 _l2MessageIndex,
285:         uint16 _l2TxNumberInBatch,
286:         bytes32[] calldata _merkleProof // <= FOUND
287:     ) external override {
288:         _claimFailedDeposit(
289:             false,
290:             _chainId,
291:             _depositSender,
292:             _l1Token,
293:             _amount,
294:             _l2TxHash,
295:             _l2BatchNumber,
296:             _l2MessageIndex,
297:             _l2TxNumberInBatch,
298:             _merkleProof
299:         );
300:     }

```
['[303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L303-L313)']
```solidity
303:     function _claimFailedDeposit(
304:         bool _checkedInLegacyBridge,
305:         uint256 _chainId,
306:         address _depositSender,
307:         address _l1Token,
308:         uint256 _amount,
309:         bytes32 _l2TxHash,
310:         uint256 _l2BatchNumber,
311:         uint256 _l2MessageIndex,
312:         uint16 _l2TxNumberInBatch,
313:         bytes32[] calldata _merkleProof // <= FOUND
314:     ) internal nonReentrant {
315:         {
316:             bool proofValid = bridgehub.proveL1ToL2TransactionStatus(
317:                 _chainId,
318:                 _l2TxHash,
319:                 _l2BatchNumber,
320:                 _l2MessageIndex,
321:                 _l2TxNumberInBatch,
322:                 _merkleProof,
323:                 TxStatus.Failure
324:             );
325:             require(proofValid, "yn");
326:         }
327:         require(_amount > 0, "y1");
328: 
329:         {
330:             bool notCheckedInLegacyBridgeOrWeCanCheckDeposit;
331:             {
332:                 
333:                 bool weCanCheckDepositHere = !_isEraLegacyWithdrawal(_chainId, _l2BatchNumber);
334:                 
335:                 
336:                 
337:                 notCheckedInLegacyBridgeOrWeCanCheckDeposit = (!_checkedInLegacyBridge) || weCanCheckDepositHere;
338:             }
339:             if (notCheckedInLegacyBridgeOrWeCanCheckDeposit) {
340:                 bytes32 dataHash = depositHappened[_chainId][_l2TxHash];
341:                 bytes32 txDataHash = keccak256(abi.encode(_depositSender, _l1Token, _amount));
342:                 require(dataHash == txDataHash, "ShB: d.it not hap");
343:                 delete depositHappened[_chainId][_l2TxHash];
344:             }
345:         }
346: 
347:         if (!hyperbridgingEnabled[_chainId]) {
348:             
349:             require(chainBalance[_chainId][_l1Token] >= _amount, "ShB n funds");
350:             chainBalance[_chainId][_l1Token] -= _amount;
351:         }
352: 

```
['[385](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L385-L391)']
```solidity
385:     function finalizeWithdrawal(
386:         uint256 _chainId,
387:         uint256 _l2BatchNumber,
388:         uint256 _l2MessageIndex,
389:         uint16 _l2TxNumberInBatch,
390:         bytes calldata _message,
391:         bytes32[] calldata _merkleProof // <= FOUND
392:     ) external override {
393:         
394:         
395:         if (_isEraLegacyWithdrawal(_chainId, _l2BatchNumber)) {
396:             require(!legacyBridge.isWithdrawalFinalized(_l2BatchNumber, _l2MessageIndex), "ShB: legacy withdrawal");
397:         }
398:         _finalizeWithdrawal(_chainId, _l2BatchNumber, _l2MessageIndex, _l2TxNumberInBatch, _message, _merkleProof);
399:     }

```
['[409](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L409-L415)']
```solidity
409:     function _finalizeWithdrawal(
410:         uint256 _chainId,
411:         uint256 _l2BatchNumber,
412:         uint256 _l2MessageIndex,
413:         uint16 _l2TxNumberInBatch,
414:         bytes calldata _message,
415:         bytes32[] calldata _merkleProof // <= FOUND
416:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount) {
417:         require(!isWithdrawalFinalized[_chainId][_l2BatchNumber][_l2MessageIndex], "Withdrawal is already finalized");
418:         isWithdrawalFinalized[_chainId][_l2BatchNumber][_l2MessageIndex] = true;
419: 
420:         
421:         if (_isEraLegacyWithdrawal(_chainId, _l2BatchNumber)) {
422:             
423:             bool alreadyFinalized = IGetters(ERA_DIAMOND_PROXY).isEthWithdrawalFinalized(
424:                 _l2BatchNumber,
425:                 _l2MessageIndex
426:             );
427:             require(!alreadyFinalized, "Withdrawal is already finalized 2");
428:         }
429: 
430:         MessageParams memory messageParams = MessageParams({
431:             l2BatchNumber: _l2BatchNumber,
432:             l2MessageIndex: _l2MessageIndex,
433:             l2TxNumberInBatch: _l2TxNumberInBatch
434:         });
435:         (l1Receiver, l1Token, amount) = _checkWithdrawal(_chainId, messageParams, _message, _merkleProof);
436: 
437:         if (!hyperbridgingEnabled[_chainId]) {
438:             
439:             require(chainBalance[_chainId][l1Token] >= amount, "ShB not enough funds 2"); 
440:             chainBalance[_chainId][l1Token] -= amount;
441:         }
442: 
443:         if (l1Token == ETH_TOKEN_ADDRESS) {
444:             bool callSuccess;
445:             
446:             assembly {
447:                 callSuccess := call(gas(), l1Receiver, amount, 0, 0, 0, 0)
448:             }
449:             require(callSuccess, "ShB: withdraw failed");
450:         } else {
451:             
452:             IERC20(l1Token).safeTransfer(l1Receiver, amount);
453:         }
454:         emit WithdrawalFinalizedSharedBridge(_chainId, l1Receiver, l1Token, amount);
455:     }

```
['[458](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L458-L462)']
```solidity
458:     function _checkWithdrawal(
459:         uint256 _chainId,
460:         MessageParams memory _messageParams,
461:         bytes calldata _message,
462:         bytes32[] calldata _merkleProof // <= FOUND
463:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {
464:         (l1Receiver, l1Token, amount) = _parseL2WithdrawalMessage(_chainId, _message);
465:         L2Message memory l2ToL1Message;
466:         {
467:             bool baseTokenWithdrawal = (l1Token == bridgehub.baseToken(_chainId));
468:             address l2Sender = baseTokenWithdrawal ? L2_BASE_TOKEN_SYSTEM_CONTRACT_ADDR : l2BridgeAddress[_chainId];
469: 
470:             l2ToL1Message = L2Message({
471:                 txNumberInBatch: _messageParams.l2TxNumberInBatch,
472:                 sender: l2Sender,
473:                 data: _message
474:             });
475:         }
476: 
477:         bool success = bridgehub.proveL2MessageInclusion(
478:             _chainId,
479:             _messageParams.l2BatchNumber,
480:             _messageParams.l2MessageIndex,
481:             l2ToL1Message,
482:             _merkleProof
483:         );
484:         require(success, "ShB withd w proof"); 
485:     }

```
['[615](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L615-L620)']
```solidity
615:     function finalizeWithdrawalLegacyErc20Bridge(
616:         uint256 _l2BatchNumber,
617:         uint256 _l2MessageIndex,
618:         uint16 _l2TxNumberInBatch,
619:         bytes calldata _message,
620:         bytes32[] calldata _merkleProof // <= FOUND
621:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount) {
622:         (l1Receiver, l1Token, amount) = _finalizeWithdrawal(
623:             ERA_CHAIN_ID,
624:             _l2BatchNumber,
625:             _l2MessageIndex,
626:             _l2TxNumberInBatch,
627:             _message,
628:             _merkleProof
629:         );
630:     }

```
['[644](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L644-L652)']
```solidity
644:     function claimFailedDepositLegacyErc20Bridge(
645:         address _depositSender,
646:         address _l1Token,
647:         uint256 _amount,
648:         bytes32 _l2TxHash,
649:         uint256 _l2BatchNumber,
650:         uint256 _l2MessageIndex,
651:         uint16 _l2TxNumberInBatch,
652:         bytes32[] calldata _merkleProof // <= FOUND
653:     ) external override onlyLegacyBridge {
654:         _claimFailedDeposit(
655:             true,
656:             ERA_CHAIN_ID,
657:             _depositSender,
658:             _l1Token,
659:             _amount,
660:             _l2TxHash,
661:             _l2BatchNumber,
662:             _l2MessageIndex,
663:             _l2TxNumberInBatch,
664:             _merkleProof
665:         );
666:     }

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L152-L157)']
```solidity
152:     function proveL2MessageInclusion(
153:         uint256 _chainId,
154:         uint256 _batchNumber,
155:         uint256 _index,
156:         L2Message calldata _message,
157:         bytes32[] calldata _proof // <= FOUND
158:     ) external view override returns (bool) {
159:         address stateTransition = getStateTransition(_chainId);
160:         return IZkSyncStateTransition(stateTransition).proveL2MessageInclusion(_batchNumber, _index, _message, _proof);
161:     }

```
['[164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L164-L169)']
```solidity
164:     function proveL2LogInclusion(
165:         uint256 _chainId,
166:         uint256 _batchNumber,
167:         uint256 _index,
168:         L2Log memory _log,
169:         bytes32[] calldata _proof // <= FOUND
170:     ) external view override returns (bool) {
171:         address stateTransition = getStateTransition(_chainId);
172:         return IZkSyncStateTransition(stateTransition).proveL2LogInclusion(_batchNumber, _index, _log, _proof);
173:     }

```
['[176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L176-L182)']
```solidity
176:     function proveL1ToL2TransactionStatus(
177:         uint256 _chainId,
178:         bytes32 _l2TxHash,
179:         uint256 _l2BatchNumber,
180:         uint256 _l2MessageIndex,
181:         uint16 _l2TxNumberInBatch,
182:         bytes32[] calldata _merkleProof, // <= FOUND
183:         TxStatus _status
184:     ) external view override returns (bool) {
185:         address stateTransition = getStateTransition(_chainId);
186:         return
187:             IZkSyncStateTransition(stateTransition).proveL1ToL2TransactionStatus(
188:                 _l2TxHash,
189:                 _l2BatchNumber,
190:                 _l2MessageIndex,
191:                 _l2TxNumberInBatch,
192:                 _merkleProof,
193:                 _status
194:             );
195:     }

```
['[160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L160-L162)']
```solidity
160:     function proveBatches(
161:         StoredBatchInfo calldata,
162:         StoredBatchInfo[] calldata, // <= FOUND
163:         ProofInput calldata
164:     ) external onlyValidator(ERA_CHAIN_ID) {
165:         _propagateToZkSyncStateTransition(ERA_CHAIN_ID);
166:     }

```
['[171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L171-L174)']
```solidity
171:     function proveBatchesSharedBridge(
172:         uint256 _chainId,
173:         StoredBatchInfo calldata,
174:         StoredBatchInfo[] calldata, // <= FOUND
175:         ProofInput calldata
176:     ) external onlyValidator(_chainId) {
177:         _propagateToZkSyncStateTransition(_chainId);
178:     }

```
['[199](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L199-L201)']
```solidity
199:     function commitBatches(
200:         StoredBatchInfo memory _lastCommittedBatchData,
201:         CommitBatchInfo[] calldata _newBatchesData // <= FOUND
202:     ) external nonReentrant onlyValidator {
203:         _commitBatches(_lastCommittedBatchData, _newBatchesData);
204:     }

```
['[207](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L207-L210)']
```solidity
207:     function commitBatchesSharedBridge(
208:         uint256, 
209:         StoredBatchInfo memory _lastCommittedBatchData,
210:         CommitBatchInfo[] calldata _newBatchesData // <= FOUND
211:     ) external nonReentrant onlyValidator {
212:         _commitBatches(_lastCommittedBatchData, _newBatchesData);
213:     }

```
['[337](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L337-L339)']
```solidity
337:     function executeBatchesSharedBridge(
338:         uint256,
339:         StoredBatchInfo[] calldata _batchesData // <= FOUND
340:     ) external nonReentrant onlyValidator {
341:         _executeBatches(_batchesData);
342:     }

```
['[345](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L345-L345)']
```solidity
345:     function executeBatches(StoredBatchInfo[] calldata _batchesData) external nonReentrant onlyValidator { // <= FOUND
346:         _executeBatches(_batchesData);
347:     }

```
['[368](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L368-L370)']
```solidity
368:     function proveBatches(
369:         StoredBatchInfo calldata _prevBatch,
370:         StoredBatchInfo[] calldata _committedBatches, // <= FOUND
371:         ProofInput calldata _proof
372:     ) external nonReentrant onlyValidator {
373:         _proveBatches(_prevBatch, _committedBatches, _proof);
374:     }

```
['[377](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L377-L380)']
```solidity
377:     function proveBatchesSharedBridge(
378:         uint256, 
379:         StoredBatchInfo calldata _prevBatch,
380:         StoredBatchInfo[] calldata _committedBatches, // <= FOUND
381:         ProofInput calldata _proof
382:     ) external nonReentrant onlyValidator {
383:         _proveBatches(_prevBatch, _committedBatches, _proof);
384:     }

```
['[500](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L500-L504)']
```solidity
500:     function _createBatchCommitment(
501:         CommitBatchInfo calldata _newBatchData,
502:         bytes32 _stateDiffHash,
503:         bytes32[] memory _blobCommitments, // <= FOUND
504:         bytes32[] memory _blobHashes // <= FOUND
505:     ) internal view returns (bytes32) {
506:         bytes32 passThroughDataHash = keccak256(_batchPassThroughData(_newBatchData));
507:         bytes32 metadataHash = keccak256(_batchMetaParameters());
508:         bytes32 auxiliaryOutputHash = keccak256(
509:             _batchAuxiliaryOutput(_newBatchData, _stateDiffHash, _blobCommitments, _blobHashes)
510:         );
511: 
512:         return keccak256(abi.encode(passThroughDataHash, metadataHash, auxiliaryOutputHash));
513:     }

```
['[54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L54-L58)']
```solidity
54:     function proveL2MessageInclusion(
55:         uint256 _batchNumber,
56:         uint256 _index,
57:         L2Message memory _message,
58:         bytes32[] calldata _proof // <= FOUND
59:     ) public view returns (bool) {
60:         return _proveL2LogInclusion(_batchNumber, _index, _L2MessageToLog(_message), _proof);
61:     }

```
['[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L64-L68)']
```solidity
64:     function proveL2LogInclusion(
65:         uint256 _batchNumber,
66:         uint256 _index,
67:         L2Log memory _log,
68:         bytes32[] calldata _proof // <= FOUND
69:     ) external view returns (bool) {
70:         return _proveL2LogInclusion(_batchNumber, _index, _log, _proof);
71:     }

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L74-L79)']
```solidity
74:     function proveL1ToL2TransactionStatus(
75:         bytes32 _l2TxHash,
76:         uint256 _l2BatchNumber,
77:         uint256 _l2MessageIndex,
78:         uint16 _l2TxNumberInBatch,
79:         bytes32[] calldata _merkleProof, // <= FOUND
80:         TxStatus _status
81:     ) public view returns (bool) {
82:         
83:         
84:         
85:         
86:         
87:         
88:         
89:         
90:         
91:         
92:         L2Log memory l2Log = L2Log({
93:             l2ShardId: 0,
94:             isService: true,
95:             txNumberInBatch: _l2TxNumberInBatch,
96:             sender: L2_BOOTLOADER_ADDRESS,
97:             key: _l2TxHash,
98:             value: bytes32(uint256(_status))
99:         });
100:         return _proveL2LogInclusion(_l2BatchNumber, _l2MessageIndex, l2Log, _merkleProof);
101:     }

```
['[104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L104-L108)']
```solidity
104:     function _proveL2LogInclusion(
105:         uint256 _batchNumber,
106:         uint256 _index,
107:         L2Log memory _log,
108:         bytes32[] calldata _proof // <= FOUND
109:     ) internal view returns (bool) {
110:         require(_batchNumber <= s.totalBatchesExecuted, "xx");
111: 
112:         bytes32 hashedLog = keccak256(
113:             abi.encodePacked(_log.l2ShardId, _log.isService, _log.txNumberInBatch, _log.sender, _log.key, _log.value)
114:         );
115:         
116:         
117:         require(hashedLog != L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH, "tw");
118: 
119:         
120:         
121:         
122: 
123:         bytes32 calculatedRootHash = Merkle.calculateRoot(_proof, _index, hashedLog);
124:         bytes32 actualRootHash = s.l2LogsRootHashes[_batchNumber];
125: 
126:         return actualRootHash == calculatedRootHash;
127:     }

```
['[178](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L178-L183)']
```solidity
178:     function finalizeEthWithdrawal(
179:         uint256 _l2BatchNumber,
180:         uint256 _l2MessageIndex,
181:         uint16 _l2TxNumberInBatch,
182:         bytes calldata _message,
183:         bytes32[] calldata _merkleProof // <= FOUND
184:     ) external nonReentrant {
185:         require(s.chainId == ERA_CHAIN_ID, "finalizeEthWithdrawal only available for Era on mailbox");
186:         IL1SharedBridge(s.baseTokenBridge).finalizeWithdrawal(
187:             ERA_CHAIN_ID,
188:             _l2BatchNumber,
189:             _l2MessageIndex,
190:             _l2TxNumberInBatch,
191:             _message,
192:             _merkleProof
193:         );
194:     }

```
['[197](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L197-L203)']
```solidity
197:     function requestL2Transaction(
198:         address _contractL2,
199:         uint256 _l2Value,
200:         bytes calldata _calldata,
201:         uint256 _l2GasLimit,
202:         uint256 _l2GasPerPubdataByteLimit,
203:         bytes[] calldata _factoryDeps, // <= FOUND
204:         address _refundRecipient
205:     ) external payable returns (bytes32 canonicalTxHash) {
206:         require(s.chainId == ERA_CHAIN_ID, "legacy interface only available for era token");
207:         canonicalTxHash = _requestL2TransactionSender(
208:             BridgehubL2TransactionRequest({
209:                 sender: msg.sender,
210:                 contractL2: _contractL2,
211:                 mintValue: msg.value,
212:                 l2Value: _l2Value,
213:                 l2GasLimit: _l2GasLimit,
214:                 l2Calldata: _calldata,
215:                 l2GasPerPubdataByteLimit: _l2GasPerPubdataByteLimit,
216:                 factoryDeps: _factoryDeps,
217:                 refundRecipient: _refundRecipient
218:             })
219:         );
220:         IL1SharedBridge(s.baseTokenBridge).bridgehubDepositBaseToken{value: msg.value}(
221:             s.chainId,
222:             msg.sender,
223:             ETH_TOKEN_ADDRESS,
224:             msg.value
225:         );
226:     }

```
['[289](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L289-L292)']
```solidity
289:     function _serializeL2Transaction(
290:         WritePriorityOpParams memory _priorityOpParams,
291:         bytes memory _calldata,
292:         bytes[] memory _factoryDeps // <= FOUND
293:     ) internal pure returns (L2CanonicalTransaction memory transaction) {
294:         transaction = L2CanonicalTransaction({
295:             txType: PRIORITY_OPERATION_L2_TX_TYPE,
296:             from: uint256(uint160(_priorityOpParams.sender)),
297:             to: uint256(uint160(_priorityOpParams.contractAddressL2)),
298:             gasLimit: _priorityOpParams.l2GasLimit,
299:             gasPerPubdataByteLimit: _priorityOpParams.l2GasPricePerPubdata,
300:             maxFeePerGas: uint256(_priorityOpParams.l2GasPrice),
301:             maxPriorityFeePerGas: uint256(0),
302:             paymaster: uint256(0),
303:             
304:             nonce: uint256(_priorityOpParams.txId),
305:             value: _priorityOpParams.l2Value,
306:             reserved: [_priorityOpParams.valueToMint, uint256(uint160(_priorityOpParams.refundRecipient)), 0, 0],
307:             data: _calldata,
308:             signature: new bytes(0),
309:             factoryDeps: _hashFactoryDeps(_factoryDeps),
310:             paymasterInput: new bytes(0),
311:             reservedDynamic: new bytes(0)
312:         });
313:     }

```
['[316](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L316-L319)']
```solidity
316:     function _writePriorityOp(
317:         WritePriorityOpParams memory _priorityOpParams,
318:         bytes memory _calldata,
319:         bytes[] memory _factoryDeps // <= FOUND
320:     ) internal returns (bytes32 canonicalTxHash) {
321:         L2CanonicalTransaction memory transaction = _serializeL2Transaction(_priorityOpParams, _calldata, _factoryDeps);
322: 
323:         bytes memory transactionEncoding = abi.encode(transaction);
324: 
325:         TransactionValidator.validateL1ToL2Transaction(
326:             transaction,
327:             transactionEncoding,
328:             s.priorityTxMaxGasLimit,
329:             s.feeParams.priorityTxMaxPubdata
330:         );
331: 
332:         canonicalTxHash = keccak256(transactionEncoding);
333: 
334:         s.priorityQueue.pushBack(
335:             PriorityOperation({
336:                 canonicalTxHash: canonicalTxHash,
337:                 expirationTimestamp: _priorityOpParams.expirationTimestamp,
338:                 layer2Tip: uint192(0) 
339:             })
340:         );
341: 
342:         
343:         emit NewPriorityRequest(
344:             _priorityOpParams.txId,
345:             canonicalTxHash,
346:             _priorityOpParams.expirationTimestamp,
347:             transaction,
348:             _factoryDeps
349:         );
350:     }

```
['[180](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L180-L182)']
```solidity
180:     function _setL2SystemContractUpgrade(
181:         L2CanonicalTransaction calldata _l2ProtocolUpgradeTx,
182:         bytes[] calldata _factoryDeps, // <= FOUND
183:         uint256 _newProtocolVersion
184:     ) internal returns (bytes32) {
185:         
186:         if (_l2ProtocolUpgradeTx.txType == 0) {
187:             return bytes32(0);
188:         }
189: 
190:         require(_l2ProtocolUpgradeTx.txType == SYSTEM_UPGRADE_L2_TX_TYPE, "L2 system upgrade tx type is wrong");
191: 
192:         bytes memory encodedTransaction = abi.encode(_l2ProtocolUpgradeTx);
193: 
194:         TransactionValidator.validateL1ToL2Transaction(
195:             _l2ProtocolUpgradeTx,
196:             encodedTransaction,
197:             s.priorityTxMaxGasLimit,
198:             s.feeParams.priorityTxMaxPubdata
199:         );
200: 
201:         TransactionValidator.validateUpgradeTransaction(_l2ProtocolUpgradeTx);
202: 
203:         
204:         
205:         require(
206:             _l2ProtocolUpgradeTx.nonce == _newProtocolVersion,
207:             "The new protocol version should be included in the L2 system upgrade tx"
208:         );
209: 
210:         _verifyFactoryDeps(_factoryDeps, _l2ProtocolUpgradeTx.factoryDeps);
211: 
212:         bytes32 l2ProtocolUpgradeTxHash = keccak256(encodedTransaction);
213: 
214:         s.l2SystemContractsUpgradeTxHash = l2ProtocolUpgradeTxHash;
215: 
216:         return l2ProtocolUpgradeTxHash;
217:     }

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L13-L13)']
```solidity
13:     function forceDeploy(IContractDeployer.ForceDeployment[] calldata _forceDeployments) external payable { // <= FOUND
14:         IContractDeployer(DEPLOYER_SYSTEM_CONTRACT).forceDeployOnAddresses{value: msg.value}(_forceDeployments);
15:     }

```


</details>

## [NonCritical-34] Interface imports should be declared first

### Resolution 
Amend the ordering of imports to import interfaces first followed by other imports

Num of instances: 24

### Findings 


<details><summary>Click to show findings</summary>

['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L7-L27)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {Math} from "@openzeppelin/contracts/utils/math/Math.sol"; // <= FOUND
8: 
9: import {IMailbox} from "../../chain-interfaces/IMailbox.sol"; // <= FOUND
10: import {Merkle} from "../../libraries/Merkle.sol"; // <= FOUND
11: import {PriorityQueue, PriorityOperation} from "../../libraries/PriorityQueue.sol"; // <= FOUND
12: import {TransactionValidator} from "../../libraries/TransactionValidator.sol"; // <= FOUND
13: import {WritePriorityOpParams, L2CanonicalTransaction, L2Message, L2Log, TxStatus, BridgehubL2TransactionRequest} from "../../../common/Messaging.sol"; // <= FOUND
14: import {FeeParams, PubdataPricingMode} from "../ZkSyncStateTransitionStorage.sol"; // <= FOUND
15: import {UncheckedMath} from "../../../common/libraries/UncheckedMath.sol"; // <= FOUND
16: import {UnsafeBytes} from "../../../common/libraries/UnsafeBytes.sol"; // <= FOUND
17: import {L2ContractHelper} from "../../../common/libraries/L2ContractHelper.sol"; // <= FOUND
18: import {AddressAliasHelper} from "../../../vendor/AddressAliasHelper.sol"; // <= FOUND
19: import {ZkSyncStateTransitionBase} from "./ZkSyncStateTransitionBase.sol"; // <= FOUND
20: import {REQUIRED_L2_GAS_PRICE_PER_PUBDATA, L1_GAS_PER_PUBDATA_BYTE, L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH, PRIORITY_OPERATION_L2_TX_TYPE, PRIORITY_EXPIRATION, MAX_NEW_FACTORY_DEPS, ETH_TOKEN_ADDRESS, ERA_CHAIN_ID} from "../../../common/Config.sol"; // <= FOUND
21: import {L2_BOOTLOADER_ADDRESS, L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, L2_BASE_TOKEN_SYSTEM_CONTRACT_ADDR} from "../../../common/L2ContractAddresses.sol"; // <= FOUND
22: 
23: import {IBridgehub} from "../../../bridgehub/IBridgehub.sol"; // <= FOUND
24: import {IL1SharedBridge} from "../../../bridge/interfaces/IL1SharedBridge.sol"; // <= FOUND
25: 
27: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol"; // <= FOUND
28: 
32: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox {
33:     using UncheckedMath for uint256;
34:     using PriorityQueue for PriorityQueue.Queue;
35: 
37:     string public constant override getName = "MailboxFacet";
38: 
40:     function transferEthToSharedBridge() external onlyBaseTokenBridge {
41:         require(s.chainId == ERA_CHAIN_ID, "transferEthToSharedBridge only available for Era on mailbox");
42: 
43:         uint256 amount = address(this).balance;
44:         address sharedBridgeAddress = s.baseTokenBridge;
45:         IL1SharedBridge(sharedBridgeAddress).receiveEth{value: amount}(ERA_CHAIN_ID);
46:     }
47: 
49:     function bridgehubRequestL2Transaction(
50:         BridgehubL2TransactionRequest memory _request
51:     ) external payable onlyBridgehub returns (bytes32 canonicalTxHash) {
52:         canonicalTxHash = _requestL2TransactionSender(_request);
53:     }
54: 
56:     function proveL2MessageInclusion(
57:         uint256 _batchNumber,
58:         uint256 _index,
59:         L2Message memory _message,
60:         bytes32[] calldata _proof
61:     ) public view returns (bool) {
62:         return _proveL2LogInclusion(_batchNumber, _index, _L2MessageToLog(_message), _proof);
63:     }
64: 
66:     function proveL2LogInclusion(
67:         uint256 _batchNumber,
68:         uint256 _index,
69:         L2Log memory _log,
70:         bytes32[] calldata _proof
71:     ) external view returns (bool) {
72:         return _proveL2LogInclusion(_batchNumber, _index, _log, _proof);
73:     }
74: 
76:     function proveL1ToL2TransactionStatus(
77:         bytes32 _l2TxHash,
78:         uint256 _l2BatchNumber,
79:         uint256 _l2MessageIndex,
80:         uint16 _l2TxNumberInBatch,
81:         bytes32[] calldata _merkleProof,
82:         TxStatus _status
83:     ) public view returns (bool) {
84:         
85:         
86:         
87:         

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L7-L10)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {IBaseToken} from "./interfaces/IBaseToken.sol"; // <= FOUND
8: import {ISystemContract} from "./interfaces/ISystemContract.sol"; // <= FOUND
9: import {MSG_VALUE_SYSTEM_CONTRACT, DEPLOYER_SYSTEM_CONTRACT, BOOTLOADER_FORMAL_ADDRESS, L1_MESSENGER_CONTRACT} from "./Constants.sol"; // <= FOUND
10: import {IMailbox} from "./interfaces/IMailbox.sol"; // <= FOUND
11: 
20: contract L2BaseToken is IBaseToken, ISystemContract {
21:     
22:     mapping(address account => uint256 balance) internal balance;
23: 
25:     uint256 public override totalSupply;
26: 
34:     function transferFromTo(address _from, address _to, uint256 _amount) external override {
35:         require(
36:             msg.sender == MSG_VALUE_SYSTEM_CONTRACT ||
37:                 msg.sender == address(DEPLOYER_SYSTEM_CONTRACT) ||
38:                 msg.sender == BOOTLOADER_FORMAL_ADDRESS,
39:             "Only system contracts with special access can call this method"
40:         );
41: 
42:         uint256 fromBalance = balance[_from];
43:         require(fromBalance >= _amount, "Transfer amount exceeds balance");
44:         unchecked {
45:             balance[_from] = fromBalance - _amount;
46:             
47:             
48:             balance[_to] += _amount;
49:         }
50: 
51:         emit Transfer(_from, _to, _amount);
52:     }
53: 
58:     function balanceOf(uint256 _account) external view override returns (uint256) {
59:         return balance[address(uint160(_account))];
60:     }
61: 
66:     function mint(address _account, uint256 _amount) external override onlyCallFromBootloader {
67:         totalSupply += _amount;
68:         balance[_account] += _amount;
69:         emit Mint(_account, _amount);
70:     }
71: 
74:     function withdraw(address _l1Receiver) external payable override {
75:         uint256 amount = _burnMsgValue();
76: 
77:         
78:         bytes memory message = _getL1WithdrawMessage(_l1Receiver, amount);
79:         L1_MESSENGER_CONTRACT.sendToL1(message);
80: 
81:         emit Withdrawal(msg.sender, _l1Receiver, amount);
82:     }
83: 
87:     function withdrawWithMessage(address _l1Receiver, bytes memory _additionalData) external payable override {
88:         uint256 amount = _burnMsgValue();
89: 

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L7-L19)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {Initializable} from "@openzeppelin/contracts/proxy/utils/Initializable.sol"; // <= FOUND
8: import {BeaconProxy} from "@openzeppelin/contracts/proxy/beacon/BeaconProxy.sol"; // <= FOUND
9: import {UpgradeableBeacon} from "@openzeppelin/contracts/proxy/beacon/UpgradeableBeacon.sol"; // <= FOUND
10: 
11: import {IL1ERC20Bridge} from "./interfaces/IL1ERC20Bridge.sol"; // <= FOUND
12: import {IL2SharedBridge} from "./interfaces/IL2SharedBridge.sol"; // <= FOUND
13: import {IL2StandardToken} from "./interfaces/IL2StandardToken.sol"; // <= FOUND
14: 
15: import {L2StandardERC20} from "./L2StandardERC20.sol"; // <= FOUND
16: import {AddressAliasHelper} from "../vendor/AddressAliasHelper.sol"; // <= FOUND
17: import {L2ContractHelper, DEPLOYER_SYSTEM_CONTRACT, L2_BASE_TOKEN_ADDRESS, IContractDeployer} from "../L2ContractHelper.sol"; // <= FOUND
18: import {SystemContractsCaller} from "../SystemContractsCaller.sol"; // <= FOUND
19: import {ERA_CHAIN_ID, ERA_WETH_ADDRESS} from "../Config.sol"; // <= FOUND
20: 
25: contract L2SharedBridge is IL2SharedBridge, Initializable {
26:     
27:     address public override l1Bridge;
28: 
31:     UpgradeableBeacon public l2TokenBeacon;
32: 
34:     bytes32 internal l2TokenProxyBytecodeHash;
35: 
37:     mapping(address l2TokenAddress => address l1TokenAddress) public override l1TokenAddress;
38: 
39:     address private l1LegacyBridge;
40: 
43:     constructor() {
44:         _disableInitializers();
45:     }
46: 
51:     function initialize(
52:         address _l1Bridge,
53:         address _l1LegecyBridge,
54:         bytes32 _l2TokenProxyBytecodeHash,
55:         address _aliasedOwner
56:     ) external reinitializer(2) {
57:         require(_l1Bridge != address(0), "bf");
58:         require(_l2TokenProxyBytecodeHash != bytes32(0), "df");
59:         require(_aliasedOwner != address(0), "sf");
60:         require(_l2TokenProxyBytecodeHash != bytes32(0), "df");
61: 
62:         l1Bridge = _l1Bridge;
63:         l2TokenProxyBytecodeHash = _l2TokenProxyBytecodeHash;
64: 
65:         if (block.chainid != ERA_CHAIN_ID) {
66:             address l2StandardToken = address(new L2StandardERC20{salt: bytes32(0)}());
67:             l2TokenBeacon = new UpgradeableBeacon{salt: bytes32(0)}(l2StandardToken);
68:             l2TokenBeacon.transferOwnership(_aliasedOwner);
69:         } else {
70:             require(_l1LegecyBridge != address(0), "bf2");
71:             
72:         }
73:     }
74: 
81:     function finalizeDeposit(
82:         address _l1Sender,
83:         address _l2Receiver,
84:         address _l1Token,
85:         uint256 _amount,
86:         bytes calldata _data
87:     ) external payable override {
88:         
89:         require(

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L7-L11)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol"; // <= FOUND
8: import {LibMap} from "./libraries/LibMap.sol"; // <= FOUND
9: import {IExecutor} from "./chain-interfaces/IExecutor.sol"; // <= FOUND
10: import {IStateTransitionManager} from "./IStateTransitionManager.sol"; // <= FOUND
11: import {ERA_CHAIN_ID} from "../common/Config.sol"; // <= FOUND
12: 
24: contract ValidatorTimelock is IExecutor, Ownable2Step {
25:     using LibMap for LibMap.Uint32Map;
26: 
28:     string public constant override getName = "ValidatorTimelock";
29: 
31:     event NewExecutionDelay(uint256 _newExecutionDelay);
32: 
34:     event ValidatorAdded(uint256 _chainId, address _addedValidator);
35: 
37:     event ValidatorRemoved(uint256 _chainId, address _removedValidator);
38: 
40:     error AddressAlreadyValidator(uint256 _chainId);
41: 
43:     error ValidatorDoesNotExist(uint256 _chainId);
44: 
46:     IStateTransitionManager public stateTransitionManager;
47: 
49:     mapping(uint256 => LibMap.Uint32Map) internal committedBatchTimestamp;
50: 
52:     mapping(uint256 _chainId => mapping(address _validator => bool)) public validators;
53: 
55:     uint32 public executionDelay;
56: 
57:     constructor(address _initialOwner, uint32 _executionDelay) {
58:         _transferOwnership(_initialOwner);
59:         executionDelay = _executionDelay;
60:     }
61: 
63:     modifier onlyChainAdmin(uint256 _chainId) {
64:         require(msg.sender == stateTransitionManager.getChainAdmin(_chainId), "ValidatorTimelock: only chain admin");
65:         _;
66:     }
67: 
69:     modifier onlyValidator(uint256 _chainId) {
70:         require(validators[_chainId][msg.sender] == true, "ValidatorTimelock: only validator");
71:         _;
72:     }
73: 
75:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner {
76:         stateTransitionManager = _stateTransitionManager;
77:     }
78: 
80:     function addValidator(uint256 _chainId, address _newValidator) external onlyChainAdmin(_chainId) {
81:         if (validators[_chainId][_newValidator]) {
82:             revert AddressAlreadyValidator(_chainId);
83:         }
84:         validators[_chainId][_newValidator] = true;
85:         emit ValidatorAdded(_chainId, _newValidator);
86:     }

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L7-L16)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol"; // <= FOUND
8: 
9: import "./IBridgehub.sol"; // <= FOUND
10: import "../bridge/interfaces/IL1SharedBridge.sol"; // <= FOUND
11: import "../state-transition/IStateTransitionManager.sol"; // <= FOUND
12: import "../common/ReentrancyGuard.sol"; // <= FOUND
13: import "../state-transition/chain-interfaces/IZkSyncStateTransition.sol"; // <= FOUND
14: import {ETH_TOKEN_ADDRESS, TWO_BRIDGES_MAGIC_VALUE, BRIDGEHUB_MIN_SECOND_BRIDGE_ADDRESS} from "../common/Config.sol"; // <= FOUND
15: import {BridgehubL2TransactionRequest} from "../common/Messaging.sol"; // <= FOUND
16: import "../vendor/AddressAliasHelper.sol"; // <= FOUND
17: 
18: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step {
19:     
20:     IL1SharedBridge public sharedBridge;
21: 
23:     mapping(address _stateTransitionManager => bool) public stateTransitionManagerIsRegistered;
24:     
25:     mapping(address _token => bool) public tokenIsRegistered;
26: 
28:     mapping(uint256 _chainId => address) public stateTransitionManager;
29: 
31:     mapping(uint256 _chainId => address) public baseToken;
32: 
34:     address public admin;
35: 
37:     address private pendingAdmin;
38: 
40:     constructor() reentrancyGuardInitializer {}
41: 
43:     function initialize(address _owner) external reentrancyGuardInitializer {
44:         _transferOwnership(_owner);
45:     }
46: 
47:     modifier onlyOwnerOrAdmin() {
48:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin");
49:         _;
50:     }
51: 
53:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin {
54:         
55:         address oldPendingAdmin = pendingAdmin;
56:         
57:         pendingAdmin = _newPendingAdmin;
58:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
59:     }
60: 
62:     function acceptAdmin() external {
63:         address currentPendingAdmin = pendingAdmin;
64:         require(msg.sender == currentPendingAdmin, "n42"); 
65: 
66:         address previousAdmin = admin;
67:         admin = currentPendingAdmin;
68:         delete pendingAdmin;
69: 
70:         emit NewPendingAdmin(currentPendingAdmin, address(0));
71:         emit NewAdmin(previousAdmin, pendingAdmin);
72:     }
73: 
77:     function getStateTransition(uint256 _chainId) public view returns (address) {
78:         return IStateTransitionManager(stateTransitionManager[_chainId]).stateTransition(_chainId);

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L7-L11)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {ERC20PermitUpgradeable} from "@openzeppelin/contracts-upgradeable/token/ERC20/extensions/draft-ERC20PermitUpgradeable.sol"; // <= FOUND
8: import {UpgradeableBeacon} from "@openzeppelin/contracts/proxy/beacon/UpgradeableBeacon.sol"; // <= FOUND
9: import {ERC1967Upgrade} from "@openzeppelin/contracts/proxy/ERC1967/ERC1967Upgrade.sol"; // <= FOUND
10: 
11: import {IL2StandardToken} from "./interfaces/IL2StandardToken.sol"; // <= FOUND
12: 
17: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade {
18:     
22:     struct ERC20Getters {
23:         bool ignoreName;
24:         bool ignoreSymbol;
25:         bool ignoreDecimals;
26:     }
27: 
28:     ERC20Getters private availableGetters;
29: 
33:     uint8 private decimals_;
34: 
36:     address public override l2Bridge;
37: 
39:     address public override l1Address;
40: 
42:     constructor() {
43:         
44:         _disableInitializers();
45:     }
46: 
52:     function bridgeInitialize(address _l1Address, bytes memory _data) external initializer {
53:         require(_l1Address != address(0), "in6"); 
54:         l1Address = _l1Address;
55: 
56:         l2Bridge = msg.sender;
57: 
58:         
59:         (bytes memory nameBytes, bytes memory symbolBytes, bytes memory decimalsBytes) = abi.decode(
60:             _data,
61:             (bytes, bytes, bytes)
62:         );
63: 
64:         ERC20Getters memory getters;
65:         string memory decodedName;
66:         string memory decodedSymbol;
67: 
68:         
69:         
70: 
71:         
72:         
73:         
74:         
75:         
76: 
77:         try this.decodeString(nameBytes) returns (string memory nameString) {
78:             decodedName = nameString;
79:         } catch {

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L7-L10)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {PriorityOperation} from "../libraries/PriorityQueue.sol"; // <= FOUND
8: import {VerifierParams} from "../chain-interfaces/IVerifier.sol"; // <= FOUND
9: import {PubdataPricingMode} from "../chain-deps/ZkSyncStateTransitionStorage.sol"; // <= FOUND
10: import {IZkSyncStateTransitionBase} from "./IZkSyncStateTransitionBase.sol"; // <= FOUND
11: 
15: interface IGetters is IZkSyncStateTransitionBase {
16:     
21:     function getVerifier() external view returns (address);
22: 
24:     function getAdmin() external view returns (address);
25: 
27:     function getPendingAdmin() external view returns (address);
28: 
30:     function getBridgehub() external view returns (address);
31: 
33:     function getStateTransitionManager() external view returns (address);
34: 
36:     function getBaseToken() external view returns (address);
37: 
39:     function getBaseTokenBridge() external view returns (address);
40: 
42:     function getTotalBatchesCommitted() external view returns (uint256);
43: 
45:     function getTotalBatchesVerified() external view returns (uint256);
46: 
48:     function getTotalBatchesExecuted() external view returns (uint256);
49: 
51:     function getTotalPriorityTxs() external view returns (uint256);
52: 
58:     function getFirstUnprocessedPriorityTx() external view returns (uint256);
59: 
61:     function getPriorityQueueSize() external view returns (uint256);
62: 
64:     function priorityQueueFrontOperation() external view returns (PriorityOperation memory);
65: 
67:     function isValidator(address _address) external view returns (bool);
68: 
70:     function l2LogsRootHash(uint256 _batchNumber) external view returns (bytes32 merkleRoot);
71: 
75:     function storedBatchHash(uint256 _batchNumber) external view returns (bytes32);
76: 
78:     function getL2BootloaderBytecodeHash() external view returns (bytes32);
79: 
81:     function getL2DefaultAccountBytecodeHash() external view returns (bytes32);
82: 
84:     function getVerifierParams() external view returns (VerifierParams memory);
85: 
87:     function isDiamondStorageFrozen() external view returns (bool);
88: 
90:     function getProtocolVersion() external view returns (uint256);
91: 
93:     function getL2SystemContractsUpgradeTxHash() external view returns (bytes32);
94: 
100:     function getL2SystemContractsUpgradeBatchNumber() external view returns (uint256);

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L7-L8)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol"; // <= FOUND
8: import {IGovernance} from "./IGovernance.sol"; // <= FOUND
9: 
22: contract Governance is IGovernance, Ownable2Step {
23:     
24:     uint256 internal constant EXECUTED_PROPOSAL_TIMESTAMP = uint256(1);
25: 
28:     address public securityCouncil;
29: 
34:     mapping(bytes32 operationId => uint256 executionTimestamp) public timestamps;
35: 
37:     uint256 public minDelay;
38: 
43:     constructor(address _admin, address _securityCouncil, uint256 _minDelay) {
44:         require(_admin != address(0), "Admin should be non zero address");
45: 
46:         _transferOwnership(_admin);
47: 
48:         securityCouncil = _securityCouncil;
49:         emit ChangeSecurityCouncil(address(0), _securityCouncil);
50: 
51:         minDelay = _minDelay;
52:         emit ChangeMinDelay(0, _minDelay);
53:     }
54: 
60:     modifier onlySelf() {
61:         require(msg.sender == address(this), "Only governance contract itself is allowed to call this function");
62:         _;
63:     }
64: 
66:     modifier onlySecurityCouncil() {
67:         require(msg.sender == securityCouncil, "Only security council is allowed to call this function");
68:         _;
69:     }
70: 
72:     modifier onlyOwnerOrSecurityCouncil() {
73:         require(
74:             msg.sender == owner() || msg.sender == securityCouncil,
75:             "Only the owner and security council are allowed to call this function"
76:         );
77:         _;
78:     }
79: 
86:     function isOperation(bytes32 _id) public view returns (bool) {
87:         return getOperationState(_id) != OperationState.Unset;
88:     }
89: 
91:     function isOperationPending(bytes32 _id) public view returns (bool) {
92:         OperationState state = getOperationState(_id);
93:         return state == OperationState.Waiting || state == OperationState.Ready;
94:     }
95: 

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L7-L19)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {ZkSyncStateTransitionBase} from "./ZkSyncStateTransitionBase.sol"; // <= FOUND
8: import {COMMIT_TIMESTAMP_NOT_OLDER, COMMIT_TIMESTAMP_APPROXIMATION_DELTA, EMPTY_STRING_KECCAK, L2_TO_L1_LOG_SERIALIZE_SIZE, MAX_L2_TO_L1_LOGS_COMMITMENT_BYTES, PACKED_L2_BLOCK_TIMESTAMP_MASK, PUBLIC_INPUT_SHIFT, POINT_EVALUATION_PRECOMPILE_ADDR} from "../../../common/Config.sol"; // <= FOUND
9: import {IExecutor, L2_LOG_ADDRESS_OFFSET, L2_LOG_KEY_OFFSET, L2_LOG_VALUE_OFFSET, SystemLogKey, LogProcessingOutput, PubdataSource, BLS_MODULUS, PUBDATA_COMMITMENT_SIZE, PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET, PUBDATA_COMMITMENT_COMMITMENT_OFFSET, MAX_NUMBER_OF_BLOBS, TOTAL_BLOBS_IN_COMMITMENT} from "../../chain-interfaces/IExecutor.sol"; // <= FOUND
10: import {PriorityQueue, PriorityOperation} from "../../libraries/PriorityQueue.sol"; // <= FOUND
11: import {UncheckedMath} from "../../../common/libraries/UncheckedMath.sol"; // <= FOUND
12: import {UnsafeBytes} from "../../../common/libraries/UnsafeBytes.sol"; // <= FOUND
13: import {VerifierParams} from "../../chain-interfaces/IVerifier.sol"; // <= FOUND
14: import {L2_BOOTLOADER_ADDRESS, L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, L2_PUBDATA_CHUNK_PUBLISHER_ADDR} from "../../../common/L2ContractAddresses.sol"; // <= FOUND
15: import {PubdataPricingMode} from "../ZkSyncStateTransitionStorage.sol"; // <= FOUND
16: import {IStateTransitionManager} from "../../IStateTransitionManager.sol"; // <= FOUND
17: 
19: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol"; // <= FOUND
20: 
24: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor {
25:     using UncheckedMath for uint256;
26:     using PriorityQueue for PriorityQueue.Queue;
27: 
29:     string public constant override getName = "ExecutorFacet";
30: 
34:     function _commitOneBatch(
35:         StoredBatchInfo memory _previousBatch,
36:         CommitBatchInfo calldata _newBatch,
37:         bytes32 _expectedSystemContractUpgradeTxHash
38:     ) internal view returns (StoredBatchInfo memory) {
39:         require(_newBatch.batchNumber == _previousBatch.batchNumber + 1, "f"); 
40: 
41:         uint8 pubdataSource = uint8(bytes1(_newBatch.pubdataCommitments[0]));
42:         require(pubdataSource == uint8(PubdataSource.Calldata) || pubdataSource == uint8(PubdataSource.Blob), "us");
43: 
44:         
45:         
46:         LogProcessingOutput memory logOutput = _processL2Logs(_newBatch, _expectedSystemContractUpgradeTxHash);
47: 
48:         bytes32[] memory blobCommitments = new bytes32[](MAX_NUMBER_OF_BLOBS);
49:         bytes32[] memory blobHashes = new bytes32[](MAX_NUMBER_OF_BLOBS);
50:         if (s.feeParams.pubdataPricingMode == PubdataPricingMode.Validium) {
51:             
52:             require(logOutput.pubdataHash == 0x00, "v0h");
53:             require(_newBatch.pubdataCommitments.length == 1);
54:         } else if (pubdataSource == uint8(PubdataSource.Blob)) {
55:             
56:             
57:             blobHashes[0] = logOutput.blob1Hash;
58:             blobHashes[1] = logOutput.blob2Hash;
59:             
60:             blobCommitments = _verifyBlobInformation(_newBatch.pubdataCommitments[1:], blobHashes);
61:         } else if (pubdataSource == uint8(PubdataSource.Calldata)) {
62:             
63:             require(
64:                 logOutput.pubdataHash ==
65:                     keccak256(_newBatch.pubdataCommitments[1:_newBatch.pubdataCommitments.length - 32]),
66:                 "wp"
67:             );
68:             blobHashes[0] = logOutput.blob1Hash;
69:             blobCommitments[0] = bytes32(
70:                 _newBatch.pubdataCommitments[_newBatch.pubdataCommitments.length - 32:_newBatch
71:                     .pubdataCommitments
72:                     .length]
73:             );
74:         }
75: 
76:         require(_previousBatch.batchHash == logOutput.previousBatchHash, "l");
77:         

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L7-L10)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {IL1SharedBridge} from "../bridge/interfaces/IL1SharedBridge.sol"; // <= FOUND
8: import "../common/Messaging.sol"; // <= FOUND
9: import "../state-transition/IStateTransitionManager.sol"; // <= FOUND
10: import "../state-transition/libraries/Diamond.sol"; // <= FOUND
11: 
12: struct L2TransactionRequestDirect {
13:     uint256 chainId;
14:     uint256 mintValue;
15:     address l2Contract;
16:     uint256 l2Value;
17:     bytes l2Calldata;
18:     uint256 l2GasLimit;
19:     uint256 l2GasPerPubdataByteLimit;
20:     bytes[] factoryDeps;
21:     address refundRecipient;
22: }
23: 
24: struct L2TransactionRequestTwoBridgesOuter {
25:     uint256 chainId;
26:     uint256 mintValue;
27:     uint256 l2Value;
28:     uint256 l2GasLimit;
29:     uint256 l2GasPerPubdataByteLimit;
30:     address refundRecipient;
31:     address secondBridgeAddress;
32:     uint256 secondBridgeValue;
33:     bytes secondBridgeCalldata;
34: }
35: 
36: struct L2TransactionRequestTwoBridgesInner {
37:     bytes32 magicValue;
38:     address l2Contract;
39:     bytes l2Calldata;
40:     bytes[] factoryDeps;
41:     bytes32 txDataHash;
42: }
43: 
44: interface IBridgehub {
45:     
47:     event NewPendingAdmin(address indexed oldPendingAdmin, address indexed newPendingAdmin);
48: 
50:     event NewAdmin(address indexed oldAdmin, address indexed newAdmin);
51: 
55:     function setPendingAdmin(address _newPendingAdmin) external;
56: 
58:     function acceptAdmin() external;
59: 
61:     function stateTransitionManagerIsRegistered(address _stateTransitionManager) external view returns (bool);
62: 
63:     function stateTransitionManager(uint256 _chainId) external view returns (address);
64: 
65:     function tokenIsRegistered(address _baseToken) external view returns (bool);
66: 
67:     function baseToken(uint256 _chainId) external view returns (address);

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L7-L22)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {Diamond} from "./libraries/Diamond.sol"; // <= FOUND
8: import {DiamondProxy} from "./chain-deps/DiamondProxy.sol"; // <= FOUND
9: import {IAdmin} from "./chain-interfaces/IAdmin.sol"; // <= FOUND
10: import {IDefaultUpgrade} from "../upgrades/IDefaultUpgrade.sol"; // <= FOUND
11: import {IDiamondInit} from "./chain-interfaces/IDiamondInit.sol"; // <= FOUND
12: import {IExecutor} from "./chain-interfaces/IExecutor.sol"; // <= FOUND
13: import {IStateTransitionManager, StateTransitionManagerInitializeData} from "./IStateTransitionManager.sol"; // <= FOUND
14: import {ISystemContext} from "./l2-deps/ISystemContext.sol"; // <= FOUND
15: import {IZkSyncStateTransition} from "./chain-interfaces/IZkSyncStateTransition.sol"; // <= FOUND
16: import {L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, L2_FORCE_DEPLOYER_ADDR} from "../common/L2ContractAddresses.sol"; // <= FOUND
17: import {L2CanonicalTransaction} from "../common/Messaging.sol"; // <= FOUND
18: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol"; // <= FOUND
19: import {ProposedUpgrade} from "../upgrades/BaseZkSyncUpgrade.sol"; // <= FOUND
20: import {ReentrancyGuard} from "../common/ReentrancyGuard.sol"; // <= FOUND
21: import {REQUIRED_L2_GAS_PRICE_PER_PUBDATA, L2_TO_L1_LOG_SERIALIZE_SIZE, DEFAULT_L2_LOGS_TREE_ROOT_HASH, EMPTY_STRING_KECCAK, SYSTEM_UPGRADE_L2_TX_TYPE, ERA_DIAMOND_PROXY, ERA_CHAIN_ID} from "../common/Config.sol"; // <= FOUND
22: import {VerifierParams} from "./chain-interfaces/IVerifier.sol"; // <= FOUND
23: 
27: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step {
28:     
29:     address public immutable bridgehub;
30: 
32:     mapping(uint256 => address) public stateTransition;
33: 
35:     bytes32 public storedBatchZero;
36: 
38:     bytes32 public initialCutHash;
39: 
41:     address public genesisUpgrade;
42: 
44:     uint256 public protocolVersion;
45: 
47:     address public validatorTimelock;
48: 
50:     mapping(uint256 => bytes32) public upgradeCutHash;
51: 
53:     address public admin;
54: 
56:     address private pendingAdmin;
57: 
60:     constructor(address _bridgehub) reentrancyGuardInitializer {
61:         bridgehub = _bridgehub;
62:     }
63: 
65:     modifier onlyBridgehub() {
66:         require(msg.sender == bridgehub, "StateTransition: only bridgehub");
67:         _;
68:     }
69: 
71:     modifier onlyOwnerOrAdmin() {
72:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin");
73:         _;
74:     }
75: 
76:     function getChainAdmin(uint256 _chainId) external view override returns (address) {
77:         return IZkSyncStateTransition(stateTransition[_chainId]).getAdmin();
78:     }
79: 
81:     function initialize(
82:         StateTransitionManagerInitializeData calldata _initializeData
83:     ) external reentrancyGuardInitializer {
84:         require(_initializeData.governor != address(0), "StateTransition: governor zero");
85:         _transferOwnership(_initializeData.governor);
86: 
87:         genesisUpgrade = _initializeData.genesisUpgrade;
88:         protocolVersion = _initializeData.protocolVersion;
89:         validatorTimelock = _initializeData.validatorTimelock;

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L7-L15)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {IAdmin} from "./IAdmin.sol"; // <= FOUND
8: import {IExecutor} from "./IExecutor.sol"; // <= FOUND
9: import {IGetters} from "./IGetters.sol"; // <= FOUND
10: import {IMailbox} from "./IMailbox.sol"; // <= FOUND
11: import {Verifier} from "../Verifier.sol"; // <= FOUND
12: import {VerifierParams} from "./IVerifier.sol"; // <= FOUND
13: 
15: import "../libraries/Diamond.sol"; // <= FOUND
16: 
17: interface IZkSyncStateTransition is IAdmin, IExecutor, IGetters, IMailbox {
18:     
19:     event ProposeTransparentUpgrade(
20:         Diamond.DiamondCutData diamondCut,
21:         uint256 indexed proposalId,
22:         bytes32 proposalSalt
23:     );
24: }
25: 

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L7-L9)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {L2CanonicalTransaction} from "../../common/Messaging.sol"; // <= FOUND
8: import {IVerifier, VerifierParams} from "./IVerifier.sol"; // <= FOUND
9: import {FeeParams} from "../chain-deps/ZkSyncStateTransitionStorage.sol"; // <= FOUND
10: 
27: struct InitializeData {
28:     uint256 chainId;
29:     address bridgehub;
30:     address stateTransitionManager;
31:     uint256 protocolVersion;
32:     address admin;
33:     address validatorTimelock;
34:     address baseToken;
35:     address baseTokenBridge;
36:     bytes32 storedBatchZero;
37:     IVerifier verifier;
38:     VerifierParams verifierParams;
39:     bytes32 l2BootloaderBytecodeHash;
40:     bytes32 l2DefaultAccountBytecodeHash;
41:     uint256 priorityTxMaxGasLimit;
42:     FeeParams feeParams;
43:     address blobVersionedHashRetriever;
44: }
45: 
53: struct InitializeDataNewChain {
54:     IVerifier verifier;
55:     VerifierParams verifierParams;
56:     bytes32 l2BootloaderBytecodeHash;
57:     bytes32 l2DefaultAccountBytecodeHash;
58:     uint256 priorityTxMaxGasLimit;
59:     FeeParams feeParams;
60:     address blobVersionedHashRetriever;
61: }
62: 
63: interface IDiamondInit {
64:     function initialize(InitializeData calldata _initData) external returns (bytes32);
65: }
66: 

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L7-L11)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {Utils} from "./libraries/Utils.sol"; // <= FOUND
8: import {EfficientCall} from "./libraries/EfficientCall.sol"; // <= FOUND
9: import {ISystemContract} from "./interfaces/ISystemContract.sol"; // <= FOUND
10: import {SystemContractHelper} from "./libraries/SystemContractHelper.sol"; // <= FOUND
11: import {MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT, REAL_BASE_TOKEN_SYSTEM_CONTRACT} from "./Constants.sol"; // <= FOUND
12: 
21: contract MsgValueSimulator is ISystemContract {
22:     
27:     function _getAbiParams() internal view returns (uint256 value, bool isSystemCall, address to) {
28:         value = SystemContractHelper.getExtraAbiData(0);
29:         uint256 addressAsUint = SystemContractHelper.getExtraAbiData(1);
30:         uint256 mask = SystemContractHelper.getExtraAbiData(2);
31: 
32:         isSystemCall = (mask & MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT) != 0;
33: 
34:         to = address(uint160(addressAsUint));
35:     }
36: 
38:     uint256 constant GAS_TO_PASS = 2300;
39: 
43:     uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000;
44: 
49:     fallback(bytes calldata _data) external onlySystemCall returns (bytes memory) {
50:         
51:         
52:         uint256 gasInContext = gasleft();
53:         
54:         
55:         uint256 userGas = gasInContext > MSG_VALUE_SIMULATOR_STIPEND_GAS
56:             ? gasInContext - MSG_VALUE_SIMULATOR_STIPEND_GAS
57:             : 0;
58: 
59:         (uint256 value, bool isSystemCall, address to) = _getAbiParams();
60: 
61:         
62:         require(to != address(this), "MsgValueSimulator calls itself");
63: 
64:         if (value != 0) {
65:             (bool success, ) = address(REAL_BASE_TOKEN_SYSTEM_CONTRACT).call(
66:                 abi.encodeCall(REAL_BASE_TOKEN_SYSTEM_CONTRACT.transferFromTo, (msg.sender, to, value))
67:             );
68: 
69:             
70:             if (!success) {
71:                 assembly {
72:                     revert(0, 0)
73:                 }
74:             }
75: 
76:             
77:             userGas += GAS_TO_PASS;
78:         }
79: 
80:         
81:         SystemContractHelper.setValueForNextFarCall(Utils.safeCastToU128(value));

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L7-L14)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import "../openzeppelin/token/ERC20/IERC20.sol"; // <= FOUND
8: import "../openzeppelin/token/ERC20/utils/SafeERC20.sol"; // <= FOUND
9: 
10: import "../interfaces/IPaymasterFlow.sol"; // <= FOUND
11: import "../interfaces/IContractDeployer.sol"; // <= FOUND
12: import {BASE_TOKEN_SYSTEM_CONTRACT, BOOTLOADER_FORMAL_ADDRESS} from "../Constants.sol"; // <= FOUND
13: import "./RLPEncoder.sol"; // <= FOUND
14: import "./EfficientCall.sol"; // <= FOUND
15: 
17: uint8 constant EIP_712_TX_TYPE = 0x71;
18: 
20: uint8 constant LEGACY_TX_TYPE = 0x0;
21: 
22: uint8 constant EIP_2930_TX_TYPE = 0x01;
23: 
24: uint8 constant EIP_1559_TX_TYPE = 0x02;
25: 
27: struct Transaction {
28:     
29:     uint256 txType;
30:     
31:     uint256 from;
32:     
33:     uint256 to;
34:     
36:     uint256 gasLimit;
37:     
38:     uint256 gasPerPubdataByteLimit;
39:     
41:     uint256 maxFeePerGas;
42:     
44:     uint256 maxPriorityFeePerGas;
45:     
46:     uint256 paymaster;
47:     
48:     uint256 nonce;
49:     
50:     uint256 value;
51:     
59:     uint256[4] reserved;
60:     
61:     bytes data;
62:     
63:     bytes signature;
64:     
67:     bytes32[] factoryDeps;
68:     
69:     bytes paymasterInput;
70:     
72:     bytes reservedDynamic;
73: }
74: 
80: library TransactionHelper {
81:     using SafeERC20 for IERC20;
82: 
84:     bytes32 constant EIP712_DOMAIN_TYPEHASH = keccak256("EIP712Domain(string name,string version,uint256 chainId)");
85: 
86:     bytes32 constant EIP712_TRANSACTION_TYPE_HASH =

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L7-L15)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {IAdmin} from "../../chain-interfaces/IAdmin.sol"; // <= FOUND
8: import {Diamond} from "../../libraries/Diamond.sol"; // <= FOUND
9: import {MAX_GAS_PER_TRANSACTION} from "../../../common/Config.sol"; // <= FOUND
10: import {FeeParams, PubdataPricingMode} from "../ZkSyncStateTransitionStorage.sol"; // <= FOUND
11: import {ZkSyncStateTransitionBase} from "./ZkSyncStateTransitionBase.sol"; // <= FOUND
12: import {IStateTransitionManager} from "../../IStateTransitionManager.sol"; // <= FOUND
13: 
15: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol"; // <= FOUND
16: 
20: contract AdminFacet is ZkSyncStateTransitionBase, IAdmin {
21:     
22:     string public constant override getName = "AdminFacet";
23: 
25:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin {
26:         
27:         address oldPendingAdmin = s.pendingAdmin;
28:         
29:         s.pendingAdmin = _newPendingAdmin;
30:         emit NewPendingAdmin(oldPendingAdmin, _newPendingAdmin);
31:     }
32: 
34:     function acceptAdmin() external {
35:         address pendingAdmin = s.pendingAdmin;
36:         require(msg.sender == pendingAdmin, "n4"); 
37: 
38:         address previousAdmin = s.admin;
39:         s.admin = pendingAdmin;
40:         delete s.pendingAdmin;
41: 
42:         emit NewPendingAdmin(pendingAdmin, address(0));
43:         emit NewAdmin(previousAdmin, pendingAdmin);
44:     }
45: 
47:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager {
48:         s.validators[_validator] = _active;
49:         emit ValidatorStatusUpdate(_validator, _active);
50:     }
51: 
53:     function setPorterAvailability(bool _zkPorterIsAvailable) external onlyStateTransitionManager {
54:         
55:         s.zkPorterIsAvailable = _zkPorterIsAvailable;
56:         emit IsPorterAvailableStatusUpdate(_zkPorterIsAvailable);
57:     }
58: 
60:     function setPriorityTxMaxGasLimit(uint256 _newPriorityTxMaxGasLimit) external onlyStateTransitionManager {
61:         require(_newPriorityTxMaxGasLimit <= MAX_GAS_PER_TRANSACTION, "n5");
62: 
63:         uint256 oldPriorityTxMaxGasLimit = s.priorityTxMaxGasLimit;
64:         s.priorityTxMaxGasLimit = _newPriorityTxMaxGasLimit;
65:         emit NewPriorityTxMaxGasLimit(oldPriorityTxMaxGasLimit, _newPriorityTxMaxGasLimit);
66:     }
67: 
69:     function changeFeeParams(FeeParams calldata _newFeeParams) external onlyAdminOrStateTransitionManager {
70:         
71:         
72:         require(_newFeeParams.maxPubdataPerBatch >= _newFeeParams.priorityTxMaxPubdata, "n6");
73: 
74:         FeeParams memory oldFeeParams = s.feeParams;
75:         s.feeParams = _newFeeParams;

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L7-L26)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {Initializable} from "@openzeppelin/contracts/proxy/utils/Initializable.sol"; // <= FOUND
8: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol"; // <= FOUND
9: 
10: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol"; // <= FOUND
11: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol"; // <= FOUND
12: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol"; // <= FOUND
13: 
14: import {IL1ERC20Bridge} from "./interfaces/IL1ERC20Bridge.sol"; // <= FOUND
15: import {IL1SharedBridge} from "./interfaces/IL1SharedBridge.sol"; // <= FOUND
16: import {IL2Bridge} from "./interfaces/IL2Bridge.sol"; // <= FOUND
17: 
18: import {IMailbox} from "../state-transition/chain-interfaces/IMailbox.sol"; // <= FOUND
19: import {L2Message, TxStatus} from "../common/Messaging.sol"; // <= FOUND
20: import {UnsafeBytes} from "../common/libraries/UnsafeBytes.sol"; // <= FOUND
21: import {ReentrancyGuard} from "../common/ReentrancyGuard.sol"; // <= FOUND
22: import {AddressAliasHelper} from "../vendor/AddressAliasHelper.sol"; // <= FOUND
23: import {ERA_CHAIN_ID, ERA_ERC20_BRIDGE_ADDRESS, ETH_TOKEN_ADDRESS, ERA_DIAMOND_PROXY, TWO_BRIDGES_MAGIC_VALUE} from "../common/Config.sol"; // <= FOUND
24: import {IBridgehub, L2TransactionRequestTwoBridgesInner, L2TransactionRequestDirect} from "../bridgehub/IBridgehub.sol"; // <= FOUND
25: import {IGetters} from "../state-transition/chain-interfaces/IGetters.sol"; // <= FOUND
26: import {L2_BASE_TOKEN_SYSTEM_CONTRACT_ADDR} from "../common/L2ContractAddresses.sol"; // <= FOUND
27: 
32: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step {
33:     using SafeERC20 for IERC20;
34: 
36:     address public immutable override l1WethAddress;
37: 
39:     IBridgehub public immutable override bridgehub;
40: 
42:     IL1ERC20Bridge public immutable override legacyBridge;
43: 
47:     uint256 internal eraFirstPostUpgradeBatch;
48: 
50:     mapping(uint256 chainId => address l2Bridge) public override l2BridgeAddress;
51: 
54:     mapping(uint256 chainId => mapping(bytes32 l2DepositTxHash => bytes32 depositDataHash))
55:         public
56:         override depositHappened;
57: 
59:     mapping(uint256 chainId => mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized)))
60:         public isWithdrawalFinalized;
61: 
63:     mapping(uint256 chainId => bool enabled) internal hyperbridgingEnabled;
64: 
67:     mapping(uint256 chainId => mapping(address l1Token => uint256 balance)) internal chainBalance;
68: 
70:     modifier onlyBridgehub() {
71:         require(msg.sender == address(bridgehub), "ShB not BH");
72:         _;
73:     }
74: 
76:     modifier onlyBridgehubOrEra(uint256 _chainId) {
77:         require(
78:             msg.sender == address(bridgehub) || (_chainId == ERA_CHAIN_ID && msg.sender == ERA_DIAMOND_PROXY),
79:             "L1SharedBridge: not bridgehub or era chain"
80:         );
81:         _;
82:     }
83: 
85:     modifier onlyLegacyBridge() {
86:         require(msg.sender == address(legacyBridge), "ShB not legacy bridge");
87:         _;
88:     }
89: 
92:     constructor(
93:         address _l1WethAddress,
94:         IBridgehub _bridgehub,
95:         IL1ERC20Bridge _legacyBridge
96:     ) reentrancyGuardInitializer {
97:         _disableInitializers();
98:         l1WethAddress = _l1WethAddress;

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L7-L14)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {Diamond} from "../libraries/Diamond.sol"; // <= FOUND
8: import {ZkSyncStateTransitionBase} from "./facets/ZkSyncStateTransitionBase.sol"; // <= FOUND
9: import {FeeParams} from "./ZkSyncStateTransitionStorage.sol"; // <= FOUND
10: import {L2_TO_L1_LOG_SERIALIZE_SIZE, MAX_GAS_PER_TRANSACTION} from "../../common/Config.sol"; // <= FOUND
11: import {InitializeData, IDiamondInit} from "../chain-interfaces/IDiamondInit.sol"; // <= FOUND
12: import {VerifierParams} from "../chain-interfaces/IVerifier.sol"; // <= FOUND
13: 
14: import "../l2-deps/ISystemContext.sol"; // <= FOUND
15: 
19: contract DiamondInit is ZkSyncStateTransitionBase, IDiamondInit {
20:     
21:     constructor() reentrancyGuardInitializer {}
22: 
26:     function initialize(InitializeData calldata _initializeData) external reentrancyGuardInitializer returns (bytes32) {
27:         require(address(_initializeData.verifier) != address(0), "vt");
28:         require(_initializeData.admin != address(0), "vy");
29:         require(_initializeData.validatorTimelock != address(0), "hc");
30:         require(_initializeData.priorityTxMaxGasLimit <= MAX_GAS_PER_TRANSACTION, "vu");
31: 
32:         s.chainId = _initializeData.chainId;
33:         s.bridgehub = _initializeData.bridgehub;
34:         s.stateTransitionManager = _initializeData.stateTransitionManager;
35:         s.baseToken = _initializeData.baseToken;
36:         s.baseTokenBridge = _initializeData.baseTokenBridge;
37:         s.protocolVersion = _initializeData.protocolVersion;
38: 
39:         s.verifier = _initializeData.verifier;
40:         s.admin = _initializeData.admin;
41:         s.validators[_initializeData.validatorTimelock] = true;
42: 
43:         s.storedBatchHashes[0] = _initializeData.storedBatchZero;
44:         s.verifierParams = _initializeData.verifierParams;
45:         s.l2BootloaderBytecodeHash = _initializeData.l2BootloaderBytecodeHash;
46:         s.l2DefaultAccountBytecodeHash = _initializeData.l2DefaultAccountBytecodeHash;
47:         s.priorityTxMaxGasLimit = _initializeData.priorityTxMaxGasLimit;
48:         s.feeParams = _initializeData.feeParams;
49:         s.blobVersionedHashRetriever = _initializeData.blobVersionedHashRetriever;
50: 
51:         
52:         
53:         assert(L2_TO_L1_LOG_SERIALIZE_SIZE != 2 * 32);
54: 
55:         return Diamond.DIAMOND_INIT_SUCCESS_RETURN_VALUE;
56:     }
57: }
58: 

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L7-L9)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import "../state-transition/libraries/Diamond.sol"; // <= FOUND
8: import "./BaseZkSyncUpgradeGenesis.sol"; // <= FOUND
9: import "./IDefaultUpgrade.sol"; // <= FOUND
10: 
13: contract GenesisUpgrade is BaseZkSyncUpgradeGenesis {
14:     
16:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) {
17:         super.upgrade(_proposedUpgrade);
18:         return Diamond.DIAMOND_INIT_SUCCESS_RETURN_VALUE;
19:     }
20: }
21: 

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L7-L14)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {ImmutableData} from "./interfaces/IImmutableSimulator.sol"; // <= FOUND
8: import {IContractDeployer} from "./interfaces/IContractDeployer.sol"; // <= FOUND
9: import {CREATE2_PREFIX, CREATE_PREFIX, NONCE_HOLDER_SYSTEM_CONTRACT, ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT, FORCE_DEPLOYER, MAX_SYSTEM_CONTRACT_ADDRESS, KNOWN_CODE_STORAGE_CONTRACT, BASE_TOKEN_SYSTEM_CONTRACT, IMMUTABLE_SIMULATOR_SYSTEM_CONTRACT, COMPLEX_UPGRADER_CONTRACT, KECCAK256_SYSTEM_CONTRACT} from "./Constants.sol"; // <= FOUND
10: 
11: import {Utils} from "./libraries/Utils.sol"; // <= FOUND
12: import {EfficientCall} from "./libraries/EfficientCall.sol"; // <= FOUND
13: import {SystemContractHelper} from "./libraries/SystemContractHelper.sol"; // <= FOUND
14: import {ISystemContract} from "./interfaces/ISystemContract.sol"; // <= FOUND
15: 
25: contract ContractDeployer is IContractDeployer, ISystemContract {
26:     
28:     mapping(address => AccountInfo) internal accountInfo;
29: 
30:     modifier onlySelf() {
31:         require(msg.sender == address(this), "Callable only by self");
32:         _;
33:     }
34: 
36:     function getAccountInfo(address _address) external view returns (AccountInfo memory info) {
37:         return accountInfo[_address];
38:     }
39: 
42:     function extendedAccountVersion(address _address) public view returns (AccountAbstractionVersion) {
43:         AccountInfo memory info = accountInfo[_address];
44:         if (info.supportedAAVersion != AccountAbstractionVersion.None) {
45:             return info.supportedAAVersion;
46:         }
47: 
48:         
49:         if (
50:             _address > address(MAX_SYSTEM_CONTRACT_ADDRESS) &&
51:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.getRawCodeHash(_address) == 0
52:         ) {
53:             return AccountAbstractionVersion.Version1;
54:         }
55: 
56:         return AccountAbstractionVersion.None;
57:     }
58: 
60:     function _storeAccountInfo(address _address, AccountInfo memory _newInfo) internal {
61:         accountInfo[_address] = _newInfo;
62:     }
63: 
67:     function updateAccountVersion(AccountAbstractionVersion _version) external onlySystemCall {
68:         accountInfo[msg.sender].supportedAAVersion = _version;
69: 
70:         emit AccountVersionUpdated(msg.sender, _version);
71:     }
72: 
76:     function updateNonceOrdering(AccountNonceOrdering _nonceOrdering) external onlySystemCall {
77:         AccountInfo memory currentInfo = accountInfo[msg.sender];
78: 
79:         require(
80:             _nonceOrdering == AccountNonceOrdering.Arbitrary &&
81:                 currentInfo.nonceOrdering == AccountNonceOrdering.Sequential,
82:             "It is only possible to change from sequential to arbitrary ordering"
83:         );
84: 

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L7-L14)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import "../state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol"; // <= FOUND
8: import "../state-transition/chain-interfaces/IMailbox.sol"; // <= FOUND
9: import "../state-transition/chain-interfaces/IVerifier.sol"; // <= FOUND
10: import "../common/libraries/L2ContractHelper.sol"; // <= FOUND
11: import "../common/Messaging.sol"; // <= FOUND
12: import "../state-transition/libraries/TransactionValidator.sol"; // <= FOUND
13: import {MAX_NEW_FACTORY_DEPS, SYSTEM_UPGRADE_L2_TX_TYPE, MAX_ALLOWED_PROTOCOL_VERSION_DELTA} from "../common/Config.sol"; // <= FOUND
14: import {ProposedUpgrade, BaseZkSyncUpgrade} from "./BaseZkSyncUpgrade.sol"; // <= FOUND
15: 
19: abstract contract BaseZkSyncUpgradeGenesis is BaseZkSyncUpgrade {
20:     
22:     function _setNewProtocolVersion(uint256 _newProtocolVersion) internal override {
23:         uint256 previousProtocolVersion = s.protocolVersion;
24:         require(
25:             
26:             _newProtocolVersion >= previousProtocolVersion,
27:             "New protocol version is not greater than the current one"
28:         );
29:         require(
30:             _newProtocolVersion - previousProtocolVersion <= MAX_ALLOWED_PROTOCOL_VERSION_DELTA,
31:             "Too big protocol version difference"
32:         );
33: 
34:         
35:         require(s.l2SystemContractsUpgradeTxHash == bytes32(0), "Previous upgrade has not been finalized");
36:         require(
37:             s.l2SystemContractsUpgradeBatchNumber == 0,
38:             "The batch number of the previous upgrade has not been cleaned"
39:         );
40: 
41:         s.protocolVersion = _newProtocolVersion;
42:         emit NewProtocolVersion(previousProtocolVersion, _newProtocolVersion);
43:     }
44: 
49:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual override returns (bytes32) {
50:         
51:         
52:         
53:         
54:         require(block.timestamp >= _proposedUpgrade.upgradeTimestamp, "Upgrade is not ready yet");
55: 
56:         _setNewProtocolVersion(_proposedUpgrade.newProtocolVersion);
57:         _upgradeL1Contract(_proposedUpgrade.l1ContractsUpgradeCalldata);
58:         _upgradeVerifier(_proposedUpgrade.verifier, _proposedUpgrade.verifierParams);
59:         _setBaseSystemContracts(_proposedUpgrade.bootloaderHash, _proposedUpgrade.defaultAccountHash);
60: 
61:         bytes32 txHash = _setL2SystemContractUpgrade(
62:             _proposedUpgrade.l2ProtocolUpgradeTx,
63:             _proposedUpgrade.factoryDeps,
64:             _proposedUpgrade.newProtocolVersion
65:         );
66: 
67:         _postUpgrade(_proposedUpgrade.postUpgradeCalldata);
68: 
69:         emit UpgradeComplete(_proposedUpgrade.newProtocolVersion, txHash, _proposedUpgrade);
70:     }
71: }
72: 

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L7-L14)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {ZkSyncStateTransitionBase} from "../state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol"; // <= FOUND
8: import {IMailbox} from "../state-transition/chain-interfaces/IMailbox.sol"; // <= FOUND
9: import {VerifierParams} from "../state-transition/chain-interfaces/IVerifier.sol"; // <= FOUND
10: import {IVerifier} from "../state-transition/chain-interfaces/IVerifier.sol"; // <= FOUND
11: import {L2ContractHelper} from "../common/libraries/L2ContractHelper.sol"; // <= FOUND
12: import {TransactionValidator} from "../state-transition/libraries/TransactionValidator.sol"; // <= FOUND
13: import {MAX_NEW_FACTORY_DEPS, SYSTEM_UPGRADE_L2_TX_TYPE, MAX_ALLOWED_PROTOCOL_VERSION_DELTA} from "../common/Config.sol"; // <= FOUND
14: import {L2CanonicalTransaction} from "../common/Messaging.sol"; // <= FOUND
15: 
30: struct ProposedUpgrade {
31:     L2CanonicalTransaction l2ProtocolUpgradeTx;
32:     bytes[] factoryDeps;
33:     bytes32 bootloaderHash;
34:     bytes32 defaultAccountHash;
35:     address verifier;
36:     VerifierParams verifierParams;
37:     bytes l1ContractsUpgradeCalldata;
38:     bytes postUpgradeCalldata;
39:     uint256 upgradeTimestamp;
40:     uint256 newProtocolVersion;
41: }
42: 
46: abstract contract BaseZkSyncUpgrade is ZkSyncStateTransitionBase {
47:     
48:     event NewProtocolVersion(uint256 indexed previousProtocolVersion, uint256 indexed newProtocolVersion);
49: 
51:     event NewL2BootloaderBytecodeHash(bytes32 indexed previousBytecodeHash, bytes32 indexed newBytecodeHash);
52: 
54:     event NewL2DefaultAccountBytecodeHash(bytes32 indexed previousBytecodeHash, bytes32 indexed newBytecodeHash);
55: 
57:     event NewVerifier(address indexed oldVerifier, address indexed newVerifier);
58: 
60:     event NewVerifierParams(VerifierParams oldVerifierParams, VerifierParams newVerifierParams);
61: 
63:     event UpgradeComplete(uint256 indexed newProtocolVersion, bytes32 indexed l2UpgradeTxHash, ProposedUpgrade upgrade);
64: 
69:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual returns (bytes32 txHash) {
70:         
71:         
72:         
73:         
74:         require(block.timestamp >= _proposedUpgrade.upgradeTimestamp, "Upgrade is not ready yet");
75: 
76:         _setNewProtocolVersion(_proposedUpgrade.newProtocolVersion);
77:         _upgradeL1Contract(_proposedUpgrade.l1ContractsUpgradeCalldata);
78:         _upgradeVerifier(_proposedUpgrade.verifier, _proposedUpgrade.verifierParams);
79:         _setBaseSystemContracts(_proposedUpgrade.bootloaderHash, _proposedUpgrade.defaultAccountHash);
80: 
81:         txHash = _setL2SystemContractUpgrade(
82:             _proposedUpgrade.l2ProtocolUpgradeTx,
83:             _proposedUpgrade.factoryDeps,
84:             _proposedUpgrade.newProtocolVersion
85:         );
86: 
87:         _postUpgrade(_proposedUpgrade.postUpgradeCalldata);
88: 
89:         emit UpgradeComplete(_proposedUpgrade.newProtocolVersion, txHash, _proposedUpgrade);
90:     }

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L7-L14)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol"; // <= FOUND
8: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol"; // <= FOUND
9: 
10: import {IL1ERC20Bridge} from "./interfaces/IL1ERC20Bridge.sol"; // <= FOUND
11: import {IL1SharedBridge} from "./interfaces/IL1SharedBridge.sol"; // <= FOUND
12: 
13: import {L2ContractHelper} from "../common/libraries/L2ContractHelper.sol"; // <= FOUND
14: import {ReentrancyGuard} from "../common/ReentrancyGuard.sol"; // <= FOUND
15: 
21: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard {
22:     using SafeERC20 for IERC20;
23: 
25:     IL1SharedBridge public immutable override sharedBridge;
26: 
29:     mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized))
30:         public isWithdrawalFinalized;
31: 
34:     mapping(address account => mapping(address l1Token => mapping(bytes32 depositL2TxHash => uint256 amount)))
35:         public depositAmount;
36: 
38:     address public l2Bridge;
39: 
41:     address public l2TokenBeacon;
42: 
44:     bytes32 public l2TokenProxyBytecodeHash;
45: 
47:     mapping(address => uint256) private __DEPRECATED_lastWithdrawalLimitReset;
48: 
50:     mapping(address => uint256) private __DEPRECATED_withdrawnAmountInWindow;
51: 
53:     mapping(address => mapping(address => uint256)) private __DEPRECATED_totalDepositedAmountPerUser;
54: 
57:     constructor(IL1SharedBridge _sharedBridge) reentrancyGuardInitializer {
58:         sharedBridge = _sharedBridge;
59:     }
60: 
62:     function initialize() external reentrancyGuardInitializer {}
63: 
65:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external {
66:         require(msg.sender == address(sharedBridge), "Not shared bridge");
67:         uint256 amount = IERC20(_token).balanceOf(address(this));
68:         require(amount == _amount, "Incorrect amount");
69:         IERC20(_token).safeTransfer(address(sharedBridge), amount);
70:     }
71: 
77:     function l2TokenAddress(address _l1Token) external view returns (address) {
78:         bytes32 constructorInputHash = keccak256(abi.encode(l2TokenBeacon, ""));
79:         bytes32 salt = bytes32(uint256(uint160(_l1Token)));
80: 
81:         return L2ContractHelper.computeCreate2Address(l2Bridge, salt, l2TokenProxyBytecodeHash, constructorInputHash);
82:     }
83: 
100:     function deposit(
101:         address _l2Receiver,
102:         address _l1Token,
103:         uint256 _amount,
104:         uint256 _l2TxGasLimit,
105:         uint256 _l2TxGasPerPubdataByte

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L7-L17)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {ZkSyncStateTransitionBase} from "./ZkSyncStateTransitionBase.sol"; // <= FOUND
8: import {PubdataPricingMode} from "../ZkSyncStateTransitionStorage.sol"; // <= FOUND
9: import {VerifierParams} from "../../../state-transition/chain-interfaces/IVerifier.sol"; // <= FOUND
10: import {Diamond} from "../../libraries/Diamond.sol"; // <= FOUND
11: import {PriorityQueue, PriorityOperation} from "../../../state-transition/libraries/PriorityQueue.sol"; // <= FOUND
12: import {UncheckedMath} from "../../../common/libraries/UncheckedMath.sol"; // <= FOUND
13: import {IGetters} from "../../chain-interfaces/IGetters.sol"; // <= FOUND
14: import {ILegacyGetters} from "../../chain-interfaces/ILegacyGetters.sol"; // <= FOUND
15: 
17: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol"; // <= FOUND
18: 
22: contract GettersFacet is ZkSyncStateTransitionBase, IGetters, ILegacyGetters {
23:     using UncheckedMath for uint256;
24:     using PriorityQueue for PriorityQueue.Queue;
25: 
27:     string public constant override getName = "GettersFacet";
28: 
34:     function getVerifier() external view returns (address) {
35:         return address(s.verifier);
36:     }
37: 
39:     function getAdmin() external view returns (address) {
40:         return s.admin;
41:     }
42: 
44:     function getPendingAdmin() external view returns (address) {
45:         return s.pendingAdmin;
46:     }
47: 
49:     function getBridgehub() external view returns (address) {
50:         return address(s.bridgehub);
51:     }
52: 
54:     function getStateTransitionManager() external view returns (address) {
55:         return address(s.stateTransitionManager);
56:     }
57: 
59:     function getBaseToken() external view returns (address) {
60:         return address(s.baseToken);
61:     }
62: 
64:     function getBaseTokenBridge() external view returns (address) {
65:         return address(s.baseTokenBridge);
66:     }
67: 
69:     function baseTokenGasPriceMultiplierNominator() external view returns (uint128) {
70:         return s.baseTokenGasPriceMultiplierNominator;
71:     }
72: 
74:     function baseTokenGasPriceMultiplierDenominator() external view returns (uint128) {
75:         return s.baseTokenGasPriceMultiplierDenominator;
76:     }
77: 
79:     function getTotalBatchesCommitted() external view returns (uint256) {
80:         return s.totalBatchesCommitted;
81:     }
82: 
84:     function getTotalBatchesVerified() external view returns (uint256) {
85:         return s.totalBatchesVerified;
86:     }
87: 

```


</details>

## [NonCritical-35] Upgradable contract constructor should have the initialize modifier

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30-L107)']
```solidity
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step {
31:     using SafeERC20 for IERC20;
32: 
90:     constructor( // <= FOUND

107:     ) external reentrancyGuardInitializer initializer { // <= FOUND


```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L23-L153)']
```solidity
23: contract L2SharedBridge is IL2SharedBridge, Initializable {
24:     
25:     address public override l1Bridge;
41:     constructor() { // <= FOUND

54:     ) external reinitializer(2) { // <= FOUND

150:         bytes32 constructorInputHash = keccak256(abi.encode(address(l2TokenBeacon), "")); // <= FOUND

153:             L2ContractHelper.computeCreate2Address(address(this), salt, l2TokenProxyBytecodeHash, constructorInputHash); // <= FOUND


```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L15-L116)']
```solidity
15: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade {
16:     
20:     struct ERC20Getters {
40:     constructor() { // <= FOUND

50:     function bridgeInitialize(address _l1Address, bytes memory _data) external initializer { // <= FOUND

116:     ) external onlyNextVersion(_version) reinitializer(_version) { // <= FOUND


```


</details>

## [NonCritical-36] All interfaces used within a project should be imported

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/interfaces/IPaymaster.sol#L14-L14)']
```solidity
14: interface IPaymaster  // <= FOUND

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/interfaces/IPaymasterFlow.sol#L13-L13)']
```solidity
13: interface IPaymasterFlow  // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/interfaces/IL2ContractDeployer.sol#L9-L9)']
```solidity
9: interface IL2ContractDeployer  // <= FOUND

```
['[4](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/interfaces/IWETH9.sol#L4-L4)']
```solidity
4: interface IWETH9  // <= FOUND

```


</details>

## [NonCritical-37] A function which defines named returns in it's declaration doesn't need to use return

### Resolution 
Remove the return statement once ensuring it is safe to do so

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[146](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L146-L146)']
```solidity
114:     function createNewChain(
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, 
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {
122:         require(_chainId != 0, "Bridgehub: chainId cannot be 0");
123:         require(_chainId <= type(uint48).max, "Bridgehub: chainId too large");
124: 
125:         require(
126:             stateTransitionManagerIsRegistered[_stateTransitionManager],
127:             "Bridgehub: state transition not registered"
128:         );
129:         require(tokenIsRegistered[_baseToken], "Bridgehub: token not registered");
130:         require(address(sharedBridge) != address(0), "Bridgehub: weth bridge not set");
131: 
132:         require(stateTransitionManager[_chainId] == address(0), "Bridgehub: chainId already registered");
133: 
134:         stateTransitionManager[_chainId] = _stateTransitionManager;
135:         baseToken[_chainId] = _baseToken;
136: 
137:         IStateTransitionManager(_stateTransitionManager).createNewChain(
138:             _chainId,
139:             _baseToken,
140:             address(sharedBridge),
141:             _admin,
142:             _initData
143:         );
144: 
145:         emit NewChain(_chainId, _stateTransitionManager, _admin);
146:         return _chainId; // <= FOUND
147:     }

```
['[129](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L129-L129)']
```solidity
125:     function getDeploymentNonce(address _address) external view returns (uint256 deploymentNonce) {
126:         uint256 addressAsKey = uint256(uint160(_address));
127:         (deploymentNonce, ) = _splitRawNonce(rawNonces[addressAsKey]);
128: 
129:         return deploymentNonce; // <= FOUND
130:     }

```


</details>

## [NonCritical-38] Multiple mappings can be replaced with a single struct mapping

### Resolution 
Using a single struct mapping in place of multiple defined mappings in a Solidity contract can lead to improved code organization, better readability, and easier maintainability. By consolidating related data into a single struct, developers can create a more cohesive data structure that logically groups together relevant pieces of information, thus reducing redundancy and clutter. This approach simplifies the codebase, making it easier to understand, navigate, and modify. Additionally, it can result in more efficient gas usage when accessing or updating multiple related data points simultaneously. 

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L27-L51)']
```solidity
19: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard {
20:     using SafeERC20 for IERC20;
21: 
23:     IL1SharedBridge public immutable override sharedBridge;
24: 
27:     mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized)) // <= FOUND
28:         public isWithdrawalFinalized;
29: 
32:     mapping(address account => mapping(address l1Token => mapping(bytes32 depositL2TxHash => uint256 amount))) // <= FOUND
33:         public depositAmount;
34: 
36:     address public l2Bridge;
37: 
39:     address public l2TokenBeacon;
40: 
42:     bytes32 public l2TokenProxyBytecodeHash;
43: 
45:     mapping(address => uint256) private __DEPRECATED_lastWithdrawalLimitReset; // <= FOUND
46: 
48:     mapping(address => uint256) private __DEPRECATED_withdrawnAmountInWindow; // <= FOUND
49: 
51:     mapping(address => mapping(address => uint256)) private __DEPRECATED_totalDepositedAmountPerUser; // <= FOUND
52: 
136: }

```
['[48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L48-L65)']
```solidity
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step {
31:     using SafeERC20 for IERC20;
32: 
34:     address public immutable override l1WethAddress;
35: 
37:     IBridgehub public immutable override bridgehub;
38: 
40:     IL1ERC20Bridge public immutable override legacyBridge;
41: 
45:     uint256 internal eraFirstPostUpgradeBatch;
46: 
48:     mapping(uint256 chainId => address l2Bridge) public override l2BridgeAddress; // <= FOUND
49: 
52:     mapping(uint256 chainId => mapping(bytes32 l2DepositTxHash => bytes32 depositDataHash)) // <= FOUND
53:         public
54:         override depositHappened;
55: 
57:     mapping(uint256 chainId => mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized))) // <= FOUND
58:         public isWithdrawalFinalized;
59: 
61:     mapping(uint256 chainId => bool enabled) internal hyperbridgingEnabled; // <= FOUND
62: 
65:     mapping(uint256 chainId => mapping(address l1Token => uint256 balance)) internal chainBalance; // <= FOUND
66: 
209: }

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L21-L29)']
```solidity
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step {
17:     
18:     IL1SharedBridge public sharedBridge;
19: 
21:     mapping(address _stateTransitionManager => bool) public stateTransitionManagerIsRegistered; // <= FOUND
22:     
23:     mapping(address _token => bool) public tokenIsRegistered; // <= FOUND
24: 
26:     mapping(uint256 _chainId => address) public stateTransitionManager; // <= FOUND
27: 
29:     mapping(uint256 _chainId => address) public baseToken; // <= FOUND
30: 
32:     address public admin;
33: 
35:     address private pendingAdmin;
36: 
108: }

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L30-L48)']
```solidity
25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step {
26:     
27:     address public immutable bridgehub;
28: 
30:     mapping(uint256 => address) public stateTransition; // <= FOUND
31: 
33:     bytes32 public storedBatchZero;
34: 
36:     bytes32 public initialCutHash;
37: 
39:     address public genesisUpgrade;
40: 
42:     uint256 public protocolVersion;
43: 
45:     address public validatorTimelock;
46: 
48:     mapping(uint256 => bytes32) public upgradeCutHash; // <= FOUND
49: 
51:     address public admin;
52: 
54:     address private pendingAdmin;
55: 
107: }

```
['[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L47-L50)']
```solidity
22: contract ValidatorTimelock is IExecutor, Ownable2Step {
23:     using LibMap for LibMap.Uint32Map;
24: 
26:     string public constant override getName = "ValidatorTimelock";
27: 
44:     IStateTransitionManager public stateTransitionManager;
45: 
47:     mapping(uint256 => LibMap.Uint32Map) internal committedBatchTimestamp; // <= FOUND
48: 
50:     mapping(uint256 _chainId => mapping(address _validator => bool)) public validators; // <= FOUND
51: 
53:     uint32 public executionDelay;
54: 
117: }

```
['[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L36-L41)']
```solidity
27: contract NonceHolder is INonceHolder, ISystemContract {
28:     uint256 private constant DEPLOY_NONCE_MULTIPLIER = 2 ** 128;
29:     
31:     uint256 private constant MAXIMAL_MIN_NONCE_INCREMENT = 2 ** 32;
32: 
36:     mapping(uint256 account => uint256 packedMinAndDeploymentNonce) internal rawNonces; // <= FOUND
37: 
41:     mapping(uint256 account => mapping(uint256 nonceKey => uint256 value)) internal nonceValues; // <= FOUND
42: 
104: }

```


</details>

## [NonCritical-39] Unused state variables present

### Resolution 
If these serve no purpose, they should be safely removed

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L36-L36)']
```solidity
36: uint256 constant GAS_TO_PASS = 2300; // <= FOUND

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L41-L41)']
```solidity
41: uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000; // <= FOUND

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L37-L37)']
```solidity
37: uint256 public blockGasLimit = type(uint32).max; // <= FOUND

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L41-L41)']
```solidity
41: address public coinbase = BOOTLOADER_FORMAL_ADDRESS; // <= FOUND

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L44-L44)']
```solidity
44: uint256 public difficulty = 2.5e15; // <= FOUND

```


</details>

## [NonCritical-40] Unused mappings present

### Resolution 
If these serve no purpose, they should be safely removed

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L45-L45)']
```solidity
45:     mapping(address => uint256) private __DEPRECATED_lastWithdrawalLimitReset; // <= FOUND

```
['[48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L48-L48)']
```solidity
48:     mapping(address => uint256) private __DEPRECATED_withdrawnAmountInWindow; // <= FOUND

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L51-L51)']
```solidity
51:     mapping(address => mapping(address => uint256)) private __DEPRECATED_totalDepositedAmountPerUser; // <= FOUND

```


</details>

## [NonCritical-41] Constants should be on the left side of the comparison

### Resolution 
Putting constants on the left side of a comparison operator like `==` or `<` is a best practice known as "Yoda conditions", which can help prevent accidental assignment instead of comparison. In some programming languages, if a variable is mistakenly put on the left with a single `=` instead of `==`, it assigns the constant's value to the variable without any compiler error. However, doing this with the constant on the left would generate an error, as constants cannot be assigned values. Although Solidity's static typing system prevents accidental assignments within conditionals, adopting this practice enhances code readability and consistency, especially when developers are working across multiple languages that support this convention.

Num of instances: 33

### Findings 


<details><summary>Click to show findings</summary>

['[107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L107-L107)']
```solidity
107:         if (timestamp == 0)  // <= FOUND

```
['[237](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L237-L237)']
```solidity
237:         if (systemContractsUpgradeTxHash == bytes32(0) || s.l2SystemContractsUpgradeBatchNumber != 0)  // <= FOUND

```
['[361](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L361-L361)']
```solidity
361:         if (batchWhenUpgradeHappened != 0 && batchWhenUpgradeHappened <= newTotalBatchesExecuted)  // <= FOUND

```
['[169](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L169-L169)']
```solidity
169:         if (selectorsArrayLen != 0)  // <= FOUND

```
['[186](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L186-L186)']
```solidity
186:         if (_l2ProtocolUpgradeTx.txType == 0)  // <= FOUND

```
['[194](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L194-L194)']
```solidity
194:         if (selectorsLength == 0)  // <= FOUND

```
['[213](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L213-L213)']
```solidity
213:         if (selectorPosition != 0)  // <= FOUND

```
['[250](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L250-L250)']
```solidity
250:         if (lastSelectorPosition == 0)  // <= FOUND

```
['[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L102-L102)']
```solidity
102:         if (codeHash == 0x00 && NONCE_HOLDER_SYSTEM_CONTRACT.getRawNonce(account) > 0)  // <= FOUND

```
['[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L133-L133)']
```solidity
131:         if (
132:             uint160(account) > CURRENT_MAX_PRECOMPILE_ADDRESS &&
133:             codeHash != 0x00 && // <= FOUND
134:             !Utils.isContractConstructing(codeHash)
135:         ) 

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L96-L96)']
```solidity
96:             if (_transaction.reserved[0] != 0)  // <= FOUND

```
['[49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L49-L49)']
```solidity
47:         if (
48:             _address > address(MAX_SYSTEM_CONTRACT_ADDRESS) &&
49:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.getRawCodeHash(_address) == 0 // <= FOUND
50:         ) 

```
['[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L47-L47)']
```solidity
47:        if (getMarker(_bytecodeHash) == 0)  // <= FOUND

```
['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L62-L62)']
```solidity
62:         if (value != 0)  // <= FOUND

```
['[88](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L88-L88)']
```solidity
88:         if (accountInfo.nonceOrdering == IContractDeployer.AccountNonceOrdering.Sequential && _key != 0)  // <= FOUND

```
['[268](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L268-L268)']
```solidity
268:        if (virtualBlockUpgradeInfo.virtualBlockFinishL2Block != 0)  // <= FOUND

```
['[277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L277-L277)']
```solidity
277:         if (currentVirtualL2BlockInfo.number == 0 && virtualBlockInfo.timestamp == 0)  // <= FOUND

```
['[360](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L360-L360)']
```solidity
360:         if (currentL2BlockNumber == 0 && currentL2BlockTimestamp == 0)  // <= FOUND

```
['[73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L73-L73)']
```solidity
73:         if (pubdataCost != 0)  // <= FOUND

```
['[131](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L131-L131)']
```solidity
131:        if (_value == 0)  // <= FOUND

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L96-L96)']
```solidity
96:         if (_transaction.reserved[0] != 0)  // <= FOUND

```
['[229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L229-L229)']
```solidity
229:           if (_operation == 0 || _operation == 3)  // <= FOUND

```
['[59](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L59-L59)']
```solidity
59:         if (value == 0)  // <= FOUND

```
['[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L69-L69)']
```solidity
69:             if (txDataLen != 1)  // <= FOUND

```
['[139](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L139-L139)']
```solidity
139:         if (to == address(DEPLOYER_SYSTEM_CONTRACT) && data.length >= 4)  // <= FOUND

```
['[286](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L286-L286)']
```solidity
286:                 if (data.length <= 4)  // <= FOUND

```
['[429](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L429-L429)']
```solidity
429:         if (_proof.serializedProof.length > 0)  // <= FOUND

```
['[277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L277-L277)']
```solidity
277:         if (refundRecipient.code.length > 0)  // <= FOUND

```
['[332](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L332-L332)']
```solidity
332:             if (value > 0)  // <= FOUND

```
['[332](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L332-L332)']
```solidity
332:             if (value > 0)  // <= FOUND

```
['[144](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L144-L144)']
```solidity
144:         if (blockNumber <= _block || blockNumber - _block > 256)  // <= FOUND

```
['[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L26-L26)']
```solidity
26:           if (_val < 128)  // <= FOUND

```
['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L62-L62)']
```solidity
62:           if (_len < 56)  // <= FOUND

```


</details>

## [NonCritical-42] Defined named returns not used within function 

### Resolution 
Such instances can be replaced with unnamed returns

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L44-L44)']
```solidity
44:     function encodeLegacyTransactionHash(Transaction calldata _transaction) internal view returns (bytes32 txHash) { // <= FOUND
45:         
46:         
47:         
48:         
49:         
50:         
51: 
52:         bytes memory encodedNonce = RLPEncoder.encodeUint256(_transaction.nonce);
53:         
54:         bytes memory encodedGasParam;
55:         {
56:             bytes memory encodedGasPrice = RLPEncoder.encodeUint256(_transaction.maxFeePerGas);
57:             bytes memory encodedGasLimit = RLPEncoder.encodeUint256(_transaction.gasLimit);
58:             encodedGasParam = bytes.concat(encodedGasPrice, encodedGasLimit);
59:         }
60: 
61:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));
62:         bytes memory encodedValue = RLPEncoder.encodeUint256(_transaction.value);
63:         
64:         
65:         bytes memory encodedDataLength;
66:         {
67:             
68:             uint64 txDataLen = uint64(_transaction.data.length);
69:             if (txDataLen != 1) {
70:                 
71:                 encodedDataLength = RLPEncoder.encodeNonSingleBytesLen(txDataLen);
72:             } else if (_transaction.data[0] >= 0x80) {
73:                 
74:                 encodedDataLength = hex"81";
75:             }
76:             
77:         }
78: 
79:         bytes memory rEncoded;
80:         {
81:             uint256 rInt = uint256(bytes32(_transaction.signature[0:32]));
82:             rEncoded = RLPEncoder.encodeUint256(rInt);
83:         }
84:         bytes memory sEncoded;
85:         {
86:             uint256 sInt = uint256(bytes32(_transaction.signature[32:64]));
87:             sEncoded = RLPEncoder.encodeUint256(sInt);
88:         }
89:         bytes memory vEncoded;
90:         {
91:             uint256 vInt = uint256(uint8(_transaction.signature[64]));
92:             require(vInt == 27 || vInt == 28, "Invalid v value");
93: 

```


</details>

## [NonCritical-43] Initialize functions do not emit an event

### Resolution 
Emitting an event within initializer functions in Solidity is a best practice for providing transparency and traceability. Initializer functions set the initial state and values of an upgradeable contract. Emitting an event during initialization allows anyone to verify and audit the initial state of the contract via the transaction logs. This can be particularly useful for verifying the parameters set during initialization, tracking the contract's deployment, and troubleshooting or debugging. Therefore, developers should include an event emission in their initializer functions, providing a clear record of the contract's initialization and enhancing the contract's transparency and security.

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L60-L60)']
```solidity
60:     function initialize() external reentrancyGuardInitializer {} // <= FOUND

```
['[104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L104-L104)']
```solidity
104:     function initialize( // <= FOUND
105:         address _owner,
106:         uint256 _eraFirstPostUpgradeBatch
107:     ) external reentrancyGuardInitializer initializer {
108:         require(_owner != address(0), "ShB owner 0");
109:         _transferOwnership(_owner);
110: 
111:         eraFirstPostUpgradeBatch = _eraFirstPostUpgradeBatch;
112:         l2BridgeAddress[ERA_CHAIN_ID] = ERA_ERC20_BRIDGE_ADDRESS;
113:     }

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L41-L41)']
```solidity
41:     function initialize(address _owner) external reentrancyGuardInitializer { // <= FOUND
42:         _transferOwnership(_owner);
43:     }

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L79-L79)']
```solidity
79:     function initialize( // <= FOUND
80:         StateTransitionManagerInitializeData calldata _initializeData
81:     ) external reentrancyGuardInitializer {
82:         require(_initializeData.governor != address(0), "StateTransition: governor zero");
83:         _transferOwnership(_initializeData.governor);
84: 
85:         genesisUpgrade = _initializeData.genesisUpgrade;
86:         protocolVersion = _initializeData.protocolVersion;
87:         validatorTimelock = _initializeData.validatorTimelock;
88: 
89:         
90:         IExecutor.StoredBatchInfo memory batchZero = IExecutor.StoredBatchInfo(
91:             0,
92:             _initializeData.genesisBatchHash,
93:             _initializeData.genesisIndexRepeatedStorageChanges,
94:             0,
95:             EMPTY_STRING_KECCAK,
96:             DEFAULT_L2_LOGS_TREE_ROOT_HASH,
97:             0,
98:             _initializeData.genesisBatchCommitment
99:         );
100:         storedBatchZero = keccak256(abi.encode(batchZero));
101: 
102:         initialCutHash = keccak256(abi.encode(_initializeData.diamondCut));
103: 
104:         
105:         
106:         assert(L2_TO_L1_LOG_SERIALIZE_SIZE != 2 * 32);
107:     }

```
['[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L24-L24)']
```solidity
24:     function initialize(InitializeData calldata _initializeData) external reentrancyGuardInitializer returns (bytes32) { // <= FOUND
25:         require(address(_initializeData.verifier) != address(0), "vt");
26:         require(_initializeData.admin != address(0), "vy");
27:         require(_initializeData.validatorTimelock != address(0), "hc");
28:         require(_initializeData.priorityTxMaxGasLimit <= MAX_GAS_PER_TRANSACTION, "vu");
29: 
30:         s.chainId = _initializeData.chainId;
31:         s.bridgehub = _initializeData.bridgehub;
32:         s.stateTransitionManager = _initializeData.stateTransitionManager;
33:         s.baseToken = _initializeData.baseToken;
34:         s.baseTokenBridge = _initializeData.baseTokenBridge;
35:         s.protocolVersion = _initializeData.protocolVersion;
36: 
37:         s.verifier = _initializeData.verifier;
38:         s.admin = _initializeData.admin;
39:         s.validators[_initializeData.validatorTimelock] = true;
40: 
41:         s.storedBatchHashes[0] = _initializeData.storedBatchZero;
42:         s.verifierParams = _initializeData.verifierParams;
43:         s.l2BootloaderBytecodeHash = _initializeData.l2BootloaderBytecodeHash;
44:         s.l2DefaultAccountBytecodeHash = _initializeData.l2DefaultAccountBytecodeHash;
45:         s.priorityTxMaxGasLimit = _initializeData.priorityTxMaxGasLimit;
46:         s.feeParams = _initializeData.feeParams;
47:         s.blobVersionedHashRetriever = _initializeData.blobVersionedHashRetriever;
48: 
49:         
50:         
51:         assert(L2_TO_L1_LOG_SERIALIZE_SIZE != 2 * 32);
52: 
53:         return Diamond.DIAMOND_INIT_SUCCESS_RETURN_VALUE;
54:     }

```
['[49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L49-L49)']
```solidity
49:     function initialize( // <= FOUND
50:         address _l1Bridge,
51:         address _l1LegecyBridge,
52:         bytes32 _l2TokenProxyBytecodeHash,
53:         address _aliasedOwner
54:     ) external reinitializer(2) {
55:         require(_l1Bridge != address(0), "bf");
56:         require(_l2TokenProxyBytecodeHash != bytes32(0), "df");
57:         require(_aliasedOwner != address(0), "sf");
58:         require(_l2TokenProxyBytecodeHash != bytes32(0), "df");
59: 
60:         l1Bridge = _l1Bridge;
61:         l2TokenProxyBytecodeHash = _l2TokenProxyBytecodeHash;
62: 
63:         if (block.chainid != ERA_CHAIN_ID) {
64:             address l2StandardToken = address(new L2StandardERC20{salt: bytes32(0)}());
65:             l2TokenBeacon = new UpgradeableBeacon{salt: bytes32(0)}(l2StandardToken);
66:             l2TokenBeacon.transferOwnership(_aliasedOwner);
67:         } else {
68:             require(_l1LegecyBridge != address(0), "bf2");
69:             
70:         }
71:     }

```


</details>

## [NonCritical-44] Both immutable and constant state variables should be CONSTANT_CASE

### Resolution 
Make found instants CAPITAL_CASE

Num of instances: 10

### Findings 


<details><summary>Click to show findings</summary>

['[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L26-L26)']
```solidity
26: string public constant override getName = "ValidatorTimelock"; // <= FOUND

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L20-L20)']
```solidity
20: string public constant override getName = "AdminFacet"; // <= FOUND

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L27-L27)']
```solidity
27: string public constant override getName = "ExecutorFacet"; // <= FOUND

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L25-L25)']
```solidity
25: string public constant override getName = "GettersFacet"; // <= FOUND

```
['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L35-L35)']
```solidity
35: string public constant override getName = "MailboxFacet"; // <= FOUND

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L23-L23)']
```solidity
23: IL1SharedBridge public immutable override sharedBridge; // <= FOUND

```
['[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L40-L40)']
```solidity
40: IL1ERC20Bridge public immutable override legacyBridge; // <= FOUND

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L37-L37)']
```solidity
37: IBridgehub public immutable override bridgehub; // <= FOUND

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L27-L27)']
```solidity
27: address public immutable bridgehub; // <= FOUND

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L34-L34)']
```solidity
34: address public immutable override l1WethAddress; // <= FOUND

```


</details>

## [NonCritical-45] Use type(uint<n>).max in place of 2 ** n - 1

### Resolution 
There is an inbuilt functionality to get the max value of a uint, it makes more sense to use this to improve readability

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[94](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L94-L94)']
```solidity
94: uint256 constant MAX_MSG_VALUE = 2 ** 128 - 1; // <= FOUND

```


</details>

## [NonCritical-46] Uses of EIP712 does not include a salt

### Resolution 
It is standard for uses of EIP712 to include a salt, not doing so can cause future incompatibilities and in this instance cause hash collisions do to no salting

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L82-L83)']
```solidity
82:     
83:     bytes32 constant EIP712_DOMAIN_TYPEHASH = keccak256("EIP712Domain(string name,string version,uint256 chainId)"); // <= FOUND

```


</details>

## [NonCritical-47] Overly complicated arithmetic

### Resolution 
To maintain readability in code, particularly in Solidity which can involve complex mathematical operations, it is often recommended to limit the number of arithmetic operations to a maximum of 2-3 per line. Too many operations in a single line can make the code difficult to read and understand, increase the likelihood of mistakes, and complicate the process of debugging and reviewing the code. Consider splitting such operations over more than one line, take special care when dealing with division however. Try to limit the number of arithmetic operations to a maximum of 3 per line.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L62-L62)']
```solidity
62:         return SHA256_ROUND_GAS_COST * ((_length + 8) / SHA256_ROUND_NUMBER_OF_BYTES + 1); // <= FOUND

```


</details>

## [NonCritical-48] Use a single file for system wide constants

Num of instances: 12

### Findings 


<details><summary>Click to show findings</summary>

['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L22-L22)']
```solidity
20: contract Governance is IGovernance, Ownable2Step {
21:     
22:     uint256 internal constant EXECUTED_PROPOSAL_TIMESTAMP = uint256(1); // <= FOUND

```
['[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L26-L26)']
```solidity
22: contract ValidatorTimelock is IExecutor, Ownable2Step {
23:     using LibMap for LibMap.Uint32Map;
24: 
26:     string public constant override getName = "ValidatorTimelock"; // <= FOUND


```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L20-L20)']
```solidity
18: contract AdminFacet is ZkSyncStateTransitionBase, IAdmin {
19:     
20:     string public constant override getName = "AdminFacet"; // <= FOUND

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L27-L27)']
```solidity
22: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor {
23:     using UncheckedMath for uint256;
24:     using PriorityQueue for PriorityQueue.Queue;
27:     string public constant override getName = "ExecutorFacet"; // <= FOUND


```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L25-L25)']
```solidity
20: contract GettersFacet is ZkSyncStateTransitionBase, IGetters, ILegacyGetters {
21:     using UncheckedMath for uint256;
22:     using PriorityQueue for PriorityQueue.Queue;
25:     string public constant override getName = "GettersFacet"; // <= FOUND


```
['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L35-L35)']
```solidity
30: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox {
31:     using UncheckedMath for uint256;
32:     using PriorityQueue for PriorityQueue.Queue;
35:     string public constant override getName = "MailboxFacet"; // <= FOUND


```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L23-L23)']
```solidity
22: contract AccountCodeStorage is IAccountCodeStorage {
23:     bytes32 constant EMPTY_STRING_KECCAK = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470; // <= FOUND
24: 

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L44-L56)']
```solidity
25: contract L1Messenger is IL1Messenger, ISystemContract {
26:     
28:     bytes32 internal chainedLogsHash;
44:     uint256 internal constant KECCAK_ROUND_GAS_COST = 40; // <= FOUND

47:     uint256 internal constant KECCAK_ROUND_NUMBER_OF_BYTES = 136; // <= FOUND

53:     uint256 internal constant SHA256_ROUND_GAS_COST = 7; // <= FOUND

56:     uint256 internal constant SHA256_ROUND_NUMBER_OF_BYTES = 64; // <= FOUND


```
['[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L28-L33)']
```solidity
19: contract MsgValueSimulator is ISystemContract {
20:     
28:     uint256 constant GAS_TO_PASS = 2300; // <= FOUND
33:     uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000; // <= FOUND


```
['[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L28-L31)']
```solidity
27: contract NonceHolder is INonceHolder, ISystemContract {
28:     uint256 private constant DEPLOY_NONCE_MULTIPLIER = 2 ** 128; // <= FOUND
29:     
31:     uint256 private constant MAXIMAL_MIN_NONCE_INCREMENT = 2 ** 32; // <= FOUND


```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L23-L23)']
```solidity
17: contract SystemContext is ISystemContext, ISystemContextDeprecated, ISystemContract {
18:     
23:     uint256 internal constant MINIBLOCK_HASHES_TO_STORE = 257; // <= FOUND

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L18-L21)']
```solidity
15: contract GasBoundCaller {
16:     
18:     uint256 constant CALL_ENTRY_OVERHEAD = 800; // <= FOUND
21:     uint256 constant CALL_RETURN_OVERHEAD = 200; // <= FOUND


```


</details>

## [NonCritical-49] Consider using modifiers for address control

### Resolution 
Modifiers in Solidity can improve code readability and modularity by encapsulating repetitive checks, such as address validity checks, into a reusable construct. For example, an `onlyOwner` modifier can be used to replace repetitive `require(msg.sender == owner)` checks across several functions, reducing code redundancy and enhancing maintainability. To implement, define a modifier with the check, then apply the modifier to relevant functions.

Num of instances: 12

### Findings 


<details><summary>Click to show findings</summary>

['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L63-L66)']
```solidity
63:     function tranferTokenToSharedBridge(address _token, uint256 _amount) external { // <= FOUND
64:         require(msg.sender == address(sharedBridge), "Not shared bridge"); // <= FOUND
65:         uint256 amount = IERC20(_token).balanceOf(address(this));
66:         require(amount == _amount, "Incorrect amount"); // <= FOUND
67:         IERC20(_token).safeTransfer(address(sharedBridge), amount);
68:     }

```
['[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L137-L138)']
```solidity
137:     function receiveEth(uint256 _chainId) external payable { // <= FOUND
138:         require(bridgehub.getStateTransition(_chainId) == msg.sender, "receiveEth not state transition"); // <= FOUND
139:     }

```
['[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L60-L62)']
```solidity
60:     function acceptAdmin() external { // <= FOUND
61:         address currentPendingAdmin = pendingAdmin;
62:         require(msg.sender == currentPendingAdmin, "n42");  // <= FOUND
63: 
64:         address previousAdmin = admin;
65:         admin = currentPendingAdmin;
66:         delete pendingAdmin;
67: 
68:         emit NewPendingAdmin(currentPendingAdmin, address(0));
69:         emit NewAdmin(previousAdmin, pendingAdmin);
70:     }

```
['[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L60-L62)']
```solidity
60:     function acceptAdmin() external { // <= FOUND
61:         address currentPendingAdmin = pendingAdmin;
62:         require(msg.sender == currentPendingAdmin, "n42");  // <= FOUND
63: 
64:         address previousAdmin = admin;
65:         admin = currentPendingAdmin;
66:         delete pendingAdmin;
67: 
68:         emit NewPendingAdmin(currentPendingAdmin, address(0));
69:         emit NewAdmin(previousAdmin, pendingAdmin);
70:     }

```
['[325](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L325-L328)']
```solidity
325:     function _actualRefundRecipient(address _refundRecipient) internal view returns (address _recipient) { // <= FOUND
326:         if (_refundRecipient == address(0)) {
327:             
328:             _recipient = msg.sender == tx.origin ? msg.sender : AddressAliasHelper.applyL1ToL2Alias(msg.sender); // <= FOUND
329:         } else if (_refundRecipient.code.length > 0) {
330:             
331:             _recipient = AddressAliasHelper.applyL1ToL2Alias(_refundRecipient);
332:         } else {
333:             _recipient = _refundRecipient;
334:         }
335:     }

```
['[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L32-L34)']
```solidity
32:     function acceptAdmin() external { // <= FOUND
33:         address pendingAdmin = s.pendingAdmin;
34:         require(msg.sender == pendingAdmin, "n4");  // <= FOUND
35: 
36:         address previousAdmin = s.admin;
37:         s.admin = pendingAdmin;
38:         delete s.pendingAdmin;
39: 
40:         emit NewPendingAdmin(pendingAdmin, address(0));
41:         emit NewAdmin(previousAdmin, pendingAdmin);
42:     }

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L21-L24)']
```solidity
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable { // <= FOUND
22:         require(msg.sender == FORCE_DEPLOYER, "Can only be called by FORCE_DEPLOYER"); // <= FOUND
23: 
24:         require(_delegateTo.code.length > 0, "Delegatee is an EOA"); // <= FOUND
25:         (bool success, bytes memory returnData) = _delegateTo.delegatecall(_calldata);
26:         assembly {
27:             if iszero(success) {
28:                 revert(add(returnData, 0x20), mload(returnData))
29:             }
30:         }
31:     }

```
['[238](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L238-L251)']
```solidity
238:     function forceDeployOnAddresses(ForceDeployment[] calldata _deployments) external payable { // <= FOUND
239:         require( // <= FOUND
240:             msg.sender == FORCE_DEPLOYER || msg.sender == address(COMPLEX_UPGRADER_CONTRACT),
241:             "Can only be called by FORCE_DEPLOYER or COMPLEX_UPGRADER_CONTRACT"
242:         );
243: 
244:         uint256 deploymentsLength = _deployments.length;
245:         
246:         
247:         uint256 sumOfValues = 0;
248:         for (uint256 i = 0; i < deploymentsLength; ++i) {
249:             sumOfValues += _deployments[i].value;
250:         }
251:         require(msg.value == sumOfValues, "`value` provided is not equal to the combined `value`s of deployments"); // <= FOUND
252: 
253:         for (uint256 i = 0; i < deploymentsLength; ++i) {
254:             this.forceDeployOnAddress{value: _deployments[i].value}(_deployments[i], msg.sender);
255:         }
256:     }

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L34-L35)']
```solidity
34:     function setImmutables(address _dest, ImmutableData[] calldata _immutables) external override { // <= FOUND
35:         require(msg.sender == address(DEPLOYER_SYSTEM_CONTRACT), "Callable only by the deployer system contract"); // <= FOUND
36:         unchecked {
37:             uint256 immutablesLength = _immutables.length;
38:             for (uint256 i = 0; i < immutablesLength; ++i) {
39:                 uint256 index = _immutables[i].index;
40:                 bytes32 value = _immutables[i].value;
41:                 immutableDataStorage[uint256(uint160(_dest))][index] = value;
42:             }
43:         }
44:     }

```
['[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L32-L41)']
```solidity
32:     function transferFromTo(address _from, address _to, uint256 _amount) external override { // <= FOUND
33:         require( // <= FOUND
34:             msg.sender == MSG_VALUE_SYSTEM_CONTRACT ||
35:                 msg.sender == address(DEPLOYER_SYSTEM_CONTRACT) ||
36:                 msg.sender == BOOTLOADER_FORMAL_ADDRESS,
37:             "Only system contracts with special access can call this method"
38:         );
39: 
40:         uint256 fromBalance = balance[_from];
41:         require(fromBalance >= _amount, "Transfer amount exceeds balance"); // <= FOUND
42:         unchecked {
43:             balance[_from] = fromBalance - _amount;
44:             
45:             
46:             balance[_to] += _amount;
47:         }
48: 
49:         emit Transfer(_from, _to, _amount);
50:     }

```
['[135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L135-L136)']
```solidity
135:     function incrementDeploymentNonce(address _address) external returns (uint256 prevDeploymentNonce) { // <= FOUND
136:         require( // <= FOUND
137:             msg.sender == address(DEPLOYER_SYSTEM_CONTRACT),
138:             "Only the contract deployer can increment the deployment nonce"
139:         );
140:         uint256 addressAsKey = uint256(uint160(_address));
141:         uint256 oldRawNonce = rawNonces[addressAsKey];
142: 
143:         unchecked {
144:             rawNonces[addressAsKey] = (oldRawNonce + DEPLOY_NONCE_MULTIPLIER);
145:         }
146: 
147:         (prevDeploymentNonce, ) = _splitRawNonce(oldRawNonce);
148:     }

```
['[111](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L111-L120)']
```solidity
111:     function reinitializeToken(
112:         ERC20Getters calldata _availableGetters,
113:         string memory _newName,
114:         string memory _newSymbol,
115:         uint8 _version
116:     ) external onlyNextVersion(_version) reinitializer(_version) {
117:         
118:         
119:         address beaconAddress = _getBeacon();
120:         require(msg.sender == UpgradeableBeacon(beaconAddress).owner(), "tt"); // <= FOUND
121: 
122:         __ERC20_init_unchained(_newName, _newSymbol);
123:         __ERC20Permit_init(_newName);
124:         availableGetters = _availableGetters;
125: 
126:         emit BridgeInitialize(l1Address, _newName, _newSymbol, decimals_);
127:     }

```


</details>

## [NonCritical-50] Off-by-one timestamp error

### Resolution 
In Solidity, using `>=` or `<=` to compare against `block.timestamp` (alias `now`) may introduce off-by-one errors due to the fact that `block.timestamp` is only updated once per block and its value remains constant throughout the block's execution. If an operation happens at the exact second when `block.timestamp` changes, it could result in unexpected behavior. To avoid this, it's safer to use strict inequality operators (`>` or `<`). For instance, if a condition should only be met after a certain time, use `block.timestamp > time` rather than `block.timestamp >= time`. This way, potential off-by-one errors due to the exact timing of block mining are mitigated, leading to safer, more predictable contract behavior.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L182-L195)']
```solidity
182:     function executeBatches(StoredBatchInfo[] calldata _newBatchesData) external onlyValidator(ERA_CHAIN_ID) { // <= FOUND
183:         uint256 delay = executionDelay; 
184:         unchecked {
185:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {
186:                 uint256 commitBatchTimestamp = committedBatchTimestamp[ERA_CHAIN_ID].get( // <= FOUND
187:                     _newBatchesData[i].batchNumber
188:                 );
189: 
190:                 
191:                 
192:                 
193:                 
194: 
195:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c");  // <= FOUND
196:             }
197:         }
198:         _propagateToZkSyncStateTransition(ERA_CHAIN_ID);
199:     }

```
['[203](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L203-L217)']
```solidity
203:     function executeBatchesSharedBridge(
204:         uint256 _chainId,
205:         StoredBatchInfo[] calldata _newBatchesData
206:     ) external onlyValidator(_chainId) {
207:         uint256 delay = executionDelay; 
208:         unchecked {
209:             for (uint256 i = 0; i < _newBatchesData.length; ++i) {
210:                 uint256 commitBatchTimestamp = committedBatchTimestamp[_chainId].get(_newBatchesData[i].batchNumber);
211: 
212:                 
213:                 
214:                 
215:                 
216: 
217:                 require(block.timestamp >= commitBatchTimestamp + delay, "5c");  // <= FOUND
218:             }
219:         }
220:         _propagateToZkSyncStateTransition(_chainId);
221:     }

```
['[103](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L103-L122)']
```solidity
103:     function _verifyBatchTimestamp(
104:         uint256 _packedBatchAndL2BlockTimestamp,
105:         uint256 _expectedBatchTimestamp,
106:         uint256 _previousBatchTimestamp
107:     ) internal view {
108:         
109:         uint256 batchTimestamp = _packedBatchAndL2BlockTimestamp >> 128;
110:         require(batchTimestamp == _expectedBatchTimestamp, "tb");
111: 
112:         
113:         
114:         require(_previousBatchTimestamp < batchTimestamp, "h3");
115: 
116:         uint256 lastL2BlockTimestamp = _packedBatchAndL2BlockTimestamp & PACKED_L2_BLOCK_TIMESTAMP_MASK;
117: 
118:         
119:         
120:         
121:         
122:         require(block.timestamp - COMMIT_TIMESTAMP_NOT_OLDER <= batchTimestamp, "h1");  // <= FOUND
123:         require(lastL2BlockTimestamp <= block.timestamp + COMMIT_TIMESTAMP_APPROXIMATION_DELTA, "h2"); 
124:     }

```
['[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L67-L67)']
```solidity
67:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual returns (bytes32 txHash) { // <= FOUND
68:         
69:         
70:         
71:         
72:         require(block.timestamp >= _proposedUpgrade.upgradeTimestamp, "Upgrade is not ready yet");
73: 
74:         _setNewProtocolVersion(_proposedUpgrade.newProtocolVersion);
75:         _upgradeL1Contract(_proposedUpgrade.l1ContractsUpgradeCalldata);
76:         _upgradeVerifier(_proposedUpgrade.verifier, _proposedUpgrade.verifierParams);
77:         _setBaseSystemContracts(_proposedUpgrade.bootloaderHash, _proposedUpgrade.defaultAccountHash);
78: 
79:         txHash = _setL2SystemContractUpgrade(
80:             _proposedUpgrade.l2ProtocolUpgradeTx,
81:             _proposedUpgrade.factoryDeps,
82:             _proposedUpgrade.newProtocolVersion
83:         );
84: 
85:         _postUpgrade(_proposedUpgrade.postUpgradeCalldata);
86: 
87:         emit UpgradeComplete(_proposedUpgrade.newProtocolVersion, txHash, _proposedUpgrade);
88:     }

```
['[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L47-L47)']
```solidity
47:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual override returns (bytes32) { // <= FOUND
48:         
49:         
50:         
51:         
52:         require(block.timestamp >= _proposedUpgrade.upgradeTimestamp, "Upgrade is not ready yet");
53: 
54:         _setNewProtocolVersion(_proposedUpgrade.newProtocolVersion);
55:         _upgradeL1Contract(_proposedUpgrade.l1ContractsUpgradeCalldata);
56:         _upgradeVerifier(_proposedUpgrade.verifier, _proposedUpgrade.verifierParams);
57:         _setBaseSystemContracts(_proposedUpgrade.bootloaderHash, _proposedUpgrade.defaultAccountHash);
58: 
59:         bytes32 txHash = _setL2SystemContractUpgrade(
60:             _proposedUpgrade.l2ProtocolUpgradeTx,
61:             _proposedUpgrade.factoryDeps,
62:             _proposedUpgrade.newProtocolVersion
63:         );
64: 
65:         _postUpgrade(_proposedUpgrade.postUpgradeCalldata);
66: 
67:         emit UpgradeComplete(_proposedUpgrade.newProtocolVersion, txHash, _proposedUpgrade);
68:     }

```


</details>

## [NonCritical-51] Use of non-named numeric constants

### Resolution 
Magic numbers should be avoided in Solidity code to enhance readability, maintainability, and reduce the likelihood of errors. Magic numbers are hard-coded values with no clear meaning or context, which can create confusion and make the code harder to understand for developers. Using well-defined constants or variables with descriptive names instead of magic numbers not only clarifies the purpose and significance of the value but also simplifies code updates and modifications.

Num of instances: 82

### Findings 


<details><summary>Click to show findings</summary>

['[109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L109-L110)']
```solidity
109:         
110:         uint256 batchTimestamp = _packedBatchAndL2BlockTimestamp >> 128; // <= FOUND

```
['[141](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L141-L141)']
```solidity
141:         return 18; // <= FOUND

```
['[416](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L416-L417)']
```solidity
416:         
417:         uint256 packedTimestamps = (uint256(currentBatchTimestamp) << 128) | currentL2BlockTimestamp; // <= FOUND

```
['[498](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L498-L498)']
```solidity
498:         blockInfo = (uint256(blockNumber) << 128) | uint256(blockTimestamp); // <= FOUND

```
['[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L26-L26)']
```solidity
26:             if (_val < 128) { // <= FOUND

```
['[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L87-L87)']
```solidity
87:                 _number >>= 128; // <= FOUND

```
['[88](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L88-L88)']
```solidity
88:                 hbs += 16; // <= FOUND

```
['[99](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L99-L99)']
```solidity
99:                 _number >>= 16; // <= FOUND

```
['[135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L135-L135)']
```solidity
135:         rawParams |= uint256(_perPrecompileInterpreted) << 192; // <= FOUND

```
['[128](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L128-L128)']
```solidity
128:         farCallAbiWithEmptyFatPtr |= (uint256(gasPassed) << 192); // <= FOUND

```
['[106](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L106-L108)']
```solidity
106:         
107:         
108:         assert(L2_TO_L1_LOG_SERIALIZE_SIZE != 2 * 32); // <= FOUND

```
['[581](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L581-L581)']
```solidity
581:             blobAuxOutputWords[i * 2] = _blobHashes[i]; // <= FOUND

```
['[582](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L582-L582)']
```solidity
582:             blobAuxOutputWords[i * 2 + 1] = _blobCommitments[i]; // <= FOUND

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L30-L30)']
```solidity
30:             currentHash = (_index % 2 == 0) // <= FOUND
31:                 ? _efficientHash(currentHash, _path[i])
32:                 : _efficientHash(_path[i], currentHash);

```
['[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L33-L33)']
```solidity
33:             _index /= 2; // <= FOUND

```
['[97](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L97-L97)']
```solidity
97:                 vInt += 8 + block.chainid * 2; // <= FOUND

```
['[193](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L193-L193)']
```solidity
193:             vEncoded = RLPEncoder.encodeUint256(vInt - 27); // <= FOUND

```
['[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L61-L61)']
```solidity
61:             for (uint256 encodedDataPointer = 0; encodedDataPointer < encodedData.length; encodedDataPointer += 2) { // <= FOUND

```
['[236](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L236-L236)']
```solidity
236:             } else if (_operation == 2) { // <= FOUND

```
['[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L89-L93)']
```solidity
89:         
90:         
91:         
92:         
93:         uint256 gasToPay = keccakGasCost(L2_TO_L1_LOG_SERIALIZE_SIZE) + 2 * keccakGasCost(64); // <= FOUND

```
['[223](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L223-L223)']
```solidity
223:             nodesOnCurrentLevel /= 2; // <= FOUND

```
['[144](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L144-L151)']
```solidity
144:         
145:         
146:         
147:         
148:         
149:         
150:         
151:         if (blockNumber <= _block || blockNumber - _block > 256) { // <= FOUND

```
['[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L33-L33)']
```solidity
33:                 encoded = new bytes(hbs + 2); // <= FOUND

```
['[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L100-L100)']
```solidity
100:                 hbs += 2; // <= FOUND

```
['[332](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L332-L333)']
```solidity
332:         
333:         return (callFlags & 2) != 0; // <= FOUND

```
['[129](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L129-L129)']
```solidity
129:         farCallAbiWithEmptyFatPtr |= (uint256(forwardingMode) << 224); // <= FOUND

```
['[130](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L130-L130)']
```solidity
130:         farCallAbiWithEmptyFatPtr |= (uint256(shardId) << 232); // <= FOUND

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L132-L132)']
```solidity
132:             farCallAbiWithEmptyFatPtr |= (1 << 240); // <= FOUND

```
['[135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L135-L135)']
```solidity
135:             farCallAbiWithEmptyFatPtr |= (1 << 248); // <= FOUND

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L46-L46)']
```solidity
46:             codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3])); // <= FOUND

```
['[93](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L93-L94)']
```solidity
93:         
94:         hashedBytecode = (hashedBytecode | bytes32(uint256(1 << 248))); // <= FOUND

```
['[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L95-L96)']
```solidity
95:         
96:         hashedBytecode = hashedBytecode | bytes32(lengthInWords << 224); // <= FOUND

```
['[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L67-L68)']
```solidity
67:             blobCommitments[0] = bytes32(
68:                 _newBatch.pubdataCommitments[_newBatch.pubdataCommitments.length - 32:_newBatch // <= FOUND
69:                     .pubdataCommitments
70:                     .length]
71:             );

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L27-L29)']
```solidity
27:             
28:             
29:             uint256 bitOffset = (_index & 7) * 32; // <= FOUND

```
['[141](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L141-L141)']
```solidity
141:             stateDiffPtr += 32; // <= FOUND

```
['[146](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L146-L146)']
```solidity
146:             uint8 len = operation == 0 ? 32 : metadata >> LENGTH_BITS_OFFSET; // <= FOUND

```
['[229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L229-L229)']
```solidity
229:             if (_operation == 0 || _operation == 3) { // <= FOUND

```
['[148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L148-L154)']
```solidity
148:         
149:         
150:         
151:         
152:         
153:         uint256 gasToPay = keccakGasCost(L2_TO_L1_LOG_SERIALIZE_SIZE) +
154:             3 * // <= FOUND
155:             keccakGasCost(64) +
156:             gasSpentOnMessageHashing +
157:             COMPUTATIONAL_PRICE_FOR_PUBDATA *
158:             pubdataLen;

```
['[286](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L286-L286)']
```solidity
286:         uint24 compressedStateDiffSize = uint24(bytes3(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 3])); // <= FOUND

```
['[287](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L287-L287)']
```solidity
287:         calldataPtr += 3; // <= FOUND

```
['[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L95-L95)']
```solidity
95:                 _number >>= 32; // <= FOUND

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L132-L132)']
```solidity
132:         rawParams |= uint256(_inputMemoryLength) << 32; // <= FOUND

```
['[155](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L155-L155)']
```solidity
155:         uint256 params = uint256(_gasToBurn) + (uint256(_pubdataToSpend) << 32); // <= FOUND

```
['[228](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L228-L228)']
```solidity
228:         pubdataPublished = uint32(extractNumberFromMeta(meta, META_GAS_PER_PUBDATA_BYTE_OFFSET, 32)); // <= FOUND

```
['[238](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L238-L238)']
```solidity
238:         heapSize = uint32(extractNumberFromMeta(meta, META_HEAP_SIZE_OFFSET, 32)); // <= FOUND

```
['[247](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L247-L247)']
```solidity
247:         auxHeapSize = uint32(extractNumberFromMeta(meta, META_AUX_HEAP_SIZE_OFFSET, 32)); // <= FOUND

```
['[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L116-L116)']
```solidity
116:         farCallAbi |= (uint256(memoryPage) << 32); // <= FOUND

```
['[86](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L86-L86)']
```solidity
86:         uint256 lengthInWords = _bytecode.length / 32; // <= FOUND

```
['[286](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L286-L287)']
```solidity
286:                 
287:                 if (data.length <= 4) { // <= FOUND

```
['[66](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L66-L66)']
```solidity
66:                 uint64 realChunk = _bytecode.readUint64(encodedDataPointer * 4); // <= FOUND

```
['[139](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L139-L139)']
```solidity
139:         if (to == address(DEPLOYER_SYSTEM_CONTRACT) && data.length >= 4) { // <= FOUND

```
['[200](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L200-L201)']
```solidity
200:         
201:         uint32 numberOfL2ToL1Logs = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4])); // <= FOUND

```
['[202](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L202-L202)']
```solidity
202:         calldataPtr += 4; // <= FOUND

```
['[233](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L233-L234)']
```solidity
233:         
234:         uint32 numberOfMessages = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4])); // <= FOUND

```
['[237](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L237-L237)']
```solidity
237:             uint32 currentMessageLength = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4])); // <= FOUND

```
['[238](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L238-L238)']
```solidity
238:             calldataPtr += 4; // <= FOUND

```
['[251](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L251-L252)']
```solidity
251:         
252:         uint32 numberOfBytecodes = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4])); // <= FOUND

```
['[255](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L255-L256)']
```solidity
255:             uint32 currentBytecodeLength = uint32(
256:                 bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]) // <= FOUND
257:             );

```
['[300](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L300-L300)']
```solidity
300:         uint32 numberOfStateDiffs = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4])); // <= FOUND

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L96-L96)']
```solidity
96:                 hbs += 4; // <= FOUND

```
['[83](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L83-L87)']
```solidity
83:             
84:             
85:             
86:             
87:             costForComputation += Math.ceilDiv(_encodingLength * L1_TX_DELTA_544_ENCODING_BYTES, 544); // <= FOUND

```
['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L62-L62)']
```solidity
62:             if (_len < 56) { // <= FOUND

```
['[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L69-L69)']
```solidity
69:                 encoded[0] = bytes1(uint8(_offset + hbs + 56)); // <= FOUND

```
['[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L40-L40)']
```solidity
40:         codeLength = bytecodeLenInWords(_bytecodeHash) << 5;  // <= FOUND

```
['[91](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L91-L91)']
```solidity
91:                 _number >>= 64; // <= FOUND

```
['[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L133-L133)']
```solidity
133:         rawParams |= uint256(_outputMemoryOffset) << 64; // <= FOUND

```
['[117](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L117-L117)']
```solidity
117:         farCallAbi |= (uint256(dataStart) << 64); // <= FOUND

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L23-L26)']
```solidity
23:             
24:             
25:             
26:             uint256 mapValue = _map.map[_index / 8]; // <= FOUND

```
['[43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L43-L46)']
```solidity
43:             
44:             
45:             
46:             uint256 mapIndex = _index / 8; // <= FOUND

```
['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L62-L62)']
```solidity
62:                 uint256 indexOfEncodedChunk = uint256(encodedData.readUint16(encodedDataPointer)) * 8; // <= FOUND

```
['[203](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L203-L203)']
```solidity
203:             dictionary = _rawCompressedData[2:2 + dictionaryLen * 8]; // <= FOUND

```
['[204](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L204-L204)']
```solidity
204:             encodedData = _rawCompressedData[2 + dictionaryLen * 8:]; // <= FOUND

```
['[253](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L253-L253)']
```solidity
253:         number >>= (256 - (_calldataSlice.length * 8)); // <= FOUND

```
['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L62-L62)']
```solidity
62:         return SHA256_ROUND_GAS_COST * ((_length + 8) / SHA256_ROUND_NUMBER_OF_BYTES + 1); // <= FOUND

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L37-L37)']
```solidity
37:                 uint256 shiftedVal = _val << (lbs * 8); // <= FOUND

```
['[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L72-L72)']
```solidity
72:                 uint256 shiftedVal = uint256(_len) << (lbs * 8); // <= FOUND

```
['[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L92-L92)']
```solidity
92:                 hbs += 8; // <= FOUND

```
['[255](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L255-L255)']
```solidity
255:         shardId = uint8(extractNumberFromMeta(meta, META_SHARD_ID_OFFSET, 8)); // <= FOUND

```
['[264](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L264-L264)']
```solidity
264:         callerShardId = uint8(extractNumberFromMeta(meta, META_CALLER_SHARD_ID_OFFSET, 8)); // <= FOUND

```
['[273](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L273-L273)']
```solidity
273:         codeShardId = uint8(extractNumberFromMeta(meta, META_CODE_SHARD_ID_OFFSET, 8)); // <= FOUND

```
['[134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L134-L134)']
```solidity
134:         rawParams |= uint256(_outputMemoryLength) << 96; // <= FOUND

```
['[118](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L118-L118)']
```solidity
118:         farCallAbi |= (uint256(dataLength) << 96); // <= FOUND

```


</details>

## [NonCritical-52] Long powers of ten should use scientific notation 1eX

### Resolution 
A large number such as 1000000 is far more readable as 1e6, this will help prevent unintended bugs in the code

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Config.sol#L92-L92)']
```solidity
92: uint256 constant TX_SLOT_OVERHEAD_L2_GAS = 10000; // <= FOUND

```


</details>

## [NonCritical-53] Redundant else statement

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L105-L105)']
```solidity
105:     function getOperationState(bytes32 _id) public view returns (OperationState) { // <= FOUND
106:         uint256 timestamp = timestamps[_id];
107:         if (timestamp == 0) {
108:             return OperationState.Unset;
109:         } else if (timestamp == EXECUTED_PROPOSAL_TIMESTAMP) {
110:             return OperationState.Done;
111:         } else if (timestamp > block.timestamp) {
112:             return OperationState.Waiting;
113:         } else {
114:             return OperationState.Ready;
115:         }
116:     }

```


</details>

## [NonCritical-54] Inconsistent usage of int/uint with int256/uint256 in contract/abstract/library/interface

### Resolution 
Use uint256/int256 consistently in place of uint/int to prevent ambiguity rather than using both within the same  contract/abstract/library/interface

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L22-L679)']
```solidity
22: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor {
23:     using UncheckedMath for uint256; // <= FOUND
104:         uint256 _packedBatchAndL2BlockTimestamp, // <= FOUND

105:         uint256 _expectedBatchTimestamp, // <= FOUND

106:         uint256 _previousBatchTimestamp // <= FOUND

109:         uint256 batchTimestamp = _packedBatchAndL2BlockTimestamp >> 128; // <= FOUND

116:         uint256 lastL2BlockTimestamp = _packedBatchAndL2BlockTimestamp & PACKED_L2_BLOCK_TIMESTAMP_MASK; // <= FOUND

139:         uint256 processedLogs; // <= FOUND

142:         for (uint256 i = 0; i < emittedL2Logs.length; i = i.uncheckedAdd(L2_TO_L1_LOG_SERIALIZE_SIZE)) { // <= FOUND

145:             (uint256 logKey, ) = UnsafeBytes.readUint256(emittedL2Logs, i + L2_LOG_KEY_OFFSET); // <= FOUND

153:             if (logKey == uint256(SystemLogKey.L2_TO_L1_LOGS_TREE_ROOT_KEY)) { // <= FOUND

156:             } else if (logKey == uint256(SystemLogKey.TOTAL_L2_TO_L1_PUBDATA_KEY)) { // <= FOUND

159:             } else if (logKey == uint256(SystemLogKey.STATE_DIFF_HASH_KEY)) { // <= FOUND

162:             } else if (logKey == uint256(SystemLogKey.PACKED_BATCH_AND_L2_BLOCK_TIMESTAMP_KEY)) { // <= FOUND

164:                 logOutput.packedBatchAndL2BlockTimestamp = uint256(logValue); // <= FOUND

165:             } else if (logKey == uint256(SystemLogKey.PREV_BATCH_HASH_KEY)) { // <= FOUND

168:             } else if (logKey == uint256(SystemLogKey.CHAINED_PRIORITY_TXN_HASH_KEY)) { // <= FOUND

171:             } else if (logKey == uint256(SystemLogKey.NUMBER_OF_LAYER_1_TXS_KEY)) { // <= FOUND

173:                 logOutput.numberOfLayer1Txs = uint256(logValue); // <= FOUND

174:             } else if (logKey == uint256(SystemLogKey.BLOB_ONE_HASH_KEY)) { // <= FOUND

177:             } else if (logKey == uint256(SystemLogKey.BLOB_TWO_HASH_KEY)) { // <= FOUND

180:             } else if (logKey == uint256(SystemLogKey.EXPECTED_SYSTEM_CONTRACT_UPGRADE_TX_HASH_KEY)) { // <= FOUND

208:         uint256,  // <= FOUND

257:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) { // <= FOUND

289:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) { // <= FOUND

308:     function _collectOperationsFromPriorityQueue(uint256 _nPriorityOps) internal returns (bytes32 concatHash) { // <= FOUND

311:         for (uint256 i = 0; i < _nPriorityOps; i = i.uncheckedInc()) { // <= FOUND

321:     function _executeOneBatch(StoredBatchInfo memory _storedBatch, uint256 _executedBatchIdx) internal { // <= FOUND

322:         uint256 currentBatchNumber = _storedBatch.batchNumber; // <= FOUND

338:         uint256, // <= FOUND

350:         uint256 nBatches = _batchesData.length; // <= FOUND

351:         for (uint256 i = 0; i < nBatches; i = i.uncheckedInc()) { // <= FOUND

356:         uint256 newTotalBatchesExecuted = s.totalBatchesExecuted + nBatches; // <= FOUND

360:         uint256 batchWhenUpgradeHappened = s.l2SystemContractsUpgradeBatchNumber; // <= FOUND

378:         uint256,  // <= FOUND

392:         uint256 currentTotalBatchesVerified = s.totalBatchesVerified; // <= FOUND

393:         uint256 committedBatchesLength = _committedBatches.length; // <= FOUND

399:         uint256[] memory proofPublicInput = new uint256[](committedBatchesLength); // <= FOUND

405:         for (uint256 i = 0; i < committedBatchesLength; i = i.uncheckedInc()) { // <= FOUND

440:     function _verifyProof(uint256[] memory proofPublicInput, ProofInput calldata _proof) internal view { // <= FOUND

457:     ) internal pure returns (uint256) { // <= FOUND

459:             uint256( // <= FOUND

472:     function revertBatches(uint256 _newLastBatch) external nonReentrant onlyValidatorOrStateTransitionManager { // <= FOUND

477:     function revertBatchesSharedBridge(uint256, uint256 _newLastBatch) external nonReentrant onlyValidator { // <= FOUND

481:     function _revertBatches(uint256 _newLastBatch) internal { // <= FOUND

580:         for (uint i = 0; i < MAX_NUMBER_OF_BLOBS; i++) { // <= FOUND

592:     function _checkBit(uint256 _bitMap, uint8 _index) internal pure returns (bool) { // <= FOUND

597:     function _setBit(uint256 _bitMap, uint8 _index) internal pure returns (uint256) { // <= FOUND

617:         (, uint256 result) = abi.decode(data, (uint256, uint256)); // <= FOUND

629:         uint256 versionedHashIndex = 0; // <= FOUND

636:         for (uint256 i = 0; i < _pubdataCommitments.length; i += PUBDATA_COMMITMENT_SIZE) { // <= FOUND

644:                 uint256(uint128(bytes16(_pubdataCommitments[i:i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET]))) // <= FOUND

667:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) { // <= FOUND

679:     function _getBlobVersionedHash(uint256 _index) internal view returns (bytes32 versionedHash) { // <= FOUND


```


</details>

## [NonCritical-55] Contract existence is not checked before low level call

### Resolution 
Low-level assembly calls, such as call, can return a successful status even when the target address contains no executable code. This is due to the fact that a call operation merely checks if the call operation itself was successful, not whether the call was made to an address with code. As a result, these calls might lead to false positives when assessing the success of an operation. To prevent potential issues, consider using Solidity's extcodesize function to check the size of the contract code at the target address. If extcodesize returns zero, this indicates that there is no code at the specified address, and the function can safely revert.

Num of instances: 15

### Findings 


<details><summary>Click to show findings</summary>

['[357](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L357-L358)']
```solidity
357:             assembly {
358:                 callSuccess := call(gas(), _depositSender, _amount, 0, 0, 0, 0) // <= FOUND
359:             }

```
['[446](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L446-L447)']
```solidity
446:             assembly {
447:                 callSuccess := call(gas(), l1Receiver, amount, 0, 0, 0, 0) // <= FOUND
448:             }

```
['[227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L227-L231)']
```solidity
227:         assembly {
228:             
229:             calldatacopy(0, 0, calldatasize())
230:             
231:             let result := call(gas(), contractAddress, 0, 0, calldatasize(), 0, 0) // <= FOUND
232:             
233:             let size := returndatasize()
234:             
235:             returndatacopy(0, 0, size)
236:             
237:             switch result
238:             case 0 {
239:                 
240:                 revert(0, size)
241:             }
242:             default {
243:                 
244:                 return(0, size)
245:             }
246:         }

```
['[148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L148-L149)']
```solidity
148:             assembly {
149:                 success := call(msgValueSimulator, callAddr, _value, _address, 0xFFFF, forwardMask, 0) // <= FOUND
150:             }

```
['[203](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L203-L208)']
```solidity
203:         assembly {
204:             
205:             
206:             _whoToMimic := and(_whoToMimic, cleanupMask)
207: 
208:             success := call(_address, callAddr, 0, 0, _whoToMimic, 0, 0) // <= FOUND
209:         }

```
['[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L50-L55)']
```solidity
50:         assembly {
51:             
52:             _isService := and(_isService, 1)
53:             
54:             
55:             let success := call(_isService, callAddr, _key, _value, 0xFFFF, 0, 0) // <= FOUND
56:         }

```
['[171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L171-L174)']
```solidity
171:         assembly {
172:             
173:             _value := and(_value, cleanupMask)
174:             success := call(0, callAddr, _value, 0, 0xFFFF, 0, 0) // <= FOUND
175:         }

```
['[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L61-L62)']
```solidity
61:             assembly {
62:                 success := call(to, callAddr, 0, 0, farCallAbi, 0, 0) // <= FOUND
63:             }

```
['[70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L70-L71)']
```solidity
70:             assembly {
71:                 success := call(msgValueSimulator, callAddr, value, to, farCallAbi, forwardMask, 0) // <= FOUND
72:             }

```
['[399](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L399-L400)']
```solidity
399:         assembly {
400:             success := call(gas(), bootloaderAddr, amount, 0, 0, 0, 0) // <= FOUND
401:         }

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L20-L22)']
```solidity
20:        assembly {
21:             let offset := sub(_bytes.offset, 30)
22:             result := calldataload(add(offset, _start)) // <= FOUND
23:         }

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L27-L29)']
```solidity
27:        assembly {
28:             let offset := sub(_bytes.offset, 28)
29:             result := calldataload(add(offset, _start)) // <= FOUND
30:         }

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L34-L36)']
```solidity
34:        assembly {
35:             let offset := sub(_bytes.offset, 24)
36:             result := calldataload(add(offset, _start)) // <= FOUND
37:         }

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L41-L42)']
```solidity
41:        assembly {
42:             result := calldataload(add(_bytes.offset, _start)) // <= FOUND
43:         }

```
['[135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L135-L136)']
```solidity
135:            assembly {
136:                 success := call(_address, callAddr, 0, 0, 0xFFFF, 0, 0) // <= FOUND
137:             }

```


</details>

## [NonCritical-56] Employ Explicit Casting to Bytes or Bytes32 for Enhanced Code Clarity and Meaning

### Resolution 
Smart contracts are complex entities, and clarity in their operations is fundamental to ensure that they function as intended. Casting a single argument instead of utilizing 'abi.encodePacked()' improves the transparency of the operation. It elucidates the intent of the code, reducing ambiguity and making it easier for auditors and developers to understand the codes purpose. Such practices promote readability and maintainability, thus reducing the likelihood of errors and misunderstandings. Therefore, it's recommended to employ explicit casts for single arguments where possible, to increase the contract's comprehensibility and ensure a smoother review process.

Num of instances: 13

### Findings 


<details><summary>Click to show findings</summary>

['[461](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L461-L461)']
```solidity
453:     function _getBatchProofPublicInput(
454:         bytes32 _prevBatchCommitment,
455:         bytes32 _currentBatchCommitment,
456:         VerifierParams memory _verifierParams
457:     ) internal pure returns (uint256) {
458:         return
459:             uint256(
460:                 keccak256(
461:                     abi.encodePacked( // <= FOUND
462:                         _prevBatchCommitment,
463:                         _currentBatchCommitment,
464:                         _verifierParams.recursionNodeLevelVkHash,
465:                         _verifierParams.recursionLeafLevelVkHash
466:                     )
467:                 )
468:             ) >> PUBLIC_INPUT_SHIFT;
469:     }

```
['[517](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L517-L517)']
```solidity
515:     function _batchPassThroughData(CommitBatchInfo calldata _batch) internal pure returns (bytes memory) {
516:         return
517:             abi.encodePacked( // <= FOUND
518:                 _batch.indexRepeatedStorageChanges,
519:                 _batch.newStateRoot,
520:                 uint64(0), 
521:                 bytes32(0) 
522:             );
523:     }

```
['[528](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L528-L528)']
```solidity
525:     function _batchMetaParameters() internal view returns (bytes memory) {
526:         bytes32 l2DefaultAccountBytecodeHash = s.l2DefaultAccountBytecodeHash;
527:         return
528:             abi.encodePacked( // <= FOUND
529:                 s.zkPorterIsAvailable,
530:                 s.l2BootloaderBytecodeHash,
531:                 l2DefaultAccountBytecodeHash,
532:                 
533:                 l2DefaultAccountBytecodeHash
534:             );
535:     }

```
['[548](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L548-L548)']
```solidity
537:     function _batchAuxiliaryOutput(
538:         CommitBatchInfo calldata _batch,
539:         bytes32 _stateDiffHash,
540:         bytes32[] memory _blobCommitments,
541:         bytes32[] memory _blobHashes
542:     ) internal pure returns (bytes memory) {
543:         require(_batch.systemLogs.length <= MAX_L2_TO_L1_LOGS_COMMITMENT_BYTES, "pu");
544: 
545:         bytes32 l2ToL1LogsHash = keccak256(_batch.systemLogs);
546: 
547:         return
548:             abi.encodePacked( // <= FOUND
549:                 l2ToL1LogsHash,
550:                 _stateDiffHash,
551:                 _batch.bootloaderHeapInitialContentsHash,
552:                 _batch.eventsQueueStateHash,
553:                 _encodeBlobAuxilaryOutput(_blobCommitments, _blobHashes)
554:             );
555:     }

```
['[610](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L610-L610)']
```solidity
605:     function _pointEvaluationPrecompile(
606:         bytes32 _versionedHash,
607:         bytes32 _openingPoint,
608:         bytes calldata _openingValueCommitmentProof
609:     ) internal view {
610:         bytes memory precompileInput = abi.encodePacked(_versionedHash, _openingPoint, _openingValueCommitmentProof); // <= FOUND
611: 
612:         (bool success, bytes memory data) = POINT_EVALUATION_PRECOMPILE_ADDR.staticcall(precompileInput);
613: 
614:         
615:         
616:         require(success, "failed to call point evaluation precompile");
617:         (, uint256 result) = abi.decode(data, (uint256, uint256));
618:         require(result == BLS_MODULUS, "precompile unexpected output");
619:     }

```
['[655](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L655-L655)']
```solidity
625:     function _verifyBlobInformation(
626:         bytes calldata _pubdataCommitments,
627:         bytes32[] memory _blobHashes
628:     ) internal view returns (bytes32[] memory blobCommitments) {
629:         uint256 versionedHashIndex = 0;
630: 
631:         require(_pubdataCommitments.length > 0, "pl");
632:         require(_pubdataCommitments.length <= PUBDATA_COMMITMENT_SIZE * MAX_NUMBER_OF_BLOBS, "bd");
633:         require(_pubdataCommitments.length % PUBDATA_COMMITMENT_SIZE == 0, "bs");
634:         blobCommitments = new bytes32[](MAX_NUMBER_OF_BLOBS);
635: 
636:         for (uint256 i = 0; i < _pubdataCommitments.length; i += PUBDATA_COMMITMENT_SIZE) {
637:             bytes32 blobVersionedHash = _getBlobVersionedHash(versionedHashIndex);
638: 
639:             require(blobVersionedHash != bytes32(0), "vh");
640: 
641:             
642:             
643:             bytes32 openingPoint = bytes32(
644:                 uint256(uint128(bytes16(_pubdataCommitments[i:i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET])))
645:             );
646: 
647:             _pointEvaluationPrecompile(
648:                 blobVersionedHash,
649:                 openingPoint,
650:                 _pubdataCommitments[i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET:i + PUBDATA_COMMITMENT_SIZE]
651:             );
652: 
653:             
654:             blobCommitments[versionedHashIndex] = keccak256(
655:                 abi.encodePacked(blobVersionedHash, _pubdataCommitments[i:i + PUBDATA_COMMITMENT_COMMITMENT_OFFSET]) // <= FOUND
656:             );
657:             versionedHashIndex += 1;
658:         }
659: 
660:         
661:         
662:         bytes32 versionedHash = _getBlobVersionedHash(versionedHashIndex);
663:         require(versionedHash == bytes32(0), "lh");
664: 
665:         
666:         
667:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) {
668:             require(
669:                 (_blobHashes[i] == bytes32(0) && blobCommitments[i] == bytes32(0)) ||
670:                     (_blobHashes[i] != bytes32(0) && blobCommitments[i] != bytes32(0)),
671:                 "bh"
672:             );
673:         }
674:     }

```
['[113](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L113-L113)']
```solidity
104:     function _proveL2LogInclusion(
105:         uint256 _batchNumber,
106:         uint256 _index,
107:         L2Log memory _log,
108:         bytes32[] calldata _proof
109:     ) internal view returns (bool) {
110:         require(_batchNumber <= s.totalBatchesExecuted, "xx");
111: 
112:         bytes32 hashedLog = keccak256(
113:             abi.encodePacked(_log.l2ShardId, _log.isService, _log.txNumberInBatch, _log.sender, _log.key, _log.value) // <= FOUND
114:         );
115:         
116:         
117:         require(hashedLog != L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH, "tw");
118: 
119:         
120:         
121:         
122: 
123:         bytes32 calculatedRootHash = Merkle.calculateRoot(_proof, _index, hashedLog);
124:         bytes32 actualRootHash = s.l2LogsRootHashes[_batchNumber];
125: 
126:         return actualRootHash == calculatedRootHash;
127:     }

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L96-L96)']
```solidity
94:     function _processL2ToL1Log(L2ToL1Log memory _l2ToL1Log) internal returns (uint256 logIdInMerkleTree) {
95:         bytes32 hashedLog = keccak256(
96:             abi.encodePacked( // <= FOUND
97:                 _l2ToL1Log.l2ShardId,
98:                 _l2ToL1Log.isService,
99:                 _l2ToL1Log.txNumberInBlock,
100:                 _l2ToL1Log.sender,
101:                 _l2ToL1Log.key,
102:                 _l2ToL1Log.value
103:             )
104:         );
105: 
106:         chainedLogsHash = keccak256(abi.encode(chainedLogsHash, hashedLog));
107: 
108:         logIdInMerkleTree = numberOfLogsToProcess;
109:         numberOfLogsToProcess++;
110: 
111:         emit L2ToL1LogSent(_l2ToL1Log);
112:     }

```
['[113](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L113-L113)']
```solidity
112:     function _getL1WithdrawMessage(address _to, uint256 _amount) internal pure returns (bytes memory) {
113:         return abi.encodePacked(IMailbox.finalizeEthWithdrawal.selector, _to, _amount); // <= FOUND
114:     }

```
['[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L123-L123)']
```solidity
117:     function _getExtendedWithdrawMessage(
118:         address _to,
119:         uint256 _amount,
120:         address _sender,
121:         bytes memory _additionalData
122:     ) internal pure returns (bytes memory) {
123:         return abi.encodePacked(IMailbox.finalizeEthWithdrawal.selector, _to, _amount, _sender, _additionalData); // <= FOUND
124:     }

```
['[234](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L234-L234)']
```solidity
233:     function _calculateLegacyL2BlockHash(uint128 _blockNumber) internal pure returns (bytes32) {
234:         return keccak256(abi.encodePacked(uint32(_blockNumber))); // <= FOUND
235:     }

```
['[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L133-L142)']
```solidity
118:     function _encodeHashEIP712Transaction(Transaction calldata _transaction) private view returns (bytes32) {
119:         bytes32 structHash = keccak256(
120:             abi.encode(
121:                 EIP712_TRANSACTION_TYPE_HASH,
122:                 _transaction.txType,
123:                 _transaction.from,
124:                 _transaction.to,
125:                 _transaction.gasLimit,
126:                 _transaction.gasPerPubdataByteLimit,
127:                 _transaction.maxFeePerGas,
128:                 _transaction.maxPriorityFeePerGas,
129:                 _transaction.paymaster,
130:                 _transaction.nonce,
131:                 _transaction.value,
132:                 EfficientCall.keccak(_transaction.data),
133:                 keccak256(abi.encodePacked(_transaction.factoryDeps)), // <= FOUND
134:                 EfficientCall.keccak(_transaction.paymasterInput)
135:             )
136:         );
137: 
138:         bytes32 domainSeparator = keccak256(
139:             abi.encode(EIP712_DOMAIN_TYPEHASH, keccak256("zkSync"), keccak256("2"), block.chainid)
140:         );
141: 
142:         return keccak256(abi.encodePacked("\x19\x01", domainSeparator, structHash)); // <= FOUND
143:     }

```
['[145](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L145-L145)']
```solidity
138:     function _getL1WithdrawMessage(
139:         address _to,
140:         address _l1Token,
141:         uint256 _amount
142:     ) internal pure returns (bytes memory) {
143:         
144:         
145:         return abi.encodePacked(IL1ERC20Bridge.finalizeWithdrawal.selector, _to, _l1Token, _amount); // <= FOUND
146:     }

```


</details>

## [NonCritical-57] Event emit should emit a parameter

### Resolution 
Events in Solidity offer valuable insight into the contract's execution as they log specific instances of state changes or value transfers. However, if events do not include any parameters, their usefulness can be significantly reduced. Events without parameters can provide limited information, mainly signaling that a specific operation occurred, but lacking the context of what exactly changed. It's generally recommended to include relevant parameters, such as state changes or value modifications, in the emitted events. 

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[139](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L139-L139)']
```solidity
139:         emit Freeze(); // <= FOUND

```
['[149](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L149-L149)']
```solidity
149:         emit Unfreeze(); // <= FOUND

```


</details>

## [NonCritical-58] Overridden function has no body

### Resolution 
In Ethereum Solidity, functions can be overridden, meaning a contract can change the behavior of a function inherited from a base contract. Sometimes, the overriding function might not have a body. This could be due to a variety of reasons. For instance, the overriding function could be setting up a default behavior (like failing with an error) that can be further overridden in derived contracts, or it could be providing an optional hook that's left empty unless certain specific conditions are met.

In such cases, it can be extremely helpful to future developers, auditors, and users of the contract if a NatSpec comment is added to describe the function's purpose and the reason why it does not have a body. NatSpec, short for Natural Specification, is a form of documentation standard in Ethereum used for expressing what a function does in a human-readable format.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L125-L125)']
```solidity
125:     function executeTransactionFromOutside(Transaction calldata _transaction) external payable override {
126:         
127:     }

```


</details>

## [NonCritical-59] Unused structs present

### Resolution 
If these serve no purpose, they should be safely removed

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L51-L51)']
```solidity
51: struct InitializeDataNewChain { // <= FOUND
52:     IVerifier verifier;
53:     VerifierParams verifierParams;
54:     bytes32 l2BootloaderBytecodeHash;
55:     bytes32 l2DefaultAccountBytecodeHash;
56:     uint256 priorityTxMaxGasLimit;
57:     FeeParams feeParams;
58:     address blobVersionedHashRetriever;
59: }

```


</details>

## [NonCritical-60] Empty bytes check is missing

### Resolution 
When developing smart contracts in Solidity, it's crucial to validate the inputs of your functions. This includes ensuring that the bytes parameters are not empty, especially when they represent crucial data such as addresses, identifiers, or raw data that the contract needs to process.

Missing empty bytes checks can lead to unexpected behaviour in your contract. For instance, certain operations might fail, produce incorrect results, or consume unnecessary gas when performed with empty bytes. Moreover, missing input validation can potentially expose your contract to malicious activity, including exploitation of unhandled edge cases.

To mitigate these issues, always validate that bytes parameters are not empty when the logic of your contract requires it.

Num of instances: 98

### Findings 


<details><summary>Click to show findings</summary>

['[176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L176-L176)']
```solidity
176:     function claimFailedDeposit(
177:         address _depositSender,
178:         address _l1Token,
179:         bytes32 _l2TxHash,
180:         uint256 _l2BatchNumber,
181:         uint256 _l2MessageIndex,
182:         uint16 _l2TxNumberInBatch,
183:         bytes32[] calldata _merkleProof
184:     ) external nonReentrant {
185:         uint256 amount = depositAmount[_depositSender][_l1Token][_l2TxHash];
186:         require(amount != 0, "2T"); 
187:         delete depositAmount[_depositSender][_l1Token][_l2TxHash];
188: 
189:         sharedBridge.claimFailedDepositLegacyErc20Bridge(
190:             _depositSender,
191:             _l1Token,
192:             amount,
193:             _l2TxHash,
194:             _l2BatchNumber,
195:             _l2MessageIndex,
196:             _l2TxNumberInBatch,
197:             _merkleProof
198:         );
199:         emit ClaimedFailedDeposit(_depositSender, _l1Token, amount);
200:     }

```
['[208](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L208-L208)']
```solidity
208:     function finalizeWithdrawal(
209:         uint256 _l2BatchNumber,
210:         uint256 _l2MessageIndex,
211:         uint16 _l2TxNumberInBatch,
212:         bytes calldata _message,
213:         bytes32[] calldata _merkleProof
214:     ) external nonReentrant {
215:         require(!isWithdrawalFinalized[_l2BatchNumber][_l2MessageIndex], "pw");
216:         
217: 
218:         (address l1Receiver, address l1Token, uint256 amount) = sharedBridge.finalizeWithdrawalLegacyErc20Bridge(
219:             _l2BatchNumber,
220:             _l2MessageIndex,
221:             _l2TxNumberInBatch,
222:             _message,
223:             _merkleProof
224:         );
225:         emit WithdrawalFinalized(l1Receiver, l1Token, amount);
226:     }

```
['[182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L182-L182)']
```solidity
182:     function bridgehubDeposit(
183:         uint256 _chainId,
184:         address _prevMsgSender,
185:         uint256, 
186:         bytes calldata _data
187:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) {
188:         require(l2BridgeAddress[_chainId] != address(0), "ShB l2 bridge not deployed");
189: 
190:         (address _l1Token, uint256 _depositAmount, address _l2Receiver) = abi.decode(
191:             _data,
192:             (address, uint256, address)
193:         );
194:         require(_l1Token != l1WethAddress, "ShB: WETH deposit not supported");
195:         require(bridgehub.baseToken(_chainId) != _l1Token, "ShB: baseToken deposit not supported");
196: 
197:         uint256 amount;
198:         if (_l1Token == ETH_TOKEN_ADDRESS) {
199:             amount = msg.value;
200:             require(_depositAmount == 0, "ShB wrong withdraw amount");
201:         } else {
202:             require(msg.value == 0, "ShB m.v > 0 for BH d.it 2");
203:             amount = _depositAmount;
204: 
205:             uint256 withdrawAmount = _depositFunds(_prevMsgSender, IERC20(_l1Token), _depositAmount);
206:             require(withdrawAmount == _depositAmount, "5T"); 
207:         }
208:         require(amount != 0, "6T"); 
209: 
210:         bytes32 txDataHash = keccak256(abi.encode(_prevMsgSender, _l1Token, amount));
211:         if (!hyperbridgingEnabled[_chainId]) {
212:             chainBalance[_chainId][_l1Token] += amount;
213:         }
214: 
215:         {
216:             
217:             bytes memory l2TxCalldata = _getDepositL2Calldata(_prevMsgSender, _l2Receiver, _l1Token, amount);
218: 
219:             request = L2TransactionRequestTwoBridgesInner({
220:                 magicValue: TWO_BRIDGES_MAGIC_VALUE,
221:                 l2Contract: l2BridgeAddress[_chainId],
222:                 l2Calldata: l2TxCalldata,
223:                 factoryDeps: new bytes[](0),
224:                 txDataHash: txDataHash
225:             });
226:         }
227:         emit BridgehubDepositInitiated(_chainId, txDataHash, _prevMsgSender, _l2Receiver, _l1Token, amount);
228:     }

```
['[232](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L232-L232)']
```solidity
232:     function bridgehubConfirmL2Transaction(
233:         uint256 _chainId,
234:         bytes32 _txDataHash,
235:         bytes32 _txHash
236:     ) external override onlyBridgehub {
237:         require(depositHappened[_chainId][_txHash] == 0x00, "ShB tx hap");
238:         depositHappened[_chainId][_txHash] = _txDataHash;
239:         emit BridgehubDepositFinalized(_chainId, _txDataHash, _txHash);
240:     }

```
['[277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L277-L277)']
```solidity
277:     function claimFailedDeposit(
278:         uint256 _chainId,
279:         address _depositSender,
280:         address _l1Token,
281:         uint256 _amount,
282:         bytes32 _l2TxHash,
283:         uint256 _l2BatchNumber,
284:         uint256 _l2MessageIndex,
285:         uint16 _l2TxNumberInBatch,
286:         bytes32[] calldata _merkleProof
287:     ) external override {
288:         _claimFailedDeposit(
289:             false,
290:             _chainId,
291:             _depositSender,
292:             _l1Token,
293:             _amount,
294:             _l2TxHash,
295:             _l2BatchNumber,
296:             _l2MessageIndex,
297:             _l2TxNumberInBatch,
298:             _merkleProof
299:         );
300:     }

```
['[303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L303-L303)']
```solidity
303:     function _claimFailedDeposit(
304:         bool _checkedInLegacyBridge,
305:         uint256 _chainId,
306:         address _depositSender,
307:         address _l1Token,
308:         uint256 _amount,
309:         bytes32 _l2TxHash,
310:         uint256 _l2BatchNumber,
311:         uint256 _l2MessageIndex,
312:         uint16 _l2TxNumberInBatch,
313:         bytes32[] calldata _merkleProof
314:     ) internal nonReentrant {
315:         {
316:             bool proofValid = bridgehub.proveL1ToL2TransactionStatus(
317:                 _chainId,
318:                 _l2TxHash,
319:                 _l2BatchNumber,
320:                 _l2MessageIndex,
321:                 _l2TxNumberInBatch,
322:                 _merkleProof,
323:                 TxStatus.Failure
324:             );
325:             require(proofValid, "yn");
326:         }
327:         require(_amount > 0, "y1");
328: 
329:         {
330:             bool notCheckedInLegacyBridgeOrWeCanCheckDeposit;
331:             {
332:                 
333:                 bool weCanCheckDepositHere = !_isEraLegacyWithdrawal(_chainId, _l2BatchNumber);
334:                 
335:                 
336:                 
337:                 notCheckedInLegacyBridgeOrWeCanCheckDeposit = (!_checkedInLegacyBridge) || weCanCheckDepositHere;
338:             }
339:             if (notCheckedInLegacyBridgeOrWeCanCheckDeposit) {
340:                 bytes32 dataHash = depositHappened[_chainId][_l2TxHash];
341:                 bytes32 txDataHash = keccak256(abi.encode(_depositSender, _l1Token, _amount));
342:                 require(dataHash == txDataHash, "ShB: d.it not hap");
343:                 delete depositHappened[_chainId][_l2TxHash];
344:             }
345:         }
346: 
347:         if (!hyperbridgingEnabled[_chainId]) {
348:             
349:             require(chainBalance[_chainId][_l1Token] >= _amount, "ShB n funds");
350:             chainBalance[_chainId][_l1Token] -= _amount;
351:         }
352: 
353:         
354:         if (_l1Token == ETH_TOKEN_ADDRESS) {
355:             bool callSuccess;
356:             
357:             assembly {
358:                 callSuccess := call(gas(), _depositSender, _amount, 0, 0, 0, 0)
359:             }
360:             require(callSuccess, "ShB: claimFailedDeposit failed");
361:         } else {
362:             IERC20(_l1Token).safeTransfer(_depositSender, _amount);
363:             
364:             
365:         }
366: 
367:         emit ClaimedFailedDepositSharedBridge(_chainId, _depositSender, _l1Token, _amount);
368:     }

```
['[385](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L385-L385)']
```solidity
385:     function finalizeWithdrawal(
386:         uint256 _chainId,
387:         uint256 _l2BatchNumber,
388:         uint256 _l2MessageIndex,
389:         uint16 _l2TxNumberInBatch,
390:         bytes calldata _message,
391:         bytes32[] calldata _merkleProof
392:     ) external override {
393:         
394:         
395:         if (_isEraLegacyWithdrawal(_chainId, _l2BatchNumber)) {
396:             require(!legacyBridge.isWithdrawalFinalized(_l2BatchNumber, _l2MessageIndex), "ShB: legacy withdrawal");
397:         }
398:         _finalizeWithdrawal(_chainId, _l2BatchNumber, _l2MessageIndex, _l2TxNumberInBatch, _message, _merkleProof);
399:     }

```
['[409](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L409-L409)']
```solidity
409:     function _finalizeWithdrawal(
410:         uint256 _chainId,
411:         uint256 _l2BatchNumber,
412:         uint256 _l2MessageIndex,
413:         uint16 _l2TxNumberInBatch,
414:         bytes calldata _message,
415:         bytes32[] calldata _merkleProof
416:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount) {
417:         require(!isWithdrawalFinalized[_chainId][_l2BatchNumber][_l2MessageIndex], "Withdrawal is already finalized");
418:         isWithdrawalFinalized[_chainId][_l2BatchNumber][_l2MessageIndex] = true;
419: 
420:         
421:         if (_isEraLegacyWithdrawal(_chainId, _l2BatchNumber)) {
422:             
423:             bool alreadyFinalized = IGetters(ERA_DIAMOND_PROXY).isEthWithdrawalFinalized(
424:                 _l2BatchNumber,
425:                 _l2MessageIndex
426:             );
427:             require(!alreadyFinalized, "Withdrawal is already finalized 2");
428:         }
429: 
430:         MessageParams memory messageParams = MessageParams({
431:             l2BatchNumber: _l2BatchNumber,
432:             l2MessageIndex: _l2MessageIndex,
433:             l2TxNumberInBatch: _l2TxNumberInBatch
434:         });
435:         (l1Receiver, l1Token, amount) = _checkWithdrawal(_chainId, messageParams, _message, _merkleProof);
436: 
437:         if (!hyperbridgingEnabled[_chainId]) {
438:             
439:             require(chainBalance[_chainId][l1Token] >= amount, "ShB not enough funds 2"); 
440:             chainBalance[_chainId][l1Token] -= amount;
441:         }
442: 
443:         if (l1Token == ETH_TOKEN_ADDRESS) {
444:             bool callSuccess;
445:             
446:             assembly {
447:                 callSuccess := call(gas(), l1Receiver, amount, 0, 0, 0, 0)
448:             }
449:             require(callSuccess, "ShB: withdraw failed");
450:         } else {
451:             
452:             IERC20(l1Token).safeTransfer(l1Receiver, amount);
453:         }
454:         emit WithdrawalFinalizedSharedBridge(_chainId, l1Receiver, l1Token, amount);
455:     }

```
['[458](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L458-L458)']
```solidity
458:     function _checkWithdrawal(
459:         uint256 _chainId,
460:         MessageParams memory _messageParams,
461:         bytes calldata _message,
462:         bytes32[] calldata _merkleProof
463:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount) {
464:         (l1Receiver, l1Token, amount) = _parseL2WithdrawalMessage(_chainId, _message);
465:         L2Message memory l2ToL1Message;
466:         {
467:             bool baseTokenWithdrawal = (l1Token == bridgehub.baseToken(_chainId));
468:             address l2Sender = baseTokenWithdrawal ? L2_BASE_TOKEN_SYSTEM_CONTRACT_ADDR : l2BridgeAddress[_chainId];
469: 
470:             l2ToL1Message = L2Message({
471:                 txNumberInBatch: _messageParams.l2TxNumberInBatch,
472:                 sender: l2Sender,
473:                 data: _message
474:             });
475:         }
476: 
477:         bool success = bridgehub.proveL2MessageInclusion(
478:             _chainId,
479:             _messageParams.l2BatchNumber,
480:             _messageParams.l2MessageIndex,
481:             l2ToL1Message,
482:             _merkleProof
483:         );
484:         require(success, "ShB withd w proof"); 
485:     }

```
['[615](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L615-L615)']
```solidity
615:     function finalizeWithdrawalLegacyErc20Bridge(
616:         uint256 _l2BatchNumber,
617:         uint256 _l2MessageIndex,
618:         uint16 _l2TxNumberInBatch,
619:         bytes calldata _message,
620:         bytes32[] calldata _merkleProof
621:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount) {
622:         (l1Receiver, l1Token, amount) = _finalizeWithdrawal(
623:             ERA_CHAIN_ID,
624:             _l2BatchNumber,
625:             _l2MessageIndex,
626:             _l2TxNumberInBatch,
627:             _message,
628:             _merkleProof
629:         );
630:     }

```
['[644](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L644-L644)']
```solidity
644:     function claimFailedDepositLegacyErc20Bridge(
645:         address _depositSender,
646:         address _l1Token,
647:         uint256 _amount,
648:         bytes32 _l2TxHash,
649:         uint256 _l2BatchNumber,
650:         uint256 _l2MessageIndex,
651:         uint16 _l2TxNumberInBatch,
652:         bytes32[] calldata _merkleProof
653:     ) external override onlyLegacyBridge {
654:         _claimFailedDeposit(
655:             true,
656:             ERA_CHAIN_ID,
657:             _depositSender,
658:             _l1Token,
659:             _amount,
660:             _l2TxHash,
661:             _l2BatchNumber,
662:             _l2MessageIndex,
663:             _l2TxNumberInBatch,
664:             _merkleProof
665:         );
666:     }

```
['[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L114)']
```solidity
114:     function createNewChain(
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, 
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {
122:         require(_chainId != 0, "Bridgehub: chainId cannot be 0");
123:         require(_chainId <= type(uint48).max, "Bridgehub: chainId too large");
124: 
125:         require(
126:             stateTransitionManagerIsRegistered[_stateTransitionManager],
127:             "Bridgehub: state transition not registered"
128:         );
129:         require(tokenIsRegistered[_baseToken], "Bridgehub: token not registered");
130:         require(address(sharedBridge) != address(0), "Bridgehub: weth bridge not set");
131: 
132:         require(stateTransitionManager[_chainId] == address(0), "Bridgehub: chainId already registered");
133: 
134:         stateTransitionManager[_chainId] = _stateTransitionManager;
135:         baseToken[_chainId] = _baseToken;
136: 
137:         IStateTransitionManager(_stateTransitionManager).createNewChain(
138:             _chainId,
139:             _baseToken,
140:             address(sharedBridge),
141:             _admin,
142:             _initData
143:         );
144: 
145:         emit NewChain(_chainId, _stateTransitionManager, _admin);
146:         return _chainId;
147:     }

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L152-L152)']
```solidity
152:     function proveL2MessageInclusion(
153:         uint256 _chainId,
154:         uint256 _batchNumber,
155:         uint256 _index,
156:         L2Message calldata _message,
157:         bytes32[] calldata _proof
158:     ) external view override returns (bool) {
159:         address stateTransition = getStateTransition(_chainId);
160:         return IZkSyncStateTransition(stateTransition).proveL2MessageInclusion(_batchNumber, _index, _message, _proof);
161:     }

```
['[164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L164-L164)']
```solidity
164:     function proveL2LogInclusion(
165:         uint256 _chainId,
166:         uint256 _batchNumber,
167:         uint256 _index,
168:         L2Log memory _log,
169:         bytes32[] calldata _proof
170:     ) external view override returns (bool) {
171:         address stateTransition = getStateTransition(_chainId);
172:         return IZkSyncStateTransition(stateTransition).proveL2LogInclusion(_batchNumber, _index, _log, _proof);
173:     }

```
['[176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L176-L176)']
```solidity
176:     function proveL1ToL2TransactionStatus(
177:         uint256 _chainId,
178:         bytes32 _l2TxHash,
179:         uint256 _l2BatchNumber,
180:         uint256 _l2MessageIndex,
181:         uint16 _l2TxNumberInBatch,
182:         bytes32[] calldata _merkleProof,
183:         TxStatus _status
184:     ) external view override returns (bool) {
185:         address stateTransition = getStateTransition(_chainId);
186:         return
187:             IZkSyncStateTransition(stateTransition).proveL1ToL2TransactionStatus(
188:                 _l2TxHash,
189:                 _l2BatchNumber,
190:                 _l2MessageIndex,
191:                 _l2TxNumberInBatch,
192:                 _merkleProof,
193:                 _status
194:             );
195:     }

```
['[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L84-L84)']
```solidity
84:     function isOperation(bytes32 _id) public view returns (bool) {
85:         return getOperationState(_id) != OperationState.Unset;
86:     }

```
['[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L89-L89)']
```solidity
89:     function isOperationPending(bytes32 _id) public view returns (bool) {
90:         OperationState state = getOperationState(_id);
91:         return state == OperationState.Waiting || state == OperationState.Ready;
92:     }

```
['[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L95-L95)']
```solidity
95:     function isOperationReady(bytes32 _id) public view returns (bool) {
96:         return getOperationState(_id) == OperationState.Ready;
97:     }

```
['[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L100-L100)']
```solidity
100:     function isOperationDone(bytes32 _id) public view returns (bool) {
101:         return getOperationState(_id) == OperationState.Done;
102:     }

```
['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L105-L105)']
```solidity
105:     function getOperationState(bytes32 _id) public view returns (OperationState) {
106:         uint256 timestamp = timestamps[_id];
107:         if (timestamp == 0) {
108:             return OperationState.Unset;
109:         } else if (timestamp == EXECUTED_PROPOSAL_TIMESTAMP) {
110:             return OperationState.Done;
111:         } else if (timestamp > block.timestamp) {
112:             return OperationState.Waiting;
113:         } else {
114:             return OperationState.Ready;
115:         }
116:     }

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L142-L142)']
```solidity
142:     function scheduleShadow(bytes32 _id, uint256 _delay) external onlyOwner {
143:         _schedule(_id, _delay);
144:         emit ShadowOperationScheduled(_id, _delay);
145:     }

```
['[154](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L154-L154)']
```solidity
154:     function cancel(bytes32 _id) external onlyOwner {
155:         require(isOperationPending(_id), "Operation must be pending");
156:         delete timestamps[_id];
157:         emit OperationCancelled(_id);
158:     }

```
['[215](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L215-L215)']
```solidity
215:     function _schedule(bytes32 _id, uint256 _delay) internal {
216:         require(!isOperation(_id), "Operation with this proposal id already exists");
217:         require(_delay >= minDelay, "Proposed delay is less than minimum delay");
218: 
219:         timestamps[_id] = block.timestamp + _delay;
220:     }

```
['[239](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L239-L239)']
```solidity
239:     function _checkPredecessorDone(bytes32 _predecessorId) internal view {
240:         require(_predecessorId == bytes32(0) || isOperationDone(_predecessorId), "Predecessor operation not completed");
241:     }

```
['[239](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L239-L239)']
```solidity
239:     function createNewChain(
240:         uint256 _chainId,
241:         address _baseToken,
242:         address _sharedBridge,
243:         address _admin,
244:         bytes calldata _diamondCut
245:     ) external onlyBridgehub {
246:         if (stateTransition[_chainId] != address(0)) {
247:             
248:             return;
249:         }
250: 
251:         
252:         Diamond.DiamondCutData memory diamondCut = abi.decode(_diamondCut, (Diamond.DiamondCutData));
253: 
254:         
255:         bytes32 cutHashInput = keccak256(_diamondCut);
256:         require(cutHashInput == initialCutHash, "StateTransition: initial cutHash mismatch");
257: 
258:         
259:         bytes memory initData;
260:         
261:         initData = bytes.concat(
262:             IDiamondInit.initialize.selector,
263:             bytes32(_chainId),
264:             bytes32(uint256(uint160(bridgehub))),
265:             bytes32(uint256(uint160(address(this)))),
266:             bytes32(uint256(protocolVersion)),
267:             bytes32(uint256(uint160(_admin))),
268:             bytes32(uint256(uint160(validatorTimelock))),
269:             bytes32(uint256(uint160(_baseToken))),
270:             bytes32(uint256(uint160(_sharedBridge))),
271:             bytes32(storedBatchZero),
272:             diamondCut.initCalldata
273:         );
274: 
275:         diamondCut.initCalldata = initData;
276:         
277:         DiamondProxy stateTransitionContract = new DiamondProxy{salt: bytes32(0)}(block.chainid, diamondCut);
278: 
279:         
280:         address stateTransitionAddress = address(stateTransitionContract);
281: 
282:         stateTransition[_chainId] = stateTransitionAddress;
283: 
284:         
285:         _setChainIdUpgrade(_chainId, stateTransitionAddress);
286: 
287:         emit StateTransitionNewChain(_chainId, stateTransitionAddress);
288:     }

```
['[453](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L453-L453)']
```solidity
453:     function _getBatchProofPublicInput(
454:         bytes32 _prevBatchCommitment,
455:         bytes32 _currentBatchCommitment,
456:         VerifierParams memory _verifierParams
457:     ) internal pure returns (uint256) {
458:         return
459:             uint256(
460:                 keccak256(
461:                     abi.encodePacked(
462:                         _prevBatchCommitment,
463:                         _currentBatchCommitment,
464:                         _verifierParams.recursionNodeLevelVkHash,
465:                         _verifierParams.recursionLeafLevelVkHash
466:                     )
467:                 )
468:             ) >> PUBLIC_INPUT_SHIFT;
469:     }

```
['[500](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L500-L500)']
```solidity
500:     function _createBatchCommitment(
501:         CommitBatchInfo calldata _newBatchData,
502:         bytes32 _stateDiffHash,
503:         bytes32[] memory _blobCommitments,
504:         bytes32[] memory _blobHashes
505:     ) internal view returns (bytes32) {
506:         bytes32 passThroughDataHash = keccak256(_batchPassThroughData(_newBatchData));
507:         bytes32 metadataHash = keccak256(_batchMetaParameters());
508:         bytes32 auxiliaryOutputHash = keccak256(
509:             _batchAuxiliaryOutput(_newBatchData, _stateDiffHash, _blobCommitments, _blobHashes)
510:         );
511: 
512:         return keccak256(abi.encode(passThroughDataHash, metadataHash, auxiliaryOutputHash));
513:     }

```
['[605](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L605-L605)']
```solidity
605:     function _pointEvaluationPrecompile(
606:         bytes32 _versionedHash,
607:         bytes32 _openingPoint,
608:         bytes calldata _openingValueCommitmentProof
609:     ) internal view {
610:         bytes memory precompileInput = abi.encodePacked(_versionedHash, _openingPoint, _openingValueCommitmentProof);
611: 
612:         (bool success, bytes memory data) = POINT_EVALUATION_PRECOMPILE_ADDR.staticcall(precompileInput);
613: 
614:         
615:         
616:         require(success, "failed to call point evaluation precompile");
617:         (, uint256 result) = abi.decode(data, (uint256, uint256));
618:         require(result == BLS_MODULUS, "precompile unexpected output");
619:     }

```
['[181](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L181-L181)']
```solidity
181:     function isFunctionFreezable(bytes4 _selector) external view returns (bool) {
182:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage();
183:         require(ds.selectorToFacet[_selector].facetAddress != address(0), "g2");
184:         return ds.selectorToFacet[_selector].isFreezable;
185:     }

```
['[229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L229-L229)']
```solidity
229:     function facetAddress(bytes4 _selector) external view returns (address) {
230:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage();
231:         return ds.selectorToFacet[_selector].facetAddress;
232:     }

```
['[54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L54-L54)']
```solidity
54:     function proveL2MessageInclusion(
55:         uint256 _batchNumber,
56:         uint256 _index,
57:         L2Message memory _message,
58:         bytes32[] calldata _proof
59:     ) public view returns (bool) {
60:         return _proveL2LogInclusion(_batchNumber, _index, _L2MessageToLog(_message), _proof);
61:     }

```
['[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L64-L64)']
```solidity
64:     function proveL2LogInclusion(
65:         uint256 _batchNumber,
66:         uint256 _index,
67:         L2Log memory _log,
68:         bytes32[] calldata _proof
69:     ) external view returns (bool) {
70:         return _proveL2LogInclusion(_batchNumber, _index, _log, _proof);
71:     }

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L74-L74)']
```solidity
74:     function proveL1ToL2TransactionStatus(
75:         bytes32 _l2TxHash,
76:         uint256 _l2BatchNumber,
77:         uint256 _l2MessageIndex,
78:         uint16 _l2TxNumberInBatch,
79:         bytes32[] calldata _merkleProof,
80:         TxStatus _status
81:     ) public view returns (bool) {
82:         
83:         
84:         
85:         
86:         
87:         
88:         
89:         
90:         
91:         
92:         L2Log memory l2Log = L2Log({
93:             l2ShardId: 0,
94:             isService: true,
95:             txNumberInBatch: _l2TxNumberInBatch,
96:             sender: L2_BOOTLOADER_ADDRESS,
97:             key: _l2TxHash,
98:             value: bytes32(uint256(_status))
99:         });
100:         return _proveL2LogInclusion(_l2BatchNumber, _l2MessageIndex, l2Log, _merkleProof);
101:     }

```
['[104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L104-L104)']
```solidity
104:     function _proveL2LogInclusion(
105:         uint256 _batchNumber,
106:         uint256 _index,
107:         L2Log memory _log,
108:         bytes32[] calldata _proof
109:     ) internal view returns (bool) {
110:         require(_batchNumber <= s.totalBatchesExecuted, "xx");
111: 
112:         bytes32 hashedLog = keccak256(
113:             abi.encodePacked(_log.l2ShardId, _log.isService, _log.txNumberInBatch, _log.sender, _log.key, _log.value)
114:         );
115:         
116:         
117:         require(hashedLog != L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH, "tw");
118: 
119:         
120:         
121:         
122: 
123:         bytes32 calculatedRootHash = Merkle.calculateRoot(_proof, _index, hashedLog);
124:         bytes32 actualRootHash = s.l2LogsRootHashes[_batchNumber];
125: 
126:         return actualRootHash == calculatedRootHash;
127:     }

```
['[178](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L178-L178)']
```solidity
178:     function finalizeEthWithdrawal(
179:         uint256 _l2BatchNumber,
180:         uint256 _l2MessageIndex,
181:         uint16 _l2TxNumberInBatch,
182:         bytes calldata _message,
183:         bytes32[] calldata _merkleProof
184:     ) external nonReentrant {
185:         require(s.chainId == ERA_CHAIN_ID, "finalizeEthWithdrawal only available for Era on mailbox");
186:         IL1SharedBridge(s.baseTokenBridge).finalizeWithdrawal(
187:             ERA_CHAIN_ID,
188:             _l2BatchNumber,
189:             _l2MessageIndex,
190:             _l2TxNumberInBatch,
191:             _message,
192:             _merkleProof
193:         );
194:     }

```
['[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L92-L92)']
```solidity
92:     function _setL2DefaultAccountBytecodeHash(bytes32 _l2DefaultAccountBytecodeHash) private {
93:         if (_l2DefaultAccountBytecodeHash == bytes32(0)) {
94:             return;
95:         }
96: 
97:         L2ContractHelper.validateBytecodeHash(_l2DefaultAccountBytecodeHash);
98: 
99:         
100:         bytes32 previousDefaultAccountBytecodeHash = s.l2DefaultAccountBytecodeHash;
101: 
102:         
103:         s.l2DefaultAccountBytecodeHash = _l2DefaultAccountBytecodeHash;
104:         emit NewL2DefaultAccountBytecodeHash(previousDefaultAccountBytecodeHash, _l2DefaultAccountBytecodeHash);
105:     }

```
['[109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L109-L109)']
```solidity
109:     function _setL2BootloaderBytecodeHash(bytes32 _l2BootloaderBytecodeHash) private {
110:         if (_l2BootloaderBytecodeHash == bytes32(0)) {
111:             return;
112:         }
113: 
114:         L2ContractHelper.validateBytecodeHash(_l2BootloaderBytecodeHash);
115: 
116:         
117:         bytes32 previousBootloaderBytecodeHash = s.l2BootloaderBytecodeHash;
118: 
119:         
120:         s.l2BootloaderBytecodeHash = _l2BootloaderBytecodeHash;
121:         emit NewL2BootloaderBytecodeHash(previousBootloaderBytecodeHash, _l2BootloaderBytecodeHash);
122:     }

```
['[171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L171-L171)']
```solidity
171:     function _setBaseSystemContracts(bytes32 _bootloaderHash, bytes32 _defaultAccountHash) internal {
172:         _setL2BootloaderBytecodeHash(_bootloaderHash);
173:         _setL2DefaultAccountBytecodeHash(_defaultAccountHash);
174:     }

```
['[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L90-L90)']
```solidity
90:     function sendMessageToL1(bytes memory _message) internal returns (bytes32) {
91:         return L2_MESSENGER.sendToL1(_message);
92:     }

```
['[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L101-L101)']
```solidity
101:     function computeCreate2Address(
102:         address _sender,
103:         bytes32 _salt,
104:         bytes32 _bytecodeHash,
105:         bytes32 _constructorInputHash
106:     ) internal pure returns (address) {
107:         bytes32 senderBytes = bytes32(uint256(uint160(_sender)));
108:         bytes32 data = keccak256(
109:             bytes.concat(CREATE2_PREFIX, senderBytes, _salt, _bytecodeHash, _constructorInputHash)
110:         );
111: 
112:         return address(uint160(uint256(data)));
113:     }

```
['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L35-L35)']
```solidity
35:     function storeAccountConstructingCodeHash(address _address, bytes32 _hash) external override onlyDeployer {
36:         
37:         require(Utils.isContractConstructing(_hash), "Code hash is not for a contract on constructor");
38:         _storeCodeHash(_address, _hash);
39:     }

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L46-L46)']
```solidity
46:     function storeAccountConstructedCodeHash(address _address, bytes32 _hash) external override onlyDeployer {
47:         
48:         require(Utils.isContractConstructed(_hash), "Code hash is not for a constructed contract");
49:         _storeCodeHash(_address, _hash);
50:     }

```
['[68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L68-L68)']
```solidity
68:     function _storeCodeHash(address _address, bytes32 _hash) internal {
69:         uint256 addressAsKey = uint256(uint160(_address));
70:         assembly {
71:             sstore(addressAsKey, _hash)
72:         }
73:     }

```
['[197](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L197-L197)']
```solidity
197:     function _decodeRawBytecode(
198:         bytes calldata _rawCompressedData
199:     ) internal pure returns (bytes calldata dictionary, bytes calldata encodedData) {
200:         unchecked {
201:             
202:             uint256 dictionaryLen = uint256(_rawCompressedData.readUint16(0));
203:             dictionary = _rawCompressedData[2:2 + dictionaryLen * 8];
204:             encodedData = _rawCompressedData[2 + dictionaryLen * 8:];
205:         }
206:     }

```
['[220](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L220-L220)']
```solidity
220:     function _verifyValueCompression(
221:         uint256 _initialValue,
222:         uint256 _finalValue,
223:         uint256 _operation,
224:         bytes calldata _compressedValue
225:     ) internal pure {
226:         uint256 convertedValue = _sliceToUint256(_compressedValue);
227: 
228:         unchecked {
229:             if (_operation == 0 || _operation == 3) {
230:                 require(convertedValue == _finalValue, "transform or no compression: compressed and final mismatch");
231:             } else if (_operation == 1) {
232:                 require(
233:                     _initialValue + convertedValue == _finalValue,
234:                     "add: initial plus converted not equal to final"
235:                 );
236:             } else if (_operation == 2) {
237:                 require(
238:                     _initialValue - convertedValue == _finalValue,
239:                     "sub: initial minus converted not equal to final"
240:                 );
241:             } else {
242:                 revert("unsupported operation");
243:             }
244:         }
245:     }

```
['[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L95-L95)']
```solidity
95:     function getNewAddressCreate2(
96:         address _sender,
97:         bytes32 _bytecodeHash,
98:         bytes32 _salt,
99:         bytes calldata _input
100:     ) public view override returns (address newAddress) {
101:         
102:         
103:         bytes32 constructorInputHash = EfficientCall.keccak(_input);
104: 
105:         bytes32 hash = keccak256(
106:             bytes.concat(CREATE2_PREFIX, bytes32(uint256(uint160(_sender))), _salt, _bytecodeHash, constructorInputHash)
107:         );
108: 
109:         newAddress = address(uint160(uint256(hash)));
110:     }

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L132-L132)']
```solidity
132:     function create2(
133:         bytes32 _salt,
134:         bytes32 _bytecodeHash,
135:         bytes calldata _input
136:     ) external payable override returns (address) {
137:         return create2Account(_salt, _bytecodeHash, _input, AccountAbstractionVersion.None);
138:     }

```
['[147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L147-L147)']
```solidity
147:     function create(
148:         bytes32 _salt,
149:         bytes32 _bytecodeHash,
150:         bytes calldata _input
151:     ) external payable override returns (address) {
152:         return createAccount(_salt, _bytecodeHash, _input, AccountAbstractionVersion.None);
153:     }

```
['[162](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L162-L162)']
```solidity
162:     function create2Account(
163:         bytes32 _salt,
164:         bytes32 _bytecodeHash,
165:         bytes calldata _input,
166:         AccountAbstractionVersion _aaVersion
167:     ) public payable override onlySystemCall returns (address) {
168:         NONCE_HOLDER_SYSTEM_CONTRACT.incrementDeploymentNonce(msg.sender);
169:         address newAddress = getNewAddressCreate2(msg.sender, _bytecodeHash, _salt, _input);
170: 
171:         _nonSystemDeployOnAddress(_bytecodeHash, newAddress, _aaVersion, _input);
172: 
173:         return newAddress;
174:     }

```
['[182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L182-L182)']
```solidity
182:     function createAccount(
183:         bytes32, 
184:         bytes32 _bytecodeHash,
185:         bytes calldata _input,
186:         AccountAbstractionVersion _aaVersion
187:     ) public payable override onlySystemCall returns (address) {
188:         uint256 senderNonce = NONCE_HOLDER_SYSTEM_CONTRACT.incrementDeploymentNonce(msg.sender);
189:         address newAddress = getNewAddressCreate(msg.sender, senderNonce);
190: 
191:         _nonSystemDeployOnAddress(_bytecodeHash, newAddress, _aaVersion, _input);
192: 
193:         return newAddress;
194:     }

```
['[258](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L258-L258)']
```solidity
258:     function _nonSystemDeployOnAddress(
259:         bytes32 _bytecodeHash,
260:         address _newAddress,
261:         AccountAbstractionVersion _aaVersion,
262:         bytes calldata _input
263:     ) internal {
264:         require(_bytecodeHash != bytes32(0x0), "BytecodeHash cannot be zero");
265:         require(uint160(_newAddress) > MAX_SYSTEM_CONTRACT_ADDRESS, "Can not deploy contracts in kernel space");
266: 
267:         
268:         require(
269:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.getCodeHash(uint256(uint160(_newAddress))) == 0x0,
270:             "Code hash is non-zero"
271:         );
272:         
273:         require(NONCE_HOLDER_SYSTEM_CONTRACT.getRawNonce(_newAddress) == 0x00, "Account is occupied");
274: 
275:         _performDeployOnAddress(_bytecodeHash, _newAddress, _aaVersion, _input);
276:     }

```
['[283](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L283-L283)']
```solidity
283:     function _performDeployOnAddress(
284:         bytes32 _bytecodeHash,
285:         address _newAddress,
286:         AccountAbstractionVersion _aaVersion,
287:         bytes calldata _input
288:     ) internal {
289:         _ensureBytecodeIsKnown(_bytecodeHash);
290: 
291:         AccountInfo memory newAccountInfo;
292:         newAccountInfo.supportedAAVersion = _aaVersion;
293:         
294:         newAccountInfo.nonceOrdering = AccountNonceOrdering.Sequential;
295:         _storeAccountInfo(_newAddress, newAccountInfo);
296: 
297:         _constructContract(msg.sender, _newAddress, _bytecodeHash, _input, false, true);
298:     }

```
['[301](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L301-L301)']
```solidity
301:     function _ensureBytecodeIsKnown(bytes32 _bytecodeHash) internal view {
302:         uint256 knownCodeMarker = KNOWN_CODE_STORAGE_CONTRACT.getMarker(_bytecodeHash);
303:         require(knownCodeMarker > 0, "The code hash is not known");
304:     }

```
['[309](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L309-L309)']
```solidity
309:     function _storeConstructingByteCodeHashOnAddress(address _newAddress, bytes32 _bytecodeHash) internal {
310:         
311:         bytes32 constructingBytecodeHash = Utils.constructingBytecodeHash(_bytecodeHash);
312:         ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.storeAccountConstructingCodeHash(_newAddress, constructingBytecodeHash);
313:     }

```
['[321](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L321-L321)']
```solidity
321:     function _constructContract(
322:         address _sender,
323:         address _newAddress,
324:         bytes32 _bytecodeHash,
325:         bytes calldata _input,
326:         bool _isSystem,
327:         bool _callConstructor
328:     ) internal {
329:         uint256 value = msg.value;
330:         if (_callConstructor) {
331:             
332:             if (value > 0) {
333:                 BASE_TOKEN_SYSTEM_CONTRACT.transferFromTo(address(this), _newAddress, value);
334:             }
335:             
336:             _storeConstructingByteCodeHashOnAddress(_newAddress, _bytecodeHash);
337: 
338:             
339:             if (value > 0) {
340:                 
341:                 SystemContractHelper.setValueForNextFarCall(uint128(value));
342:             }
343:             bytes memory returnData = EfficientCall.mimicCall(gasleft(), _newAddress, _input, _sender, true, _isSystem);
344:             
345:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.markAccountCodeHashAsConstructed(_newAddress);
346:             
347:             ImmutableData[] memory immutables = abi.decode(returnData, (ImmutableData[]));
348:             IMMUTABLE_SIMULATOR_SYSTEM_CONTRACT.setImmutables(_newAddress, immutables);
349:         } else {
350:             require(value == 0, "The value must be zero if we do not call the constructor");
351:             
352:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.storeAccountConstructedCodeHash(_newAddress, _bytecodeHash);
353:         }
354: 
355:         emit ContractDeployed(_sender, _bytecodeHash, _newAddress);
356:     }

```
['[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L67-L67)']
```solidity
67:     function validateTransaction(
68:         bytes32, 
69:         bytes32 _suggestedSignedHash,
70:         Transaction calldata _transaction
71:     ) external payable override ignoreNonBootloader ignoreInDelegateCall returns (bytes4 magic) {
72:         magic = _validateTransaction(_suggestedSignedHash, _transaction);
73:     }

```
['[78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L78-L78)']
```solidity
78:     function _validateTransaction(
79:         bytes32 _suggestedSignedHash,
80:         Transaction calldata _transaction
81:     ) internal returns (bytes4 magic) {
82:         
83:         SystemContractsCaller.systemCallWithPropagatedRevert(
84:             uint32(gasleft()),
85:             address(NONCE_HOLDER_SYSTEM_CONTRACT),
86:             0,
87:             abi.encodeCall(INonceHolder.incrementMinNonceIfEquals, (_transaction.nonce))
88:         );
89: 
90:         
91:         
92:         
93:         
94:         bytes32 txHash = _suggestedSignedHash != bytes32(0) ? _suggestedSignedHash : _transaction.encodeHash();
95: 
96:         
97:         
98:         
99:         uint256 totalRequiredBalance = _transaction.totalRequiredBalance();
100:         require(totalRequiredBalance <= address(this).balance, "Not enough balance for fee + value");
101: 
102:         if (_isValidSignature(txHash, _transaction.signature)) {
103:             magic = ACCOUNT_VALIDATION_SUCCESS_MAGIC;
104:         }
105:     }

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L112-L112)']
```solidity
112:     function executeTransaction(
113:         bytes32, 
114:         bytes32, 
115:         Transaction calldata _transaction
116:     ) external payable override ignoreNonBootloader ignoreInDelegateCall {
117:         _execute(_transaction);
118:     }

```
['[196](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L196-L196)']
```solidity
196:     function payForTransaction(
197:         bytes32, 
198:         bytes32, 
199:         Transaction calldata _transaction
200:     ) external payable ignoreNonBootloader ignoreInDelegateCall {
201:         bool success = _transaction.payToTheBootloader();
202:         require(success, "Failed to pay the fee to the operator");
203:     }

```
['[212](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L212-L212)']
```solidity
212:     function prepareForPaymaster(
213:         bytes32, 
214:         bytes32, 
215:         Transaction calldata _transaction
216:     ) external payable ignoreNonBootloader ignoreInDelegateCall {
217:         _transaction.processPaymasterInput();
218:     }

```
['[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L39-L39)']
```solidity
39:     function markBytecodeAsPublished(bytes32 _bytecodeHash) external onlyCompressor {
40:         _markBytecodeAsPublished(_bytecodeHash, false);
41:     }

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L46-L46)']
```solidity
46:     function _markBytecodeAsPublished(bytes32 _bytecodeHash, bool _shouldSendToL1) internal {
47:         if (getMarker(_bytecodeHash) == 0) {
48:             _validateBytecode(_bytecodeHash);
49: 
50:             if (_shouldSendToL1) {
51:                 L1_MESSENGER_CONTRACT.requestBytecodeL1Publication(_bytecodeHash);
52:             }
53: 
54:             
55:             assembly {
56:                 sstore(_bytecodeHash, 1)
57:             }
58: 
59:             emit MarkedAsKnown(_bytecodeHash, _shouldSendToL1);
60:         }
61:     }

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L74-L74)']
```solidity
74:     function _validateBytecode(bytes32 _bytecodeHash) internal pure {
75:         uint8 version = uint8(_bytecodeHash[0]);
76:         require(version == 1 && _bytecodeHash[1] == bytes1(0), "Incorrectly formatted bytecodeHash");
77: 
78:         require(Utils.bytecodeLenInWords(_bytecodeHash) % 2 == 1, "Code length in words must be odd");
79:     }

```
['[70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L70-L70)']
```solidity
70:     function sendL2ToL1Log(
71:         bool _isService,
72:         bytes32 _key,
73:         bytes32 _value
74:     ) external onlyCallFromSystemContract returns (uint256 logIdInMerkleTree) {
75:         L2ToL1Log memory l2ToL1Log = L2ToL1Log({
76:             l2ShardId: 0,
77:             isService: _isService,
78:             txNumberInBlock: SYSTEM_CONTEXT_CONTRACT.txNumberInBlock(),
79:             sender: msg.sender,
80:             key: _key,
81:             value: _value
82:         });
83:         logIdInMerkleTree = _processL2ToL1Log(l2ToL1Log);
84: 
85:         
86:         
87:         
88:         
89:         uint256 gasToPay = keccakGasCost(L2_TO_L1_LOG_SERIALIZE_SIZE) + 2 * keccakGasCost(64);
90:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), 0);
91:     }

```
['[161](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L161-L161)']
```solidity
161:     function requestBytecodeL1Publication(
162:         bytes32 _bytecodeHash
163:     ) external override onlyCallFrom(address(KNOWN_CODE_STORAGE_CONTRACT)) {
164:         chainedL1BytecodesRevealDataHash = keccak256(abi.encode(chainedL1BytecodesRevealDataHash, _bytecodeHash));
165: 
166:         uint256 bytecodeLen = Utils.bytecodeLenInBytes(_bytecodeHash);
167: 
168:         uint256 pubdataLen;
169:         unchecked {
170:             
171:             pubdataLen = 4 + bytecodeLen;
172:         }
173: 
174:         
175:         uint256 gasToPay = sha256GasCost(bytecodeLen) +
176:             keccakGasCost(64) +
177:             COMPUTATIONAL_PRICE_FOR_PUBDATA *
178:             pubdataLen;
179:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), uint32(pubdataLen));
180: 
181:         emit BytecodeL1PublicationRequested(_bytecodeHash);
182:     }

```
['[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L85-L85)']
```solidity
85:     function withdrawWithMessage(address _l1Receiver, bytes memory _additionalData) external payable override {
86:         uint256 amount = _burnMsgValue();
87: 
88:         
89:         bytes memory message = _getExtendedWithdrawMessage(_l1Receiver, amount, msg.sender, _additionalData);
90:         L1_MESSENGER_CONTRACT.sendToL1(message);
91: 
92:         emit WithdrawalWithMessage(msg.sender, _l1Receiver, amount, _additionalData);
93:     }

```
['[117](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L117-L117)']
```solidity
117:     function _getExtendedWithdrawMessage(
118:         address _to,
119:         uint256 _amount,
120:         address _sender,
121:         bytes memory _additionalData
122:     ) internal pure returns (bytes memory) {
123:         return abi.encodePacked(IMailbox.finalizeEthWithdrawal.selector, _to, _amount, _sender, _additionalData);
124:     }

```
['[212](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L212-L212)']
```solidity
212:     function _setL2BlockHash(uint256 _block, bytes32 _hash) internal {
213:         l2BlockHash[_block % MINIBLOCK_HASHES_TO_STORE] = _hash;
214:     }

```
['[221](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L221-L221)']
```solidity
221:     function _calculateL2BlockHash(
222:         uint128 _blockNumber,
223:         uint128 _blockTimestamp,
224:         bytes32 _prevL2BlockHash,
225:         bytes32 _blockTxsRollingHash
226:     ) internal pure returns (bytes32) {
227:         return keccak256(abi.encode(_blockNumber, _blockTimestamp, _prevL2BlockHash, _blockTxsRollingHash));
228:     }

```
['[241](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L241-L241)']
```solidity
241:     function _upgradeL2Blocks(uint128 _l2BlockNumber, bytes32 _expectedPrevL2BlockHash, bool _isFirstInBatch) internal {
242:         require(_isFirstInBatch, "Upgrade transaction must be first");
243: 
244:         
245:         require(_l2BlockNumber > 0, "L2 block number is never expected to be zero");
246: 
247:         unchecked {
248:             bytes32 correctPrevBlockHash = _calculateLegacyL2BlockHash(_l2BlockNumber - 1);
249:             require(correctPrevBlockHash == _expectedPrevL2BlockHash, "The previous L2 block hash is incorrect");
250: 
251:             
252:             
253:             
254:             
255:             _setL2BlockHash(_l2BlockNumber - 1, correctPrevBlockHash);
256:         }
257:     }

```
['[314](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L314-L314)']
```solidity
314:     function _setNewL2BlockData(uint128 _l2BlockNumber, uint128 _l2BlockTimestamp, bytes32 _prevL2BlockHash) internal {
315:         
316:         currentL2BlockInfo = BlockInfo({number: _l2BlockNumber, timestamp: _l2BlockTimestamp});
317: 
318:         
319:         _setL2BlockHash(_l2BlockNumber - 1, _prevL2BlockHash);
320: 
321:         
322:         currentL2BlockTxsRollingHash = bytes32(0);
323:     }

```
['[341](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L341-L341)']
```solidity
341:     function setL2Block(
342:         uint128 _l2BlockNumber,
343:         uint128 _l2BlockTimestamp,
344:         bytes32 _expectedPrevL2BlockHash,
345:         bool _isFirstInBatch,
346:         uint128 _maxVirtualBlocksToCreate
347:     ) external onlyCallFromBootloader {
348:         
349:         if (_isFirstInBatch) {
350:             uint128 currentBatchTimestamp = currentBatchInfo.timestamp;
351:             require(
352:                 _l2BlockTimestamp >= currentBatchTimestamp,
353:                 "The timestamp of the L2 block must be greater than or equal to the timestamp of the current batch"
354:             );
355:             require(_maxVirtualBlocksToCreate > 0, "There must be a virtual block created at the start of the batch");
356:         }
357: 
358:         (uint128 currentL2BlockNumber, uint128 currentL2BlockTimestamp) = getL2BlockNumberAndTimestamp();
359: 
360:         if (currentL2BlockNumber == 0 && currentL2BlockTimestamp == 0) {
361:             
362:             
363:             _upgradeL2Blocks(_l2BlockNumber, _expectedPrevL2BlockHash, _isFirstInBatch);
364: 
365:             _setNewL2BlockData(_l2BlockNumber, _l2BlockTimestamp, _expectedPrevL2BlockHash);
366:         } else if (currentL2BlockNumber == _l2BlockNumber) {
367:             require(!_isFirstInBatch, "Can not reuse L2 block number from the previous batch");
368:             require(currentL2BlockTimestamp == _l2BlockTimestamp, "The timestamp of the same L2 block must be same");
369:             require(
370:                 _expectedPrevL2BlockHash == _getLatest257L2blockHash(_l2BlockNumber - 1),
371:                 "The previous hash of the same L2 block must be same"
372:             );
373:             require(_maxVirtualBlocksToCreate == 0, "Can not create virtual blocks in the middle of the miniblock");
374:         } else if (currentL2BlockNumber + 1 == _l2BlockNumber) {
375:             
376:             bytes32 prevL2BlockHash = _getLatest257L2blockHash(currentL2BlockNumber - 1);
377: 
378:             bytes32 pendingL2BlockHash = _calculateL2BlockHash(
379:                 currentL2BlockNumber,
380:                 currentL2BlockTimestamp,
381:                 prevL2BlockHash,
382:                 currentL2BlockTxsRollingHash
383:             );
384: 
385:             require(_expectedPrevL2BlockHash == pendingL2BlockHash, "The current L2 block hash is incorrect");
386:             require(
387:                 _l2BlockTimestamp > currentL2BlockTimestamp,
388:                 "The timestamp of the new L2 block must be greater than the timestamp of the previous L2 block"
389:             );
390: 
391:             
392:             _setNewL2BlockData(_l2BlockNumber, _l2BlockTimestamp, _expectedPrevL2BlockHash);
393:         } else {
394:             revert("Invalid new L2 block number");
395:         }
396: 
397:         _setVirtualBlock(_l2BlockNumber, _maxVirtualBlocksToCreate, _l2BlockTimestamp);
398:     }

```
['[402](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L402-L402)']
```solidity
402:     function appendTransactionToCurrentL2Block(bytes32 _txHash) external onlyCallFromBootloader {
403:         currentL2BlockTxsRollingHash = keccak256(abi.encode(currentL2BlockTxsRollingHash, _txHash));
404:     }

```
['[444](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L444-L444)']
```solidity
444:     function setNewBatch(
445:         bytes32 _prevBatchHash,
446:         uint128 _newTimestamp,
447:         uint128 _expectedNewNumber,
448:         uint256 _baseFee
449:     ) external onlyCallFromBootloader {
450:         (uint128 previousBatchNumber, uint128 previousBatchTimestamp) = getBatchNumberAndTimestamp();
451:         require(_newTimestamp > previousBatchTimestamp, "Timestamps should be incremental");
452:         require(previousBatchNumber + 1 == _expectedNewNumber, "The provided block number is not correct");
453: 
454:         _ensureBatchConsistentWithL2Block(_newTimestamp);
455: 
456:         batchHashes[previousBatchNumber] = _prevBatchHash;
457: 
458:         
459:         BlockInfo memory newBlockInfo = BlockInfo({number: previousBatchNumber + 1, timestamp: _newTimestamp});
460: 
461:         currentBatchInfo = newBlockInfo;
462: 
463:         baseFee = _baseFee;
464: 
465:         
466:         SystemContractHelper.toL1(false, bytes32(uint256(SystemLogKey.PREV_BATCH_HASH_KEY)), _prevBatchHash);
467:     }

```
['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L35-L35)']
```solidity
35:     function gasBoundCall(address _to, uint256 _maxTotalGas, bytes calldata _data) external payable {
36:         
37:         
38:         
39:         
40:         uint256 expectedForCompute = gasleft() + CALL_ENTRY_OVERHEAD;
41: 
42:         
43:         
44:         
45:         
46:         require(_maxTotalGas >= gasleft(), "Gas limit is too low");
47: 
48:         
49:         uint256 pubdataAllowance = _maxTotalGas > expectedForCompute ? _maxTotalGas - expectedForCompute : 0;
50: 
51:         uint256 pubdataPublishedBefore = REAL_SYSTEM_CONTEXT_CONTRACT.getCurrentPubdataSpent();
52: 
53:         
54:         
55:         
56:         
57:         bytes memory returnData = EfficientCall.call(gasleft(), _to, msg.value, _data, false);
58: 
59:         uint256 pubdataPublishedAfter = REAL_SYSTEM_CONTEXT_CONTRACT.getCurrentPubdataSpent();
60: 
61:         
62:         
63:         uint256 pubdataSpent = pubdataPublishedAfter > pubdataPublishedBefore
64:             ? pubdataPublishedAfter - pubdataPublishedBefore
65:             : 0;
66: 
67:         uint256 pubdataPrice = REAL_SYSTEM_CONTEXT_CONTRACT.gasPerPubdataByte();
68: 
69:         
70:         
71:         uint256 pubdataCost = pubdataPrice * pubdataSpent;
72: 
73:         if (pubdataCost != 0) {
74:             
75:             
76:             require(pubdataAllowance + gasleft() >= pubdataCost + CALL_RETURN_OVERHEAD, "Not enough gas for pubdata");
77:         }
78: 
79:         assembly {
80:             
81:             return(add(returnData, 0x20), mload(returnData))
82:         }
83:     }

```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L58-L58)']
```solidity
58:     function call(
59:         uint256 _gas,
60:         address _address,
61:         uint256 _value,
62:         bytes calldata _data,
63:         bool _isSystem
64:     ) internal returns (bytes memory returnData) {
65:         bool success = rawCall(_gas, _address, _value, _data, _isSystem);
66:         returnData = _verifyCallResult(success);
67:     }

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L74-L74)']
```solidity
74:     function staticCall(
75:         uint256 _gas,
76:         address _address,
77:         bytes calldata _data
78:     ) internal view returns (bytes memory returnData) {
79:         bool success = rawStaticCall(_gas, _address, _data);
80:         returnData = _verifyCallResult(success);
81:     }

```
['[88](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L88-L88)']
```solidity
88:     function delegateCall(
89:         uint256 _gas,
90:         address _address,
91:         bytes calldata _data
92:     ) internal returns (bytes memory returnData) {
93:         bool success = rawDelegateCall(_gas, _address, _data);
94:         returnData = _verifyCallResult(success);
95:     }

```
['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L105-L105)']
```solidity
105:     function mimicCall(
106:         uint256 _gas,
107:         address _address,
108:         bytes calldata _data,
109:         address _whoToMimic,
110:         bool _isConstructor,
111:         bool _isSystem
112:     ) internal returns (bytes memory returnData) {
113:         bool success = rawMimicCall(_gas, _address, _data, _whoToMimic, _isConstructor, _isSystem);
114:         returnData = _verifyCallResult(success);
115:     }

```
['[124](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L124-L124)']
```solidity
124:     function rawCall(
125:         uint256 _gas,
126:         address _address,
127:         uint256 _value,
128:         bytes calldata _data,
129:         bool _isSystem
130:     ) internal returns (bool success) {
131:         if (_value == 0) {
132:             _loadFarCallABIIntoActivePtr(_gas, _data, false, _isSystem);
133: 
134:             address callAddr = RAW_FAR_CALL_BY_REF_CALL_ADDRESS;
135:             assembly {
136:                 success := call(_address, callAddr, 0, 0, 0xFFFF, 0, 0)
137:             }
138:         } else {
139:             _loadFarCallABIIntoActivePtr(_gas, _data, false, true);
140: 
141:             
142:             address msgValueSimulator = MSG_VALUE_SYSTEM_CONTRACT;
143:             address callAddr = SYSTEM_CALL_BY_REF_CALL_ADDRESS;
144:             
145:             
146:             uint256 forwardMask = _isSystem ? MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT : 0;
147: 
148:             assembly {
149:                 success := call(msgValueSimulator, callAddr, _value, _address, 0xFFFF, forwardMask, 0)
150:             }
151:         }
152:     }

```
['[159](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L159-L159)']
```solidity
159:     function rawStaticCall(uint256 _gas, address _address, bytes calldata _data) internal view returns (bool success) {
160:         _loadFarCallABIIntoActivePtr(_gas, _data, false, false);
161: 
162:         address callAddr = RAW_FAR_CALL_BY_REF_CALL_ADDRESS;
163:         assembly {
164:             success := staticcall(_address, callAddr, 0, 0xFFFF, 0, 0)
165:         }
166:     }

```
['[173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L173-L173)']
```solidity
173:     function rawDelegateCall(uint256 _gas, address _address, bytes calldata _data) internal returns (bool success) {
174:         _loadFarCallABIIntoActivePtr(_gas, _data, false, false);
175: 
176:         address callAddr = RAW_FAR_CALL_BY_REF_CALL_ADDRESS;
177:         assembly {
178:             success := delegatecall(_address, callAddr, 0, 0xFFFF, 0, 0)
179:         }
180:     }

```
['[191](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L191-L191)']
```solidity
191:     function rawMimicCall(
192:         uint256 _gas,
193:         address _address,
194:         bytes calldata _data,
195:         address _whoToMimic,
196:         bool _isConstructor,
197:         bool _isSystem
198:     ) internal returns (bool success) {
199:         _loadFarCallABIIntoActivePtr(_gas, _data, _isConstructor, _isSystem);
200: 
201:         address callAddr = MIMIC_CALL_BY_REF_CALL_ADDRESS;
202:         uint256 cleanupMask = ADDRESS_MASK;
203:         assembly {
204:             
205:             
206:             _whoToMimic := and(_whoToMimic, cleanupMask)
207: 
208:             success := call(_address, callAddr, 0, 0, _whoToMimic, 0, 0)
209:         }
210:     }

```
['[48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L48-L48)']
```solidity
48:     function toL1(bool _isService, bytes32 _key, bytes32 _value) internal {
49:         address callAddr = TO_L1_CALL_ADDRESS;
50:         assembly {
51:             
52:             _isService := and(_isService, 1)
53:             
54:             
55:             let success := call(_isService, callAddr, _key, _value, 0xFFFF, 0, 0)
56:         }
57:     }

```
['[76](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L76-L76)']
```solidity
76:     function systemCallWithReturndata(
77:         uint32 gasLimit,
78:         address to,
79:         uint128 value,
80:         bytes memory data
81:     ) internal returns (bool success, bytes memory returnData) {
82:         success = systemCall(gasLimit, to, value, data);
83: 
84:         uint256 size;
85:         assembly {
86:             size := returndatasize()
87:         }
88: 
89:         returnData = new bytes(size);
90:         assembly {
91:             returndatacopy(add(returnData, 0x20), 0, size)
92:         }
93:     }

```
['[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L39-L39)']
```solidity
39:     function bytecodeLenInBytes(bytes32 _bytecodeHash) internal pure returns (uint256 codeLength) {
40:         codeLength = bytecodeLenInWords(_bytecodeHash) << 5; 
41:     }

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L44-L44)']
```solidity
44:     function bytecodeLenInWords(bytes32 _bytecodeHash) internal pure returns (uint256 codeLengthInWords) {
45:         unchecked {
46:             codeLengthInWords = uint256(uint8(_bytecodeHash[2])) * 256 + uint256(uint8(_bytecodeHash[3]));
47:         }
48:     }

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L51-L51)']
```solidity
51:     function isContractConstructed(bytes32 _bytecodeHash) internal pure returns (bool) {
52:         return _bytecodeHash[1] == 0x00;
53:     }

```
['[56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L56-L56)']
```solidity
56:     function isContractConstructing(bytes32 _bytecodeHash) internal pure returns (bool) {
57:         return _bytecodeHash[1] == 0x01;
58:     }

```
['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L63-L63)']
```solidity
63:     function constructingBytecodeHash(bytes32 _bytecodeHash) internal pure returns (bytes32) {
64:         
65:         return constructedBytecodeHash(_bytecodeHash) | SET_IS_CONSTRUCTOR_MARKER_BIT_MASK;
66:     }

```
['[71](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L71-L71)']
```solidity
71:     function constructedBytecodeHash(bytes32 _bytecodeHash) internal pure returns (bytes32) {
72:         return _bytecodeHash & ~IS_CONSTRUCTOR_BYTECODE_HASH_BIT_MASK;
73:     }

```
['[49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L49-L49)']
```solidity
49:     function initialize(
50:         address _l1Bridge,
51:         address _l1LegecyBridge,
52:         bytes32 _l2TokenProxyBytecodeHash,
53:         address _aliasedOwner
54:     ) external reinitializer(2) {
55:         require(_l1Bridge != address(0), "bf");
56:         require(_l2TokenProxyBytecodeHash != bytes32(0), "df");
57:         require(_aliasedOwner != address(0), "sf");
58:         require(_l2TokenProxyBytecodeHash != bytes32(0), "df");
59: 
60:         l1Bridge = _l1Bridge;
61:         l2TokenProxyBytecodeHash = _l2TokenProxyBytecodeHash;
62: 
63:         if (block.chainid != ERA_CHAIN_ID) {
64:             address l2StandardToken = address(new L2StandardERC20{salt: bytes32(0)}());
65:             l2TokenBeacon = new UpgradeableBeacon{salt: bytes32(0)}(l2StandardToken);
66:             l2TokenBeacon.transferOwnership(_aliasedOwner);
67:         } else {
68:             require(_l1LegecyBridge != address(0), "bf2");
69:             
70:         }
71:     }

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L79-L79)']
```solidity
79:     function finalizeDeposit(
80:         address _l1Sender,
81:         address _l2Receiver,
82:         address _l1Token,
83:         uint256 _amount,
84:         bytes calldata _data
85:     ) external payable override {
86:         
87:         require(
88:             AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1Bridge ||
89:                 AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1LegacyBridge,
90:             "mq"
91:         );
92:         require(msg.value == 0, "Value should be 0 for ERC20 bridge");
93: 
94:         address expectedL2Token = l2TokenAddress(_l1Token);
95:         address currentL1Token = l1TokenAddress[expectedL2Token];
96:         if (currentL1Token == address(0)) {
97:             address deployedToken = _deployL2Token(_l1Token, _data);
98:             require(deployedToken == expectedL2Token, "mt");
99:             l1TokenAddress[expectedL2Token] = _l1Token;
100:         } else {
101:             require(currentL1Token == _l1Token, "gg"); 
102:         }
103: 
104:         IL2StandardToken(expectedL2Token).bridgeMint(_l2Receiver, _amount);
105:         emit FinalizeDeposit(_l1Sender, _l2Receiver, expectedL2Token, _amount);
106:     }

```
['[109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L109-L109)']
```solidity
109:     function _deployL2Token(address _l1Token, bytes calldata _data) internal returns (address) {
110:         bytes32 salt = _getCreate2Salt(_l1Token);
111: 
112:         BeaconProxy l2Token = _deployBeaconProxy(salt);
113:         L2StandardERC20(address(l2Token)).bridgeInitialize(_l1Token, _data);
114: 
115:         return address(l2Token);
116:     }

```
['[164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L164-L164)']
```solidity
164:     function _deployBeaconProxy(bytes32 salt) internal returns (BeaconProxy proxy) {
165:         (bool success, bytes memory returndata) = SystemContractsCaller.systemCallWithReturndata(
166:             uint32(gasleft()),
167:             DEPLOYER_SYSTEM_CONTRACT,
168:             0,
169:             abi.encodeCall(
170:                 IContractDeployer.create2,
171:                 (salt, l2TokenProxyBytecodeHash, abi.encode(address(l2TokenBeacon), ""))
172:             )
173:         );
174: 
175:         
176:         require(success, "mk");
177:         proxy = BeaconProxy(abi.decode(returndata, (address)));
178:     }

```
['[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L50-L50)']
```solidity
50:     function bridgeInitialize(address _l1Address, bytes memory _data) external initializer {
51:         require(_l1Address != address(0), "in6"); 
52:         l1Address = _l1Address;
53: 
54:         l2Bridge = msg.sender;
55: 
56:         
57:         (bytes memory nameBytes, bytes memory symbolBytes, bytes memory decimalsBytes) = abi.decode(
58:             _data,
59:             (bytes, bytes, bytes)
60:         );
61: 
62:         ERC20Getters memory getters;
63:         string memory decodedName;
64:         string memory decodedSymbol;
65: 
66:         
67:         
68: 
69:         
70:         
71:         
72:         
73:         
74: 
75:         try this.decodeString(nameBytes) returns (string memory nameString) {
76:             decodedName = nameString;
77:         } catch {
78:             getters.ignoreName = true;
79:         }
80: 
81:         try this.decodeString(symbolBytes) returns (string memory symbolString) {
82:             decodedSymbol = symbolString;
83:         } catch {
84:             getters.ignoreSymbol = true;
85:         }
86: 
87:         
88:         __ERC20_init_unchained(decodedName, decodedSymbol);
89: 
90:         
91:         __ERC20Permit_init(decodedName);
92: 
93:         try this.decodeUint8(decimalsBytes) returns (uint8 decimalsUint8) {
94:             
95:             decimals_ = decimalsUint8;
96:         } catch {
97:             getters.ignoreDecimals = true;
98:         }
99: 
100:         availableGetters = getters;
101:         emit BridgeInitialize(_l1Address, decodedName, decodedSymbol, decimals_);
102:     }

```
['[178](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L178-L178)']
```solidity
178:     function decodeString(bytes memory _input) external pure returns (string memory result) {
179:         (result) = abi.decode(_input, (string));
180:     }

```
['[183](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L183-L183)']
```solidity
183:     function decodeUint8(bytes memory _input) external pure returns (uint8 result) {
184:         (result) = abi.decode(_input, (uint8));
185:     }

```


</details>

## [NonCritical-61] Consider adding a time delay to upgrade implementation functions

### Resolution 
It's often considered a good practice to use a timelock on sensitive functions such as upgrading a contract, especially when these contracts handle user funds or critical system states.

A timelock is a delay period that must pass between when an action (like an upgrade) is scheduled and when it can be executed. This provides a window of time for users or governance participants to observe the proposed change and potentially respond if they disagree with the action.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L100-L100)']
```solidity
100:     function upgradeChainFromVersion( // <= FOUND
101:         uint256 _oldProtocolVersion,
102:         Diamond.DiamondCutData calldata _diamondCut
103:     ) external onlyAdminOrStateTransitionManager {
104:         bytes32 cutHashInput = keccak256(abi.encode(_diamondCut));
105:         require(
106:             cutHashInput == IStateTransitionManager(s.stateTransitionManager).upgradeCutHash(_oldProtocolVersion),
107:             "StateTransition: cutHash mismatch"
108:         );
109: 
110:         require(
111:             s.protocolVersion == _oldProtocolVersion,
112:             "StateTransition: protocolVersion mismatch in STC when upgrading"
113:         );
114:         Diamond.diamondCut(_diamondCut);
115:         emit ExecuteUpgrade(_diamondCut);
116:         require(
117:             s.protocolVersion > _oldProtocolVersion,
118:             "StateTransition: protocolVersion mismatch in STC after upgrading"
119:         );
120:     }

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L13-L13)']
```solidity
13:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public override returns (bytes32) { // <= FOUND
14:         super.upgrade(_proposedUpgrade);
15:         return Diamond.DIAMOND_INIT_SUCCESS_RETURN_VALUE;
16:     }

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L21-L21)']
```solidity
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable { // <= FOUND
22:         require(msg.sender == FORCE_DEPLOYER, "Can only be called by FORCE_DEPLOYER");
23: 
24:         require(_delegateTo.code.length > 0, "Delegatee is an EOA");
25:         (bool success, bytes memory returnData) = _delegateTo.delegatecall(_calldata);
26:         assembly {
27:             if iszero(success) {
28:                 revert(add(returnData, 0x20), mload(returnData))
29:             }
30:         }
31:     }

```


</details>

## [NonCritical-62] Redundant inheritance of ERC20

### Resolution 
Inheriting both `ERC20` and `ERC20Permit` isn't technically an issue because `ERC20Permit` is a direct extension of `ERC20`. So, if you inherit both, you won't face any immediate syntactic or semantic issues. However, it's redundant and can potentially lead to confusion.

One potential problem could arise if you override a function from `ERC20` in your contract and expect it to alter the behavior of `ERC20Permit`'s functionality. The overridden function will not affect `ERC20Permit`'s behavior because `ERC20Permit` interacts with the original `ERC20` functions, not the overridden ones in your contract. 

Overall, if you are inheriting from `ERC20Permit`, it is unnecessary and not recommended to also inherit from `ERC20` separately. It's a best practice to keep the inheritance tree as simple and clear as possible to improve readability and maintainability.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L15-L15)']
```solidity
15: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade  // <= FOUND

```


</details>

## [NonCritical-63] Remove unnecessary solhint-disable

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L31-L31)']
```solidity
31:     // solhint-disable-next-line max-line-length // <= FOUND

```


</details>

## [NonCritical-64] Do not use underscore at the end of variable name

### Resolution 
Adopting a consistent and clear naming convention enhances code readability and maintainability. In Solidity, appending an underscore at the end of a variable name is unconventional and can lead to confusion. It is generally advisable to stick to accepted naming practices to promote ease of understanding and use.


Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L96-L96)']
```solidity
95:             
96:             decimals_ = decimalsUint8; // <= FOUND

```


</details>

## [NonCritical-65] Top level declarations should be separated by two blank lines

Num of instances: 21

### Findings 


<details><summary>Click to show findings</summary>

['[226](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L226-L228)']
```solidity
226:     } // <= FOUND
227: 
228:     function _requestL2TransactionSender( // <= FOUND

```
['[256](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L256-L258)']
```solidity
256:     } // <= FOUND
257: 
258:     function _requestL2Transaction( // <= FOUND

```
['[157](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L157-L159)']
```solidity
157:     } // <= FOUND
158: 
159:     function name() public view override returns (string memory) { // <= FOUND

```
['[163](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L163-L165)']
```solidity
163:     } // <= FOUND
164: 
165:     function symbol() public view override returns (string memory) { // <= FOUND

```
['[169](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L169-L171)']
```solidity
169:     } // <= FOUND
170: 
171:     function decimals() public view override returns (uint8) { // <= FOUND

```
['[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L24-L26)']
```solidity
24:     } // <= FOUND
25: 
26:     function safeCastToU32(uint256 _x) internal pure returns (uint32) { // <= FOUND

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L30-L32)']
```solidity
30:     } // <= FOUND
31: 
32:     function safeCastToU24(uint256 _x) internal pure returns (uint24) { // <= FOUND

```
['[347](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L347-L349)']
```solidity
347:     } // <= FOUND
348: 
349:     function _executeBatches(StoredBatchInfo[] calldata _batchesData) internal { // <= FOUND

```
['[479](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L479-L481)']
```solidity
479:     } // <= FOUND
480: 
481:     function _revertBatches(uint256 _newLastBatch) internal { // <= FOUND

```
['[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L24-L26)']
```solidity
24:     } // <= FOUND
25: 
26:     function readUint32(bytes calldata _bytes, uint256 _start) internal pure returns (uint32 result) { // <= FOUND

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L74-L76)']
```solidity
74:     } // <= FOUND
75: 
76:     function systemCallWithReturndata( // <= FOUND

```
['[119](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L119-L121)']
```solidity
119:     } // <= FOUND
120: 
121:     function getFarCallABIWithEmptyFatPointer( // <= FOUND

```
['[38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L38-L40)']
```solidity
38:     } // <= FOUND
39: 
40:     function readBytes32(bytes memory _bytes, uint256 _start) internal pure returns (bytes32 result, uint256 offset) { // <= FOUND

```
['[120](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L120-L122)']
```solidity
120:     } // <= FOUND
121: 
122:     function getCurrentPubdataCost() external view returns (uint256) { // <= FOUND

```
['[480](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L480-L482)']
```solidity
480:     } // <= FOUND
481: 
482:     function incrementTxNumberInBatch() external onlyCallFromBootloader { // <= FOUND

```
['[135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L135-L137)']
```solidity
135:     } // <= FOUND
136: 
137:     function receiveEth(uint256 _chainId) external payable { // <= FOUND

```
['[256](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L256-L258)']
```solidity
256:     } // <= FOUND
257: 
258:     function _nonSystemDeployOnAddress( // <= FOUND

```
['[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L29-L31)']
```solidity
29:     } // <= FOUND
30: 
31:     modifier onlyBridgehub() { // <= FOUND

```
['[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L50-L52)']
```solidity
50:     } // <= FOUND
51: 
52:     modifier onlyBaseTokenBridge() { // <= FOUND

```
['[43](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L43-L45)']
```solidity
43:     } // <= FOUND
44: 
45:     modifier onlyOwnerOrAdmin() { // <= FOUND

```
['[127](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L127-L129)']
```solidity
127:     } // <= FOUND
128: 
129:     modifier onlyBridge() { // <= FOUND

```


</details>

## [NonCritical-66] Use OpenZeppelin's ReentrancyGuard/ReentrancyGuardUpgradeable rather than writing your own

### Resolution 
Leveraging OpenZeppelin's ReentrancyGuard or ReentrancyGuardUpgradeable is generally recommended over creating your own versions. The OpenZeppelin modules have undergone rigorous optimization for gas efficiency and have been comprehensively tested for potential security vulnerabilities. As a result, they provide a high degree of reliability and performance. Writing your own reentrancy guard mechanism might introduce unseen bugs or security loopholes, and likely be less gas efficient. Therefore, it's beneficial to rely on the tried-and-tested solutions offered by OpenZeppelin's established and widely-accepted smart contract library.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[68](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L68-L68)']
```solidity
68:     modifier nonReentrant() { // <= FOUND
69:         uint256 _status;
70:         assembly {
71:             _status := sload(LOCK_FLAG_ADDRESS)
72:         }
73: 
74:         
75:         require(_status == _NOT_ENTERED, "r1");
76: 
77:         
78:         assembly {
79:             sstore(LOCK_FLAG_ADDRESS, _ENTERED)
80:         }
81: 
82:         _;
83: 
84:         
85:         
86:         assembly {
87:             sstore(LOCK_FLAG_ADDRESS, _NOT_ENTERED)
88:         }
89:     }

```


</details>

## [NonCritical-67] Assembly block creates dirty bits

### Resolution 
Manipulating data directly at the free memory pointer location without subsequently adjusting the pointer can lead to unwanted data remnants, or "dirty bits", in that memory spot. This can cause challenges for the Solidity optimizer, making it difficult to determine if memory cleaning is required before reuse, potentially resulting in less efficient optimization. To mitigate this issue, it's advised to always update the free memory pointer following any data write operation. Furthermore, using the `assembly ("memory-safe") { ... }` annotation will clearly indicate to the optimizer the sections of your code that are memory-safe, improving code efficiency and reducing the potential for errors.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L35-L35)']
```solidity
33:         assembly {
34:             
35:             let ptr := mload(0x40) // <= FOUND
36:             
37:             calldatacopy(ptr, 0, calldatasize())
38:             
39:             let result := delegatecall(gas(), facetAddress, ptr, calldatasize(), 0, 0)
40:             
41:             let size := returndatasize()
42:             
43:             returndatacopy(ptr, 0, size)
44:             
45:             switch result
46:             case 0 {
47:                 
48:                 revert(ptr, size)
49:             }
50:             default {
51:                 
52:                 return(ptr, size)
53:             }
54:         }

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L44-L44)']
```solidity
41:        assembly {
42:             mstore(0x00, _lhs)
43:             mstore(0x20, _rhs)
44:             result := keccak256(0x00, 0x40) // <= FOUND
45:         }

```
['[170](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L170-L170)']
```solidity
168:         assembly {
169:             r := mload(add(_signature, 0x20))
170:             s := mload(add(_signature, 0x40)) // <= FOUND
171:             v := and(mload(add(_signature, 0x41)), 0xff)
172:         }

```


</details>

## [NonCritical-68] Using XOR (^) and AND (&) bitwise equivalents

### Resolution 
XOR (^) and AND (&) are bitwise operators that can be more efficient for specific operations in Solidity. XOR returns true if the bits being compared are different, and AND returns true if both bits are true. Using these operators can lead to more concise and efficient code for tasks such as toggling bits or checking specific bit conditions. By applying bitwise logic, you can reduce computational complexity and enhance code performance. Consider using XOR and AND where appropriate, understanding the specific requirements and ensuring that the use of these operators aligns with the intended logic of the application.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[625](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L625-L625)']
```solidity
625:     function _verifyBlobInformation(
626:         bytes calldata _pubdataCommitments,
627:         bytes32[] memory _blobHashes
628:     ) internal view returns (bytes32[] memory blobCommitments) {
629:         uint256 versionedHashIndex = 0;
630: 
631:         require(_pubdataCommitments.length > 0, "pl");
632:         require(_pubdataCommitments.length <= PUBDATA_COMMITMENT_SIZE * MAX_NUMBER_OF_BLOBS, "bd");
633:         require(_pubdataCommitments.length % PUBDATA_COMMITMENT_SIZE == 0, "bs");
634:         blobCommitments = new bytes32[](MAX_NUMBER_OF_BLOBS);
635: 
636:         for (uint256 i = 0; i < _pubdataCommitments.length; i += PUBDATA_COMMITMENT_SIZE) {
637:             bytes32 blobVersionedHash = _getBlobVersionedHash(versionedHashIndex);
638: 
639:             require(blobVersionedHash != bytes32(0), "vh");
640: 
641:             
642:             
643:             bytes32 openingPoint = bytes32(
644:                 uint256(uint128(bytes16(_pubdataCommitments[i:i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET])))
645:             );
646: 
647:             _pointEvaluationPrecompile(
648:                 blobVersionedHash,
649:                 openingPoint,
650:                 _pubdataCommitments[i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET:i + PUBDATA_COMMITMENT_SIZE]
651:             );
652: 
653:             
654:             blobCommitments[versionedHashIndex] = keccak256(
655:                 abi.encodePacked(blobVersionedHash, _pubdataCommitments[i:i + PUBDATA_COMMITMENT_COMMITMENT_OFFSET])
656:             );
657:             versionedHashIndex += 1;
658:         }
659: 
660:         
661:         
662:         bytes32 versionedHash = _getBlobVersionedHash(versionedHashIndex);
663:         require(versionedHash == bytes32(0), "lh");
664: 
665:         
666:         
667:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) {
668:             require(
669:                 (_blobHashes[i] == bytes32(0) && blobCommitments[i] == bytes32(0)) ||
670:                     (_blobHashes[i] != bytes32(0) && blobCommitments[i] != bytes32(0)),
671:                 "bh"
672:             );
673:         }
674:     }

```


</details>

## [NonCritical-69] Lack Of Brace Spacing

### Resolution 
Lack of brace spacing in coding refers to the absence of spaces around braces, which can hinder code readability. In Solidity, as in many programming languages, spacing can enhance the visual distinction between different parts of the code, making it easier to follow. A lack of spacing can lead to a dense, confusing appearance. The resolution to this issue is to follow a consistent style guide that defines rules for brace spacing. By including spaces around braces, such as `{ statement }` instead of `{statement}`, developers can ensure that the code is more legible and maintainable, especially in larger codebases.

Num of instances: 169

### Findings 


<details><summary>Click to show findings</summary>

['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L9-L9)']
```solidity
9: import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol"; // <= FOUND

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L10-L10)']
```solidity
10: import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol"; // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L9-L9)']
```solidity
9: import {IL1ERC20Bridge} from "./interfaces/IL1ERC20Bridge.sol"; // <= FOUND

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L13-L13)']
```solidity
13: import {IL1SharedBridge} from "./interfaces/IL1SharedBridge.sol"; // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L9-L9)']
```solidity
9: import {L2ContractHelper} from "../common/libraries/L2ContractHelper.sol"; // <= FOUND

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L18-L18)']
```solidity
18: import {ReentrancyGuard} from "../common/ReentrancyGuard.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L5-L5)']
```solidity
5: import {Initializable} from "@openzeppelin/contracts/proxy/utils/Initializable.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L5-L5)']
```solidity
5: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L8-L8)']
```solidity
8: import {IERC20Metadata} from "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol"; // <= FOUND

```
['[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L14-L14)']
```solidity
14: import {IL2Bridge} from "./interfaces/IL2Bridge.sol"; // <= FOUND

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L16-L16)']
```solidity
16: import {IMailbox} from "../state-transition/chain-interfaces/IMailbox.sol"; // <= FOUND

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L17-L17)']
```solidity
17: import {L2Message, TxStatus} from "../common/Messaging.sol"; // <= FOUND

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L18-L18)']
```solidity
18: import {UnsafeBytes} from "../common/libraries/UnsafeBytes.sol"; // <= FOUND

```
['[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L14-L14)']
```solidity
14: import {AddressAliasHelper} from "../vendor/AddressAliasHelper.sol"; // <= FOUND

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L21-L21)']
```solidity
21: import {ERA_CHAIN_ID, ERA_ERC20_BRIDGE_ADDRESS, ETH_TOKEN_ADDRESS, ERA_DIAMOND_PROXY, TWO_BRIDGES_MAGIC_VALUE} from "../common/Config.sol"; // <= FOUND

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L22-L22)']
```solidity
22: import {IBridgehub, L2TransactionRequestTwoBridgesInner, L2TransactionRequestDirect} from "../bridgehub/IBridgehub.sol"; // <= FOUND

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L23-L23)']
```solidity
23: import {IGetters} from "../state-transition/chain-interfaces/IGetters.sol"; // <= FOUND

```
['[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L24-L24)']
```solidity
24: import {L2_BASE_TOKEN_SYSTEM_CONTRACT_ADDR} from "../common/L2ContractAddresses.sol"; // <= FOUND

```
['[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L12-L12)']
```solidity
12: import {ETH_TOKEN_ADDRESS, TWO_BRIDGES_MAGIC_VALUE, BRIDGEHUB_MIN_SECOND_BRIDGE_ADDRESS} from "../common/Config.sol"; // <= FOUND

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L13-L13)']
```solidity
13: import {BridgehubL2TransactionRequest} from "../common/Messaging.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L6-L6)']
```solidity
6: import {IGovernance} from "./IGovernance.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L5-L5)']
```solidity
5: import {Diamond} from "./libraries/Diamond.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L6-L6)']
```solidity
6: import {DiamondProxy} from "./chain-deps/DiamondProxy.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L7-L7)']
```solidity
7: import {IAdmin} from "./chain-interfaces/IAdmin.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L8-L8)']
```solidity
8: import {IDefaultUpgrade} from "../upgrades/IDefaultUpgrade.sol"; // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L9-L9)']
```solidity
9: import {IDiamondInit} from "./chain-interfaces/IDiamondInit.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L7-L7)']
```solidity
7: import {IExecutor} from "./chain-interfaces/IExecutor.sol"; // <= FOUND

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L11-L11)']
```solidity
11: import {IStateTransitionManager, StateTransitionManagerInitializeData} from "./IStateTransitionManager.sol"; // <= FOUND

```
['[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L12-L12)']
```solidity
12: import {ISystemContext} from "./l2-deps/ISystemContext.sol"; // <= FOUND

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L13-L13)']
```solidity
13: import {IZkSyncStateTransition} from "./chain-interfaces/IZkSyncStateTransition.sol"; // <= FOUND

```
['[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L14-L14)']
```solidity
14: import {L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, L2_FORCE_DEPLOYER_ADDR} from "../common/L2ContractAddresses.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L6-L6)']
```solidity
6: import {L2CanonicalTransaction} from "../common/Messaging.sol"; // <= FOUND

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L17-L17)']
```solidity
17: import {ProposedUpgrade} from "../upgrades/BaseZkSyncUpgrade.sol"; // <= FOUND

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L19-L19)']
```solidity
19: import {REQUIRED_L2_GAS_PRICE_PER_PUBDATA, L2_TO_L1_LOG_SERIALIZE_SIZE, DEFAULT_L2_LOGS_TREE_ROOT_HASH, EMPTY_STRING_KECCAK, SYSTEM_UPGRADE_L2_TX_TYPE, ERA_DIAMOND_PROXY, ERA_CHAIN_ID} from "../common/Config.sol"; // <= FOUND

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L20-L20)']
```solidity
20: import {VerifierParams} from "./chain-interfaces/IVerifier.sol"; // <= FOUND

```
['[277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L277-L277)']
```solidity
277:         DiamondProxy stateTransitionContract = new DiamondProxy{salt: bytes32(0)}(block.chainid, diamondCut); // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L6-L6)']
```solidity
6: import {LibMap} from "./libraries/LibMap.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L8-L8)']
```solidity
8: import {IStateTransitionManager} from "./IStateTransitionManager.sol"; // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L9-L9)']
```solidity
9: import {ERA_CHAIN_ID} from "../common/Config.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L5-L5)']
```solidity
5: import {Diamond} from "../libraries/Diamond.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L6-L6)']
```solidity
6: import {ZkSyncStateTransitionBase} from "./facets/ZkSyncStateTransitionBase.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L7-L7)']
```solidity
7: import {FeeParams} from "./ZkSyncStateTransitionStorage.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L8-L8)']
```solidity
8: import {L2_TO_L1_LOG_SERIALIZE_SIZE, MAX_GAS_PER_TRANSACTION} from "../../common/Config.sol"; // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L9-L9)']
```solidity
9: import {InitializeData, IDiamondInit} from "../chain-interfaces/IDiamondInit.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L6-L6)']
```solidity
6: import {VerifierParams} from "../chain-interfaces/IVerifier.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L5-L5)']
```solidity
5: import {IVerifier, VerifierParams} from "../chain-interfaces/IVerifier.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L6-L6)']
```solidity
6: import {PriorityQueue} from "../../state-transition/libraries/PriorityQueue.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L5-L5)']
```solidity
5: import {IAdmin} from "../../chain-interfaces/IAdmin.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L6-L6)']
```solidity
6: import {Diamond} from "../../libraries/Diamond.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L7-L7)']
```solidity
7: import {MAX_GAS_PER_TRANSACTION} from "../../../common/Config.sol"; // <= FOUND

```
['[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L12-L12)']
```solidity
12: import {FeeParams, PubdataPricingMode} from "../ZkSyncStateTransitionStorage.sol"; // <= FOUND

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L17-L17)']
```solidity
17: import {ZkSyncStateTransitionBase} from "./ZkSyncStateTransitionBase.sol"; // <= FOUND

```
['[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L14-L14)']
```solidity
14: import {IStateTransitionManager} from "../../IStateTransitionManager.sol"; // <= FOUND

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L25-L25)']
```solidity
25: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L6-L6)']
```solidity
6: import {COMMIT_TIMESTAMP_NOT_OLDER, COMMIT_TIMESTAMP_APPROXIMATION_DELTA, EMPTY_STRING_KECCAK, L2_TO_L1_LOG_SERIALIZE_SIZE, MAX_L2_TO_L1_LOGS_COMMITMENT_BYTES, PACKED_L2_BLOCK_TIMESTAMP_MASK, PUBLIC_INPUT_SHIFT, POINT_EVALUATION_PRECOMPILE_ADDR} from "../../../common/Config.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L7-L7)']
```solidity
7: import {IExecutor, L2_LOG_ADDRESS_OFFSET, L2_LOG_KEY_OFFSET, L2_LOG_VALUE_OFFSET, SystemLogKey, LogProcessingOutput, PubdataSource, BLS_MODULUS, PUBDATA_COMMITMENT_SIZE, PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET, PUBDATA_COMMITMENT_COMMITMENT_OFFSET, MAX_NUMBER_OF_BLOBS, TOTAL_BLOBS_IN_COMMITMENT} from "../../chain-interfaces/IExecutor.sol"; // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L9-L9)']
```solidity
9: import {PriorityQueue, PriorityOperation} from "../../libraries/PriorityQueue.sol"; // <= FOUND

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L13-L13)']
```solidity
13: import {UncheckedMath} from "../../../common/libraries/UncheckedMath.sol"; // <= FOUND

```
['[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L14-L14)']
```solidity
14: import {UnsafeBytes} from "../../../common/libraries/UnsafeBytes.sol"; // <= FOUND

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L11-L11)']
```solidity
11: import {VerifierParams} from "../../chain-interfaces/IVerifier.sol"; // <= FOUND

```
['[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L12-L12)']
```solidity
12: import {L2_BOOTLOADER_ADDRESS, L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, L2_PUBDATA_CHUNK_PUBLISHER_ADDR} from "../../../common/L2ContractAddresses.sol"; // <= FOUND

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L13-L13)']
```solidity
13: import {PubdataPricingMode} from "../ZkSyncStateTransitionStorage.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L7-L7)']
```solidity
7: import {VerifierParams} from "../../../state-transition/chain-interfaces/IVerifier.sol"; // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L9-L9)']
```solidity
9: import {PriorityQueue, PriorityOperation} from "../../../state-transition/libraries/PriorityQueue.sol"; // <= FOUND

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L11-L11)']
```solidity
11: import {IGetters} from "../../chain-interfaces/IGetters.sol"; // <= FOUND

```
['[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L12-L12)']
```solidity
12: import {ILegacyGetters} from "../../chain-interfaces/ILegacyGetters.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L5-L5)']
```solidity
5: import {Math} from "@openzeppelin/contracts/utils/math/Math.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L7-L7)']
```solidity
7: import {IMailbox} from "../../chain-interfaces/IMailbox.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L8-L8)']
```solidity
8: import {Merkle} from "../../libraries/Merkle.sol"; // <= FOUND

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L10-L10)']
```solidity
10: import {TransactionValidator} from "../../libraries/TransactionValidator.sol"; // <= FOUND

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L11-L11)']
```solidity
11: import {WritePriorityOpParams, L2CanonicalTransaction, L2Message, L2Log, TxStatus, BridgehubL2TransactionRequest} from "../../../common/Messaging.sol"; // <= FOUND

```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L15-L15)']
```solidity
15: import {L2ContractHelper} from "../../../common/libraries/L2ContractHelper.sol"; // <= FOUND

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L16-L16)']
```solidity
16: import {AddressAliasHelper} from "../../../vendor/AddressAliasHelper.sol"; // <= FOUND

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L18-L18)']
```solidity
18: import {REQUIRED_L2_GAS_PRICE_PER_PUBDATA, L1_GAS_PER_PUBDATA_BYTE, L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH, PRIORITY_OPERATION_L2_TX_TYPE, PRIORITY_EXPIRATION, MAX_NEW_FACTORY_DEPS, ETH_TOKEN_ADDRESS, ERA_CHAIN_ID} from "../../../common/Config.sol"; // <= FOUND

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L19-L19)']
```solidity
19: import {L2_BOOTLOADER_ADDRESS, L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, L2_BASE_TOKEN_SYSTEM_CONTRACT_ADDR} from "../../../common/L2ContractAddresses.sol"; // <= FOUND

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L21-L21)']
```solidity
21: import {IBridgehub} from "../../../bridgehub/IBridgehub.sol"; // <= FOUND

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L22-L22)']
```solidity
22: import {IL1SharedBridge} from "../../../bridge/interfaces/IL1SharedBridge.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L5-L5)']
```solidity
5: import {ZkSyncStateTransitionStorage} from "../ZkSyncStateTransitionStorage.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L6-L6)']
```solidity
6: import {ReentrancyGuard} from "../../../common/ReentrancyGuard.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L5-L5)']
```solidity
5: import {ZkSyncStateTransitionBase} from "../state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L7-L7)']
```solidity
7: import {VerifierParams} from "../state-transition/chain-interfaces/IVerifier.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L8-L8)']
```solidity
8: import {IVerifier} from "../state-transition/chain-interfaces/IVerifier.sol"; // <= FOUND

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L10-L10)']
```solidity
10: import {TransactionValidator} from "../state-transition/libraries/TransactionValidator.sol"; // <= FOUND

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L11-L11)']
```solidity
11: import {MAX_NEW_FACTORY_DEPS, SYSTEM_UPGRADE_L2_TX_TYPE, MAX_ALLOWED_PROTOCOL_VERSION_DELTA} from "../common/Config.sol"; // <= FOUND

```
['[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgradeGenesis.sol#L12-L12)']
```solidity
12: import {ProposedUpgrade, BaseZkSyncUpgrade} from "./BaseZkSyncUpgrade.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L5-L5)']
```solidity
5: import {Diamond} from "../state-transition/libraries/Diamond.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L6-L6)']
```solidity
6: import {BaseZkSyncUpgrade, ProposedUpgrade} from "./BaseZkSyncUpgrade.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L5-L5)']
```solidity
5: import {SafeCast} from "@openzeppelin/contracts/utils/math/SafeCast.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L5-L5)']
```solidity
5: import {UncheckedMath} from "../../common/libraries/UncheckedMath.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L5-L5)']
```solidity
5: import {L2CanonicalTransaction} from "../../common/Messaging.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L8-L8)']
```solidity
8: import {TX_SLOT_OVERHEAD_L2_GAS, MEMORY_OVERHEAD_GAS, L1_TX_INTRINSIC_L2_GAS, L1_TX_DELTA_544_ENCODING_BYTES, L1_TX_DELTA_FACTORY_DEPS_L2_GAS, L1_TX_MIN_L2_GAS_BASE, L1_TX_INTRINSIC_PUBDATA, L1_TX_DELTA_FACTORY_DEPS_PUBDATA} from "../../common/Config.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L5-L5)']
```solidity
5: import {IL1SharedBridge} from "../bridge/interfaces/IL1SharedBridge.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L5-L5)']
```solidity
5: import {IZkSyncStateTransitionBase} from "../chain-interfaces/IZkSyncStateTransitionBase.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L8-L8)']
```solidity
8: import {FeeParams, PubdataPricingMode} from "../chain-deps/ZkSyncStateTransitionStorage.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L6-L6)']
```solidity
6: import {IVerifier, VerifierParams} from "./IVerifier.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IDiamondInit.sol#L7-L7)']
```solidity
7: import {FeeParams} from "../chain-deps/ZkSyncStateTransitionStorage.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/ILegacyGetters.sol#L5-L5)']
```solidity
5: import {IZkSyncStateTransitionBase} from "./IZkSyncStateTransitionBase.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L5-L5)']
```solidity
5: import {PriorityOperation} from "../libraries/PriorityQueue.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L7-L7)']
```solidity
7: import {PubdataPricingMode} from "../chain-deps/ZkSyncStateTransitionStorage.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L5-L5)']
```solidity
5: import {IAdmin} from "./IAdmin.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L6-L6)']
```solidity
6: import {IExecutor} from "./IExecutor.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L7-L7)']
```solidity
7: import {IGetters} from "./IGetters.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L8-L8)']
```solidity
8: import {IMailbox} from "./IMailbox.sol"; // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L9-L9)']
```solidity
9: import {Verifier} from "../Verifier.sol"; // <= FOUND

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L10-L10)']
```solidity
10: import {VerifierParams} from "./IVerifier.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/IDefaultUpgrade.sol#L5-L5)']
```solidity
5: import {ProposedUpgrade} from "./BaseZkSyncUpgrade.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L7-L7)']
```solidity
7: import {DEPLOYER_SYSTEM_CONTRACT, NONCE_HOLDER_SYSTEM_CONTRACT, CURRENT_MAX_PRECOMPILE_ADDRESS} from "./Constants.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L5-L5)']
```solidity
5: import {IBootloaderUtilities} from "./interfaces/IBootloaderUtilities.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L6-L6)']
```solidity
6: import {Transaction, TransactionHelper, EIP_712_TX_TYPE, LEGACY_TX_TYPE, EIP_2930_TX_TYPE, EIP_1559_TX_TYPE} from "./libraries/TransactionHelper.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L7-L7)']
```solidity
7: import {RLPEncoder} from "./libraries/RLPEncoder.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L8-L8)']
```solidity
8: import {EfficientCall} from "./libraries/EfficientCall.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L5-L5)']
```solidity
5: import {IComplexUpgrader} from "./interfaces/IComplexUpgrader.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L6-L6)']
```solidity
6: import {FORCE_DEPLOYER} from "./Constants.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L5-L5)']
```solidity
5: import {ICompressor, OPERATION_BITMASK, LENGTH_BITS_OFFSET, MAX_ENUMERATION_INDEX_SIZE} from "./interfaces/ICompressor.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L6-L6)']
```solidity
6: import {ISystemContract} from "./interfaces/ISystemContract.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L5-L5)']
```solidity
5: import {Utils} from "./libraries/Utils.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L8-L8)']
```solidity
8: import {UnsafeBytesCalldata} from "./libraries/UnsafeBytesCalldata.sol"; // <= FOUND

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L10-L10)']
```solidity
10: import {L1_MESSENGER_CONTRACT, INITIAL_WRITE_STARTING_POSITION, COMPRESSED_INITIAL_WRITE_SIZE, STATE_DIFF_ENTRY_SIZE, STATE_DIFF_ENUM_INDEX_OFFSET, STATE_DIFF_FINAL_VALUE_OFFSET, STATE_DIFF_DERIVED_KEY_OFFSET, DERIVED_KEY_LENGTH, VALUE_LENGTH, ENUM_INDEX_LENGTH, KNOWN_CODE_STORAGE_CONTRACT} from "./Constants.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L5-L5)']
```solidity
5: import {IAccountCodeStorage} from "./interfaces/IAccountCodeStorage.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L5-L5)']
```solidity
5: import {INonceHolder} from "./interfaces/INonceHolder.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L6-L6)']
```solidity
6: import {IContractDeployer} from "./interfaces/IContractDeployer.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L5-L5)']
```solidity
5: import {IKnownCodesStorage} from "./interfaces/IKnownCodesStorage.sol"; // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L9-L9)']
```solidity
9: import {IImmutableSimulator} from "./interfaces/IImmutableSimulator.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L5-L5)']
```solidity
5: import {IBaseToken} from "./interfaces/IBaseToken.sol"; // <= FOUND

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L11-L11)']
```solidity
11: import {IL1Messenger} from "./interfaces/IL1Messenger.sol"; // <= FOUND

```
['[12](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L12-L12)']
```solidity
12: import {ISystemContext} from "./interfaces/ISystemContext.sol"; // <= FOUND

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L13-L13)']
```solidity
13: import {ICompressor} from "./interfaces/ICompressor.sol"; // <= FOUND

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L16-L16)']
```solidity
16: import {IPubdataChunkPublisher} from "./interfaces/IPubdataChunkPublisher.sol"; // <= FOUND

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L20-L20)']
```solidity
20: uint160 constant SYSTEM_CONTRACTS_OFFSET = {{SYSTEM_CONTRACTS_OFFSET}};  // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L5-L5)']
```solidity
5: import {ImmutableData} from "./interfaces/IImmutableSimulator.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L7-L7)']
```solidity
7: import {CREATE2_PREFIX, CREATE_PREFIX, NONCE_HOLDER_SYSTEM_CONTRACT, ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT, FORCE_DEPLOYER, MAX_SYSTEM_CONTRACT_ADDRESS, KNOWN_CODE_STORAGE_CONTRACT, BASE_TOKEN_SYSTEM_CONTRACT, IMMUTABLE_SIMULATOR_SYSTEM_CONTRACT, COMPLEX_UPGRADER_CONTRACT, KECCAK256_SYSTEM_CONTRACT} from "./Constants.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L8-L8)']
```solidity
8: import {SystemContractHelper} from "./libraries/SystemContractHelper.sol"; // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L9-L9)']
```solidity
9: import {BOOTLOADER_FORMAL_ADDRESS, NONCE_HOLDER_SYSTEM_CONTRACT, DEPLOYER_SYSTEM_CONTRACT, INonceHolder} from "./Constants.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L5-L5)']
```solidity
5: import {IImmutableSimulator, ImmutableData} from "./interfaces/IImmutableSimulator.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L8-L8)']
```solidity
8: import {DEPLOYER_SYSTEM_CONTRACT} from "./Constants.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L8-L8)']
```solidity
8: import {COMPRESSOR_CONTRACT, L1_MESSENGER_CONTRACT} from "./Constants.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L5-L5)']
```solidity
5: import {IL1Messenger, L2ToL1Log, L2_L1_LOGS_TREE_DEFAULT_LEAF_HASH, L2_TO_L1_LOG_SERIALIZE_SIZE, STATE_DIFF_COMPRESSION_VERSION_NUMBER} from "./interfaces/IL1Messenger.sol"; // <= FOUND

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L10-L10)']
```solidity
10: import {SystemLogKey, SYSTEM_CONTEXT_CONTRACT, KNOWN_CODE_STORAGE_CONTRACT, COMPRESSOR_CONTRACT, STATE_DIFF_ENTRY_SIZE, MAX_ALLOWED_PUBDATA_PER_BATCH, L2_TO_L1_LOGS_MERKLE_TREE_LEAVES, PUBDATA_CHUNK_PUBLISHER, COMPUTATIONAL_PRICE_FOR_PUBDATA} from "./Constants.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L7-L7)']
```solidity
7: import {MSG_VALUE_SYSTEM_CONTRACT, DEPLOYER_SYSTEM_CONTRACT, BOOTLOADER_FORMAL_ADDRESS, L1_MESSENGER_CONTRACT} from "./Constants.sol"; // <= FOUND

```
['[8](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L8-L8)']
```solidity
8: import {IMailbox} from "./interfaces/IMailbox.sol"; // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L9-L9)']
```solidity
9: import {MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT, REAL_BASE_TOKEN_SYSTEM_CONTRACT} from "./Constants.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L6-L6)']
```solidity
6: import {L1_MESSENGER_CONTRACT, BLOB_SIZE_BYTES, MAX_NUMBER_OF_BLOBS} from "./Constants.sol"; // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L9-L9)']
```solidity
9: import {SystemLogKey} from "./Constants.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L7-L7)']
```solidity
7: import {ISystemContextDeprecated} from "./interfaces/ISystemContextDeprecated.sol"; // <= FOUND

```
['[9](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L9-L9)']
```solidity
9: import {BOOTLOADER_FORMAL_ADDRESS, SystemLogKey} from "./Constants.sol"; // <= FOUND

```
['[316](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L316-L316)']
```solidity
316:         currentL2BlockInfo = BlockInfo({number: _l2BlockNumber, timestamp: _l2BlockTimestamp}); // <= FOUND

```
['[459](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L459-L459)']
```solidity
459:         BlockInfo memory newBlockInfo = BlockInfo({number: previousBatchNumber + 1, timestamp: _newTimestamp}); // <= FOUND

```
['[476](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L476-L476)']
```solidity
476:         BlockInfo memory newBlockInfo = BlockInfo({number: uint128(_number), timestamp: uint128(_newTimestamp)}); // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L6-L6)']
```solidity
6: import {REAL_SYSTEM_CONTEXT_CONTRACT} from "./Constants.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L7-L7)']
```solidity
7: import {SHA256_SYSTEM_CONTRACT, KECCAK256_SYSTEM_CONTRACT, MSG_VALUE_SYSTEM_CONTRACT} from "../Constants.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L5-L5)']
```solidity
5: import {MAX_SYSTEM_CONTRACT_ADDRESS} from "../Constants.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L7-L7)']
```solidity
7: import {SystemContractsCaller, CalldataForwardingMode, CALLFLAGS_CALL_ADDRESS, CODE_ADDRESS_CALL_ADDRESS, EVENT_WRITE_ADDRESS, EVENT_INITIALIZE_ADDRESS, GET_EXTRA_ABI_DATA_ADDRESS, LOAD_CALLDATA_INTO_ACTIVE_PTR_CALL_ADDRESS, META_CODE_SHARD_ID_OFFSET, META_CALLER_SHARD_ID_OFFSET, META_SHARD_ID_OFFSET, META_AUX_HEAP_SIZE_OFFSET, META_HEAP_SIZE_OFFSET, META_GAS_PER_PUBDATA_BYTE_OFFSET, MIMIC_CALL_BY_REF_CALL_ADDRESS, META_CALL_ADDRESS, MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT, PTR_CALLDATA_CALL_ADDRESS, PTR_ADD_INTO_ACTIVE_CALL_ADDRESS, PTR_SHRINK_INTO_ACTIVE_CALL_ADDRESS, PTR_PACK_INTO_ACTIVE_CALL_ADDRESS, RAW_FAR_CALL_BY_REF_CALL_ADDRESS, PRECOMPILE_CALL_ADDRESS, SET_CONTEXT_VALUE_CALL_ADDRESS, SYSTEM_CALL_BY_REF_CALL_ADDRESS, TO_L1_CALL_ADDRESS} from "./SystemContractsCaller.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L5-L5)']
```solidity
5: import {MSG_VALUE_SYSTEM_CONTRACT} from "./L2ContractHelper.sol"; // <= FOUND

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L10-L10)']
```solidity
10: import {BASE_TOKEN_SYSTEM_CONTRACT, BOOTLOADER_FORMAL_ADDRESS} from "../Constants.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L5-L5)']
```solidity
5: import {SystemContractHelper} from "../libraries/SystemContractHelper.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L6-L6)']
```solidity
6: import {BOOTLOADER_FORMAL_ADDRESS, FORCE_DEPLOYER} from "../Constants.sol"; // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L6-L6)']
```solidity
6: import {BeaconProxy} from "@openzeppelin/contracts/proxy/beacon/BeaconProxy.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L7-L7)']
```solidity
7: import {UpgradeableBeacon} from "@openzeppelin/contracts/proxy/beacon/UpgradeableBeacon.sol"; // <= FOUND

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L10-L10)']
```solidity
10: import {IL2SharedBridge} from "./interfaces/IL2SharedBridge.sol"; // <= FOUND

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L11-L11)']
```solidity
11: import {IL2StandardToken} from "./interfaces/IL2StandardToken.sol"; // <= FOUND

```
['[13](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L13-L13)']
```solidity
13: import {L2StandardERC20} from "./L2StandardERC20.sol"; // <= FOUND

```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L15-L15)']
```solidity
15: import {L2ContractHelper, DEPLOYER_SYSTEM_CONTRACT, L2_BASE_TOKEN_ADDRESS, IContractDeployer} from "../L2ContractHelper.sol"; // <= FOUND

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L16-L16)']
```solidity
16: import {SystemContractsCaller} from "../SystemContractsCaller.sol"; // <= FOUND

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L17-L17)']
```solidity
17: import {ERA_CHAIN_ID, ERA_WETH_ADDRESS} from "../Config.sol"; // <= FOUND

```
['[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L64-L64)']
```solidity
64:             address l2StandardToken = address(new L2StandardERC20{salt: bytes32(0)}()); // <= FOUND

```
['[65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L65-L65)']
```solidity
65:             l2TokenBeacon = new UpgradeableBeacon{salt: bytes32(0)}(l2StandardToken); // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L5-L5)']
```solidity
5: import {ERC20PermitUpgradeable} from "@openzeppelin/contracts-upgradeable/token/ERC20/extensions/draft-ERC20PermitUpgradeable.sol"; // <= FOUND

```
['[7](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L7-L7)']
```solidity
7: import {ERC1967Upgrade} from "@openzeppelin/contracts/proxy/ERC1967/ERC1967Upgrade.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L5-L5)']
```solidity
5: import {IContractDeployer, DEPLOYER_SYSTEM_CONTRACT} from "./L2ContractHelper.sol"; // <= FOUND

```


</details>

## [NonCritical-70] .call bypasses function existence check, type checking and argument packing

### Resolution 
Using the `.call` method in Solidity enables direct communication with an address, bypassing function existence checks, type checking, and argument packing. While this can save gas and provide flexibility, it can also introduce security risks and potential errors. The absence of these checks can lead to unexpected behavior if the callee contract's interface changes or if the input parameters are not crafted with care. The resolution to these issues is to use Solidity's high-level interface for calling functions when possible, as it automatically manages these aspects. If using `.call` is necessary, ensure that the inputs are carefully validated and that awareness of the called contract's behavior is maintained.

Num of instances: 18

### Findings 


<details><summary>Click to show findings</summary>

['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L63-L63)']
```solidity
63:             (bool success, ) = address(REAL_BASE_TOKEN_SYSTEM_CONTRACT).call( // <= FOUND
64:                 abi.encodeCall(REAL_BASE_TOKEN_SYSTEM_CONTRACT.transferFromTo, (msg.sender, to, value))
65:             );

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L57-L61)']
```solidity
57:         
58:         
59:         
60:         
61:         bytes memory returnData = EfficientCall.call(gasleft(), _to, msg.value, _data, false); // <= FOUND

```
['[226](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L226-L226)']
```solidity
226:             (bool success, bytes memory returnData) = _calls[i].target.call{value: _calls[i].value}(_calls[i].data); // <= FOUND

```
['[358](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L358-L358)']
```solidity
358:                 callSuccess := call(gas(), _depositSender, _amount, 0, 0, 0, 0) // <= FOUND
359:             }

```
['[447](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L447-L447)']
```solidity
447:                 callSuccess := call(gas(), l1Receiver, amount, 0, 0, 0, 0) // <= FOUND
448:             }

```
['[229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L229-L232)']
```solidity
229:             
230:             calldatacopy(0, 0, calldatasize())
231:             
232:             let result := call(gas(), contractAddress, 0, 0, calldatasize(), 0, 0) // <= FOUND
233:             
234:             let size := returndatasize()
235:             
236:             returndatacopy(0, 0, size)
237:             
238:             switch result
239:             case 0 {

```
['[136](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L136-L136)']
```solidity
136:                 success := call(_address, callAddr, 0, 0, 0xFFFF, 0, 0) // <= FOUND
137:             }

```
['[149](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L149-L149)']
```solidity
149:                 success := call(msgValueSimulator, callAddr, _value, _address, 0xFFFF, forwardMask, 0) // <= FOUND
150:             }

```
['[206](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L206-L210)']
```solidity
206:             
207:             
208:             _whoToMimic := and(_whoToMimic, cleanupMask)
209: 
210:             success := call(_address, callAddr, 0, 0, _whoToMimic, 0, 0) // <= FOUND
211:         }

```
['[52](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L52-L56)']
```solidity
52:             
53:             _isService := and(_isService, 1)
54:             
55:             
56:             let success := call(_isService, callAddr, _key, _value, 0xFFFF, 0, 0) // <= FOUND
57:         }

```
['[173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L173-L175)']
```solidity
173:             
174:             _value := and(_value, cleanupMask)
175:             success := call(0, callAddr, _value, 0, 0xFFFF, 0, 0) // <= FOUND
176:         }

```
['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L62-L62)']
```solidity
62:                 success := call(to, callAddr, 0, 0, farCallAbi, 0, 0) // <= FOUND
63:             }

```
['[71](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L71-L71)']
```solidity
71:                 success := call(msgValueSimulator, callAddr, value, to, farCallAbi, forwardMask, 0) // <= FOUND
72:             }

```
['[400](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L400-L400)']
```solidity
400:             success := call(gas(), bootloaderAddr, amount, 0, 0, 0, 0) // <= FOUND
401:         }

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L21-L22)']
```solidity
21:             let offset := sub(_bytes.offset, 30)
22:             result := calldataload(add(offset, _start)) // <= FOUND
23:         }

```
['[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L28-L29)']
```solidity
28:             let offset := sub(_bytes.offset, 28)
29:             result := calldataload(add(offset, _start)) // <= FOUND
30:         }

```
['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L35-L36)']
```solidity
35:             let offset := sub(_bytes.offset, 24)
36:             result := calldataload(add(offset, _start)) // <= FOUND
37:         }

```
['[42](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L42-L42)']
```solidity
42:             result := calldataload(add(_bytes.offset, _start)) // <= FOUND
43:         }

```


</details>

## [NonCritical-71] No access control on receive/payable fallback

### Resolution 
Without access control on receive/payable fallback functions in a contract, anyone can send Ether (ETH) to the contract's address. If there's no way to withdraw those funds defined within the contract, any Ether sent, whether intentionally or by mistake, will be permanently stuck. This could lead to unintended loss of funds. Implementing proper access control ensures that only authorized addresses can interact with these functions. Resolution could involve adding access control mechanisms, like Ownable or specific permission requirements, or creating a withdrawal function accessible only to the contract's owner, thus preventing unintentional loss of funds.

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L262-L262)']
```solidity
262:     receive() external payable {} // <= FOUND

```
['[227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L227-L227)']
```solidity
227:     receive() external payable { // <= FOUND
228:         
229:     }

```
['[262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L262-L262)']
```solidity
262:     receive() external payable {} // <= FOUND

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L11-L11)']
```solidity
11:     fallback() external payable {} // <= FOUND

```


</details>

## [NonCritical-72] Cyclomatic complexity in functions

### Resolution 
Cyclomatic complexity is a software metric used to measure the complexity of a program. It quantifies the number of linearly independent paths through a program's source code, giving an idea of how complex the control flow is. High cyclomatic complexity may indicate a higher risk of defects and can make the code harder to understand, test, and maintain. It often suggests that a function or method is trying to do too much, and a refactor might be needed. By breaking down complex functions into smaller, more focused pieces, you can improve readability, ease of testing, and overall maintainability.

Num of instances: 18

### Findings 


<details><summary>Click to show findings</summary>

[]
```solidity
303:     function _claimFailedDeposit(
304:         bool _checkedInLegacyBridge,
305:         uint256 _chainId,
306:         address _depositSender,
307:         address _l1Token,
308:         uint256 _amount,
309:         bytes32 _l2TxHash,
310:         uint256 _l2BatchNumber,
311:         uint256 _l2MessageIndex,
312:         uint16 _l2TxNumberInBatch,
313:         bytes32[] calldata _merkleProof
314:     ) internal nonReentrant {
315:         {
316:             bool proofValid = bridgehub.proveL1ToL2TransactionStatus(
317:                 _chainId,
318:                 _l2TxHash,
319:                 _l2BatchNumber,
320:                 _l2MessageIndex,
321:                 _l2TxNumberInBatch,
322:                 _merkleProof,
323:                 TxStatus.Failure
324:             );
325:             require(proofValid, "yn");
326:         }
327:         require(_amount > 0, "y1");
328: 
329:         {
330:             bool notCheckedInLegacyBridgeOrWeCanCheckDeposit;
331:             {
332:                 
333:                 bool weCanCheckDepositHere = !_isEraLegacyWithdrawal(_chainId, _l2BatchNumber);
334:                 
335:                 
336:                 
337:                 notCheckedInLegacyBridgeOrWeCanCheckDeposit = (!_checkedInLegacyBridge) || weCanCheckDepositHere;
338:             }
339:             if (notCheckedInLegacyBridgeOrWeCanCheckDeposit) {
340:                 bytes32 dataHash = depositHappened[_chainId][_l2TxHash];
341:                 bytes32 txDataHash = keccak256(abi.encode(_depositSender, _l1Token, _amount));
342:                 require(dataHash == txDataHash, "ShB: d.it not hap");
343:                 delete depositHappened[_chainId][_l2TxHash];
344:             }
345:         }
346: 
347:         if (!hyperbridgingEnabled[_chainId]) {
348:             
349:             require(chainBalance[_chainId][_l1Token] >= _amount, "ShB n funds");
350:             chainBalance[_chainId][_l1Token] -= _amount;
351:         }
352: 
353:         
354:         if (_l1Token == ETH_TOKEN_ADDRESS) {
355:             bool callSuccess;
356:             
357:             assembly {
358:                 callSuccess := call(gas(), _depositSender, _amount, 0, 0, 0, 0)
359:             }
360:             require(callSuccess, "ShB: claimFailedDeposit failed");
361:         } else {
362:             IERC20(_l1Token).safeTransfer(_depositSender, _amount);
363:             
364:             
365:         }
366: 
367:         emit ClaimedFailedDepositSharedBridge(_chainId, _depositSender, _l1Token, _amount);
368:     }

```
[]
```solidity
409:     function _finalizeWithdrawal(
410:         uint256 _chainId,
411:         uint256 _l2BatchNumber,
412:         uint256 _l2MessageIndex,
413:         uint16 _l2TxNumberInBatch,
414:         bytes calldata _message,
415:         bytes32[] calldata _merkleProof
416:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount) {
417:         require(!isWithdrawalFinalized[_chainId][_l2BatchNumber][_l2MessageIndex], "Withdrawal is already finalized");
418:         isWithdrawalFinalized[_chainId][_l2BatchNumber][_l2MessageIndex] = true;
419: 
420:         
421:         if (_isEraLegacyWithdrawal(_chainId, _l2BatchNumber)) {
422:             
423:             bool alreadyFinalized = IGetters(ERA_DIAMOND_PROXY).isEthWithdrawalFinalized(
424:                 _l2BatchNumber,
425:                 _l2MessageIndex
426:             );
427:             require(!alreadyFinalized, "Withdrawal is already finalized 2");
428:         }
429: 
430:         MessageParams memory messageParams = MessageParams({
431:             l2BatchNumber: _l2BatchNumber,
432:             l2MessageIndex: _l2MessageIndex,
433:             l2TxNumberInBatch: _l2TxNumberInBatch
434:         });
435:         (l1Receiver, l1Token, amount) = _checkWithdrawal(_chainId, messageParams, _message, _merkleProof);
436: 
437:         if (!hyperbridgingEnabled[_chainId]) {
438:             
439:             require(chainBalance[_chainId][l1Token] >= amount, "ShB not enough funds 2"); 
440:             chainBalance[_chainId][l1Token] -= amount;
441:         }
442: 
443:         if (l1Token == ETH_TOKEN_ADDRESS) {
444:             bool callSuccess;
445:             
446:             assembly {
447:                 callSuccess := call(gas(), l1Receiver, amount, 0, 0, 0, 0)
448:             }
449:             require(callSuccess, "ShB: withdraw failed");
450:         } else {
451:             
452:             IERC20(l1Token).safeTransfer(l1Receiver, amount);
453:         }
454:         emit WithdrawalFinalizedSharedBridge(_chainId, l1Receiver, l1Token, amount);
455:     }

```
['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L105-L105)']
```solidity
105:     function getOperationState(bytes32 _id) public view returns (OperationState) { // <= FOUND
106:         uint256 timestamp = timestamps[_id];
107:         if (timestamp == 0) {
108:             return OperationState.Unset;
109:         } else if (timestamp == EXECUTED_PROPOSAL_TIMESTAMP) {
110:             return OperationState.Done;
111:         } else if (timestamp > block.timestamp) {
112:             return OperationState.Waiting;
113:         } else {
114:             return OperationState.Ready;
115:         }
116:     }

```
[]
```solidity
32:     function _commitOneBatch(
33:         StoredBatchInfo memory _previousBatch,
34:         CommitBatchInfo calldata _newBatch,
35:         bytes32 _expectedSystemContractUpgradeTxHash
36:     ) internal view returns (StoredBatchInfo memory) {
37:         require(_newBatch.batchNumber == _previousBatch.batchNumber + 1, "f"); 
38: 
39:         uint8 pubdataSource = uint8(bytes1(_newBatch.pubdataCommitments[0]));
40:         require(pubdataSource == uint8(PubdataSource.Calldata) || pubdataSource == uint8(PubdataSource.Blob), "us");
41: 
42:         
43:         
44:         LogProcessingOutput memory logOutput = _processL2Logs(_newBatch, _expectedSystemContractUpgradeTxHash);
45: 
46:         bytes32[] memory blobCommitments = new bytes32[](MAX_NUMBER_OF_BLOBS);
47:         bytes32[] memory blobHashes = new bytes32[](MAX_NUMBER_OF_BLOBS);
48:         if (s.feeParams.pubdataPricingMode == PubdataPricingMode.Validium) {
49:             
50:             require(logOutput.pubdataHash == 0x00, "v0h");
51:             require(_newBatch.pubdataCommitments.length == 1);
52:         } else if (pubdataSource == uint8(PubdataSource.Blob)) {
53:             
54:             
55:             blobHashes[0] = logOutput.blob1Hash;
56:             blobHashes[1] = logOutput.blob2Hash;
57:             
58:             blobCommitments = _verifyBlobInformation(_newBatch.pubdataCommitments[1:], blobHashes);
59:         } else if (pubdataSource == uint8(PubdataSource.Calldata)) {
60:             
61:             require(
62:                 logOutput.pubdataHash ==
63:                     keccak256(_newBatch.pubdataCommitments[1:_newBatch.pubdataCommitments.length - 32]),
64:                 "wp"
65:             );
66:             blobHashes[0] = logOutput.blob1Hash;
67:             blobCommitments[0] = bytes32(
68:                 _newBatch.pubdataCommitments[_newBatch.pubdataCommitments.length - 32:_newBatch
69:                     .pubdataCommitments
70:                     .length]
71:             );
72:         }
73: 
74:         require(_previousBatch.batchHash == logOutput.previousBatchHash, "l");
75:         
76:         require(logOutput.chainedPriorityTxsHash == _newBatch.priorityOperationsHash, "t");
77:         
78:         require(logOutput.numberOfLayer1Txs == _newBatch.numberOfLayer1Txs, "ta");
79: 
80:         
81:         _verifyBatchTimestamp(logOutput.packedBatchAndL2BlockTimestamp, _newBatch.timestamp, _previousBatch.timestamp);
82: 
83:         
84:         bytes32 commitment = _createBatchCommitment(_newBatch, logOutput.stateDiffHash, blobCommitments, blobHashes);
85: 
86:         return
87:             StoredBatchInfo(
88:                 _newBatch.batchNumber,
89:                 _newBatch.newStateRoot,
90:                 _newBatch.indexRepeatedStorageChanges,
91:                 _newBatch.numberOfLayer1Txs,
92:                 _newBatch.priorityOperationsHash,
93:                 logOutput.l2LogsTreeRoot,
94:                 _newBatch.timestamp,
95:                 commitment
96:             );
97:     }

```
[]
```solidity
130:     function _processL2Logs(
131:         CommitBatchInfo calldata _newBatch,
132:         bytes32 _expectedSystemContractUpgradeTxHash
133:     ) internal pure returns (LogProcessingOutput memory logOutput) {
134:         
135:         bytes memory emittedL2Logs = _newBatch.systemLogs;
136: 
137:         
138:         
139:         uint256 processedLogs;
140: 
141:         
142:         for (uint256 i = 0; i < emittedL2Logs.length; i = i.uncheckedAdd(L2_TO_L1_LOG_SERIALIZE_SIZE)) {
143:             
144:             (address logSender, ) = UnsafeBytes.readAddress(emittedL2Logs, i + L2_LOG_ADDRESS_OFFSET);
145:             (uint256 logKey, ) = UnsafeBytes.readUint256(emittedL2Logs, i + L2_LOG_KEY_OFFSET);
146:             (bytes32 logValue, ) = UnsafeBytes.readBytes32(emittedL2Logs, i + L2_LOG_VALUE_OFFSET);
147: 
148:             
149:             require(!_checkBit(processedLogs, uint8(logKey)), "kp");
150:             processedLogs = _setBit(processedLogs, uint8(logKey));
151: 
152:             
153:             if (logKey == uint256(SystemLogKey.L2_TO_L1_LOGS_TREE_ROOT_KEY)) {
154:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "lm");
155:                 logOutput.l2LogsTreeRoot = logValue;
156:             } else if (logKey == uint256(SystemLogKey.TOTAL_L2_TO_L1_PUBDATA_KEY)) {
157:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "ln");
158:                 logOutput.pubdataHash = logValue;
159:             } else if (logKey == uint256(SystemLogKey.STATE_DIFF_HASH_KEY)) {
160:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "lb");
161:                 logOutput.stateDiffHash = logValue;
162:             } else if (logKey == uint256(SystemLogKey.PACKED_BATCH_AND_L2_BLOCK_TIMESTAMP_KEY)) {
163:                 require(logSender == L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, "sc");
164:                 logOutput.packedBatchAndL2BlockTimestamp = uint256(logValue);
165:             } else if (logKey == uint256(SystemLogKey.PREV_BATCH_HASH_KEY)) {
166:                 require(logSender == L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, "sv");
167:                 logOutput.previousBatchHash = logValue;
168:             } else if (logKey == uint256(SystemLogKey.CHAINED_PRIORITY_TXN_HASH_KEY)) {
169:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bl");
170:                 logOutput.chainedPriorityTxsHash = logValue;
171:             } else if (logKey == uint256(SystemLogKey.NUMBER_OF_LAYER_1_TXS_KEY)) {
172:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bk");
173:                 logOutput.numberOfLayer1Txs = uint256(logValue);
174:             } else if (logKey == uint256(SystemLogKey.BLOB_ONE_HASH_KEY)) {
175:                 require(logSender == L2_PUBDATA_CHUNK_PUBLISHER_ADDR, "pc");
176:                 logOutput.blob1Hash = logValue;
177:             } else if (logKey == uint256(SystemLogKey.BLOB_TWO_HASH_KEY)) {
178:                 require(logSender == L2_PUBDATA_CHUNK_PUBLISHER_ADDR, "pd");
179:                 logOutput.blob2Hash = logValue;
180:             } else if (logKey == uint256(SystemLogKey.EXPECTED_SYSTEM_CONTRACT_UPGRADE_TX_HASH_KEY)) {
181:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bu");
182:                 require(_expectedSystemContractUpgradeTxHash == logValue, "ut");
183:             } else {
184:                 revert("ul");
185:             }
186:         }
187: 
188:         
189:         
190:         
191:         if (_expectedSystemContractUpgradeTxHash == bytes32(0)) {
192:             require(processedLogs == 511, "b7");
193:         } else {
194:             require(processedLogs == 1023, "b8");
195:         }
196:     }

```
['[96](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L96-L96)']
```solidity
96:     function diamondCut(DiamondCutData memory _diamondCut) internal { // <= FOUND
97:         FacetCut[] memory facetCuts = _diamondCut.facetCuts;
98:         address initAddress = _diamondCut.initAddress;
99:         bytes memory initCalldata = _diamondCut.initCalldata;
100:         uint256 facetCutsLength = facetCuts.length;
101:         for (uint256 i = 0; i < facetCutsLength; i = i.uncheckedInc()) {
102:             Action action = facetCuts[i].action;
103:             address facet = facetCuts[i].facet;
104:             bool isFacetFreezable = facetCuts[i].isFreezable;
105:             bytes4[] memory selectors = facetCuts[i].selectors;
106: 
107:             require(selectors.length > 0, "B"); 
108: 
109:             if (action == Action.Add) {
110:                 _addFunctions(facet, selectors, isFacetFreezable);
111:             } else if (action == Action.Replace) {
112:                 _replaceFunctions(facet, selectors, isFacetFreezable);
113:             } else if (action == Action.Remove) {
114:                 _removeFunctions(facet, selectors);
115:             } else {
116:                 revert("C"); 
117:             }
118:         }
119: 
120:         _initializeDiamondCut(initAddress, initCalldata);
121:         emit DiamondCut(facetCuts, initAddress, initCalldata);
122:     }

```
['[278](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L278-L278)']
```solidity
278:     function _initializeDiamondCut(address _init, bytes memory _calldata) private { // <= FOUND
279:         if (_init == address(0)) {
280:             require(_calldata.length == 0, "H"); 
281:         } else {
282:             
283:             (bool success, bytes memory data) = _init.delegatecall(_calldata);
284:             if (!success) {
285:                 
286:                 if (data.length <= 4) {
287:                     revert("I"); 
288:                 }
289: 
290:                 assembly {
291:                     revert(add(data, 0x20), mload(data))
292:                 }
293:             }
294: 
295:             
296:             
297:             require(data.length == 32, "lp");
298:             require(abi.decode(data, (bytes32)) == DIAMOND_INIT_SUCCESS_RETURN_VALUE, "lp1");
299:         }
300:     }

```
['[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L89-L89)']
```solidity
89:     function getCodeHash(uint256 _input) external view override returns (bytes32) { // <= FOUND
90:         
91:         
92:         address account = address(uint160(_input));
93:         if (uint160(account) <= CURRENT_MAX_PRECOMPILE_ADDRESS) {
94:             return EMPTY_STRING_KECCAK;
95:         }
96: 
97:         bytes32 codeHash = getRawCodeHash(account);
98: 
99:         
100:         
101:         
102:         if (codeHash == 0x00 && NONCE_HOLDER_SYSTEM_CONTRACT.getRawNonce(account) > 0) {
103:             codeHash = EMPTY_STRING_KECCAK;
104:         }
105:         
106:         
107:         else if (Utils.isContractConstructing(codeHash)) {
108:             codeHash = EMPTY_STRING_KECCAK;
109:         }
110: 
111:         return codeHash;
112:     }

```
[]
```solidity
24:     function getTransactionHashes(
25:         Transaction calldata _transaction
26:     ) external view override returns (bytes32 txHash, bytes32 signedTxHash) {
27:         signedTxHash = _transaction.encodeHash();
28:         if (_transaction.txType == EIP_712_TX_TYPE) {
29:             txHash = keccak256(bytes.concat(signedTxHash, EfficientCall.keccak(_transaction.signature)));
30:         } else if (_transaction.txType == LEGACY_TX_TYPE) {
31:             txHash = encodeLegacyTransactionHash(_transaction);
32:         } else if (_transaction.txType == EIP_1559_TX_TYPE) {
33:             txHash = encodeEIP1559TransactionHash(_transaction);
34:         } else if (_transaction.txType == EIP_2930_TX_TYPE) {
35:             txHash = encodeEIP2930TransactionHash(_transaction);
36:         } else {
37:             revert("Unsupported tx type");
38:         }
39:     }

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L44-L44)']
```solidity
44:     function encodeLegacyTransactionHash(Transaction calldata _transaction) internal view returns (bytes32 txHash) { // <= FOUND
45:         
46:         
47:         
48:         
49:         
50:         
51: 
52:         bytes memory encodedNonce = RLPEncoder.encodeUint256(_transaction.nonce);
53:         
54:         bytes memory encodedGasParam;
55:         {
56:             bytes memory encodedGasPrice = RLPEncoder.encodeUint256(_transaction.maxFeePerGas);
57:             bytes memory encodedGasLimit = RLPEncoder.encodeUint256(_transaction.gasLimit);
58:             encodedGasParam = bytes.concat(encodedGasPrice, encodedGasLimit);
59:         }
60: 
61:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));
62:         bytes memory encodedValue = RLPEncoder.encodeUint256(_transaction.value);
63:         
64:         
65:         bytes memory encodedDataLength;
66:         {
67:             
68:             uint64 txDataLen = uint64(_transaction.data.length);
69:             if (txDataLen != 1) {
70:                 
71:                 encodedDataLength = RLPEncoder.encodeNonSingleBytesLen(txDataLen);
72:             } else if (_transaction.data[0] >= 0x80) {
73:                 
74:                 encodedDataLength = hex"81";
75:             }
76:             
77:         }
78: 
79:         bytes memory rEncoded;
80:         {
81:             uint256 rInt = uint256(bytes32(_transaction.signature[0:32]));
82:             rEncoded = RLPEncoder.encodeUint256(rInt);
83:         }
84:         bytes memory sEncoded;
85:         {
86:             uint256 sInt = uint256(bytes32(_transaction.signature[32:64]));
87:             sEncoded = RLPEncoder.encodeUint256(sInt);
88:         }
89:         bytes memory vEncoded;
90:         {
91:             uint256 vInt = uint256(uint8(_transaction.signature[64]));
92:             require(vInt == 27 || vInt == 28, "Invalid v value");
93: 

```
[]
```solidity
220:     function _verifyValueCompression(
221:         uint256 _initialValue,
222:         uint256 _finalValue,
223:         uint256 _operation,
224:         bytes calldata _compressedValue
225:     ) internal pure {
226:         uint256 convertedValue = _sliceToUint256(_compressedValue);
227: 
228:         unchecked {
229:             if (_operation == 0 || _operation == 3) {
230:                 require(convertedValue == _finalValue, "transform or no compression: compressed and final mismatch");
231:             } else if (_operation == 1) {
232:                 require(
233:                     _initialValue + convertedValue == _finalValue,
234:                     "add: initial plus converted not equal to final"
235:                 );
236:             } else if (_operation == 2) {
237:                 require(
238:                     _initialValue - convertedValue == _finalValue,
239:                     "sub: initial minus converted not equal to final"
240:                 );
241:             } else {
242:                 revert("unsupported operation");
243:             }
244:         }
245:     }

```
[]
```solidity
321:     function _constructContract(
322:         address _sender,
323:         address _newAddress,
324:         bytes32 _bytecodeHash,
325:         bytes calldata _input,
326:         bool _isSystem,
327:         bool _callConstructor
328:     ) internal {
329:         uint256 value = msg.value;
330:         if (_callConstructor) {
331:             
332:             if (value > 0) {
333:                 BASE_TOKEN_SYSTEM_CONTRACT.transferFromTo(address(this), _newAddress, value);
334:             }
335:             
336:             _storeConstructingByteCodeHashOnAddress(_newAddress, _bytecodeHash);
337: 
338:             
339:             if (value > 0) {
340:                 
341:                 SystemContractHelper.setValueForNextFarCall(uint128(value));
342:             }
343:             bytes memory returnData = EfficientCall.mimicCall(gasleft(), _newAddress, _input, _sender, true, _isSystem);
344:             
345:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.markAccountCodeHashAsConstructed(_newAddress);
346:             
347:             ImmutableData[] memory immutables = abi.decode(returnData, (ImmutableData[]));
348:             IMMUTABLE_SIMULATOR_SYSTEM_CONTRACT.setImmutables(_newAddress, immutables);
349:         } else {
350:             require(value == 0, "The value must be zero if we do not call the constructor");
351:             
352:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.storeAccountConstructedCodeHash(_newAddress, _bytecodeHash);
353:         }
354: 
355:         emit ContractDeployed(_sender, _bytecodeHash, _newAddress);
356:     }

```
[]
```solidity
263:     function _setVirtualBlock(
264:         uint128 _l2BlockNumber,
265:         uint128 _maxVirtualBlocksToCreate,
266:         uint128 _newTimestamp
267:     ) internal {
268:         if (virtualBlockUpgradeInfo.virtualBlockFinishL2Block != 0) {
269:             
270:             
271:             currentVirtualL2BlockInfo = currentL2BlockInfo;
272:             return;
273:         }
274: 
275:         BlockInfo memory virtualBlockInfo = currentVirtualL2BlockInfo;
276: 
277:         if (currentVirtualL2BlockInfo.number == 0 && virtualBlockInfo.timestamp == 0) {
278:             uint128 currentBatchNumber = currentBatchInfo.number;
279: 
280:             
281:             
282:             
283:             virtualBlockInfo.number = currentBatchNumber;
284:             
285:             virtualBlockUpgradeInfo.virtualBlockStartBatch = currentBatchNumber;
286: 
287:             require(_maxVirtualBlocksToCreate > 0, "Can't initialize the first virtual block");
288:             _maxVirtualBlocksToCreate -= 1;
289:         } else if (_maxVirtualBlocksToCreate == 0) {
290:             
291:             
292:             return;
293:         }
294: 
295:         virtualBlockInfo.number += _maxVirtualBlocksToCreate;
296:         virtualBlockInfo.timestamp = _newTimestamp;
297: 
298:         
299:         
300:         
301:         
302:         if (virtualBlockInfo.number >= _l2BlockNumber) {
303:             virtualBlockUpgradeInfo.virtualBlockFinishL2Block = _l2BlockNumber;
304:             virtualBlockInfo.number = _l2BlockNumber;
305:         }
306: 
307:         currentVirtualL2BlockInfo = virtualBlockInfo;
308:     }

```
[]
```solidity
341:     function setL2Block(
342:         uint128 _l2BlockNumber,
343:         uint128 _l2BlockTimestamp,
344:         bytes32 _expectedPrevL2BlockHash,
345:         bool _isFirstInBatch,
346:         uint128 _maxVirtualBlocksToCreate
347:     ) external onlyCallFromBootloader {
348:         
349:         if (_isFirstInBatch) {
350:             uint128 currentBatchTimestamp = currentBatchInfo.timestamp;
351:             require(
352:                 _l2BlockTimestamp >= currentBatchTimestamp,
353:                 "The timestamp of the L2 block must be greater than or equal to the timestamp of the current batch"
354:             );
355:             require(_maxVirtualBlocksToCreate > 0, "There must be a virtual block created at the start of the batch");
356:         }
357: 
358:         (uint128 currentL2BlockNumber, uint128 currentL2BlockTimestamp) = getL2BlockNumberAndTimestamp();
359: 
360:         if (currentL2BlockNumber == 0 && currentL2BlockTimestamp == 0) {
361:             
362:             
363:             _upgradeL2Blocks(_l2BlockNumber, _expectedPrevL2BlockHash, _isFirstInBatch);
364: 
365:             _setNewL2BlockData(_l2BlockNumber, _l2BlockTimestamp, _expectedPrevL2BlockHash);
366:         } else if (currentL2BlockNumber == _l2BlockNumber) {
367:             require(!_isFirstInBatch, "Can not reuse L2 block number from the previous batch");
368:             require(currentL2BlockTimestamp == _l2BlockTimestamp, "The timestamp of the same L2 block must be same");
369:             require(
370:                 _expectedPrevL2BlockHash == _getLatest257L2blockHash(_l2BlockNumber - 1),
371:                 "The previous hash of the same L2 block must be same"
372:             );
373:             require(_maxVirtualBlocksToCreate == 0, "Can not create virtual blocks in the middle of the miniblock");
374:         } else if (currentL2BlockNumber + 1 == _l2BlockNumber) {
375:             
376:             bytes32 prevL2BlockHash = _getLatest257L2blockHash(currentL2BlockNumber - 1);
377: 
378:             bytes32 pendingL2BlockHash = _calculateL2BlockHash(
379:                 currentL2BlockNumber,
380:                 currentL2BlockTimestamp,
381:                 prevL2BlockHash,
382:                 currentL2BlockTxsRollingHash
383:             );
384: 
385:             require(_expectedPrevL2BlockHash == pendingL2BlockHash, "The current L2 block hash is incorrect");
386:             require(
387:                 _l2BlockTimestamp > currentL2BlockTimestamp,
388:                 "The timestamp of the new L2 block must be greater than the timestamp of the previous L2 block"
389:             );
390: 
391:             
392:             _setNewL2BlockData(_l2BlockNumber, _l2BlockTimestamp, _expectedPrevL2BlockHash);
393:         } else {
394:             revert("Invalid new L2 block number");
395:         }
396: 
397:         _setVirtualBlock(_l2BlockNumber, _maxVirtualBlocksToCreate, _l2BlockTimestamp);
398:     }

```
['[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L84-L84)']
```solidity
84:     function _highestByteSet(uint256 _number) private pure returns (uint256 hbs) { // <= FOUND
85:         unchecked {
86:             if (_number > type(uint128).max) {
87:                 _number >>= 128;
88:                 hbs += 16;
89:             }
90:             if (_number > type(uint64).max) {
91:                 _number >>= 64;
92:                 hbs += 8;
93:             }
94:             if (_number > type(uint32).max) {
95:                 _number >>= 32;
96:                 hbs += 4;
97:             }
98:             if (_number > type(uint16).max) {
99:                 _number >>= 16;
100:                 hbs += 2;
101:             }
102:             if (_number > type(uint8).max) {
103:                 hbs += 1;
104:             }
105:         }
106:     }

```
['[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L100-L100)']
```solidity
100:     function encodeHash(Transaction calldata _transaction) internal view returns (bytes32 resultHash) { // <= FOUND
101:         if (_transaction.txType == LEGACY_TX_TYPE) {
102:             resultHash = _encodeHashLegacyTransaction(_transaction);
103:         } else if (_transaction.txType == EIP_712_TX_TYPE) {
104:             resultHash = _encodeHashEIP712Transaction(_transaction);
105:         } else if (_transaction.txType == EIP_1559_TX_TYPE) {
106:             resultHash = _encodeHashEIP1559Transaction(_transaction);
107:         } else if (_transaction.txType == EIP_2930_TX_TYPE) {
108:             resultHash = _encodeHashEIP2930Transaction(_transaction);
109:         } else {
110:             
111:             
112:             revert("Encoding unsupported tx");
113:         }
114:     }

```
['[147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L147-L147)']
```solidity
147:     function _encodeHashLegacyTransaction(Transaction calldata _transaction) private view returns (bytes32) { // <= FOUND
148:         
149:         
150:         
151:         
152:         
153:         
154: 
155:         bytes memory encodedNonce = RLPEncoder.encodeUint256(_transaction.nonce);
156:         
157:         bytes memory encodedGasParam;
158:         {
159:             bytes memory encodedGasPrice = RLPEncoder.encodeUint256(_transaction.maxFeePerGas);
160:             bytes memory encodedGasLimit = RLPEncoder.encodeUint256(_transaction.gasLimit);
161:             encodedGasParam = bytes.concat(encodedGasPrice, encodedGasLimit);
162:         }
163: 
164:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to)));
165:         bytes memory encodedValue = RLPEncoder.encodeUint256(_transaction.value);
166:         
167:         
168:         bytes memory encodedDataLength;
169:         {
170:             
171:             uint64 txDataLen = uint64(_transaction.data.length);
172:             if (txDataLen != 1) {
173:                 
174:                 encodedDataLength = RLPEncoder.encodeNonSingleBytesLen(txDataLen);
175:             } else if (_transaction.data[0] >= 0x80) {
176:                 
177:                 encodedDataLength = hex"81";
178:             }
179:             
180:         }
181: 
182:         
183:         bytes memory encodedChainId;
184:         if (_transaction.reserved[0] != 0) {
185:             encodedChainId = bytes.concat(RLPEncoder.encodeUint256(block.chainid), hex"80_80");
186:         }
187: 
188:         bytes memory encodedListLength;
189:         unchecked {
190:             uint256 listLength = encodedNonce.length +
191:                 encodedGasParam.length +
192:                 encodedTo.length +
193:                 encodedValue.length +
194:                 encodedDataLength.length +
195:                 _transaction.data.length +
196:                 encodedChainId.length;

```
['[362](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L362-L362)']
```solidity
362:     function processPaymasterInput(Transaction calldata _transaction) internal { // <= FOUND
363:         require(_transaction.paymasterInput.length >= 4, "The standard paymaster input must be at least 4 bytes long");
364: 
365:         bytes4 paymasterInputSelector = bytes4(_transaction.paymasterInput[0:4]);
366:         if (paymasterInputSelector == IPaymasterFlow.approvalBased.selector) {
367:             require(
368:                 _transaction.paymasterInput.length >= 68,
369:                 "The approvalBased paymaster input must be at least 68 bytes long"
370:             );
371: 
372:             
373:             
374:             (address token, uint256 minAllowance) = abi.decode(_transaction.paymasterInput[4:68], (address, uint256));
375:             address paymaster = address(uint160(_transaction.paymaster));
376: 
377:             uint256 currentAllowance = IERC20(token).allowance(address(this), paymaster);
378:             if (currentAllowance < minAllowance) {
379:                 
380:                 
381: 
382:                 IERC20(token).safeApprove(paymaster, 0);
383:                 IERC20(token).safeApprove(paymaster, minAllowance);
384:             }
385:         } else if (paymasterInputSelector == IPaymasterFlow.general.selector) {
386:             
387:         } else {
388:             revert("Unsupported paymaster flow");
389:         }
390:     }

```


</details>

## [NonCritical-73] Incorrect withdraw declaration

### Resolution 
In Solidity, it's essential for clarity and interoperability to correctly specify return types in function declarations. If the `withdraw` function is expected to return a `bool` to indicate success or failure, its omission could lead to ambiguity or unexpected behavior when interacting with or calling this function from other contracts or off-chain systems. Missing return values can mislead developers and potentially lead to contract integrations built on incorrect assumptions. To resolve this, the function declaration for `withdraw` should be modified to explicitly include the `bool` return type, ensuring clarity and correctness in contract interactions.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L72-L72)']
```solidity
72:     function withdraw(address _l1Receiver) external payable override  // <= FOUND

```
['[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L123-L123)']
```solidity
123:     function withdraw(address _l1Receiver, address _l2Token, uint256 _amount) external override  // <= FOUND

```


</details>

## [NonCritical-74] Contract does not follow the Solidity style guide's suggested layout ordering

### Resolution 
Contracts should define structs before modifiers and modifiers before functions.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30-L30)']
```solidity
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step  // <= FOUND

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16-L16)']
```solidity
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step  // <= FOUND

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L23-L23)']
```solidity
23: contract ContractDeployer is IContractDeployer, ISystemContract  // <= FOUND

```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L15-L15)']
```solidity
15: contract L2StandardERC20 is ERC20PermitUpgradeable, IL2StandardToken, ERC1967Upgrade  // <= FOUND

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L25-L25)']
```solidity
25: abstract contract ReentrancyGuard  // <= FOUND

```


</details>

## [NonCritical-75] Contract uses both require()/revert() as well as custom errors

### Resolution 
Consider using one and sticking to it for consistency

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L22-L22)']
```solidity
22: contract ValidatorTimelock is IExecutor, Ownable2Step 

```


</details>

## [NonCritical-76] Unused import

### Resolution 
If these serve no purpose, they should be safely removed

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L25-L25)']
```solidity
25: import {IZkSyncStateTransitionBase} from "../../chain-interfaces/IZkSyncStateTransitionBase.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L5-L5)']
```solidity
5: import {IZkSyncStateTransitionBase} from "../chain-interfaces/IZkSyncStateTransitionBase.sol"; // <= FOUND

```
['[5](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/ILegacyGetters.sol#L5-L5)']
```solidity
5: import {IZkSyncStateTransitionBase} from "./IZkSyncStateTransitionBase.sol"; // <= FOUND

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L10-L10)']
```solidity
10: import {L1_MESSENGER_CONTRACT, INITIAL_WRITE_STARTING_POSITION, COMPRESSED_INITIAL_WRITE_SIZE, STATE_DIFF_ENTRY_SIZE, STATE_DIFF_ENUM_INDEX_OFFSET, STATE_DIFF_FINAL_VALUE_OFFSET, STATE_DIFF_DERIVED_KEY_OFFSET, DERIVED_KEY_LENGTH, VALUE_LENGTH, ENUM_INDEX_LENGTH, KNOWN_CODE_STORAGE_CONTRACT} from "./Constants.sol"; // <= FOUND

```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L15-L15)']
```solidity
15: import {L2ContractHelper, DEPLOYER_SYSTEM_CONTRACT, L2_BASE_TOKEN_ADDRESS, IContractDeployer} from "../L2ContractHelper.sol"; // <= FOUND

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L17-L17)']
```solidity
17: import {ERA_CHAIN_ID, ERA_WETH_ADDRESS} from "../Config.sol"; // <= FOUND

```


</details>

## [NonCritical-77] Consider bounding input array length

### Resolution 
Unbounded array inputs in functions can lead to unintentional excessive gas consumption, potentially causing a transaction to revert after expending substantial gas. To enhance user experience and prevent such scenarios, consider implementing a `require()` statement that limits the array length to a defined maximum. This constraint ensures that transactions won't proceed if they're likely to hit gas limits due to array size, saving users from unnecessary gas costs and offering a more predictable interaction with the contract.

Num of instances: 7

### Findings 


<details><summary>Click to show findings</summary>

['[225](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L225-L225)']
```solidity
225:        for (uint256 i = 0; i < _calls.length; ++i) { // <= FOUND
226:             (bool success, bytes memory returnData) = _calls[i].target.call{value: _calls[i].value}(_calls[i].data);
227:             if (!success) {
228:                 
229:                 assembly {
230:                     revert(add(returnData, 0x20), mload(returnData))
231:                 }
232:             }
233:         }

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L142-L142)']
```solidity
142:        for (uint256 i = 0; i < emittedL2Logs.length; i = i.uncheckedAdd(L2_TO_L1_LOG_SERIALIZE_SIZE)) { // <= FOUND
143:             
144:             (address logSender, ) = UnsafeBytes.readAddress(emittedL2Logs, i + L2_LOG_ADDRESS_OFFSET);
145:             (uint256 logKey, ) = UnsafeBytes.readUint256(emittedL2Logs, i + L2_LOG_KEY_OFFSET);
146:             (bytes32 logValue, ) = UnsafeBytes.readBytes32(emittedL2Logs, i + L2_LOG_VALUE_OFFSET);
147: 
148:             
149:             require(!_checkBit(processedLogs, uint8(logKey)), "kp");
150:             processedLogs = _setBit(processedLogs, uint8(logKey));
151: 
152:             
153:             if (logKey == uint256(SystemLogKey.L2_TO_L1_LOGS_TREE_ROOT_KEY)) {
154:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "lm");
155:                 logOutput.l2LogsTreeRoot = logValue;
156:             } else if (logKey == uint256(SystemLogKey.TOTAL_L2_TO_L1_PUBDATA_KEY)) {
157:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "ln");
158:                 logOutput.pubdataHash = logValue;
159:             } else if (logKey == uint256(SystemLogKey.STATE_DIFF_HASH_KEY)) {
160:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "lb");
161:                 logOutput.stateDiffHash = logValue;
162:             } else if (logKey == uint256(SystemLogKey.PACKED_BATCH_AND_L2_BLOCK_TIMESTAMP_KEY)) {
163:                 require(logSender == L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, "sc");
164:                 logOutput.packedBatchAndL2BlockTimestamp = uint256(logValue);
165:             } else if (logKey == uint256(SystemLogKey.PREV_BATCH_HASH_KEY)) {
166:                 require(logSender == L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, "sv");
167:                 logOutput.previousBatchHash = logValue;
168:             } else if (logKey == uint256(SystemLogKey.CHAINED_PRIORITY_TXN_HASH_KEY)) {
169:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bl");
170:                 logOutput.chainedPriorityTxsHash = logValue;
171:             } else if (logKey == uint256(SystemLogKey.NUMBER_OF_LAYER_1_TXS_KEY)) {
172:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bk");
173:                 logOutput.numberOfLayer1Txs = uint256(logValue);
174:             } else if (logKey == uint256(SystemLogKey.BLOB_ONE_HASH_KEY)) {
175:                 require(logSender == L2_PUBDATA_CHUNK_PUBLISHER_ADDR, "pc");
176:                 logOutput.blob1Hash = logValue;
177:             } else if (logKey == uint256(SystemLogKey.BLOB_TWO_HASH_KEY)) {
178:                 require(logSender == L2_PUBDATA_CHUNK_PUBLISHER_ADDR, "pd");
179:                 logOutput.blob2Hash = logValue;
180:             } else if (logKey == uint256(SystemLogKey.EXPECTED_SYSTEM_CONTRACT_UPGRADE_TX_HASH_KEY)) {
181:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bu");
182:                 require(_expectedSystemContractUpgradeTxHash == logValue, "ut");
183:             } else {
184:                 revert("ul");
185:             }
186:         }

```
['[257](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L257-L257)']
```solidity
257:        for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) { // <= FOUND
258:             _lastCommittedBatchData = _commitOneBatch(_lastCommittedBatchData, _newBatchesData[i], bytes32(0));
259: 
260:             s.storedBatchHashes[_lastCommittedBatchData.batchNumber] = _hashStoredBatchInfo(_lastCommittedBatchData);
261:             emit BlockCommit(
262:                 _lastCommittedBatchData.batchNumber,
263:                 _lastCommittedBatchData.batchHash,
264:                 _lastCommittedBatchData.commitment
265:             );
266:         }

```
['[289](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L289-L289)']
```solidity
289:        for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) { // <= FOUND
290:             
291:             bytes32 expectedUpgradeTxHash = i == 0 ? _systemContractUpgradeTxHash : bytes32(0);
292:             _lastCommittedBatchData = _commitOneBatch(
293:                 _lastCommittedBatchData,
294:                 _newBatchesData[i],
295:                 expectedUpgradeTxHash
296:             );
297: 
298:             s.storedBatchHashes[_lastCommittedBatchData.batchNumber] = _hashStoredBatchInfo(_lastCommittedBatchData);
299:             emit BlockCommit(
300:                 _lastCommittedBatchData.batchNumber,
301:                 _lastCommittedBatchData.batchHash,
302:                 _lastCommittedBatchData.commitment
303:             );
304:         }

```
['[636](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L636-L636)']
```solidity
636:        for (uint256 i = 0; i < _pubdataCommitments.length; i += PUBDATA_COMMITMENT_SIZE) { // <= FOUND
637:             bytes32 blobVersionedHash = _getBlobVersionedHash(versionedHashIndex);
638: 
639:             require(blobVersionedHash != bytes32(0), "vh");
640: 
641:             
642:             
643:             bytes32 openingPoint = bytes32(
644:                 uint256(uint128(bytes16(_pubdataCommitments[i:i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET])))
645:             );
646: 
647:             _pointEvaluationPrecompile(
648:                 blobVersionedHash,
649:                 openingPoint,
650:                 _pubdataCommitments[i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET:i + PUBDATA_COMMITMENT_SIZE]
651:             );
652: 
653:             
654:             blobCommitments[versionedHashIndex] = keccak256(
655:                 abi.encodePacked(blobVersionedHash, _pubdataCommitments[i:i + PUBDATA_COMMITMENT_COMMITMENT_OFFSET])
656:             );
657:             versionedHashIndex += 1;
658:         }

```
['[226](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L226-L226)']
```solidity
226:        for (uint256 i = 0; i < _factoryDeps.length; ++i) { // <= FOUND
227:             require(
228:                 L2ContractHelper.hashL2Bytecode(_factoryDeps[i]) == bytes32(_expectedHashes[i]),
229:                 "Wrong factory dep hash"
230:             );
231:         }

```
['[107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L107-L107)']
```solidity
101:        for (uint256 i = 0; i < facetCutsLength; i = i.uncheckedInc()) {
102:             Action action = facetCuts[i].action;
103:             address facet = facetCuts[i].facet;
104:             bool isFacetFreezable = facetCuts[i].isFreezable;
105:             bytes4[] memory selectors = facetCuts[i].selectors;
106: 
107:             require(selectors.length > 0, "B");  // <= FOUND
108: 
109:             if (action == Action.Add) {
110:                 _addFunctions(facet, selectors, isFacetFreezable);
111:             } else if (action == Action.Replace) {
112:                 _replaceFunctions(facet, selectors, isFacetFreezable);
113:             } else if (action == Action.Remove) {
114:                 _removeFunctions(facet, selectors);
115:             } else {
116:                 revert("C"); 
117:             }
118:         }

```


</details>

## [NonCritical-78] Missing events in sensitive functions

### Resolution 
Sensitive setter functions in smart contracts often alter critical state variables. Without events emitted in these functions, external observers or dApps cannot easily track or react to these state changes. Missing events can obscure contract activity, hampering transparency and making integration more challenging. To resolve this, incorporate appropriate event emissions within these functions. Events offer an efficient way to log crucial changes, aiding in real-time tracking and post-transaction verification.

Num of instances: 21

### Findings 


<details><summary>Click to show findings</summary>

['[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L108-L108)']
```solidity
108:     function setSharedBridge(address _sharedBridge) external onlyOwner { // <= FOUND
109:         sharedBridge = IL1SharedBridge(_sharedBridge);
110:     }

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132-L132)']
```solidity
132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin { // <= FOUND
133:         validatorTimelock = _validatorTimelock;
134:     }

```
['[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L137-L137)']
```solidity
137:     function setInitialCutHash(Diamond.DiamondCutData calldata _diamondCut) external onlyOwner { // <= FOUND
138:         initialCutHash = keccak256(abi.encode(_diamondCut));
139:     }

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L142-L142)']
```solidity
142:     function setNewVersionUpgrade( // <= FOUND
143:         Diamond.DiamondCutData calldata _cutData,
144:         uint256 _oldProtocolVersion,
145:         uint256 _newProtocolVersion
146:     ) external onlyOwner {
147:         upgradeCutHash[_oldProtocolVersion] = keccak256(abi.encode(_cutData));
148:         protocolVersion = _newProtocolVersion;
149:     }

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L152-L152)']
```solidity
152:     function setUpgradeDiamondCut( // <= FOUND
153:         Diamond.DiamondCutData calldata _cutData,
154:         uint256 _oldProtocolVersion
155:     ) external onlyOwner {
156:         upgradeCutHash[_oldProtocolVersion] = keccak256(abi.encode(_cutData));
157:     }

```
['[73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L73-L73)']
```solidity
73:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner { // <= FOUND
74:         stateTransitionManager = _stateTransitionManager;
75:     }

```
['[38](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L38-L38)']
```solidity
38:     function set(Uint32Map storage _map, uint256 _index, uint32 _value) internal { // <= FOUND
39:         unchecked {
40:             
41:             
42:             
43:             uint256 mapIndex = _index / 8;
44:             uint256 mapValue = _map.map[mapIndex];
45: 
46:             
47:             
48:             uint256 bitOffset = (_index & 7) * 32;
49: 
50:             
51:             
52: 
53:             
54:             uint32 oldValue = uint32(mapValue >> bitOffset);
55: 
56:             
57:             uint256 newValueXorOldValue = uint256(oldValue ^ _value);
58: 
59:             
60:             
61:             _map.map[mapIndex] = (newValueXorOldValue << bitOffset) ^ mapValue;
62:         }
63:     }

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L34-L34)']
```solidity
34:     function setImmutables(address _dest, ImmutableData[] calldata _immutables) external override { // <= FOUND
35:         require(msg.sender == address(DEPLOYER_SYSTEM_CONTRACT), "Callable only by the deployer system contract");
36:         unchecked {
37:             uint256 immutablesLength = _immutables.length;
38:             for (uint256 i = 0; i < immutablesLength; ++i) {
39:                 uint256 index = _immutables[i].index;
40:                 bytes32 value = _immutables[i].value;
41:                 immutableDataStorage[uint256(uint160(_dest))][index] = value;
42:             }
43:         }
44:     }

```
['[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L84-L84)']
```solidity
84:     function setChainId(uint256 _newChainId) external onlyCallFromForceDeployer { // <= FOUND
85:         chainId = _newChainId;
86:     }

```
['[99](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L99-L99)']
```solidity
99:     function setTxOrigin(address _newOrigin) external onlyCallFromBootloader { // <= FOUND
100:         origin = _newOrigin;
101:     }

```
['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L105-L105)']
```solidity
105:     function setGasPrice(uint256 _gasPrice) external onlyCallFromBootloader { // <= FOUND
106:         gasPrice = _gasPrice;
107:     }

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L112-L112)']
```solidity
112:     function setPubdataInfo(uint256 _gasPerPubdataByte, uint256 _basePubdataSpent) external onlyCallFromBootloader { // <= FOUND
113:         basePubdataSpent = _basePubdataSpent;
114:         gasPerPubdataByte = _gasPerPubdataByte;
115:     }

```
['[341](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L341-L341)']
```solidity
341:     function setL2Block( // <= FOUND
342:         uint128 _l2BlockNumber,
343:         uint128 _l2BlockTimestamp,
344:         bytes32 _expectedPrevL2BlockHash,
345:         bool _isFirstInBatch,
346:         uint128 _maxVirtualBlocksToCreate
347:     ) external onlyCallFromBootloader {
348:         
349:         if (_isFirstInBatch) {
350:             uint128 currentBatchTimestamp = currentBatchInfo.timestamp;
351:             require(
352:                 _l2BlockTimestamp >= currentBatchTimestamp,
353:                 "The timestamp of the L2 block must be greater than or equal to the timestamp of the current batch"
354:             );
355:             require(_maxVirtualBlocksToCreate > 0, "There must be a virtual block created at the start of the batch");
356:         }
357: 
358:         (uint128 currentL2BlockNumber, uint128 currentL2BlockTimestamp) = getL2BlockNumberAndTimestamp();
359: 
360:         if (currentL2BlockNumber == 0 && currentL2BlockTimestamp == 0) {
361:             
362:             
363:             _upgradeL2Blocks(_l2BlockNumber, _expectedPrevL2BlockHash, _isFirstInBatch);
364: 
365:             _setNewL2BlockData(_l2BlockNumber, _l2BlockTimestamp, _expectedPrevL2BlockHash);
366:         } else if (currentL2BlockNumber == _l2BlockNumber) {
367:             require(!_isFirstInBatch, "Can not reuse L2 block number from the previous batch");
368:             require(currentL2BlockTimestamp == _l2BlockTimestamp, "The timestamp of the same L2 block must be same");
369:             require(
370:                 _expectedPrevL2BlockHash == _getLatest257L2blockHash(_l2BlockNumber - 1),
371:                 "The previous hash of the same L2 block must be same"
372:             );
373:             require(_maxVirtualBlocksToCreate == 0, "Can not create virtual blocks in the middle of the miniblock");
374:         } else if (currentL2BlockNumber + 1 == _l2BlockNumber) {
375:             
376:             bytes32 prevL2BlockHash = _getLatest257L2blockHash(currentL2BlockNumber - 1);
377: 
378:             bytes32 pendingL2BlockHash = _calculateL2BlockHash(
379:                 currentL2BlockNumber,
380:                 currentL2BlockTimestamp,
381:                 prevL2BlockHash,
382:                 currentL2BlockTxsRollingHash
383:             );
384: 
385:             require(_expectedPrevL2BlockHash == pendingL2BlockHash, "The current L2 block hash is incorrect");
386:             require(
387:                 _l2BlockTimestamp > currentL2BlockTimestamp,
388:                 "The timestamp of the new L2 block must be greater than the timestamp of the previous L2 block"
389:             );
390: 

```
['[444](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L444-L444)']
```solidity
444:     function setNewBatch( // <= FOUND
445:         bytes32 _prevBatchHash,
446:         uint128 _newTimestamp,
447:         uint128 _expectedNewNumber,
448:         uint256 _baseFee
449:     ) external onlyCallFromBootloader {
450:         (uint128 previousBatchNumber, uint128 previousBatchTimestamp) = getBatchNumberAndTimestamp();
451:         require(_newTimestamp > previousBatchTimestamp, "Timestamps should be incremental");
452:         require(previousBatchNumber + 1 == _expectedNewNumber, "The provided block number is not correct");
453: 
454:         _ensureBatchConsistentWithL2Block(_newTimestamp);
455: 
456:         batchHashes[previousBatchNumber] = _prevBatchHash;
457: 
458:         
459:         BlockInfo memory newBlockInfo = BlockInfo({number: previousBatchNumber + 1, timestamp: _newTimestamp});
460: 
461:         currentBatchInfo = newBlockInfo;
462: 
463:         baseFee = _baseFee;
464: 
465:         
466:         SystemContractHelper.toL1(false, bytes32(uint256(SystemLogKey.PREV_BATCH_HASH_KEY)), _prevBatchHash);
467:     }

```
['[168](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L168-L168)']
```solidity
168:     function setValueForNextFarCall(uint128 _value) internal returns (bool success) { // <= FOUND
169:         uint256 cleanupMask = UINT128_MASK;
170:         address callAddr = SET_CONTEXT_VALUE_CALL_ADDRESS;
171:         assembly {
172:             
173:             _value := and(_value, cleanupMask)
174:             success := call(0, callAddr, _value, 0, 0xFFFF, 0, 0)
175:         }
176:     }

```
['[597](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L597-L597)']
```solidity
597:     function _setBit(uint256 _bitMap, uint8 _index) internal pure returns (uint256) { // <= FOUND
598:         return _bitMap | (1 << _index);
599:     }

```
['[171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L171-L171)']
```solidity
171:     function _setBaseSystemContracts(bytes32 _bootloaderHash, bytes32 _defaultAccountHash) internal { // <= FOUND
172:         _setL2BootloaderBytecodeHash(_bootloaderHash);
173:         _setL2DefaultAccountBytecodeHash(_defaultAccountHash);
174:     }

```
['[180](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L180-L180)']
```solidity
180:     function _setL2SystemContractUpgrade( // <= FOUND
181:         L2CanonicalTransaction calldata _l2ProtocolUpgradeTx,
182:         bytes[] calldata _factoryDeps,
183:         uint256 _newProtocolVersion
184:     ) internal returns (bytes32) {
185:         
186:         if (_l2ProtocolUpgradeTx.txType == 0) {
187:             return bytes32(0);
188:         }
189: 
190:         require(_l2ProtocolUpgradeTx.txType == SYSTEM_UPGRADE_L2_TX_TYPE, "L2 system upgrade tx type is wrong");
191: 
192:         bytes memory encodedTransaction = abi.encode(_l2ProtocolUpgradeTx);
193: 
194:         TransactionValidator.validateL1ToL2Transaction(
195:             _l2ProtocolUpgradeTx,
196:             encodedTransaction,
197:             s.priorityTxMaxGasLimit,
198:             s.feeParams.priorityTxMaxPubdata
199:         );
200: 
201:         TransactionValidator.validateUpgradeTransaction(_l2ProtocolUpgradeTx);
202: 
203:         
204:         
205:         require(
206:             _l2ProtocolUpgradeTx.nonce == _newProtocolVersion,
207:             "The new protocol version should be included in the L2 system upgrade tx"
208:         );
209: 
210:         _verifyFactoryDeps(_factoryDeps, _l2ProtocolUpgradeTx.factoryDeps);
211: 
212:         bytes32 l2ProtocolUpgradeTxHash = keccak256(encodedTransaction);
213: 
214:         s.l2SystemContractsUpgradeTxHash = l2ProtocolUpgradeTxHash;
215: 
216:         return l2ProtocolUpgradeTxHash;
217:     }

```
['[212](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L212-L212)']
```solidity
212:     function _setL2BlockHash(uint256 _block, bytes32 _hash) internal { // <= FOUND
213:         l2BlockHash[_block % MINIBLOCK_HASHES_TO_STORE] = _hash;
214:     }

```
['[263](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L263-L263)']
```solidity
263:     function _setVirtualBlock( // <= FOUND
264:         uint128 _l2BlockNumber,
265:         uint128 _maxVirtualBlocksToCreate,
266:         uint128 _newTimestamp
267:     ) internal {
268:         if (virtualBlockUpgradeInfo.virtualBlockFinishL2Block != 0) {
269:             
270:             
271:             currentVirtualL2BlockInfo = currentL2BlockInfo;
272:             return;
273:         }
274: 
275:         BlockInfo memory virtualBlockInfo = currentVirtualL2BlockInfo;
276: 
277:         if (currentVirtualL2BlockInfo.number == 0 && virtualBlockInfo.timestamp == 0) {
278:             uint128 currentBatchNumber = currentBatchInfo.number;
279: 
280:             
281:             
282:             
283:             virtualBlockInfo.number = currentBatchNumber;
284:             
285:             virtualBlockUpgradeInfo.virtualBlockStartBatch = currentBatchNumber;
286: 
287:             require(_maxVirtualBlocksToCreate > 0, "Can't initialize the first virtual block");
288:             _maxVirtualBlocksToCreate -= 1;
289:         } else if (_maxVirtualBlocksToCreate == 0) {
290:             
291:             
292:             return;
293:         }
294: 
295:         virtualBlockInfo.number += _maxVirtualBlocksToCreate;
296:         virtualBlockInfo.timestamp = _newTimestamp;
297: 
298:         
299:         
300:         
301:         
302:         if (virtualBlockInfo.number >= _l2BlockNumber) {
303:             virtualBlockUpgradeInfo.virtualBlockFinishL2Block = _l2BlockNumber;
304:             virtualBlockInfo.number = _l2BlockNumber;
305:         }
306: 
307:         currentVirtualL2BlockInfo = virtualBlockInfo;
308:     }

```
['[314](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L314-L314)']
```solidity
314:     function _setNewL2BlockData(uint128 _l2BlockNumber, uint128 _l2BlockTimestamp, bytes32 _prevL2BlockHash) internal { // <= FOUND
315:         
316:         currentL2BlockInfo = BlockInfo({number: _l2BlockNumber, timestamp: _l2BlockTimestamp});
317: 
318:         
319:         _setL2BlockHash(_l2BlockNumber - 1, _prevL2BlockHash);
320: 
321:         
322:         currentL2BlockTxsRollingHash = bytes32(0);
323:     }

```


</details>

## [NonCritical-79] Unchecked increments can overflow

### Resolution 
Unchecked increments in variables can lead to overflow, causing values to wrap around unexpectedly. This can disrupt contract logic. Always validate before incrementing.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L85-L103)']
```solidity
85:        unchecked {
86:             if (_number > type(uint128).max) {
87:                 _number >>= 128;
88:                 hbs += 16; // <= FOUND
89:             }
90:             if (_number > type(uint64).max) {
91:                 _number >>= 64;
92:                 hbs += 8;
93:             }
94:             if (_number > type(uint32).max) {
95:                 _number >>= 32;
96:                 hbs += 4;
97:             }
98:             if (_number > type(uint16).max) {
99:                 _number >>= 16;
100:                 hbs += 2;
101:             }
102:             if (_number > type(uint8).max) {
103:                 hbs += 1; // <= FOUND
104:             }
105:         }

```


</details>

## [NonCritical-80] Consider implementing EIP-5267 to securely describe EIP-712 domains being used

### Resolution 
EIP-5267 aims to enhance EIP-712, which standardizes Ethereum's structured data signing. While EIP-712 defines how structured data should be signed, EIP-5267 focuses on standardizing the representation of domains. By doing so, it allows applications to fetch domain descriptions and dynamically construct domain separators, aiding in secure EIP-712 signature integration. To implement EIP-5267, contracts should expose a consistent method (e.g., `EIP712Domain()`) returning the domain's description. Adopting this ensures that applications can universally and securely handle EIP-712 signatures across various contracts, enhancing both security and scalability in Ethereum applications.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L82-L83)']
```solidity
82:     
83:     bytes32 constant EIP712_DOMAIN_TYPEHASH = keccak256("EIP712Domain(string name,string version,uint256 chainId)"); // <= FOUND

```


</details>

## [NonCritical-81] Unused local variable

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L262-L302)']
```solidity
262:     function requestL2TransactionTwoBridges(
263:         L2TransactionRequestTwoBridgesOuter calldata _request
264:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash) {
265:         {
266:             address token = baseToken[_request.chainId];
267:             uint256 baseTokenMsgValue;
268:             if (token == ETH_TOKEN_ADDRESS) {
269:                 require(
270:                     msg.value == _request.mintValue + _request.secondBridgeValue,
271:                     "Bridgehub: msg.value mismatch 2"
272:                 );
273:                 baseTokenMsgValue = _request.mintValue;
274:             } else {
275:                 require(msg.value == _request.secondBridgeValue, "Bridgehub: msg.value mismatch 3");
276:                 baseTokenMsgValue = 0;
277:             }
278:             sharedBridge.bridgehubDepositBaseToken{value: baseTokenMsgValue}(
279:                 _request.chainId,
280:                 msg.sender,
281:                 token,
282:                 _request.mintValue
283:             );
284:         }
285: 
286:         address stateTransition = getStateTransition(_request.chainId);
287: 
288:         L2TransactionRequestTwoBridgesInner memory outputRequest = IL1SharedBridge(_request.secondBridgeAddress)
289:             .bridgehubDeposit{value: _request.secondBridgeValue}(
290:             _request.chainId,
291:             msg.sender,
292:             _request.l2Value,
293:             _request.secondBridgeCalldata
294:         );
295: 
296:         require(outputRequest.magicValue == TWO_BRIDGES_MAGIC_VALUE, "Bridgehub: magic value mismatch");
297: 
298:         address refundRecipient = _actualRefundRecipient(_request.refundRecipient);
299: 
300:         require(
301:             _request.secondBridgeAddress > BRIDGEHUB_MIN_SECOND_BRIDGE_ADDRESS,
302:             "Bridgehub: second bridge address too low" // <= FOUND 'too'
303:         ); 
304:         canonicalTxHash = IZkSyncStateTransition(stateTransition).bridgehubRequestL2Transaction(
305:             BridgehubL2TransactionRequest({
306:                 sender: _request.secondBridgeAddress,
307:                 contractL2: outputRequest.l2Contract,
308:                 mintValue: _request.mintValue,
309:                 l2Value: _request.l2Value,
310:                 l2Calldata: outputRequest.l2Calldata,
311:                 l2GasLimit: _request.l2GasLimit,
312:                 l2GasPerPubdataByteLimit: _request.l2GasPerPubdataByteLimit,
313:                 factoryDeps: outputRequest.factoryDeps,
314:                 refundRecipient: refundRecipient
315:             })
316:         );
317: 
318:         IL1SharedBridge(_request.secondBridgeAddress).bridgehubConfirmL2Transaction(
319:             _request.chainId,
320:             outputRequest.txDataHash,
321:             canonicalTxHash
322:         );
323:     }

```


</details>

## [NonCritical-82] Ensure block.timestamp is only used in long time intervals

### Resolution 
`block.timestamp` represents the current block's timestamp and can be influenced, within limits, by miners. For short time intervals, this malleability can be exploited, potentially allowing miners to manipulate contract behavior. For instance, they might fast-forward an expiration or delay an event. When designing smart contracts, if precise time checks are needed for short intervals, alternatives like block numbers can be considered. However, for longer durations where a few seconds of deviation is inconsequential, `block.timestamp` is generally safe and efficient. Always assess the implications of time manipulations for the specific use-case before utilizing `block.timestamp`. In practice, if you're using block.timestamp to measure intervals that are a matter of days, weeks, or longer, the potential manipulation by miners becomes less significant. Always prioritize the security and integrity of your smart contract operations when making these decisions.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[219](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L219-L219)']
```solidity
219:         timestamps[_id] = block.timestamp + _delay; // <= FOUND

```
['[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L123-L123)']
```solidity
123:         require(lastL2BlockTimestamp <= block.timestamp + COMMIT_TIMESTAMP_APPROXIMATION_DELTA, "h2");  // <= FOUND

```
['[283](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L283-L284)']
```solidity
283:         
284:         _params.expirationTimestamp = uint64(block.timestamp + PRIORITY_EXPIRATION);  // <= FOUND

```


</details>

## [NonCritical-83] Don't assume specific ETH balance

### Resolution 
ETH balances can change due to gas costs, miner reordering, or unexpected transactions. Directly comparing an expected balance with `==` or `!=` can lead to unpredictable results. Instead, use range checks or require a minimum balance. For instance, instead of requiring an exact balance, check if an account's balance is within an acceptable range or above a certain threshold. This provides flexibility and accounts for slight variations that might occur due to the dynamic nature of blockchain transactions and fees. By avoiding exact balance checks, smart contracts can avoid unintentional failures and enhance robustness.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[155](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L155-L155)']
```solidity
155:             require(msg.value == _amount, "L1SharedBridge: msg.value not equal to amount"); // <= FOUND

```
['[223](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L223-L223)']
```solidity
223:                 require(msg.value == _request.mintValue, "Bridgehub: msg.value mismatch 1"); // <= FOUND

```
['[269](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L269-L270)']
```solidity
269:                 require(
270:                     msg.value == _request.mintValue + _request.secondBridgeValue, // <= FOUND
271:                     "Bridgehub: msg.value mismatch 2"
272:                 );

```
['[275](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L275-L275)']
```solidity
275:                 require(msg.value == _request.secondBridgeValue, "Bridgehub: msg.value mismatch 3"); // <= FOUND

```
['[251](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L251-L251)']
```solidity
251:         require(msg.value == sumOfValues, "`value` provided is not equal to the combined `value`s of deployments"); // <= FOUND

```


</details>

## [NonCritical-84] Avoid mutating function parameters

### Resolution 
Function parameters in Solidity are passed by value, meaning they are essentially local copies. Mutating them can lead to confusion and errors because the changes don't persist outside the function. By keeping function parameters immutable, you ensure clarity in code behavior, preventing unintended side-effects. If you need to modify a value based on a parameter, use a local variable inside the function, leaving the original parameter unaltered. By adhering to this practice, you maintain a clear distinction between input data and the internal processing logic, improving code readability and reducing the potential for bugs.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[253](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L253-L258)']
```solidity
253:     function _commitBatchesWithoutSystemContractsUpgrade(
254:         StoredBatchInfo memory _lastCommittedBatchData,
255:         CommitBatchInfo[] calldata _newBatchesData
256:     ) internal {
257:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) {
258:             _lastCommittedBatchData = _commitOneBatch(_lastCommittedBatchData, _newBatchesData[i], bytes32(0)); // <= FOUND
259: 
260:             s.storedBatchHashes[_lastCommittedBatchData.batchNumber] = _hashStoredBatchInfo(_lastCommittedBatchData);
261:             emit BlockCommit(
262:                 _lastCommittedBatchData.batchNumber,
263:                 _lastCommittedBatchData.batchHash,
264:                 _lastCommittedBatchData.commitment
265:             );
266:         }
267:     }

```
['[273](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L273-L292)']
```solidity
273:     function _commitBatchesWithSystemContractsUpgrade(
274:         StoredBatchInfo memory _lastCommittedBatchData,
275:         CommitBatchInfo[] calldata _newBatchesData,
276:         bytes32 _systemContractUpgradeTxHash
277:     ) internal {
278:         
279:         
280:         
281: 
282:         
283:         
284:         require(s.l2SystemContractsUpgradeBatchNumber == 0, "ik");
285: 
286:         
287:         s.l2SystemContractsUpgradeBatchNumber = _newBatchesData[0].batchNumber;
288: 
289:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) {
290:             
291:             bytes32 expectedUpgradeTxHash = i == 0 ? _systemContractUpgradeTxHash : bytes32(0);
292:             _lastCommittedBatchData = _commitOneBatch( // <= FOUND
293:                 _lastCommittedBatchData,
294:                 _newBatchesData[i],
295:                 expectedUpgradeTxHash
296:             );
297: 
298:             s.storedBatchHashes[_lastCommittedBatchData.batchNumber] = _hashStoredBatchInfo(_lastCommittedBatchData);
299:             emit BlockCommit(
300:                 _lastCommittedBatchData.batchNumber,
301:                 _lastCommittedBatchData.batchHash,
302:                 _lastCommittedBatchData.commitment
303:             );
304:         }
305:     }

```
['[263](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L263-L288)']
```solidity
263:     function _setVirtualBlock(
264:         uint128 _l2BlockNumber,
265:         uint128 _maxVirtualBlocksToCreate,
266:         uint128 _newTimestamp
267:     ) internal {
268:         if (virtualBlockUpgradeInfo.virtualBlockFinishL2Block != 0) {
269:             
270:             
271:             currentVirtualL2BlockInfo = currentL2BlockInfo;
272:             return;
273:         }
274: 
275:         BlockInfo memory virtualBlockInfo = currentVirtualL2BlockInfo;
276: 
277:         if (currentVirtualL2BlockInfo.number == 0 && virtualBlockInfo.timestamp == 0) {
278:             uint128 currentBatchNumber = currentBatchInfo.number;
279: 
280:             
281:             
282:             
283:             virtualBlockInfo.number = currentBatchNumber;
284:             
285:             virtualBlockUpgradeInfo.virtualBlockStartBatch = currentBatchNumber;
286: 
287:             require(_maxVirtualBlocksToCreate > 0, "Can't initialize the first virtual block");
288:             _maxVirtualBlocksToCreate -= 1; // <= FOUND
289:         } else if (_maxVirtualBlocksToCreate == 0) {
290:             
291:             
292:             return;
293:         }
294: 
295:         virtualBlockInfo.number += _maxVirtualBlocksToCreate;
296:         virtualBlockInfo.timestamp = _newTimestamp;
297: 
298:         
299:         
300:         
301:         
302:         if (virtualBlockInfo.number >= _l2BlockNumber) {
303:             virtualBlockUpgradeInfo.virtualBlockFinishL2Block = _l2BlockNumber;
304:             virtualBlockInfo.number = _l2BlockNumber;
305:         }
306: 
307:         currentVirtualL2BlockInfo = virtualBlockInfo;
308:     }

```


</details>

## [NonCritical-85] Don't only depend on Solidity's arithmetic ordering.

### Resolution 
Relying on Solidity's default arithmetic operator precedence can lead to misunderstood or overlooked nuances in code execution. Misinterpretation risks can be significant, especially when different developers or auditors review the code. To ensure clarity and minimize potential errors, it's recommended to use parentheses. These not only override the default precedence when needed but also emphasize the intended order of operations. By deliberately showing the intended calculation sequence using parentheses, developers make the code's logic explicit, reducing the risk of unintended behaviors and making the codebase more maintainable and understandable for all stakeholders.

Num of instances: 8

### Findings 


<details><summary>Click to show findings</summary>

['[582](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L582-L582)']
```solidity
582:             blobAuxOutputWords[i * 2 + 1] = _blobCommitments[i]; // <= FOUND

```
['[98](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L98-L99)']
```solidity
98:             
99:             costForPubdata += _numberOfFactoryDependencies * L1_TX_DELTA_FACTORY_DEPS_PUBDATA * _l2GasPricePerPubdata; // <= FOUND

```
['[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Config.sol#L14-L14)']
```solidity
14: uint256 constant MAX_L2_TO_L1_LOGS_COMMITMENT_BYTES = 4 + L2_TO_L1_LOG_SERIALIZE_SIZE * 512; // <= FOUND

```
['[97](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L97-L97)']
```solidity
97:                 vInt += 8 + block.chainid * 2; // <= FOUND

```
['[203](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L203-L203)']
```solidity
203:             dictionary = _rawCompressedData[2:2 + dictionaryLen * 8]; // <= FOUND

```
['[204](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L204-L204)']
```solidity
204:             encodedData = _rawCompressedData[2 + dictionaryLen * 8:]; // <= FOUND

```
['[411](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L411-L412)']
```solidity
411:             
412:             requiredBalance = _transaction.maxFeePerGas * _transaction.gasLimit + _transaction.value; // <= FOUND

```
['[94](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L94-L94)']
```solidity
94: uint256 constant MAX_MSG_VALUE = 2 ** 128 - 1; // <= FOUND

```


</details>

## [NonCritical-86] Contracts with only unimplemented functions can be labeled as abstract

### Resolution 
In Solidity, a contract that's not meant to be deployed on its own but is intended to be inherited by other contracts should be marked `abstract`. This ensures that developers recognize the contract's incomplete or intended-to-be-extended nature. If a contract has unimplemented functions or is designed with the intention that another contract should extend its functionality, it should be explicitly labeled as `abstract`. This helps prevent inadvertent deployments and clearly communicates the contract's purpose to other developers. Resolution: Review the contract, and if it's not supposed to function standalone, mark it as `abstract` to make the intention clear.

Num of instances: 24

### Findings 


<details><summary>Click to show findings</summary>

['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L18-L18)']
```solidity
18: contract AdminFacet is ZkSyncStateTransitionBase, IAdmin 

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L22-L22)']
```solidity
22: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor 

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L20-L20)']
```solidity
20: contract GettersFacet is ZkSyncStateTransitionBase, IGetters, ILegacyGetters 

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L30-L30)']
```solidity
30: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox 

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L11-L11)']
```solidity
11: contract ZkSyncStateTransitionBase is ReentrancyGuard 

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L10-L10)']
```solidity
10: contract DefaultUpgrade is BaseZkSyncUpgrade 

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/GenesisUpgrade.sol#L11-L11)']
```solidity
11: contract GenesisUpgrade is BaseZkSyncUpgradeGenesis 

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L22-L22)']
```solidity
22: contract AccountCodeStorage is IAccountCodeStorage 

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L16-L16)']
```solidity
16: contract BootloaderUtilities is IBootloaderUtilities 

```
['[14](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L14-L14)']
```solidity
14: contract ComplexUpgrader is IComplexUpgrader 

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L22-L22)']
```solidity
22: contract Compressor is ICompressor, ISystemContract 

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L23-L23)']
```solidity
23: contract ContractDeployer is IContractDeployer, ISystemContract 

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L19-L19)']
```solidity
19: contract DefaultAccount is IAccount 

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L10-L10)']
```solidity
10: contract EmptyContract 

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L18-L18)']
```solidity
18: contract ImmutableSimulator is IImmutableSimulator 

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L18-L18)']
```solidity
18: contract KnownCodesStorage is IKnownCodesStorage, ISystemContract 

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L25-L25)']
```solidity
25: contract L1Messenger is IL1Messenger, ISystemContract 

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L18-L18)']
```solidity
18: contract L2BaseToken is IBaseToken, ISystemContract 

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L19-L19)']
```solidity
19: contract MsgValueSimulator is ISystemContract 

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L27-L27)']
```solidity
27: contract NonceHolder is INonceHolder, ISystemContract 

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L16-L16)']
```solidity
16: contract PubdataChunkPublisher is IPubdataChunkPublisher, ISystemContract 

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L17-L17)']
```solidity
17: contract SystemContext is ISystemContext, ISystemContextDeprecated, ISystemContract 

```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L15-L15)']
```solidity
15: contract GasBoundCaller 

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/ForceDeployUpgrader.sol#L10-L10)']
```solidity
10: contract ForceDeployUpgrader 

```


</details>

## [NonCritical-87] A event should be emitted if a non immutable state variable is set in a constructor

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L55-L56)']
```solidity
55:     constructor(IL1SharedBridge _sharedBridge) reentrancyGuardInitializer {
56:         sharedBridge = _sharedBridge; // <= FOUND
57:     }

```
['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L55-L57)']
```solidity
55:     constructor(address _initialOwner, uint32 _executionDelay) {
56:         _transferOwnership(_initialOwner);
57:         executionDelay = _executionDelay; // <= FOUND
58:     }

```


</details>

## [NonCritical-88] Uint casted addresses used in conditional checks can be bypassed

### Resolution 
Handling Ethereum addresses correctly in smart contracts is paramount for security. When represented or compared using different data types, vulnerabilities can emerge. Truncation issues can arise if an address is stored as uint256 instead of address, potentially allowing attackers to mimic genuine addresses. Mistakes in validation can lead to undesired outcomes, like allowing unauthorized access or transfers. Solidity's implicit type conversions compound these problems

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L95-L95)']
```solidity
95:         return _addr == uint256(uint160(address(BASE_TOKEN_SYSTEM_CONTRACT))) || _addr == 0; // <= FOUND

```
['[406](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L406-L406)']
```solidity
406:         if (address(uint160(_transaction.paymaster)) != address(0)) { // <= FOUND

```


</details>

## [NonCritical-89] gasLimit should be uint64

### Resolution 
To ensure compatability with the EVM gasLimits should be uint64 to prevent values higher than what is compatible. In instances where L2's are used this is even more paramount as a gasLimit higher than max(uint64) may be allowed within the L2, this may not be the case with hte underlying L1 such as ZKEVM and the EVM

Num of instances: 31

### Findings 


<details><summary>Click to show findings</summary>

['[98](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L98-L119)']
```solidity
98:     
114:     function deposit(
115:         address _l2Receiver,
116:         address _l1Token,
117:         uint256 _amount, // <= FOUND
118:         uint256 _l2TxGasLimit, // <= FOUND
119:         uint256 _l2TxGasPerPubdataByte // <= FOUND
120:     ) external payable returns (bytes32 l2TxHash) {

```
['[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L133-L163)']
```solidity
133:     
158:     function deposit(
159:         address _l2Receiver,
160:         address _l1Token,
161:         uint256 _amount, // <= FOUND
162:         uint256 _l2TxGasLimit, // <= FOUND
163:         uint256 _l2TxGasPerPubdataByte, // <= FOUND
164:         address _refundRecipient
165:     ) public payable nonReentrant returns (bytes32 l2TxHash) {

```
['[554](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L554-L588)']
```solidity
554:     
582:     function depositLegacyErc20Bridge(
583:         address _prevMsgSender,
584:         address _l2Receiver,
585:         address _l1Token,
586:         uint256 _amount, // <= FOUND
587:         uint256 _l2TxGasLimit, // <= FOUND
588:         uint256 _l2TxGasPerPubdataByte, // <= FOUND
589:         address _refundRecipient
590:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) {

```
['[198](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L198-L204)']
```solidity
198:     
199:     function l2TransactionBaseCost(
200:         uint256 _chainId, // <= FOUND
201:         uint256 _gasPrice, // <= FOUND
202:         uint256 _l2GasLimit, // <= FOUND
203:         uint256 _l2GasPerPubdataByteLimit // <= FOUND
204:     ) external view returns (uint256) { // <= FOUND

```
['[182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L182-L194)']
```solidity
182:         L2CanonicalTransaction memory l2ProtocolUpgradeTx = L2CanonicalTransaction({
183:             txType: SYSTEM_UPGRADE_L2_TX_TYPE,
184:             from: uint256(uint160(L2_FORCE_DEPLOYER_ADDR)), // <= FOUND
185:             to: uint256(uint160(L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR)), // <= FOUND
186:             gasLimit: $(PRIORITY_TX_MAX_GAS_LIMIT), // <= FOUND
187:             gasPerPubdataByteLimit: REQUIRED_L2_GAS_PRICE_PER_PUBDATA,
188:             maxFeePerGas: uint256(0), // <= FOUND
189:             maxPriorityFeePerGas: uint256(0), // <= FOUND
190:             paymaster: uint256(0), // <= FOUND
191:             
192:             nonce: protocolVersion,
193:             value: 0,
194:             reserved: [uint256(0), 0, 0, 0], // <= FOUND
195:             data: systemContextCalldata,
196:             signature: new bytes(0),
197:             factoryDeps: uintEmptyArray,
198:             paymasterInput: new bytes(0),
199:             reservedDynamic: new bytes(0)
200:         });

```
['[107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L107-L110)']
```solidity
107:     
110:     uint256 priorityTxMaxGasLimit; // <= FOUND

```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L58-L59)']
```solidity
58:     
59:     function setPriorityTxMaxGasLimit(uint256 _newPriorityTxMaxGasLimit) external onlyStateTransitionManager { // <= FOUND

```
['[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L61-L61)']
```solidity
61:         uint256 oldPriorityTxMaxGasLimit = s.priorityTxMaxGasLimit; // <= FOUND

```
['[176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L176-L177)']
```solidity
176:     
177:     function getPriorityTxMaxGasLimit() external view returns (uint256) { // <= FOUND

```
['[143](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L143-L148)']
```solidity
143:     
144:     function l2TransactionBaseCost(
145:         uint256 _gasPrice, // <= FOUND
146:         uint256 _l2GasLimit, // <= FOUND
147:         uint256 _l2GasPerPubdataByteLimit // <= FOUND
148:     ) public view returns (uint256) { // <= FOUND

```
['[197](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L197-L203)']
```solidity
197:     
198:     function requestL2Transaction(
199:         address _contractL2,
200:         uint256 _l2Value, // <= FOUND
201:         bytes calldata _calldata,
202:         uint256 _l2GasLimit, // <= FOUND
203:         uint256 _l2GasPerPubdataByteLimit, // <= FOUND
204:         bytes[] calldata _factoryDeps,
205:         address _refundRecipient
206:     ) external payable returns (bytes32 canonicalTxHash) {

```
['[271](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L271-L271)']
```solidity
271:         uint256 baseCost = _params.l2GasPrice * _params.l2GasLimit; // <= FOUND

```
['[294](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L294-L306)']
```solidity
294:         transaction = L2CanonicalTransaction({
295:             txType: PRIORITY_OPERATION_L2_TX_TYPE,
296:             from: uint256(uint160(_priorityOpParams.sender)), // <= FOUND
297:             to: uint256(uint160(_priorityOpParams.contractAddressL2)), // <= FOUND
298:             gasLimit: _priorityOpParams.l2GasLimit, // <= FOUND
299:             gasPerPubdataByteLimit: _priorityOpParams.l2GasPricePerPubdata,
300:             maxFeePerGas: uint256(_priorityOpParams.l2GasPrice), // <= FOUND
301:             maxPriorityFeePerGas: uint256(0), // <= FOUND
302:             paymaster: uint256(0), // <= FOUND
303:             
304:             nonce: uint256(_priorityOpParams.txId), // <= FOUND
305:             value: _priorityOpParams.l2Value,
306:             reserved: [_priorityOpParams.valueToMint, uint256(uint160(_priorityOpParams.refundRecipient)), 0, 0], // <= FOUND
307:             data: _calldata,
308:             signature: new bytes(0),
309:             factoryDeps: _hashFactoryDeps(_factoryDeps),
310:             paymasterInput: new bytes(0),
311:             reservedDynamic: new bytes(0)
312:         });

```
['[126](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L126-L128)']
```solidity
126:     
128:     uint256 gasLimit; // <= FOUND

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L19-L28)']
```solidity
19:     
24:     function validateL1ToL2Transaction(
25:         L2CanonicalTransaction memory _transaction,
26:         bytes memory _encoded,
27:         uint256 _priorityTxMaxGasLimit, // <= FOUND
28:         uint256 _priorityTxMaxPubdata // <= FOUND
29:     ) internal pure {

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L25-L25)']
```solidity
25:         uint256 l2GasForTxBody = getTransactionBodyGasLimit(_transaction.gasLimit, _encoded.length); // <= FOUND

```
['[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L69-L79)']
```solidity
69:     
75:     function getMinimalPriorityTransactionGasLimit( // <= FOUND
76:         uint256 _encodingLength, // <= FOUND
77:         uint256 _numberOfFactoryDependencies, // <= FOUND
78:         uint256 _l2GasPricePerPubdata // <= FOUND
79:     ) internal pure returns (uint256) { // <= FOUND

```
['[109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L109-L117)']
```solidity
109:     
114:     function getTransactionBodyGasLimit( // <= FOUND
115:         uint256 _totalGasLimit, // <= FOUND
116:         uint256 _encodingLength // <= FOUND
117:     ) internal pure returns (uint256 txBodyGasLimit) { // <= FOUND

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L16-L16)']
```solidity
16:     uint256 l2GasLimit; // <= FOUND

```
['[107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/IBridgehub.sol#L107-L112)']
```solidity
107:     function l2TransactionBaseCost(
108:         uint256 _chainId, // <= FOUND
109:         uint256 _gasPrice, // <= FOUND
110:         uint256 _l2GasLimit, // <= FOUND
111:         uint256 _l2GasPerPubdataByteLimit // <= FOUND
112:     ) external view returns (uint256); // <= FOUND

```
['[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L33-L35)']
```solidity
33:     
35:     function setPriorityTxMaxGasLimit(uint256 _newPriorityTxMaxGasLimit) external; // <= FOUND

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L74-L75)']
```solidity
74:     
75:     event NewPriorityTxMaxGasLimit(uint256 oldPriorityTxMaxGasLimit, uint256 newPriorityTxMaxGasLimit); // <= FOUND

```
['[107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L107-L107)']
```solidity
107:     uint256 priorityTxMaxGasLimit; // <= FOUND

```
['[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IGetters.sol#L101-L102)']
```solidity
101:     
102:     function getPriorityTxMaxGasLimit() external view returns (uint256); // <= FOUND

```
['[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContext.sol#L36-L36)']
```solidity
36:     function blockGasLimit() external view returns (uint256); // <= FOUND

```
['[126](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L126-L126)']
```solidity
126:     uint256 gasLimit; // <= FOUND

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L37-L38)']
```solidity
37:     
38:     uint256 public blockGasLimit = type(uint32).max; // <= FOUND

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L37-L37)']
```solidity
37:     function systemCall(uint32 gasLimit, address to, uint256 value, bytes memory data) internal returns (bool success) { // <= FOUND

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L46-L51)']
```solidity
46:         uint256 farCallAbi = getFarCallABI( // <= FOUND
47:             0,
48:             0,
49:             dataStart,
50:             dataLength,
51:             gasLimit, // <= FOUND
52:             
53:             0,
54:             CalldataForwardingMode.UseHeap,
55:             false,
56:             true
57:         );

```
['[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L84-L86)']
```solidity
84:     bytes32 constant EIP712_TRANSACTION_TYPE_HASH =
85:         keccak256(
86:             "Transaction(uint256 txType,uint256 from,uint256 to,uint256 gasLimit,uint256 gasPerPubdataByteLimit,uint256 maxFeePerGas,uint256 maxPriorityFeePerGas,uint256 paymaster,uint256 nonce,uint256 value,bytes data,bytes32[] factoryDeps,bytes paymasterInput)" // <= FOUND
87:         );

```
['[397](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L397-L397)']
```solidity
397:         uint256 amount = _transaction.maxFeePerGas * _transaction.gasLimit; // <= FOUND

```


</details>

## [NonCritical-90] Inconstant use of 0x0 and 0x00 for 0 bytes

### Resolution 
Consider sticking to either 0x0 or 0x00 to represent 0 bytes throughout the contract

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L23-L273)']
```solidity
23: contract ContractDeployer is IContractDeployer, ISystemContract {
24:     
26:     mapping(address => AccountInfo) internal accountInfo;
27: 
28:     modifier onlySelf() {
29:         require(msg.sender == address(this), "Callable only by self");
30:         _;
31:     }
32: 
34:     function getAccountInfo(address _address) external view returns (AccountInfo memory info) {
35:         return accountInfo[_address];
36:     }
37: 
40:     function extendedAccountVersion(address _address) public view returns (AccountAbstractionVersion) {
41:         AccountInfo memory info = accountInfo[_address];
42:         if (info.supportedAAVersion != AccountAbstractionVersion.None) {
43:             return info.supportedAAVersion;
44:         }
45: 
46:         
47:         if (
48:             _address > address(MAX_SYSTEM_CONTRACT_ADDRESS) &&
49:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.getRawCodeHash(_address) == 0
50:         ) {
51:             return AccountAbstractionVersion.Version1;
52:         }
53: 
54:         return AccountAbstractionVersion.None;
55:     }
56: 
58:     function _storeAccountInfo(address _address, AccountInfo memory _newInfo) internal {
59:         accountInfo[_address] = _newInfo;
60:     }
61: 
65:     function updateAccountVersion(AccountAbstractionVersion _version) external onlySystemCall {
66:         accountInfo[msg.sender].supportedAAVersion = _version;
67: 
68:         emit AccountVersionUpdated(msg.sender, _version);
69:     }
70: 
74:     function updateNonceOrdering(AccountNonceOrdering _nonceOrdering) external onlySystemCall {
75:         AccountInfo memory currentInfo = accountInfo[msg.sender];
76: 
77:         require(
78:             _nonceOrdering == AccountNonceOrdering.Arbitrary &&
79:                 currentInfo.nonceOrdering == AccountNonceOrdering.Sequential,
80:             "It is only possible to change from sequential to arbitrary ordering"
81:         );
82: 
83:         currentInfo.nonceOrdering = _nonceOrdering;
84:         _storeAccountInfo(msg.sender, currentInfo);
85: 
86:         emit AccountNonceOrderingUpdated(msg.sender, _nonceOrdering);
87:     }
88: 
95:     function getNewAddressCreate2(
96:         address _sender,
97:         bytes32 _bytecodeHash,
98:         bytes32 _salt,
99:         bytes calldata _input
100:     ) public view override returns (address newAddress) {
101:         
102:         
103:         bytes32 constructorInputHash = EfficientCall.keccak(_input);
104: 
105:         bytes32 hash = keccak256(
106:             bytes.concat(CREATE2_PREFIX, bytes32(uint256(uint160(_sender))), _salt, _bytecodeHash, constructorInputHash)
107:         );
108: 
109:         newAddress = address(uint160(uint256(hash)));
110:     }
111: 
115:     function getNewAddressCreate(
116:         address _sender,
117:         uint256 _senderNonce
118:     ) public pure override returns (address newAddress) {
119:         
120:         
121:         bytes32 hash = keccak256(
122:             bytes.concat(CREATE_PREFIX, bytes32(uint256(uint160(_sender))), bytes32(_senderNonce))
123:         );
124: 
125:         newAddress = address(uint160(uint256(hash)));
126:     }
127: 
132:     function create2(
133:         bytes32 _salt,
134:         bytes32 _bytecodeHash,
135:         bytes calldata _input
136:     ) external payable override returns (address) {
137:         return create2Account(_salt, _bytecodeHash, _input, AccountAbstractionVersion.None);
138:     }
139: 
147:     function create(
148:         bytes32 _salt,
149:         bytes32 _bytecodeHash,
150:         bytes calldata _input
151:     ) external payable override returns (address) {
152:         return createAccount(_salt, _bytecodeHash, _input, AccountAbstractionVersion.None);
153:     }
154: 
162:     function create2Account(
163:         bytes32 _salt,
164:         bytes32 _bytecodeHash,
165:         bytes calldata _input,
166:         AccountAbstractionVersion _aaVersion
167:     ) public payable override onlySystemCall returns (address) {
168:         NONCE_HOLDER_SYSTEM_CONTRACT.incrementDeploymentNonce(msg.sender);
169:         address newAddress = getNewAddressCreate2(msg.sender, _bytecodeHash, _salt, _input);
170: 
171:         _nonSystemDeployOnAddress(_bytecodeHash, newAddress, _aaVersion, _input);
172: 
173:         return newAddress;
174:     }
175: 
182:     function createAccount(
183:         bytes32, 
184:         bytes32 _bytecodeHash,
185:         bytes calldata _input,
186:         AccountAbstractionVersion _aaVersion
187:     ) public payable override onlySystemCall returns (address) {
188:         uint256 senderNonce = NONCE_HOLDER_SYSTEM_CONTRACT.incrementDeploymentNonce(msg.sender);
189:         address newAddress = getNewAddressCreate(msg.sender, senderNonce);
190: 
191:         _nonSystemDeployOnAddress(_bytecodeHash, newAddress, _aaVersion, _input);
192: 
193:         return newAddress;
194:     }
195: 
197:     struct ForceDeployment {
198:         
199:         bytes32 bytecodeHash;
200:         
201:         address newAddress;
202:         
203:         bool callConstructor;
204:         
205:         uint256 value;
206:         
207:         bytes input;
208:     }
209: 
213:     function forceDeployOnAddress(ForceDeployment calldata _deployment, address _sender) external payable onlySelf {
214:         _ensureBytecodeIsKnown(_deployment.bytecodeHash);
215: 
216:         
217:         
218:         
219:         AccountInfo memory newAccountInfo;
220:         newAccountInfo.supportedAAVersion = AccountAbstractionVersion.None;
221:         
222:         newAccountInfo.nonceOrdering = AccountNonceOrdering.Sequential;
223:         _storeAccountInfo(_deployment.newAddress, newAccountInfo);
224: 
225:         _constructContract(
226:             _sender,
227:             _deployment.newAddress,
228:             _deployment.bytecodeHash,
229:             _deployment.input,
230:             false,
231:             _deployment.callConstructor
232:         );
233:     }
234: 
238:     function forceDeployOnAddresses(ForceDeployment[] calldata _deployments) external payable {
239:         require(
240:             msg.sender == FORCE_DEPLOYER || msg.sender == address(COMPLEX_UPGRADER_CONTRACT),
241:             "Can only be called by FORCE_DEPLOYER or COMPLEX_UPGRADER_CONTRACT"
242:         );
243: 
244:         uint256 deploymentsLength = _deployments.length;
245:         
246:         
247:         uint256 sumOfValues = 0;
248:         for (uint256 i = 0; i < deploymentsLength; ++i) {
249:             sumOfValues += _deployments[i].value;
250:         }
251:         require(msg.value == sumOfValues, "`value` provided is not equal to the combined `value`s of deployments");
252: 
253:         for (uint256 i = 0; i < deploymentsLength; ++i) {
254:             this.forceDeployOnAddress{value: _deployments[i].value}(_deployments[i], msg.sender);
255:         }
256:     }
257: 
258:     function _nonSystemDeployOnAddress(
259:         bytes32 _bytecodeHash,
260:         address _newAddress,
261:         AccountAbstractionVersion _aaVersion,
262:         bytes calldata _input
263:     ) internal {
264:         require(_bytecodeHash != bytes32(0x0), "BytecodeHash cannot be zero");
265:         require(uint160(_newAddress) > MAX_SYSTEM_CONTRACT_ADDRESS, "Can not deploy contracts in kernel space");
266: 
267:         
268:         require(
269:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.getCodeHash(uint256(uint160(_newAddress))) == 0x0, // <= FOUND
270:             "Code hash is non-zero"
271:         );
272:         
273:         require(NONCE_HOLDER_SYSTEM_CONTRACT.getRawNonce(_newAddress) == 0x00, "Account is occupied"); // <= FOUND
274: 
275:         _performDeployOnAddress(_bytecodeHash, _newAddress, _aaVersion, _input);
276:     }
277: 
283:     function _performDeployOnAddress(
284:         bytes32 _bytecodeHash,
285:         address _newAddress,
286:         AccountAbstractionVersion _aaVersion,
287:         bytes calldata _input
288:     ) internal {
289:         _ensureBytecodeIsKnown(_bytecodeHash);
290: 
291:         AccountInfo memory newAccountInfo;
292:         newAccountInfo.supportedAAVersion = _aaVersion;
293:         
294:         newAccountInfo.nonceOrdering = AccountNonceOrdering.Sequential;
295:         _storeAccountInfo(_newAddress, newAccountInfo);
296: 
297:         _constructContract(msg.sender, _newAddress, _bytecodeHash, _input, false, true);
298:     }
299: 
301:     function _ensureBytecodeIsKnown(bytes32 _bytecodeHash) internal view {
302:         uint256 knownCodeMarker = KNOWN_CODE_STORAGE_CONTRACT.getMarker(_bytecodeHash);
303:         require(knownCodeMarker > 0, "The code hash is not known");
304:     }
305: 
309:     function _storeConstructingByteCodeHashOnAddress(address _newAddress, bytes32 _bytecodeHash) internal {
310:         
311:         bytes32 constructingBytecodeHash = Utils.constructingBytecodeHash(_bytecodeHash);
312:         ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.storeAccountConstructingCodeHash(_newAddress, constructingBytecodeHash);
313:     }
314: 
321:     function _constructContract(
322:         address _sender,
323:         address _newAddress,
324:         bytes32 _bytecodeHash,
325:         bytes calldata _input,
326:         bool _isSystem,
327:         bool _callConstructor
328:     ) internal {
329:         uint256 value = msg.value;
330:         if (_callConstructor) {
331:             
332:             if (value > 0) {
333:                 BASE_TOKEN_SYSTEM_CONTRACT.transferFromTo(address(this), _newAddress, value);
334:             }
335:             
336:             _storeConstructingByteCodeHashOnAddress(_newAddress, _bytecodeHash);
337: 
338:             
339:             if (value > 0) {
340:                 
341:                 SystemContractHelper.setValueForNextFarCall(uint128(value));
342:             }
343:             bytes memory returnData = EfficientCall.mimicCall(gasleft(), _newAddress, _input, _sender, true, _isSystem);
344:             
345:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.markAccountCodeHashAsConstructed(_newAddress);
346:             
347:             ImmutableData[] memory immutables = abi.decode(returnData, (ImmutableData[]));
348:             IMMUTABLE_SIMULATOR_SYSTEM_CONTRACT.setImmutables(_newAddress, immutables);
349:         } else {
350:             require(value == 0, "The value must be zero if we do not call the constructor");
351:             
352:             ACCOUNT_CODE_STORAGE_SYSTEM_CONTRACT.storeAccountConstructedCodeHash(_newAddress, _bytecodeHash);
353:         }
354: 
355:         emit ContractDeployed(_sender, _bytecodeHash, _newAddress);
356:     }
357: }

```


</details>

## [NonCritical-91] The I name prefix should only be used for interfaces

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L17-L17)']
```solidity
17: abstract contract ISystemContract  // <= FOUND

```


</details>

## [NonCritical-92] Consider only defining one library/interface/contract per sol file

### Resolution 
Combining multiple libraries, interfaces, or contracts in a single `.sol` file can lead to clutter, reduced readability, and versioning issues. **Resolution**: Adopt the best practice of defining only one library, interface, or contract per Solidity file. This modular approach enhances clarity, simplifies unit testing, and streamlines code review. Furthermore, segregating components makes version management easier, as updates to one component won't necessitate changes to a file housing multiple unrelated components. Structured file management can further assist in avoiding naming collisions and ensure smoother integration into larger systems or DApps.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L3-L61)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {Ownable2Step} from "@openzeppelin/contracts/access/Ownable2Step.sol";
8: import {IGovernance} from "./IGovernance.sol";
9: 
22: contract Governance is IGovernance, Ownable2Step { // <= FOUND
23:     
24:     uint256 internal constant EXECUTED_PROPOSAL_TIMESTAMP = uint256(1);
25: 
28:     address public securityCouncil;
29: 
34:     mapping(bytes32 operationId => uint256 executionTimestamp) public timestamps;
35: 
37:     uint256 public minDelay;
38: 
43:     constructor(address _admin, address _securityCouncil, uint256 _minDelay) {
44:         require(_admin != address(0), "Admin should be non zero address");
45: 
46:         _transferOwnership(_admin);
47: 
48:         securityCouncil = _securityCouncil;
49:         emit ChangeSecurityCouncil(address(0), _securityCouncil);
50: 
51:         minDelay = _minDelay;
52:         emit ChangeMinDelay(0, _minDelay);
53:     }
54: 
60:     modifier onlySelf() {
61:         require(msg.sender == address(this), "Only governance contract itself is allowed to call this function"); // <= FOUND
62:         _;
63:     }
64: 
66:     modifier onlySecurityCouncil() {
67:         require(msg.sender == securityCouncil, "Only security council is allowed to call this function");
68:         _;
69:     }
70: 
72:     modifier onlyOwnerOrSecurityCouncil() {
73:         require(
74:             msg.sender == owner() || msg.sender == securityCouncil,
75:             "Only the owner and security council are allowed to call this function"
76:         );
77:         _;
78:     }
79: 
86:     function isOperation(bytes32 _id) public view returns (bool) {
87:         return getOperationState(_id) != OperationState.Unset;
88:     }
89: 
91:     function isOperationPending(bytes32 _id) public view returns (bool) {
92:         OperationState state = getOperationState(_id);
93:         return state == OperationState.Waiting || state == OperationState.Ready;
94:     }
95: 
97:     function isOperationReady(bytes32 _id) public view returns (bool) {
98:         return getOperationState(_id) == OperationState.Ready;
99:     }
100: 
102:     function isOperationDone(bytes32 _id) public view returns (bool) {
103:         return getOperationState(_id) == OperationState.Done;
104:     }
105: 
107:     function getOperationState(bytes32 _id) public view returns (OperationState) {
108:         uint256 timestamp = timestamps[_id];
109:         if (timestamp == 0) {
110:             return OperationState.Unset;
111:         } else if (timestamp == EXECUTED_PROPOSAL_TIMESTAMP) {
112:             return OperationState.Done;
113:         } else if (timestamp > block.timestamp) {
114:             return OperationState.Waiting;
115:         } else {
116:             return OperationState.Ready;
117:         }
118:     }
119: 
131:     function scheduleTransparent(Operation calldata _operation, uint256 _delay) external onlyOwner {
132:         bytes32 id = hashOperation(_operation);
133:         _schedule(id, _delay);
134:         emit TransparentOperationScheduled(id, _delay, _operation);
135:     }
136: 
144:     function scheduleShadow(bytes32 _id, uint256 _delay) external onlyOwner {
145:         _schedule(_id, _delay);
146:         emit ShadowOperationScheduled(_id, _delay);
147:     }
148: 
156:     function cancel(bytes32 _id) external onlyOwner {
157:         require(isOperationPending(_id), "Operation must be pending");
158:         delete timestamps[_id];
159:         emit OperationCancelled(_id);
160:     }
161: 
169:     function execute(Operation calldata _operation) external payable onlyOwnerOrSecurityCouncil {
170:         bytes32 id = hashOperation(_operation);
171:         
172:         _checkPredecessorDone(_operation.predecessor);
173:         
174:         require(isOperationReady(id), "Operation must be ready before execution");
175:         
176:         _execute(_operation.calls);
177:         
178:         
179:         require(isOperationReady(id), "Operation must be ready after execution");
180:         
181:         timestamps[id] = EXECUTED_PROPOSAL_TIMESTAMP;
182:         emit OperationExecuted(id);
183:     }

```
['[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L3-L85)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
20: interface IL2Messenger { // <= FOUND
21:     
24:     function sendToL1(bytes memory _message) external returns (bytes32);
25: }
26: 
32: interface IContractDeployer { // <= FOUND
33:     
39:     struct ForceDeployment {
40:         bytes32 bytecodeHash;
41:         address newAddress;
42:         bool callConstructor;
43:         uint256 value;
44:         bytes input;
45:     }
46: 
49:     function forceDeployOnAddresses(ForceDeployment[] calldata _deployParams) external payable;
50: 
55:     function create2(bytes32 _salt, bytes32 _bytecodeHash, bytes calldata _input) external returns (address);
56: }
57: 
63: interface IBaseToken { // <= FOUND
64:     
67:     function withdrawWithMessage(address _l1Receiver, bytes memory _additionalData) external payable;
68: }
69: 
70: uint160 constant SYSTEM_CONTRACTS_OFFSET = 0x8000; 
71: 
72: address constant BOOTLOADER_ADDRESS = address(SYSTEM_CONTRACTS_OFFSET + 0x01);
73: address constant MSG_VALUE_SYSTEM_CONTRACT = address(SYSTEM_CONTRACTS_OFFSET + 0x09);
74: address constant DEPLOYER_SYSTEM_CONTRACT = address(SYSTEM_CONTRACTS_OFFSET + 0x06);
75: 
76: IL2Messenger constant L2_MESSENGER = IL2Messenger(address(SYSTEM_CONTRACTS_OFFSET + 0x08));
77: 
78: IBaseToken constant L2_BASE_TOKEN_ADDRESS = IBaseToken(address(SYSTEM_CONTRACTS_OFFSET + 0x0a));
79: 
85: library L2ContractHelper { // <= FOUND
86:     
87:     bytes32 private constant CREATE2_PREFIX = keccak256("zksyncCreate2");
88: 
92:     function sendMessageToL1(bytes memory _message) internal returns (bytes32) {
93:         return L2_MESSENGER.sendToL1(_message);
94:     }
95: 
103:     function computeCreate2Address(
104:         address _sender,
105:         bytes32 _salt,
106:         bytes32 _bytecodeHash,
107:         bytes32 _constructorInputHash
108:     ) internal pure returns (address) {
109:         bytes32 senderBytes = bytes32(uint256(uint160(_sender)));
110:         bytes32 data = keccak256(
111:             bytes.concat(CREATE2_PREFIX, senderBytes, _salt, _bytecodeHash, _constructorInputHash)
112:         );
113: 
114:         return address(uint160(uint256(data)));
115:     }
116: }
117: 
119: struct Transaction {
120:     
121:     uint256 txType;
122:     
123:     uint256 from;
124:     
125:     uint256 to;
126:     
128:     uint256 gasLimit;
129:     
130:     uint256 gasPerPubdataByteLimit;
131:     
133:     uint256 maxFeePerGas;
134:     
136:     uint256 maxPriorityFeePerGas;
137:     
138:     uint256 paymaster;
139:     
140:     uint256 nonce;
141:     
142:     uint256 value;
143:     
151:     uint256[4] reserved;
152:     
153:     bytes data;
154:     
155:     bytes signature;
156:     
159:     bytes32[] factoryDeps;
160:     
161:     bytes paymasterInput;
162:     
164:     bytes reservedDynamic;
165: }
166: 

```
['[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L3-L38)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {MSG_VALUE_SYSTEM_CONTRACT} from "./L2ContractHelper.sol";
8: 
9: address constant SYSTEM_CALL_CALL_ADDRESS = address((1 << 16) - 11);
10: 
12: uint256 constant MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT = 1;
13: 
22: enum CalldataForwardingMode {
23:     UseHeap,
24:     ForwardFatPointer,
25:     UseAuxHeap
26: }
27: 
28: library Utils { // <= FOUND
29:     function safeCastToU32(uint256 _x) internal pure returns (uint32) {
30:         require(_x <= type(uint32).max, "Overflow");
31: 
32:         return uint32(_x);
33:     }
34: }
35: 
38: library SystemContractsCaller { // <= FOUND
39:     function systemCall(uint32 gasLimit, address to, uint256 value, bytes memory data) internal returns (bool success) {
40:         address callAddr = SYSTEM_CALL_CALL_ADDRESS;
41: 
42:         uint32 dataStart;
43:         assembly {
44:             dataStart := add(data, 0x20)
45:         }
46:         uint32 dataLength = uint32(Utils.safeCastToU32(data.length));
47: 
48:         uint256 farCallAbi = getFarCallABI(
49:             0,
50:             0,
51:             dataStart,
52:             dataLength,
53:             gasLimit,
54:             
55:             0,
56:             CalldataForwardingMode.UseHeap,
57:             false,
58:             true
59:         );
60: 
61:         if (value == 0) {
62:             
63:             assembly {
64:                 success := call(to, callAddr, 0, 0, farCallAbi, 0, 0)
65:             }
66:         } else {
67:             address msgValueSimulator = MSG_VALUE_SYSTEM_CONTRACT;
68:             
69:             
70:             uint256 forwardMask = MSG_VALUE_SIMULATOR_IS_SYSTEM_BIT;
71: 
72:             assembly {
73:                 success := call(msgValueSimulator, callAddr, value, to, farCallAbi, forwardMask, 0)
74:             }
75:         }
76:     }
77: 
78:     function systemCallWithReturndata(
79:         uint32 gasLimit,
80:         address to,
81:         uint128 value,
82:         bytes memory data
83:     ) internal returns (bool success, bytes memory returnData) {
84:         success = systemCall(gasLimit, to, value, data);
85: 
86:         uint256 size;
87:         assembly {
88:             size := returndatasize()
89:         }
90: 
91:         returnData = new bytes(size);
92:         assembly {
93:             returndatacopy(add(returnData, 0x20), 0, size)
94:         }
95:     }
96: 
97:     function getFarCallABI(
98:         uint32 dataOffset,
99:         uint32 memoryPage,

```
['[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L3-L140)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import {INonceHolder} from "./interfaces/INonceHolder.sol";
8: import {IContractDeployer} from "./interfaces/IContractDeployer.sol";
9: import {ISystemContract} from "./interfaces/ISystemContract.sol";
10: import {DEPLOYER_SYSTEM_CONTRACT} from "./Constants.sol";
11: 
29: contract NonceHolder is INonceHolder, ISystemContract { // <= FOUND
30:     uint256 private constant DEPLOY_NONCE_MULTIPLIER = 2 ** 128;
31:     
33:     uint256 private constant MAXIMAL_MIN_NONCE_INCREMENT = 2 ** 32;
34: 
38:     mapping(uint256 account => uint256 packedMinAndDeploymentNonce) internal rawNonces;
39: 
43:     mapping(uint256 account => mapping(uint256 nonceKey => uint256 value)) internal nonceValues;
44: 
48:     function getMinNonce(address _address) public view returns (uint256) {
49:         uint256 addressAsKey = uint256(uint160(_address));
50:         (, uint256 minNonce) = _splitRawNonce(rawNonces[addressAsKey]);
51: 
52:         return minNonce;
53:     }
54: 
59:     function getRawNonce(address _address) public view returns (uint256) {
60:         uint256 addressAsKey = uint256(uint160(_address));
61:         return rawNonces[addressAsKey];
62:     }
63: 
67:     function increaseMinNonce(uint256 _value) public onlySystemCall returns (uint256 oldMinNonce) {
68:         require(_value <= MAXIMAL_MIN_NONCE_INCREMENT, "The value for incrementing the nonce is too high");
69: 
70:         uint256 addressAsKey = uint256(uint160(msg.sender));
71:         uint256 oldRawNonce = rawNonces[addressAsKey];
72: 
73:         unchecked {
74:             rawNonces[addressAsKey] = (oldRawNonce + _value);
75:         }
76: 
77:         (, oldMinNonce) = _splitRawNonce(oldRawNonce);
78:     }
79: 
84:     function setValueUnderNonce(uint256 _key, uint256 _value) public onlySystemCall {
85:         IContractDeployer.AccountInfo memory accountInfo = DEPLOYER_SYSTEM_CONTRACT.getAccountInfo(msg.sender);
86: 
87:         require(_value != 0, "Nonce value cannot be set to 0");
88:         
89:         
90:         if (accountInfo.nonceOrdering == IContractDeployer.AccountNonceOrdering.Sequential && _key != 0) {
91:             require(isNonceUsed(msg.sender, _key - 1), "Previous nonce has not been used");
92:         }
93: 
94:         uint256 addressAsKey = uint256(uint160(msg.sender));
95: 
96:         nonceValues[addressAsKey][_key] = _value;
97: 
98:         emit ValueSetUnderNonce(msg.sender, _key, _value);
99:     }
100: 
104:     function getValueUnderNonce(uint256 _key) public view returns (uint256) {
105:         uint256 addressAsKey = uint256(uint160(msg.sender));
106:         return nonceValues[addressAsKey][_key];
107:     }
108: 
112:     function incrementMinNonceIfEquals(uint256 _expectedNonce) external onlySystemCall {
113:         uint256 addressAsKey = uint256(uint160(msg.sender));
114:         uint256 oldRawNonce = rawNonces[addressAsKey];
115: 
116:         (, uint256 oldMinNonce) = _splitRawNonce(oldRawNonce);
117:         require(oldMinNonce == _expectedNonce, "Incorrect nonce");
118: 
119:         unchecked {
120:             rawNonces[addressAsKey] = oldRawNonce + 1;
121:         }
122:     }
123: 
127:     function getDeploymentNonce(address _address) external view returns (uint256 deploymentNonce) {
128:         uint256 addressAsKey = uint256(uint160(_address));
129:         (deploymentNonce, ) = _splitRawNonce(rawNonces[addressAsKey]);
130: 
131:         return deploymentNonce;
132:     }
133: 
137:     function incrementDeploymentNonce(address _address) external returns (uint256 prevDeploymentNonce) {
138:         require(
139:             msg.sender == address(DEPLOYER_SYSTEM_CONTRACT),
140:             "Only the contract deployer can increment the deployment nonce" // <= FOUND
141:         );
142:         uint256 addressAsKey = uint256(uint160(_address));
143:         uint256 oldRawNonce = rawNonces[addressAsKey];
144: 
145:         unchecked {
146:             rawNonces[addressAsKey] = (oldRawNonce + DEPLOY_NONCE_MULTIPLIER);
147:         }
148: 
149:         (prevDeploymentNonce, ) = _splitRawNonce(oldRawNonce);
150:     }
151: 
156:     function isNonceUsed(address _address, uint256 _nonce) public view returns (bool) {
157:         uint256 addressAsKey = uint256(uint160(_address));
158:         return (_nonce < getMinNonce(_address) || nonceValues[addressAsKey][_nonce] > 0);
159:     }
160: 
168:     function validateNonceUsage(address _address, uint256 _key, bool _shouldBeUsed) external view {
169:         bool isUsed = isNonceUsed(_address, _key);
170: 
171:         if (isUsed && !_shouldBeUsed) {
172:             revert("Reusing the same nonce twice");
173:         } else if (!isUsed && _shouldBeUsed) {
174:             revert("The nonce was not set as used");
175:         }
176:     }
177: 
181:     function _splitRawNonce(uint256 _rawMinNonce) internal pure returns (uint256 deploymentNonce, uint256 minNonce) {
182:         deploymentNonce = _rawMinNonce / DEPLOY_NONCE_MULTIPLIER;
183:         minNonce = _rawMinNonce % DEPLOY_NONCE_MULTIPLIER;
184:     }
185: }
186: 

```
['[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L3-L59)']
```solidity
3: 
5: pragma solidity 0.8.20;
6: 
7: import "./interfaces/IAccountCodeStorage.sol";
8: import "./libraries/Utils.sol";
9: import {DEPLOYER_SYSTEM_CONTRACT, NONCE_HOLDER_SYSTEM_CONTRACT, CURRENT_MAX_PRECOMPILE_ADDRESS} from "./Constants.sol";
10: 
24: contract AccountCodeStorage is IAccountCodeStorage { // <= FOUND
25:     bytes32 constant EMPTY_STRING_KECCAK = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470;
26: 
27:     modifier onlyDeployer() {
28:         require(msg.sender == address(DEPLOYER_SYSTEM_CONTRACT), "Callable only by the deployer system contract");
29:         _;
30:     }
31: 
37:     function storeAccountConstructingCodeHash(address _address, bytes32 _hash) external override onlyDeployer {
38:         
39:         require(Utils.isContractConstructing(_hash), "Code hash is not for a contract on constructor"); // <= FOUND
40:         _storeCodeHash(_address, _hash);
41:     }
42: 
48:     function storeAccountConstructedCodeHash(address _address, bytes32 _hash) external override onlyDeployer {
49:         
50:         require(Utils.isContractConstructed(_hash), "Code hash is not for a constructed contract");
51:         _storeCodeHash(_address, _hash);
52:     }
53: 
56:     function markAccountCodeHashAsConstructed(address _address) external override onlyDeployer {
57:         bytes32 codeHash = getRawCodeHash(_address);
58: 
59:         require(Utils.isContractConstructing(codeHash), "Code hash is not for a contract on constructor"); // <= FOUND
60: 
61:         
62:         bytes32 constructedBytecodeHash = Utils.constructedBytecodeHash(codeHash);
63: 
64:         _storeCodeHash(_address, constructedBytecodeHash);
65:     }
66: 
70:     function _storeCodeHash(address _address, bytes32 _hash) internal {
71:         uint256 addressAsKey = uint256(uint160(_address));
72:         assembly {
73:             sstore(addressAsKey, _hash)
74:         }
75:     }
76: 
80:     function getRawCodeHash(address _address) public view override returns (bytes32 codeHash) {
81:         uint256 addressAsKey = uint256(uint160(_address));
82: 
83:         assembly {
84:             codeHash := sload(addressAsKey)
85:         }
86:     }
87: 
91:     function getCodeHash(uint256 _input) external view override returns (bytes32) {
92:         
93:         
94:         address account = address(uint160(_input));
95:         if (uint160(account) <= CURRENT_MAX_PRECOMPILE_ADDRESS) {
96:             return EMPTY_STRING_KECCAK;
97:         }
98: 
99:         bytes32 codeHash = getRawCodeHash(account);
100: 
101:         
102:         
103:         
104:         if (codeHash == 0x00 && NONCE_HOLDER_SYSTEM_CONTRACT.getRawNonce(account) > 0) {
105:             codeHash = EMPTY_STRING_KECCAK;
106:         }
107:         
108:         
109:         else if (Utils.isContractConstructing(codeHash)) {
110:             codeHash = EMPTY_STRING_KECCAK;
111:         }
112: 
113:         return codeHash;
114:     }
115: 
119:     function getCodeSize(uint256 _input) external view override returns (uint256 codeSize) {
120:         
121:         
122:         address account = address(uint160(_input));
123:         bytes32 codeHash = getRawCodeHash(account);
124: 
125:         
126:         
127:         
128:         
129:         
130:         
131:         
132:         
133:         if (
134:             uint160(account) > CURRENT_MAX_PRECOMPILE_ADDRESS &&
135:             codeHash != 0x00 &&
136:             !Utils.isContractConstructing(codeHash)
137:         ) {
138:             codeSize = Utils.bytecodeLenInBytes(codeHash);
139:         }
140:     }
141: }
142: 

```


</details>

## [NonCritical-93] Avoid hard coding gasLimit values

### Resolution 
Hardcoding `gasLimit` values in smart contracts can be problematic. Gas requirements can change due to network conditions or contract updates. If set too low, transactions may fail; if set too high, unnecessary costs might be incurred. Moreover, Ethereum's gas dynamics and costs are subject to change with network upgrades, like the transition to Ethereum 2.0. Instead of hardcoding, dynamically estimate gas or provide mechanisms for administrators to update gas limits. This ensures flexibility and avoids transaction failures or inefficiencies due to outdated gas settings. Always remember to test thoroughly after any changes to gas-related logic.

Num of instances: 21

### Findings 


<details><summary>Click to show findings</summary>

['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L105-L105)']
```solidity
105:         l2TxHash = deposit(_l2Receiver, _l1Token, _amount, _l2TxGasLimit, _l2TxGasPerPubdataByte, address(0)); // <= FOUND

```
['[145](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L145-L150)']
```solidity
145:         l2TxHash = sharedBridge.depositLegacyErc20Bridge{value: msg.value}( // <= FOUND
146:             msg.sender,
147:             _l2Receiver,
148:             _l1Token,
149:             _amount,
150:             _l2TxGasLimit, // <= FOUND
151:             _l2TxGasPerPubdataByte,
152:             _refundRecipient
153:         );

```
['[584](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L584-L590)']
```solidity
584:             L2TransactionRequestDirect memory request = L2TransactionRequestDirect({ // <= FOUND
585:                 chainId: ERA_CHAIN_ID,
586:                 l2Contract: l2BridgeAddress[ERA_CHAIN_ID],
587:                 mintValue: msg.value, 
588:                 l2Value: 0, 
589:                 l2Calldata: l2TxCalldata,
590:                 l2GasLimit: _l2TxGasLimit, // <= FOUND
591:                 l2GasPerPubdataByteLimit: _l2TxGasPerPubdataByte,
592:                 factoryDeps: new bytes[](0),
593:                 refundRecipient: refundRecipient
594:             });

```
['[238](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L238-L245)']
```solidity
238:         canonicalTxHash = IZkSyncStateTransition(stateTransition).bridgehubRequestL2Transaction( // <= FOUND
239:             BridgehubL2TransactionRequest({
240:                 sender: msg.sender,
241:                 contractL2: _request.l2Contract,
242:                 mintValue: _request.mintValue,
243:                 l2Value: _request.l2Value,
244:                 l2Calldata: _request.l2Calldata,
245:                 l2GasLimit: _request.l2GasLimit, // <= FOUND
246:                 l2GasPerPubdataByteLimit: _request.l2GasPerPubdataByteLimit,
247:                 factoryDeps: _request.factoryDeps,
248:                 refundRecipient: refundRecipient
249:             })

```
['[304](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L304-L311)']
```solidity
304:         canonicalTxHash = IZkSyncStateTransition(stateTransition).bridgehubRequestL2Transaction( // <= FOUND
305:             BridgehubL2TransactionRequest({
306:                 sender: _request.secondBridgeAddress,
307:                 contractL2: outputRequest.l2Contract,
308:                 mintValue: _request.mintValue,
309:                 l2Value: _request.l2Value,
310:                 l2Calldata: outputRequest.l2Calldata,
311:                 l2GasLimit: _request.l2GasLimit, // <= FOUND
312:                 l2GasPerPubdataByteLimit: _request.l2GasPerPubdataByteLimit,
313:                 factoryDeps: outputRequest.factoryDeps,
314:                 refundRecipient: refundRecipient
315:             })

```
['[182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L182-L186)']
```solidity
182:         L2CanonicalTransaction memory l2ProtocolUpgradeTx = L2CanonicalTransaction({ // <= FOUND
183:             txType: SYSTEM_UPGRADE_L2_TX_TYPE,
184:             from: uint256(uint160(L2_FORCE_DEPLOYER_ADDR)),
185:             to: uint256(uint160(L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR)),
186:             gasLimit: $(PRIORITY_TX_MAX_GAS_LIMIT), // <= FOUND
187:             gasPerPubdataByteLimit: REQUIRED_L2_GAS_PRICE_PER_PUBDATA,
188:             maxFeePerGas: uint256(0),
189:             maxPriorityFeePerGas: uint256(0),
190:             paymaster: uint256(0),
191:             
192:             nonce: protocolVersion,
193:             value: 0,
194:             reserved: [uint256(0), 0, 0, 0],
195:             data: systemContextCalldata,
196:             signature: new bytes(0),
197:             factoryDeps: uintEmptyArray,
198:             paymasterInput: new bytes(0),
199:             reservedDynamic: new bytes(0)
200:         });

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L45-L45)']
```solidity
45:         s.priorityTxMaxGasLimit = _initializeData.priorityTxMaxGasLimit; // <= FOUND

```
['[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L61-L61)']
```solidity
61:         uint256 oldPriorityTxMaxGasLimit = s.priorityTxMaxGasLimit; // <= FOUND

```
['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L62-L62)']
```solidity
62:         s.priorityTxMaxGasLimit = _newPriorityTxMaxGasLimit; // <= FOUND

```
['[207](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L207-L213)']
```solidity
207:         canonicalTxHash = _requestL2TransactionSender( // <= FOUND
208:             BridgehubL2TransactionRequest({
209:                 sender: msg.sender,
210:                 contractL2: _contractL2,
211:                 mintValue: msg.value,
212:                 l2Value: _l2Value,
213:                 l2GasLimit: _l2GasLimit, // <= FOUND
214:                 l2Calldata: _calldata,
215:                 l2GasPerPubdataByteLimit: _l2GasPerPubdataByteLimit,
216:                 factoryDeps: _factoryDeps,
217:                 refundRecipient: _refundRecipient
218:             })

```
['[251](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L251-L251)']
```solidity
251:         params.l2GasLimit = _request.l2GasLimit; // <= FOUND

```
['[294](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L294-L298)']
```solidity
294:         transaction = L2CanonicalTransaction({ // <= FOUND
295:             txType: PRIORITY_OPERATION_L2_TX_TYPE,
296:             from: uint256(uint160(_priorityOpParams.sender)),
297:             to: uint256(uint160(_priorityOpParams.contractAddressL2)),
298:             gasLimit: _priorityOpParams.l2GasLimit, // <= FOUND
299:             gasPerPubdataByteLimit: _priorityOpParams.l2GasPricePerPubdata,
300:             maxFeePerGas: uint256(_priorityOpParams.l2GasPrice),
301:             maxPriorityFeePerGas: uint256(0),
302:             paymaster: uint256(0),
303:             
304:             nonce: uint256(_priorityOpParams.txId),
305:             value: _priorityOpParams.l2Value,
306:             reserved: [_priorityOpParams.valueToMint, uint256(uint160(_priorityOpParams.refundRecipient)), 0, 0],
307:             data: _calldata,
308:             signature: new bytes(0),
309:             factoryDeps: _hashFactoryDeps(_factoryDeps),
310:             paymasterInput: new bytes(0),
311:             reservedDynamic: new bytes(0)
312:         });

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L25-L25)']
```solidity
25:         uint256 l2GasForTxBody = getTransactionBodyGasLimit(_transaction.gasLimit, _encoded.length); // <= FOUND

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L57-L57)']
```solidity
57:             bytes memory encodedGasLimit = RLPEncoder.encodeUint256(_transaction.gasLimit); // <= FOUND

```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L58-L58)']
```solidity
58:             encodedGasParam = bytes.concat(encodedGasPrice, encodedGasLimit); // <= FOUND

```
['[149](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L149-L153)']
```solidity
149:             encodedFixedLengthParams = bytes.concat( // <= FOUND
150:                 encodedChainId,
151:                 encodedNonce,
152:                 encodedGasPrice,
153:                 encodedGasLimit, // <= FOUND
154:                 encodedTo,
155:                 encodedValue
156:             );

```
['[243](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L243-L248)']
```solidity
243:             encodedFixedLengthParams = bytes.concat( // <= FOUND
244:                 encodedChainId,
245:                 encodedNonce,
246:                 encodedMaxPriorityFeePerGas,
247:                 encodedMaxFeePerGas,
248:                 encodedGasLimit, // <= FOUND
249:                 encodedTo,
250:                 encodedValue
251:             );

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L37-L38)']
```solidity
37:     
38:     uint256 public blockGasLimit = type(uint32).max; // <= FOUND

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L46-L51)']
```solidity
46:         uint256 farCallAbi = getFarCallABI( // <= FOUND
47:             0,
48:             0,
49:             dataStart,
50:             dataLength,
51:             gasLimit, // <= FOUND
52:             
53:             0,
54:             CalldataForwardingMode.UseHeap,
55:             false,
56:             true
57:         );

```
['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L82-L82)']
```solidity
82:         success = systemCall(gasLimit, to, value, data); // <= FOUND

```
['[119](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L119-L125)']
```solidity
119:         bytes32 structHash = keccak256( // <= FOUND
120:             abi.encode(
121:                 EIP712_TRANSACTION_TYPE_HASH,
122:                 _transaction.txType,
123:                 _transaction.from,
124:                 _transaction.to,
125:                 _transaction.gasLimit, // <= FOUND
126:                 _transaction.gasPerPubdataByteLimit,
127:                 _transaction.maxFeePerGas,
128:                 _transaction.maxPriorityFeePerGas,
129:                 _transaction.paymaster,
130:                 _transaction.nonce,
131:                 _transaction.value,
132:                 EfficientCall.keccak(_transaction.data),
133:                 keccak256(abi.encodePacked(_transaction.factoryDeps)),
134:                 EfficientCall.keccak(_transaction.paymasterInput)
135:             )
136:         );

```


</details>

## [NonCritical-94] Contracts use both += 1 and ++ (-- and -= 1)

### Resolution 
For consistency consider only using one of these incrementing methods.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L22-L667)']
```solidity
22: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor {
23:     using UncheckedMath for uint256;
24:     using PriorityQueue for PriorityQueue.Queue;
25: 
27:     string public constant override getName = "ExecutorFacet";
28: 
32:     function _commitOneBatch(
33:         StoredBatchInfo memory _previousBatch,
34:         CommitBatchInfo calldata _newBatch,
35:         bytes32 _expectedSystemContractUpgradeTxHash
36:     ) internal view returns (StoredBatchInfo memory) {
37:         require(_newBatch.batchNumber == _previousBatch.batchNumber + 1, "f"); 
38: 
39:         uint8 pubdataSource = uint8(bytes1(_newBatch.pubdataCommitments[0]));
40:         require(pubdataSource == uint8(PubdataSource.Calldata) || pubdataSource == uint8(PubdataSource.Blob), "us");
41: 
42:         
43:         
44:         LogProcessingOutput memory logOutput = _processL2Logs(_newBatch, _expectedSystemContractUpgradeTxHash);
45: 
46:         bytes32[] memory blobCommitments = new bytes32[](MAX_NUMBER_OF_BLOBS);
47:         bytes32[] memory blobHashes = new bytes32[](MAX_NUMBER_OF_BLOBS);
48:         if (s.feeParams.pubdataPricingMode == PubdataPricingMode.Validium) {
49:             
50:             require(logOutput.pubdataHash == 0x00, "v0h");
51:             require(_newBatch.pubdataCommitments.length == 1);
52:         } else if (pubdataSource == uint8(PubdataSource.Blob)) {
53:             
54:             
55:             blobHashes[0] = logOutput.blob1Hash;
56:             blobHashes[1] = logOutput.blob2Hash;
57:             
58:             blobCommitments = _verifyBlobInformation(_newBatch.pubdataCommitments[1:], blobHashes);
59:         } else if (pubdataSource == uint8(PubdataSource.Calldata)) {
60:             
61:             require(
62:                 logOutput.pubdataHash ==
63:                     keccak256(_newBatch.pubdataCommitments[1:_newBatch.pubdataCommitments.length - 32]),
64:                 "wp"
65:             );
66:             blobHashes[0] = logOutput.blob1Hash;
67:             blobCommitments[0] = bytes32(
68:                 _newBatch.pubdataCommitments[_newBatch.pubdataCommitments.length - 32:_newBatch
69:                     .pubdataCommitments
70:                     .length]
71:             );
72:         }
73: 
74:         require(_previousBatch.batchHash == logOutput.previousBatchHash, "l");
75:         
76:         require(logOutput.chainedPriorityTxsHash == _newBatch.priorityOperationsHash, "t");
77:         
78:         require(logOutput.numberOfLayer1Txs == _newBatch.numberOfLayer1Txs, "ta");
79: 
80:         
81:         _verifyBatchTimestamp(logOutput.packedBatchAndL2BlockTimestamp, _newBatch.timestamp, _previousBatch.timestamp);
82: 
83:         
84:         bytes32 commitment = _createBatchCommitment(_newBatch, logOutput.stateDiffHash, blobCommitments, blobHashes);
85: 
86:         return
87:             StoredBatchInfo(
88:                 _newBatch.batchNumber,
89:                 _newBatch.newStateRoot,
90:                 _newBatch.indexRepeatedStorageChanges,
91:                 _newBatch.numberOfLayer1Txs,
92:                 _newBatch.priorityOperationsHash,
93:                 logOutput.l2LogsTreeRoot,
94:                 _newBatch.timestamp,
95:                 commitment
96:             );
97:     }
98: 
103:     function _verifyBatchTimestamp(
104:         uint256 _packedBatchAndL2BlockTimestamp,
105:         uint256 _expectedBatchTimestamp,
106:         uint256 _previousBatchTimestamp
107:     ) internal view {
108:         
109:         uint256 batchTimestamp = _packedBatchAndL2BlockTimestamp >> 128;
110:         require(batchTimestamp == _expectedBatchTimestamp, "tb");
111: 
112:         
113:         
114:         require(_previousBatchTimestamp < batchTimestamp, "h3");
115: 
116:         uint256 lastL2BlockTimestamp = _packedBatchAndL2BlockTimestamp & PACKED_L2_BLOCK_TIMESTAMP_MASK;
117: 
118:         
119:         
120:         
121:         
122:         require(block.timestamp - COMMIT_TIMESTAMP_NOT_OLDER <= batchTimestamp, "h1"); 
123:         require(lastL2BlockTimestamp <= block.timestamp + COMMIT_TIMESTAMP_APPROXIMATION_DELTA, "h2"); 
124:     }
125: 
130:     function _processL2Logs(
131:         CommitBatchInfo calldata _newBatch,
132:         bytes32 _expectedSystemContractUpgradeTxHash
133:     ) internal pure returns (LogProcessingOutput memory logOutput) {
134:         
135:         bytes memory emittedL2Logs = _newBatch.systemLogs;
136: 
137:         
138:         
139:         uint256 processedLogs;
140: 
141:         
142:         for (uint256 i = 0; i < emittedL2Logs.length; i = i.uncheckedAdd(L2_TO_L1_LOG_SERIALIZE_SIZE)) {
143:             
144:             (address logSender, ) = UnsafeBytes.readAddress(emittedL2Logs, i + L2_LOG_ADDRESS_OFFSET);
145:             (uint256 logKey, ) = UnsafeBytes.readUint256(emittedL2Logs, i + L2_LOG_KEY_OFFSET);
146:             (bytes32 logValue, ) = UnsafeBytes.readBytes32(emittedL2Logs, i + L2_LOG_VALUE_OFFSET);
147: 
148:             
149:             require(!_checkBit(processedLogs, uint8(logKey)), "kp");
150:             processedLogs = _setBit(processedLogs, uint8(logKey));
151: 
152:             
153:             if (logKey == uint256(SystemLogKey.L2_TO_L1_LOGS_TREE_ROOT_KEY)) {
154:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "lm");
155:                 logOutput.l2LogsTreeRoot = logValue;
156:             } else if (logKey == uint256(SystemLogKey.TOTAL_L2_TO_L1_PUBDATA_KEY)) {
157:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "ln");
158:                 logOutput.pubdataHash = logValue;
159:             } else if (logKey == uint256(SystemLogKey.STATE_DIFF_HASH_KEY)) {
160:                 require(logSender == L2_TO_L1_MESSENGER_SYSTEM_CONTRACT_ADDR, "lb");
161:                 logOutput.stateDiffHash = logValue;
162:             } else if (logKey == uint256(SystemLogKey.PACKED_BATCH_AND_L2_BLOCK_TIMESTAMP_KEY)) {
163:                 require(logSender == L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, "sc");
164:                 logOutput.packedBatchAndL2BlockTimestamp = uint256(logValue);
165:             } else if (logKey == uint256(SystemLogKey.PREV_BATCH_HASH_KEY)) {
166:                 require(logSender == L2_SYSTEM_CONTEXT_SYSTEM_CONTRACT_ADDR, "sv");
167:                 logOutput.previousBatchHash = logValue;
168:             } else if (logKey == uint256(SystemLogKey.CHAINED_PRIORITY_TXN_HASH_KEY)) {
169:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bl");
170:                 logOutput.chainedPriorityTxsHash = logValue;
171:             } else if (logKey == uint256(SystemLogKey.NUMBER_OF_LAYER_1_TXS_KEY)) {
172:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bk");
173:                 logOutput.numberOfLayer1Txs = uint256(logValue);
174:             } else if (logKey == uint256(SystemLogKey.BLOB_ONE_HASH_KEY)) {
175:                 require(logSender == L2_PUBDATA_CHUNK_PUBLISHER_ADDR, "pc");
176:                 logOutput.blob1Hash = logValue;
177:             } else if (logKey == uint256(SystemLogKey.BLOB_TWO_HASH_KEY)) {
178:                 require(logSender == L2_PUBDATA_CHUNK_PUBLISHER_ADDR, "pd");
179:                 logOutput.blob2Hash = logValue;
180:             } else if (logKey == uint256(SystemLogKey.EXPECTED_SYSTEM_CONTRACT_UPGRADE_TX_HASH_KEY)) {
181:                 require(logSender == L2_BOOTLOADER_ADDRESS, "bu");
182:                 require(_expectedSystemContractUpgradeTxHash == logValue, "ut");
183:             } else {
184:                 revert("ul");
185:             }
186:         }
187: 
188:         
189:         
190:         
191:         if (_expectedSystemContractUpgradeTxHash == bytes32(0)) {
192:             require(processedLogs == 511, "b7");
193:         } else {
194:             require(processedLogs == 1023, "b8");
195:         }
196:     }
197: 
199:     function commitBatches(
200:         StoredBatchInfo memory _lastCommittedBatchData,
201:         CommitBatchInfo[] calldata _newBatchesData
202:     ) external nonReentrant onlyValidator {
203:         _commitBatches(_lastCommittedBatchData, _newBatchesData);
204:     }
205: 
207:     function commitBatchesSharedBridge(
208:         uint256, 
209:         StoredBatchInfo memory _lastCommittedBatchData,
210:         CommitBatchInfo[] calldata _newBatchesData
211:     ) external nonReentrant onlyValidator {
212:         _commitBatches(_lastCommittedBatchData, _newBatchesData);
213:     }
214: 
215:     function _commitBatches(
216:         StoredBatchInfo memory _lastCommittedBatchData,
217:         CommitBatchInfo[] calldata _newBatchesData
218:     ) internal {
219:         
220:         
221:         
222:         
223:         
224:         
225:         
226:         require(
227:             IStateTransitionManager(s.stateTransitionManager).protocolVersion() == s.protocolVersion,
228:             "Executor facet: wrong protocol version"
229:         );
230:         
231:         require(_newBatchesData.length == 1, "e4");
232:         
233:         require(s.storedBatchHashes[s.totalBatchesCommitted] == _hashStoredBatchInfo(_lastCommittedBatchData), "i"); 
234: 
235:         bytes32 systemContractsUpgradeTxHash = s.l2SystemContractsUpgradeTxHash;
236:         
237:         if (systemContractsUpgradeTxHash == bytes32(0) || s.l2SystemContractsUpgradeBatchNumber != 0) {
238:             _commitBatchesWithoutSystemContractsUpgrade(_lastCommittedBatchData, _newBatchesData);
239:         } else {
240:             _commitBatchesWithSystemContractsUpgrade(
241:                 _lastCommittedBatchData,
242:                 _newBatchesData,
243:                 systemContractsUpgradeTxHash
244:             );
245:         }
246: 
247:         s.totalBatchesCommitted = s.totalBatchesCommitted + _newBatchesData.length;
248:     }
249: 
253:     function _commitBatchesWithoutSystemContractsUpgrade(
254:         StoredBatchInfo memory _lastCommittedBatchData,
255:         CommitBatchInfo[] calldata _newBatchesData
256:     ) internal {
257:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) {
258:             _lastCommittedBatchData = _commitOneBatch(_lastCommittedBatchData, _newBatchesData[i], bytes32(0));
259: 
260:             s.storedBatchHashes[_lastCommittedBatchData.batchNumber] = _hashStoredBatchInfo(_lastCommittedBatchData);
261:             emit BlockCommit(
262:                 _lastCommittedBatchData.batchNumber,
263:                 _lastCommittedBatchData.batchHash,
264:                 _lastCommittedBatchData.commitment
265:             );
266:         }
267:     }
268: 
273:     function _commitBatchesWithSystemContractsUpgrade(
274:         StoredBatchInfo memory _lastCommittedBatchData,
275:         CommitBatchInfo[] calldata _newBatchesData,
276:         bytes32 _systemContractUpgradeTxHash
277:     ) internal {
278:         
279:         
280:         
281: 
282:         
283:         
284:         require(s.l2SystemContractsUpgradeBatchNumber == 0, "ik");
285: 
286:         
287:         s.l2SystemContractsUpgradeBatchNumber = _newBatchesData[0].batchNumber;
288: 
289:         for (uint256 i = 0; i < _newBatchesData.length; i = i.uncheckedInc()) {
290:             
291:             bytes32 expectedUpgradeTxHash = i == 0 ? _systemContractUpgradeTxHash : bytes32(0);
292:             _lastCommittedBatchData = _commitOneBatch(
293:                 _lastCommittedBatchData,
294:                 _newBatchesData[i],
295:                 expectedUpgradeTxHash
296:             );
297: 
298:             s.storedBatchHashes[_lastCommittedBatchData.batchNumber] = _hashStoredBatchInfo(_lastCommittedBatchData);
299:             emit BlockCommit(
300:                 _lastCommittedBatchData.batchNumber,
301:                 _lastCommittedBatchData.batchHash,
302:                 _lastCommittedBatchData.commitment
303:             );
304:         }
305:     }
306: 
308:     function _collectOperationsFromPriorityQueue(uint256 _nPriorityOps) internal returns (bytes32 concatHash) {
309:         concatHash = EMPTY_STRING_KECCAK;
310: 
311:         for (uint256 i = 0; i < _nPriorityOps; i = i.uncheckedInc()) {
312:             PriorityOperation memory priorityOp = s.priorityQueue.popFront();
313:             concatHash = keccak256(abi.encode(concatHash, priorityOp.canonicalTxHash));
314:         }
315:     }
316: 
321:     function _executeOneBatch(StoredBatchInfo memory _storedBatch, uint256 _executedBatchIdx) internal {
322:         uint256 currentBatchNumber = _storedBatch.batchNumber;
323:         require(currentBatchNumber == s.totalBatchesExecuted + _executedBatchIdx + 1, "k"); 
324:         require(
325:             _hashStoredBatchInfo(_storedBatch) == s.storedBatchHashes[currentBatchNumber],
326:             "exe10" 
327:         );
328: 
329:         bytes32 priorityOperationsHash = _collectOperationsFromPriorityQueue(_storedBatch.numberOfLayer1Txs);
330:         require(priorityOperationsHash == _storedBatch.priorityOperationsHash, "x"); 
331: 
332:         
333:         s.l2LogsRootHashes[currentBatchNumber] = _storedBatch.l2LogsTreeRoot;
334:     }
335: 
337:     function executeBatchesSharedBridge(
338:         uint256,
339:         StoredBatchInfo[] calldata _batchesData
340:     ) external nonReentrant onlyValidator {
341:         _executeBatches(_batchesData);
342:     }
343: 
345:     function executeBatches(StoredBatchInfo[] calldata _batchesData) external nonReentrant onlyValidator {
346:         _executeBatches(_batchesData);
347:     }
348: 
349:     function _executeBatches(StoredBatchInfo[] calldata _batchesData) internal {
350:         uint256 nBatches = _batchesData.length;
351:         for (uint256 i = 0; i < nBatches; i = i.uncheckedInc()) {
352:             _executeOneBatch(_batchesData[i], i);
353:             emit BlockExecution(_batchesData[i].batchNumber, _batchesData[i].batchHash, _batchesData[i].commitment);
354:         }
355: 
356:         uint256 newTotalBatchesExecuted = s.totalBatchesExecuted + nBatches;
357:         s.totalBatchesExecuted = newTotalBatchesExecuted;
358:         require(newTotalBatchesExecuted <= s.totalBatchesVerified, "n"); 
359: 
360:         uint256 batchWhenUpgradeHappened = s.l2SystemContractsUpgradeBatchNumber;
361:         if (batchWhenUpgradeHappened != 0 && batchWhenUpgradeHappened <= newTotalBatchesExecuted) {
362:             delete s.l2SystemContractsUpgradeTxHash;
363:             delete s.l2SystemContractsUpgradeBatchNumber;
364:         }
365:     }
366: 
368:     function proveBatches(
369:         StoredBatchInfo calldata _prevBatch,
370:         StoredBatchInfo[] calldata _committedBatches,
371:         ProofInput calldata _proof
372:     ) external nonReentrant onlyValidator {
373:         _proveBatches(_prevBatch, _committedBatches, _proof);
374:     }
375: 
377:     function proveBatchesSharedBridge(
378:         uint256, 
379:         StoredBatchInfo calldata _prevBatch,
380:         StoredBatchInfo[] calldata _committedBatches,
381:         ProofInput calldata _proof
382:     ) external nonReentrant onlyValidator {
383:         _proveBatches(_prevBatch, _committedBatches, _proof);
384:     }
385: 
386:     function _proveBatches(
387:         StoredBatchInfo calldata _prevBatch,
388:         StoredBatchInfo[] calldata _committedBatches,
389:         ProofInput calldata _proof
390:     ) internal {
391:         
392:         uint256 currentTotalBatchesVerified = s.totalBatchesVerified;
393:         uint256 committedBatchesLength = _committedBatches.length;
394: 
395:         
396:         VerifierParams memory verifierParams = s.verifierParams;
397: 
398:         
399:         uint256[] memory proofPublicInput = new uint256[](committedBatchesLength);
400: 
401:         
402:         require(_hashStoredBatchInfo(_prevBatch) == s.storedBatchHashes[currentTotalBatchesVerified], "t1");
403: 
404:         bytes32 prevBatchCommitment = _prevBatch.commitment;
405:         for (uint256 i = 0; i < committedBatchesLength; i = i.uncheckedInc()) {
406:             currentTotalBatchesVerified = currentTotalBatchesVerified.uncheckedInc();
407:             require(
408:                 _hashStoredBatchInfo(_committedBatches[i]) == s.storedBatchHashes[currentTotalBatchesVerified],
409:                 "o1"
410:             );
411: 
412:             bytes32 currentBatchCommitment = _committedBatches[i].commitment;
413:             proofPublicInput[i] = _getBatchProofPublicInput(
414:                 prevBatchCommitment,
415:                 currentBatchCommitment,
416:                 verifierParams
417:             );
418: 
419:             prevBatchCommitment = currentBatchCommitment;
420:         }
421:         require(currentTotalBatchesVerified <= s.totalBatchesCommitted, "q");
422: 
423:         
424: 
425:         
426:         assert(block.chainid != 1);
427:         
428:         
429:         if (_proof.serializedProof.length > 0) {
430:             _verifyProof(proofPublicInput, _proof);
431:         }
432:         
433:         _verifyProof(proofPublicInput, _proof);
434:         
435: 
436:         emit BlocksVerification(s.totalBatchesVerified, currentTotalBatchesVerified);
437:         s.totalBatchesVerified = currentTotalBatchesVerified;
438:     }
439: 
440:     function _verifyProof(uint256[] memory proofPublicInput, ProofInput calldata _proof) internal view {
441:         
442:         require(proofPublicInput.length == 1, "t4");
443: 
444:         bool successVerifyProof = s.verifier.verify(
445:             proofPublicInput,
446:             _proof.serializedProof,
447:             _proof.recursiveAggregationInput
448:         );
449:         require(successVerifyProof, "p"); 
450:     }
451: 
453:     function _getBatchProofPublicInput(
454:         bytes32 _prevBatchCommitment,
455:         bytes32 _currentBatchCommitment,
456:         VerifierParams memory _verifierParams
457:     ) internal pure returns (uint256) {
458:         return
459:             uint256(
460:                 keccak256(
461:                     abi.encodePacked(
462:                         _prevBatchCommitment,
463:                         _currentBatchCommitment,
464:                         _verifierParams.recursionNodeLevelVkHash,
465:                         _verifierParams.recursionLeafLevelVkHash
466:                     )
467:                 )
468:             ) >> PUBLIC_INPUT_SHIFT;
469:     }
470: 
472:     function revertBatches(uint256 _newLastBatch) external nonReentrant onlyValidatorOrStateTransitionManager {
473:         _revertBatches(_newLastBatch);
474:     }
475: 
477:     function revertBatchesSharedBridge(uint256, uint256 _newLastBatch) external nonReentrant onlyValidator {
478:         _revertBatches(_newLastBatch);
479:     }
480: 
481:     function _revertBatches(uint256 _newLastBatch) internal {
482:         require(s.totalBatchesCommitted > _newLastBatch, "v1"); 
483:         require(_newLastBatch >= s.totalBatchesExecuted, "v2"); 
484: 
485:         if (_newLastBatch < s.totalBatchesVerified) {
486:             s.totalBatchesVerified = _newLastBatch;
487:         }
488:         s.totalBatchesCommitted = _newLastBatch;
489: 
490:         
491:         
492:         if (s.l2SystemContractsUpgradeBatchNumber > _newLastBatch) {
493:             delete s.l2SystemContractsUpgradeBatchNumber;
494:         }
495: 
496:         emit BlocksRevert(s.totalBatchesCommitted, s.totalBatchesVerified, s.totalBatchesExecuted);
497:     }
498: 
500:     function _createBatchCommitment(
501:         CommitBatchInfo calldata _newBatchData,
502:         bytes32 _stateDiffHash,
503:         bytes32[] memory _blobCommitments,
504:         bytes32[] memory _blobHashes
505:     ) internal view returns (bytes32) {
506:         bytes32 passThroughDataHash = keccak256(_batchPassThroughData(_newBatchData));
507:         bytes32 metadataHash = keccak256(_batchMetaParameters());
508:         bytes32 auxiliaryOutputHash = keccak256(
509:             _batchAuxiliaryOutput(_newBatchData, _stateDiffHash, _blobCommitments, _blobHashes)
510:         );
511: 
512:         return keccak256(abi.encode(passThroughDataHash, metadataHash, auxiliaryOutputHash));
513:     }
514: 
515:     function _batchPassThroughData(CommitBatchInfo calldata _batch) internal pure returns (bytes memory) {
516:         return
517:             abi.encodePacked(
518:                 _batch.indexRepeatedStorageChanges,
519:                 _batch.newStateRoot,
520:                 uint64(0), 
521:                 bytes32(0) 
522:             );
523:     }
524: 
525:     function _batchMetaParameters() internal view returns (bytes memory) {
526:         bytes32 l2DefaultAccountBytecodeHash = s.l2DefaultAccountBytecodeHash;
527:         return
528:             abi.encodePacked(
529:                 s.zkPorterIsAvailable,
530:                 s.l2BootloaderBytecodeHash,
531:                 l2DefaultAccountBytecodeHash,
532:                 
533:                 l2DefaultAccountBytecodeHash
534:             );
535:     }
536: 
537:     function _batchAuxiliaryOutput(
538:         CommitBatchInfo calldata _batch,
539:         bytes32 _stateDiffHash,
540:         bytes32[] memory _blobCommitments,
541:         bytes32[] memory _blobHashes
542:     ) internal pure returns (bytes memory) {
543:         require(_batch.systemLogs.length <= MAX_L2_TO_L1_LOGS_COMMITMENT_BYTES, "pu");
544: 
545:         bytes32 l2ToL1LogsHash = keccak256(_batch.systemLogs);
546: 
547:         return
548:             abi.encodePacked(
549:                 l2ToL1LogsHash,
550:                 _stateDiffHash,
551:                 _batch.bootloaderHeapInitialContentsHash,
552:                 _batch.eventsQueueStateHash,
553:                 _encodeBlobAuxilaryOutput(_blobCommitments, _blobHashes)
554:             );
555:     }
556: 
561:     function _encodeBlobAuxilaryOutput(
562:         bytes32[] memory _blobCommitments,
563:         bytes32[] memory _blobHashes
564:     ) internal pure returns (bytes32[] memory blobAuxOutputWords) {
565:         
566:         
567:         require(_blobCommitments.length == MAX_NUMBER_OF_BLOBS, "b10");
568:         require(_blobHashes.length == MAX_NUMBER_OF_BLOBS, "b11");
569: 
570:         
571:         
572:         
573:         
574:         
575:         
576:         
577: 
578:         blobAuxOutputWords = new bytes32[](2 * TOTAL_BLOBS_IN_COMMITMENT);
579: 
580:         for (uint i = 0; i < MAX_NUMBER_OF_BLOBS; i++) { // <= FOUND
581:             blobAuxOutputWords[i * 2] = _blobHashes[i];
582:             blobAuxOutputWords[i * 2 + 1] = _blobCommitments[i];
583:         }
584:     }
585: 
587:     function _hashStoredBatchInfo(StoredBatchInfo memory _storedBatchInfo) internal pure returns (bytes32) {
588:         return keccak256(abi.encode(_storedBatchInfo));
589:     }
590: 
592:     function _checkBit(uint256 _bitMap, uint8 _index) internal pure returns (bool) {
593:         return (_bitMap & (1 << _index)) > 0;
594:     }
595: 
597:     function _setBit(uint256 _bitMap, uint8 _index) internal pure returns (uint256) {
598:         return _bitMap | (1 << _index);
599:     }
600: 
605:     function _pointEvaluationPrecompile(
606:         bytes32 _versionedHash,
607:         bytes32 _openingPoint,
608:         bytes calldata _openingValueCommitmentProof
609:     ) internal view {
610:         bytes memory precompileInput = abi.encodePacked(_versionedHash, _openingPoint, _openingValueCommitmentProof);
611: 
612:         (bool success, bytes memory data) = POINT_EVALUATION_PRECOMPILE_ADDR.staticcall(precompileInput);
613: 
614:         
615:         
616:         require(success, "failed to call point evaluation precompile");
617:         (, uint256 result) = abi.decode(data, (uint256, uint256));
618:         require(result == BLS_MODULUS, "precompile unexpected output");
619:     }
620: 
625:     function _verifyBlobInformation(
626:         bytes calldata _pubdataCommitments,
627:         bytes32[] memory _blobHashes
628:     ) internal view returns (bytes32[] memory blobCommitments) {
629:         uint256 versionedHashIndex = 0;
630: 
631:         require(_pubdataCommitments.length > 0, "pl");
632:         require(_pubdataCommitments.length <= PUBDATA_COMMITMENT_SIZE * MAX_NUMBER_OF_BLOBS, "bd");
633:         require(_pubdataCommitments.length % PUBDATA_COMMITMENT_SIZE == 0, "bs");
634:         blobCommitments = new bytes32[](MAX_NUMBER_OF_BLOBS);
635: 
636:         for (uint256 i = 0; i < _pubdataCommitments.length; i += PUBDATA_COMMITMENT_SIZE) {
637:             bytes32 blobVersionedHash = _getBlobVersionedHash(versionedHashIndex);
638: 
639:             require(blobVersionedHash != bytes32(0), "vh");
640: 
641:             
642:             
643:             bytes32 openingPoint = bytes32(
644:                 uint256(uint128(bytes16(_pubdataCommitments[i:i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET])))
645:             );
646: 
647:             _pointEvaluationPrecompile(
648:                 blobVersionedHash,
649:                 openingPoint,
650:                 _pubdataCommitments[i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET:i + PUBDATA_COMMITMENT_SIZE]
651:             );
652: 
653:             
654:             blobCommitments[versionedHashIndex] = keccak256(
655:                 abi.encodePacked(blobVersionedHash, _pubdataCommitments[i:i + PUBDATA_COMMITMENT_COMMITMENT_OFFSET])
656:             );
657:             versionedHashIndex += 1; // <= FOUND
658:         }
659: 
660:         
661:         
662:         bytes32 versionedHash = _getBlobVersionedHash(versionedHashIndex);
663:         require(versionedHash == bytes32(0), "lh");
664: 
665:         
666:         
667:         for (uint256 i = 0; i < MAX_NUMBER_OF_BLOBS; i++) { // <= FOUND
668:             require(
669:                 (_blobHashes[i] == bytes32(0) && blobCommitments[i] == bytes32(0)) ||
670:                     (_blobHashes[i] != bytes32(0) && blobCommitments[i] != bytes32(0)),
671:                 "bh"
672:             );
673:         }
674:     }
675: 
679:     function _getBlobVersionedHash(uint256 _index) internal view returns (bytes32 versionedHash) {
680:         (bool success, bytes memory data) = s.blobVersionedHashRetriever.staticcall(abi.encode(_index));
681:         require(success, "vc");
682:         versionedHash = abi.decode(data, (bytes32));
683:     }
684: }

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L22-L175)']
```solidity
22: contract Compressor is ICompressor, ISystemContract {
23:     using UnsafeBytesCalldata for bytes;
24: 
44:     function publishCompressedBytecode(
45:         bytes calldata _bytecode,
46:         bytes calldata _rawCompressedData
47:     ) external payable onlyCallFromBootloader returns (bytes32 bytecodeHash) {
48:         unchecked {
49:             (bytes calldata dictionary, bytes calldata encodedData) = _decodeRawBytecode(_rawCompressedData);
50: 
51:             require(
52:                 encodedData.length * 4 == _bytecode.length,
53:                 "Encoded data length should be 4 times shorter than the original bytecode"
54:             );
55: 
56:             require(
57:                 dictionary.length / 8 <= encodedData.length / 2,
58:                 "Dictionary should have at most the same number of entries as the encoded data"
59:             );
60: 
61:             for (uint256 encodedDataPointer = 0; encodedDataPointer < encodedData.length; encodedDataPointer += 2) {
62:                 uint256 indexOfEncodedChunk = uint256(encodedData.readUint16(encodedDataPointer)) * 8;
63:                 require(indexOfEncodedChunk < dictionary.length, "Encoded chunk index is out of bounds");
64: 
65:                 uint64 encodedChunk = dictionary.readUint64(indexOfEncodedChunk);
66:                 uint64 realChunk = _bytecode.readUint64(encodedDataPointer * 4);
67: 
68:                 require(encodedChunk == realChunk, "Encoded chunk does not match the original bytecode");
69:             }
70:         }
71: 
72:         bytecodeHash = Utils.hashL2Bytecode(_bytecode);
73:         L1_MESSENGER_CONTRACT.sendToL1(_rawCompressedData);
74:         KNOWN_CODE_STORAGE_CONTRACT.markBytecodeAsPublished(bytecodeHash);
75:     }
76: 
110:     function verifyCompressedStateDiffs(
111:         uint256 _numberOfStateDiffs,
112:         uint256 _enumerationIndexSize,
113:         bytes calldata _stateDiffs,
114:         bytes calldata _compressedStateDiffs
115:     ) external payable onlyCallFrom(address(L1_MESSENGER_CONTRACT)) returns (bytes32 stateDiffHash) {
116:         
117:         
118:         
119:         require(_enumerationIndexSize <= MAX_ENUMERATION_INDEX_SIZE, "enumeration index size is too large");
120: 
121:         uint256 numberOfInitialWrites = uint256(_compressedStateDiffs.readUint16(0));
122: 
123:         uint256 stateDiffPtr = 2;
124:         uint256 numInitialWritesProcessed = 0;
125: 
126:         
127:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) {
128:             bytes calldata stateDiff = _stateDiffs[i:i + STATE_DIFF_ENTRY_SIZE];
129:             uint64 enumIndex = stateDiff.readUint64(84);
130:             if (enumIndex != 0) {
131:                 
132:                 continue;
133:             }
134: 
135:             numInitialWritesProcessed++; // <= FOUND
136: 
137:             bytes32 derivedKey = stateDiff.readBytes32(52);
138:             uint256 initValue = stateDiff.readUint256(92);
139:             uint256 finalValue = stateDiff.readUint256(124);
140:             require(derivedKey == _compressedStateDiffs.readBytes32(stateDiffPtr), "iw: initial key mismatch");
141:             stateDiffPtr += 32;
142: 
143:             uint8 metadata = uint8(bytes1(_compressedStateDiffs[stateDiffPtr]));
144:             stateDiffPtr++; // <= FOUND
145:             uint8 operation = metadata & OPERATION_BITMASK;
146:             uint8 len = operation == 0 ? 32 : metadata >> LENGTH_BITS_OFFSET;
147:             _verifyValueCompression(
148:                 initValue,
149:                 finalValue,
150:                 operation,
151:                 _compressedStateDiffs[stateDiffPtr:stateDiffPtr + len]
152:             );
153:             stateDiffPtr += len;
154:         }
155: 
156:         require(numInitialWritesProcessed == numberOfInitialWrites, "Incorrect number of initial storage diffs");
157: 
158:         
159:         for (uint256 i = 0; i < _numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE; i += STATE_DIFF_ENTRY_SIZE) {
160:             bytes calldata stateDiff = _stateDiffs[i:i + STATE_DIFF_ENTRY_SIZE];
161:             uint64 enumIndex = stateDiff.readUint64(84);
162:             if (enumIndex == 0) {
163:                 continue;
164:             }
165: 
166:             uint256 initValue = stateDiff.readUint256(92);
167:             uint256 finalValue = stateDiff.readUint256(124);
168:             uint256 compressedEnumIndex = _sliceToUint256(
169:                 _compressedStateDiffs[stateDiffPtr:stateDiffPtr + _enumerationIndexSize]
170:             );
171:             require(enumIndex == compressedEnumIndex, "rw: enum key mismatch");
172:             stateDiffPtr += _enumerationIndexSize;
173: 
174:             uint8 metadata = uint8(bytes1(_compressedStateDiffs[stateDiffPtr]));
175:             stateDiffPtr += 1; // <= FOUND
176:             uint8 operation = metadata & OPERATION_BITMASK;
177:             uint8 len = operation == 0 ? 32 : metadata >> LENGTH_BITS_OFFSET;
178:             _verifyValueCompression(
179:                 initValue,
180:                 finalValue,
181:                 operation,
182:                 _compressedStateDiffs[stateDiffPtr:stateDiffPtr + len]
183:             );
184:             stateDiffPtr += len;
185:         }
186: 
187:         require(stateDiffPtr == _compressedStateDiffs.length, "Extra data in _compressedStateDiffs");
188: 
189:         stateDiffHash = EfficientCall.keccak(_stateDiffs);
190:     }
191: 
197:     function _decodeRawBytecode(
198:         bytes calldata _rawCompressedData
199:     ) internal pure returns (bytes calldata dictionary, bytes calldata encodedData) {
200:         unchecked {
201:             
202:             uint256 dictionaryLen = uint256(_rawCompressedData.readUint16(0));
203:             dictionary = _rawCompressedData[2:2 + dictionaryLen * 8];
204:             encodedData = _rawCompressedData[2 + dictionaryLen * 8:];
205:         }
206:     }
207: 
220:     function _verifyValueCompression(
221:         uint256 _initialValue,
222:         uint256 _finalValue,
223:         uint256 _operation,
224:         bytes calldata _compressedValue
225:     ) internal pure {
226:         uint256 convertedValue = _sliceToUint256(_compressedValue);
227: 
228:         unchecked {
229:             if (_operation == 0 || _operation == 3) {
230:                 require(convertedValue == _finalValue, "transform or no compression: compressed and final mismatch");
231:             } else if (_operation == 1) {
232:                 require(
233:                     _initialValue + convertedValue == _finalValue,
234:                     "add: initial plus converted not equal to final"
235:                 );
236:             } else if (_operation == 2) {
237:                 require(
238:                     _initialValue - convertedValue == _finalValue,
239:                     "sub: initial minus converted not equal to final"
240:                 );
241:             } else {
242:                 revert("unsupported operation");
243:             }
244:         }
245:     }
246: 
251:     function _sliceToUint256(bytes calldata _calldataSlice) internal pure returns (uint256 number) {
252:         number = uint256(bytes32(_calldataSlice));
253:         number >>= (256 - (_calldataSlice.length * 8));
254:     }
255: }

```


</details>

## [NonCritical-95] Immutable and constant integer state variables should not be casted

### Resolution 
The definition of a constant or immutable variable is that they do not change, casting such variables can potentially push more than one 'value' to a constant, for example a uin128 constant can have its original value and that of when it's casted to uint64 (i.e it has some bytes truncated). This can create confusion and inconsistencies within the code which can inadvertently increase the attack surface of the project. It is thus advise to either change the uint byte size in the constant/immutable definition of the variable or introduce a second state variable to cover the differing casts that are expected such as having a uint128 constant and a separate uint64 constant.

Num of instances: 10

### Findings 


<details><summary>Click to show findings</summary>

['[261](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L261-L265)']
```solidity
261:         
262:         initData = bytes.concat(
263:             IDiamondInit.initialize.selector,
264:             bytes32(_chainId),
265:             bytes32(uint256(uint160(bridgehub))), // <= FOUND
266:             bytes32(uint256(uint160(address(this)))),
267:             bytes32(uint256(protocolVersion)),
268:             bytes32(uint256(uint160(_admin))),
269:             bytes32(uint256(uint160(validatorTimelock))),
270:             bytes32(uint256(uint160(_baseToken))),
271:             bytes32(uint256(uint160(_sharedBridge))),
272:             bytes32(storedBatchZero),
273:             diamondCut.initCalldata
274:         );

```
['[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L64-L64)']
```solidity
64:         require(msg.sender == address(sharedBridge), "Not shared bridge"); // <= FOUND

```
['[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L67-L67)']
```solidity
67:         IERC20(_token).safeTransfer(address(sharedBridge), amount); // <= FOUND

```
['[161](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L161-L161)']
```solidity
161:         uint256 balanceBefore = _token.balanceOf(address(sharedBridge)); // <= FOUND

```
['[162](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L162-L162)']
```solidity
162:         _token.safeTransferFrom(_from, address(sharedBridge), _amount); // <= FOUND

```
['[163](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L163-L163)']
```solidity
163:         uint256 balanceAfter = _token.balanceOf(address(sharedBridge)); // <= FOUND

```
['[130](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L130-L130)']
```solidity
130:         require(address(sharedBridge) != address(0), "Bridgehub: weth bridge not set"); // <= FOUND

```
['[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L137-L140)']
```solidity
137:         IStateTransitionManager(_stateTransitionManager).createNewChain(
138:             _chainId,
139:             _baseToken,
140:             address(sharedBridge), // <= FOUND
141:             _admin,
142:             _initData
143:         );

```
['[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L69-L69)']
```solidity
69:         require(msg.sender == address(bridgehub), "ShB not BH"); // <= FOUND

```
['[75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L75-L76)']
```solidity
75:         require(
76:             msg.sender == address(bridgehub) || (_chainId == ERA_CHAIN_ID && msg.sender == ERA_DIAMOND_PROXY), // <= FOUND
77:             "L1SharedBridge: not bridgehub or era chain"
78:         );

```


</details>

## [NonCritical-96] Numbers downcast to addresses may result in collisions

### Resolution 
Downcasting numbers to addresses in blockchain contracts, particularly in Ethereum's Solidity, involves risks such as possible address collisions. A collision occurs when different inputs, when cast or hashed, generate the same output address, potentially compromising contract integrity and asset security. If an uint256, for instance, is downcast to an address (effectively an uint160) without ensuring its a legitimate, collision-free conversion, different uint256 inputs might yield the same address, creating vulnerabilities attackers might exploit. Implementing thorough checks and opting for secure practices, like avoiding downcasting in critical logic or utilizing mappings with original uint256 as keys, mitigates risks

Num of instances: 13

### Findings 


<details><summary>Click to show findings</summary>

['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/L2ContractHelper.sol#L112-L112)']
```solidity
112:         return address(uint160(uint256(data))); // <= FOUND

```
['[115](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Config.sol#L115-L115)']
```solidity
115: address constant BRIDGEHUB_MIN_SECOND_BRIDGE_ADDRESS = address(uint160(type(uint16).max)); // <= FOUND

```
['[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L29-L29)']
```solidity
29:             l2Address = address(uint160(l1Address) + offset); // <= FOUND

```
['[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L39-L39)']
```solidity
39:             l1Address = address(uint160(l2Address) - offset); // <= FOUND

```
['[94](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L94-L94)']
```solidity
92:         
93:         
94:         address account = address(uint160(_input)); // <= FOUND

```
['[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L61-L61)']
```solidity
61:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); // <= FOUND

```
['[147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L147-L147)']
```solidity
147:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); // <= FOUND

```
['[109](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L109-L109)']
```solidity
109:         newAddress = address(uint160(uint256(hash))); // <= FOUND

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L132-L132)']
```solidity
132:         address to = address(uint160(_transaction.to)); // <= FOUND

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L57-L57)']
```solidity
57:         return balance[address(uint160(_account))]; // <= FOUND

```
['[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L32-L32)']
```solidity
32:         to = address(uint160(addressAsUint)); // <= FOUND

```
['[375](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L375-L375)']
```solidity
375:             address paymaster = address(uint160(_transaction.paymaster)); // <= FOUND

```
['[406](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L406-L406)']
```solidity
406:         if (address(uint160(_transaction.paymaster)) != address(0)) { // <= FOUND

```


</details>

## [NonCritical-97] Empty revert statement

### Resolution 
Utilizing an empty `revert()` statement in Solidity might cause potential clarity and debugging issues in smart contract development. While `revert()` is designed to halt function execution and revert state changes when conditions aren't met, providing a descriptive error message within it enhances debuggability and transparency. Failing to provide specific reasons for reversion makes it difficult to trace the point of failure in contract interactions, especially for external developers and users interacting with the contract. To enhance clarity, developers should always use `revert("Descriptive error message")` to explain why the execution was halted, ensuring that the cause of reversion is clear, thus aiding in troubleshooting and maintaining transparent contract behavior.

Num of instances: 3

### Findings 


<details><summary>Click to show findings</summary>

['[162](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L162-L162)']
```solidity
161:         
162:         if (availableGetters.ignoreName) revert(); // <= FOUND

```
['[168](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L168-L168)']
```solidity
167:         
168:         if (availableGetters.ignoreSymbol) revert(); // <= FOUND

```
['[174](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L174-L174)']
```solidity
173:         
174:         if (availableGetters.ignoreDecimals) revert(); // <= FOUND

```


</details>

## [NonCritical-98] Use the Modern Upgradeable Contract Paradigm

### Resolution 
Modern smart contract development often employs upgradeable contract structures, utilizing proxy patterns like OpenZeppelins Upgradeable Contracts. This paradigm separates logic and state, allowing developers to amend and enhance the contract's functionality without altering its state or the deployed contract address. Transitioning to this approach enhances long-term maintainability.

**Resolution**: Adopt a well-established proxy pattern for upgradeability, ensuring proper initialization and employing transparent proxies to mitigate potential risks. Embrace comprehensive testing and audit practices, particularly when updating contract logic, to ensure state consistency and security are preserved across upgrades. This ensures your contract remains robust and adaptable to future requirements.

Num of instances: 31

### Findings 


<details><summary>Click to show findings</summary>

['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L19-L19)']
```solidity
19: contract L1ERC20Bridge is IL1ERC20Bridge, ReentrancyGuard 

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30-L30)']
```solidity
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step 

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16-L16)']
```solidity
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step 

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L20-L20)']
```solidity
20: contract Governance is IGovernance, Ownable2Step 

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L25-L25)']
```solidity
25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step 

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L22-L22)']
```solidity
22: contract ValidatorTimelock is IExecutor, Ownable2Step 

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L17-L17)']
```solidity
17: contract DiamondInit is ZkSyncStateTransitionBase, IDiamondInit 

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L10-L10)']
```solidity
10: contract DiamondProxy 

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L18-L18)']
```solidity
18: contract AdminFacet is ZkSyncStateTransitionBase, IAdmin 

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L22-L22)']
```solidity
22: contract ExecutorFacet is ZkSyncStateTransitionBase, IExecutor 

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L20-L20)']
```solidity
20: contract GettersFacet is ZkSyncStateTransitionBase, IGetters, ILegacyGetters 

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L30-L30)']
```solidity
30: contract MailboxFacet is ZkSyncStateTransitionBase, IMailbox 

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L11-L11)']
```solidity
11: contract ZkSyncStateTransitionBase is ReentrancyGuard 

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L22-L22)']
```solidity
22: contract AccountCodeStorage is IAccountCodeStorage 

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L16-L16)']
```solidity
16: contract BootloaderUtilities is IBootloaderUtilities 

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L22-L22)']
```solidity
22: contract Compressor is ICompressor, ISystemContract 

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L23-L23)']
```solidity
23: contract ContractDeployer is IContractDeployer, ISystemContract 

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L19-L19)']
```solidity
19: contract DefaultAccount is IAccount 

```
['[10](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/EmptyContract.sol#L10-L10)']
```solidity
10: contract EmptyContract 

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L18-L18)']
```solidity
18: contract ImmutableSimulator is IImmutableSimulator 

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L18-L18)']
```solidity
18: contract KnownCodesStorage is IKnownCodesStorage, ISystemContract 

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L25-L25)']
```solidity
25: contract L1Messenger is IL1Messenger, ISystemContract 

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L18-L18)']
```solidity
18: contract L2BaseToken is IBaseToken, ISystemContract 

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L19-L19)']
```solidity
19: contract MsgValueSimulator is ISystemContract 

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L27-L27)']
```solidity
27: contract NonceHolder is INonceHolder, ISystemContract 

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L16-L16)']
```solidity
16: contract PubdataChunkPublisher is IPubdataChunkPublisher, ISystemContract 

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L17-L17)']
```solidity
17: contract SystemContext is ISystemContext, ISystemContextDeprecated, ISystemContract 

```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L15-L15)']
```solidity
15: contract GasBoundCaller 

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L23-L23)']
```solidity
23: contract L2SharedBridge is IL2SharedBridge, Initializable 

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/ReentrancyGuard.sol#L25-L25)']
```solidity
25: abstract contract ReentrancyGuard 

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L17-L17)']
```solidity
17: abstract contract ISystemContract 

```


</details>

## [NonCritical-99] Long numbers should include underscores to improve readability and prevent typos

### Resolution 
A large number such as 2000000 is far more readable as 2_000_000, this will help prevent unintended bugs in the code

Num of instances: 4

### Findings 


<details><summary>Click to show findings</summary>

['[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IExecutor.sol#L50-L50)']
```solidity
50: uint256 constant BLS_MODULUS = 52435875175126190479447740508185965837690552500527637822603658699938581184513; // <= FOUND

```
['[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/Config.sol#L92-L92)']
```solidity
92: uint256 constant TX_SLOT_OVERHEAD_L2_GAS = 10000; // <= FOUND

```
['[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Constants.sol#L108-L108)']
```solidity
108: uint256 constant MAX_ALLOWED_PUBDATA_PER_BATCH = 520000; // <= FOUND

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L44-L44)']
```solidity
41:     
44:     uint256 constant MSG_VALUE_SIMULATOR_STIPEND_GAS = 27000; // <= FOUND

```


</details>

## [NonCritical-100] Delegate call can fail

### Resolution 
When a non payable function contains a payable call, it is important to point up that the delegate call will be limited to only calling other non payable functions. This can potentially cause future issues if this is not accounted for.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[283](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L283-L283)']
```solidity
278:     function _initializeDiamondCut(address _init, bytes memory _calldata) private {
279:         if (_init == address(0)) {
280:             require(_calldata.length == 0, "H"); 
281:         } else {
282:             
283:             (bool success, bytes memory data) = _init.delegatecall(_calldata); // <= FOUND
284:             if (!success) {
285:                 
286:                 if (data.length <= 4) {
287:                     revert("I"); 
288:                 }
289: 
290:                 assembly {
291:                     revert(add(data, 0x20), mload(data))
292:                 }
293:             }
294: 
295:             
296:             
297:             require(data.length == 32, "lp");
298:             require(abi.decode(data, (bytes32)) == DIAMOND_INIT_SUCCESS_RETURN_VALUE, "lp1");
299:         }
300:     }

```


</details>

## [NonCritical-101] Use 'using' keyword when using specific imports rather than calling the specific import directly

### Resolution 
In Solidity, the `using` keyword can streamline the use of library functions for specific types. Instead of calling library functions directly with their full import paths, you can declare a library once with `using` for a specific type. This approach makes your code more readable and concise. For example, instead of `LibraryName.functionName(variable)`, you would first declare `using LibraryName for TypeName;` at the contract level. After this, you can call library functions directly on variables of `TypeName` like `variable.functionName()`. This method not only enhances code clarity but also promotes cleaner and more organized code, especially when multiple functions from the same library are used frequently.

Num of instances: 125

### Findings 


<details><summary>Click to show findings</summary>

['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L23-L23)']
```solidity
23:     using LibMap for LibMap.Uint32Map; // <= FOUND 'LibMap.'

```
['[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L47-L48)']
```solidity
47:     
48:     mapping(uint256 => LibMap.Uint32Map) internal committedBatchTimestamp; // <= FOUND 'LibMap.'

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L79-L79)']
```solidity
79:         return L2ContractHelper.computeCreate2Address(l2Bridge, salt, l2TokenProxyBytecodeHash, constructorInputHash); // <= FOUND 'L2ContractHelper.'

```
['[357](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L357-L357)']
```solidity
357:             bytes32 hashedBytecode = L2ContractHelper.hashL2Bytecode(_factoryDeps[i]); // <= FOUND 'L2ContractHelper.'

```
['[97](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L97-L97)']
```solidity
97:         L2ContractHelper.validateBytecodeHash(_l2DefaultAccountBytecodeHash); // <= FOUND 'L2ContractHelper.'

```
['[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L114-L114)']
```solidity
114:         L2ContractHelper.validateBytecodeHash(_l2BootloaderBytecodeHash); // <= FOUND 'L2ContractHelper.'

```
['[227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L227-L228)']
```solidity
227:             require(
228:                 L2ContractHelper.hashL2Bytecode(_factoryDeps[i]) == bytes32(_expectedHashes[i]), // <= FOUND 'L2ContractHelper.'
229:                 "Wrong factory dep hash"
230:             );

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L132-L132)']
```solidity
132:         L2ContractHelper.sendMessageToL1(message); // <= FOUND 'L2ContractHelper.'

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L152-L153)']
```solidity
152:         return
153:             L2ContractHelper.computeCreate2Address(address(this), salt, l2TokenProxyBytecodeHash, constructorInputHash); // <= FOUND 'L2ContractHelper.'

```
['[503](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L503-L503)']
```solidity
503:         (uint32 functionSignature, uint256 offset) = UnsafeBytes.readUint32(_l2ToL1message, 0); // <= FOUND 'UnsafeBytes.'

```
['[506](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L506-L507)']
```solidity
506:             
507:             (l1Receiver, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset); // <= FOUND 'UnsafeBytes.'

```
['[507](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L507-L507)']
```solidity
507:             (amount, offset) = UnsafeBytes.readUint256(_l2ToL1message, offset); // <= FOUND 'UnsafeBytes.'

```
['[506](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L506-L506)']
```solidity
506:             (l1Receiver, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset); // <= FOUND 'UnsafeBytes.'

```
['[519](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L519-L519)']
```solidity
519:             (l1Token, offset) = UnsafeBytes.readAddress(_l2ToL1message, offset); // <= FOUND 'UnsafeBytes.'

```
['[144](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L144-L145)']
```solidity
144:             
145:             (address logSender, ) = UnsafeBytes.readAddress(emittedL2Logs, i + L2_LOG_ADDRESS_OFFSET); // <= FOUND 'UnsafeBytes.'

```
['[145](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L145-L145)']
```solidity
145:             (uint256 logKey, ) = UnsafeBytes.readUint256(emittedL2Logs, i + L2_LOG_KEY_OFFSET); // <= FOUND 'UnsafeBytes.'

```
['[146](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L146-L146)']
```solidity
146:             (bytes32 logValue, ) = UnsafeBytes.readBytes32(emittedL2Logs, i + L2_LOG_VALUE_OFFSET); // <= FOUND 'UnsafeBytes.'

```
['[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L137-L138)']
```solidity
137:     
138:     function setInitialCutHash(Diamond.DiamondCutData calldata _diamondCut) external onlyOwner { // <= FOUND 'Diamond.'

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L142-L144)']
```solidity
142:     
143:     function setNewVersionUpgrade(
144:         Diamond.DiamondCutData calldata _cutData, // <= FOUND 'Diamond.'
145:         uint256 _oldProtocolVersion,
146:         uint256 _newProtocolVersion
147:     ) external onlyOwner {

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L152-L154)']
```solidity
152:     
153:     function setUpgradeDiamondCut(
154:         Diamond.DiamondCutData calldata _cutData, // <= FOUND 'Diamond.'
155:         uint256 _oldProtocolVersion
156:     ) external onlyOwner {

```
['[219](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L219-L219)']
```solidity
219:         Diamond.FacetCut[] memory emptyArray; // <= FOUND 'Diamond.'

```
['[220](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L220-L220)']
```solidity
220:         Diamond.DiamondCutData memory cutData = Diamond.DiamondCutData({ // <= FOUND 'Diamond.'
221:             facetCuts: emptyArray,
222:             initAddress: genesisUpgrade,
223:             initCalldata: abi.encodeCall(IDefaultUpgrade.upgrade, (proposedUpgrade))
224:         });

```
['[252](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L252-L253)']
```solidity
252:         
253:         Diamond.DiamondCutData memory diamondCut = abi.decode(_diamondCut, (Diamond.DiamondCutData)); // <= FOUND 'Diamond.'

```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/DefaultUpgrade.sol#L15-L15)']
```solidity
15:         return Diamond.DIAMOND_INIT_SUCCESS_RETURN_VALUE; // <= FOUND 'Diamond.'

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L11-L11)']
```solidity
11:     constructor(uint256 _chainId, Diamond.DiamondCutData memory _diamondCut) { // <= FOUND 'Diamond.'

```
['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L15-L15)']
```solidity
15:         Diamond.diamondCut(_diamondCut); // <= FOUND 'Diamond.'

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L21-L21)']
```solidity
21:         Diamond.DiamondStorage storage diamondStorage = Diamond.getDiamondStorage(); // <= FOUND 'Diamond.'

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L27-L28)']
```solidity
27:         
28:         Diamond.SelectorToFacet memory facet = diamondStorage.selectorToFacet[msg.sig]; // <= FOUND 'Diamond.'

```
['[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L100-L107)']
```solidity
100:     
105:     function upgradeChainFromVersion(
106:         uint256 _oldProtocolVersion,
107:         Diamond.DiamondCutData calldata _diamondCut // <= FOUND 'Diamond.'
108:     ) external onlyAdminOrStateTransitionManager {

```
['[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L123-L124)']
```solidity
123:     
124:     function executeUpgrade(Diamond.DiamondCutData calldata _diamondCut) external onlyStateTransitionManager { // <= FOUND 'Diamond.'

```
['[158](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L158-L158)']
```solidity
158:         Diamond.DiamondStorage storage ds = Diamond.getDiamondStorage(); // <= FOUND 'Diamond.'

```
['[210](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L210-L210)']
```solidity
210:             Diamond.FacetToSelectors memory facetToSelectors = ds.facetToSelectors[facetAddr]; // <= FOUND 'Diamond.'

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L22-L22)']
```solidity
22:     Diamond.DiamondCutData diamondCut; // <= FOUND 'Diamond.'

```
['[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L67-L67)']
```solidity
67:     function setInitialCutHash(Diamond.DiamondCutData calldata _diamondCut) external; // <= FOUND 'Diamond.'

```
['[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L84-L85)']
```solidity
84:     function setNewVersionUpgrade(
85:         Diamond.DiamondCutData calldata _cutData, // <= FOUND 'Diamond.'
86:         uint256 _oldProtocolVersion,
87:         uint256 _newProtocolVersion
88:     ) external;

```
['[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/IStateTransitionManager.sol#L90-L90)']
```solidity
90:     function setUpgradeDiamondCut(Diamond.DiamondCutData calldata _cutData, uint256 _oldProtocolVersion) external; // <= FOUND 'Diamond.'

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L45-L45)']
```solidity
45:     function upgradeChainFromVersion(uint256 _protocolVersion, Diamond.DiamondCutData calldata _cutData) external; // <= FOUND 'Diamond.'

```
['[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L50-L53)']
```solidity
50:     
53:     function executeUpgrade(Diamond.DiamondCutData calldata _diamondCut) external; // <= FOUND 'Diamond.'

```
['[91](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L91-L92)']
```solidity
91:     
92:     event ExecuteUpgrade(Diamond.DiamondCutData diamondCut); // <= FOUND 'Diamond.'

```
['[17](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IZkSyncStateTransition.sol#L17-L19)']
```solidity
17:     
18:     event ProposeTransparentUpgrade(
19:         Diamond.DiamondCutData diamondCut, // <= FOUND 'Diamond.'
20:         uint256 indexed proposalId,
21:         bytes32 proposalSalt
22:     );

```
['[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L123-L127)']
```solidity
123:         
124:         
125:         
126: 
127:         bytes32 calculatedRootHash = Merkle.calculateRoot(_proof, _index, hashedLog); // <= FOUND 'Merkle.'

```
['[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L90-L91)']
```solidity
90:     
91:     PriorityQueue.Queue priorityQueue; // <= FOUND 'PriorityQueue.'

```
['[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L32-L32)']
```solidity
32:     using PriorityQueue for PriorityQueue.Queue; // <= FOUND 'PriorityQueue.'

```
['[325](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L325-L325)']
```solidity
325:         TransactionValidator.validateL1ToL2Transaction( // <= FOUND 'TransactionValidator.'
326:             transaction,
327:             transactionEncoding,
328:             s.priorityTxMaxGasLimit,
329:             s.feeParams.priorityTxMaxPubdata
330:         );

```
['[194](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L194-L194)']
```solidity
194:         TransactionValidator.validateL1ToL2Transaction( // <= FOUND 'TransactionValidator.'
195:             _l2ProtocolUpgradeTx,
196:             encodedTransaction,
197:             s.priorityTxMaxGasLimit,
198:             s.feeParams.priorityTxMaxPubdata
199:         );

```
['[201](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L201-L201)']
```solidity
201:         TransactionValidator.validateUpgradeTransaction(_l2ProtocolUpgradeTx); // <= FOUND 'TransactionValidator.'

```
['[579](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L579-L580)']
```solidity
579:                 refundRecipient = _prevMsgSender != tx.origin
580:                     ? AddressAliasHelper.applyL1ToL2Alias(_prevMsgSender) // <= FOUND 'AddressAliasHelper.'
581:                     : _prevMsgSender;

```
['[328](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L328-L329)']
```solidity
328:             
329:             _recipient = msg.sender == tx.origin ? msg.sender : AddressAliasHelper.applyL1ToL2Alias(msg.sender); // <= FOUND 'AddressAliasHelper.'

```
['[331](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L331-L332)']
```solidity
331:             
332:             _recipient = AddressAliasHelper.applyL1ToL2Alias(_refundRecipient); // <= FOUND 'AddressAliasHelper.'

```
['[235](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L235-L235)']
```solidity
235:             l2Sender = AddressAliasHelper.applyL1ToL2Alias(_request.sender); // <= FOUND 'AddressAliasHelper.'

```
['[278](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L278-L278)']
```solidity
278:             refundRecipient = AddressAliasHelper.applyL1ToL2Alias(refundRecipient); // <= FOUND 'AddressAliasHelper.'

```
['[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L87-L90)']
```solidity
87:         
88:         require(
89:             AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1Bridge || // <= FOUND 'AddressAliasHelper.'
90:                 AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1LegacyBridge, // <= FOUND 'AddressAliasHelper.'
91:             "mq"
92:         );

```
['[29](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L29-L29)']
```solidity
29:             txHash = keccak256(bytes.concat(signedTxHash, EfficientCall.keccak(_transaction.signature))); // <= FOUND 'EfficientCall.'

```
['[189](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L189-L189)']
```solidity
189:         stateDiffHash = EfficientCall.keccak(_stateDiffs); // <= FOUND 'EfficientCall.'

```
['[103](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L103-L105)']
```solidity
103:         
104:         
105:         bytes32 constructorInputHash = EfficientCall.keccak(_input); // <= FOUND 'EfficientCall.'

```
['[343](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L343-L343)']
```solidity
343:             bytes memory returnData = EfficientCall.mimicCall(gasleft(), _newAddress, _input, _sender, true, _isSystem); // <= FOUND 'EfficientCall.'

```
['[149](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L149-L149)']
```solidity
149:         bool success = EfficientCall.rawCall(gas, to, value, data, isSystemCall); // <= FOUND 'EfficientCall.'

```
['[151](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L151-L151)']
```solidity
151:             EfficientCall.propagateRevert(); // <= FOUND 'EfficientCall.'

```
['[118](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L118-L118)']
```solidity
118:         hash = EfficientCall.keccak(_message); // <= FOUND 'EfficientCall.'

```
['[207](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L207-L207)']
```solidity
207:             bytes32 hashedLog = EfficientCall.keccak( // <= FOUND 'EfficientCall.'
208:                 _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + L2_TO_L1_LOG_SERIALIZE_SIZE]
209:             );

```
['[239](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L239-L239)']
```solidity
239:             bytes32 hashedMessage = EfficientCall.keccak( // <= FOUND 'EfficientCall.'
240:                 _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + currentMessageLength]
241:             );

```
['[321](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L321-L324)']
```solidity
321:         SystemContractHelper.toL1( // <= FOUND 'SystemContractHelper.'
322:             true,
323:             bytes32(uint256(SystemLogKey.TOTAL_L2_TO_L1_PUBDATA_KEY)),
324:             EfficientCall.keccak(totalL2ToL1Pubdata) // <= FOUND 'EfficientCall.'
325:         );

```
['[81](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L81-L81)']
```solidity
81:         return EfficientCall.mimicCall(userGas, to, _data, msg.sender, false, isSystemCall); // <= FOUND 'EfficientCall.'

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L57-L61)']
```solidity
57:         
58:         
59:         
60:         
61:         bytes memory returnData = EfficientCall.call(gasleft(), _to, msg.value, _data, false); // <= FOUND 'EfficientCall.'

```
['[119](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L119-L134)']
```solidity
119:         bytes32 structHash = keccak256(
120:             abi.encode(
121:                 EIP712_TRANSACTION_TYPE_HASH,
122:                 _transaction.txType,
123:                 _transaction.from,
124:                 _transaction.to,
125:                 _transaction.gasLimit,
126:                 _transaction.gasPerPubdataByteLimit,
127:                 _transaction.maxFeePerGas,
128:                 _transaction.maxPriorityFeePerGas,
129:                 _transaction.paymaster,
130:                 _transaction.nonce,
131:                 _transaction.value,
132:                 EfficientCall.keccak(_transaction.data), // <= FOUND 'EfficientCall.'
133:                 keccak256(abi.encodePacked(_transaction.factoryDeps)),
134:                 EfficientCall.keccak(_transaction.paymasterInput) // <= FOUND 'EfficientCall.'
135:             )
136:         );

```
['[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L89-L90)']
```solidity
89:         hashedBytecode =
90:             EfficientCall.sha(_bytecode) & // <= FOUND 'EfficientCall.'
91:             0x00000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF;

```
['[52](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L52-L59)']
```solidity
52:         
53:         
54:         
55:         
56:         
57:         
58: 
59:         bytes memory encodedNonce = RLPEncoder.encodeUint256(_transaction.nonce); // <= FOUND 'RLPEncoder.'

```
['[56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L56-L56)']
```solidity
56:             bytes memory encodedGasPrice = RLPEncoder.encodeUint256(_transaction.maxFeePerGas); // <= FOUND 'RLPEncoder.'

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L57-L57)']
```solidity
57:             bytes memory encodedGasLimit = RLPEncoder.encodeUint256(_transaction.gasLimit); // <= FOUND 'RLPEncoder.'

```
['[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L61-L61)']
```solidity
61:         bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); // <= FOUND 'RLPEncoder.'

```
['[62](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L62-L62)']
```solidity
62:         bytes memory encodedValue = RLPEncoder.encodeUint256(_transaction.value); // <= FOUND 'RLPEncoder.'

```
['[71](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L71-L72)']
```solidity
71:                 
72:                 encodedDataLength = RLPEncoder.encodeNonSingleBytesLen(txDataLen); // <= FOUND 'RLPEncoder.'

```
['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L82-L82)']
```solidity
82:             rEncoded = RLPEncoder.encodeUint256(rInt); // <= FOUND 'RLPEncoder.'

```
['[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L87-L87)']
```solidity
87:             sEncoded = RLPEncoder.encodeUint256(sInt); // <= FOUND 'RLPEncoder.'

```
['[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L100-L100)']
```solidity
100:             vEncoded = RLPEncoder.encodeUint256(vInt); // <= FOUND 'RLPEncoder.'

```
['[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L116-L117)']
```solidity
116:             
117:             encodedListLength = RLPEncoder.encodeListLen(uint64(listLength)); // <= FOUND 'RLPEncoder.'

```
['[143](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L143-L143)']
```solidity
143:             bytes memory encodedChainId = RLPEncoder.encodeUint256(block.chainid); // <= FOUND 'RLPEncoder.'

```
['[144](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L144-L144)']
```solidity
144:             bytes memory encodedNonce = RLPEncoder.encodeUint256(_transaction.nonce); // <= FOUND 'RLPEncoder.'

```
['[147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L147-L147)']
```solidity
147:             bytes memory encodedTo = RLPEncoder.encodeAddress(address(uint160(_transaction.to))); // <= FOUND 'RLPEncoder.'

```
['[148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L148-L148)']
```solidity
148:             bytes memory encodedValue = RLPEncoder.encodeUint256(_transaction.value); // <= FOUND 'RLPEncoder.'

```
['[176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L176-L177)']
```solidity
176:         
177:         bytes memory encodedAccessListLength = RLPEncoder.encodeListLen(0); // <= FOUND 'RLPEncoder.'

```
['[193](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L193-L193)']
```solidity
193:             vEncoded = RLPEncoder.encodeUint256(vInt - 27); // <= FOUND 'RLPEncoder.'

```
['[238](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L238-L238)']
```solidity
238:             bytes memory encodedMaxPriorityFeePerGas = RLPEncoder.encodeUint256(_transaction.maxPriorityFeePerGas); // <= FOUND 'RLPEncoder.'

```
['[239](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L239-L239)']
```solidity
239:             bytes memory encodedMaxFeePerGas = RLPEncoder.encodeUint256(_transaction.maxFeePerGas); // <= FOUND 'RLPEncoder.'

```
['[185](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L185-L185)']
```solidity
185:             encodedChainId = bytes.concat(RLPEncoder.encodeUint256(block.chainid), hex"80_80"); // <= FOUND 'RLPEncoder.'

```
['[341](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L341-L342)']
```solidity
341:                 
342:                 SystemContractHelper.setValueForNextFarCall(uint128(value)); // <= FOUND 'SystemContractHelper.'

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L46-L46)']
```solidity
46:         address codeAddress = SystemContractHelper.getCodeAddress(); // <= FOUND 'SystemContractHelper.'

```
['[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L90-L90)']
```solidity
90:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), 0); // <= FOUND 'SystemContractHelper.'

```
['[154](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L154-L154)']
```solidity
154:         SystemContractHelper.burnGas(Utils.safeCastToU32(gasToPay), uint32(pubdataLen)); // <= FOUND 'SystemContractHelper.'

```
['[320](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L320-L321)']
```solidity
320:         
321:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.L2_TO_L1_LOGS_TREE_ROOT_KEY)), l2ToL1LogsTreeRoot); // <= FOUND 'SystemContractHelper.'

```
['[326](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L326-L326)']
```solidity
326:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.STATE_DIFF_HASH_KEY)), stateDiffHash); // <= FOUND 'SystemContractHelper.'

```
['[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L26-L26)']
```solidity
26:         value = SystemContractHelper.getExtraAbiData(0); // <= FOUND 'SystemContractHelper.'

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L27-L27)']
```solidity
27:         uint256 addressAsUint = SystemContractHelper.getExtraAbiData(1); // <= FOUND 'SystemContractHelper.'

```
['[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L28-L28)']
```solidity
28:         uint256 mask = SystemContractHelper.getExtraAbiData(2); // <= FOUND 'SystemContractHelper.'

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L79-L80)']
```solidity
79:         
80:         SystemContractHelper.setValueForNextFarCall(Utils.safeCastToU128(value)); // <= FOUND 'SystemContractHelper.'

```
['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L55-L55)']
```solidity
55:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_ONE_HASH_KEY)), blobHashes[0]); // <= FOUND 'SystemContractHelper.'

```
['[56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L56-L56)']
```solidity
56:         SystemContractHelper.toL1(true, bytes32(uint256(SystemLogKey.BLOB_TWO_HASH_KEY)), blobHashes[1]); // <= FOUND 'SystemContractHelper.'

```
['[118](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L118-L118)']
```solidity
118:         uint256 pubdataPublished = SystemContractHelper.getZkSyncMeta().pubdataPublished; // <= FOUND 'SystemContractHelper.'

```
['[418](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L418-L418)']
```solidity
418:         SystemContractHelper.toL1( // <= FOUND 'SystemContractHelper.'
419:             false,
420:             bytes32(uint256(SystemLogKey.PACKED_BATCH_AND_L2_BLOCK_TIMESTAMP_KEY)),
421:             bytes32(packedTimestamps)
422:         );

```
['[466](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L466-L467)']
```solidity
466:         
467:         SystemContractHelper.toL1(false, bytes32(uint256(SystemLogKey.PREV_BATCH_HASH_KEY)), _prevBatchHash); // <= FOUND 'SystemContractHelper.'

```
['[251](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L251-L251)']
```solidity
251:         SystemContractHelper.loadCalldataIntoActivePtr(); // <= FOUND 'SystemContractHelper.'

```
['[259](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L259-L260)']
```solidity
259:         
260:         SystemContractHelper.ptrAddIntoActive(uint32(dataOffset)); // <= FOUND 'SystemContractHelper.'

```
['[262](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L262-L262)']
```solidity
262:         SystemContractHelper.ptrShrinkIntoActive(shrinkTo); // <= FOUND 'SystemContractHelper.'

```
['[273](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L273-L273)']
```solidity
273:         SystemContractHelper.ptrPackIntoActivePtr(farCallAbi); // <= FOUND 'SystemContractHelper.'

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L21-L22)']
```solidity
21:         require(
22:             SystemContractHelper.isSystemCall() || SystemContractHelper.isSystemContract(msg.sender), // <= FOUND 'SystemContractHelper.'
23:             "This method require system call flag"
24:         );

```
['[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/interfaces/ISystemContract.sol#L31-L32)']
```solidity
31:         require(
32:             SystemContractHelper.isSystemContract(msg.sender), // <= FOUND 'SystemContractHelper.'
33:             "This method require the caller to be system contract"
34:         );

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L37-L38)']
```solidity
37:         
38:         require(Utils.isContractConstructing(_hash), "Code hash is not for a contract on constructor"); // <= FOUND 'Utils.'

```
['[48](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L48-L49)']
```solidity
48:         
49:         require(Utils.isContractConstructed(_hash), "Code hash is not for a constructed contract"); // <= FOUND 'Utils.'

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L57-L57)']
```solidity
57:         require(Utils.isContractConstructing(codeHash), "Code hash is not for a contract on constructor"); // <= FOUND 'Utils.'

```
['[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L60-L61)']
```solidity
60:         
61:         bytes32 constructedBytecodeHash = Utils.constructedBytecodeHash(codeHash); // <= FOUND 'Utils.'

```
['[107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L107-L109)']
```solidity
107:         
108:         
109:         else if (Utils.isContractConstructing(codeHash)) { // <= FOUND 'Utils.'

```
['[131](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L131-L142)']
```solidity
131:         
132:         
133:         
134:         
135:         
136:         
137:         
138:         
139:         if (
140:             uint160(account) > CURRENT_MAX_PRECOMPILE_ADDRESS &&
141:             codeHash != 0x00 &&
142:             !Utils.isContractConstructing(codeHash) // <= FOUND 'Utils.'
143:         ) {

```
['[136](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L136-L136)']
```solidity
136:             codeSize = Utils.bytecodeLenInBytes(codeHash); // <= FOUND 'Utils.'

```
['[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L72-L72)']
```solidity
72:         bytecodeHash = Utils.hashL2Bytecode(_bytecode); // <= FOUND 'Utils.'

```
['[311](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L311-L312)']
```solidity
311:         
312:         bytes32 constructingBytecodeHash = Utils.constructingBytecodeHash(_bytecodeHash); // <= FOUND 'Utils.'

```
['[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L133-L133)']
```solidity
133:         uint128 value = Utils.safeCastToU128(_transaction.value); // <= FOUND 'Utils.'

```
['[135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L135-L135)']
```solidity
135:         uint32 gas = Utils.safeCastToU32(gasleft()); // <= FOUND 'Utils.'

```
['[78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L78-L78)']
```solidity
78:         require(Utils.bytecodeLenInWords(_bytecodeHash) % 2 == 1, "Code length in words must be odd"); // <= FOUND 'Utils.'

```
['[166](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L166-L166)']
```solidity
166:         uint256 bytecodeLen = Utils.bytecodeLenInBytes(_bytecodeHash); // <= FOUND 'Utils.'

```
['[259](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L259-L262)']
```solidity
259:             reconstructedChainedL1BytecodesRevealDataHash = keccak256(
260:                 abi.encode(
261:                     reconstructedChainedL1BytecodesRevealDataHash,
262:                     Utils.hashL2Bytecode( // <= FOUND 'Utils.'
263:                         _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + currentBytecodeLength]
264:                     )
265:                 )
266:             );

```
['[264](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L264-L264)']
```solidity
264:         uint32 gas = Utils.safeCastToU32(_gas); // <= FOUND 'Utils.'

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L44-L44)']
```solidity
44:         uint32 dataLength = uint32(Utils.safeCastToU32(data.length)); // <= FOUND 'Utils.'

```
['[83](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L83-L84)']
```solidity
83:         
84:         SystemContractsCaller.systemCallWithPropagatedRevert( // <= FOUND 'SystemContractsCaller.'
85:             uint32(gasleft()),
86:             address(NONCE_HOLDER_SYSTEM_CONTRACT),
87:             0,
88:             abi.encodeCall(INonceHolder.incrementMinNonceIfEquals, (_transaction.nonce))
89:         );

```
['[265](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L265-L265)']
```solidity
265:         uint256 farCallAbi = SystemContractsCaller.getFarCallABIWithEmptyFatPointer( // <= FOUND 'SystemContractsCaller.'
266:             gas,
267:             
268:             0,
269:             CalldataForwardingMode.ForwardFatPointer,
270:             _isConstructor,
271:             _isSystem
272:         );

```
['[165](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L165-L165)']
```solidity
165:         (bool success, bytes memory returndata) = SystemContractsCaller.systemCallWithReturndata( // <= FOUND 'SystemContractsCaller.'
166:             uint32(gasleft()),
167:             DEPLOYER_SYSTEM_CONTRACT,
168:             0,
169:             abi.encodeCall(
170:                 IContractDeployer.create2,
171:                 (salt, l2TokenProxyBytecodeHash, abi.encode(address(l2TokenBeacon), ""))
172:             )
173:         );

```


</details>

## [NonCritical-102] Try catch statement without human readable error

### Resolution 
In Solidity, the `try-catch` statement is used for handling exceptions in external function calls and contract creation. However, when a `try-catch` block doesn't include a catch for specific human-readable errors (using `catch Error(string memory reason)`), it can miss catching exceptions that provide explanatory error messages. This lack of detailed error handling could hinder debugging and obscure the reasons behind transaction failures. To address this, it's recommended to include a catch block specifically for `Error` to capture and handle these descriptive error messages effectively. This practice enhances the contract's robustness by providing clearer insights into why certain operations fail, thereby improving maintainability and troubleshooting.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[77](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L77-L77)']
```solidity
77:         } catch { // <= FOUND

```


</details>

## [NonCritical-103] Avoid revertible function calls in a constructor

### Resolution 
It is advisable to to perform validation within the constructor itself rather than in function calls it makes. This is because contract deployement may be performed through a frontend or manually so by having all of the validation conditions viewable in a single place allows for greater transparency during deployment for both the team and project users.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[15](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L15-L15)']
```solidity
11:     constructor(uint256 _chainId, Diamond.DiamondCutData memory _diamondCut) {
12:         
13:         
14:         require(_chainId == block.chainid, "pr");
15:         Diamond.diamondCut(_diamondCut); // <= FOUND
16:     }

```


</details>

## [NonCritical-104] Inconsistent checks of address params against address(0)

### Resolution 
Only some address parameters are checked against address(0), to ensure consistency ensure all address parameters are checked.

Num of instances: 8

### Findings 


<details><summary>Click to show findings</summary>

['[182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L182-L184)']
```solidity
182:     function bridgehubDeposit(
183:         uint256 _chainId,
184:         address _prevMsgSender, // <= FOUND 'address _prevMsgSender'
185:         uint256, 
186:         bytes calldata _data
187:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) {
188:         require(l2BridgeAddress[_chainId] != address(0), "ShB l2 bridge not deployed");
189: 
190:         (address _l1Token, uint256 _depositAmount, address _l2Receiver) = abi.decode(
191:             _data,
192:             (address, uint256, address)
193:         );
194:         require(_l1Token != l1WethAddress, "ShB: WETH deposit not supported");
195:         require(bridgehub.baseToken(_chainId) != _l1Token, "ShB: baseToken deposit not supported");
196: 
197:         uint256 amount;
198:         if (_l1Token == ETH_TOKEN_ADDRESS) {
199:             amount = msg.value;
200:             require(_depositAmount == 0, "ShB wrong withdraw amount");
201:         } else {
202:             require(msg.value == 0, "ShB m.v > 0 for BH d.it 2");
203:             amount = _depositAmount;
204: 
205:             uint256 withdrawAmount = _depositFunds(_prevMsgSender, IERC20(_l1Token), _depositAmount);
206:             require(withdrawAmount == _depositAmount, "5T"); 
207:         }
208:         require(amount != 0, "6T"); 
209: 
210:         bytes32 txDataHash = keccak256(abi.encode(_prevMsgSender, _l1Token, amount));
211:         if (!hyperbridgingEnabled[_chainId]) {
212:             chainBalance[_chainId][_l1Token] += amount;
213:         }
214: 
215:         {
216:             
217:             bytes memory l2TxCalldata = _getDepositL2Calldata(_prevMsgSender, _l2Receiver, _l1Token, amount);
218: 
219:             request = L2TransactionRequestTwoBridgesInner({
220:                 magicValue: TWO_BRIDGES_MAGIC_VALUE,
221:                 l2Contract: l2BridgeAddress[_chainId],
222:                 l2Calldata: l2TxCalldata,
223:                 factoryDeps: new bytes[](0),
224:                 txDataHash: txDataHash
225:             });
226:         }
227:         emit BridgehubDepositInitiated(_chainId, txDataHash, _prevMsgSender, _l2Receiver, _l1Token, amount);
228:     }

```
['[554](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L554-L555)']
```solidity
554:     function depositLegacyErc20Bridge(
555:         address _prevMsgSender, // <= FOUND 'address _prevMsgSender'
556:         address _l2Receiver,
557:         address _l1Token,
558:         uint256 _amount,
559:         uint256 _l2TxGasLimit,
560:         uint256 _l2TxGasPerPubdataByte,
561:         address _refundRecipient
562:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) {
563:         require(l2BridgeAddress[ERA_CHAIN_ID] != address(0), "ShB b. n dep");
564:         require(_l1Token != l1WethAddress, "ShB: WETH deposit not supported 2");
565: 
566:         
567:         if (!hyperbridgingEnabled[ERA_CHAIN_ID]) {
568:             chainBalance[ERA_CHAIN_ID][_l1Token] += _amount;
569:         }
570: 
571:         bytes memory l2TxCalldata = _getDepositL2Calldata(_prevMsgSender, _l2Receiver, _l1Token, _amount);
572: 
573:         {
574:             
575:             
576:             
577:             address refundRecipient = _refundRecipient;
578:             if (_refundRecipient == address(0)) {
579:                 refundRecipient = _prevMsgSender != tx.origin
580:                     ? AddressAliasHelper.applyL1ToL2Alias(_prevMsgSender)
581:                     : _prevMsgSender;
582:             }
583: 
584:             L2TransactionRequestDirect memory request = L2TransactionRequestDirect({
585:                 chainId: ERA_CHAIN_ID,
586:                 l2Contract: l2BridgeAddress[ERA_CHAIN_ID],
587:                 mintValue: msg.value, 
588:                 l2Value: 0, 
589:                 l2Calldata: l2TxCalldata,
590:                 l2GasLimit: _l2TxGasLimit,
591:                 l2GasPerPubdataByteLimit: _l2TxGasPerPubdataByte,
592:                 factoryDeps: new bytes[](0),
593:                 refundRecipient: refundRecipient
594:             });
595:             l2TxHash = bridgehub.requestL2TransactionDirect{value: msg.value}(request);
596:         }
597: 
598:         bytes32 txDataHash = keccak256(abi.encode(_prevMsgSender, _l1Token, _amount));
599:         
600:         depositHappened[ERA_CHAIN_ID][l2TxHash] = txDataHash;
601: 
602:         emit LegacyDepositInitiated(ERA_CHAIN_ID, l2TxHash, _prevMsgSender, _l2Receiver, _l1Token, _amount);
603:     }

```
['[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L119)']
```solidity
114:     function createNewChain(
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken, // <= FOUND 'address _baseToken'
118:         uint256, 
119:         address _admin, // <= FOUND 'address _admin'
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) {
122:         require(_chainId != 0, "Bridgehub: chainId cannot be 0");
123:         require(_chainId <= type(uint48).max, "Bridgehub: chainId too large");
124: 
125:         require(
126:             stateTransitionManagerIsRegistered[_stateTransitionManager],
127:             "Bridgehub: state transition not registered"
128:         );
129:         require(tokenIsRegistered[_baseToken], "Bridgehub: token not registered");
130:         require(address(sharedBridge) != address(0), "Bridgehub: weth bridge not set");
131: 
132:         require(stateTransitionManager[_chainId] == address(0), "Bridgehub: chainId already registered");
133: 
134:         stateTransitionManager[_chainId] = _stateTransitionManager;
135:         baseToken[_chainId] = _baseToken;
136: 
137:         IStateTransitionManager(_stateTransitionManager).createNewChain(
138:             _chainId,
139:             _baseToken,
140:             address(sharedBridge),
141:             _admin,
142:             _initData
143:         );
144: 
145:         emit NewChain(_chainId, _stateTransitionManager, _admin);
146:         return _chainId;
147:     }

```
['[239](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L239-L243)']
```solidity
239:     function createNewChain(
240:         uint256 _chainId,
241:         address _baseToken, // <= FOUND 'address _baseToken'
242:         address _sharedBridge,
243:         address _admin, // <= FOUND 'address _admin'
244:         bytes calldata _diamondCut
245:     ) external onlyBridgehub {
246:         if (stateTransition[_chainId] != address(0)) {
247:             
248:             return;
249:         }
250: 
251:         
252:         Diamond.DiamondCutData memory diamondCut = abi.decode(_diamondCut, (Diamond.DiamondCutData));
253: 
254:         
255:         bytes32 cutHashInput = keccak256(_diamondCut);
256:         require(cutHashInput == initialCutHash, "StateTransition: initial cutHash mismatch");
257: 
258:         
259:         bytes memory initData;
260:         
261:         initData = bytes.concat(
262:             IDiamondInit.initialize.selector,
263:             bytes32(_chainId),
264:             bytes32(uint256(uint160(bridgehub))),
265:             bytes32(uint256(uint160(address(this)))),
266:             bytes32(uint256(protocolVersion)),
267:             bytes32(uint256(uint160(_admin))),
268:             bytes32(uint256(uint160(validatorTimelock))),
269:             bytes32(uint256(uint160(_baseToken))),
270:             bytes32(uint256(uint160(_sharedBridge))),
271:             bytes32(storedBatchZero),
272:             diamondCut.initCalldata
273:         );
274: 
275:         diamondCut.initCalldata = initData;
276:         
277:         DiamondProxy stateTransitionContract = new DiamondProxy{salt: bytes32(0)}(block.chainid, diamondCut);
278: 
279:         
280:         address stateTransitionAddress = address(stateTransitionContract);
281: 
282:         stateTransition[_chainId] = stateTransitionAddress;
283: 
284:         
285:         _setChainIdUpgrade(_chainId, stateTransitionAddress);
286: 
287:         emit StateTransitionNewChain(_chainId, stateTransitionAddress);
288:     }

```
['[126](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L126-L126)']
```solidity
126:     function _addFunctions(address _facet, bytes4[] memory _selectors, bool _isFacetFreezable) private { // <= FOUND '    function _addFunctions(address _facet, bytes4[] memory _selectors, bool _isFacetFreezable) private '
127:         DiamondStorage storage ds = getDiamondStorage();
128: 
129:         
130:         
131:         
132:         require(_facet.code.length > 0, "G");
133: 
134:         
135:         _saveFacetIfNew(_facet);
136: 
137:         uint256 selectorsLength = _selectors.length;
138:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) {
139:             bytes4 selector = _selectors[i];
140:             SelectorToFacet memory oldFacet = ds.selectorToFacet[selector];
141:             require(oldFacet.facetAddress == address(0), "J"); 
142: 
143:             _addOneFunction(_facet, selector, _isFacetFreezable);
144:         }
145:     }

```
['[149](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L149-L149)']
```solidity
149:     function _replaceFunctions(address _facet, bytes4[] memory _selectors, bool _isFacetFreezable) private { // <= FOUND 'address _facet'
150:         DiamondStorage storage ds = getDiamondStorage();
151: 
152:         
153:         
154:         
155:         require(_facet.code.length > 0, "K");
156: 
157:         uint256 selectorsLength = _selectors.length;
158:         for (uint256 i = 0; i < selectorsLength; i = i.uncheckedInc()) {
159:             bytes4 selector = _selectors[i];
160:             SelectorToFacet memory oldFacet = ds.selectorToFacet[selector];
161:             require(oldFacet.facetAddress != address(0), "L"); 
162: 
163:             _removeOneFunction(oldFacet.facetAddress, selector);
164:             
165:             _saveFacetIfNew(_facet);
166:             _addOneFunction(_facet, selector, _isFacetFreezable);
167:         }
168:     }

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L79-L80)']
```solidity
79:     function finalizeDeposit(
80:         address _l1Sender, // <= FOUND 'address _l1Sender'
81:         address _l2Receiver,
82:         address _l1Token,
83:         uint256 _amount,
84:         bytes calldata _data
85:     ) external payable override {
86:         
87:         require(
88:             AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1Bridge ||
89:                 AddressAliasHelper.undoL1ToL2Alias(msg.sender) == l1LegacyBridge,
90:             "mq"
91:         );
92:         require(msg.value == 0, "Value should be 0 for ERC20 bridge");
93: 
94:         address expectedL2Token = l2TokenAddress(_l1Token);
95:         address currentL1Token = l1TokenAddress[expectedL2Token];
96:         if (currentL1Token == address(0)) {
97:             address deployedToken = _deployL2Token(_l1Token, _data);
98:             require(deployedToken == expectedL2Token, "mt");
99:             l1TokenAddress[expectedL2Token] = _l1Token;
100:         } else {
101:             require(currentL1Token == _l1Token, "gg"); 
102:         }
103: 
104:         IL2StandardToken(expectedL2Token).bridgeMint(_l2Receiver, _amount);
105:         emit FinalizeDeposit(_l1Sender, _l2Receiver, expectedL2Token, _amount);
106:     }

```
['[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L123-L123)']
```solidity
123:     function withdraw(address _l1Receiver, address _l2Token, uint256 _amount) external override { // <= FOUND '    function withdraw(address _l1Receiver, address _l2Token, uint256 _amount) external override '
124:         require(_amount > 0, "Amount cannot be zero");
125: 
126:         IL2StandardToken(_l2Token).bridgeBurn(msg.sender, _amount);
127: 
128:         address l1Token = l1TokenAddress[_l2Token];
129:         require(l1Token != address(0), "yh");
130: 
131:         bytes memory message = _getL1WithdrawMessage(_l1Receiver, l1Token, _amount);
132:         L2ContractHelper.sendMessageToL1(message);
133: 
134:         emit WithdrawalInitiated(msg.sender, _l1Receiver, _l2Token, _amount);
135:     }

```


</details>

## [NonCritical-105] Avoid declaring variables with the names of defined functions within the project

### Resolution 
Having such variables can create confusion in both developers and in users of the project. Consider renaming these variables to improve code clarity.

Num of instances: 14

### Findings 


<details><summary>Click to show findings</summary>

['[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L102-L102)']
```solidity
99:         
100:         
101:         
102:         uint256 totalRequiredBalance = _transaction.totalRequiredBalance(); // <= FOUND

```
['[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L36-L36)']
```solidity
35:     
36:     mapping(address l2TokenAddress => address l1TokenAddress) public override l1TokenAddress; // <= FOUND

```
['[28](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L28-L28)']
```solidity
28:         address facetAddress = facet.facetAddress; // <= FOUND

```
['[52](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L52-L52)']
```solidity
52:         mapping(address facetAddress => FacetToSelectors facetInfo) facetToSelectors; // <= FOUND

```
['[104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L104-L104)']
```solidity
104:             bool isFacetFreezable = facetCuts[i].isFreezable; // <= FOUND

```
['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L30-L30)']
```solidity
25:     
30:     function _getAbiParams() internal view returns (uint256 value, bool isSystemCall, address to) { // <= FOUND

```
['[57](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L57-L57)']
```solidity
57:         (uint256 value, bool isSystemCall, address to) = _getAbiParams(); // <= FOUND

```
['[83](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L83-L83)']
```solidity
82:     
83:     bytes32 constant EIP712_DOMAIN_TYPEHASH = keccak256("EIP712Domain(string name,string version,uint256 chainId)"); // <= FOUND

```
['[6](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/interfaces/IL2StandardToken.sol#L6-L6)']
```solidity
6:     event BridgeInitialize(address indexed l1Token, string name, string symbol, uint8 decimals); // <= FOUND

```
['[153](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L153-L153)']
```solidity
151:     
153:     uint128 baseTokenGasPriceMultiplierNominator; // <= FOUND

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L152-L152)']
```solidity
152:     uint128 baseTokenGasPriceMultiplierDenominator; // <= FOUND

```
['[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L31-L31)']
```solidity
31:         address facetAddress; // <= FOUND

```
['[139](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L139-L139)']
```solidity
138:         
139:         bool isSystemCall; // <= FOUND

```
['[75](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L75-L75)']
```solidity
74:     
75:     mapping(address validatorAddress => bool isValidator) validators; // <= FOUND

```


</details>

## [NonCritical-106] All verbatim blocks are considered identical by deduplicator and can incorrectly be unified

### Resolution 
The Solidity Team reported a bug on October 24, 2023, affecting Yul code using the verbatim builtin, specifically in the Block Deduplicator optimizer step. This bug, present since Solidity version 0.8.5, caused incorrect deduplication of verbatim assembly items surrounded by identical opcodes, considering them identical regardless of their data. The bug was confined to pure Yul compilation with optimization enabled and was unlikely to be exploited as an attack vector.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[3](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L3-L3)']
```solidity
3: pragma solidity 0.8.20; // <= FOUND

```


</details>

## [NonCritical-107] Simplify complex require statements

### Resolution 
Simplifying complex require statements with multiple logical OR (||) operators in Solidity can be achieved by using revert statements. This involves converting the conditional logic of require into separate if statements, each followed by a revert for specific failing conditions. This approach enhances readability and maintains clarity, especially when dealing with multiple conditions. It allows for more descriptive error messages for each specific case, improving the debugging process and making the code more maintainable. 

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L33-L35)']
```solidity
33: require(
34:             msg.sender == MSG_VALUE_SYSTEM_CONTRACT || // <= FOUND
35:                 msg.sender == address(DEPLOYER_SYSTEM_CONTRACT) || // <= FOUND
36:                 msg.sender == BOOTLOADER_FORMAL_ADDRESS,
37:             "Only system contracts with special access can call this method"
38:         );

```


</details>

## [NonCritical-108] Constructors should emit an event

### Resolution 
Emitting an event in a constructor of a smart contract provides transparency and traceability in blockchain applications. This event logs the contracts creation, aiding in monitoring and verifying contract deployment. Although constructors are executed only once, the emitted event ensures the contract's initialization is recorded on the blockchain.

Num of instances: 7

### Findings 


<details><summary>Click to show findings</summary>

['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L55-L56)']
```solidity
55:     constructor(IL1SharedBridge _sharedBridge) reentrancyGuardInitializer { // <= FOUND
56:         sharedBridge = _sharedBridge; // <= FOUND
57:     }

```
['[90](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L90-L98)']
```solidity
90:     constructor( // <= FOUND
91:         address _l1WethAddress,
92:         IBridgehub _bridgehub,
93:         IL1ERC20Bridge _legacyBridge
94:     ) reentrancyGuardInitializer {
95:         _disableInitializers(); // <= FOUND
96:         l1WethAddress = _l1WethAddress; // <= FOUND
97:         bridgehub = _bridgehub; // <= FOUND
98:         legacyBridge = _legacyBridge; // <= FOUND
99:     }

```
['[58](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L58-L59)']
```solidity
58:     constructor(address _bridgehub) reentrancyGuardInitializer { // <= FOUND
59:         bridgehub = _bridgehub; // <= FOUND
60:     }

```
['[55](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L55-L57)']
```solidity
55:     constructor(address _initialOwner, uint32 _executionDelay) { // <= FOUND
56:         _transferOwnership(_initialOwner); // <= FOUND
57:         executionDelay = _executionDelay; // <= FOUND
58:     }

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondProxy.sol#L11-L15)']
```solidity
11:     constructor(uint256 _chainId, Diamond.DiamondCutData memory _diamondCut) { // <= FOUND
12:         
13:         
14:         require(_chainId == block.chainid, "pr"); // <= FOUND
15:         Diamond.diamondCut(_diamondCut); // <= FOUND
16:     }

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L41-L42)']
```solidity
41:     constructor() { // <= FOUND
42:         _disableInitializers(); // <= FOUND
43:     }

```
['[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L40-L42)']
```solidity
40:     constructor() { // <= FOUND
41:         
42:         _disableInitializers(); // <= FOUND
43:     }

```


</details>

## [NonCritical-109] Struct fields should be mixedCase

### Resolution 
In programming, particularly in Solidity, struct fields should use mixedCase (camelCase) naming. This convention starts with a lowercase letter, capitalizing subsequent word beginnings, ensuring readability and coding standard conformity.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[66](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/ZkSyncStateTransitionStorage.sol#L66-L66)']
```solidity
66: struct ZkSyncStateTransitionStorage { // <= FOUND
67:     
68:     uint256[7] __DEPRECATED_diamondCutStorage;
69:     
70:     address __DEPRECATED_governor;
71:     
72:     address __DEPRECATED_pendingGovernor;
73:     
74:     mapping(address validatorAddress => bool isValidator) validators;
75:     
76:     IVerifier verifier;
77:     
79:     uint256 totalBatchesExecuted;
80:     
81:     uint256 totalBatchesVerified;
82:     
84:     uint256 totalBatchesCommitted;
85:     
86:     mapping(uint256 batchNumber => bytes32 batchHash) storedBatchHashes;
87:     
88:     mapping(uint256 batchNumber => bytes32 l2LogsRootHash) l2LogsRootHashes;
89:     
90:     PriorityQueue.Queue priorityQueue;
91:     
92:     address __DEPRECATED_allowList;
93:     
94:     VerifierParams verifierParams;
95:     
97:     bytes32 l2BootloaderBytecodeHash;
98:     
100:     bytes32 l2DefaultAccountBytecodeHash;
101:     
103:     bool zkPorterIsAvailable;
104:     
107:     uint256 priorityTxMaxGasLimit;
108:     
109:     UpgradeStorage __DEPRECATED_upgrades;
110:     
114:     mapping(uint256 l2BatchNumber => mapping(uint256 l2ToL1MessageNumber => bool isFinalized)) isEthWithdrawalFinalized;
115:     
116:     uint256 __DEPRECATED_lastWithdrawalLimitReset;
117:     
118:     uint256 __DEPRECATED_withdrawnAmountInWindow;
119:     
120:     mapping(address => uint256) __DEPRECATED_totalDepositedAmountPerUser;
121:     
123:     uint256 protocolVersion;
124:     
125:     bytes32 l2SystemContractsUpgradeTxHash;
126:     

```


</details>

## [NonCritical-110] int/uint passed into abi.encodePacked without casting to a string.

### Resolution 
Not casting an integer as a string before passing it into abi.encode can result in unintended behaviour. lets say '1' being encoded as '1' it will be encoded as char(1) which is the 'start of heading' control character or id of 60 would be encoded as '<'. This is may not be intended. To rectify this, simply cast the Id as a string with string(id) or ideally use solmate's libString library (toString)

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[605](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L605-L610)']
```solidity
605:     function _pointEvaluationPrecompile(
606:         bytes32 _versionedHash,
607:         bytes32 _openingPoint,
608:         bytes calldata _openingValueCommitmentProof
609:     ) internal view {
610:         bytes memory precompileInput = abi.encodePacked(_versionedHash, _openingPoint, _openingValueCommitmentProof); // <= FOUND
611: 
612:         (bool success, bytes memory data) = POINT_EVALUATION_PRECOMPILE_ADDR.staticcall(precompileInput);
613: 
614:         
615:         
616:         require(success, "failed to call point evaluation precompile");
617:         (, uint256 result) = abi.decode(data, (uint256, uint256));
618:         require(result == BLS_MODULUS, "precompile unexpected output");
619:     }

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L112-L113)']
```solidity
112:     function _getL1WithdrawMessage(address _to, uint256 _amount) internal pure returns (bytes memory) { // <= FOUND
113:         return abi.encodePacked(IMailbox.finalizeEthWithdrawal.selector, _to, _amount); // <= FOUND
114:     }

```
['[117](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L117-L123)']
```solidity
117:     function _getExtendedWithdrawMessage(
118:         address _to,
119:         uint256 _amount,
120:         address _sender,
121:         bytes memory _additionalData
122:     ) internal pure returns (bytes memory) {
123:         return abi.encodePacked(IMailbox.finalizeEthWithdrawal.selector, _to, _amount, _sender, _additionalData); // <= FOUND
124:     }

```
['[233](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L233-L234)']
```solidity
233:     function _calculateLegacyL2BlockHash(uint128 _blockNumber) internal pure returns (bytes32) { // <= FOUND
234:         return keccak256(abi.encodePacked(uint32(_blockNumber))); // <= FOUND
235:     }

```
['[138](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L138-L145)']
```solidity
138:     function _getL1WithdrawMessage(
139:         address _to,
140:         address _l1Token,
141:         uint256 _amount
142:     ) internal pure returns (bytes memory) {
143:         
144:         
145:         return abi.encodePacked(IL1ERC20Bridge.finalizeWithdrawal.selector, _to, _l1Token, _amount); // <= FOUND
146:     }

```


</details>

## [NonCritical-111] Consider validating all user inputs

### Resolution 
Validating user inputs in external and public functions is a critical security practice in smart contract development. This approach prevents malicious or erroneous data from compromising contract integrity or behavior. By checking inputs against expected formats, ranges, or conditions before processing, contracts can avoid common vulnerabilities like reentrancy, overflow/underflow, and unauthorized access. 

Num of instances: 114

### Findings 


<details><summary>Click to show findings</summary>

['[98](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L98-L103)']
```solidity
98:     function deposit(
99:         address _l2Receiver, // <= FOUND ' _l2Receiver'
100:         address _l1Token,
101:         uint256 _amount, // <= FOUND ' uint256'
102:         uint256 _l2TxGasLimit, // <= FOUND ' uint256'
103:         uint256 _l2TxGasPerPubdataByte // <= FOUND ' uint256'
104:     ) external payable returns (bytes32 l2TxHash) 

```
['[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L133-L138)']
```solidity
133:     function deposit(
134:         address _l2Receiver, // <= FOUND ' _l2Receiver'
135:         address _l1Token,
136:         uint256 _amount, // <= FOUND ' uint256'
137:         uint256 _l2TxGasLimit, // <= FOUND ' uint256'
138:         uint256 _l2TxGasPerPubdataByte, // <= FOUND ' uint256'
139:         address _refundRecipient
140:     ) public payable nonReentrant returns (bytes32 l2TxHash) 

```
['[176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L176-L183)']
```solidity
176:     function claimFailedDeposit(
177:         address _depositSender, // <= FOUND ' _depositSender'
178:         address _l1Token,
179:         bytes32 _l2TxHash, // <= FOUND ' _l2TxHash'
180:         uint256 _l2BatchNumber, // <= FOUND ' _l2BatchNumber'
181:         uint256 _l2MessageIndex, // <= FOUND ' uint256'
182:         uint16 _l2TxNumberInBatch,
183:         bytes32[] calldata _merkleProof // <= FOUND ' calldata'
184:     ) external nonReentrant 

```
['[208](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L208-L213)']
```solidity
208:     function finalizeWithdrawal(
209:         uint256 _l2BatchNumber, // <= FOUND ' _l2BatchNumber'
210:         uint256 _l2MessageIndex, // <= FOUND ' uint256'
211:         uint16 _l2TxNumberInBatch,
212:         bytes calldata _message, // <= FOUND ' calldata'
213:         bytes32[] calldata _merkleProof // <= FOUND ' calldata'
214:     ) external nonReentrant 

```
['[104](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L104-L106)']
```solidity
104:     function initialize(
105:         address _owner,
106:         uint256 _eraFirstPostUpgradeBatch // <= FOUND ' _eraFirstPostUpgradeBatch'
107:     ) external reentrancyGuardInitializer initializer 

```
['[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L116-L116)']
```solidity
116:     function transferFundsFromLegacy(address _token, address _target, uint256 _targetChainId) external onlyOwner  // <= FOUND '    function transferFundsFromLegacy(address _token, address _target, uint256 _targetChainId) external onlyOwner '

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L142-L142)']
```solidity
142:     function initializeChainGovernance(uint256 _chainId, address _l2BridgeAddress) external onlyOwner  // <= FOUND '    function initializeChainGovernance(uint256 _chainId, address _l2BridgeAddress) external onlyOwner '

```
['[148](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L148-L152)']
```solidity
148:     function bridgehubDepositBaseToken(
149:         uint256 _chainId, // <= FOUND ' _chainId'
150:         address _prevMsgSender, // <= FOUND ' _prevMsgSender'
151:         address _l1Token,
152:         uint256 _amount // <= FOUND ' uint256'
153:     ) external payable virtual onlyBridgehubOrEra(_chainId) 

```
['[182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L182-L186)']
```solidity
182:     function bridgehubDeposit(
183:         uint256 _chainId, // <= FOUND ' _chainId'
184:         address _prevMsgSender, // <= FOUND ' _prevMsgSender'
185:         uint256,  // <= FOUND ' uint256'
186:         bytes calldata _data // <= FOUND ' calldata'
187:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request) 

```
['[232](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L232-L235)']
```solidity
232:     function bridgehubConfirmL2Transaction(
233:         uint256 _chainId, // <= FOUND ' _chainId'
234:         bytes32 _txDataHash,
235:         bytes32 _txHash // <= FOUND ' _txHash'
236:     ) external override onlyBridgehub 

```
['[277](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L277-L286)']
```solidity
277:     function claimFailedDeposit(
278:         uint256 _chainId, // <= FOUND ' _chainId'
279:         address _depositSender, // <= FOUND ' _depositSender'
280:         address _l1Token,
281:         uint256 _amount, // <= FOUND ' uint256'
282:         bytes32 _l2TxHash, // <= FOUND ' _l2TxHash'
283:         uint256 _l2BatchNumber, // <= FOUND ' _l2BatchNumber'
284:         uint256 _l2MessageIndex, // <= FOUND ' uint256'
285:         uint16 _l2TxNumberInBatch,
286:         bytes32[] calldata _merkleProof // <= FOUND ' calldata'
287:     ) external override 

```
['[385](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L385-L391)']
```solidity
385:     function finalizeWithdrawal(
386:         uint256 _chainId, // <= FOUND ' _chainId'
387:         uint256 _l2BatchNumber, // <= FOUND ' _l2BatchNumber'
388:         uint256 _l2MessageIndex, // <= FOUND ' uint256'
389:         uint16 _l2TxNumberInBatch,
390:         bytes calldata _message, // <= FOUND ' calldata'
391:         bytes32[] calldata _merkleProof // <= FOUND ' calldata'
392:     ) external override 

```
['[554](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L554-L560)']
```solidity
554:     function depositLegacyErc20Bridge(
555:         address _prevMsgSender, // <= FOUND ' _prevMsgSender'
556:         address _l2Receiver, // <= FOUND ' _l2Receiver'
557:         address _l1Token,
558:         uint256 _amount, // <= FOUND ' uint256'
559:         uint256 _l2TxGasLimit, // <= FOUND ' uint256'
560:         uint256 _l2TxGasPerPubdataByte, // <= FOUND ' uint256'
561:         address _refundRecipient
562:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash) 

```
['[615](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L615-L621)']
```solidity
615:     function finalizeWithdrawalLegacyErc20Bridge(
616:         uint256 _l2BatchNumber, // <= FOUND ' _l2BatchNumber'
617:         uint256 _l2MessageIndex, // <= FOUND ' uint256'
618:         uint16 _l2TxNumberInBatch,
619:         bytes calldata _message, // <= FOUND ' calldata'
620:         bytes32[] calldata _merkleProof // <= FOUND ' calldata'
621:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount)  // <= FOUND ' uint256'

```
['[644](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L644-L652)']
```solidity
644:     function claimFailedDepositLegacyErc20Bridge(
645:         address _depositSender, // <= FOUND ' _depositSender'
646:         address _l1Token,
647:         uint256 _amount, // <= FOUND ' uint256'
648:         bytes32 _l2TxHash, // <= FOUND ' _l2TxHash'
649:         uint256 _l2BatchNumber, // <= FOUND ' _l2BatchNumber'
650:         uint256 _l2MessageIndex, // <= FOUND ' uint256'
651:         uint16 _l2TxNumberInBatch,
652:         bytes32[] calldata _merkleProof // <= FOUND ' calldata'
653:     ) external override onlyLegacyBridge 

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin  // <= FOUND '    function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin '

```
['[51](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L51-L51)']
```solidity
51:     function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin  // <= FOUND '    function setPendingAdmin(address _newPendingAdmin) external onlyOwnerOrAdmin '

```
['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L82-L82)']
```solidity
82:     function addStateTransitionManager(address _stateTransitionManager) external onlyOwner  // <= FOUND '    function addStateTransitionManager(address _stateTransitionManager) external onlyOwner '

```
['[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L92-L92)']
```solidity
92:     function removeStateTransitionManager(address _stateTransitionManager) external onlyOwner  // <= FOUND ' _stateTransitionManager'

```
['[101](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L101-L101)']
```solidity
101:     function addToken(address _token) external onlyOwner  // <= FOUND '    function addToken(address _token) external onlyOwner '

```
['[114](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L114-L120)']
```solidity
114:     function createNewChain(
115:         uint256 _chainId, // <= FOUND ' _chainId'
116:         address _stateTransitionManager, // <= FOUND ' _stateTransitionManager'
117:         address _baseToken, // <= FOUND ' _baseToken'
118:         uint256,  // <= FOUND ' uint256'
119:         address _admin,
120:         bytes calldata _initData // <= FOUND ' calldata'
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId) 

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L152-L157)']
```solidity
152:     function proveL2MessageInclusion(
153:         uint256 _chainId, // <= FOUND ' _chainId'
154:         uint256 _batchNumber, // <= FOUND ' _batchNumber'
155:         uint256 _index, // <= FOUND ' uint256'
156:         L2Message calldata _message, // <= FOUND ' calldata'
157:         bytes32[] calldata _proof // <= FOUND ' calldata'
158:     ) external view override returns (bool) 

```
['[164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L164-L169)']
```solidity
164:     function proveL2LogInclusion(
165:         uint256 _chainId, // <= FOUND ' _chainId'
166:         uint256 _batchNumber, // <= FOUND ' _batchNumber'
167:         uint256 _index, // <= FOUND ' uint256'
168:         L2Log memory _log,
169:         bytes32[] calldata _proof // <= FOUND ' calldata'
170:     ) external view override returns (bool) 

```
['[176](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L176-L182)']
```solidity
176:     function proveL1ToL2TransactionStatus(
177:         uint256 _chainId, // <= FOUND ' _chainId'
178:         bytes32 _l2TxHash, // <= FOUND ' _l2TxHash'
179:         uint256 _l2BatchNumber, // <= FOUND ' _l2BatchNumber'
180:         uint256 _l2MessageIndex, // <= FOUND ' uint256'
181:         uint16 _l2TxNumberInBatch,
182:         bytes32[] calldata _merkleProof, // <= FOUND ' calldata'
183:         TxStatus _status
184:     ) external view override returns (bool) 

```
['[198](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L198-L202)']
```solidity
198:     function l2TransactionBaseCost(
199:         uint256 _chainId, // <= FOUND ' _chainId'
200:         uint256 _gasPrice, // <= FOUND ' _gasPrice'
201:         uint256 _l2GasLimit, // <= FOUND ' uint256'
202:         uint256 _l2GasPerPubdataByteLimit // <= FOUND ' uint256'
203:     ) external view returns (uint256) 

```
['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L105-L105)']
```solidity
105:     function getOperationState(bytes32 _id) public view returns (OperationState)  // <= FOUND '    function getOperationState(bytes32 _id) public view returns (OperationState) '

```
['[129](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L129-L129)']
```solidity
129:     function scheduleTransparent(Operation calldata _operation, uint256 _delay) external onlyOwner  // <= FOUND '    function scheduleTransparent(Operation calldata _operation, uint256 _delay) external onlyOwner '

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L142-L142)']
```solidity
142:     function scheduleShadow(bytes32 _id, uint256 _delay) external onlyOwner  // <= FOUND ' _id'

```
['[249](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L249-L249)']
```solidity
249:     function updateDelay(uint256 _newDelay) external onlySelf  // <= FOUND '    function updateDelay(uint256 _newDelay) external onlySelf '

```
['[256](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L256-L256)']
```solidity
256:     function updateSecurityCouncil(address _newSecurityCouncil) external onlySelf  // <= FOUND '    function updateSecurityCouncil(address _newSecurityCouncil) external onlySelf '

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L74-L74)']
```solidity
74:     function getChainAdmin(uint256 _chainId) external view override returns (address)  // <= FOUND ' _chainId'

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L79-L80)']
```solidity
79:     function initialize(
80:         StateTransitionManagerInitializeData calldata _initializeData // <= FOUND ' _initializeData'
81:     ) external reentrancyGuardInitializer 

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L132-L132)']
```solidity
132:     function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin  // <= FOUND '    function setValidatorTimelock(address _validatorTimelock) external onlyOwnerOrAdmin '

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L142-L145)']
```solidity
142:     function setNewVersionUpgrade(
143:         Diamond.DiamondCutData calldata _cutData, // <= FOUND ' calldata'
144:         uint256 _oldProtocolVersion, // <= FOUND ' _oldProtocolVersion'
145:         uint256 _newProtocolVersion // <= FOUND ' uint256'
146:     ) external onlyOwner 

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L152-L154)']
```solidity
152:     function setUpgradeDiamondCut(
153:         Diamond.DiamondCutData calldata _cutData, // <= FOUND ' calldata'
154:         uint256 _oldProtocolVersion // <= FOUND ' _oldProtocolVersion'
155:     ) external onlyOwner 

```
['[160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L160-L160)']
```solidity
160:     function freezeChain(uint256 _chainId) external onlyOwner  // <= FOUND ' _chainId'

```
['[165](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L165-L165)']
```solidity
165:     function unfreezeChain(uint256 _chainId) external onlyOwner  // <= FOUND ' _chainId'

```
['[170](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L170-L170)']
```solidity
170:     function revertBatches(uint256 _chainId, uint256 _newLastBatch) external onlyOwnerOrAdmin  // <= FOUND ' _chainId'

```
['[230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L230-L231)']
```solidity
230:     function registerAlreadyDeployedStateTransition(
231:         uint256 _chainId, // <= FOUND ' _chainId'
232:         address _stateTransitionContract
233:     ) external onlyOwner 

```
['[73](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L73-L73)']
```solidity
73:     function setStateTransitionManager(IStateTransitionManager _stateTransitionManager) external onlyOwner  // <= FOUND ' _stateTransitionManager'

```
['[78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L78-L78)']
```solidity
78:     function addValidator(uint256 _chainId, address _newValidator) external onlyChainAdmin(_chainId)  // <= FOUND ' _chainId'

```
['[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L87-L87)']
```solidity
87:     function removeValidator(uint256 _chainId, address _validator) external onlyChainAdmin(_chainId)  // <= FOUND ' _chainId'

```
['[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L102-L102)']
```solidity
102:     function getCommittedBatchTimestamp(uint256 _chainId, uint256 _l2BatchNumber) external view returns (uint256)  // <= FOUND ' _l2BatchNumber'

```
['[108](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L108-L110)']
```solidity
108:     function commitBatches(
109:         StoredBatchInfo calldata, // <= FOUND ' calldata'
110:         CommitBatchInfo[] calldata _newBatchesData // <= FOUND ' calldata'
111:     ) external onlyValidator(ERA_CHAIN_ID) 

```
['[126](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L126-L129)']
```solidity
126:     function commitBatchesSharedBridge(
127:         uint256 _chainId, // <= FOUND ' _chainId'
128:         StoredBatchInfo calldata, // <= FOUND ' calldata'
129:         CommitBatchInfo[] calldata _newBatchesData // <= FOUND ' calldata'
130:     ) external onlyValidator(_chainId) 

```
['[153](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L153-L153)']
```solidity
153:     function revertBatchesSharedBridge(uint256 _chainId, uint256) external onlyValidator(_chainId)  // <= FOUND ' _chainId'

```
['[160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L160-L163)']
```solidity
160:     function proveBatches(
161:         StoredBatchInfo calldata, // <= FOUND ' calldata'
162:         StoredBatchInfo[] calldata, // <= FOUND ' calldata'
163:         ProofInput calldata // <= FOUND ' calldata'
164:     ) external onlyValidator(ERA_CHAIN_ID) 

```
['[171](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L171-L175)']
```solidity
171:     function proveBatchesSharedBridge(
172:         uint256 _chainId, // <= FOUND ' _chainId'
173:         StoredBatchInfo calldata, // <= FOUND ' calldata'
174:         StoredBatchInfo[] calldata, // <= FOUND ' calldata'
175:         ProofInput calldata // <= FOUND ' calldata'
176:     ) external onlyValidator(_chainId) 

```
['[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/DiamondInit.sol#L24-L24)']
```solidity
24:     function initialize(InitializeData calldata _initializeData) external reentrancyGuardInitializer returns (bytes32)  // <= FOUND ' _initializeData'

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L23-L23)']
```solidity
23:     function setPendingAdmin(address _newPendingAdmin) external onlyAdmin  // <= FOUND ' _newPendingAdmin'

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L45-L45)']
```solidity
45:     function setValidator(address _validator, bool _active) external onlyStateTransitionManager  // <= FOUND ' _validator'

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Admin.sol#L79-L79)']
```solidity
79:     function setTokenMultiplier(uint128 _nominator, uint128 _denominator) external onlyAdminOrStateTransitionManager  // <= FOUND '    function setTokenMultiplier(uint128 _nominator, uint128 _denominator) external onlyAdminOrStateTransitionManager '

```
['[199](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L199-L201)']
```solidity
199:     function commitBatches(
200:         StoredBatchInfo memory _lastCommittedBatchData, // <= FOUND ' _lastCommittedBatchData'
201:         CommitBatchInfo[] calldata _newBatchesData // <= FOUND ' calldata'
202:     ) external nonReentrant onlyValidator 

```
['[207](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L207-L210)']
```solidity
207:     function commitBatchesSharedBridge(
208:         uint256,  // <= FOUND ' uint256'
209:         StoredBatchInfo memory _lastCommittedBatchData, // <= FOUND ' _lastCommittedBatchData'
210:         CommitBatchInfo[] calldata _newBatchesData // <= FOUND ' calldata'
211:     ) external nonReentrant onlyValidator 

```
['[368](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L368-L371)']
```solidity
368:     function proveBatches(
369:         StoredBatchInfo calldata _prevBatch, // <= FOUND ' calldata'
370:         StoredBatchInfo[] calldata _committedBatches, // <= FOUND ' calldata'
371:         ProofInput calldata _proof // <= FOUND ' calldata'
372:     ) external nonReentrant onlyValidator 

```
['[377](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L377-L381)']
```solidity
377:     function proveBatchesSharedBridge(
378:         uint256,  // <= FOUND ' uint256'
379:         StoredBatchInfo calldata _prevBatch, // <= FOUND ' calldata'
380:         StoredBatchInfo[] calldata _committedBatches, // <= FOUND ' calldata'
381:         ProofInput calldata _proof // <= FOUND ' calldata'
382:     ) external nonReentrant onlyValidator 

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L112-L112)']
```solidity
112:     function isValidator(address _address) external view returns (bool)  // <= FOUND '    function isValidator(address _address) external view returns (bool) '

```
['[117](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L117-L117)']
```solidity
117:     function l2LogsRootHash(uint256 _batchNumber) external view returns (bytes32)  // <= FOUND ' _batchNumber'

```
['[122](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L122-L122)']
```solidity
122:     function storedBatchHash(uint256 _batchNumber) external view returns (bytes32)  // <= FOUND ' _batchNumber'

```
['[163](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L163-L163)']
```solidity
163:     function isFacetFreezable(address _facet) external view returns (bool isFreezable)  // <= FOUND '    function isFacetFreezable(address _facet) external view returns (bool isFreezable) '

```
['[181](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L181-L181)']
```solidity
181:     function isFunctionFreezable(bytes4 _selector) external view returns (bool)  // <= FOUND '    function isFunctionFreezable(bytes4 _selector) external view returns (bool) '

```
['[188](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L188-L188)']
```solidity
188:     function isEthWithdrawalFinalized(uint256 _l2BatchNumber, uint256 _l2MessageIndex) external view returns (bool)  // <= FOUND ' _l2BatchNumber'

```
['[217](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L217-L217)']
```solidity
217:     function facetFunctionSelectors(address _facet) external view returns (bytes4[] memory)  // <= FOUND ' _facet'

```
['[229](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L229-L229)']
```solidity
229:     function facetAddress(bytes4 _selector) external view returns (address)  // <= FOUND ' _selector'

```
['[254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L254-L254)']
```solidity
254:     function storedBlockHash(uint256 _batchNumber) external view returns (bytes32)  // <= FOUND ' _batchNumber'

```
['[54](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L54-L58)']
```solidity
54:     function proveL2MessageInclusion(
55:         uint256 _batchNumber, // <= FOUND ' _batchNumber'
56:         uint256 _index, // <= FOUND ' uint256'
57:         L2Message memory _message,
58:         bytes32[] calldata _proof // <= FOUND ' calldata'
59:     ) public view returns (bool) 

```
['[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L64-L68)']
```solidity
64:     function proveL2LogInclusion(
65:         uint256 _batchNumber, // <= FOUND ' _batchNumber'
66:         uint256 _index, // <= FOUND ' uint256'
67:         L2Log memory _log,
68:         bytes32[] calldata _proof // <= FOUND ' calldata'
69:     ) external view returns (bool) 

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L74-L79)']
```solidity
74:     function proveL1ToL2TransactionStatus(
75:         bytes32 _l2TxHash, // <= FOUND ' _l2TxHash'
76:         uint256 _l2BatchNumber, // <= FOUND ' _l2BatchNumber'
77:         uint256 _l2MessageIndex, // <= FOUND ' uint256'
78:         uint16 _l2TxNumberInBatch,
79:         bytes32[] calldata _merkleProof, // <= FOUND ' calldata'
80:         TxStatus _status
81:     ) public view returns (bool) 

```
['[143](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L143-L146)']
```solidity
143:     function l2TransactionBaseCost(
144:         uint256 _gasPrice, // <= FOUND ' _gasPrice'
145:         uint256 _l2GasLimit, // <= FOUND ' uint256'
146:         uint256 _l2GasPerPubdataByteLimit // <= FOUND ' uint256'
147:     ) public view returns (uint256) 

```
['[178](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L178-L183)']
```solidity
178:     function finalizeEthWithdrawal(
179:         uint256 _l2BatchNumber, // <= FOUND ' _l2BatchNumber'
180:         uint256 _l2MessageIndex, // <= FOUND ' uint256'
181:         uint16 _l2TxNumberInBatch,
182:         bytes calldata _message, // <= FOUND ' calldata'
183:         bytes32[] calldata _merkleProof // <= FOUND ' calldata'
184:     ) external nonReentrant 

```
['[197](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L197-L203)']
```solidity
197:     function requestL2Transaction(
198:         address _contractL2, // <= FOUND ' _contractL2'
199:         uint256 _l2Value, // <= FOUND ' uint256'
200:         bytes calldata _calldata, // <= FOUND ' calldata'
201:         uint256 _l2GasLimit, // <= FOUND ' uint256'
202:         uint256 _l2GasPerPubdataByteLimit, // <= FOUND ' uint256'
203:         bytes[] calldata _factoryDeps, // <= FOUND ' calldata'
204:         address _refundRecipient
205:     ) external payable returns (bytes32 canonicalTxHash) 

```
['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L35-L35)']
```solidity
35:     function storeAccountConstructingCodeHash(address _address, bytes32 _hash) external override onlyDeployer  // <= FOUND ' _address'

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L46-L46)']
```solidity
46:     function storeAccountConstructedCodeHash(address _address, bytes32 _hash) external override onlyDeployer  // <= FOUND ' _address'

```
['[21](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ComplexUpgrader.sol#L21-L21)']
```solidity
21:     function upgrade(address _delegateTo, bytes calldata _calldata) external payable  // <= FOUND ' calldata'

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L34-L34)']
```solidity
34:     function getAccountInfo(address _address) external view returns (AccountInfo memory info)  // <= FOUND ' _address'

```
['[65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L65-L65)']
```solidity
65:     function updateAccountVersion(AccountAbstractionVersion _version) external onlySystemCall  // <= FOUND '    function updateAccountVersion(AccountAbstractionVersion _version) external onlySystemCall '

```
['[95](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L95-L99)']
```solidity
95:     function getNewAddressCreate2(
96:         address _sender,
97:         bytes32 _bytecodeHash, // <= FOUND ' _bytecodeHash'
98:         bytes32 _salt, // <= FOUND ' _salt'
99:         bytes calldata _input // <= FOUND ' calldata'
100:     ) public view override returns (address newAddress) 

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L132-L135)']
```solidity
132:     function create2(
133:         bytes32 _salt, // <= FOUND ' _salt'
134:         bytes32 _bytecodeHash, // <= FOUND ' _bytecodeHash'
135:         bytes calldata _input // <= FOUND ' calldata'
136:     ) external payable override returns (address) 

```
['[147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L147-L150)']
```solidity
147:     function create(
148:         bytes32 _salt, // <= FOUND ' _salt'
149:         bytes32 _bytecodeHash, // <= FOUND ' _bytecodeHash'
150:         bytes calldata _input // <= FOUND ' calldata'
151:     ) external payable override returns (address) 

```
['[162](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L162-L165)']
```solidity
162:     function create2Account(
163:         bytes32 _salt, // <= FOUND ' _salt'
164:         bytes32 _bytecodeHash, // <= FOUND ' _bytecodeHash'
165:         bytes calldata _input, // <= FOUND ' calldata'
166:         AccountAbstractionVersion _aaVersion
167:     ) public payable override onlySystemCall returns (address) 

```
['[182](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L182-L185)']
```solidity
182:     function createAccount(
183:         bytes32, 
184:         bytes32 _bytecodeHash, // <= FOUND ' _bytecodeHash'
185:         bytes calldata _input, // <= FOUND ' calldata'
186:         AccountAbstractionVersion _aaVersion
187:     ) public payable override onlySystemCall returns (address) 

```
['[213](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L213-L213)']
```solidity
213:     function forceDeployOnAddress(ForceDeployment calldata _deployment, address _sender) external payable onlySelf  // <= FOUND ' calldata'

```
['[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L67-L70)']
```solidity
67:     function validateTransaction(
68:         bytes32, 
69:         bytes32 _suggestedSignedHash, // <= FOUND ' _suggestedSignedHash'
70:         Transaction calldata _transaction // <= FOUND ' calldata'
71:     ) external payable override ignoreNonBootloader ignoreInDelegateCall returns (bytes4 magic) 

```
['[125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L125-L125)']
```solidity
125:     function executeTransactionFromOutside(Transaction calldata _transaction) external payable override  // <= FOUND ' calldata'

```
['[196](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L196-L199)']
```solidity
196:     function payForTransaction(
197:         bytes32, 
198:         bytes32, 
199:         Transaction calldata _transaction // <= FOUND ' calldata'
200:     ) external payable ignoreNonBootloader ignoreInDelegateCall 

```
['[212](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L212-L215)']
```solidity
212:     function prepareForPaymaster(
213:         bytes32, 
214:         bytes32, 
215:         Transaction calldata _transaction // <= FOUND ' calldata'
216:     ) external payable ignoreNonBootloader ignoreInDelegateCall 

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ImmutableSimulator.sol#L27-L27)']
```solidity
27:     function getImmutable(address _dest, uint256 _index) external view override returns (bytes32)  // <= FOUND ' uint256'

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L27-L27)']
```solidity
27:     function markFactoryDeps(bool _shouldSendToL1, bytes32[] calldata _hashes) external onlyCallFromBootloader  // <= FOUND ' calldata'

```
['[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L39-L39)']
```solidity
39:     function markBytecodeAsPublished(bytes32 _bytecodeHash) external onlyCompressor  // <= FOUND ' _bytecodeHash'

```
['[70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L70-L72)']
```solidity
70:     function sendL2ToL1Log(
71:         bool _isService, // <= FOUND ' _isService'
72:         bytes32 _key, // <= FOUND ' _key'
73:         bytes32 _value
74:     ) external onlyCallFromSystemContract returns (uint256 logIdInMerkleTree) 

```
['[32](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L32-L32)']
```solidity
32:     function transferFromTo(address _from, address _to, uint256 _amount) external override  // <= FOUND ' uint256'

```
['[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L64-L64)']
```solidity
64:     function mint(address _account, uint256 _amount) external override onlyCallFromBootloader  // <= FOUND ' uint256'

```
['[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L72-L72)']
```solidity
72:     function withdraw(address _l1Receiver) external payable override  // <= FOUND '    function withdraw(address _l1Receiver) external payable override '

```
['[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L85-L85)']
```solidity
85:     function withdrawWithMessage(address _l1Receiver, bytes memory _additionalData) external payable override  // <= FOUND ' _l1Receiver'

```
['[102](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L102-L102)']
```solidity
102:     function getValueUnderNonce(uint256 _key) public view returns (uint256)  // <= FOUND '    function getValueUnderNonce(uint256 _key) public view returns (uint256) '

```
['[166](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L166-L166)']
```solidity
166:     function validateNonceUsage(address _address, uint256 _key, bool _shouldBeUsed) external view  // <= FOUND ' uint256'

```
['[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L84-L84)']
```solidity
84:     function setChainId(uint256 _newChainId) external onlyCallFromForceDeployer  // <= FOUND '    function setChainId(uint256 _newChainId) external onlyCallFromForceDeployer '

```
['[99](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L99-L99)']
```solidity
99:     function setTxOrigin(address _newOrigin) external onlyCallFromBootloader  // <= FOUND '    function setTxOrigin(address _newOrigin) external onlyCallFromBootloader '

```
['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L105-L105)']
```solidity
105:     function setGasPrice(uint256 _gasPrice) external onlyCallFromBootloader  // <= FOUND ' _gasPrice'

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L112-L112)']
```solidity
112:     function setPubdataInfo(uint256 _gasPerPubdataByte, uint256 _basePubdataSpent) external onlyCallFromBootloader  // <= FOUND ' uint256'

```
['[166](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L166-L166)']
```solidity
166:     function getBatchHash(uint256 _batchNumber) external view returns (bytes32 hash)  // <= FOUND ' _batchNumber'

```
['[402](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L402-L402)']
```solidity
402:     function appendTransactionToCurrentL2Block(bytes32 _txHash) external onlyCallFromBootloader  // <= FOUND '    function appendTransactionToCurrentL2Block(bytes32 _txHash) external onlyCallFromBootloader '

```
['[444](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L444-L448)']
```solidity
444:     function setNewBatch(
445:         bytes32 _prevBatchHash, // <= FOUND ' _prevBatch'
446:         uint128 _newTimestamp,
447:         uint128 _expectedNewNumber,
448:         uint256 _baseFee // <= FOUND ' uint256'
449:     ) external onlyCallFromBootloader 

```
['[471](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L471-L474)']
```solidity
471:     function unsafeOverrideBatch(
472:         uint256 _newTimestamp, // <= FOUND ' uint256'
473:         uint256 _number, // <= FOUND ' uint256'
474:         uint256 _baseFee // <= FOUND ' uint256'
475:     ) external onlyCallFromBootloader 

```
['[509](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L509-L509)']
```solidity
509:     function blockHash(uint256 _blockNumber) external view returns (bytes32 hash)  // <= FOUND '    function blockHash(uint256 _blockNumber) external view returns (bytes32 hash) '

```
['[35](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/GasBoundCaller.sol#L35-L35)']
```solidity
35:     function gasBoundCall(address _to, uint256 _maxTotalGas, bytes calldata _data) external payable  // <= FOUND ' calldata'

```
['[79](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L79-L84)']
```solidity
79:     function finalizeDeposit(
80:         address _l1Sender, // <= FOUND ' _l1Sender'
81:         address _l2Receiver, // <= FOUND ' _l2Receiver'
82:         address _l1Token,
83:         uint256 _amount, // <= FOUND ' uint256'
84:         bytes calldata _data // <= FOUND ' calldata'
85:     ) external payable override 

```
['[123](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L123-L123)']
```solidity
123:     function withdraw(address _l1Receiver, address _l2Token, uint256 _amount) external override  // <= FOUND ' uint256'

```
['[50](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L50-L50)']
```solidity
50:     function bridgeInitialize(address _l1Address, bytes memory _data) external initializer  // <= FOUND '    function bridgeInitialize(address _l1Address, bytes memory _data) external initializer '

```
['[111](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L111-L115)']
```solidity
111:     function reinitializeToken(
112:         ERC20Getters calldata _availableGetters, // <= FOUND ' calldata'
113:         string memory _newName,
114:         string memory _newSymbol,
115:         uint8 _version // <= FOUND ' _version'
116:     ) external onlyNextVersion(_version) reinitializer(_version) 

```
['[145](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L145-L145)']
```solidity
145:     function bridgeMint(address _to, uint256 _amount) external override onlyBridge  // <= FOUND ' uint256'

```
['[154](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L154-L154)']
```solidity
154:     function bridgeBurn(address _from, uint256 _amount) external override onlyBridge  // <= FOUND ' uint256'

```
['[178](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L178-L178)']
```solidity
178:     function decodeString(bytes memory _input) external pure returns (string memory result)  // <= FOUND '    function decodeString(bytes memory _input) external pure returns (string memory result) '

```
['[183](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L183-L183)']
```solidity
183:     function decodeUint8(bytes memory _input) external pure returns (uint8 result)  // <= FOUND ' _input'

```


</details>

## [NonCritical-112] Modifier checks msg.sender against two addresses. Consider using multiple modifiers for more control

### Resolution 
In Solidity, using a single modifier to check msg.sender against two different addresses can make the code less flexible and harder to maintain. Instead, consider using multiple modifiers for greater control and clarity. Separating these checks into individual modifiers improves readability and reusability, as each modifier can then be applied independently to different functions according to specific access requirements. This approach enhances the modularity of the contract and makes it easier to update or extend access control logic in the future, aligning with best practices for smart contract development and security.

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L74-L76)']
```solidity
74:     modifier onlyBridgehubOrEra(uint256 _chainId) {
75:         require(
76:             msg.sender == address(bridgehub) || (_chainId == ERA_CHAIN_ID && msg.sender == ERA_DIAMOND_PROXY), // <= FOUND
77:             "L1SharedBridge: not bridgehub or era chain"
78:         );
79:         _;
80:     }

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L45-L46)']
```solidity
45:     modifier onlyOwnerOrAdmin() {
46:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin"); // <= FOUND
47:         _;
48:     }

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L45-L46)']
```solidity
45:     modifier onlyOwnerOrAdmin() {
46:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin"); // <= FOUND
47:         _;
48:     }

```
['[70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L70-L72)']
```solidity
70:     modifier onlyOwnerOrSecurityCouncil() {
71:         require(
72:             msg.sender == owner() || msg.sender == securityCouncil, // <= FOUND
73:             "Only the owner and security council are allowed to call this function"
74:         );
75:         _;
76:     }

```
['[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L36-L38)']
```solidity
36:     modifier onlyAdminOrStateTransitionManager() {
37:         require(
38:             msg.sender == s.admin || msg.sender == s.stateTransitionManager, // <= FOUND
39:             "StateTransition Chain: Only by admin or state transition manager"
40:         );
41:         _;
42:     }

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L44-L46)']
```solidity
44:     modifier onlyValidatorOrStateTransitionManager() {
45:         require(
46:             s.validators[msg.sender] || msg.sender == s.stateTransitionManager, // <= FOUND
47:             "StateTransition Chain: Only by validator or state transition manager"
48:         );
49:         _;
50:     }

```


</details>

## [NonCritical-113] Consider providing a ranged getter for array state variables

### Resolution 
Implementing a ranged getter for array state variables enhances data accessibility in smart contracts. The Solidity compiler auto-generates getters for individual elements of public arrays but lacks direct support for retrieving entire arrays or specific ranges. Adding a custom function to fetch array slices can significantly improve efficiency and flexibility, reducing the need for multiple calls to access several elements. This is particularly useful for contracts without multicall capabilities, streamlining data retrieval and minimizing gas costs associated with separate calls for each element.

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L70-L70)']
```solidity
70: bytes32[MINIBLOCK_HASHES_TO_STORE] internal l2BlockHash; // <= FOUND

```


</details>

## [NonCritical-114] Consider using named returns

### Resolution 
Using named returns in Solidity functions enhances code readability and clarity. By explicitly naming return variables in the function signature, developers can document what each return value represents, making the code easier to understand and maintain. This practice can also slightly optimize gas usage by avoiding extra variable declarations.

Num of instances: 136

### Findings 


<details><summary>Click to show findings</summary>

['[187](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L187-L187)']
```solidity
182:     function bridgehubDeposit(
183:         uint256 _chainId,
184:         address _prevMsgSender,
185:         uint256, 
186:         bytes calldata _data
187:     ) external payable override onlyBridgehub returns (L2TransactionRequestTwoBridgesInner memory request)  // <= FOUND

```
['[254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L254-L254)']
```solidity
254:     function _getERC20Getters(address _token) internal view returns (bytes memory)  // <= FOUND

```
['[463](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L463-L463)']
```solidity
458:     function _checkWithdrawal(
459:         uint256 _chainId,
460:         MessageParams memory _messageParams,
461:         bytes calldata _message,
462:         bytes32[] calldata _merkleProof
463:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount)  // <= FOUND

```
['[562](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L562-L562)']
```solidity
554:     function depositLegacyErc20Bridge(
555:         address _prevMsgSender,
556:         address _l2Receiver,
557:         address _l1Token,
558:         uint256 _amount,
559:         uint256 _l2TxGasLimit,
560:         uint256 _l2TxGasPerPubdataByte,
561:         address _refundRecipient
562:     ) external payable override onlyLegacyBridge nonReentrant returns (bytes32 l2TxHash)  // <= FOUND

```
['[121](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L121-L121)']
```solidity
114:     function createNewChain(
115:         uint256 _chainId,
116:         address _stateTransitionManager,
117:         address _baseToken,
118:         uint256, 
119:         address _admin,
120:         bytes calldata _initData
121:     ) external onlyOwnerOrAdmin nonReentrant returns (uint256 chainId)  // <= FOUND

```
['[264](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L264-L264)']
```solidity
262:     function requestL2TransactionTwoBridges(
263:         L2TransactionRequestTwoBridgesOuter calldata _request
264:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash)  // <= FOUND

```
['[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L36-L36)']
```solidity
32:     function _commitOneBatch(
33:         StoredBatchInfo memory _previousBatch,
34:         CommitBatchInfo calldata _newBatch,
35:         bytes32 _expectedSystemContractUpgradeTxHash
36:     ) internal view returns (StoredBatchInfo memory)  // <= FOUND

```
['[308](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L308-L308)']
```solidity
308:     function _collectOperationsFromPriorityQueue(uint256 _nPriorityOps) internal returns (bytes32 concatHash)  // <= FOUND

```
['[525](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L525-L525)']
```solidity
525:     function _batchMetaParameters() internal view returns (bytes memory)  // <= FOUND

```
['[564](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L564-L564)']
```solidity
561:     function _encodeBlobAuxilaryOutput(
562:         bytes32[] memory _blobCommitments,
563:         bytes32[] memory _blobHashes
564:     ) internal pure returns (bytes32[] memory blobAuxOutputWords)  // <= FOUND

```
['[679](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L679-L679)']
```solidity
679:     function _getBlobVersionedHash(uint256 _index) internal view returns (bytes32 versionedHash)  // <= FOUND

```
['[137](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L137-L137)']
```solidity
137:     function getVerifierParams() external view returns (VerifierParams memory)  // <= FOUND

```
['[202](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L202-L202)']
```solidity
202:     function facets() external view returns (Facet[] memory result)  // <= FOUND

```
['[223](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L223-L223)']
```solidity
223:     function facetAddresses() external view returns (address[] memory)  // <= FOUND

```
['[130](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L130-L130)']
```solidity
130:     function _L2MessageToLog(L2Message memory _message) internal pure returns (L2Log memory)  // <= FOUND

```
['[230](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L230-L230)']
```solidity
228:     function _requestL2TransactionSender(
229:         BridgehubL2TransactionRequest memory _request
230:     ) internal nonReentrant returns (bytes32 canonicalTxHash)  // <= FOUND

```
['[293](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L293-L293)']
```solidity
289:     function _serializeL2Transaction(
290:         WritePriorityOpParams memory _priorityOpParams,
291:         bytes memory _calldata,
292:         bytes[] memory _factoryDeps
293:     ) internal pure returns (L2CanonicalTransaction memory transaction)  // <= FOUND

```
['[353](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L353-L353)']
```solidity
353:     function _hashFactoryDeps(bytes[] memory _factoryDeps) internal pure returns (uint256[] memory hashedFactoryDeps)  // <= FOUND

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L19-L19)']
```solidity
19:     function readUint32(bytes memory _bytes, uint256 _start) internal pure returns (uint32 result, uint256 offset)  // <= FOUND

```
['[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L33-L33)']
```solidity
33:     function readUint256(bytes memory _bytes, uint256 _start) internal pure returns (uint256 result, uint256 offset)  // <= FOUND

```
['[87](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L87-L87)']
```solidity
87:     function getDiamondStorage() internal pure returns (DiamondStorage storage diamondStorage)  // <= FOUND

```
['[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Merkle.sol#L40-L40)']
```solidity
40:     function _efficientHash(bytes32 _lhs, bytes32 _rhs) private pure returns (bytes32 result)  // <= FOUND

```
['[72](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L72-L72)']
```solidity
72:     function popFront(Queue storage _queue) internal returns (PriorityOperation memory priorityOperation)  // <= FOUND

```
['[130](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L130-L130)']
```solidity
128:     function getOverheadForTransaction(
129:         uint256 _encodingLength
130:     ) internal pure returns (uint256 batchOverheadForTransaction)  // <= FOUND

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L37-L37)']
```solidity
37:     function undoL1ToL2Alias(address l2Address) internal pure returns (address l1Address)  // <= FOUND

```
['[117](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L117-L117)']
```solidity
117:     function getCodeSize(uint256 _input) external view override returns (uint256 codeSize)  // <= FOUND

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L44-L44)']
```solidity
44:     function encodeLegacyTransactionHash(Transaction calldata _transaction) internal view returns (bytes32 txHash)  // <= FOUND

```
['[115](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L115-L115)']
```solidity
110:     function verifyCompressedStateDiffs(
111:         uint256 _numberOfStateDiffs,
112:         uint256 _enumerationIndexSize,
113:         bytes calldata _stateDiffs,
114:         bytes calldata _compressedStateDiffs
115:     ) external payable onlyCallFrom(address(L1_MESSENGER_CONTRACT)) returns (bytes32 stateDiffHash)  // <= FOUND

```
['[251](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L251-L251)']
```solidity
251:     function _sliceToUint256(bytes calldata _calldataSlice) internal pure returns (uint256 number)  // <= FOUND

```
['[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L100-L100)']
```solidity
95:     function getNewAddressCreate2(
96:         address _sender,
97:         bytes32 _bytecodeHash,
98:         bytes32 _salt,
99:         bytes calldata _input
100:     ) public view override returns (address newAddress)  // <= FOUND

```
['[71](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L71-L71)']
```solidity
67:     function validateTransaction(
68:         bytes32, 
69:         bytes32 _suggestedSignedHash,
70:         Transaction calldata _transaction
71:     ) external payable override ignoreNonBootloader ignoreInDelegateCall returns (bytes4 magic)  // <= FOUND

```
['[65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/KnownCodesStorage.sol#L65-L65)']
```solidity
65:     function getMarker(bytes32 _hash) public view override returns (uint256 marker)  // <= FOUND

```
['[94](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L94-L94)']
```solidity
94:     function _processL2ToL1Log(L2ToL1Log memory _l2ToL1Log) internal returns (uint256 logIdInMerkleTree)  // <= FOUND

```
['[99](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L99-L99)']
```solidity
99:     function _burnMsgValue() internal returns (uint256 amount)  // <= FOUND

```
['[122](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L122-L122)']
```solidity
117:     function _getExtendedWithdrawMessage(
118:         address _to,
119:         uint256 _amount,
120:         address _sender,
121:         bytes memory _additionalData
122:     ) internal pure returns (bytes memory)  // <= FOUND

```
['[134](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L134-L134)']
```solidity
134:     function symbol() external pure override returns (string memory)  // <= FOUND

```
['[65](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L65-L65)']
```solidity
65:     function increaseMinNonce(uint256 _value) public onlySystemCall returns (uint256 oldMinNonce)  // <= FOUND

```
['[135](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L135-L135)']
```solidity
135:     function incrementDeploymentNonce(address _address) external returns (uint256 prevDeploymentNonce)  // <= FOUND

```
['[132](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L132-L132)']
```solidity
132:     function getBlockHashEVM(uint256 _block) external view returns (bytes32 hash)  // <= FOUND

```
['[172](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L172-L172)']
```solidity
172:     function getBatchNumberAndTimestamp() public view returns (uint128 batchNumber, uint128 batchTimestamp)  // <= FOUND

```
['[496](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L496-L496)']
```solidity
496:     function currentBlockInfo() external view returns (uint256 blockInfo)  // <= FOUND

```
['[509](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L509-L509)']
```solidity
509:     function blockHash(uint256 _blockNumber) external view returns (bytes32 hash)  // <= FOUND

```
['[78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L78-L78)']
```solidity
74:     function staticCall(
75:         uint256 _gas,
76:         address _address,
77:         bytes calldata _data
78:     ) internal view returns (bytes memory returnData)  // <= FOUND

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L112-L112)']
```solidity
105:     function mimicCall(
106:         uint256 _gas,
107:         address _address,
108:         bytes calldata _data,
109:         address _whoToMimic,
110:         bool _isConstructor,
111:         bool _isSystem
112:     ) internal returns (bytes memory returnData)  // <= FOUND

```
['[159](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L159-L159)']
```solidity
159:     function rawStaticCall(uint256 _gas, address _address, bytes calldata _data) internal view returns (bool success)  // <= FOUND

```
['[198](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L198-L198)']
```solidity
191:     function rawMimicCall(
192:         uint256 _gas,
193:         address _address,
194:         bytes calldata _data,
195:         address _whoToMimic,
196:         bool _isConstructor,
197:         bool _isSystem
198:     ) internal returns (bool success)  // <= FOUND

```
['[11](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L11-L11)']
```solidity
11:     function encodeAddress(address _val) internal pure returns (bytes memory encoded)  // <= FOUND

```
['[49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L49-L49)']
```solidity
49:     function encodeNonSingleBytesLen(uint64 _len) internal pure returns (bytes memory)  // <= FOUND

```
['[60](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L60-L60)']
```solidity
60:     function _encodeLength(uint64 _len, uint256 _offset) private pure returns (bytes memory encoded)  // <= FOUND

```
['[63](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L63-L63)']
```solidity
63:     function getCodeAddress() internal view returns (address addr)  // <= FOUND

```
['[152](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L152-L152)']
```solidity
148:     function unsafePrecompileCall(
149:         uint256 _rawParams,
150:         uint32 _gasToBurn,
151:         uint32 _pubdataToSpend
152:     ) internal view returns (bool success)  // <= FOUND

```
['[203](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L203-L203)']
```solidity
203:     function getZkSyncMetaBytes() internal view returns (uint256 meta)  // <= FOUND

```
['[227](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L227-L227)']
```solidity
227:     function getPubdataPublishedFromMeta(uint256 meta) internal pure returns (uint32 pubdataPublished)  // <= FOUND

```
['[246](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L246-L246)']
```solidity
246:     function getAuxHeapSizeFromMeta(uint256 meta) internal pure returns (uint32 auxHeapSize)  // <= FOUND

```
['[263](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L263-L263)']
```solidity
263:     function getCallerShardIdFromMeta(uint256 meta) internal pure returns (uint8 callerShardId)  // <= FOUND

```
['[279](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L279-L279)']
```solidity
279:     function getZkSyncMeta() internal view returns (ZkSyncMeta memory meta)  // <= FOUND

```
['[307](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L307-L307)']
```solidity
307:     function getCalldataPtr() internal view returns (uint256 ptr)  // <= FOUND

```
['[37](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L37-L37)']
```solidity
37:     function systemCall(uint32 gasLimit, address to, uint256 value, bytes memory data) internal returns (bool success)  // <= FOUND

```
['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L105-L105)']
```solidity
95:     function getFarCallABI(
96:         uint32 dataOffset,
97:         uint32 memoryPage,
98:         uint32 dataStart,
99:         uint32 dataLength,
100:         uint32 gasPassed,
101:         uint8 shardId,
102:         CalldataForwardingMode forwardingMode,
103:         bool isConstructorCall,
104:         bool isSystemCall
105:     ) internal pure returns (uint256 farCallAbi)  // <= FOUND

```
['[100](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L100-L100)']
```solidity
100:     function encodeHash(Transaction calldata _transaction) internal view returns (bytes32 resultHash)  // <= FOUND

```
['[405](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L405-L405)']
```solidity
405:     function totalRequiredBalance(Transaction calldata _transaction) internal pure returns (uint256 requiredBalance)  // <= FOUND

```
['[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L26-L26)']
```solidity
26:     function readUint32(bytes calldata _bytes, uint256 _start) internal pure returns (uint32 result)  // <= FOUND

```
['[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L40-L40)']
```solidity
40:     function readBytes32(bytes calldata _bytes, uint256 _start) internal pure returns (bytes32 result)  // <= FOUND

```
['[39](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L39-L39)']
```solidity
39:     function bytecodeLenInBytes(bytes32 _bytecodeHash) internal pure returns (uint256 codeLength)  // <= FOUND

```
['[82](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L82-L82)']
```solidity
82:     function hashL2Bytecode(bytes calldata _bytecode) internal view returns (bytes32 hashedBytecode)  // <= FOUND

```
['[157](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L157-L157)']
```solidity
157:     function _getCreate2Salt(address _l1Token) internal pure returns (bytes32 salt)  // <= FOUND

```
['[159](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L159-L159)']
```solidity
159:     function name() public view override returns (string memory)  // <= FOUND

```
['[178](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L178-L178)']
```solidity
178:     function decodeString(bytes memory _input) external pure returns (string memory result)  // <= FOUND

```
['[140](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L140-L140)']
```solidity
133:     function deposit(
134:         address _l2Receiver,
135:         address _l1Token,
136:         uint256 _amount,
137:         uint256 _l2TxGasLimit,
138:         uint256 _l2TxGasPerPubdataByte,
139:         address _refundRecipient
140:     ) public payable nonReentrant returns (bytes32 l2TxHash)  // <= FOUND

```
['[248](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L248-L248)']
```solidity
243:     function _getDepositL2Calldata(
244:         address _l1Sender,
245:         address _l2Receiver,
246:         address _l1Token,
247:         uint256 _amount
248:     ) internal view returns (bytes memory)  // <= FOUND

```
['[416](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L416-L416)']
```solidity
409:     function _finalizeWithdrawal(
410:         uint256 _chainId,
411:         uint256 _l2BatchNumber,
412:         uint256 _l2MessageIndex,
413:         uint16 _l2TxNumberInBatch,
414:         bytes calldata _message,
415:         bytes32[] calldata _merkleProof
416:     ) internal nonReentrant returns (address l1Receiver, address l1Token, uint256 amount)  // <= FOUND

```
['[490](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L490-L490)']
```solidity
487:     function _parseL2WithdrawalMessage(
488:         uint256 _chainId,
489:         bytes memory _l2ToL1message
490:     ) internal view returns (address l1Receiver, address l1Token, uint256 amount)  // <= FOUND

```
['[621](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L621-L621)']
```solidity
615:     function finalizeWithdrawalLegacyErc20Bridge(
616:         uint256 _l2BatchNumber,
617:         uint256 _l2MessageIndex,
618:         uint16 _l2TxNumberInBatch,
619:         bytes calldata _message,
620:         bytes32[] calldata _merkleProof
621:     ) external override onlyLegacyBridge returns (address l1Receiver, address l1Token, uint256 amount)  // <= FOUND

```
['[219](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L219-L219)']
```solidity
217:     function requestL2TransactionDirect(
218:         L2TransactionRequestDirect calldata _request
219:     ) external payable override nonReentrant returns (bytes32 canonicalTxHash)  // <= FOUND

```
['[325](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L325-L325)']
```solidity
325:     function _actualRefundRecipient(address _refundRecipient) internal view returns (address _recipient)  // <= FOUND

```
['[133](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L133-L133)']
```solidity
130:     function _processL2Logs(
131:         CommitBatchInfo calldata _newBatch,
132:         bytes32 _expectedSystemContractUpgradeTxHash
133:     ) internal pure returns (LogProcessingOutput memory logOutput)  // <= FOUND

```
['[515](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L515-L515)']
```solidity
515:     function _batchPassThroughData(CommitBatchInfo calldata _batch) internal pure returns (bytes memory)  // <= FOUND

```
['[542](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L542-L542)']
```solidity
537:     function _batchAuxiliaryOutput(
538:         CommitBatchInfo calldata _batch,
539:         bytes32 _stateDiffHash,
540:         bytes32[] memory _blobCommitments,
541:         bytes32[] memory _blobHashes
542:     ) internal pure returns (bytes memory)  // <= FOUND

```
['[628](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L628-L628)']
```solidity
625:     function _verifyBlobInformation(
626:         bytes calldata _pubdataCommitments,
627:         bytes32[] memory _blobHashes
628:     ) internal view returns (bytes32[] memory blobCommitments)  // <= FOUND

```
['[107](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L107-L107)']
```solidity
107:     function priorityQueueFrontOperation() external view returns (PriorityOperation memory)  // <= FOUND

```
['[163](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L163-L163)']
```solidity
163:     function isFacetFreezable(address _facet) external view returns (bool isFreezable)  // <= FOUND

```
['[217](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Getters.sol#L217-L217)']
```solidity
217:     function facetFunctionSelectors(address _facet) external view returns (bytes4[] memory)  // <= FOUND

```
['[49](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L49-L49)']
```solidity
47:     function bridgehubRequestL2Transaction(
48:         BridgehubL2TransactionRequest memory _request
49:     ) external payable onlyBridgehub returns (bytes32 canonicalTxHash)  // <= FOUND

```
['[205](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L205-L205)']
```solidity
197:     function requestL2Transaction(
198:         address _contractL2,
199:         uint256 _l2Value,
200:         bytes calldata _calldata,
201:         uint256 _l2GasLimit,
202:         uint256 _l2GasPerPubdataByteLimit,
203:         bytes[] calldata _factoryDeps,
204:         address _refundRecipient
205:     ) external payable returns (bytes32 canonicalTxHash)  // <= FOUND

```
['[263](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L263-L263)']
```solidity
258:     function _requestL2Transaction(
259:         uint256 _mintValue,
260:         WritePriorityOpParams memory _params,
261:         bytes memory _calldata,
262:         bytes[] memory _factoryDeps
263:     ) internal returns (bytes32 canonicalTxHash)  // <= FOUND

```
['[320](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Mailbox.sol#L320-L320)']
```solidity
316:     function _writePriorityOp(
317:         WritePriorityOpParams memory _priorityOpParams,
318:         bytes memory _calldata,
319:         bytes[] memory _factoryDeps
320:     ) internal returns (bytes32 canonicalTxHash)  // <= FOUND

```
['[67](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/upgrades/BaseZkSyncUpgrade.sol#L67-L67)']
```solidity
67:     function upgrade(ProposedUpgrade calldata _proposedUpgrade) public virtual returns (bytes32 txHash)  // <= FOUND

```
['[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L26-L26)']
```solidity
26:     function readAddress(bytes memory _bytes, uint256 _start) internal pure returns (address result, uint256 offset)  // <= FOUND

```
['[40](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/common/libraries/UnsafeBytes.sol#L40-L40)']
```solidity
40:     function readBytes32(bytes memory _bytes, uint256 _start) internal pure returns (bytes32 result, uint256 offset)  // <= FOUND

```
['[18](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L18-L18)']
```solidity
18:     function get(Uint32Map storage _map, uint256 _index) internal view returns (uint32 result)  // <= FOUND

```
['[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/PriorityQueue.sol#L64-L64)']
```solidity
64:     function front(Queue storage _queue) internal view returns (PriorityOperation memory)  // <= FOUND

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/TransactionValidator.sol#L112-L112)']
```solidity
109:     function getTransactionBodyGasLimit(
110:         uint256 _totalGasLimit,
111:         uint256 _encodingLength
112:     ) internal pure returns (uint256 txBodyGasLimit)  // <= FOUND

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/vendor/AddressAliasHelper.sol#L27-L27)']
```solidity
27:     function applyL1ToL2Alias(address l1Address) internal pure returns (address l2Address)  // <= FOUND

```
['[78](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/AccountCodeStorage.sol#L78-L78)']
```solidity
78:     function getRawCodeHash(address _address) public view override returns (bytes32 codeHash)  // <= FOUND

```
['[26](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/BootloaderUtilities.sol#L26-L26)']
```solidity
24:     function getTransactionHashes(
25:         Transaction calldata _transaction
26:     ) external view override returns (bytes32 txHash, bytes32 signedTxHash)  // <= FOUND

```
['[47](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L47-L47)']
```solidity
44:     function publishCompressedBytecode(
45:         bytes calldata _bytecode,
46:         bytes calldata _rawCompressedData
47:     ) external payable onlyCallFromBootloader returns (bytes32 bytecodeHash)  // <= FOUND

```
['[199](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L199-L199)']
```solidity
197:     function _decodeRawBytecode(
198:         bytes calldata _rawCompressedData
199:     ) internal pure returns (bytes calldata dictionary, bytes calldata encodedData)  // <= FOUND

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L34-L34)']
```solidity
34:     function getAccountInfo(address _address) external view returns (AccountInfo memory info)  // <= FOUND

```
['[118](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/ContractDeployer.sol#L118-L118)']
```solidity
115:     function getNewAddressCreate(
116:         address _sender,
117:         uint256 _senderNonce
118:     ) public pure override returns (address newAddress)  // <= FOUND

```
['[81](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L81-L81)']
```solidity
78:     function _validateTransaction(
79:         bytes32 _suggestedSignedHash,
80:         Transaction calldata _transaction
81:     ) internal returns (bytes4 magic)  // <= FOUND

```
['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L74-L74)']
```solidity
70:     function sendL2ToL1Log(
71:         bool _isService,
72:         bytes32 _key,
73:         bytes32 _value
74:     ) external onlyCallFromSystemContract returns (uint256 logIdInMerkleTree)  // <= FOUND

```
['[116](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L116-L116)']
```solidity
116:     function sendToL1(bytes calldata _message) external override returns (bytes32 hash)  // <= FOUND

```
['[112](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L112-L112)']
```solidity
112:     function _getL1WithdrawMessage(address _to, uint256 _amount) internal pure returns (bytes memory)  // <= FOUND

```
['[128](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L2BaseToken.sol#L128-L128)']
```solidity
128:     function name() external pure override returns (string memory)  // <= FOUND

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L25-L25)']
```solidity
25:     function _getAbiParams() internal view returns (uint256 value, bool isSystemCall, address to)  // <= FOUND

```
['[125](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L125-L125)']
```solidity
125:     function getDeploymentNonce(address _address) external view returns (uint256 deploymentNonce)  // <= FOUND

```
['[179](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/NonceHolder.sol#L179-L179)']
```solidity
179:     function _splitRawNonce(uint256 _rawMinNonce) internal pure returns (uint256 deploymentNonce, uint256 minNonce)  // <= FOUND

```
['[166](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L166-L166)']
```solidity
166:     function getBatchHash(uint256 _batchNumber) external view returns (bytes32 hash)  // <= FOUND

```
['[180](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L180-L180)']
```solidity
180:     function getL2BlockNumberAndTimestamp() public view returns (uint128 blockNumber, uint128 blockTimestamp)  // <= FOUND

```
['[503](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/SystemContext.sol#L503-L503)']
```solidity
503:     function getBlockNumberAndTimestamp() external view returns (uint256 blockNumber, uint256 blockTimestamp)  // <= FOUND

```
['[64](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L64-L64)']
```solidity
58:     function call(
59:         uint256 _gas,
60:         address _address,
61:         uint256 _value,
62:         bytes calldata _data,
63:         bool _isSystem
64:     ) internal returns (bytes memory returnData)  // <= FOUND

```
['[92](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L92-L92)']
```solidity
88:     function delegateCall(
89:         uint256 _gas,
90:         address _address,
91:         bytes calldata _data
92:     ) internal returns (bytes memory returnData)  // <= FOUND

```
['[130](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L130-L130)']
```solidity
124:     function rawCall(
125:         uint256 _gas,
126:         address _address,
127:         uint256 _value,
128:         bytes calldata _data,
129:         bool _isSystem
130:     ) internal returns (bool success)  // <= FOUND

```
['[173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L173-L173)']
```solidity
173:     function rawDelegateCall(uint256 _gas, address _address, bytes calldata _data) internal returns (bool success)  // <= FOUND

```
['[215](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L215-L215)']
```solidity
215:     function _verifyCallResult(bool _success) private pure returns (bytes memory returnData)  // <= FOUND

```
['[24](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L24-L24)']
```solidity
24:     function encodeUint256(uint256 _val) internal pure returns (bytes memory encoded)  // <= FOUND

```
['[56](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L56-L56)']
```solidity
56:     function encodeListLen(uint64 _len) internal pure returns (bytes memory)  // <= FOUND

```
['[84](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/RLPEncoder.sol#L84-L84)']
```solidity
84:     function _highestByteSet(uint256 _number) private pure returns (uint256 hbs)  // <= FOUND

```
['[130](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L130-L130)']
```solidity
124:     function packPrecompileParams(
125:         uint32 _inputMemoryOffset,
126:         uint32 _inputMemoryLength,
127:         uint32 _outputMemoryOffset,
128:         uint32 _outputMemoryLength,
129:         uint64 _perPrecompileInterpreted
130:     ) internal pure returns (uint256 rawParams)  // <= FOUND

```
['[168](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L168-L168)']
```solidity
168:     function setValueForNextFarCall(uint128 _value) internal returns (bool success)  // <= FOUND

```
['[215](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L215-L215)']
```solidity
215:     function extractNumberFromMeta(uint256 meta, uint256 offset, uint256 size) internal pure returns (uint256 result)  // <= FOUND

```
['[237](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L237-L237)']
```solidity
237:     function getHeapSizeFromMeta(uint256 meta) internal pure returns (uint32 heapSize)  // <= FOUND

```
['[254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L254-L254)']
```solidity
254:     function getShardIdFromMeta(uint256 meta) internal pure returns (uint8 shardId)  // <= FOUND

```
['[272](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L272-L272)']
```solidity
272:     function getCodeShardIdFromMeta(uint256 meta) internal pure returns (uint8 codeShardId)  // <= FOUND

```
['[296](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L296-L296)']
```solidity
296:     function getCallFlags() internal view returns (uint256 callFlags)  // <= FOUND

```
['[318](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/SystemContractHelper.sol#L318-L318)']
```solidity
318:     function getExtraAbiData(uint256 index) internal view returns (uint256 extraAbiData)  // <= FOUND

```
['[81](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L81-L81)']
```solidity
76:     function systemCallWithReturndata(
77:         uint32 gasLimit,
78:         address to,
79:         uint128 value,
80:         bytes memory data
81:     ) internal returns (bool success, bytes memory returnData)  // <= FOUND

```
['[127](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L127-L127)']
```solidity
121:     function getFarCallABIWithEmptyFatPointer(
122:         uint32 gasPassed,
123:         uint8 shardId,
124:         CalldataForwardingMode forwardingMode,
125:         bool isConstructorCall,
126:         bool isSystemCall
127:     ) internal pure returns (uint256 farCallAbiWithEmptyFatPtr)  // <= FOUND

```
['[395](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/TransactionHelper.sol#L395-L395)']
```solidity
395:     function payToTheBootloader(Transaction calldata _transaction) internal returns (bool success)  // <= FOUND

```
['[19](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L19-L19)']
```solidity
19:     function readUint16(bytes calldata _bytes, uint256 _start) internal pure returns (uint16 result)  // <= FOUND

```
['[33](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L33-L33)']
```solidity
33:     function readUint64(bytes calldata _bytes, uint256 _start) internal pure returns (uint64 result)  // <= FOUND

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L46-L46)']
```solidity
46:     function readUint256(bytes calldata _bytes, uint256 _start) internal pure returns (uint256 result)  // <= FOUND

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/Utils.sol#L44-L44)']
```solidity
44:     function bytecodeLenInWords(bytes32 _bytecodeHash) internal pure returns (uint256 codeLengthInWords)  // <= FOUND

```
['[142](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L142-L142)']
```solidity
138:     function _getL1WithdrawMessage(
139:         address _to,
140:         address _l1Token,
141:         uint256 _amount
142:     ) internal pure returns (bytes memory)  // <= FOUND

```
['[164](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2SharedBridge.sol#L164-L164)']
```solidity
164:     function _deployBeaconProxy(bytes32 salt) internal returns (BeaconProxy proxy)  // <= FOUND

```
['[165](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/bridge/L2StandardERC20.sol#L165-L165)']
```solidity
165:     function symbol() public view override returns (string memory)  // <= FOUND

```


</details>

## [NonCritical-115] Events should have parameters

### Resolution 
In Solidity, events are crucial for logging and informing external consumers about smart contract activities. Using parameters in events is essential for conveying detailed information about these activities. Parameters enable developers to specify what data is emitted, facilitating efficient and targeted data retrieval by front-end applications or off-chain monitoring tools. Well-defined event parameters improve transparency, enable better data analysis, and enhance the contract's interface with the external world, making interactions with the blockchain more informative and accessible.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[94](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L94-L95)']
```solidity
94:     
95:     event Freeze(); // <= FOUND

```
['[97](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-interfaces/IAdmin.sol#L97-L98)']
```solidity
97:     
98:     event Unfreeze(); // <= FOUND

```


</details>

## [NonCritical-116] Avoid using 'owner' or '_owner' as a parameter name

### Resolution 
Using 'owner' or '_owner' as a parameter name in functions, especially in contracts inheriting from or interacting with OpenZeppelin's `Ownable` contract, can lead to confusion and potential bugs. These contracts often have a state variable named `owner`, managed by the `Ownable` pattern for access control. Using the same name for function parameters may obscure the contract's `owner` state variable, complicating code readability and maintenance. Prefer alternative descriptive names for parameters to maintain clarity and prevent conflicts with established ownership patterns.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[105](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L105-L105)']
```solidity
104:     function initialize(
105:         address _owner, // <= FOUND
106:         uint256 _eraFirstPostUpgradeBatch
107:     ) external reentrancyGuardInitializer initializer 

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L41-L41)']
```solidity
41:     function initialize(address _owner) external reentrancyGuardInitializer  // <= FOUND

```


</details>

## [NonCritical-117] Consider migrating from Ownable to AccessControl

### Resolution 
Migrating from `Ownable` to `AccessControl` in smart contract development represents a shift towards a more flexible and granular permissioning system. `Ownable` is straightforward, designating a single account with the authority to perform administrative actions, making it suitable for simpler use cases. In contrast, `AccessControl` enables the definition of multiple roles, each with its own set of permissions, allowing for complex governance structures within contracts. This approach supports a broader range of use cases, from simple ownership models to intricate permissioning schemes involving multiple stakeholders. Developers adopting `AccessControl` can fine-tune access at a granular level, enhancing the contract's security and adaptability. This migration is indicative of evolving best practices in smart contract design, emphasizing modularity, security, and flexibility.

Num of instances: 5

### Findings 


<details><summary>Click to show findings</summary>

['[30](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L30-L30)']
```solidity
30: contract L1SharedBridge is IL1SharedBridge, ReentrancyGuard, Initializable, Ownable2Step  // <= FOUND

```
['[16](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L16-L16)']
```solidity
16: contract Bridgehub is IBridgehub, ReentrancyGuard, Ownable2Step  // <= FOUND

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L20-L20)']
```solidity
20: contract Governance is IGovernance, Ownable2Step  // <= FOUND

```
['[25](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/StateTransitionManager.sol#L25-L25)']
```solidity
25: contract StateTransitionManager is IStateTransitionManager, ReentrancyGuard, Ownable2Step  // <= FOUND

```
['[22](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/ValidatorTimelock.sol#L22-L22)']
```solidity
22: contract ValidatorTimelock is IExecutor, Ownable2Step  // <= FOUND

```


</details>

## [NonCritical-118] Redundant check for v == 27/28 when used with ecrecover

### Resolution 
In Ethereum, the ecrecover function is used to recover the address associated with a digital signature, where v represents the recovery id, and must be either 27 or 28 for the signature to be considered valid. However, explicitly checking if v equals 27 or 28 before calling ecrecover can be redundant since ecrecover inherently validates these values. 

Num of instances: 1

### Findings 


<details><summary>Click to show findings</summary>

['[159](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L159-L186)']
```solidity
159:     function _isValidSignature(bytes32 _hash, bytes memory _signature) internal view returns (bool) {
160:         require(_signature.length == 65, "Signature length is incorrect");
161:         uint8 v;
162:         bytes32 r;
163:         bytes32 s;
164:         
165:         
166:         
167:         
168:         assembly {
169:             r := mload(add(_signature, 0x20))
170:             s := mload(add(_signature, 0x40))
171:             v := and(mload(add(_signature, 0x41)), 0xff)
172:         }
173:         require(v == 27 || v == 28, "v is neither 27 nor 28"); // <= FOUND
174: 
175:         
176:         
177:         
178:         
179:         
180:         
181:         
182:         
183:         
184:         require(uint256(s) <= 0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF5D576E7357A4501DDFE92F46681B20A0, "Invalid s");
185: 
186:         address recoveredAddress = ecrecover(_hash, v, r, s); // <= FOUND
187: 
188:         return recoveredAddress == address(this) && recoveredAddress != address(0);
189:     }

```


</details>

## [NonCritical-119] Avoid arithmetic directly within array indices

### Resolution 
Avoiding arithmetic directly within array indices, like `test[i + 2]`, is recommended to prevent errors such as index out of bounds or incorrect data access. This practice enhances code readability and maintainability. Instead, calculate the index beforehand, store it in a variable, and then use that variable to access the array element. This approach reduces mistakes, especially in complex loops or when handling dynamic data, ensuring that each access is clear and verifiable. It's about keeping code clean and understandable, minimizing potential bugs.

Num of instances: 23

### Findings 


<details><summary>Click to show findings</summary>

['[582](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L582-L582)']
```solidity
582:             blobAuxOutputWords[i * 2 + 1] = _blobCommitments[i]; // <= FOUND

```
['[643](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L643-L646)']
```solidity
643:             
644:             
645:             bytes32 openingPoint = bytes32(
646:                 uint256(uint128(bytes16(_pubdataCommitments[i:i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET]))) // <= FOUND
647:             );

```
['[647](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L647-L650)']
```solidity
647:             _pointEvaluationPrecompile(
648:                 blobVersionedHash,
649:                 openingPoint,
650:                 _pubdataCommitments[i + PUBDATA_COMMITMENT_CLAIMED_VALUE_OFFSET:i + PUBDATA_COMMITMENT_SIZE] // <= FOUND
651:             );

```
['[128](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L128-L128)']
```solidity
128:             bytes calldata stateDiff = _stateDiffs[i:i + STATE_DIFF_ENTRY_SIZE]; // <= FOUND

```
['[147](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L147-L151)']
```solidity
147:             _verifyValueCompression(
148:                 initValue,
149:                 finalValue,
150:                 operation,
151:                 _compressedStateDiffs[stateDiffPtr:stateDiffPtr + len] // <= FOUND
152:             );

```
['[168](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L168-L169)']
```solidity
168:             uint256 compressedEnumIndex = _sliceToUint256(
169:                 _compressedStateDiffs[stateDiffPtr:stateDiffPtr + _enumerationIndexSize] // <= FOUND
170:             );

```
['[203](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L203-L203)']
```solidity
203:             dictionary = _rawCompressedData[2:2 + dictionaryLen * 8]; // <= FOUND

```
['[204](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/Compressor.sol#L204-L204)']
```solidity
204:             encodedData = _rawCompressedData[2 + dictionaryLen * 8:]; // <= FOUND

```
['[200](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L200-L201)']
```solidity
200:         
201:         uint32 numberOfL2ToL1Logs = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4])); // <= FOUND

```
['[207](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L207-L208)']
```solidity
207:             bytes32 hashedLog = EfficientCall.keccak(
208:                 _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + L2_TO_L1_LOG_SERIALIZE_SIZE] // <= FOUND
209:             );

```
['[233](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L233-L234)']
```solidity
233:         
234:         uint32 numberOfMessages = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4])); // <= FOUND

```
['[237](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L237-L237)']
```solidity
237:             uint32 currentMessageLength = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4])); // <= FOUND

```
['[239](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L239-L240)']
```solidity
239:             bytes32 hashedMessage = EfficientCall.keccak(
240:                 _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + currentMessageLength] // <= FOUND
241:             );

```
['[251](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L251-L252)']
```solidity
251:         
252:         uint32 numberOfBytecodes = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4])); // <= FOUND

```
['[255](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L255-L256)']
```solidity
255:             uint32 currentBytecodeLength = uint32(
256:                 bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4]) // <= FOUND
257:             );

```
['[259](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L259-L263)']
```solidity
259:             reconstructedChainedL1BytecodesRevealDataHash = keccak256(
260:                 abi.encode(
261:                     reconstructedChainedL1BytecodesRevealDataHash,
262:                     Utils.hashL2Bytecode(
263:                         _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + currentBytecodeLength] // <= FOUND
264:                     )
265:                 )
266:             );

```
['[286](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L286-L286)']
```solidity
286:         uint24 compressedStateDiffSize = uint24(bytes3(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 3])); // <= FOUND

```
['[292](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L292-L292)']
```solidity
292:         bytes calldata compressedStateDiffs = _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + // <= FOUND
293:             compressedStateDiffSize];

```
['[300](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L300-L300)']
```solidity
300:         uint32 numberOfStateDiffs = uint32(bytes4(_totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + 4])); // <= FOUND

```
['[303](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/L1Messenger.sol#L303-L304)']
```solidity
303:         bytes calldata stateDiffs = _totalL2ToL1PubdataAndStateDiffs[calldataPtr:calldataPtr + // <= FOUND
304:             (numberOfStateDiffs * STATE_DIFF_ENTRY_SIZE)]; // <= FOUND

```
['[61](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L61-L64)']
```solidity
61:             
62:             require(
63:                 logOutput.pubdataHash ==
64:                     keccak256(_newBatch.pubdataCommitments[1:_newBatch.pubdataCommitments.length - 32]), // <= FOUND
65:                 "wp"
66:             );

```
['[581](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/Executor.sol#L581-L581)']
```solidity
581:             blobAuxOutputWords[i * 2] = _blobHashes[i]; // <= FOUND

```
['[23](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/LibMap.sol#L23-L26)']
```solidity
23:             
24:             
25:             
26:             uint256 mapValue = _map.map[_index / 8]; // <= FOUND

```


</details>

## [NonCritical-120] Memory-safe annotation missing

### Resolution 
Tagging assembly blocks as "memory safe" in Solidity helps maintainers and auditors quickly identify areas of the code less likely to introduce vulnerabilities due to improper memory access. This practice promotes safer contract development by clearly communicating assumptions about memory handling, aiding in the review process, and reducing the risk of introducing memory-related bugs. It's a part of best coding practices, enhancing code clarity and security, especially in complex, low-level operations where Solidity's safety checks are bypassed.

Num of instances: 13

### Findings 


<details><summary>Click to show findings</summary>

['[89](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/libraries/Diamond.sol#L89-L89)']
```solidity
89:         assembly {
90:             diamondStorage.slot := position
91:         }

```
['[254](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L254-L254)']
```solidity
254:         assembly {
255:             dataOffset := _data.offset
256:         }

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L41-L41)']
```solidity
41:         assembly {
42:             dataStart := add(data, 0x20)
43:         }

```
['[85](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/zksync/contracts/SystemContractsCaller.sol#L85-L85)']
```solidity
85:         assembly {
86:             size := returndatasize()
87:         }

```
['[20](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L20-L20)']
```solidity
20:        assembly {
21:             let offset := sub(_bytes.offset, 30)
22:             result := calldataload(add(offset, _start))
23:         }

```
['[27](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L27-L27)']
```solidity
27:        assembly {
28:             let offset := sub(_bytes.offset, 28)
29:             result := calldataload(add(offset, _start))
30:         }

```
['[34](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L34-L34)']
```solidity
34:        assembly {
35:             let offset := sub(_bytes.offset, 24)
36:             result := calldataload(add(offset, _start))
37:         }

```
['[41](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/UnsafeBytesCalldata.sol#L41-L41)']
```solidity
41:        assembly {
42:             result := calldataload(add(_bytes.offset, _start))
43:         }

```
['[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L31-L31)']
```solidity
31:             assembly {
32:                 return(0, 0)
33:             }

```
['[31](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/DefaultAccount.sol#L31-L31)']
```solidity
31:             assembly {
32:                 return(0, 0)
33:             }

```
['[46](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/PubdataChunkPublisher.sol#L46-L46)']
```solidity
46:             assembly {
47:                 
48:                 let ptr := add(totalBlobs, 0x20)
49:                 blobHash := keccak256(add(ptr, start), BLOB_SIZE_BYTES)
50:             }

```
['[218](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/libraries/EfficientCall.sol#L218-L218)']
```solidity
218:            assembly {
219:                 size := returndatasize()
220:             }

```
['[69](https://github.com/code-423n4/2024-03-zksync/blob/main/code/system-contracts/contracts/MsgValueSimulator.sol#L69-L69)']
```solidity
69:              assembly {
70:                     revert(0, 0)
71:                 }

```


</details>

## [NonCritical-121] Modifier checks msg.sender against two addresses. Consider using multiple modifiers for more control

### Resolution 
In Solidity, using a single modifier to check msg.sender against two different addresses can make the code less flexible and harder to maintain. Instead, consider using multiple modifiers for greater control and clarity. Separating these checks into individual modifiers improves readability and reusability, as each modifier can then be applied independently to different functions according to specific access requirements. This approach enhances the modularity of the contract and makes it easier to update or extend access control logic in the future, aligning with best practices for smart contract development and security.

Num of instances: 6

### Findings 


<details><summary>Click to show findings</summary>

['[74](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L74-L76)']
```solidity
74:     modifier onlyBridgehubOrEra(uint256 _chainId) {
75:         require(
76:             msg.sender == address(bridgehub) || (_chainId == ERA_CHAIN_ID && msg.sender == ERA_DIAMOND_PROXY), // <= FOUND
77:             "L1SharedBridge: not bridgehub or era chain"
78:         );
79:         _;
80:     }

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L45-L46)']
```solidity
45:     modifier onlyOwnerOrAdmin() {
46:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin"); // <= FOUND
47:         _;
48:     }

```
['[45](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridgehub/Bridgehub.sol#L45-L46)']
```solidity
45:     modifier onlyOwnerOrAdmin() {
46:         require(msg.sender == admin || msg.sender == owner(), "Bridgehub: not owner or admin"); // <= FOUND
47:         _;
48:     }

```
['[70](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/governance/Governance.sol#L70-L72)']
```solidity
70:     modifier onlyOwnerOrSecurityCouncil() {
71:         require(
72:             msg.sender == owner() || msg.sender == securityCouncil, // <= FOUND
73:             "Only the owner and security council are allowed to call this function"
74:         );
75:         _;
76:     }

```
['[36](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L36-L38)']
```solidity
36:     modifier onlyAdminOrStateTransitionManager() {
37:         require(
38:             msg.sender == s.admin || msg.sender == s.stateTransitionManager, // <= FOUND
39:             "StateTransition Chain: Only by admin or state transition manager"
40:         );
41:         _;
42:     }

```
['[44](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/state-transition/chain-deps/facets/ZkSyncStateTransitionBase.sol#L44-L46)']
```solidity
44:     modifier onlyValidatorOrStateTransitionManager() {
45:         require(
46:             s.validators[msg.sender] || msg.sender == s.stateTransitionManager, // <= FOUND
47:             "StateTransition Chain: Only by validator or state transition manager"
48:         );
49:         _;
50:     }

```


</details>

## [NonCritical-122] ERC777 tokens can introduce reentrancy risks

### Resolution 
ERC777 is an advanced token standard that introduces hooks, allowing operators to execute additional logic during transfers. While this feature offers greater flexibility, it also opens up the possibility of reentrancy attacks. Specifically, when tokens are sent, the receiving contract's `tokensReceived` hook gets called, and this external call can execute arbitrary code. An attacker can exploit this feature to re-enter the original function, potentially leading to double-spending or other types of financial manipulation.

To mitigate reentrancy risks with ERC777, it's crucial to adopt established security measures, such as utilizing reentrancy guards or following the check-effects-interactions pattern. Some developers opt to stick with the simpler ERC20 standard, which does not have these hooks, to minimize this risk. If you do choose to use ERC777, extreme caution and thorough auditing are advised to secure against potential reentrancy vulnerabilities.

Num of instances: 2

### Findings 


<details><summary>Click to show findings</summary>

['[160](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1ERC20Bridge.sol#L160-L162)']
```solidity
160:     function _depositFundsToSharedBridge(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) { // <= FOUND
161:         uint256 balanceBefore = _token.balanceOf(address(sharedBridge));
162:         _token.safeTransferFrom(_from, address(sharedBridge), _amount); // <= FOUND
163:         uint256 balanceAfter = _token.balanceOf(address(sharedBridge));
164: 
165:         return balanceAfter - balanceBefore;
166:     }

```
['[173](https://github.com/code-423n4/2024-03-zksync/blob/main/code/contracts/ethereum/contracts/bridge/L1SharedBridge.sol#L173-L175)']
```solidity
173:     function _depositFunds(address _from, IERC20 _token, uint256 _amount) internal returns (uint256) { // <= FOUND
174:         uint256 balanceBefore = _token.balanceOf(address(this));
175:         _token.safeTransferFrom(_from, address(this), _amount); // <= FOUND
176:         uint256 balanceAfter = _token.balanceOf(address(this));
177: 
178:         return balanceAfter - balanceBefore;
179:     }

```


</details>
